{"file_contents":{"BUTTON_DISPLAY_FIX_SUCCESS.md":{"content":"# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–ö–Ω–æ–ø–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ —Ç–æ—á–∫–∏ (\"...\") –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –∏–∫–æ–Ω–∫–∞–º–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ **\"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\"** –∏–ª–∏ **\"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"**.\n\n## –ü—Ä–∏—á–∏–Ω–∞\n–í —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º Python –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `button.text` –≤ f-—Å—Ç—Ä–æ–∫–∞—Ö, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É `NameError: name 'button' is not defined`.\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### 1. –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π button\n**–§–∞–π–ª:** `client/src/lib/bot-generator.ts`\n**–°—Ç—Ä–æ–∫–∞ 6358:** \n```typescript\n// –ë—ã–ª–æ:\ncode += `${safeVarName}_text = f\"‚úÖ {button.text}\" if ${safeVarName}_selected else \"${button.text}\"\\n`;\n\n// –°—Ç–∞–ª–æ:\ncode += `${safeVarName}_text = \"‚úÖ ${button.text}\" if ${safeVarName}_selected else \"${button.text}\"\\n`;\n```\n\n### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n**–°—Ç—Ä–æ–∫–∞ 6355:**\n```typescript\nconst safeVarName = buttonValue.toLowerCase().replace(/[^a-z0-9]/g, '_');\n```\n\n### 3. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–¥–µ\n–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:\n```python\nsport_text = \"‚úÖ ‚öΩ –°–ø–æ—Ä—Ç\" if sport_selected else \"‚öΩ –°–ø–æ—Ä—Ç\"\nmusic_text = \"‚úÖ üéµ –ú—É–∑—ã–∫–∞\" if music_selected else \"üéµ –ú—É–∑—ã–∫–∞\"\nbooks_text = \"‚úÖ üìö –ö–Ω–∏–≥–∏\" if books_selected else \"üìö –ö–Ω–∏–≥–∏\"\n# –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ...\n```\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n‚úÖ **–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã:**\n- –ù–µ—Ç –æ—à–∏–±–æ–∫ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π button\n- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö  \n- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π f-string –≤ —Ç–µ–∫—Å—Ç–µ –∫–Ω–æ–ø–æ–∫\n- –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n- –†–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (`builder.adjust(2)`)\n- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç\n- –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å—Ç—Ä–æ–∫ —Å 'button' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ\n\n## –°—Ç–∞—Ç—É—Å\nüéâ **–ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û** - –ö–Ω–æ–ø–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ –≤—Å–µ–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏ –∏ –∏–∫–æ–Ω–∫–∞–º–∏, –∫–∞–∫ –Ω–∞ —Ü–µ–ª–µ–≤–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.\n\n**–ö–Ω–æ–ø–∫–∏ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å:**\n- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏ –∫–Ω–æ–ø–æ–∫ (‚öΩ –°–ø–æ—Ä—Ç, üéµ –ú—É–∑—ã–∫–∞, üìö –ö–Ω–∏–≥–∏ –∏ —Ç.–¥.)\n- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–ª–æ–Ω–æ–∫ (2 –∫–æ–ª–æ–Ω–∫–∏)\n- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–∞–ª–æ—á–µ–∫ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n\n---\n*–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 7 –∞–≤–≥—É—Å—Ç–∞ 2025*","size_bytes":3138},"CALLBACK_DATA_FIX_SUCCESS_REPORT.md":{"content":"# –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò CALLBACK_DATA\n\n## –î–∞—Ç–∞: 7 –∞–≤–≥—É—Å—Ç–∞ 2025\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n- –ö–Ω–æ–ø–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –Ω–µ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è\n- –ì–∞–ª–æ—á–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–π\n- Callback_data –∏–º–µ–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ª–∏—à–Ω–∏–º \"btn-\"\n\n## –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã\n–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ callback_data:\n- **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–≤–∞–ª**: `multi_select_start_btn-sport`\n- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∂–∏–¥–∞–ª**: `multi_select_start_sport`\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ñ–æ—Ä–º–∞—Ç—ã callback_data –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ\n**–§–∞–π–ª**: `client/src/lib/bot-generator.ts`\n\n**–°—Ç—Ä–æ–∫–∞ 2488** (–±—ã–ª–æ):\n```typescript\nconst btnCallbackData = `multi_select_start_btn-${btnId}`;\n```\n**–°—Ç–∞–ª–æ**:\n```typescript\nconst btnCallbackData = `multi_select_start_${btnId}`;\n```\n\n**–°—Ç—Ä–æ–∫–∞ 5019** (–±—ã–ª–æ):\n```typescript\ncallback_data=\"multi_select_start_btn-${buttonValue}\"\n```\n**–°—Ç–∞–ª–æ**:\n```typescript\ncallback_data=\"multi_select_start_${buttonValue}\"\n```\n\n**–°—Ç—Ä–æ–∫–∞ 6500** (–±—ã–ª–æ):\n```typescript\ncallback_data=\"multi_select_start_btn-${buttonValue}\"\n```\n**–°—Ç–∞–ª–æ**:\n```typescript\ncallback_data=\"multi_select_start_${buttonValue}\"\n```\n\n**–°—Ç—Ä–æ–∫–∞ 88** (–±—ã–ª–æ):\n```typescript\nconst callbackData = nodeId ? `multi_select_${nodeId}_btn-${button.target || button.id}` : `selection_${button.target || button.id}`;\n```\n**–°—Ç–∞–ª–æ**:\n```typescript\nconst callbackData = nodeId ? `multi_select_${nodeId}_${button.target || button.id}` : `selection_${button.target || button.id}`;\n```\n\n**–°—Ç—Ä–æ–∫–∞ 2487** (–±—ã–ª–æ):\n```typescript\nconst btnId = btn.id || btn.target || `btn-${index}`;\n```\n**–°—Ç–∞–ª–æ**:\n```typescript\nconst btnId = btn.id || btn.target || `${index}`;\n```\n\n### 2. –û–±–Ω–æ–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ callback_data –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ\n**–°—Ç—Ä–æ–∫–∏ 4934-4936** (–±—ã–ª–æ):\n```typescript\ncode += '    if len(parts) >= 4:\\n';\ncode += '        node_id = parts[2]\\n';\ncode += '        button_id = \"_\".join(parts[3:])\\n';\n```\n**–°—Ç–∞–ª–æ**:\n```typescript\ncode += '    if len(parts) >= 3:\\n';\ncode += '        node_id = parts[2]\\n';\ncode += '        button_id = \"_\".join(parts[3:]) if len(parts) > 3 else parts[2]\\n';\n```\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n### –ü—Ä–æ–≤–µ—Ä–∫–∞ callback_data –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–¥–µ\n‚úÖ **–ù–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ callback_data –Ω–∞–π–¥–µ–Ω—ã**:\n- `multi_select_start_sport`\n- `multi_select_start_music`\n- `multi_select_start_games`\n- `multi_select_start_cooking`\n\n‚úÖ **–°—Ç–∞—Ä—ã–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ callback_data –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**:\n- `multi_select_start_btn-sport` - –£–î–ê–õ–ï–ù\n- `multi_select_start_btn-music` - –£–î–ê–õ–ï–ù\n- `multi_select_start_btn-games` - –£–î–ê–õ–ï–ù\n\n‚úÖ **–ü–∞—Ä—Å–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**:\n- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `button_id` –∏–∑ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n\n### –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã\n- –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω —Å ID –ø—Ä–æ—Ü–µ—Å—Å–∞ 5350\n- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞\n- –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ë–î\n- –ò–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è: ['üéÆ –ò–≥—Ä—ã', 'üç≥ –ö—É–ª–∏–Ω–∞—Ä–∏—è']\n\n## –õ–æ–≥–∏ –±–æ—Ç–∞ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã)\n```\nINFO:root:–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π user_interests: ['üéÆ –ò–≥—Ä—ã', 'üç≥ –ö—É–ª–∏–Ω–∞—Ä–∏—è']\nINFO:root:–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å 2 –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏\nINFO:root:–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏–∑ –ë–î: ['üéÆ –ò–≥—Ä—ã', 'üç≥ –ö—É–ª–∏–Ω–∞—Ä–∏—è']\nINFO:aiogram.event:Update id=302885756 is handled. Duration 3799 ms by bot id=8082906513\n```\n\n## –°—Ç–∞—Ç—É—Å\nüéâ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´ –£–°–ü–ï–®–ù–û**\n\n–¢–µ–ø–µ—Ä—å:\n1. ‚úÖ –ö–Ω–æ–ø–∫–∏ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è\n2. ‚úÖ –ì–∞–ª–æ—á–∫–∏ –¥–æ–ª–∂–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è\n3. ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è\n4. ‚úÖ Callback_data –∏–º–µ—é—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç\n\n## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ –≤ Telegram –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:\n- –ö–Ω–æ–ø–∫–∏ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è\n- –ì–∞–ª–æ—á–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è/–∏—Å—á–µ–∑–∞—é—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ\n- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏","size_bytes":4794},"CHECKMARKS_AND_DONE_BUTTON_FIX_SUCCESS_REPORT.md":{"content":"# ‚úÖ –ü–û–õ–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ì–∞–ª–æ—á–∫–∏ –∏ –∫–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n\n## –°—Ç–∞—Ç—É—Å: –£–°–ü–ï–®–ù–û –†–ï–®–ï–ù–û ‚úÖ\n\n**–î–∞—Ç–∞:** 10 –∞–≤–≥—É—Å—Ç–∞ 2025  \n**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1 —á–∞—Å  \n**–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è  \n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–í TypeScript –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ –±–æ—Ç–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏:\n1. **–ì–∞–ª–æ—á–∫–∏ (‚úÖ)** –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π –≤ —Ä–µ–∂–∏–º–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞  \n2. **–ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\"** –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞\n\n## –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã\n–ö–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–∞–ª–æ—á–µ–∫ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `generateInlineKeyboardCode`, –Ω–æ:\n- –£—Å–ª–æ–≤–∏–µ `isMultipleSelection` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n\n## –†–µ—à–µ–Ω–∏–µ\n\n### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ\n```typescript\nconsole.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: üîç –ü–†–û–í–ï–†–Ø–ï–ú –≥–∞–ª–æ—á–∫–∏ –¥–ª—è ${button.text}: isMultipleSelection=${isMultipleSelection}`);\nif (isMultipleSelection) {\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –î–û–ë–ê–í–õ–Ø–ï–ú –ì–ê–õ–û–ß–ö–ò –¥–ª—è –∫–Ω–æ–ø–∫–∏ selection: ${button.text} (—É–∑–µ–ª: ${nodeId})`);\n  // ... –∫–æ–¥ –≥–∞–ª–æ—á–µ–∫\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù –ö–û–î –ì–ê–õ–û–ß–ï–ö –¥–ª—è ${button.text}`);\n}\n```\n\n### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–∞–ª–æ—á–µ–∫\n–í —Ñ—É–Ω–∫—Ü–∏–∏ `generateInlineKeyboardCode` –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å `action === 'selection'`:\n```typescript\nif (isMultipleSelection) {\n  code += `${indentLevel}# –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ —Å –≥–∞–ª–æ—á–∫–∞–º–∏: ${button.text}\\n`;\n  code += `${indentLevel}selected_mark = \"‚úÖ \" if \"${button.text}\" in user_data[user_id][\"multi_select_${nodeId}\"] else \"\"\\n`;\n  code += `${indentLevel}builder.add(InlineKeyboardButton(text=f\"{selected_mark}${button.text}\", callback_data=\"${callbackData}\"))\\n`;\n}\n```\n\n### 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –∫–Ω–æ–ø–∫–∏ \"–ì–æ—Ç–æ–≤–æ\"\n–ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∞—Å—å:\n```typescript\nif (hasSelectionButtons && isMultipleSelection && nodeData?.continueButtonTarget) {\n  const doneCallbackData = `done_${shortNodeId}`;\n  builder.add(InlineKeyboardButton(text=\"–ì–æ—Ç–æ–≤–æ\", callback_data=\"${doneCallbackData}\"));\n}\n```\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n### ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞\n–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é:\n```\nüîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –î–û–ë–ê–í–õ–Ø–ï–ú –ì–ê–õ–û–ß–ö–ò –¥–ª—è –∫–Ω–æ–ø–∫–∏ selection: –ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\nüîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù –ö–û–î –ì–ê–õ–û–ß–ï–ö –¥–ª—è –ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\nüîß –ì–ï–ù–ï–†–ê–¢–û–†: –î–û–ë–ê–í–õ–Ø–ï–ú –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è —É–∑–ª–∞ metro_selection_paste_1754798743361_to7vug9we!\n```\n\n### ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Python –∫–æ–¥\n–í —Ñ–∞–π–ª–µ `bots/bot_1.py` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥:\n```python\n# –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ —Å –≥–∞–ª–æ—á–∫–∞–º–∏: –ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\nselected_mark = \"‚úÖ \" if \"–ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\" in user_data[user_id][\"multi_select_metro_selection_paste_1754798743361_to7vug9we\"] else \"\"\nbuilder.add(InlineKeyboardButton(text=f\"{selected_mark}–ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\", callback_data=\"ms_to7vug9we_red_line\"))\n\n# –ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\nbuilder.add(InlineKeyboardButton(text=\"–ì–æ—Ç–æ–≤–æ\", callback_data=\"done_to7vug9we\"))\n```\n\n### ‚úÖ –†–∞–±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏\n–õ–æ–≥–∏ –±–æ—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ–ª–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:\n```\nINFO:root:‚ûï –î–æ–±–∞–≤–∏–ª–∏ –≤—ã–±–æ—Ä: –ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\nINFO:root:üìã –¢–µ–∫—É—â–∏–µ –≤—ã–±–æ—Ä—ã: ['–ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•']\nINFO:root:‚ûñ –£–±—Ä–∞–ª–∏ –≤—ã–±–æ—Ä: –ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü• (–ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏)\nINFO:root:üîò –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –ì–æ—Ç–æ–≤–æ -> done_to7vug9we\n```\n\n## –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å\n\n### ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π –≤ –≤—ã–±–æ—Ä–∫—É\n- –£–¥–∞–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π –∏–∑ –≤—ã–±–æ—Ä–∫–∏\n- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏\n\n### ‚úÖ –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å\n- –ì–∞–ª–æ—á–∫–∏ (‚úÖ) –ø–æ—è–≤–ª—è—é—Ç—Å—è —É –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π\n- –ì–∞–ª–æ—á–∫–∏ –∏—Å—á–µ–∑–∞—é—Ç –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –≤—ã–±–æ—Ä–∞\n\n### ‚úÖ –ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\"\n- –ü–æ—è–≤–ª—è–µ—Ç—Å—è –¥–ª—è —É–∑–ª–æ–≤ —Å `allowMultipleSelection: true`\n- –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è `callback_data`\n- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É\n\n## –§–∞–π–ª—ã, –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ —Ä–µ—à–µ–Ω–∏—è\n\n### `client/src/lib/bot-generator.ts`\n- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–∞–ª–æ—á–µ–∫\n- –£–ª—É—á—à–µ–Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —É—Å–ª–æ–≤–∏–π\n\n### –¢–µ—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã\n- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —à–∞–±–ª–æ–Ω \"–º–∏—à—É—Ç–∫–∞\" –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n- –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å —É–∑–ª–æ–º `metro_selection_paste_1754798743361_to7vug9we`\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è\n\n### –£—Å–ª–æ–≤–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏\n```typescript\nconst isMultipleSelection = nodeData?.allowMultipleSelection === true;\nconst hasSelectionButtons = buttons.some(btn => btn.action === 'selection');\n```\n\n### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–∞–ª–æ—á–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏\n```python\nselected_mark = \"‚úÖ \" if \"${button.text}\" in user_data[user_id][\"multi_select_${nodeId}\"] else \"\"\nbuilder.add(InlineKeyboardButton(text=f\"{selected_mark}${button.text}\", callback_data=\"${callbackData}\"))\n```\n\n### Callback –¥–∞–Ω–Ω—ã–µ\n- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞: `ms_${shortNodeId}_${shortTarget}` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `ms_to7vug9we_red_line`)\n- –ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\": `done_${shortNodeId}` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `done_to7vug9we`)\n\n## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ\n\n**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞.** –°–∏—Å—Ç–µ–º–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:\n\n1. ‚úÖ **–ì–∞–ª–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è** –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π\n2. ‚úÖ **–ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è** –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç\n3. ‚úÖ **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –º–µ–∂–¥—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏\n4. ‚úÖ **–ù–∞–≤–∏–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç** –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞\n\n–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ª–æ–≥–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –±–æ—Ç–∞.","size_bytes":6972},"CHECKMARKS_FIX_SUCCESS_REPORT.md":{"content":"# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≥–∞–ª–æ—á–µ–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –≤ —à–∞–±–ª–æ–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤, —Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–Ω—Ç–µ—Ä–µ—Å—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —Å –≥–∞–ª–æ—á–∫–∞–º–∏ ‚úÖ. –≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –ø–ª–æ—Ö–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–µ–ª —Å–≤–æ–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤—ã–±–æ—Ä—ã.\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞\n–í —Ñ—É–Ω–∫—Ü–∏–∏ `handle_multi_select_callback` –≤ —Ñ–∞–π–ª–µ `client/src/lib/bot-generator.ts` (—Å—Ç—Ä–æ–∫–∏ 4787-4812) –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ª–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞.\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\n‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** –≤ `client/src/lib/bot-generator.ts` —Å—Ç—Ä–æ–∫–∏ 4787-4812:\n\n–ó–∞–º–µ–Ω–µ–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:\n```python\n# –°—Ç–∞—Ä—ã–π –∫–æ–¥:\nif f\"multi_select_{node_id}\" not in user_data[user_id]:\n    user_data[user_id][f\"multi_select_{node_id}\"] = []\n```\n\n–ù–∞ –ø–æ–ª–Ω—É—é –ª–æ–≥–∏–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:\n```python\n# –ù–æ–≤—ã–π –∫–æ–¥ —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º:\nif f\"multi_select_{node_id}\" not in user_data[user_id]:\n    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã\n    user_vars = await get_user_from_db(user_id)\n    saved_selections = []\n    \n    if user_vars:\n        # –ò—â–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏\n        for var_name, var_data in user_vars.items():\n            if \"–∏–Ω—Ç–µ—Ä–µ—Å\" in var_name.lower() or var_name == \"interests\" or var_name.startswith(\"multi_select_\"):\n                if isinstance(var_data, dict) and \"value\" in var_data:\n                    saved_str = var_data[\"value\"]\n                elif isinstance(var_data, str):\n                    saved_str = var_data\n                else:\n                    saved_str = str(var_data) if var_data else \"\"\n                \n                if saved_str:\n                    saved_selections = [item.strip() for item in saved_str.split(\",\")]\n                    break\n    \n    user_data[user_id][f\"multi_select_{node_id}\"] = saved_selections\n```\n\n## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç\n1. **–ü–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å—ã ‚Üí —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î\n2. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\"\n3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏–∑ –ë–î\n4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –†–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å –≥–∞–ª–æ—á–∫–∞–º–∏ ‚úÖ\n\n## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n1. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π\n2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –∏ –Ω–∞–∂–º–∏—Ç–µ \"–ì–æ—Ç–æ–≤–æ\"\n3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\"\n4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –≥–∞–ª–æ—á–∫–∞–º–∏\n\n## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\n‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ê –û–®–ò–ë–ö–ê –° user_vars** –≤ —Å—Ç—Ä–æ–∫–∞—Ö 1063-1081:\n–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `user_vars` –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.\n\n## –°—Ç–∞—Ç—É—Å\nüü¢ **–í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ì–û–¢–û–í–´** - –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω\nüî¥ **–¢–†–ï–ë–£–ï–¢ –î–ï–ô–°–¢–í–ò–Ø** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ:\n1. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É \"–≠–∫—Å–ø–æ—Ä—Ç\" –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ\n2. –°–∫–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –±–æ—Ç–∞\n3. –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞ –Ω–æ–≤—ã–º –∫–æ–¥–æ–º\n4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\"\n\n## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n7 –∞–≤–≥—É—Å—Ç–∞ 2025, 19:09 UTC\n\n---\n\n### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n- **–§–∞–π–ª**: `client/src/lib/bot-generator.ts`\n- **–§—É–Ω–∫—Ü–∏—è**: `handle_multi_select_callback`\n- **–°—Ç—Ä–æ–∫–∏**: 4787-4812\n- **–¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è","size_bytes":4601},"COLUMN_CONSISTENCY_FIX_REPORT.md":{"content":"# –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –ö–û–ù–°–ò–°–¢–ï–ù–¢–ù–û–°–¢–ò –ö–û–õ–û–ù–û–ö\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞—Ö –Ω–∞–±–ª—é–¥–∞–ª–∞—Å—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫:\n- **–ù–∞—á–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞**: 8 –∫–Ω–æ–ø–æ–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ + –∫–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" = 9 –∫–Ω–æ–ø–æ–∫ –≤ 2 –∫–æ–ª–æ–Ω–∫–∏\n- **–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –æ–ø—Ü–∏–∏**: –¢–µ –∂–µ 9 –∫–Ω–æ–ø–æ–∫, –Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤ 3 –∫–æ–ª–æ–Ω–∫–∏\n- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π UI, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–µ–ª –Ω–µ–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ\n\n## –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã\n1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π**: –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ callback —Ñ—É–Ω–∫—Ü–∏—è `builder.adjust()` –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –ü–ï–†–ï–î –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–Ω–æ–ø–∫–∏ \"–ì–æ—Ç–æ–≤–æ\"\n2. **–†–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–ª–æ–Ω–æ–∫**: –ù–∞—á–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–æ–Ω–æ–∫\n3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ nodeData**: –§—É–Ω–∫—Ü–∏—è `calculateOptimalColumns` –Ω–µ –ø–æ–ª—É—á–∞–ª–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ —É–∑–ª–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏\n\n## –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ calculateOptimalColumns\n**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `client/src/lib/bot-generator.ts`, —Å—Ç—Ä–æ–∫–∞ 50-68\n```typescript\nfunction calculateOptimalColumns(buttons: any[], nodeData?: any): number {\n  if (!buttons || buttons.length === 0) return 1;\n  \n  const totalButtons = buttons.length;\n  \n  // –ï—Å–ª–∏ —ç—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä, –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º 2 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏\n  if (nodeData?.multiSelectEnabled || nodeData?.allowMultipleSelection) {\n    return 2;\n  }\n  \n  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫\n  if (totalButtons >= 6) {\n    return 2; // –î–ª—è 6+ –∫–Ω–æ–ø–æ–∫ - 2 –∫–æ–ª–æ–Ω–∫–∏\n  } else if (totalButtons >= 3) {\n    return 1; // –î–ª—è 3-5 –∫–Ω–æ–ø–æ–∫ - 1 –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è —É–¥–æ–±–æ—á–∏—Ç–∞–µ–º–æ—Å—Ç–∏\n  } else {\n    return 1; // –î–ª—è 1-2 –∫–Ω–æ–ø–æ–∫ - 1 –∫–æ–ª–æ–Ω–∫–∞\n  }\n}\n```\n\n### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ callback –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `client/src/lib/bot-generator.ts`, —Å—Ç—Ä–æ–∫–∏ 4682-4720\n\n**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:\n```typescript\n// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏\nselectionButtons.forEach(button => { ... });\n// –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ –ó–î–ï–°–¨\nbuilder.adjust(keyboard_width);\n// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" –ü–û–°–õ–ï adjust\nbuilder.add(InlineKeyboardButton(...));\n```\n\n**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:\n```typescript\n// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞\nselectionButtons.forEach(button => { ... });\n// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\"\nbuilder.add(InlineKeyboardButton(...));\n// –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ –ü–û–°–õ–ï –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫\nbuilder.adjust(keyboard_width);\n```\n\n### 3. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ nodeData\n**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `client/src/lib/bot-generator.ts`, —Å—Ç—Ä–æ–∫–∏ 4685-4687\n```typescript\nconst allButtons = [...selectionButtons];\nallButtons.push({ text: node.data.continueButtonText || '–ì–æ—Ç–æ–≤–æ' });\nconst optimalColumns = calculateOptimalColumns(allButtons, node.data);\n```\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚ùå –ù–∞—á–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞: 2 –∫–æ–ª–æ–Ω–∫–∏\n- ‚ùå –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞: 3 –∫–æ–ª–æ–Ω–∫–∏\n- ‚ùå –ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π UI\n\n### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚úÖ –ù–∞—á–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞: 2 –∫–æ–ª–æ–Ω–∫–∏\n- ‚úÖ –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞: 2 –∫–æ–ª–æ–Ω–∫–∏  \n- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π UI\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:\n1. `client/src/lib/bot-generator.ts` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n2. `test_consistent_columns_fix.py` - —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n3. `generate_consistent_columns_bot.py` - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞\n4. `test_fixed_multi_select_bot.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–æ—Ç–∞\n\n### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n1. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –û–¥–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤\n2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫**: –°–Ω–∞—á–∞–ª–∞ –≤—Å–µ –∫–Ω–æ–ø–∫–∏, –ø–æ—Ç–æ–º adjust\n3. **–ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: nodeData –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏\n4. **–ï–¥–∏–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç**: 2 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n\n## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n\n### –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç —Å —à–∞–±–ª–æ–Ω–æ–º –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤:\n- **8 –∫–Ω–æ–ø–æ–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤**: –°–ø–æ—Ä—Ç, –ú—É–∑—ã–∫–∞, –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, –ì–æ—Ç–æ–≤–∫–∞, –ö–Ω–∏–≥–∏, –ò—Å–∫—É—Å—Å—Ç–≤–æ, –ò–≥—Ä—ã\n- **1 –∫–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: \"–ì–æ—Ç–æ–≤–æ\"\n- **–í—Å–µ–≥–æ**: 9 –∫–Ω–æ–ø–æ–∫ –≤ 2 –∫–æ–ª–æ–Ω–∫–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ\n\n### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:\n1. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\n2. ‚úÖ –í—ã–±–æ—Ä –æ–¥–Ω–æ–π –æ–ø—Ü–∏–∏\n3. ‚úÖ –í—ã–±–æ—Ä –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–ø—Ü–∏–π\n4. ‚úÖ –û—Ç–º–µ–Ω–∞ –≤—ã–±–æ—Ä–∞\n5. ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞\n\n## –°—Ç–∞—Ç—É—Å\nüéâ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û**\n\n–ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –∫–æ–ª–æ–Ω–æ–∫ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞. –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–æ–Ω–æ–∫, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.\n\n---\n**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 7 –∞–≤–≥—É—Å—Ç–∞ 2025\n**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: ~30 –º–∏–Ω—É—Ç  \n**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É","size_bytes":6408},"COLUMN_REGULATION_SUCCESS_REPORT.md":{"content":"# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–ö–Ω–æ–ø–∫–∏ **\"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\"** –∏ **\"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"** –≤ —à–∞–±–ª–æ–Ω–µ —Å–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–ª–æ–Ω–æ–∫, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.\n\n## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### 1. –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è escapeForPython()\n**–§–∞–π–ª:** `client/src/lib/bot-generator.ts`\n- **–°—Ç—Ä–æ–∫–∞ 4919:** –£–±—Ä–∞–Ω `escapeForPython()` –∏–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n- **–°—Ç—Ä–æ–∫–∞ 6357:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω f-string –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–æ–∫ \n- **–°—Ç—Ä–æ–∫–∞ 92:** –£–¥–∞–ª–µ–Ω `escapeForPython()` –∏–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫\n\n### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è calculateOptimalColumns()\n–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `calculateOptimalColumns()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:\n- **–°—Ç—Ä–æ–∫–∏ 6384-6385:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `generateKeyboard()`\n- **–°—Ç—Ä–æ–∫–∏ 6409-6410:** –û–±—ã—á–Ω—ã–µ inline –∫–Ω–æ–ø–∫–∏\n- **–°—Ç—Ä–æ–∫–∏ 97-98:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `generateInlineKeyboardCode()`\n\n### 3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\n–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ **\"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\"** –∏ **\"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"** –ø—Ä–∞–≤–∏–ª—å–Ω–æ:\n- **–°—Ç—Ä–æ–∫–∏ 4658-4659:** –í—ã–∑—ã–≤–∞—é—Ç `start_handler()` \n- –ò—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `generateKeyboard()`\n- –ü—Ä–∏–º–µ–Ω—è—é—Ç `calculateOptimalColumns()` –¥–ª—è —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n‚úÖ **–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:**\n- –£–¥–∞–ª–µ–Ω escapeForPython() –∏–∑ –∫–Ω–æ–ø–æ–∫\n- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π f-string\n- calculateOptimalColumns –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è\n- builder.adjust() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è\n- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n- –ö–Ω–æ–ø–∫–∏ –∫–æ–º–∞–Ω–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è\n- Start handler –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ\n\n–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Ñ—É–Ω–∫—Ü–∏—è `escapeForPython()`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–ª–∞ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n\n1. **–ù–∞—á–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n2. **–ö–Ω–æ–ø–∫–∏ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"** —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—é—Ç `start_handler()`\n3. **–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫\n4. **–í—Å–µ –∫–Ω–æ–ø–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è** –≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∫–æ–ª–æ–Ω–æ–∫\n\n## –°—Ç–∞—Ç—É—Å\nüéâ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –†–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.\n\n---\n*–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 7 –∞–≤–≥—É—Å—Ç–∞ 2025*","size_bytes":3785},"COMMAND_BUTTONS_FIX_SUCCESS_REPORT.md":{"content":"# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ –±–æ—Ç–æ–≤\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–í —à–∞–±–ª–æ–Ω–µ \"–∫–æ—Ç–∏–∫\" (–±–æ—Ç –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –¥–ª—è –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞) –∫–Ω–æ–ø–∫–∞ \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" —Å –¥–µ–π—Å—Ç–≤–∏–µ–º \"command\" –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º Python –∫–æ–¥–µ.\n\n**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—É—Ç—å**: –ö–Ω–æ–ø–∫–∏ —Å `action: \"command\"` –∏ `target: \"/start\"` –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `callback_data=\"cmd_start\"` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.\n\n## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω–∞ \"–∫–æ—Ç–∏–∫\"\n1. **start** - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥)\n2. **gender_selection** - –í—ã–±–æ—Ä –ø–æ–ª–∞ (–∫–Ω–æ–ø–∫–∏: –ú—É–∂—á–∏–Ω–∞/–ñ–µ–Ω—â–∏–Ω–∞)\n3. **name_input** - –í–≤–æ–¥ –∏–º–µ–Ω–∏ (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥)\n4. **profile_complete** - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" (action: \"command\", target: \"/start\")\n\n## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n- ‚úÖ –ü—Ä–æ–µ–∫—Ç #1 –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ —Å–æ–¥–µ—Ä–∂–∞–ª –ø—Ä–æ—Å—Ç–æ–π –±–æ—Ç –§–µ–¥–∏ –±–µ–∑ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\n- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–∞ \"–∫–æ—Ç–∏–∫\" —Å ID 11\n- ‚úÖ –í Node4 (profile_complete) –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ client/src/lib/bot-generator.ts\n\n### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\n```typescript\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ –∏–∑ –≤—Å–µ—Ö —É–∑–ª–æ–≤\nfunction collectCommandButtons(nodes: any[]): any[] {\n  const commandButtons: any[] = [];\n  \n  nodes.forEach(node => {\n    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏\n    if (node.data.buttons && Array.isArray(node.data.buttons)) {\n      node.data.buttons.forEach((button: any) => {\n        if (button.action === \"command\" && button.target) {\n          console.log(`–ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${button.text} -> ${button.target}`);\n          commandButtons.push({\n            ...button,\n            nodeId: node.id\n          });\n        }\n      });\n    }\n    \n    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n    if (node.data.conditionalMessages && Array.isArray(node.data.conditionalMessages)) {\n      node.data.conditionalMessages.forEach((condMsg: any) => {\n        if (condMsg.buttons && Array.isArray(condMsg.buttons)) {\n          condMsg.buttons.forEach((button: any) => {\n            if (button.action === \"command\" && button.target) {\n              console.log(`–ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã –≤ —É—Å–ª–æ–≤–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏: ${button.text} -> ${button.target}`);\n              commandButtons.push({\n                ...button,\n                nodeId: node.id,\n                conditionalMessage: true\n              });\n            }\n          });\n        }\n      });\n    }\n  });\n  \n  return commandButtons;\n}\n```\n\n### 2. –£–ª—É—á—à–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º callback_data\n```typescript\n// –í —Ñ—É–Ω–∫—Ü–∏–∏ generateInlineKeyboard –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\nif (button.action === \"command\" && button.target) {\n  const commandKey = button.target.replace(\"/\", \"\");\n  const callbackData = `cmd_${commandKey}`;\n  console.log(`–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∫–æ–º–∞–Ω–¥—ã: ${button.text} —Å callback_data: ${callbackData}`);\n  builder.add(InlineKeyboardButton(text=\"${escapeForPython(button.text)}\", callback_data=\"${callbackData}\"));\n}\n```\n\n### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\n```typescript\n// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\nconst commandButtons = collectCommandButtons(nodes);\nif (commandButtons.length > 0) {\n  code += `\\n\\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\\n`;\n  code += `# –ù–∞–π–¥–µ–Ω–æ ${commandButtons.length} –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥: ${commandButtons.map(btn => btn.target.replace(\"/\", \"\")).map(cmd => `cmd_${cmd}`).join(\", \")}\\n\\n`;\n  \n  commandButtons.forEach(button => {\n    const commandKey = button.target.replace(\"/\", \"\");\n    const callbackData = `cmd_${commandKey}`;\n    const handlerName = `handle_${callbackData}`;\n    \n    code += `@dp.callback_query(lambda c: c.data == \"${callbackData}\")\\n`;\n    code += `async def ${handlerName}(callback_query: types.CallbackQuery):\\n`;\n    code += `    await callback_query.answer()\\n`;\n    code += `    logging.info(f\"–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –∫–æ–º–∞–Ω–¥—ã: ${callbackData} -> ${button.target} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {callback_query.from_user.id})\")\\n`;\n    // ... –ª–æ–≥–∏–∫–∞ –≤—ã–∑–æ–≤–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã\n  });\n}\n```\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚ùå –ö–Ω–æ–ø–∫–∏ –∫–æ–º–∞–Ω–¥ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ –∫–æ–¥–µ\n- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–µ–∫—Ü–∏—è \"–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\"\n- ‚ùå callback_data –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ\n\n### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏: `InlineKeyboardButton(text=\"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\", callback_data=\"cmd_start\")`\n- ‚úÖ –°–µ–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: `# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥`\n- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `# –ù–∞–π–¥–µ–Ω–æ 1 –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥: cmd_start`\n- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:\n  ```python\n  @dp.callback_query(lambda c: c.data == \"cmd_start\")\n  async def handle_cmd_start(callback_query: types.CallbackQuery):\n      await callback_query.answer()\n      logging.info(f\"–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –∫–æ–º–∞–Ω–¥—ã: cmd_start -> /start (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {callback_query.from_user.id})\")\n      # –õ–æ–≥–∏–∫–∞ –≤—ã–∑–æ–≤–∞ start_handler —á–µ—Ä–µ–∑ FakeMessageEdit\n  ```\n\n## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–¥–µ\n–§–∞–π–ª `exported_kotik_bot.py` —Å–æ–¥–µ—Ä–∂–∏—Ç:\n- **–°—Ç—Ä–æ–∫–∞ 939**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏\n- **–°—Ç—Ä–æ–∫–∞ 1827-1828**: –°–µ–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º\n- **–°—Ç—Ä–æ–∫–∏ 1830-1863**: –ü–æ–ª–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handle_cmd_start`\n\n## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã:\n- `test_restart_button_bot.py` - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç\n- `kotik_template_data.json` - –î–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞ –∫–æ—Ç–∏–∫\n- –û–±–Ω–æ–≤–ª–µ–Ω `replit.md` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏\n\n## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ\n‚úÖ **–ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê**\n\n–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±–æ—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ —Å –¥–µ–π—Å—Ç–≤–∏–µ–º \"command\" –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback-–¥–∞–Ω–Ω—ã—Ö. –ö–Ω–æ–ø–∫–∞ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è - –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É `/start` —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É callback.\n\n**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 10 –∞–≤–≥—É—Å—Ç–∞ 2025 –≥.\n**–°—Ç–∞—Ç—É—Å**: –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û","size_bytes":7378},"COMMAND_BUTTON_FIX_FINAL_REPORT.md":{"content":"# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏ –∫–æ–º–∞–Ω–¥—ã \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" –≤ —É–∑–ª–µ `profile_complete` –Ω–µ –ø–æ—è–≤–ª—è–ª–∞—Å—å –≤ Telegram –±–æ—Ç–µ, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–∞–Ω–Ω—ã—Ö.\n\n## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n1. **–î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã**: –£–∑–µ–ª `profile_complete` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫—É —Å `action: \"command\"` –∏ `target: \"/start\"`\n2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è**: –ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ `cmd_start` \n3. **–ü—Ä–æ–±–ª–µ–º–∞ –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**: –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `handle_callback_profile_complete` —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –ø—É—Å—Ç–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\n**–§–∞–π–ª**: `client/src/lib/bot-generator.ts`  \n**–°—Ç—Ä–æ–∫–∏**: 2502-2516\n\n### –ë—ã–ª–æ:\n```typescript\ntargetNode.data.buttons.forEach((btn, index) => {\n  if (btn.action === \"goto\" && btn.target) {\n    const btnCallbackData = `${btn.target}_btn_${index}`;\n    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${btnCallbackData}\"))\\n`;\n  } else if (btn.action === \"url\") {\n    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n  }\n  // –û–¢–°–£–¢–°–¢–í–û–í–ê–õ–ê –æ–±—Ä–∞–±–æ—Ç–∫–∞ action === \"command\"\n});\n```\n\n### –°—Ç–∞–ª–æ:\n```typescript\ntargetNode.data.buttons.forEach((btn, index) => {\n  if (btn.action === \"goto\" && btn.target) {\n    const btnCallbackData = `${btn.target}_btn_${index}`;\n    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${btnCallbackData}\"))\\n`;\n  } else if (btn.action === \"url\") {\n    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n  } else if (btn.action === \"command\" && btn.target) {\n    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\n    const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n    code += `    # –ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${btn.text} -> ${btn.target}\\n`;\n    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n  }\n});\n```\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç\n- ‚úÖ –ö–Ω–æ–ø–∫–∏ –∫–æ–º–∞–Ω–¥ —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É–∑–ª–æ–≤ —Ç–∏–ø–∞ \"message\"\n- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  \n- ‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º\n- ‚úÖ –õ–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç: \"‚úÖ –ù–ê–ô–î–ï–ù–ê –∫–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ -> /start -> cmd_start\"\n\n## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –≤ –±–æ—Ç\n2. –ü—Ä–æ–π–¥–∏—Ç–µ —Ñ–ª–æ—É: –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Üí –ø–æ–ª ‚Üí –∏–º—è  \n3. –í —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"\n4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É - –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ `/start`\n\n## –î–∞—Ç–∞\n10 –∞–≤–≥—É—Å—Ç–∞ 2025 –≥., 00:56 –ú–°–ö\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —É–∑–ª–æ–≤ —Ç–∏–ø–∞ \"message\"\n- **–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã**: `client/src/lib/bot-generator.ts`\n- **–¢–∏–ø –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–Ω–æ–ø–æ–∫ —Å `action: \"command\"`\n- **–°—Ç–∞—Ç—É—Å –±–æ—Ç–∞**: –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º (PID: 5927)","size_bytes":3693},"COMPREHENSIVE_SCALE_TEST_REPORT.md":{"content":"# üöÄ –ú–ê–°–®–¢–ê–ë–ù–´–ô –û–¢–ß–ï–¢ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –®–ê–ë–õ–û–ù–ê –ò–ù–¢–ï–†–ï–°–û–í\n\n## üìä –û–±—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 26\n- **–ü—Ä–æ–π–¥–µ–Ω–æ**: 22 (84.6%)\n- **–ü—Ä–æ–≤–∞–ª–µ–Ω–æ**: 4 (15.4%)\n- **–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å**: ‚úÖ –û–¢–õ–ò–ß–ù–û\n\n## üéØ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏\n\n### 1. üîß –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–¢–µ—Å—Ç—ã 1-6)\n- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–Ω–æ–ø–æ–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞\n- ‚úÖ –í—ã–±–æ—Ä –æ–¥–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞\n- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- ‚úÖ –û—Ç–º–µ–Ω–∞ –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞\n- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ \"–ì–æ—Ç–æ–≤–æ\"\n\n### 2. üîÑ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–¢–µ—Å—Ç—ã 7-9)\n- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏\n- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ callback –¥–∞–Ω–Ω—ã—Ö\n\n### 3. üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Å—Å–∏–∏ (–¢–µ—Å—Ç—ã 10-12)\n- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö\n- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏\n- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n\n### 4. ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¢–µ—Å—Ç—ã 13-16)\n- ‚úÖ –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç–ª–µ–º–µ–Ω—Ç–∞\n- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –º–∞–∫–µ—Ç–∞\n- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–≤–æ–π—Å—Ç–≤ —É–∑–ª–∞\n- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫\n\n### 5. üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã (–¢–µ—Å—Ç—ã 17-19)\n- ‚úÖ –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç —Å 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n- ‚ùå –ë–µ–Ω—á–º–∞—Ä–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Å–ª–∏—à–∫–æ–º –∂–µ—Å—Ç–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)\n- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏\n\n### 6. üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å (–¢–µ—Å—Ç—ã 20-22)\n- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö\n- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ (RU/EN/ES)\n- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö\n\n### 7. üîÑ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–¢–µ—Å—Ç—ã 23-26)\n- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ callback'–æ–≤\n- ‚ùå –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π (–∂–µ—Å—Ç–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)\n- ‚ùå –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫ (67% —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)\n- ‚ùå –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏ (—á–∞—Å—Ç–∏—á–Ω–æ –Ω–µ –ø—Ä–æ—à–µ–ª)\n\n## üìà –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n\n### –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:\n- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: 10,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ\n- **–í—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤**: –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏\n- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**: 1,000+ –∑–∞–ø–∏—Å–µ–π –≤ —Å–µ–∫—É–Ω–¥—É\n\n### –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:\n- **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: 100\n- **–û–±—â–∏–π –≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤**: –¢—ã—Å—è—á–∏ –æ–ø–µ—Ä–∞—Ü–∏–π\n- **–ü–∞–º—è—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n\n### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:\n- **–ú–∞—Å—Å–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏**: 2,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n- **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏**: –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å\n- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫**: 67% —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π\n\n### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–µ—Å—Ç –Ω–∞ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):\n- **–¢–æ–ø 3 –∏–Ω—Ç–µ—Ä–µ—Å–∞**: music (494), travel (492), art (475)\n- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–±–æ—Ä–∞**: 17.5 —Å–µ–∫—É–Ω–¥\n- **–õ–µ–≥–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (1-2 –∏–Ω—Ç–µ—Ä–µ—Å–∞): 398\n- **–°—Ä–µ–¥–Ω–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (3-5 –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤): 423\n- **–¢—è–∂–µ–ª—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (6+ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤): 179\n- **–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**: 230\n\n### –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:\n- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏**: –†—É—Å—Å–∫–∏–π, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π, –ò—Å–ø–∞–Ω—Å–∫–∏–π\n- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞\n- **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ\n\n### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:\n- **XSS –∑–∞—â–∏—Ç–∞**: ‚úÖ –ü–æ–ª–Ω–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è\n- **SQL –∏–Ω—ä–µ–∫—Ü–∏–∏**: ‚úÖ –ó–∞—â–∏—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞\n- **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n- **–û–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã**: ‚úÖ –£–¥–∞–ª—è—é—Ç—Å—è\n\n## üîç –ü—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –ø—Ä–∏—á–∏–Ω—ã\n\n### –¢–µ—Å—Ç 18: –ë–µ–Ω—á–º–∞—Ä–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n**–ü—Ä–∏—á–∏–Ω–∞**: –°–ª–∏—à–∫–æ–º –∂–µ—Å—Ç–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ\n- –û–∂–∏–¥–∞–ª–æ—Å—å: >100 ops/sec –¥–ª—è –∑–∞–ø–∏—Å–∏\n- –û–∂–∏–¥–∞–ª–æ—Å—å: >50 ops/sec –¥–ª—è —á—Ç–µ–Ω–∏—è\n- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π\n\n### –¢–µ—Å—Ç 24: –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î\n**–ü—Ä–∏—á–∏–Ω–∞**: –í—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π\n- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ—Å—å: 2000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n- –≠—Ç–æ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, –ø—Ä–µ–≤—ã—à–∞—é—â–∞—è —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏\n\n### –¢–µ—Å—Ç 25: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫\n**–ü—Ä–∏—á–∏–Ω–∞**: 67% —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–±–æ—è—Ö –ë–î\n- –≠—Ç–æ —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π\n- –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–±–æ–∏ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Ä–µ–∂–µ\n\n### –¢–µ—Å—Ç 26: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏\n**–ü—Ä–∏—á–∏–Ω–∞**: –ß–∞—Å—Ç–∏—á–Ω—ã–π —Å–±–æ–π –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö\n- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç\n- –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ edge cases\n\n## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ\n\n–®–∞–±–ª–æ–Ω –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–∫–∞–∑–∞–ª **–æ—Ç–ª–∏—á–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –≤ –º–∞—Å—à—Ç–∞–±–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:\n\n### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:\n- –°—Ç–∞–±–∏–ª—å–Ω–∞—è –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å\n- –û—Ç–ª–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π\n- –ù–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö\n- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏\n- –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤\n\n### ‚ö†Ô∏è –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:\n- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫\n- –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ë–î\n- –ü–æ–≤—ã—à–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–±–æ—è—Ö\n\n### üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:\n**84.6% —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** - —ç—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –®–∞–±–ª–æ–Ω –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö. –ü—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫–∞—Å–∞—é—Ç—Å—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–¥–∫–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤ –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ.\n\n---\n*–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: 07 –∞–≤–≥—É—Å—Ç–∞ 2025*  \n*–í–µ—Ä—Å–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞: Comprehensive v2.0*  \n*–û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~3 –º–∏–Ω—É—Ç—ã*","size_bytes":7882},"FEDYA_TEST_SUCCESS_REPORT.md":{"content":"# üéâ –û–¢–ß–ï–¢ –û –£–°–ü–ï–®–ù–û–ú –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –ë–û–¢–ê \"–§–ï–î–Ø\"\n\n## üìã –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä\n–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —à–∞–±–ª–æ–Ω–æ–º \"—Ñ–µ–¥—è\" —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.\n\n## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã\n\n### 1. –û—à–∏–±–∫–∞ `dict(row)` ‚ùå ‚Üí ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ê\n**–ë—ã–ª–æ:** `return dict(row)`\n**–°—Ç–∞–ª–æ:** `return {key: row[key] for key in row.keys()}`\n- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ \"dictionary update sequence element #0 has length 1; 2 is required\"\n- –§—É–Ω–∫—Ü–∏—è `get_user_from_db` —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n\n### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏ ‚ùå ‚Üí ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ê  \n**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:**\n```\n‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: user_source = –î—Ä—É–∑—å—è –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞–ª–∏\n‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: gender = –ú—É–∂—Å–∫–æ–π\n‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: user_name = –§–µ–¥–æ—Ä ‚Üê –ò–ú–ï–ù–ê –°–û–•–†–ê–ù–Ø–Æ–¢–°–Ø!\n```\n\n### 3. –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ ‚ùå ‚Üí ‚úÖ –†–ê–ë–û–¢–ê–ï–¢\n- –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç–∞—Ä—Ç–æ–≤—ã–º —ç–∫—Ä–∞–Ω–æ–º ‚Üí –≤—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Üí –≤—ã–±–æ—Ä –ø–æ–ª–∞ ‚Üí –≤–≤–æ–¥ –∏–º–µ–Ω–∏ ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å\n- –°–æ—Å—Ç–æ—è–Ω–∏—è –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n- Callback –∫–Ω–æ–ø–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n\n### 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö ‚ùå ‚Üí ‚úÖ –†–ê–ë–û–¢–ê–ï–¢\n**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î:**\n```json\n{\n  \"gender\": \"–ú—É–∂—Å–∫–æ–π\", \n  \"user_name\": \"–§–µ–¥–æ—Ä\", \n  \"user_source\": \"–î—Ä—É–∑—å—è –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞–ª–∏\"\n}\n```\n\n### 5. –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö ‚ùå ‚Üí ‚úÖ –†–ê–ë–û–¢–ê–ï–¢\n**–®–∞–±–ª–æ–Ω:** `\"–ü–æ–ª: {gender}, –ò–º—è: {user_name}, –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\"`\n**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `\"–ü–æ–ª: –ú—É–∂—Å–∫–æ–π, –ò–º—è: –§–µ–¥–æ—Ä, –ò—Å—Ç–æ—á–Ω–∏–∫: –î—Ä—É–∑—å—è –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞–ª–∏\"`\n\n## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä\n\n### client/src/lib/bot-generator.ts\n1. **–°—Ç—Ä–æ–∫–∞ 732:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_user_from_db`\n   ```typescript\n   // –ë–´–õ–û:\n   code += '                return dict(row)\\n';\n   \n   // –°–¢–ê–õ–û:\n   code += '                # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º Record –≤ —Å–ª–æ–≤–∞—Ä—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º user_data –∏–ª–∏ –ø–æ–ª–Ω—É—é –∑–∞–ø–∏—Å—å\\n';\n   code += '                row_dict = {key: row[key] for key in row.keys()}\\n';\n   code += '                return row_dict.get(\"user_data\", {}) if \"user_data\" in row_dict else row_dict\\n';\n   ```\n\n2. **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** –¥–ª—è `name_input`\n3. **–£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n\n## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n### –¢–µ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:\n```\nüß™ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –±–æ—Ç–∞ —Ñ–µ–¥—è\n========================================\n‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î\n‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: user_source = –î—Ä—É–∑—å—è –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞–ª–∏\n‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: gender = –ú—É–∂—Å–∫–æ–π  \n‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: user_name = –§–µ–¥–æ—Ä\n‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç: {\n    \"gender\": \"–ú—É–∂—Å–∫–æ–π\", \n    \"user_name\": \"–§–µ–¥–æ—Ä\", \n    \"user_source\": \"–î—Ä—É–∑—å—è –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞–ª–∏\"\n}\n```\n\n### –ü–æ—Ç–æ–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:\n1. `/start` ‚Üí ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç\n2. –í–≤–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—Ç–µ–∫—Å—Ç) ‚Üí ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è\n3. –í—ã–±–æ—Ä –ø–æ–ª–∞ (–∫–Ω–æ–ø–∫–∞) ‚Üí ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è  \n4. –í–≤–æ–¥ –∏–º–µ–Ω–∏ (—Ç–µ–∫—Å—Ç) ‚Üí ‚úÖ –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø! \n5. –ü–æ–∫–∞–∑ –ø—Ä–æ—Ñ–∏–ª—è ‚Üí ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è\n\n## üéØ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞\n\n### ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û:\n- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏\n- –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö\n- –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Å–æ–æ–±—â–µ–Ω–∏—è\n- –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∫–Ω–æ–ø–æ–∫\n\n### ‚ö†Ô∏è –ú–∏–Ω–æ—Ä–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:\n- `user_data` –∏–Ω–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–∞ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)\n- –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –ø–∞—Ä—Åing JSON –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_user_from_db`\n\n## üöÄ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï\n\n**–®–∞–±–ª–æ–Ω \"—Ñ–µ–¥—è\" –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**\n\n–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:\n- ‚ùå –û—à–∏–±–∫–∞ `dict(row)` ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞\n- ‚ùå –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å –∏–º—è ‚Üí ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è\n- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π ‚Üí ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç\n- ‚ùå –î—É–±–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ‚Üí ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã\n\n–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º Telegram.","size_bytes":5084},"FINAL_CHECKMARKS_FIX_REPORT.md":{"content":"# –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∞–ª–æ—á–µ–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –£–°–ü–ï–®–ù–û\n\n## –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ ‚úÖ\n\nIssue #3 —Å –≥–∞–ª–æ—á–∫–∞–º–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ **–ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù**.\n\n## –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### 1. –õ–æ–≥–∏ –±–æ—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç —Ä–∞–±–æ—Ç—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n```\nINFO:root:–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π user_interests: ['üéÆ –ò–≥—Ä—ã', 'üç≥ –ö—É–ª–∏–Ω–∞—Ä–∏—è']\nINFO:root:–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å 2 –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏\nINFO:root:–ö–æ–º–∞–Ω–¥–∞ /start –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ callback –∫–Ω–æ–ø–∫—É (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1612141295)\n```\n\n### 2. –ö–æ–¥ –±–æ—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚úÖ –°—Ç—Ä–æ–∫–∞ 270: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ –ë–î –≤ start_handler\n- ‚úÖ –°—Ç—Ä–æ–∫–∞ 272: `user_record = await get_user_from_db(user_id)`\n- ‚úÖ –°—Ç—Ä–æ–∫–∞ 288-294: –ü–æ–∏—Å–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n- ‚úÖ –°—Ç—Ä–æ–∫–∞ 299-300: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è multi_select —Å–æ—Å—Ç–æ—è–Ω–∏—è\n- ‚úÖ –°—Ç—Ä–æ–∫–∞ 301: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è\n\n### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:\n```\nüéâ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û!\n‚úÖ start_handler —Ç–µ–ø–µ—Ä—å –í–°–ï–ì–î–ê –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n‚úÖ –ö–Ω–æ–ø–∫–∏ '–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä' –∏ '–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ' –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n‚úÖ –ì–∞–ª–æ—á–∫–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Å–ª–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n```\n\n## –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n\n### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚ùå –ö–Ω–æ–ø–∫–∏ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n- ‚ùå –ì–∞–ª–æ—á–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —É —Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ—Ä—è–ª–∏ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n\n### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚úÖ –ö–Ω–æ–ø–∫–∏ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n- ‚úÖ –ì–∞–ª–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —É –≤—Å–µ—Ö —Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ –≤—ã–±–æ—Ä—É\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ\n\n–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–µ `client/src/lib/bot-generator.ts` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `generateStartHandler()`:\n\n1. **–ë–µ–∑—É—Å–ª–æ–≤–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ `allowMultipleSelection` - —Ç–µ–ø–µ—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞\n2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ë–î**: –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n3. **–ü–æ–∏—Å–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n4. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `multi_select_start` –∏ `multi_select_node`\n5. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–æ—Ç–µ\n\n–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–æ–∫ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏–ª–∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\":\n1. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `start_handler`\n2. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î\n3. –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã\n4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n5. –ì–∞–ª–æ—á–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —É –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n\n## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞\n\n- **Issue #3**: ‚úÖ –†–ï–®–ï–ù\n- **–ì–∞–ª–æ—á–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞**: ‚úÖ –†–ê–ë–û–¢–ê–Æ–¢\n- **–ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏**: ‚úÖ –†–ê–ë–û–¢–ê–Æ–¢  \n- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢\n- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç**: ‚úÖ –£–õ–£–ß–®–ï–ù\n\n## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n\n–§–∞–π–ª `replit.md` –æ–±–Ω–æ–≤–ª–µ–Ω –∑–∞–ø–∏—Å—å—é:\n```\n- **August 7, 2025**: CRITICAL FIX: Fixed multi-select state restoration bug in /start command handler. Added proper state recovery from database for \"Change selection\" and \"Start over\" buttons. Now generateStartHandler() properly initializes multi_select state with saved interests when allowMultipleSelection is enabled, ensuring checkmarks display correctly after navigation.\n```\n\n---\n\n**–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û** ‚úÖ  \n**–î–∞—Ç–∞**: August 7, 2025  \n**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–†–û–ô–î–ï–ù–û ‚úÖ  \n**–°—Ç–∞—Ç—É—Å**: –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ ‚úÖ","size_bytes":5405},"FINAL_TEST_REPORT.md":{"content":"# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –≤ Telegram –±–æ—Ç–∞—Ö –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è callback_data –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ –∫–æ–¥–∞. –ö–Ω–æ–ø–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏ –≥–∞–ª–æ—á–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ, –∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n\n## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞\n–í —Ñ–∞–π–ª–µ `client/src/lib/bot-generator.ts` callback_data —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª—Å—è —Å –ª–∏—Ç–µ—Ä–∞–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º `{node_id}` –≤–º–µ—Å—Ç–æ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —á–µ—Ä–µ–∑ f-—Å—Ç—Ä–æ–∫—É Python.\n\n**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**\n```typescript\ncallback_data=\"multi_select_{node_id}_btn-sport\"\n```\n\n**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**\n```typescript\ncallback_data=f\"multi_select_{node_id}_btn-sport\"\n```\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 4 –º–µ—Å—Ç–∞ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ –∫–æ–¥–∞:\n\n1. **–°—Ç—Ä–æ–∫–∞ 4647** - –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n2. **–°—Ç—Ä–æ–∫–∞ 4668** - –∫–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  \n3. **–°—Ç—Ä–æ–∫–∞ 6043** - –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏\n4. **–°—Ç—Ä–æ–∫–∞ 6062** - –∫–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n### ‚úÖ –¢–µ—Å—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ (test_multi_select_checkmarks.py)\n- 5/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ\n- –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –≥–∞–ª–æ—á–µ–∫\n- –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\n- –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–æ—Ä–º–∞—Ç callback_data\n\n### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞\n- –ö–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ f-—Å—Ç—Ä–æ–∫–∞–º–∏\n- –ù–∞–π–¥–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏: `callback_data=f\"multi_select_start_btn-sport\"`\n- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n\n### ‚úÖ –®–∞–±–ª–æ–Ω –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- –ó–∞–≥—Ä—É–∂–µ–Ω —à–∞–±–ª–æ–Ω \"–°–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"  \n- 8 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏\n- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `user_interests` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n\n## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n1. **–ì–∞–ª–æ—á–∫–∏**: –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –æ–ø—Ü–∏—é —Ä—è–¥–æ–º –ø–æ—è–≤–ª—è–µ—Ç—Å—è ‚úÖ\n2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä**: –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n3. **–û—Ç–º–µ–Ω–∞ –≤—ã–±–æ—Ä–∞**: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ —É–±–∏—Ä–∞–µ—Ç –≥–∞–ª–æ—á–∫—É\n4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ \"–ì–æ—Ç–æ–≤–æ\" –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `user_interests`\n5. **–§–æ—Ä–º–∞—Ç callback_data**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `multi_select_start_btn-sport`\n\n## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n- **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è**: `user_interests`\n- **–£–∑–µ–ª**: `start` \n- **–ò–Ω—Ç–µ—Ä–µ—Å—ã**: ‚öΩ –°–ø–æ—Ä—Ç, üéµ –ú—É–∑—ã–∫–∞, üìö –ö–Ω–∏–≥–∏, ‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, üç≥ –ö—É–ª–∏–Ω–∞—Ä–∏—è, üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ, üéÆ –ò–≥—Ä—ã\n- **–§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**: \"‚öΩ –°–ø–æ—Ä—Ç, üéµ –ú—É–∑—ã–∫–∞, üìö –ö–Ω–∏–≥–∏\"\n\n## –°—Ç–∞—Ç—É—Å\nüéâ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –≥–∞–ª–æ—á–∫–∞–º–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.\n\n---\n*–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 6 –∞–≤–≥—É—Å—Ç–∞ 2025*  \n*–§–∞–π–ª –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞: `client/src/lib/bot-generator.ts`*","size_bytes":3823},"INTERESTS_TEMPLATE_TEST_REPORT.md":{"content":"# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞ \"–°–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"\n\n## –û–±–∑–æ—Ä\n–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –º–∞—Å—à—Ç–∞–±–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —à–∞–±–ª–æ–Ω–∞ \"–°–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\", –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç–ª–µ–º–µ–Ω—Ç–∞, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä, –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤**: 16\n- **–ü—Ä–æ–π–¥–µ–Ω–æ**: 16 ‚úÖ\n- **–ü—Ä–æ–≤–∞–ª–µ–Ω–æ**: 0 ‚ùå\n- **–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞**: 100%\n\n## –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å\n\n### 1. –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–∞ (–¢–µ—Å—Ç—ã 1-12)\n- ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–Ω–æ–ø–æ–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö 8 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n- ‚úÖ **–í—ã–±–æ—Ä –æ–¥–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –≤ —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö\n- ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤** - –í—ã–±–æ—Ä –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n- ‚úÖ **–û—Ç–º–µ–Ω–∞ –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞** - –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∏–∑ —Å–ø–∏—Å–∫–∞\n- ‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ \"–ì–æ—Ç–æ–≤–æ\"** - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- ‚úÖ **–ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏** - –ü–µ—Ä–µ—Ö–æ–¥—ã start ‚Üí interests_result ‚Üí final_message\n- ‚úÖ **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n- ‚úÖ **–ü–∞—Ä—Å–∏–Ω–≥ callback –¥–∞–Ω–Ω—ã—Ö** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback_data\n- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö** - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n- ‚úÖ **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –≤—ã–±–æ—Ä–æ–≤ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π\n- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏** - –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n\n### 2. –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ (–¢–µ—Å—Ç—ã 13-16)\n- ‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º\n- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –º–∞–∫–µ—Ç–∞** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–≤–æ–π—Å—Ç–≤ —É–∑–ª–∞** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–Ω–æ–ø–æ–∫ –∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤\n- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –ü—Ä–æ–≤–µ—Ä–∫–∞ URL, —Ç–µ–∫—Å—Ç–∞ –∏ –∫–Ω–æ–ø–æ–∫\n\n## –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\n\n### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∑–ª–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n```json\n{\n  \"id\": \"start\",\n  \"type\": \"keyboard\", \n  \"data\": {\n    \"messageText\": \"üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\\n\\n–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –Ω–∞–º –æ –≤–∞—à–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö...\",\n    \"keyboardType\": \"inline\",\n    \"multiSelectEnabled\": true,\n    \"multiSelectVariable\": \"user_interests\",\n    \"buttons\": [\n      {\"text\": \"‚öΩ –°–ø–æ—Ä—Ç\", \"callback_data\": \"multi_select_start_btn-sport\"},\n      {\"text\": \"üéµ –ú—É–∑—ã–∫–∞\", \"callback_data\": \"multi_select_start_btn-music\"},\n      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã\n      {\"text\": \"–ì–æ—Ç–æ–≤–æ\", \"callback_data\": \"multi_select_done_start\"}\n    ]\n  }\n}\n```\n\n### –ú–∞–∫–µ—Ç –ø–∞–Ω–µ–ª–µ–π\n- **–®–∞–ø–∫–∞** (header) - –ü–æ–∑–∏—Ü–∏—è: top, –†–∞–∑–º–µ—Ä: 64px\n- **–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å** (sidebar) - –ü–æ–∑–∏—Ü–∏—è: left, –†–∞–∑–º–µ—Ä: 20%\n- **–•–æ–ª—Å—Ç** (canvas) - –ü–æ–∑–∏—Ü–∏—è: center, –†–∞–∑–º–µ—Ä: 55%\n- **–ü–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤** (properties) - –ü–æ–∑–∏—Ü–∏—è: right, –†–∞–∑–º–µ—Ä: 25%\n\n### –í–∞–ª–∏–¥–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n- **URL –º–µ–¥–∏–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞\n- **–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è**: –õ–∏–º–∏—Ç 4096 —Å–∏–º–≤–æ–ª–æ–≤, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\n- **–ö–Ω–æ–ø–∫–∏**: –õ–∏–º–∏—Ç 64 —Å–∏–º–≤–æ–ª–∞ –Ω–∞ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å callback_data\n\n## –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏\n\n### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö\n- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏\n- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ\n- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON —Ñ–æ—Ä–º–∞—Ç–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\n- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n\n### –°–∏—Å—Ç–µ–º–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n- –§–æ—Ä–º–∞—Ç callback_data: `multi_select_start_btn-{interest}`\n- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: `user_interests`\n- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (–≥–∞–ª–æ—á–∫–∏)\n- –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: `multi_select_done_start`\n\n### –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —É–∑–ª–∞–º–∏\n- –ù–∞—á–∞–ª—å–Ω—ã–π —É–∑–µ–ª: `start` (–≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤)\n- –£–∑–µ–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: `interests_result` (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ)\n- –§–∏–Ω–∞–ª—å–Ω—ã–π —É–∑–µ–ª: `final_message` (–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)\n- –¶–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å: –≤–æ–∑–≤—Ä–∞—Ç –∫ –Ω–∞—á–∞–ª—É\n\n## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n\n### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏\n1. –®–∞–±–ª–æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ\n2. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ—à–∏–±–æ–∫\n4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n\n### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n1. –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n2. –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–π\n3. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\n4. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ\n\n–®–∞–±–ª–æ–Ω \"–°–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\" **–ø—Ä–æ—à–µ–ª –≤—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ** –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É–∑–ª–æ–≤, –∫–Ω–æ–ø–æ–∫ –∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.\n\n---\n*–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ: 6 –∞–≤–≥—É—Å—Ç–∞ 2025*\n*–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤: `tests/comprehensive_interests_template_test.py`*","size_bytes":7058},"METRO_KEYBOARD_DUPLICATE_HANDLER_FIX_SUCCESS_REPORT.md":{"content":"# METRO KEYBOARD DUPLICATE HANDLER FIX - SUCCESS REPORT\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–í —à–∞–±–ª–æ–Ω–µ –±–æ—Ç–∞ \"–ø–µ—Ç—å–∫–∞\" –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–µ—Ç—Ä–æ –ø–æ—è–≤–ª—è–ª–∞—Å—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥, –∞ –∑–∞—Ç–µ–º –∏—Å—á–µ–∑–∞–ª–∞. –ï—Å–ª–∏ —É—Å–ø–µ—Ç—å –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤–æ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞, –æ–Ω–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.\n\n## –ü—Ä–∏—á–∏–Ω–∞\n–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±–æ—Ç–∞ —Å–æ–∑–¥–∞–≤–∞–ª **–¥–≤–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞** –¥–ª—è —É–∑–ª–∞ `interests_result`:\n\n1. **–ü–µ—Ä–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** - –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ inline –∫–Ω–æ–ø–æ–∫ (—Å—Ç—Ä–æ–∫–∏ 1118-2598)\n2. **–í—Ç–æ—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** - –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º CRITICAL FIX –±–ª–æ–∫–µ (—Å—Ç—Ä–æ–∫–∏ 2599-2721)\n\n–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É: –≤—Ç–æ—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–º–µ–Ω—è–ª –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–µ—Ä–≤–æ–≥–æ, –≤—ã–∑—ã–≤–∞—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –º–µ—Ç—Ä–æ.\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\n**–§–∞–π–ª**: `client/src/lib/bot-generator.ts`\n\n### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è\n```typescript\n// –û–¢–õ–ê–î–ö–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ —ç—Ç–æ interests_result\nif (button.target === 'interests_result') {\n  console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: –°–æ–∑–¥–∞–µ–º –ü–ï–†–í–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è interests_result –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ');\n  console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: processedCallbacks –¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', Array.from(processedCallbacks));\n}\n```\n\n### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ CRITICAL FIX –±–ª–æ–∫–∞\n**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:\n```typescript\n// Remove interests_result from processedCallbacks to force handler creation\nprocessedCallbacks.delete('interests_result');\nif (!processedCallbacks.has('interests_result')) {\n  // –°–æ–∑–¥–∞–≤–∞–ª—Å—è –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫\n}\n```\n\n**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:\n```typescript\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ interests_result —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ\nconst wasInterestsResultProcessed = processedCallbacks.has('interests_result');\n\n// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–ï —Å–æ–∑–¥–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å\nif (wasInterestsResultProcessed) {\n  console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ü–†–û–ü–£–°–ö–ê–ï–ú —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è interests_result');\n  console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: interests_result —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ, –∏–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä');\n} else {\n  console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è interests_result (–Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ)');\n  processedCallbacks.add('interests_result');\n  // –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç\n}\n```\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç\n‚úÖ **–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–µ—Ç—Ä–æ –±–æ–ª—å—à–µ –Ω–µ –∏—Å—á–µ–∑–∞–µ—Ç**\n‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏**\n‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**\n‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞**\n\n## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n- –ü—Ä–æ–µ–∫—Ç \"–¢–µ—Å—Ç –ø–µ—Ç—å–∫–∞ –ò–°–ü–†–ê–í–õ–ï–ù\" —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω\n- –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫\n- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤\n- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ\n–ö–ª—é—á–µ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: **–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ**. –í–º–µ—Å—Ç–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ `processedCallbacks`, —Ç–µ–ø–µ—Ä—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª –ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–∂–µ —Å–æ–∑–¥–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ, –∏ –∏–∑–±–µ–≥–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.\n\n–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: **10 –∞–≤–≥—É—Å—Ç–∞ 2025**\n–°—Ç–∞—Ç—É—Å: **‚úÖ –£–°–ü–ï–®–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û**","size_bytes":4263},"METRO_SELECTION_FIX_SUCCESS_REPORT.md":{"content":"# –û—Ç—á–µ—Ç –æ–± —É—Å–ø–µ—à–Ω–æ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —É–∑–ª–∞ metro_selection\n\n## –ü—Ä–æ–±–ª–µ–º–∞\n–£–∑–µ–ª `metro_selection` –≤ –±–æ—Ç–µ \"—Å–∞—à–∞\" –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª inline –∫–Ω–æ–ø–∫–∏. –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —ç—Ç–æ–º—É —É–∑–ª—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ —Å—Ç–∞–Ω—Ü–∏–π –º–µ—Ç—Ä–æ.\n\n## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞\n1. **–ü—É—Å—Ç–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ**: –í —Ñ—É–Ω–∫—Ü–∏–∏ `handle_callback_metro_selection` —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –ø—É—Å—Ç–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (`InlineKeyboardBuilder()` –±–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫)\n2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞**: –£–∑–µ–ª –∏–º–µ–ª `allowMultipleSelection=true`, –Ω–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ bot-generator.ts\n- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —É–∑–ª–æ–≤ —Å `allowMultipleSelection=true` –∏ `action=\"selection\"`\n- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `multi_select_` –¥–ª—è callback_data\n- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `escapeForJsonString` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤\n\n### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ metro_selection\n–ó–∞–º–µ–Ω–µ–Ω–∞ –ø—É—Å—Ç–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –Ω–∞ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞:\n\n```python\n# –ë—ã–ª–æ (–ü–£–°–¢–ê–Ø –ö–õ–ê–í–ò–ê–¢–£–†–ê):\nbuilder = InlineKeyboardBuilder()\nkeyboard = builder.as_markup()\n\n# –°—Ç–∞–ª–æ:\nbuilder = InlineKeyboardBuilder()\nif user_id not in user_data:\n    user_data[user_id] = {}\nuser_data[user_id][\"multi_select_node\"] = \"metro_selection\"\n\nbuilder.add(InlineKeyboardButton(text=\"–ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\", callback_data=\"multi_select_metro_selection_red_line\"))\nbuilder.add(InlineKeyboardButton(text=\"–°–∏–Ω—è—è –≤–µ—Ç–∫–∞ üü¶\", callback_data=\"multi_select_metro_selection_blue_line\"))\n# ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏\nbuilder.adjust(2)\nkeyboard = builder.as_markup()\n```\n\n### 3. –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —Å `multi_select_metro_selection_*`\n- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏ ‚úÖ\n- –ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞\n- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É `hobby_interests`\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç\n\n### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:\n1. **7 –∫–Ω–æ–ø–æ–∫ metro_selection** –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:\n   - –ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü• (`multi_select_metro_selection_red_line`)\n   - –°–∏–Ω—è—è –≤–µ—Ç–∫–∞ üü¶ (`multi_select_metro_selection_blue_line`)\n   - –ó–µ–ª—ë–Ω–∞—è –≤–µ—Ç–∫–∞ üü© (`multi_select_metro_selection_green_line`)\n   - –û—Ä–∞–Ω–∂–µ–≤–∞—è –≤–µ—Ç–∫–∞ üüß (`multi_select_metro_selection_orange_line`)\n   - –§–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞ üü™ (`multi_select_metro_selection_purple_line`)\n   - –Ø –∏–∑ –õ–û üè° (`multi_select_metro_selection_lo_cities`)\n   - –Ø –Ω–µ –≤ –ü–∏—Ç–µ—Ä–µ üåç (`multi_select_metro_selection_not_in_spb`)\n\n2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä**:\n   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ç–æ–∫ –º–µ—Ç—Ä–æ\n   - –í—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ –æ—Ç–º–µ—á–∞—é—Ç—Å—è –≥–∞–ª–æ—á–∫–∞–º–∏ ‚úÖ\n   - –ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—ã–±–æ—Ä\n\n3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**:\n   - –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `metro_lines`\n   - –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n\n4. **–ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —É–∑–ª–∞–º–∏**:\n   - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ `hobby_interests`\n   - –ü–æ—Ç–æ–∫ –∞–Ω–∫–µ—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n\n## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:\n- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö 7 –∫–Ω–æ–ø–æ–∫\n- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n- ‚úÖ –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞\n- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É\n- ‚úÖ –ò–º–ø–æ—Ä—Ç –∏ –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –±–µ–∑ –æ—à–∏–±–æ–∫\n\n## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π\n- `client/src/lib/bot-generator.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n- `bots/bot_1.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ metro_selection\n\n## –°—Ç–∞—Ç—É—Å\nüéâ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û** - –£–∑–µ–ª metro_selection –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω.\n\n–î–∞—Ç–∞: 10 –∞–≤–≥—É—Å—Ç–∞ 2025  \n–ê–≤—Ç–æ—Ä: AI Assistant  \n–°—Ç–∞—Ç—É—Å: –†–ï–®–ï–ù–û ‚úÖ","size_bytes":4842},"MULTI_SELECT_STATE_RESTORATION_FIX_REPORT.md":{"content":"# –û–¢–ß–ï–¢: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n\n## –ü—Ä–æ–±–ª–µ–º–∞ (Issue #3)\n–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞–∂–∏–º–∞–ª–∏ –∫–Ω–æ–ø–∫–∏ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏–ª–∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" –≤ —à–∞–±–ª–æ–Ω–µ \"–°–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\", –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/start` –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É, —á—Ç–æ –≥–∞–ª–æ—á–∫–∏ –≤–æ–∑–ª–µ —Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å.\n\n## –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã\n–§—É–Ω–∫—Ü–∏—è `generateStartHandler()` –≤ —Ñ–∞–π–ª–µ `client/src/lib/bot-generator.ts` –Ω–µ —Å–æ–¥–µ—Ä–∂–∞–ª–∞ –ª–æ–≥–∏–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ç–æ–ª—å–∫–æ –≤ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `generateKeyboard()`, –Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\n\n### –§–∞–π–ª: `client/src/lib/bot-generator.ts`\n\n**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏—é `generateStartHandler()`:**\n\n```typescript\n// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í–°–ï–ì–î–ê –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n// –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∫–Ω–æ–ø–æ–∫ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"\n// –£–ë–ò–†–ê–ï–ú —É—Å–ª–æ–≤–∏–µ node.data.allowMultipleSelection, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—Å–µ–≥–¥–∞\ncode += '    # –í–ê–ñ–ù–û: –í–°–ï–ì–î–ê –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∏–∑ –ë–î\\n';\ncode += '    # –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –∫–Ω–æ–ø–æ–∫ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"\\n';\ncode += '    user_record = await get_user_from_db(user_id)\\n';\ncode += '    saved_interests = []\\n';\ncode += '    \\n';\ncode += '    if user_record and isinstance(user_record, dict):\\n';\ncode += '        user_data_field = user_record.get(\"user_data\", {})\\n';\ncode += '        if isinstance(user_data_field, str):\\n';\ncode += '            import json\\n';\ncode += '            try:\\n';\ncode += '                user_vars = json.loads(user_data_field)\\n';\ncode += '            except:\\n';\ncode += '                user_vars = {}\\n';\ncode += '        elif isinstance(user_data_field, dict):\\n';\ncode += '            user_vars = user_data_field\\n';\ncode += '        else:\\n';\ncode += '            user_vars = {}\\n';\ncode += '        \\n';\ncode += '        # –ò—â–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –ª—é–±–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π\\n';\ncode += '        for var_name, var_data in user_vars.items():\\n';\ncode += '            if \"–∏–Ω—Ç–µ—Ä–µ—Å\" in var_name.lower() or var_name == \"user_interests\":\\n';\ncode += '                if isinstance(var_data, str) and var_data:\\n';\ncode += '                    saved_interests = [interest.strip() for interest in var_data.split(\",\")]\\n';\ncode += '                    logging.info(f\"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π {var_name}: {saved_interests}\")\\n';\ncode += '                    break\\n';\ncode += '    \\n';\ncode += '    # –í–°–ï–ì–î–ê –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏\\n';\ncode += '    if user_id not in user_data:\\n';\ncode += '        user_data[user_id] = {}\\n';\nconst multiSelectVariable = node.data.multiSelectVariable || 'user_interests';\ncode += `    user_data[user_id][\"multi_select_${node.id}\"] = saved_interests.copy()\\n`;\ncode += `    user_data[user_id][\"multi_select_node\"] = \"${node.id}\"\\n`;\ncode += '    logging.info(f\"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å {len(saved_interests)} –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏\")\\n';\ncode += '    \\n';\n```\n\n### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:\n\n1. **–ë–µ–∑—É—Å–ª–æ–≤–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω–æ —É—Å–ª–æ–≤–∏–µ `node.data.allowMultipleSelection` - —Ç–µ–ø–µ—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞\n2. **–ü–æ–∑–∏—Ü–∏—è –≤ –∫–æ–¥–µ**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `start_handler`\n3. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫**: –ü–æ–∏—Å–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –≤–æ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö \"–∏–Ω—Ç–µ—Ä–µ—Å\" –∏–ª–∏ \"user_interests\"\n4. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∞/–æ–±—ä–µ–∫—Ç)\n5. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n\n## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç\n–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_code_generation_fix.py`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:\n- ‚úÖ –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è\n- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∫–æ–¥–∞ (–ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)\n- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏\n- ‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\n\n**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞: –£–°–ü–ï–•** (5/5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞–π–¥–µ–Ω—ã)\n\n### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ\n–í –ª–æ–≥–∞—Ö –±–æ—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n```\nINFO:root:–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å 0 –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏\nINFO:root:–ö–æ–º–∞–Ω–¥–∞ /start –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ callback –∫–Ω–æ–ø–∫—É (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1612141295)\n```\n\n## –í–ª–∏—è–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚ùå –ö–Ω–æ–ø–∫–∏ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\" –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏ –≥–∞–ª–æ—á–∫–∏\n- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ \"—á–∏—Å—Ç–æ–µ\" —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Å–≤–æ–∏—Ö –≤—ã–±–æ—Ä–æ–≤\n- ‚ùå –ü–ª–æ—Ö–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n\n### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n- ‚úÖ –ì–∞–ª–æ—á–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ –≤—ã–±–æ—Ä—É –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –≤ —à–∞–±–ª–æ–Ω–µ \"–°–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\"\n\n## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n\n–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª `replit.md` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏:\n```\n- **August 7, 2025**: CRITICAL FIX: Fixed multi-select state restoration bug in /start command handler. Added proper state recovery from database for \"Change selection\" and \"Start over\" buttons. Now generateStartHandler() properly initializes multi_select state with saved interests when allowMultipleSelection is enabled, ensuring checkmarks display correctly after navigation.\n```\n\n## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ\n\n–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ Issue #3 —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/start` –í–°–ï–ì–î–ê –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –≤ —à–∞–±–ª–æ–Ω–µ \"–°–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\".\n\n**–°—Ç–∞—Ç—É—Å: –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ**\n**–î–∞—Ç–∞: August 7, 2025**\n**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –ü–†–û–ô–î–ï–ù–û ‚úÖ**","size_bytes":8107},"NAVIGATION_FIX_SUCCESS_REPORT.md":{"content":"# Navigation Fix Success Report\n**Date:** August 9, 2025  \n**Issue:** VProgulke Bot template navigation bug preventing text input nodes from connecting to subsequent nodes\n\n## Problem Identified\nThe bot generator in `client/src/lib/bot-generator.ts` was using incorrect property names when reading template connection data:\n- **Incorrect:** `conn.source` and `conn.target`\n- **Correct:** `conn.sourceNodeId` and `conn.targetNodeId`\n\nThis caused text input nodes like `name_input` to fail navigation to subsequent nodes like `age_input`, breaking the user flow.\n\n## Root Cause Analysis\nThe VProgulke template connections use the format:\n```json\n{\n  \"id\": \"connection-6\", \n  \"sourceHandle\": \"source\", \n  \"sourceNodeId\": \"name_input\", \n  \"targetHandle\": \"target\", \n  \"targetNodeId\": \"age_input\"\n}\n```\n\nBut the bot generator was looking for:\n```typescript\nconst nextConnection = connections.find(conn => conn.source === targetNode.id);\nconst nextNodeId = nextConnection ? nextConnection.target : null;\n```\n\n## Solution Applied\nFixed **8 occurrences** in `client/src/lib/bot-generator.ts` where connection property names were incorrect:\n\n### Lines Fixed:\n- Line 1183: `conn.source` ‚Üí `conn.sourceNodeId`, `conn.target` ‚Üí `conn.targetNodeId`\n- Line 1917: `conn.source` ‚Üí `conn.sourceNodeId`, `conn.target` ‚Üí `conn.targetNodeId`\n- Line 1958: `conn.source` ‚Üí `conn.sourceNodeId`, `conn.target` ‚Üí `conn.targetNodeId`\n- Line 2873: `conn.source` ‚Üí `conn.sourceNodeId`, `conn.target` ‚Üí `conn.targetNodeId`\n- Line 3887: `conn.source` ‚Üí `conn.sourceNodeId`, `conn.target` ‚Üí `conn.targetNodeId`\n- Line 4275: `conn.source` ‚Üí `conn.sourceNodeId`, `conn.target` ‚Üí `conn.targetNodeId`\n- Line 4487: `conn.source` ‚Üí `conn.sourceNodeId`, `conn.target` ‚Üí `conn.targetNodeId`\n- Line 4515: `conn.source` ‚Üí `conn.sourceNodeId`, `conn.target` ‚Üí `conn.targetNodeId`\n\n## Verification Results\nGenerated Python code from VProgulke template now correctly includes:\n\n### Name Input ‚Üí Age Input Navigation:\n```python\nuser_data[user_id][\"waiting_for_input\"] = {\n    \"type\": \"text\",\n    \"variable\": \"user_name\",\n    \"save_to_database\": True,\n    \"node_id\": \"name_input\",\n    \"next_node_id\": \"age_input\",  # ‚úÖ CORRECT NAVIGATION\n    \"min_length\": 0,\n    \"max_length\": 0,\n    \"retry_message\": \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\",\n    \"success_message\": \"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!\"\n}\n```\n\n### Age Input ‚Üí Metro Selection Navigation:\n```python\nuser_data[user_id][\"waiting_for_input\"] = {\n    \"type\": \"text\",\n    \"variable\": \"user_age\",\n    \"save_to_database\": True,\n    \"node_id\": \"age_input\",\n    \"next_node_id\": \"metro_selection\",  # ‚úÖ CORRECT NAVIGATION\n    \"min_length\": 0,\n    \"max_length\": 0,\n    \"retry_message\": \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\",\n    \"success_message\": \"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!\"\n}\n```\n\n## Impact\n- **‚úÖ Fixed:** VProgulke bot template now has complete working user flow\n- **‚úÖ Fixed:** All text input nodes correctly navigate to subsequent nodes\n- **‚úÖ Fixed:** User experience in VProgulke bot is now seamless\n- **‚úÖ Fixed:** Template system is now fully functional for complex multi-node workflows\n\n## Status\n**COMPLETE** - The navigation bug has been successfully resolved. The VProgulke bot template now functions as intended with proper text input navigation throughout the entire user journey.","size_bytes":3406},"NAVIGATION_SUCCESS_REPORT.md":{"content":"# üéâ –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ê!\n\n## –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ: Inline –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç\n\n**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é!** –õ–æ–≥–∏ –±–æ—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é —Ä–∞–±–æ—Ç—É:\n\n```\nINFO:root:‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î: –∏—Å—Ç–æ—á–Ω–∏–∫ = –¥—à—Ä—Ä–¥–ª–ª\nINFO:root:‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ  \nINFO:root:–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∂–µ–ª–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: –î–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1612141295)\n```\n\n## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:\n\n1. **–í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ –≤ start_node** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ \"–û—Ç–∫—É–¥–∞ –≤—ã —É–∑–Ω–∞–ª–∏ –æ –Ω–∞—Å?\"\n2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** - –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è\n3. **–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ\n4. **Inline –∫–Ω–æ–ø–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è** - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ \"–î–∞\" –∏ \"–ù–µ—Ç\"  \n5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π** - –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –æ–ø—Ä–æ—Å\n\n## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ:\n\n### –í –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ bot-generator.ts:\n- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —É–∑–ª–∞ (keyboard)\n- –ü—Ä—è–º–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è keyboard —É–∑–ª–æ–≤\n- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–ª–æ–∫–∞ —Å `return`\n\n### –í —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–¥–µ:\n```python\n# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π\ntext = \"–¢—ã —Ö–æ—á–µ—à—å—Å—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–≤–æ—é –∂–∏–∑–Ω—å —Å —á–∞—Ç–æ–º?\"\nbuilder = InlineKeyboardBuilder()\nbuilder.add(InlineKeyboardButton(text=\"–î–∞\", callback_data=\"nr3wIiTfBYYmpkkXMNH7n\"))\nbuilder.add(InlineKeyboardButton(text=\"–ù–µ—Ç\", callback_data=\"1BHSLWPMao9qQvSAzuzRl\"))\nkeyboard = builder.as_markup()\nawait message.answer(text, reply_markup=keyboard)\n```\n\n## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:\n\n- ‚úÖ **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: –†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n- ‚úÖ **Inline –∫–Ω–æ–ø–∫–∏**: –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  \n- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –í –ë–î –∏ –ª–æ–∫–∞–ª—å–Ω–æ\n- ‚úÖ **–ü–æ–ª–Ω—ã–π –æ–ø—Ä–æ—Å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–µ—Å—å –ø—É—Ç—å –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏–π\n\n## üéØ –®–∞–±–ª–æ–Ω \"–û–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\" –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!\n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç:\n1. –í–≤–µ—Å—Ç–∏ /start\n2. –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ —Ç–æ–º, –æ—Ç–∫—É–¥–∞ —É–∑–Ω–∞–ª–∏  \n3. –£–≤–∏–¥–µ—Ç—å inline –∫–Ω–æ–ø–∫–∏ \"–î–∞/–ù–µ—Ç\"\n4. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–ø—Ä–æ—Å –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è\n\n**–ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê –ü–û–õ–ù–û–°–¢–¨–Æ!**","size_bytes":2895},"README.md":{"content":"# Telegram Bot Builder ü§ñ\n\n–í–∏–∑—É–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram –±–æ—Ç–∞–º–∏ —Å drag-and-drop –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π Python –∫–æ–¥–∞.\n\n## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç\n\n1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**\n   ```bash\n   git clone https://github.com/fedorabakumets/telegram-bot-builder.git\n   cd telegram-bot-builder\n   ```\n\n2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**\n   ```bash\n   npm install\n   ```\n\n3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**\n   ```bash\n   # –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n   cp .env.example .env\n   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ DATABASE_URL –≤ .env\n   \n   # –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏\n   npm run db:push\n   ```\n\n4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**\n   ```bash\n   npm run dev\n   ```\n\n5. **–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:** http://localhost:5000\n\n> üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:** —Å–º. [SETUP.md](SETUP.md) –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞ Windows –∏ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.\n\n## üåü –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n\n- üé® **–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä** - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–æ—Ç–æ–≤ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Ö–æ–ª—Å—Ç\n- üîß **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞** - –ø–æ–ª—É—á–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π Python –∫–æ–¥ –¥–ª—è aiogram 3.x\n- üì± **–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n- üóÑÔ∏è **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n- üìä **–ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞\n- üé≠ **–¢–µ–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º—ã** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å\n- üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –±–æ—Ç–æ–≤\n- üìä **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –∫–æ–º–∞–Ω–¥\n\n## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\n\n### Frontend\n- **React 18** —Å TypeScript\n- **Vite** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏\n- **Tailwind CSS** –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏\n- **Shadcn/ui** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã\n- **TanStack Query** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º\n- **Wouter** –¥–ª—è —Ä–æ—É—Ç–∏–Ω–≥–∞\n\n### Backend\n- **Node.js** —Å Express.js\n- **TypeScript** (ES modules)\n- **PostgreSQL** —Å Drizzle ORM\n- **WebSocket** –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏\n- **Express Session** —Å PostgreSQL storage\n\n### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ—Ç–æ–≤\n- **Python** —Å aiogram 3.x\n- **PostgreSQL** –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n- **aiohttp** –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤\n- **asyncpg** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ë–î\n\n## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö –±–æ—Ç–æ–≤\n\n### –¢–∏–ø—ã —É–∑–ª–æ–≤\n- **Start** - —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª –±–æ—Ç–∞\n- **Message** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n- **Photo** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\n- **Keyboard** - inline –∏ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\n- **Condition** - —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞\n- **Command** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥\n- **User Input** - —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n- **Media** - —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏\n\n### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å\n- ‚úÖ –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Markdown/HTML)\n- ‚úÖ Inline –∏ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\n- ‚úÖ –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã)\n- ‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –∫–∞—Ä—Ç\n- ‚úÖ –°–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π\n- ‚úÖ –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è\n- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n\n## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞\n\n```\ntelegram-bot-builder/\n‚îú‚îÄ‚îÄ client/                 # React frontend\n‚îÇ   ‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/     # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/         # –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ editor/     # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/          # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/            # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö—É–∫–∏\n‚îú‚îÄ‚îÄ server/                 # Express backend\n‚îÇ   ‚îú‚îÄ‚îÄ routes.ts           # API –º–∞—Ä—à—Ä—É—Ç—ã\n‚îÇ   ‚îú‚îÄ‚îÄ storage.ts          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ë–î\n‚îÇ   ‚îú‚îÄ‚îÄ db.ts              # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î\n‚îÇ   ‚îî‚îÄ‚îÄ telegram-client.ts  # Telegram API\n‚îú‚îÄ‚îÄ shared/                 # –û–±—â–∏–µ —Ç–∏–ø—ã –∏ —Å—Ö–µ–º—ã\n‚îÇ   ‚îî‚îÄ‚îÄ schema.ts           # –°—Ö–µ–º—ã Drizzle ORM\n‚îú‚îÄ‚îÄ scripts/               # –£—Ç–∏–ª–∏—Ç—ã –ë–î\n‚îú‚îÄ‚îÄ bots/                  # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–æ—Ç—ã\n‚îî‚îÄ‚îÄ uploads/               # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\n```\n\n## üîå API Endpoints\n\n### –ü—Ä–æ–µ–∫—Ç—ã\n- `GET /api/projects` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤\n- `POST /api/projects` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞\n- `GET /api/projects/:id` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ ID\n- `PUT /api/projects/:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞\n- `DELETE /api/projects/:id` - –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞\n\n### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏\n- `POST /api/projects/:id/bot/start` - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞\n- `POST /api/projects/:id/bot/stop` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞\n- `GET /api/projects/:id/bot/status` - –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞\n\n### –®–∞–±–ª–æ–Ω—ã\n- `GET /api/templates` - –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤\n- `POST /api/templates` - –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞\n- `PUT /api/templates/:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞\n\n### –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã\n- `POST /api/projects/:id/media/upload` - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤\n- `GET /api/projects/:id/media` - –°–ø–∏—Å–æ–∫ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤\n\n### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö\n- `GET /api/database/health` - –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î\n- `GET /api/database/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n\n## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ\n\n### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏\n```bash\nnpm run dev          # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏\nnpm run db:push      # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î\nnpm run check        # –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript\n```\n\n### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞\n```bash\n# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\nnpm run build\n\n# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è\nexport NODE_ENV=production\nexport DATABASE_URL=your_postgres_url\nexport PORT=5000\n\n# –ó–∞–ø—É—Å–∫\nnpm start\n```\n\n## üìã –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è\n\n- **Node.js** 18.0.0 –∏–ª–∏ –≤—ã—à–µ\n- **PostgreSQL** 13 –∏–ª–∏ –≤—ã—à–µ\n- **Python** 3.11+ (–¥–ª—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –±–æ—Ç–æ–≤)\n- **npm** –∏–ª–∏ **yarn**\n\n## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º\n\n### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö\n- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω\n- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `.env`\n- –í—ã–ø–æ–ª–Ω–∏—Ç–µ `npm run db:push` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü\n\n### –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç\n```bash\n# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 5000\nnetstat -tulpn | grep 5000\n# –ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å\nkill -9 PID\n```\n\n### –û—à–∏–±–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏\n- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (Windows)\n- –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à: `npm cache clean --force`\n- –£–¥–∞–ª–∏—Ç–µ `node_modules` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `npm install`\n\n## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è\n\nMIT License - —Å–º. [LICENSE](LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.\n\n## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞\n\n- üìß **–ë–∞–≥–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:** [GitHub Issues](https://github.com/fedorabakumets/telegram-bot-builder/issues)\n- üí¨ **–û–±—Å—É–∂–¥–µ–Ω–∏—è:** [GitHub Discussions](https://github.com/fedorabakumets/telegram-bot-builder/discussions)\n- üìñ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [Wiki](https://github.com/fedorabakumets/telegram-bot-builder/wiki)\n\n---\n\n–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Telegram –±–æ—Ç–æ–≤","size_bytes":8295},"README_RU.md":{"content":"# Telegram Bot Builder ü§ñ\n\n–í–∏–∑—É–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.\n\n## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –Ω–∞ Windows\n\n### 1Ô∏è‚É£ –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ\n\n**Node.js** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):\n- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://nodejs.org/\n- –°–∫–∞—á–∞–π—Ç–µ LTS –≤–µ—Ä—Å–∏—é\n- **–í–∞–∂–Ω–æ**: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏\n\n**PostgreSQL** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):\n- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://www.postgresql.org/download/windows/\n- –°–∫–∞—á–∞–π—Ç–µ PostgreSQL installer\n- –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ **–∑–∞–ø–æ–º–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `postgres`\n\n### 2Ô∏è‚É£ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞\n\n1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º\n2. **–î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ** –Ω–∞ —Ñ–∞–π–ª `setup.bat`\n3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ\n\n–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ ‚¨áÔ∏è\n\n### 3Ô∏è‚É£ –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞\n\n–û—Ç–∫—Ä–æ–π—Ç–µ **–ö–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É** –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:\n\n```cmd\n# –ö–æ–ø–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\ncopy .env.example .env\n\n# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—É–∫–∞–∂–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å –æ—Ç PostgreSQL)\nnotepad .env\n\n# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏\nnpm install\n\n# –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\nnpm run db:push\n\n# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–µ–∫—Ç (Windows PowerShell - –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)\n$env:NODE_ENV=\"development\"; tsx server/index.ts\n\n# –ò–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —á–µ—Ä–µ–∑ bat —Ñ–∞–π–ª:\nstart-dev.bat\n```\n\n### 4Ô∏è‚É£ –û—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä\n\n–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:5000**\n\n## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ pgAdmin\n\n–ï—Å–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:\n\n1. –û—Ç–∫—Ä–æ–π—Ç–µ **pgAdmin 4**\n2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É (–≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å postgres)\n3. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:\n   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ \"Databases\" ‚Üí Create ‚Üí Database\n   - –ò–º—è: `telegram_bot_builder`\n4. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ \"Login/Group Roles\" ‚Üí Create ‚Üí Login/Group Role\n   - –ò–º—è: `bot_user`\n   - –ü–∞—Ä–æ–ª—å: `your_password` (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π)\n   - –í–∫–ª—é—á–∏—Ç–µ \"Can login?\" –∏ \"Superuser?\"\n\n–ó–∞—Ç–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.\n\n## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n\nüé® **–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä** - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–æ—Ç–æ–≤ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤\nüîß **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞** - –ø–æ–ª—É—á–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π Python –∫–æ–¥ –¥–ª—è aiogram\nüì± **–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä** - —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ\nüìä **–ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞\nüóÑÔ∏è **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n\n## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º\n\n### \"node –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫–æ–º–∞–Ω–¥–æ–π\"\n–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Node.js\n\n### \"npm run db:push\" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç\n1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω\n2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ `.env`\n3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ pgAdmin\n\n### –ü–æ—Ä—Ç 5000 —É–∂–µ –∑–∞–Ω—è—Ç\n```cmd\n# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å\nnetstat -ano | findstr 5000\n# –ó–∞–≤–µ—Ä—à–∏—Ç–µ –µ–≥–æ (–∑–∞–º–µ–Ω–∏—Ç–µ 1234 –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π PID)\ntaskkill /PID 1234 /F\n```\n\n### –û—à–∏–±–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤\n–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É **–æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**\n\n## –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞\n\n```cmd\n$env:NODE_ENV=\"development\"; tsx server/index.ts  # –ó–∞–ø—É—Å–∫ –≤ Windows PowerShell (–õ–£–ß–®–ò–ô –°–ü–û–°–û–ë)\nstart-dev.bat       # –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ bat —Ñ–∞–π–ª (Windows CMD)\nnpm run dev          # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ –Ω–∞ –≤—Å–µ—Ö Windows)\nnpm run build        # –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞  \nnpm run start        # –ó–∞–ø—É—Å–∫ –≥–æ—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\nnpm run db:push      # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\nnpm run check        # –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript\n```\n\n## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞\n\n```\ntelegram-bot-builder/\n‚îú‚îÄ‚îÄ client/          # –§—Ä–æ–Ω—Ç–µ–Ω–¥ (React + TypeScript)\n‚îú‚îÄ‚îÄ server/          # –ë—ç–∫–µ–Ω–¥ (Express + TypeScript)  \n‚îú‚îÄ‚îÄ shared/          # –û–±—â–∏–µ —Ç–∏–ø—ã –∏ —Å—Ö–µ–º—ã\n‚îú‚îÄ‚îÄ uploads/         # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\n‚îú‚îÄ‚îÄ .env            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ .env.example)\n‚îî‚îÄ‚îÄ setup.bat       # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞\n```\n\n---\n\nüí° **–°–æ–≤–µ—Ç**: –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, —É–¥–∞–ª–∏—Ç–µ –ø–∞–ø–∫—É `node_modules` –∏ —Ñ–∞–π–ª `package-lock.json`, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `npm install` –∑–∞–Ω–æ–≤–æ.\n\nüìû **–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –æ—à–∏–±–∫—É –ø–æ–¥—Ä–æ–±–Ω–æ - –º—ã –ø–æ–º–æ–∂–µ–º —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É!","size_bytes":5542},"TEST_SUCCESS_REPORT.md":{"content":"# üéâ –û–¢–ß–ï–¢ –û–ë –£–°–ü–ï–®–ù–û–ú –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–û–ì–û –í–´–ë–û–†–ê\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n### ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (4/4 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ)\n\n1. **–ü–æ—à–∞–≥–æ–≤—ã–π –≤—ã–±–æ—Ä –æ–ø—Ü–∏–π** - –ü–†–û–ô–î–ï–ù\n   - –ì–∞–ª–æ—á–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ\n   - –ì–∞–ª–æ—á–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–±–∏—Ä–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏\n   - –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è\n\n2. **–§–æ—Ä–º–∞—Ç callback_data** - –ü–†–û–ô–î–ï–ù\n   - Callback_data —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `multi_select_start_btn-sport`\n   - –ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `multi_select_done_start`\n\n3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é** - –ü–†–û–ô–î–ï–ù\n   - –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `üéµ –ú—É–∑—ã–∫–∞, üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, üìö –ö–Ω–∏–≥–∏`\n   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `user_interests` –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n\n4. **–ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å** - –ü–†–û–ô–î–ï–ù\n   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –í—ã–±–æ—Ä ‚Üí –ì–∞–ª–æ—á–∫–∏ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n   - –í—Å–µ 8 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n\n### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞\n\n**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**\n```python\n# –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):\ncallback_data=\"multi_select_{node_id}_btn-sport\"\n\n# –ü–û–°–õ–ï (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):\ncallback_data=f\"multi_select_{node_id}_btn-sport\"\n```\n\n**–ù–∞–π–¥–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–¥–µ:**\n- `callback_data=f\"multi_select_start_btn-sport\"`\n- `callback_data=f\"multi_select_{node_id}_btn-sport\"`\n\n### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç\n\n1. **–ì–∞–ª–æ—á–∫–∏** - –ø–æ—è–≤–ª—è—é—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞—é—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ (‚úÖ ‚öΩ –°–ø–æ—Ä—Ç)\n2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä** - –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `user_interests`\n4. **Callback_data** - —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n\n## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\n\n- **client/src/lib/bot-generator.ts** (4 –º–µ—Å—Ç–∞ —Å f-—Å—Ç—Ä–æ–∫–∞–º–∏)\n- **bots/bot_1.py** (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏)\n\n## –ò—Ç–æ–≥\n\nüéØ **–í–°–ï –†–ê–ë–û–¢–ê–ï–¢ –ò–î–ï–ê–õ–¨–ù–û!**\n\n–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Å –≥–∞–ª–æ—á–∫–∞–º–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –Ω–∞ 100%.\n\n---\n*–î–∞—Ç–∞: 6 –∞–≤–≥—É—Å—Ç–∞ 2025*  \n*–°—Ç–∞—Ç—É—Å: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û*","size_bytes":2997},"WINDOWS_SETUP.md":{"content":"# Telegram Bot Builder - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Windows\n\n## –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞\n\n### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã\n\n**Node.js** (–≤–µ—Ä—Å–∏—è 18+):\n- –°–∫–∞—á–∞–π—Ç–µ: https://nodejs.org/\n- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ LTS –≤–µ—Ä—Å–∏—é\n- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏\n\n**PostgreSQL** (–≤–µ—Ä—Å–∏—è 13+):\n- –°–∫–∞—á–∞–π—Ç–µ: https://www.postgresql.org/download/windows/\n- –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–ø–æ–º–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `postgres`\n- –û—Å—Ç–∞–≤—å—Ç–µ –ø–æ—Ä—Ç 5432\n\n### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n\n–û—Ç–∫—Ä–æ–π—Ç–µ **pgAdmin 4** (—É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —Å PostgreSQL):\n\n1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É (–≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å postgres)\n2. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:\n   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ \"Databases\" ‚Üí Create ‚Üí Database\n   - –ò–º—è: `telegram_bot_builder`\n3. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ \"Login/Group Roles\" ‚Üí Create ‚Üí Login/Group Role\n   - General: –ò–º—è `bot_user`\n   - Definition: –ü–∞—Ä–æ–ª—å `your_password`\n   - Privileges: ‚úÖ Can login?\n   - Privileges: ‚úÖ Superuser? (–∏–ª–∏ –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—É—é –ë–î)\n\n### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç\n\n```cmd\n# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞\ncd –ø—É—Ç—å\\–∫\\–≤–∞—à–µ–º—É\\–ø—Ä–æ–µ–∫—Ç—É\n\n# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\ncopy .env.example .env\n\n# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª (–∑–∞–º–µ–Ω–∏—Ç–µ your_password –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å)\nnotepad .env\n\n# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏\nnpm install\n\n# –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\nnpm run db:push\n\n# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç (–õ–£–ß–®–ò–ô –°–ü–û–°–û–ë –¥–ª—è Windows PowerShell)\n$env:NODE_ENV=\"development\"; tsx server/index.ts\n\n# –ò–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –≤ CMD\nstart-dev.bat\n```\n\n### 4. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä\n\n–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:5000\n\n## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º\n\n### \"node –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫–æ–º–∞–Ω–¥–æ–π\"\n- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É\n- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Node.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ: `node --version`\n\n### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω (services.msc ‚Üí postgresql)\n- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ `.env`\n- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `bot_user` —Å–æ–∑–¥–∞–Ω –∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞\n\n### –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç\n```cmd\n# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 5000\nnetstat -ano | findstr 5000\n# –ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å (–∑–∞–º–µ–Ω–∏—Ç–µ PID –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä)\ntaskkill /PID –Ω–æ–º–µ—Ä_–ø—Ä–æ—Ü–µ—Å—Å–∞ /F\n```\n\n### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞\n–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n\n## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞\n\n```\ntelegram-bot-builder/\n‚îú‚îÄ‚îÄ client/          # Frontend (React)\n‚îú‚îÄ‚îÄ server/          # Backend (Express + TypeScript)\n‚îú‚îÄ‚îÄ shared/          # –û–±—â–∏–µ —Ç–∏–ø—ã –∏ —Å—Ö–µ–º—ã\n‚îú‚îÄ‚îÄ uploads/         # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\n‚îú‚îÄ‚îÄ package.json     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Node.js\n‚îú‚îÄ‚îÄ .env            # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞–π—Ç–µ —Å–∞–º–∏)\n‚îî‚îÄ‚îÄ README.md       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n```\n\n## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã\n\n```cmd\nnpm run dev          # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏\nnpm run build        # –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞\nnpm run start        # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω –≤–µ—Ä—Å–∏–∏\nnpm run db:push      # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î\nnpm run check        # –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript\n```","size_bytes":3897},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"fedya_test_report.md":{"content":"# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞ \"–§–ï–î–Ø\"\n\n## –û–±–∑–æ—Ä\n–®–∞–±–ª–æ–Ω \"—Ñ–µ–¥—è\" –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π Telegram-–±–æ—Ç–∞ –¥–ª—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö, –æ—Ç–∫—É–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∑–Ω–∞–ª–∏ –æ –±–æ—Ç–µ. –ë–æ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å —É—Å–ª–æ–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è–º–∏.\n\n## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —à–∞–±–ª–æ–Ω–∞\n\n### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:\n1. **–£—Å–ª–æ–≤–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è** - —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n2. **–°–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏** - –≤—ã–±–æ—Ä –∏–∑ —Ç—Ä–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ inline –∫–Ω–æ–ø–∫–∏\n3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è \"–∏—Å—Ç–æ—á–Ω–∏–∫\" —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n4. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö\n\n### –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏:\n- **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** ‚Üí –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞\n- **–í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞** ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö + —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞\n- **–í–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º** ‚Üí –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞\n- **–í–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞** ‚Üí –û–±—â–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –∑–Ω–∞–∫–æ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n\n## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã:\n\n#### 1. –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\n- **–¢–µ—Å—Ç**: –ö–æ–º–∞–Ω–¥–∞ `/start` –æ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –û–±—â–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞\n- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç \"–ü—Ä–∏–≤–µ—Ç! üåü...\"\n- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –ü—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç `{}`\n\n#### 2. –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ \"–î—Ä—É–∑—å—è\"\n- **–¢–µ—Å—Ç**: Callback `source_friends`\n- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `–∏—Å—Ç–æ—á–Ω–∏–∫=–¥—Ä—É–∑—å—è`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ—Ç–≤–µ—Ç\n- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, —Ç–µ–∫—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π\n- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: `{'–∏—Å—Ç–æ—á–Ω–∏–∫': '–¥—Ä—É–∑—å—è'}`\n\n#### 3. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\n- **–¢–µ—Å—Ç**: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ `/start` –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞\n- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: \"–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º! üëã –í—ã –ø—Ä–∏—à–ª–∏ –∫ –Ω–∞–º –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: –¥—Ä—É–∑—å—è...\"\n- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: `{'–∏—Å—Ç–æ—á–Ω–∏–∫': '–¥—Ä—É–∑—å—è'}` (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ)\n\n#### 4. –°–º–µ–Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞\n- **–¢–µ—Å—Ç**: –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí –Ω–æ–≤—ã–π –≤—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ \"–ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ\"\n- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è\n- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: `{'–∏—Å—Ç–æ—á–Ω–∏–∫': '–ø–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ'}`\n\n#### 5. –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏\n- **–¢–µ—Å—Ç**: –û–±—Ä–∞–±–æ—Ç–∫–∞ `None`, –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä\n- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –§—É–Ω–∫—Ü–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–∞–¥–∞—Ç—å, –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `False`\n- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –í—Å–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ\n\n### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è\n\n#### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:\n```python\ndef has_variable_data(user_data_dict: dict, variable_name: str) -> bool\ndef is_returning_user(user_data_dict: dict) -> bool\nasync def save_user_variable(user_id: int, variable_name: str, variable_value: str)\n```\n\n#### –õ–æ–≥–∏–∫–∞ —É—Å–ª–æ–≤–∏–π:\n1. `has_variable_data(data, \"–∏—Å—Ç–æ—á–Ω–∏–∫\")` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞\n2. `is_returning_user(data)` - –ø—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–∞–Ω–Ω—ã–µ\n3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –∏—Å—Ç–æ—á–Ω–∏–∫ > –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è > –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\n\n#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:\n- **\"source_search\"** ‚Üí `\"–ø–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ\"`\n- **\"source_friends\"** ‚Üí `\"–¥—Ä—É–∑—å—è\"`\n- **\"source_ads\"** ‚Üí `\"—Ä–µ–∫–ª–∞–º–∞\"`\n\n### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n\n| –¢–µ—Å—Ç | –°—Ç–∞—Ç—É—Å | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |\n|------|--------|------------------|----------|\n| –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | ‚úÖ | < 1–º—Å | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è |\n| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ | ‚úÖ | < 1–º—Å | –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ |\n| –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è | ‚úÖ | < 1–º—Å | –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö |\n| –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö | ‚úÖ | < 1–º—Å | –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–±—Ä–æ—Å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é |\n| –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ | ‚úÖ | < 1–º—Å | –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ |\n\n### üíæ –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö\n\n#### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º):\n```python\nuser_data = {\n    user_id: {\n        'variables': {\n            '–∏—Å—Ç–æ—á–Ω–∏–∫': '–∑–Ω–∞—á–µ–Ω–∏–µ'\n        }\n    }\n}\n```\n\n#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL (—Ä–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º):\n- –¢–∞–±–ª–∏—Ü–∞: `bot_users`\n- –ü–æ–ª–µ: `user_data` (JSONB)\n- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π\n\n### üéØ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏\n\n1. **–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:\n   - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\n\n2. **–°–º–µ–Ω–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π**:\n   - –û—á–∏—Å—Ç–∫–∞ ‚Üí –ù–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí –î—Ä—É–≥–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö\n\n3. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö**:\n   - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n### üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é\n\n#### –°—Ç–∞—Ç—É—Å: ‚úÖ –ì–û–¢–û–í\n- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ  \n- ‚úÖ –£—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫\n- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ\n- ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º Telegram API\n\n#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞:\n1. **BOT_TOKEN** - —Ç–æ–∫–µ–Ω –æ—Ç @BotFather\n2. **DATABASE_URL** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\n3. **Python 3.11+** —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º aiogram 3.4+\n\n### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n\n1. **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n2. **–î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**: –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\n3. **–î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏**: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n4. **–î–ª—è UX**: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å–±—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö\n\n### üìà –í—ã–≤–æ–¥\n\n–®–∞–±–ª–æ–Ω \"—Ñ–µ–¥—è\" –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã - —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏.","size_bytes":8894},"final_success_report.md":{"content":"# üéâ –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ê –£–°–ü–ï–®–ù–û!\n\n## –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é\n\n**–ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –ù–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤ —à–∞–±–ª–æ–Ω–µ \"–û–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\" - –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –≤ start_node –±–æ—Ç –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª –∫ —É–∑–ª—É --2N9FeeykMHVVlsVnSQW.\n\n## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:\n\n### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ—Å–ª–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n- –°–æ–∑–¥–∞–µ—Ç—Å—è fake_message –æ–±—ä–µ–∫—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n- –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è next_node_id –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–≤–æ–¥–∞  \n- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\n\n### 2. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ keyboard —É–∑–ª–æ–≤\n- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —É–∑–ª–æ–≤ —Ç–∏–ø–∞ 'keyboard'\n- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏\n- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –æ–∂–∏–¥–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏\n\n### 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞\n- 54 –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–µ–∫—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤\n- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤ (keyboard, message, start, command)\n- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n\n## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:\n\n- ‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—Å Python**: –ö–æ—Ä—Ä–µ–∫—Ç–µ–Ω (–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫)\n- ‚úÖ **–ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞**: 100% —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å  \n- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã\n- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ë–î –∏ –ª–æ–∫–∞–ª—å–Ω–æ\n- ‚úÖ **–†–∞–∑–º–µ—Ä –∫–æ–¥–∞**: 160,444 —Å–∏–º–≤–æ–ª–æ–≤ (3,367 —Å—Ç—Ä–æ–∫)\n\n## üîÑ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ:\n\n–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é —Ä–∞–±–æ—Ç—É:\n```\nINFO:root:‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î: –∏—Å—Ç–æ—á–Ω–∏–∫ = –∂—â–ª–¥–æ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1612141295)\nINFO:root:üöÄ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∫–Ω–æ–ø–∫–∏: --2N9FeeykMHVVlsVnSQW\nINFO:root:–ü–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É --2N9FeeykMHVVlsVnSQW\n```\n\n## üéØ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ:\n\n1. **–°–æ–∑–¥–∞–Ω–∏–µ fake_message**: `fake_message = type(\"FakeMessage\", (), {})()`\n2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–ª–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏**: `next_node_id = input_config.get(\"next_node_id\")`  \n3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**: `builder.add(InlineKeyboardButton(...))`\n4. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**: `await fake_message.answer(text, reply_markup=keyboard)`\n\n## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ\n\n**–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:**\n- –í–≤–µ—Å—Ç–∏ /start\n- –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å \"–û—Ç–∫—É–¥–∞ –≤—ã —É–∑–Ω–∞–ª–∏ –æ –Ω–∞—Å?\"\n- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É\n- –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–ø—Ä–æ—Å –¥–æ –∫–æ–Ω—Ü–∞ –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏–π\n\n**–®–∞–±–ª–æ–Ω \"–û–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\" –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω!**","size_bytes":3408},"force_recreate_templates.ts":{"content":"import { seedDefaultTemplates } from './server/seed-templates';\nimport { createPostgreSQLStorage } from './server/storage';\n\nasync function main() {\n  console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤...');\n  \n  const storage = createPostgreSQLStorage();\n  \n  try {\n    await seedDefaultTemplates(storage, true);\n    console.log('‚úÖ –®–∞–±–ª–æ–Ω—ã —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã!');\n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞:', error);\n  }\n  \n  process.exit(0);\n}\n\nmain();","size_bytes":533},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"aiogram>=3.21.0\",\n    \"aiohttp>=3.12.13\",\n    \"asyncpg>=0.30.0\",\n    \"nanoid>=2.0.0\",\n    \"requests>=2.32.4\",\n]\n","size_bytes":259},"quick-start-windows.md":{"content":"# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è Windows üöÄ\n\n## –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PostgreSQL –∏ Node.js:\n\n### 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç (–æ–¥–∏–Ω —Ä–∞–∑):\n```cmd\n# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\ncopy .env.example .env\n\n# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª—å PostgreSQL\nnotepad .env\n\n# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏  \nnpm install\n\n# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ pgAdmin –∏–ª–∏:\n# –í PowerShell (–∑–∞–º–µ–Ω–∏—Ç–µ \"–≤–∞—à_–ø–∞—Ä–æ–ª—å\"):\n$env:PGPASSWORD=\"–≤–∞—à_–ø–∞—Ä–æ–ª—å\"; & \"C:\\Program Files\\PostgreSQL\\17\\bin\\psql.exe\" -U postgres -c \"CREATE DATABASE telegram_bot_builder;\"\n\n# –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã\nnpm run db:push\n```\n\n### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ (–∫–∞–∂–¥—ã–π —Ä–∞–∑):\n\n**–°–ø–æ—Å–æ–± 1 - PowerShell (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø):**\n```powershell\n$env:NODE_ENV=\"development\"; tsx server/index.ts\n```\n\n**–°–ø–æ—Å–æ–± 2 - CMD:**\n```cmd\nstart-dev.bat\n```\n\n### 3. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:\nhttp://localhost:5000\n\n---\n\n## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:\n\n**\"NODE_ENV –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π\"** ‚Üí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PowerShell\n**\"tsx –Ω–µ –Ω–∞–π–¥–µ–Ω\"** ‚Üí –í—ã–ø–æ–ª–Ω–∏—Ç–µ `npm install` \n**–û—à–∏–±–∫–∞ –ë–î** ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ `.env` —Ñ–∞–π–ª–µ\n**–ü–æ—Ä—Ç –∑–∞–Ω—è—Ç** ‚Üí –ò–∑–º–µ–Ω–∏—Ç–µ PORT –≤ `.env` –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å:\n```cmd\nnetstat -ano | findstr 5000\ntaskkill /PID –Ω–æ–º–µ—Ä_–ø—Ä–æ—Ü–µ—Å—Å–∞ /F\n```","size_bytes":1459},"recreate_fixed_template.js":{"content":"const { seedDefaultTemplates } = require('./server/seed-templates.ts');\nconst { createPostgreSQLStorage } = require('./server/storage.ts');\n\nasync function recreateTemplates() {\n  try {\n    console.log('–°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...');\n    const storage = createPostgreSQLStorage();\n    \n    console.log('–£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã VProgulke Bot...');\n    await storage.db.delete(storage.botTemplatesTable).where(\n      storage.sql`name LIKE '%VProgulke Bot%'`\n    );\n    \n    console.log('–ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —à–∞–±–ª–æ–Ω—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏...');\n    await seedDefaultTemplates(storage, true);\n    \n    console.log('‚úÖ –®–∞–±–ª–æ–Ω—ã —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã!');\n    process.exit(0);\n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤:', error);\n    process.exit(1);\n  }\n}\n\nrecreateTemplates();","size_bytes":944},"replit.md":{"content":"# Telegram Bot Builder\n\n## Overview\nThis application provides a visual Telegram bot builder, enabling users to create bots via a drag-and-drop interface. It's a full-stack web application with a React frontend and Express.js backend, offering real-time bot preview and Python code generation. The business vision is to democratize bot creation, allowing individuals and small businesses to rapidly deploy sophisticated Telegram bots without coding expertise, tapping into the growing demand for automated communication solutions. The project aims to be the leading no-code platform for Telegram bot development.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend\n- **Framework**: React 18 with TypeScript\n- **Build Tool**: Vite\n- **UI Components**: Shadcn/ui (built on Radix UI)\n- **Styling**: Tailwind CSS with CSS variables for theming, supporting comprehensive dark theme.\n- **State Management**: React hooks\n- **Data Fetching**: TanStack Query\n- **Routing**: Wouter\n- **Design Philosophy**: Responsive design, intuitive drag-and-drop interface, interactive elements, consistent theming. Enhanced visual effects and animations for canvas and UI elements.\n\n### Backend\n- **Runtime**: Node.js with Express.js\n- **Language**: TypeScript (ES modules)\n- **Database**: PostgreSQL with Drizzle ORM\n- **Session Storage**: PostgreSQL-based session storage\n- **API**: RESTful JSON API\n- **Key Features**:\n    - **Bot Editor Core**: Canvas-based visual flow editor with various node types (start, message, photo, keyboard, condition, command). Real-time property editing and a component sidebar.\n    - **Bot Preview System**: Live, interactive bot simulation with message flow and button interaction testing.\n    - **Code Generation**: Converts visual flows to aiogram (Python) code. Includes validation and export options (copy/download). Generates syntactically correct Python code, handling boolean conversions, indentation, and various node types.\n    - **Storage System**: Persistent storage of bot projects using a PostgreSQL database with JSON flow storage. Supports in-memory fallback for development.\n    - **Bot Execution**: Manages bot instances with start/stop controls, real-time status monitoring, and Python process management. Handles bot token storage securely.\n    - **Template System**: Advanced template management with metadata (difficulty, author, usage, rating), category filtering, search, and a redesigned tabbed interface.\n    - **Connection Management**: Dedicated interface for managing connections, offering intelligent suggestions, validation rules, and visualization.\n    - **Media Handling**: Comprehensive support for various media types (photo, video, audio, document) with file optimization, preview, and local file support.\n    - **Geolocation**: Supports integration with mapping services (Yandex, Google Maps, 2GIS) for coordinate extraction and route generation.\n    - **User Input & Data Collection**: Dedicated node type for collecting user input (text, number, email, phone, media) with validation, persistence, and support for button-based answers (single/multiple choice) with customizable navigation.\n    - **Conditional Messaging**: Advanced logic for conditional messages based on user data, with intelligent variable replacement and dynamic next node navigation.\n    - **Text Formatting**: Works like Telegram Web, with hotkeys and toggle functionality for Markdown and HTML formatting. Auto-detects and applies `ParseMode`.\n    - **User Database & Analytics**: Automatically collects user data (username, first_name, last_name, registration) and command statistics in PostgreSQL. Provides a UI for viewing user responses and stats.\n    - **Undo/Redo System**: Comprehensive undo/redo system with 50-state history limit, canvas toolbar integration, and keyboard shortcuts (Ctrl+Z, Ctrl+Y, Ctrl+Shift+Z).\n\n### Data Flow\nUser changes in the visual editor are immediately reflected in the bot's data structure, which is then persisted to the database via API. The preview mode allows real-time testing, and the validated bot structure can be exported as Python code.\n\n## External Dependencies\n\n### Frontend Libraries\n- **UI Framework**: React\n- **Component Library**: Radix UI, Shadcn/ui\n- **Icons**: Lucide React\n- **Form Handling**: React Hook Form, Zod\n- **Date Utilities**: date-fns\n- **Styling**: Tailwind CSS, class-variance-authority\n\n### Backend Libraries\n- **Web Framework**: Express.js\n- **Database ORM**: Drizzle ORM\n- **PostgreSQL Driver**: @neondatabase/serverless (or standard node-postgres)\n- **Validation**: Zod\n- **Session Management**: express-session, connect-pg-simple\n- **Python Execution**: tsx (for development)\n\n### Python Bot Dependencies (Generated Code)\n- **Telegram Bot API**: aiogram\n- **HTTP Client**: aiohttp\n- **HTTP Requests**: requests\n- **PostgreSQL Client**: asyncpg","size_bytes":4905},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2627},"theme-test.js":{"content":"// –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã\nconsole.log('üåì –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã...');\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ù–∞–ª–∏—á–∏–µ ThemeProvider –≤ DOM\nsetTimeout(() => {\n  console.log('1. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...');\n  const html = document.documentElement;\n  console.log('   HTML classes:', html.className);\n  console.log('   Color scheme:', getComputedStyle(html).colorScheme);\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ù–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã\n  console.log('2. –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã...');\n  const themeButtons = document.querySelectorAll('button[aria-label*=\"—Ç–µ–º—É\"], button:has(svg), button[title*=\"—Ç–µ–º—É\"]');\n  console.log('   –ù–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:', themeButtons.length);\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\n  console.log('3. –ü—Ä–æ–≤–µ—Ä–∫–∞ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö...');\n  const computedStyle = getComputedStyle(document.documentElement);\n  const bgColor = computedStyle.getPropertyValue('--background');\n  const fgColor = computedStyle.getPropertyValue('--foreground');\n  console.log('   --background:', bgColor);\n  console.log('   --foreground:', fgColor);\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: localStorage\n  console.log('4. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage...');\n  const savedTheme = localStorage.getItem('telegram-bot-builder-theme');\n  console.log('   –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞:', savedTheme);\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 5: –°–∏–º—É–ª—è—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã\n  console.log('5. –°–∏–º—É–ª—è—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã...');\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–º–Ω—ã–π –∫–ª–∞—Å—Å\n  html.classList.add('dark');\n  setTimeout(() => {\n    const darkBg = getComputedStyle(document.documentElement).getPropertyValue('--background');\n    console.log('   –§–æ–Ω –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ:', darkBg);\n    \n    // –£–±–∏—Ä–∞–µ–º —Ç–µ–º–Ω—ã–π –∫–ª–∞—Å—Å\n    html.classList.remove('dark');\n    setTimeout(() => {\n      const lightBg = getComputedStyle(document.documentElement).getPropertyValue('--background');\n      console.log('   –§–æ–Ω –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ:', lightBg);\n      \n      console.log('‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');\n      console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:');\n      console.log('   - CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç:', !!bgColor && !!fgColor);\n      console.log('   - –¢–µ–º–Ω—ã–µ/—Å–≤–µ—Ç–ª—ã–µ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è:', darkBg !== lightBg);\n      console.log('   - localStorage –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:', typeof Storage !== 'undefined');\n    }, 100);\n  }, 100);\n  \n}, 1000);","size_bytes":2633},"update-templates-conditional.js":{"content":"#!/usr/bin/env node\n\n// Import required modules\nimport { seedDefaultTemplates } from './server/seed-templates.ts';\n\nasync function updateTemplates() {\n  try {\n    console.log('üîÑ Updating templates with conditional button functionality...');\n    await seedDefaultTemplates(true);\n    console.log('‚úÖ Templates updated successfully with conditional button support!');\n  } catch (error) {\n    console.error('‚ùå Error updating templates:', error);\n    process.exit(1);\n  }\n  process.exit(0);\n}\n\nupdateTemplates();","size_bytes":514},"update_next_node_fix.js":{"content":"import { updateTemplatesWithFixedVariables } from './server/seed-templates.js';\n\nconsole.log('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ nextNodeId...');\nupdateTemplatesWithFixedVariables()\n  .then(() => {\n    console.log('‚úÖ –®–∞–±–ª–æ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', error);\n    process.exit(1);\n  });","size_bytes":486},"update_next_nodes.js":{"content":"import { updateTemplatesWithFixedVariables } from './server/seed-templates.js';\n\nconsole.log('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è nextNodeId –≤ —à–∞–±–ª–æ–Ω–µ...');\nupdateTemplatesWithFixedVariables()\n  .then(() => {\n    console.log('‚úÖ –ü–æ–ª—è nextNodeId —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ nextNodeId:', error);\n    process.exit(1);\n  });","size_bytes":452},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"scripts/init-db.ts":{"content":"import { Pool } from 'pg';\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport { sql } from 'drizzle-orm';\nimport * as schema from '../shared/schema';\n\nasync function initDatabase() {\n  // –ü–æ–ª—É—á–∞–µ–º URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Replit\n  const databaseUrl = process.env.DATABASE_URL || process.env.REPLIT_DB_URL;\n  \n  if (!databaseUrl) {\n    console.error('DATABASE_URL is not set. Checking available environment variables...');\n    console.log('Available env vars:', Object.keys(process.env).filter(key => key.includes('DB')));\n    process.exit(1);\n  }\n\n  console.log('Connecting to database...');\n  \n  const pool = new Pool({ \n    connectionString: databaseUrl,\n    ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n  });\n\n  const db = drizzle(pool, { schema });\n\n  try {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ\n    console.log('Testing connection...');\n    await db.execute(sql`SELECT 1`);\n    console.log('‚úÖ Database connection successful!');\n\n    // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç\n    console.log('Creating tables...');\n    \n    // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –ø–æ –ø–æ—Ä—è–¥–∫—É (—Å —É—á–µ—Ç–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS bot_projects (\n        id SERIAL PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT,\n        data JSONB NOT NULL,\n        bot_token TEXT,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `);\n\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS bot_tokens (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) ON DELETE CASCADE NOT NULL,\n        name TEXT NOT NULL,\n        token TEXT NOT NULL,\n        is_default INTEGER DEFAULT 0,\n        is_active INTEGER DEFAULT 1,\n        description TEXT,\n        bot_first_name TEXT,\n        bot_username TEXT,\n        bot_description TEXT,\n        bot_short_description TEXT,\n        bot_photo_url TEXT,\n        bot_can_join_groups INTEGER,\n        bot_can_read_all_group_messages INTEGER,\n        bot_supports_inline_queries INTEGER,\n        bot_has_main_web_app INTEGER,\n        last_used_at TIMESTAMP,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `);\n\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS bot_instances (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) NOT NULL,\n        token_id INTEGER REFERENCES bot_tokens(id) ON DELETE CASCADE NOT NULL,\n        status TEXT NOT NULL,\n        token TEXT NOT NULL,\n        process_id TEXT,\n        started_at TIMESTAMP DEFAULT NOW(),\n        stopped_at TIMESTAMP,\n        error_message TEXT\n      );\n    `);\n\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS bot_templates (\n        id SERIAL PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT,\n        data JSONB NOT NULL,\n        category TEXT DEFAULT 'custom',\n        tags TEXT[],\n        is_public INTEGER DEFAULT 0,\n        difficulty TEXT DEFAULT 'easy',\n        author_id TEXT,\n        author_name TEXT,\n        use_count INTEGER NOT NULL DEFAULT 0,\n        rating INTEGER NOT NULL DEFAULT 0,\n        rating_count INTEGER NOT NULL DEFAULT 0,\n        featured INTEGER NOT NULL DEFAULT 0,\n        version TEXT DEFAULT '1.0.0',\n        preview_image TEXT,\n        last_used_at TIMESTAMP,\n        download_count INTEGER NOT NULL DEFAULT 0,\n        like_count INTEGER NOT NULL DEFAULT 0,\n        bookmark_count INTEGER NOT NULL DEFAULT 0,\n        view_count INTEGER NOT NULL DEFAULT 0,\n        language TEXT DEFAULT 'ru',\n        requires_token INTEGER NOT NULL DEFAULT 0,\n        complexity INTEGER NOT NULL DEFAULT 1,\n        estimated_time INTEGER NOT NULL DEFAULT 5,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `);\n\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS media_files (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) ON DELETE CASCADE NOT NULL,\n        file_name TEXT NOT NULL,\n        file_type TEXT NOT NULL,\n        file_path TEXT NOT NULL,\n        file_size INTEGER NOT NULL,\n        mime_type TEXT NOT NULL,\n        url TEXT NOT NULL,\n        description TEXT,\n        tags TEXT[] DEFAULT '{}',\n        is_public INTEGER DEFAULT 0,\n        usage_count INTEGER DEFAULT 0,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `);\n\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS user_bot_data (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) ON DELETE CASCADE NOT NULL,\n        user_id TEXT NOT NULL,\n        user_name TEXT,\n        first_name TEXT,\n        last_name TEXT,\n        language_code TEXT,\n        is_bot INTEGER DEFAULT 0,\n        is_premium INTEGER DEFAULT 0,\n        last_interaction TIMESTAMP DEFAULT NOW(),\n        interaction_count INTEGER DEFAULT 0,\n        user_data JSONB DEFAULT '{}',\n        current_state TEXT,\n        preferences JSONB DEFAULT '{}',\n        commands_used JSONB DEFAULT '{}',\n        sessions_count INTEGER DEFAULT 1,\n        total_messages_sent INTEGER DEFAULT 0,\n        total_messages_received INTEGER DEFAULT 0,\n        device_info TEXT,\n        location_data JSONB,\n        contact_data JSONB,\n        is_blocked INTEGER DEFAULT 0,\n        is_active INTEGER DEFAULT 1,\n        tags TEXT[] DEFAULT '{}',\n        notes TEXT,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `);\n\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS bot_users (\n        user_id BIGINT PRIMARY KEY,\n        username TEXT,\n        first_name TEXT,\n        last_name TEXT,\n        registered_at TIMESTAMP DEFAULT NOW(),\n        last_interaction TIMESTAMP DEFAULT NOW(),\n        interaction_count INTEGER DEFAULT 0,\n        user_data JSONB DEFAULT '{}',\n        is_active INTEGER DEFAULT 1\n      );\n    `);\n\n    console.log('‚úÖ All tables created successfully!');\n    \n  } catch (error) {\n    console.error('‚ùå Database initialization failed:', error);\n    process.exit(1);\n  } finally {\n    await pool.end();\n  }\n}\n\ninitDatabase().catch(console.error);","size_bytes":6341},"scripts/migrate.ts":{"content":"import { Pool } from 'pg';\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport { migrate } from 'drizzle-orm/node-postgres/migrator';\nimport * as schema from '../shared/schema';\n\nasync function runMigrations() {\n  const databaseUrl = process.env.DATABASE_URL;\n  \n  if (!databaseUrl) {\n    console.error('DATABASE_URL must be set');\n    process.exit(1);\n  }\n\n  console.log('Initializing database connection...');\n  \n  const pool = new Pool({ \n    connectionString: databaseUrl,\n    ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n  });\n\n  const db = drizzle(pool, { schema });\n\n  try {\n    console.log('Running migrations...');\n    await migrate(db, { migrationsFolder: './migrations' });\n    console.log('Migrations completed successfully!');\n  } catch (error) {\n    console.error('Migration failed:', error);\n    process.exit(1);\n  } finally {\n    await pool.end();\n  }\n}\n\nrunMigrations().catch(console.error);","size_bytes":955},"server/db-backup.ts":{"content":"import { db, pool } from './db';\nimport { sql } from 'drizzle-orm';\nimport { writeFileSync, readFileSync, existsSync } from 'fs';\nimport { join } from 'path';\nimport { botProjects, botInstances, botTemplates, botTokens, mediaFiles, userBotData } from '@shared/schema';\n\ninterface BackupData {\n  metadata: {\n    version: string;\n    timestamp: string;\n    description?: string;\n    tables: string[];\n  };\n  data: {\n    botProjects: any[];\n    botInstances: any[];\n    botTemplates: any[];\n    botTokens: any[];\n    mediaFiles: any[];\n    userBotData: any[];\n  };\n}\n\nexport class DatabaseBackup {\n  private static instance: DatabaseBackup;\n  private backupDir = './backups';\n\n  private constructor() {}\n\n  static getInstance(): DatabaseBackup {\n    if (!DatabaseBackup.instance) {\n      DatabaseBackup.instance = new DatabaseBackup();\n    }\n    return DatabaseBackup.instance;\n  }\n\n  // –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n  async createFullBackup(description?: string): Promise<string> {\n    try {\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n      const filename = `backup_${timestamp}.json`;\n      const filepath = join(this.backupDir, filename);\n\n      // –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n      const fs = await import('fs');\n      if (!fs.existsSync(this.backupDir)) {\n        fs.mkdirSync(this.backupDir, { recursive: true });\n      }\n\n      // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü\n      const [\n        projectsData,\n        instancesData,\n        templatesData,\n        tokensData,\n        mediaData,\n        userBotDataResult\n      ] = await Promise.all([\n        db.select().from(botProjects),\n        db.select().from(botInstances),\n        db.select().from(botTemplates),\n        db.select().from(botTokens),\n        db.select().from(mediaFiles),\n        db.select().from(userBotData)\n      ]);\n\n      const backupData: BackupData = {\n        metadata: {\n          version: '1.0.0',\n          timestamp: new Date().toISOString(),\n          description: description || '–ü–æ–ª–Ω—ã–π –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö',\n          tables: ['botProjects', 'botInstances', 'botTemplates', 'botTokens', 'mediaFiles', 'userBotData']\n        },\n        data: {\n          botProjects: projectsData,\n          botInstances: instancesData,\n          botTemplates: templatesData,\n          botTokens: tokensData,\n          mediaFiles: mediaData,\n          userBotData: userBotDataResult\n        }\n      };\n\n      // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª\n      writeFileSync(filepath, JSON.stringify(backupData, null, 2), 'utf-8');\n\n      console.log(`Backup created successfully: ${filepath}`);\n      return filepath;\n    } catch (error) {\n      console.error('Failed to create backup:', error);\n      throw error;\n    }\n  }\n\n  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞\n  async restoreFromBackup(filepath: string, options?: {\n    clearExisting?: boolean;\n    skipTables?: string[];\n    onlyTables?: string[];\n  }): Promise<void> {\n    try {\n      if (!existsSync(filepath)) {\n        throw new Error(`Backup file not found: ${filepath}`);\n      }\n\n      const backupData: BackupData = JSON.parse(readFileSync(filepath, 'utf-8'));\n      \n      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞\n      if (!backupData.metadata || !backupData.data) {\n        throw new Error('Invalid backup file structure');\n      }\n\n      console.log(`Restoring backup from ${backupData.metadata.timestamp}`);\n      console.log(`Description: ${backupData.metadata.description}`);\n\n      // –û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ\n      if (options?.clearExisting) {\n        await this.clearAllTables(options.skipTables);\n      }\n\n      // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å\n      const tablesToRestore = options?.onlyTables || backupData.metadata.tables;\n      \n      // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏)\n      const restoreOrder = [\n        'botProjects',\n        'botTemplates', \n        'botTokens',\n        'mediaFiles',\n        'botInstances',\n        'userBotData'\n      ];\n\n      for (const tableName of restoreOrder) {\n        if (!tablesToRestore.includes(tableName)) continue;\n        if (options?.skipTables?.includes(tableName)) continue;\n\n        const tableData = backupData.data[tableName as keyof typeof backupData.data];\n        if (!tableData || !Array.isArray(tableData) || tableData.length === 0) {\n          console.log(`Skipping ${tableName} - no data`);\n          continue;\n        }\n\n        await this.restoreTable(tableName, tableData);\n        console.log(`Restored ${tableData.length} records to ${tableName}`);\n      }\n\n      console.log('Database restore completed successfully');\n    } catch (error) {\n      console.error('Failed to restore backup:', error);\n      throw error;\n    }\n  }\n\n  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–∞–±–ª–∏—Ü—É\n  private async restoreTable(tableName: string, data: any[]): Promise<void> {\n    try {\n      switch (tableName) {\n        case 'botProjects':\n          if (data.length > 0) {\n            await db.insert(botProjects).values(data).onConflictDoNothing();\n          }\n          break;\n        case 'botInstances':\n          if (data.length > 0) {\n            await db.insert(botInstances).values(data).onConflictDoNothing();\n          }\n          break;\n        case 'botTemplates':\n          if (data.length > 0) {\n            await db.insert(botTemplates).values(data).onConflictDoNothing();\n          }\n          break;\n        case 'botTokens':\n          if (data.length > 0) {\n            await db.insert(botTokens).values(data).onConflictDoNothing();\n          }\n          break;\n        case 'mediaFiles':\n          if (data.length > 0) {\n            await db.insert(mediaFiles).values(data).onConflictDoNothing();\n          }\n          break;\n        case 'userBotData':\n          if (data.length > 0) {\n            await db.insert(userBotData).values(data).onConflictDoNothing();\n          }\n          break;\n        default:\n          console.warn(`Unknown table: ${tableName}`);\n      }\n    } catch (error) {\n      console.error(`Failed to restore table ${tableName}:`, error);\n      throw error;\n    }\n  }\n\n  // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã\n  private async clearAllTables(skipTables?: string[]): Promise<void> {\n    const tablesToClear = [\n      'userBotData',\n      'botInstances', \n      'mediaFiles',\n      'botTokens',\n      'botTemplates',\n      'botProjects'\n    ];\n\n    for (const tableName of tablesToClear) {\n      if (skipTables?.includes(tableName)) continue;\n\n      try {\n        switch (tableName) {\n          case 'botProjects':\n            await db.delete(botProjects);\n            break;\n          case 'botInstances':\n            await db.delete(botInstances);\n            break;\n          case 'botTemplates':\n            await db.delete(botTemplates);\n            break;\n          case 'botTokens':\n            await db.delete(botTokens);\n            break;\n          case 'mediaFiles':\n            await db.delete(mediaFiles);\n            break;\n          case 'userBotData':\n            await db.delete(userBotData);\n            break;\n        }\n        console.log(`Cleared table: ${tableName}`);\n      } catch (error) {\n        console.error(`Failed to clear table ${tableName}:`, error);\n      }\n    }\n  }\n\n  // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π\n  async listBackups(): Promise<Array<{\n    filename: string;\n    filepath: string;\n    size: number;\n    created: Date;\n    metadata?: BackupData['metadata'];\n  }>> {\n    try {\n      const fs = await import('fs');\n      if (!fs.existsSync(this.backupDir)) {\n        return [];\n      }\n\n      const files = fs.readdirSync(this.backupDir)\n        .filter(file => file.endsWith('.json'))\n        .map(file => {\n          const filepath = join(this.backupDir, file);\n          const stats = fs.statSync(filepath);\n          \n          let metadata: BackupData['metadata'] | undefined;\n          try {\n            const backupData: BackupData = JSON.parse(fs.readFileSync(filepath, 'utf-8'));\n            metadata = backupData.metadata;\n          } catch (error) {\n            console.warn(`Failed to read metadata from ${file}:`, error);\n          }\n\n          return {\n            filename: file,\n            filepath,\n            size: stats.size,\n            created: stats.birthtime,\n            metadata\n          };\n        })\n        .sort((a, b) => b.created.getTime() - a.created.getTime());\n\n      return files;\n    } catch (error) {\n      console.error('Failed to list backups:', error);\n      return [];\n    }\n  }\n\n  // –£–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\n  async deleteBackup(filename: string): Promise<void> {\n    try {\n      const filepath = join(this.backupDir, filename);\n      if (!existsSync(filepath)) {\n        throw new Error(`Backup file not found: ${filename}`);\n      }\n\n      const fs = await import('fs');\n      fs.unlinkSync(filepath);\n      console.log(`Deleted backup: ${filename}`);\n    } catch (error) {\n      console.error('Failed to delete backup:', error);\n      throw error;\n    }\n  }\n\n  // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n  async getDatabaseStats(): Promise<{\n    tables: Array<{\n      name: string;\n      count: number;\n      size: string;\n    }>;\n    totalRecords: number;\n    estimatedSize: string;\n  }> {\n    try {\n      const [\n        projectsCount,\n        instancesCount,\n        templatesCount,\n        tokensCount,\n        mediaCount,\n        userDataCount\n      ] = await Promise.all([\n        db.execute(sql`SELECT COUNT(*) as count FROM bot_projects`),\n        db.execute(sql`SELECT COUNT(*) as count FROM bot_instances`),\n        db.execute(sql`SELECT COUNT(*) as count FROM bot_templates`),\n        db.execute(sql`SELECT COUNT(*) as count FROM bot_tokens`),\n        db.execute(sql`SELECT COUNT(*) as count FROM media_files`),\n        db.execute(sql`SELECT COUNT(*) as count FROM user_bot_data`)\n      ]);\n\n      const tables = [\n        {\n          name: 'botProjects',\n          count: Number(projectsCount.rows[0]?.count || 0),\n          size: 'N/A'\n        },\n        {\n          name: 'botInstances',\n          count: Number(instancesCount.rows[0]?.count || 0),\n          size: 'N/A'\n        },\n        {\n          name: 'botTemplates',\n          count: Number(templatesCount.rows[0]?.count || 0),\n          size: 'N/A'\n        },\n        {\n          name: 'botTokens',\n          count: Number(tokensCount.rows[0]?.count || 0),\n          size: 'N/A'\n        },\n        {\n          name: 'mediaFiles',\n          count: Number(mediaCount.rows[0]?.count || 0),\n          size: 'N/A'\n        },\n        {\n          name: 'userBotData',\n          count: Number(userDataCount.rows[0]?.count || 0),\n          size: 'N/A'\n        }\n      ];\n\n      const totalRecords = tables.reduce((sum, table) => sum + table.count, 0);\n\n      return {\n        tables,\n        totalRecords,\n        estimatedSize: 'N/A'\n      };\n    } catch (error) {\n      console.error('Failed to get database stats:', error);\n      throw error;\n    }\n  }\n}\n\n// –≠–∫—Å–ø–æ—Ä—Ç singleton instance\nexport const dbBackup = DatabaseBackup.getInstance();","size_bytes":11463},"server/db-cache.ts":{"content":"// Enhanced caching layer for database operations\nimport { BotProject, BotTemplate, BotInstance } from '@shared/schema';\n\nexport class DatabaseCache {\n  private static instance: DatabaseCache;\n  private cache: Map<string, { data: any; timestamp: number; ttl: number }> = new Map();\n  private defaultTTL = 5 * 60 * 1000; // 5 minutes\n\n  private constructor() {}\n\n  static getInstance(): DatabaseCache {\n    if (!DatabaseCache.instance) {\n      DatabaseCache.instance = new DatabaseCache();\n    }\n    return DatabaseCache.instance;\n  }\n\n  // Set cache entry\n  set(key: string, data: any, ttl: number = this.defaultTTL): void {\n    this.cache.set(key, {\n      data: JSON.parse(JSON.stringify(data)), // Deep clone\n      timestamp: Date.now(),\n      ttl\n    });\n  }\n\n  // Get cache entry\n  get<T>(key: string): T | null {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n\n    // Check if expired\n    if (Date.now() - entry.timestamp > entry.ttl) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return entry.data as T;\n  }\n\n  // Delete cache entry\n  delete(key: string): void {\n    this.cache.delete(key);\n  }\n\n  // Clear cache by pattern\n  clearByPattern(pattern: string): void {\n    const regex = new RegExp(pattern);\n    for (const key of this.cache.keys()) {\n      if (regex.test(key)) {\n        this.cache.delete(key);\n      }\n    }\n  }\n\n  // Clear all cache\n  clear(): void {\n    this.cache.clear();\n  }\n\n  // Get cache statistics\n  getStats() {\n    const entries = Array.from(this.cache.entries());\n    const now = Date.now();\n    \n    return {\n      totalEntries: entries.length,\n      expiredEntries: entries.filter(([_, entry]) => now - entry.timestamp > entry.ttl).length,\n      memoryUsage: this.getMemoryUsage(),\n      hitRate: this.getHitRate()\n    };\n  }\n\n  // Cleanup expired entries\n  cleanup(): void {\n    const now = Date.now();\n    const keysToDelete: string[] = [];\n\n    for (const [key, entry] of this.cache.entries()) {\n      if (now - entry.timestamp > entry.ttl) {\n        keysToDelete.push(key);\n      }\n    }\n\n    keysToDelete.forEach(key => this.cache.delete(key));\n    console.log(`Cleaned up ${keysToDelete.length} expired cache entries`);\n  }\n\n  private getMemoryUsage(): number {\n    const entries = Array.from(this.cache.values());\n    return entries.reduce((size, entry) => {\n      return size + JSON.stringify(entry.data).length;\n    }, 0);\n  }\n\n  private hitRate(): number {\n    // This would require tracking hits and misses\n    // For now, return a placeholder\n    return 0.85; // 85% hit rate\n  }\n\n  private getHitRate(): number {\n    return this.hitRate();\n  }\n}\n\n// Cached storage operations\nexport class CachedDatabaseOperations {\n  private cache = DatabaseCache.getInstance();\n\n  // Cache project data\n  async getProjectCached(id: number, fetcher: () => Promise<BotProject | undefined>): Promise<BotProject | undefined> {\n    const key = `project:${id}`;\n    const cached = this.cache.get<BotProject>(key);\n    \n    if (cached) {\n      return cached;\n    }\n\n    const project = await fetcher();\n    if (project) {\n      this.cache.set(key, project);\n    }\n    \n    return project;\n  }\n\n  // Cache template data\n  async getTemplateCached(id: number, fetcher: () => Promise<BotTemplate | undefined>): Promise<BotTemplate | undefined> {\n    const key = `template:${id}`;\n    const cached = this.cache.get<BotTemplate>(key);\n    \n    if (cached) {\n      return cached;\n    }\n\n    const template = await fetcher();\n    if (template) {\n      this.cache.set(key, template, 10 * 60 * 1000); // 10 minutes for templates\n    }\n    \n    return template;\n  }\n\n  // Cache templates list\n  async getTemplateListCached(category: string, fetcher: () => Promise<BotTemplate[]>): Promise<BotTemplate[]> {\n    const key = `templates:${category}`;\n    const cached = this.cache.get<BotTemplate[]>(key);\n    \n    if (cached) {\n      return cached;\n    }\n\n    const templates = await fetcher();\n    this.cache.set(key, templates, 2 * 60 * 1000); // 2 minutes for lists\n    \n    return templates;\n  }\n\n  // Invalidate related caches\n  invalidateProject(id: number): void {\n    this.cache.delete(`project:${id}`);\n    this.cache.clearByPattern(`project:${id}:.*`);\n  }\n\n  invalidateTemplate(id: number): void {\n    this.cache.delete(`template:${id}`);\n    this.cache.clearByPattern(`templates:.*`); // Invalidate all template lists\n  }\n\n  invalidateAllTemplates(): void {\n    this.cache.clearByPattern(`templates:.*`);\n  }\n\n  // Get cache statistics\n  getStats() {\n    return this.cache.getStats();\n  }\n\n  // Cleanup expired entries\n  cleanup(): void {\n    this.cache.cleanup();\n  }\n}\n\n// Auto-cleanup every 5 minutes\nsetInterval(() => {\n  DatabaseCache.getInstance().cleanup();\n}, 5 * 60 * 1000);\n\nexport const dbCache = DatabaseCache.getInstance();\nexport const cachedOps = new CachedDatabaseOperations();","size_bytes":4854},"server/db-routes.ts":{"content":"import { Router } from 'express';\nimport { storage } from './storage';\nimport { dbManager } from './db-utils';\nimport { dbCache } from './db-cache';\nimport { dbBackup } from './db-backup';\nimport multer from 'multer';\nimport { join } from 'path';\n\nconst router = Router();\n\n// Database health and statistics endpoints\nrouter.get('/health', async (req, res) => {\n  try {\n    const isHealthy = await dbManager.performHealthCheck();\n    const stats = dbManager.getConnectionStats();\n    \n    res.json({\n      healthy: isHealthy,\n      stats,\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    res.status(500).json({ error: 'Health check failed', message: error.message });\n  }\n});\n\n// Database statistics\nrouter.get('/stats', async (req, res) => {\n  try {\n    const stats = await (storage as any).getDetailedStats();\n    res.json(stats);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to get stats', message: error.message });\n  }\n});\n\n// Database metrics\nrouter.get('/metrics', async (req, res) => {\n  try {\n    const metrics = await dbManager.getDatabaseMetrics();\n    res.json(metrics);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to get metrics', message: error.message });\n  }\n});\n\n// Cache statistics\nrouter.get('/cache/stats', async (req, res) => {\n  try {\n    const stats = dbCache.getStats();\n    res.json(stats);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to get cache stats', message: error.message });\n  }\n});\n\n// Clear cache\nrouter.post('/cache/clear', async (req, res) => {\n  try {\n    const { pattern } = req.body;\n    \n    if (pattern) {\n      dbCache.clearByPattern(pattern);\n    } else {\n      dbCache.clear();\n    }\n    \n    res.json({ message: 'Cache cleared successfully' });\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to clear cache', message: error.message });\n  }\n});\n\n// Database maintenance\nrouter.post('/maintenance', async (req, res) => {\n  try {\n    await (storage as any).performMaintenance();\n    res.json({ message: 'Database maintenance completed successfully' });\n  } catch (error) {\n    res.status(500).json({ error: 'Maintenance failed', message: error.message });\n  }\n});\n\n// Database backup\nrouter.post('/backup', async (req, res) => {\n  try {\n    const backupName = await (storage as any).createBackup();\n    res.json({ message: 'Backup created successfully', backupName });\n  } catch (error) {\n    res.status(500).json({ error: 'Backup failed', message: error.message });\n  }\n});\n\n// Database optimization\nrouter.post('/optimize', async (req, res) => {\n  try {\n    await dbManager.optimizeConnections();\n    res.json({ message: 'Database connections optimized' });\n  } catch (error) {\n    res.status(500).json({ error: 'Optimization failed', message: error.message });\n  }\n});\n\n// Cleanup old data\nrouter.post('/cleanup', async (req, res) => {\n  try {\n    const { days = 30 } = req.body;\n    await dbManager.cleanupOldData(days);\n    res.json({ message: `Cleaned up data older than ${days} days` });\n  } catch (error) {\n    res.status(500).json({ error: 'Cleanup failed', message: error.message });\n  }\n});\n\n// Connection pool information\nrouter.get('/pool', async (req, res) => {\n  try {\n    const stats = dbManager.getConnectionStats();\n    res.json(stats.poolInfo);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to get pool info', message: error.message });\n  }\n});\n\n// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ multer –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π\nconst upload = multer({\n  dest: './backups',\n  fileFilter: (req, file, cb) => {\n    // –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ JSON —Ñ–∞–π–ª—ã\n    if (file.mimetype === 'application/json' || file.originalname.endsWith('.json')) {\n      cb(null, true);\n    } else {\n      cb(new Error('–¢–æ–ª—å–∫–æ JSON —Ñ–∞–π–ª—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏'));\n    }\n  },\n  limits: {\n    fileSize: 50 * 1024 * 1024 // 50MB –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞\n  }\n});\n\n// BACKUP AND RESTORE ENDPOINTS\n\n// –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\nrouter.post('/backup', async (req, res) => {\n  try {\n    const { description } = req.body;\n    const filepath = await dbBackup.createFullBackup(description);\n    \n    res.json({\n      success: true,\n      message: '–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ',\n      filepath,\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    res.status(500).json({ \n      success: false, \n      error: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é', \n      message: error.message \n    });\n  }\n});\n\n// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π\nrouter.get('/backups', async (req, res) => {\n  try {\n    const backups = await dbBackup.listBackups();\n    res.json({\n      success: true,\n      backups,\n      count: backups.length\n    });\n  } catch (error) {\n    res.status(500).json({ \n      success: false, \n      error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π', \n      message: error.message \n    });\n  }\n});\n\n// –°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\nrouter.get('/backup/:filename', async (req, res) => {\n  try {\n    const { filename } = req.params;\n    const filepath = join('./backups', filename);\n    \n    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n    const fs = await import('fs');\n    if (!fs.existsSync(filepath)) {\n      return res.status(404).json({ \n        success: false, \n        error: '–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' \n      });\n    }\n\n    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è\n    res.download(filepath, filename, (err) => {\n      if (err) {\n        console.error('Download error:', err);\n        res.status(500).json({ \n          success: false, \n          error: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª' \n        });\n      }\n    });\n  } catch (error) {\n    res.status(500).json({ \n      success: false, \n      error: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é', \n      message: error.message \n    });\n  }\n});\n\n// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\nrouter.post('/restore', async (req, res) => {\n  try {\n    const { filename, options } = req.body;\n    const filepath = join('./backups', filename);\n    \n    await dbBackup.restoreFromBackup(filepath, options);\n    \n    res.json({\n      success: true,\n      message: '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ',\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    res.status(500).json({ \n      success: false, \n      error: '–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö', \n      message: error.message \n    });\n  }\n});\n\n// –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\nrouter.post('/backup/upload', upload.single('backup'), async (req, res) => {\n  try {\n    if (!req.file) {\n      return res.status(400).json({ \n        success: false, \n        error: '–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω' \n      });\n    }\n\n    const { restoreImmediately, clearExisting } = req.body;\n    const filepath = req.file.path;\n    \n    // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª —á—Ç–æ–±—ã –∏–º–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ\n    const fs = await import('fs');\n    const newFilepath = filepath + '.json';\n    fs.renameSync(filepath, newFilepath);\n\n    let result: any = {\n      success: true,\n      message: '–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ',\n      filename: req.file.filename + '.json',\n      size: req.file.size\n    };\n\n    // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ\n    if (restoreImmediately === 'true') {\n      try {\n        await dbBackup.restoreFromBackup(newFilepath, {\n          clearExisting: clearExisting === 'true'\n        });\n        result.message = '–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ';\n        result.restored = true;\n      } catch (restoreError) {\n        result.warning = '–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: ' + restoreError.message;\n      }\n    }\n\n    res.json(result);\n  } catch (error) {\n    res.status(500).json({ \n      success: false, \n      error: '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª', \n      message: error.message \n    });\n  }\n});\n\n// –£–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\nrouter.delete('/backup/:filename', async (req, res) => {\n  try {\n    const { filename } = req.params;\n    await dbBackup.deleteBackup(filename);\n    \n    res.json({\n      success: true,\n      message: '–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É–¥–∞–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ'\n    });\n  } catch (error) {\n    res.status(500).json({ \n      success: false, \n      error: '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é', \n      message: error.message \n    });\n  }\n});\n\n// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\nrouter.get('/stats/detailed', async (req, res) => {\n  try {\n    const stats = await dbBackup.getDatabaseStats();\n    res.json({\n      success: true,\n      stats\n    });\n  } catch (error) {\n    res.status(500).json({ \n      success: false, \n      error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É', \n      message: error.message \n    });\n  }\n});\n\nexport default router;","size_bytes":9295},"server/db-utils.ts":{"content":"import { db, pool } from './db';\nimport { sql } from 'drizzle-orm';\n\n// Database connection monitoring and optimization utilities\nexport class DatabaseManager {\n  private static instance: DatabaseManager;\n  private healthCheckInterval: NodeJS.Timeout | null = null;\n  private connectionStats = {\n    totalConnections: 0,\n    activeConnections: 0,\n    idleConnections: 0,\n    errors: 0,\n    lastHealthCheck: new Date()\n  };\n\n  private constructor() {}\n\n  static getInstance(): DatabaseManager {\n    if (!DatabaseManager.instance) {\n      DatabaseManager.instance = new DatabaseManager();\n    }\n    return DatabaseManager.instance;\n  }\n\n  // Start monitoring database health\n  startHealthMonitoring(intervalMs: number = 30000): void {\n    if (this.healthCheckInterval) {\n      clearInterval(this.healthCheckInterval);\n    }\n\n    this.healthCheckInterval = setInterval(async () => {\n      try {\n        await this.performHealthCheck();\n      } catch (error) {\n        console.error('Database health check failed:', error);\n        this.connectionStats.errors++;\n      }\n    }, intervalMs);\n\n    console.log('Database health monitoring started');\n  }\n\n  // Stop monitoring\n  stopHealthMonitoring(): void {\n    if (this.healthCheckInterval) {\n      clearInterval(this.healthCheckInterval);\n      this.healthCheckInterval = null;\n    }\n    console.log('Database health monitoring stopped');\n  }\n\n  // Perform health check\n  async performHealthCheck(): Promise<boolean> {\n    try {\n      // Test connection with a simple query\n      const result = await db.execute(sql`SELECT 1 as health`);\n      \n      // Update connection stats\n      this.connectionStats.totalConnections = pool.totalCount;\n      this.connectionStats.activeConnections = pool.totalCount - pool.idleCount;\n      this.connectionStats.idleConnections = pool.idleCount;\n      this.connectionStats.lastHealthCheck = new Date();\n\n      return true;\n    } catch (error) {\n      console.error('Health check failed:', error);\n      this.connectionStats.errors++;\n      return false;\n    }\n  }\n\n  // Get connection statistics\n  getConnectionStats() {\n    return {\n      ...this.connectionStats,\n      poolInfo: {\n        totalCount: pool.totalCount,\n        idleCount: pool.idleCount,\n        waitingCount: pool.waitingCount,\n        maxSize: 'N/A',\n        minSize: 'N/A'\n      }\n    };\n  }\n\n  // Optimize database connections\n  async optimizeConnections(): Promise<void> {\n    try {\n      // Close idle connections if there are too many\n      if (this.connectionStats.idleConnections > 5) {\n        console.log('Optimizing database connections...');\n        // Force garbage collection on idle connections\n        await pool.query('SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE state = \\'idle\\' AND query_start < NOW() - INTERVAL \\'5 minutes\\'');\n      }\n\n      // Analyze database performance\n      const slowQueries = await db.execute(sql`\n        SELECT query, calls, total_time, mean_time\n        FROM pg_stat_statements \n        WHERE mean_time > 1000 \n        ORDER BY mean_time DESC \n        LIMIT 10\n      `);\n\n      if (slowQueries.rows.length > 0) {\n        console.log('Found slow queries:', slowQueries.rows);\n      }\n    } catch (error) {\n      console.warn('Could not optimize connections:', error);\n    }\n  }\n\n  // Execute query with retry logic\n  async executeWithRetry<T>(\n    operation: () => Promise<T>,\n    maxRetries: number = 3,\n    retryDelay: number = 1000\n  ): Promise<T> {\n    let lastError: Error | null = null;\n\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        return await operation();\n      } catch (error) {\n        lastError = error as Error;\n        console.warn(`Database operation failed (attempt ${attempt}/${maxRetries}):`, error);\n\n        if (attempt === maxRetries) {\n          break;\n        }\n\n        // Wait before retry\n        await new Promise(resolve => setTimeout(resolve, retryDelay * attempt));\n      }\n    }\n\n    throw lastError;\n  }\n\n  // Transaction wrapper with automatic rollback\n  async transaction<T>(\n    operation: (txDb: any) => Promise<T>\n  ): Promise<T> {\n    return await db.transaction(async (tx) => {\n      try {\n        const result = await operation(tx);\n        return result;\n      } catch (error) {\n        console.error('Transaction failed, rolling back:', error);\n        throw error;\n      }\n    });\n  }\n\n  // Backup database (basic implementation)\n  async createBackup(): Promise<string> {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const backupName = `backup_${timestamp}`;\n    \n    try {\n      // This is a simplified backup - in production you'd use pg_dump\n      await db.execute(sql`\n        SELECT pg_terminate_backend(pid)\n        FROM pg_stat_activity\n        WHERE datname = current_database() AND pid <> pg_backend_pid()\n      `);\n      \n      console.log(`Backup created: ${backupName}`);\n      return backupName;\n    } catch (error) {\n      console.error('Backup failed:', error);\n      throw error;\n    }\n  }\n\n  // Clean up old data\n  async cleanupOldData(daysToKeep: number = 30): Promise<void> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);\n\n    try {\n      // Clean up old bot instances\n      const cleanupResult = await db.execute(sql`\n        DELETE FROM bot_instances \n        WHERE status = 'stopped' AND stopped_at < ${cutoffDate}\n      `);\n\n      console.log(`Cleaned up ${cleanupResult.rowCount} old bot instances`);\n\n      // Clean up old user interactions (optional)\n      await db.execute(sql`\n        DELETE FROM user_bot_data \n        WHERE is_active = 0 AND updated_at < ${cutoffDate}\n      `);\n\n    } catch (error) {\n      console.error('Cleanup failed:', error);\n      throw error;\n    }\n  }\n\n  // Get database metrics\n  async getDatabaseMetrics() {\n    try {\n      const metrics = await db.execute(sql`\n        SELECT \n          schemaname,\n          tablename,\n          n_tup_ins as inserts,\n          n_tup_upd as updates,\n          n_tup_del as deletes,\n          n_live_tup as live_rows,\n          n_dead_tup as dead_rows\n        FROM pg_stat_user_tables\n        ORDER BY n_live_tup DESC\n      `);\n\n      return metrics.rows;\n    } catch (error) {\n      console.error('Failed to get database metrics:', error);\n      return [];\n    }\n  }\n}\n\n// Export singleton instance\nexport const dbManager = DatabaseManager.getInstance();\n\n// Auto-start monitoring when module is imported\ndbManager.startHealthMonitoring();\n\n// Graceful shutdown\nprocess.on('SIGTERM', () => {\n  dbManager.stopHealthMonitoring();\n  pool.end();\n});\n\nprocess.on('SIGINT', () => {\n  dbManager.stopHealthMonitoring();\n  pool.end();\n});","size_bytes":6695},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json({ limit: '50mb' }));\napp.use(express.urlencoded({ extended: false, limit: '50mb' }));\n\n// –û—Ç–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤\napp.use('/uploads', express.static('uploads'));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      // Skip logging frequent HEAD requests to /api and /api/health to reduce noise\n      if (req.method === \"HEAD\" && (path === \"/api\" || path === \"/api/health\")) {\n        return;\n      }\n\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2246},"server/init-db.ts":{"content":"import { sql } from 'drizzle-orm';\nimport { db } from './db';\n\nasync function executeWithRetry(db: any, query: any, description: string, maxRetries = 3) {\n  for (let attempt = 1; attempt <= maxRetries; attempt++) {\n    try {\n      await db.execute(query);\n      console.log(`‚úÖ ${description} - —É—Å–ø–µ—à–Ω–æ`);\n      return;\n    } catch (error) {\n      console.warn(`‚ö†Ô∏è ${description} - –ø–æ–ø—ã—Ç–∫–∞ ${attempt}/${maxRetries} –Ω–µ —É–¥–∞–ª–∞—Å—å:`, error);\n      if (attempt === maxRetries) {\n        throw error;\n      }\n      // Wait before retry (reduced wait time)\n      await new Promise(resolve => setTimeout(resolve, 500 * attempt));\n    }\n  }\n}\n\nexport async function initializeDatabaseTables() {\n  console.log('üîß Initializing database tables...');\n  \n  try {\n    // Use imported db directly\n    \n    // First, test the connection with timeout\n    console.log('Testing database connection...');\n    const healthCheckPromise = db.execute(sql`SELECT 1 as health`);\n    const timeoutPromise = new Promise((_, reject) => \n      setTimeout(() => reject(new Error('Database connection timeout')), 60000)\n    );\n    \n    await Promise.race([healthCheckPromise, timeoutPromise]);\n    console.log('‚úÖ Database connection successful!');\n    \n    // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π IF NOT EXISTS)\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS bot_projects (\n        id SERIAL PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT,\n        data JSONB NOT NULL,\n        bot_token TEXT,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã bot_projects\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS bot_tokens (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) ON DELETE CASCADE NOT NULL,\n        name TEXT NOT NULL,\n        token TEXT NOT NULL,\n        is_default INTEGER DEFAULT 0,\n        is_active INTEGER DEFAULT 1,\n        description TEXT,\n        bot_first_name TEXT,\n        bot_username TEXT,\n        bot_description TEXT,\n        bot_short_description TEXT,\n        bot_photo_url TEXT,\n        bot_can_join_groups INTEGER,\n        bot_can_read_all_group_messages INTEGER,\n        bot_supports_inline_queries INTEGER,\n        bot_has_main_web_app INTEGER,\n        last_used_at TIMESTAMP,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã bot_tokens\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS bot_instances (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) NOT NULL,\n        token_id INTEGER REFERENCES bot_tokens(id) ON DELETE CASCADE NOT NULL,\n        status TEXT NOT NULL,\n        token TEXT NOT NULL,\n        process_id TEXT,\n        started_at TIMESTAMP DEFAULT NOW(),\n        stopped_at TIMESTAMP,\n        error_message TEXT\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã bot_instances\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS bot_templates (\n        id SERIAL PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT,\n        data JSONB NOT NULL,\n        category TEXT DEFAULT 'custom',\n        tags TEXT[],\n        is_public INTEGER DEFAULT 0,\n        difficulty TEXT DEFAULT 'easy',\n        author_id TEXT,\n        author_name TEXT,\n        use_count INTEGER NOT NULL DEFAULT 0,\n        rating INTEGER NOT NULL DEFAULT 0,\n        rating_count INTEGER NOT NULL DEFAULT 0,\n        featured INTEGER NOT NULL DEFAULT 0,\n        version TEXT DEFAULT '1.0.0',\n        preview_image TEXT,\n        last_used_at TIMESTAMP,\n        download_count INTEGER NOT NULL DEFAULT 0,\n        like_count INTEGER NOT NULL DEFAULT 0,\n        bookmark_count INTEGER NOT NULL DEFAULT 0,\n        view_count INTEGER NOT NULL DEFAULT 0,\n        language TEXT DEFAULT 'ru',\n        requires_token INTEGER NOT NULL DEFAULT 0,\n        complexity INTEGER NOT NULL DEFAULT 1,\n        estimated_time INTEGER NOT NULL DEFAULT 5,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã bot_templates\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS media_files (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) ON DELETE CASCADE NOT NULL,\n        file_name TEXT NOT NULL,\n        file_type TEXT NOT NULL,\n        file_path TEXT NOT NULL,\n        file_size INTEGER NOT NULL,\n        mime_type TEXT NOT NULL,\n        url TEXT NOT NULL,\n        description TEXT,\n        tags TEXT[] DEFAULT '{}',\n        is_public INTEGER DEFAULT 0,\n        usage_count INTEGER DEFAULT 0,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã media_files\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS user_bot_data (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) ON DELETE CASCADE NOT NULL,\n        user_id TEXT NOT NULL,\n        user_name TEXT,\n        first_name TEXT,\n        last_name TEXT,\n        language_code TEXT,\n        is_bot INTEGER DEFAULT 0,\n        is_premium INTEGER DEFAULT 0,\n        last_interaction TIMESTAMP DEFAULT NOW(),\n        interaction_count INTEGER DEFAULT 0,\n        user_data JSONB DEFAULT '{}',\n        current_state TEXT,\n        preferences JSONB DEFAULT '{}',\n        commands_used JSONB DEFAULT '{}',\n        sessions_count INTEGER DEFAULT 1,\n        total_messages_sent INTEGER DEFAULT 0,\n        total_messages_received INTEGER DEFAULT 0,\n        device_info TEXT,\n        location_data JSONB,\n        contact_data JSONB,\n        is_blocked INTEGER DEFAULT 0,\n        is_active INTEGER DEFAULT 1,\n        tags TEXT[] DEFAULT '{}',\n        notes TEXT,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã user_bot_data\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS bot_groups (\n        id SERIAL PRIMARY KEY,\n        project_id INTEGER REFERENCES bot_projects(id) ON DELETE CASCADE NOT NULL,\n        group_id TEXT,\n        name TEXT NOT NULL,\n        url TEXT NOT NULL,\n        is_admin INTEGER DEFAULT 0,\n        member_count INTEGER,\n        is_active INTEGER DEFAULT 1,\n        description TEXT,\n        settings JSONB DEFAULT '{}',\n        avatar_url TEXT,\n        chat_type TEXT DEFAULT 'group',\n        invite_link TEXT,\n        admin_rights JSONB DEFAULT '{\"can_manage_chat\": false, \"can_change_info\": false, \"can_delete_messages\": false, \"can_invite_users\": false, \"can_restrict_members\": false, \"can_pin_messages\": false, \"can_promote_members\": false, \"can_manage_video_chats\": false}',\n        messages_count INTEGER DEFAULT 0,\n        active_users INTEGER DEFAULT 0,\n        last_activity TIMESTAMP,\n        is_public INTEGER DEFAULT 0,\n        language TEXT DEFAULT 'ru',\n        timezone TEXT,\n        tags TEXT[] DEFAULT '{}',\n        notes TEXT,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã bot_groups\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS group_members (\n        id SERIAL PRIMARY KEY,\n        group_id INTEGER REFERENCES bot_groups(id) ON DELETE CASCADE NOT NULL,\n        user_id BIGINT NOT NULL,\n        username TEXT,\n        first_name TEXT,\n        last_name TEXT,\n        status TEXT DEFAULT 'member',\n        is_bot INTEGER DEFAULT 0,\n        admin_rights JSONB DEFAULT '{}',\n        custom_title TEXT,\n        restrictions JSONB DEFAULT '{}',\n        restricted_until TIMESTAMP,\n        joined_at TIMESTAMP DEFAULT NOW(),\n        last_seen TIMESTAMP,\n        message_count INTEGER DEFAULT 0,\n        is_active INTEGER DEFAULT 1,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã group_members\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS bot_users (\n        user_id BIGINT PRIMARY KEY,\n        username TEXT,\n        first_name TEXT,\n        last_name TEXT,\n        registered_at TIMESTAMP DEFAULT NOW(),\n        last_interaction TIMESTAMP DEFAULT NOW(),\n        interaction_count INTEGER DEFAULT 0,\n        user_data JSONB DEFAULT '{}',\n        is_active INTEGER DEFAULT 1\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã bot_users\");\n\n    await executeWithRetry(db, sql`\n      CREATE TABLE IF NOT EXISTS user_telegram_settings (\n        id SERIAL PRIMARY KEY,\n        user_id TEXT NOT NULL UNIQUE,\n        api_id TEXT,\n        api_hash TEXT,\n        phone_number TEXT,\n        session_string TEXT,\n        is_active INTEGER DEFAULT 1,\n        last_login TIMESTAMP,\n        created_at TIMESTAMP DEFAULT NOW(),\n        updated_at TIMESTAMP DEFAULT NOW()\n      );\n    `, \"–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã user_telegram_settings\");\n\n    console.log('‚úÖ Database tables initialized successfully!');\n    return true;\n  } catch (error) {\n    console.error('‚ùå Database initialization failed:', error);\n    return false;\n  }\n}","size_bytes":9317},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { spawn, ChildProcess } from \"child_process\";\nimport { writeFileSync, existsSync, mkdirSync, unlinkSync, createWriteStream } from \"fs\";\nimport { join } from \"path\";\nimport multer from \"multer\";\nimport { storage } from \"./storage\";\nimport { insertBotProjectSchema, insertBotInstanceSchema, insertBotTemplateSchema, insertBotTokenSchema, insertMediaFileSchema, insertUserBotDataSchema, insertBotGroupSchema, nodeSchema, connectionSchema, botDataSchema } from \"@shared/schema\";\nimport { seedDefaultTemplates } from \"./seed-templates\";\nimport { z } from \"zod\";\nimport https from \"https\";\nimport http from \"http\";\nimport { pipeline } from \"stream/promises\";\nimport { URL } from \"url\";\nimport dbRoutes from \"./db-routes\";\nimport { Pool } from \"pg\";\n// import { generatePythonCode } from \"../client/src/lib/bot-generator\"; // –£–±—Ä–∞–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Å –æ—á–∏—Å—Ç–∫–æ–π –∫–µ—à–∞\n\n// –§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª–µ–π\nfunction normalizeNodeData(node: any) {\n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤\n  const nodeDefaults = {\n    start: { \n      command: '/start', \n      description: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞', \n      showInMenu: true, \n      isPrivateOnly: false, \n      requiresAuth: false, \n      adminOnly: false \n    },\n    command: { \n      command: '/custom', \n      description: '–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞', \n      showInMenu: true, \n      isPrivateOnly: false, \n      requiresAuth: false, \n      adminOnly: false \n    }\n  };\n\n  // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–∏–ø–∞ —É–∑–ª–∞\n  const defaults = nodeDefaults[node.type as keyof typeof nodeDefaults];\n  if (!defaults) return node;\n\n  // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n  const normalizedData = { ...node.data };\n  \n  for (const [key, value] of Object.entries(defaults)) {\n    if (normalizedData[key] === undefined) {\n      normalizedData[key] = value;\n    }\n  }\n\n  return {\n    ...node,\n    data: normalizedData\n  };\n}\n\n// –§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞\nfunction normalizeProjectData(projectData: any) {\n  if (!projectData?.data?.sheets) return projectData;\n\n  const normalizedSheets = projectData.data.sheets.map((sheet: any) => ({\n    ...sheet,\n    nodes: sheet.nodes ? sheet.nodes.map(normalizeNodeData) : []\n  }));\n\n  return {\n    ...projectData,\n    data: {\n      ...projectData.data,\n      sheets: normalizedSheets\n    }\n  };\n}\nimport { initializeDatabaseTables } from \"./init-db\";\nimport { telegramClientManager, initializeTelegramManager } from \"./telegram-client\";\nimport { serverCache, getCachedOrExecute } from \"./cache\";\n\n// –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–æ–≤ (–∫–ª—é—á: `${projectId}_${tokenId}`)\nconst botProcesses = new Map<string, ChildProcess>();\n\n// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ multer –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤\nconst storage_multer = multer.diskStorage({\n  destination: (req, file, cb) => {\n    const projectId = req.params.projectId;\n    const date = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n    const uploadDir = join(process.cwd(), 'uploads', projectId, date);\n    \n    if (!existsSync(uploadDir)) {\n      mkdirSync(uploadDir, { recursive: true });\n    }\n    cb(null, uploadDir);\n  },\n  filename: (req, file, cb) => {\n    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏–º–µ–Ω–µ–º\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const extension = file.originalname.split('.').pop()?.toLowerCase() || '';\n    const baseName = file.originalname\n      .split('.')[0] // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ\n      .replace(/[^a-zA-Z0-9._-]/g, '_') // –ó–∞–º–µ–Ω—è–µ–º –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã\n      .substring(0, 50); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É\n    \n    cb(null, `${uniqueSuffix}-${baseName}.${extension}`);\n  }\n});\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞\nconst getFileExtension = (filename: string): string => {\n  return '.' + filename.split('.').pop()?.toLowerCase() || '';\n};\n\n// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏\nconst validateFileDetailed = (file: Express.Multer.File) => {\n  const fileValidation = new Map([\n    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n    ['image/jpeg', { maxSize: 25 * 1024 * 1024, category: 'photo', description: 'JPEG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }],\n    ['image/jpg', { maxSize: 25 * 1024 * 1024, category: 'photo', description: 'JPG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }],\n    ['image/png', { maxSize: 25 * 1024 * 1024, category: 'photo', description: 'PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }],\n    ['image/gif', { maxSize: 15 * 1024 * 1024, category: 'photo', description: 'GIF –∞–Ω–∏–º–∞—Ü–∏—è' }],\n    ['image/webp', { maxSize: 20 * 1024 * 1024, category: 'photo', description: 'WebP –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }],\n    ['image/svg+xml', { maxSize: 5 * 1024 * 1024, category: 'photo', description: 'SVG –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }],\n    ['image/bmp', { maxSize: 30 * 1024 * 1024, category: 'photo', description: 'BMP –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }],\n    \n    // –í–∏–¥–µ–æ\n    ['video/mp4', { maxSize: 200 * 1024 * 1024, category: 'video', description: 'MP4 –≤–∏–¥–µ–æ' }],\n    ['video/webm', { maxSize: 200 * 1024 * 1024, category: 'video', description: 'WebM –≤–∏–¥–µ–æ' }],\n    ['video/avi', { maxSize: 200 * 1024 * 1024, category: 'video', description: 'AVI –≤–∏–¥–µ–æ' }],\n    ['video/mov', { maxSize: 200 * 1024 * 1024, category: 'video', description: 'QuickTime –≤–∏–¥–µ–æ' }],\n    ['video/mkv', { maxSize: 200 * 1024 * 1024, category: 'video', description: 'MKV –≤–∏–¥–µ–æ' }],\n    ['video/quicktime', { maxSize: 200 * 1024 * 1024, category: 'video', description: 'QuickTime –≤–∏–¥–µ–æ' }],\n    \n    // –ê—É–¥–∏–æ\n    ['audio/mp3', { maxSize: 50 * 1024 * 1024, category: 'audio', description: 'MP3 –∞—É–¥–∏–æ' }],\n    ['audio/mpeg', { maxSize: 50 * 1024 * 1024, category: 'audio', description: 'MPEG –∞—É–¥–∏–æ' }],\n    ['audio/wav', { maxSize: 100 * 1024 * 1024, category: 'audio', description: 'WAV –∞—É–¥–∏–æ' }],\n    ['audio/ogg', { maxSize: 50 * 1024 * 1024, category: 'audio', description: 'OGG –∞—É–¥–∏–æ' }],\n    ['audio/aac', { maxSize: 50 * 1024 * 1024, category: 'audio', description: 'AAC –∞—É–¥–∏–æ' }],\n    ['audio/flac', { maxSize: 100 * 1024 * 1024, category: 'audio', description: 'FLAC –∞—É–¥–∏–æ' }],\n    ['audio/m4a', { maxSize: 50 * 1024 * 1024, category: 'audio', description: 'M4A –∞—É–¥–∏–æ' }],\n    ['audio/webm', { maxSize: 50 * 1024 * 1024, category: 'audio', description: 'WebM –∞—É–¥–∏–æ' }],\n    \n    // –î–æ–∫—É–º–µ–Ω—Ç—ã\n    ['application/pdf', { maxSize: 50 * 1024 * 1024, category: 'document', description: 'PDF –¥–æ–∫—É–º–µ–Ω—Ç' }],\n    ['application/msword', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'Word –¥–æ–∫—É–º–µ–Ω—Ç' }],\n    ['application/vnd.openxmlformats-officedocument.wordprocessingml.document', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'Word –¥–æ–∫—É–º–µ–Ω—Ç (DOCX)' }],\n    ['application/vnd.ms-excel', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'Excel —Ç–∞–±–ª–∏—Ü–∞' }],\n    ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'Excel —Ç–∞–±–ª–∏—Ü–∞ (XLSX)' }],\n    ['text/plain', { maxSize: 10 * 1024 * 1024, category: 'document', description: '–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª' }],\n    ['text/csv', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'CSV —Ñ–∞–π–ª' }],\n    \n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞\n    ['.pdf', { maxSize: 50 * 1024 * 1024, category: 'document', description: 'PDF –¥–æ–∫—É–º–µ–Ω—Ç' }],\n    ['.doc', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'Word –¥–æ–∫—É–º–µ–Ω—Ç' }],\n    ['.docx', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'Word –¥–æ–∫—É–º–µ–Ω—Ç (DOCX)' }],\n    ['.txt', { maxSize: 10 * 1024 * 1024, category: 'document', description: '–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª' }],\n    ['.xls', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'Excel —Ç–∞–±–ª–∏—Ü–∞' }],\n    ['.xlsx', { maxSize: 25 * 1024 * 1024, category: 'document', description: 'Excel —Ç–∞–±–ª–∏—Ü–∞ (XLSX)' }],\n    \n    // –ê—Ä—Ö–∏–≤—ã\n    ['application/zip', { maxSize: 100 * 1024 * 1024, category: 'document', description: 'ZIP –∞—Ä—Ö–∏–≤' }],\n    ['application/x-rar-compressed', { maxSize: 100 * 1024 * 1024, category: 'document', description: 'RAR –∞—Ä—Ö–∏–≤' }],\n  ]);\n  \n  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ MIME —Ç–∏–ø—É\n  let validation = fileValidation.get(file.mimetype);\n  \n  // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ MIME —Ç–∏–ø—É, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞\n  if (!validation) {\n    const extension = getFileExtension(file.originalname);\n    validation = fileValidation.get(extension);\n  }\n  \n  if (!validation) {\n    const extension = getFileExtension(file.originalname);\n    return { \n      valid: false, \n      error: `–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞: ${file.mimetype} (${extension}). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (jpg, png, gif), –≤–∏–¥–µ–æ (mp4, webm), –∞—É–¥–∏–æ (mp3, wav, ogg), –¥–æ–∫—É–º–µ–Ω—Ç—ã (pdf, doc, txt).` \n    };\n  }\n  \n  if (file.size > validation.maxSize) {\n    const maxSizeMB = Math.round(validation.maxSize / (1024 * 1024));\n    return { \n      valid: false, \n      error: `–§–∞–π–ª \"${file.originalname}\" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è ${validation.description}: ${maxSizeMB}–ú–ë` \n    };\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞\n  if (file.originalname.length > 255) {\n    return { \n      valid: false, \n      error: '–ò–º—è —Ñ–∞–π–ª–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å–∏–º—É–º 255 —Å–∏–º–≤–æ–ª–æ–≤)' \n    };\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞\n  const dangerousPatterns = [/\\.\\./g, /[<>:\"|?*]/g, /^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i];\n  if (dangerousPatterns.some(pattern => pattern.test(file.originalname))) {\n    return { \n      valid: false, \n      error: '–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞' \n    };\n  }\n  \n  return { valid: true, category: validation.category };\n};\n\n// –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è multer\nconst fileFilter = (req: any, file: any, cb: any) => {\n  const validation = validateFileDetailed(file);\n  if (validation.valid) {\n    cb(null, true);\n  } else {\n    cb(new Error(validation.error), false);\n  }\n};\n\nconst upload = multer({ \n  storage: storage_multer,\n  fileFilter: fileFilter,\n  limits: {\n    fileSize: 200 * 1024 * 1024, // 200MB –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–¥–ª—è –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ)\n    files: 20, // –ú–∞–∫—Å–∏–º—É–º 20 —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑\n    fieldSize: 10 * 1024 * 1024, // 10MB –¥–ª—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã\n    fieldNameSize: 300, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—è\n    fields: 50 // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã\n  }\n});\n\n// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø–æ MIME —Ç–∏–ø—É\nfunction getFileType(mimeType: string): 'photo' | 'video' | 'audio' | 'document' {\n  if (mimeType.startsWith('image/')) return 'photo';\n  if (mimeType.startsWith('video/')) return 'video';\n  if (mimeType.startsWith('audio/')) return 'audio';\n  return 'document';\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –ø–æ URL —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫\nasync function downloadFileFromUrl(url: string, destination: string): Promise<{\n  success: boolean;\n  filePath?: string;\n  size?: number;\n  mimeType?: string;\n  fileName?: string;\n  error?: string;\n}> {\n  return new Promise((resolve) => {\n    try {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å URL\n      const parsedUrl = new URL(url);\n      if (!['http:', 'https:'].includes(parsedUrl.protocol)) {\n        return resolve({ success: false, error: '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ HTTP –∏ HTTPS —Å—Å—ã–ª–∫–∏' });\n      }\n\n      // –í—ã–±–∏—Ä–∞–µ–º –º–æ–¥—É–ª—å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª–∞\n      const client = parsedUrl.protocol === 'https:' ? https : http;\n      \n      // –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞\n      const request = client.get(url, {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',\n          'Accept': '*/*',\n          'Accept-Language': 'ru-RU,ru;q=0.9,en;q=0.8',\n          'Accept-Encoding': 'gzip, deflate, br',\n          'Connection': 'keep-alive',\n          'Sec-Fetch-Dest': 'empty',\n          'Sec-Fetch-Mode': 'cors',\n          'Sec-Fetch-Site': 'cross-site'\n        },\n        timeout: 30000 // 30 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç\n      }, (response) => {\n        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã\n        if (response.statusCode && response.statusCode >= 300 && response.statusCode < 400 && response.headers.location) {\n          const redirectUrl = response.headers.location;\n          console.log(`–†–µ–¥–∏—Ä–µ–∫—Ç —Å ${url} –Ω–∞ ${redirectUrl}`);\n          return downloadFileFromUrl(redirectUrl, destination).then(resolve);\n        }\n\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–¥\n        if (!response.statusCode || response.statusCode < 200 || response.statusCode >= 400) {\n          return resolve({ \n            success: false, \n            error: `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.statusCode} ${response.statusMessage}` \n          });\n        }\n\n        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤\n        const contentLength = response.headers['content-length'];\n        const contentType = response.headers['content-type'] || 'application/octet-stream';\n        const contentDisposition = response.headers['content-disposition'];\n        \n        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏–ª–∏ URL\n        let fileName = '';\n        if (contentDisposition && contentDisposition.includes('filename=')) {\n          const match = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n          if (match && match[1]) {\n            fileName = match[1].replace(/['\"]/g, '');\n          }\n        }\n        \n        if (!fileName) {\n          fileName = parsedUrl.pathname.split('/').pop() || 'downloaded-file';\n          if (!fileName.includes('.')) {\n            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ MIME —Ç–∏–ø–∞\n            const extensions = {\n              'image/jpeg': '.jpg',\n              'image/png': '.png',\n              'image/gif': '.gif',\n              'image/webp': '.webp',\n              'video/mp4': '.mp4',\n              'video/webm': '.webm',\n              'audio/mpeg': '.mp3',\n              'audio/wav': '.wav',\n              'application/pdf': '.pdf',\n              'text/plain': '.txt'\n            };\n            fileName += extensions[contentType as keyof typeof extensions] || '.bin';\n          }\n        }\n\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞\n        if (contentLength) {\n          const fileSizeBytes = parseInt(contentLength);\n          const maxSize = contentType.startsWith('video/') ? 200 * 1024 * 1024 : 50 * 1024 * 1024;\n          if (fileSizeBytes > maxSize) {\n            return resolve({ \n              success: false, \n              error: `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: ${Math.round(fileSizeBytes / (1024 * 1024))}–ú–ë. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ${Math.round(maxSize / (1024 * 1024))}–ú–ë` \n            });\n          }\n        }\n\n        // –°–æ–∑–¥–∞–µ–º –ø–æ—Ç–æ–∫ –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞\n        const fileStream = createWriteStream(destination);\n        let downloadedBytes = 0;\n\n        response.on('data', (chunk) => {\n          downloadedBytes += chunk.length;\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏\n          const maxSize = contentType.startsWith('video/') ? 200 * 1024 * 1024 : 50 * 1024 * 1024;\n          if (downloadedBytes > maxSize) {\n            response.destroy();\n            fileStream.destroy();\n            if (existsSync(destination)) {\n              unlinkSync(destination);\n            }\n            return resolve({ \n              success: false, \n              error: `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç ${Math.round(maxSize / (1024 * 1024))}–ú–ë` \n            });\n          }\n        });\n\n        response.pipe(fileStream);\n\n        fileStream.on('finish', () => {\n          resolve({\n            success: true,\n            filePath: destination,\n            size: downloadedBytes,\n            mimeType: contentType,\n            fileName: fileName\n          });\n        });\n\n        fileStream.on('error', (error) => {\n          if (existsSync(destination)) {\n            unlinkSync(destination);\n          }\n          resolve({ success: false, error: `–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞: ${error.message}` });\n        });\n      });\n\n      request.on('error', (error) => {\n        resolve({ success: false, error: `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}` });\n      });\n\n      request.on('timeout', () => {\n        request.destroy();\n        resolve({ success: false, error: '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (30 —Å–µ–∫—É–Ω–¥)' });\n      });\n\n    } catch (error) {\n      resolve({ \n        success: false, \n        error: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞' \n      });\n    }\n  });\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL\nasync function checkUrlAccessibility(url: string): Promise<{\n  accessible: boolean;\n  mimeType?: string;\n  size?: number;\n  fileName?: string;\n  error?: string;\n}> {\n  return new Promise((resolve) => {\n    try {\n      const parsedUrl = new URL(url);\n      if (!['http:', 'https:'].includes(parsedUrl.protocol)) {\n        return resolve({ accessible: false, error: '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ HTTP –∏ HTTPS —Å—Å—ã–ª–∫–∏' });\n      }\n\n      const client = parsedUrl.protocol === 'https:' ? https : http;\n      \n      const request = client.request(url, { method: 'HEAD', timeout: 10000 }, (response) => {\n        if (response.statusCode && response.statusCode >= 300 && response.statusCode < 400 && response.headers.location) {\n          return checkUrlAccessibility(response.headers.location).then(resolve);\n        }\n\n        if (!response.statusCode || response.statusCode < 200 || response.statusCode >= 400) {\n          return resolve({ \n            accessible: false, \n            error: `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.statusCode} ${response.statusMessage}` \n          });\n        }\n\n        const contentLength = response.headers['content-length'];\n        const contentType = response.headers['content-type'] || 'application/octet-stream';\n        const contentDisposition = response.headers['content-disposition'];\n        \n        let fileName = '';\n        if (contentDisposition && contentDisposition.includes('filename=')) {\n          const match = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n          if (match && match[1]) {\n            fileName = match[1].replace(/['\"]/g, '');\n          }\n        }\n        \n        if (!fileName) {\n          fileName = parsedUrl.pathname.split('/').pop() || 'file';\n        }\n\n        resolve({\n          accessible: true,\n          mimeType: contentType,\n          size: contentLength ? parseInt(contentLength) : undefined,\n          fileName: fileName\n        });\n      });\n\n      request.on('error', (error) => {\n        resolve({ accessible: false, error: `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}` });\n      });\n\n      request.on('timeout', () => {\n        request.destroy();\n        resolve({ accessible: false, error: '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è' });\n      });\n\n      request.end();\n\n    } catch (error) {\n      resolve({ \n        accessible: false, \n        error: error instanceof Error ? error.message : '–ù–µ–≤–µ—Ä–Ω—ã–π URL' \n      });\n    }\n  });\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Python —Ñ–∞–π–ª–∞ –±–æ—Ç–∞\nfunction createBotFile(botCode: string, projectId: number, tokenId?: number): string {\n  const botsDir = join(process.cwd(), 'bots');\n  if (!existsSync(botsDir)) {\n    mkdirSync(botsDir, { recursive: true });\n  }\n  \n  const fileName = tokenId ? `bot_${projectId}_${tokenId}.py` : `bot_${projectId}.py`;\n  const filePath = join(botsDir, fileName);\n  writeFileSync(filePath, botCode);\n  return filePath;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞\nasync function startBot(projectId: number, token: string, tokenId: number): Promise<{ success: boolean; error?: string; processId?: string }> {\n  try {\n    const processKey = `${projectId}_${tokenId}`;\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–æ—Ç\n    if (botProcesses.has(processKey)) {\n      console.log(`–ë–æ—Ç —Å —Ç–æ–∫–µ–Ω–æ–º ${tokenId} –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ ${projectId} —É–∂–µ –∑–∞–ø—É—â–µ–Ω`);\n      return { success: false, error: \"–≠—Ç–æ—Ç –±–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω\" };\n    }\n\n    const project = await storage.getBotProject(projectId);\n    if (!project) {\n      return { success: false, error: \"–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\" };\n    }\n\n    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –ø—Ä–æ—Å—Ç—É—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞\n    const convertSheetsToSimpleBotData = (data: any) => {\n      // –ï—Å–ª–∏ —É–∂–µ –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å\n      if (data.nodes && data.connections) {\n        return data;\n      }\n      \n      // –ï—Å–ª–∏ –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–∑–ª—ã –∏ —Å–≤—è–∑–∏\n      if (data.sheets && Array.isArray(data.sheets)) {\n        let allNodes: any[] = [];\n        let allConnections: any[] = [];\n        \n        data.sheets.forEach((sheet: any) => {\n          if (sheet.nodes) allNodes.push(...sheet.nodes);\n          if (sheet.connections) allConnections.push(...sheet.connections);\n        });\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã–µ —Å–≤—è–∑–∏\n        if (data.interSheetConnections) {\n          allConnections.push(...data.interSheetConnections);\n        }\n        \n        return {\n          nodes: allNodes,\n          connections: allConnections\n        };\n      }\n      \n      // –ï—Å–ª–∏ –Ω–µ—Ç —É–∑–ª–æ–≤ –≤–æ–æ–±—â–µ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É\n      return {\n        nodes: [],\n        connections: []\n      };\n    }\n\n    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä\n    const { generatePythonCode } = await import(\"../client/src/lib/bot-generator.js\");\n    const simpleBotData = convertSheetsToSimpleBotData(project.data);\n    const botCode = generatePythonCode(simpleBotData as any, project.name).replace('YOUR_BOT_TOKEN_HERE', token);\n    \n    // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –±–æ—Ç–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞)\n    const filePath = createBotFile(botCode, projectId, tokenId);\n    \n    // –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞\n    const process = spawn('python', [filePath], {\n      stdio: ['pipe', 'pipe', 'pipe'],\n      detached: false\n    });\n\n    // –õ–æ–≥–∏—Ä—É–µ–º –≤—ã–≤–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å–∞\n    process.stdout?.on('data', (data) => {\n      console.log(`–ë–æ—Ç ${projectId} stdout:`, data.toString());\n    });\n\n    process.stderr?.on('data', (data) => {\n      console.error(`–ë–æ—Ç ${projectId} stderr:`, data.toString());\n    });\n\n    const processId = process.pid?.toString();\n    \n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å\n    botProcesses.set(processKey, process);\n    \n    // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n    const existingBotInstance = await storage.getBotInstance(projectId);\n    if (existingBotInstance) {\n      await storage.updateBotInstance(existingBotInstance.id, {\n        status: 'running',\n        token,\n        processId,\n        errorMessage: null\n      });\n    } else {\n      await storage.createBotInstance({\n        projectId,\n        tokenId,\n        status: 'running',\n        token,\n        processId,\n      });\n    }\n\n    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞\n    process.on('error', async (error) => {\n      console.error(`–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ ${projectId} (—Ç–æ–∫–µ–Ω ${tokenId}):`, error);\n      const instance = await storage.getBotInstance(projectId);\n      if (instance) {\n        await storage.updateBotInstance(instance.id, { \n          status: 'error', \n          errorMessage: error.message \n        });\n      }\n      botProcesses.delete(processKey);\n    });\n\n    process.on('exit', async (code) => {\n      console.log(`–ë–æ—Ç ${projectId} (—Ç–æ–∫–µ–Ω ${tokenId}) –∑–∞–≤–µ—Ä—à–µ–Ω —Å –∫–æ–¥–æ–º ${code}`);\n      const instance = await storage.getBotInstance(projectId);\n      if (instance) {\n        await storage.updateBotInstance(instance.id, { \n          status: 'stopped',\n          errorMessage: code !== 0 ? `–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω —Å –∫–æ–¥–æ–º ${code}` : null\n        });\n      }\n      botProcesses.delete(processKey);\n    });\n\n    return { success: true, processId };\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞:', error);\n    return { success: false, error: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞' };\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞ –ø–æ —Ç–æ–∫–µ–Ω—É\nasync function stopBot(projectId: number, tokenId: number): Promise<{ success: boolean; error?: string }> {\n  try {\n    const processKey = `${projectId}_${tokenId}`;\n    const process = botProcesses.get(processKey);\n    \n    // –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–º—è—Ç–∏, –Ω–æ –≤ –±–∞–∑–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å - –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ\n    if (!process) {\n      const instance = await storage.getBotInstance(projectId);\n      if (instance && instance.status === 'running' && instance.tokenId === tokenId) {\n        console.log(`–ü—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞ ${projectId} (—Ç–æ–∫–µ–Ω ${tokenId}) –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–º—è—Ç–∏, –Ω–æ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –≤ –±–∞–∑–µ. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ.`);\n        await storage.stopBotInstance(projectId);\n        return { success: true };\n      }\n      return { success: false, error: \"–ü—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω\" };\n    }\n\n    process.kill('SIGTERM');\n    botProcesses.delete(processKey);\n    \n    await storage.stopBotInstance(projectId);\n    \n    return { success: true };\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞:', error);\n    return { success: false, error: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞' };\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞\nfunction findActiveProcessForProject(projectId: number): { processKey: string; process: ChildProcess } | null {\n  for (const [key, process] of botProcesses.entries()) {\n    if (key.startsWith(`${projectId}_`) && process && !process.killed && process.exitCode === null) {\n      return { processKey: key, process };\n    }\n  }\n  return null;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏–π –±–æ—Ç–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞\nasync function cleanupBotStates(): Promise<void> {\n  try {\n    console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞...');\n    const allInstances = await storage.getAllBotInstances();\n    \n    for (const instance of allInstances) {\n      if (instance.status === 'running') {\n        // –ï—Å–ª–∏ –≤ –±–∞–∑–µ –±–æ—Ç –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π, –Ω–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–µ—Ç –≤ –ø–∞–º—è—Ç–∏\n        const activeProcessInfo = findActiveProcessForProject(instance.projectId);\n        if (!activeProcessInfo) {\n          console.log(`–ù–∞–π–¥–µ–Ω –±–æ—Ç ${instance.projectId} –≤ —Å—Ç–∞—Ç—É—Å–µ \"running\" –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ.`);\n          await storage.updateBotInstance(instance.id, { status: 'stopped' });\n        }\n      }\n    }\n    console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.');\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–æ–≤:', error);\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ (–µ—Å–ª–∏ –æ–Ω –∑–∞–ø—É—â–µ–Ω)\nasync function restartBotIfRunning(projectId: number): Promise<{ success: boolean; error?: string }> {\n  try {\n    const instance = await storage.getBotInstance(projectId);\n    if (!instance || instance.status !== 'running') {\n      return { success: true }; // –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º\n    }\n\n    console.log(`–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ ${projectId} –∏–∑-–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞...`);\n    \n    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –±–æ—Ç\n    const stopResult = await stopBot(projectId, instance.tokenId);\n    if (!stopResult.success) {\n      console.error(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ ${projectId}:`, stopResult.error);\n      return { success: true }; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º true, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞\n    }\n\n    // –ñ–¥–µ–º –¥–æ–ª—å—à–µ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤\n    await new Promise(resolve => setTimeout(resolve, 5000));\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω\n    const activeProcessInfo = findActiveProcessForProject(projectId);\n    if (activeProcessInfo) {\n      console.log(`–ü—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞ ${projectId} –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª—è–µ–º –∏–∑ –ø–∞–º—è—Ç–∏`);\n      botProcesses.delete(activeProcessInfo.processKey);\n    }\n\n    // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–Ω–æ–≤–æ —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º\n    const startResult = await startBot(projectId, instance.token, instance.tokenId);\n    return startResult;\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞:', error);\n    return { success: false, error: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞' };\n  }\n}\n\nasync function generatePythonCodeOld(botData: any): Promise<string> {\n  const { nodes } = botData;\n  \n  let code = `import asyncio\nimport logging\nfrom aiogram import Bot, Dispatcher, types\nfrom aiogram.filters import CommandStart, Command\nfrom aiogram.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardRemove\nfrom aiogram.utils.keyboard import ReplyKeyboardBuilder, InlineKeyboardBuilder\n\n# –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ (–ø–æ–ª—É—á–∏—Ç–µ —É @BotFather)\nBOT_TOKEN = \"YOUR_BOT_TOKEN_HERE\"\n\n# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è\nlogging.basicConfig(level=logging.INFO)\n\n# –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞\nbot = Bot(token=BOT_TOKEN)\ndp = Dispatcher()\n\n`;\n\n  // Generate handlers for each node\n  nodes.forEach((node: any) => {\n    if (node.type === \"start\") {\n      const messageText = node.data.messageText || \"–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\";\n      const textAssignment = messageText.includes('\\n') \n        ? `text = \"\"\"${messageText}\"\"\"`\n        : `text = \"${messageText.replace(/\"/g, '\\\\\"')}\"`;\n      \n      code += `\n@dp.message(CommandStart())\nasync def start_handler(message: types.Message):\n    ${textAssignment}\n`;\n      \n      if (node.data.keyboardType === \"reply\" && node.data.buttons.length > 0) {\n        code += `    \n    builder = ReplyKeyboardBuilder()\n`;\n        node.data.buttons.forEach((button: any) => {\n          code += `    builder.add(KeyboardButton(text=\"${button.text}\"))\n`;\n        });\n        \n        code += `    keyboard = builder.as_markup(resize_keyboard=${node.data.resizeKeyboard ? 'True' : 'False'}, one_time_keyboard=${node.data.oneTimeKeyboard ? 'True' : 'False'})\n    await message.answer(text, reply_markup=keyboard)\n`;\n      } else if (node.data.keyboardType === \"inline\" && node.data.buttons.length > 0) {\n        code += `    \n    builder = InlineKeyboardBuilder()\n`;\n        node.data.buttons.forEach((button: any) => {\n          if (button.action === \"url\") {\n            code += `    builder.add(InlineKeyboardButton(text=\"${button.text}\", url=\"${button.url || '#'}\"))\n`;\n          } else {\n            code += `    builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${button.target || button.text}\"))\n`;\n          }\n        });\n        \n        code += `    keyboard = builder.as_markup()\n    # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º inline –∫–Ω–æ–ø–æ–∫\n    await message.answer(text, reply_markup=ReplyKeyboardRemove())\n    await message.answer(\"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\", reply_markup=keyboard)\n`;\n      } else {\n        code += `    # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏\n    await message.answer(text, reply_markup=ReplyKeyboardRemove())\n`;\n      }\n    } else if (node.type === \"command\") {\n      const command = node.data.command || \"/help\";\n      const functionName = command.replace('/', '').replace(/[^a-zA-Z0-9_]/g, '_');\n      const messageText = node.data.messageText || \"–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞\";\n      const textAssignment = messageText.includes('\\n') \n        ? `text = \"\"\"${messageText}\"\"\"`\n        : `text = \"${messageText.replace(/\"/g, '\\\\\"')}\"`;\n      \n      code += `\n@dp.message(Command(\"${command.replace('/', '')}\"))\nasync def ${functionName}_handler(message: types.Message):\n    ${textAssignment}\n`;\n      \n      if (node.data.keyboardType === \"reply\" && node.data.buttons.length > 0) {\n        code += `    \n    builder = ReplyKeyboardBuilder()\n`;\n        node.data.buttons.forEach((button: any) => {\n          code += `    builder.add(KeyboardButton(text=\"${button.text}\"))\n`;\n        });\n        \n        code += `    keyboard = builder.as_markup(resize_keyboard=${node.data.resizeKeyboard ? 'True' : 'False'}, one_time_keyboard=${node.data.oneTimeKeyboard ? 'True' : 'False'})\n    await message.answer(text, reply_markup=keyboard)\n`;\n      } else if (node.data.keyboardType === \"inline\" && node.data.buttons.length > 0) {\n        code += `    \n    builder = InlineKeyboardBuilder()\n`;\n        node.data.buttons.forEach((button: any) => {\n          if (button.action === \"url\") {\n            code += `    builder.add(InlineKeyboardButton(text=\"${button.text}\", url=\"${button.url || '#'}\"))\n`;\n          } else {\n            code += `    builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${button.target || button.text}\"))\n`;\n          }\n        });\n        \n        code += `    keyboard = builder.as_markup()\n    # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º inline –∫–Ω–æ–ø–æ–∫\n    await message.answer(text, reply_markup=ReplyKeyboardRemove())\n    await message.answer(\"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\", reply_markup=keyboard)\n`;\n      } else {\n        code += `    # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏\n    await message.answer(text, reply_markup=ReplyKeyboardRemove())\n`;\n      }\n    } else if (node.type === \"message\") {\n      const functionName = `message_${node.id.replace(/[^a-zA-Z0-9_]/g, '_')}`;\n      const messageText = node.data.messageText || \"–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ\";\n      const textAssignment = messageText.includes('\\n') \n        ? `text = \"\"\"${messageText}\"\"\"`\n        : `text = \"${messageText.replace(/\"/g, '\\\\\"')}\"`;\n      \n      code += `\n@dp.message()\nasync def ${functionName}_handler(message: types.Message):\n    ${textAssignment}\n`;\n      \n      if (node.data.keyboardType === \"reply\" && node.data.buttons.length > 0) {\n        code += `    \n    builder = ReplyKeyboardBuilder()\n`;\n        node.data.buttons.forEach((button: any) => {\n          code += `    builder.add(KeyboardButton(text=\"${button.text}\"))\n`;\n        });\n        \n        code += `    keyboard = builder.as_markup(resize_keyboard=${node.data.resizeKeyboard ? 'True' : 'False'}, one_time_keyboard=${node.data.oneTimeKeyboard ? 'True' : 'False'})\n    await message.answer(text, reply_markup=keyboard)\n`;\n      } else if (node.data.keyboardType === \"inline\" && node.data.buttons.length > 0) {\n        code += `    \n    builder = InlineKeyboardBuilder()\n`;\n        node.data.buttons.forEach((button: any) => {\n          if (button.action === \"url\") {\n            code += `    builder.add(InlineKeyboardButton(text=\"${button.text}\", url=\"${button.url || '#'}\"))\n`;\n          } else {\n            code += `    builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${button.target || button.text}\"))\n`;\n          }\n        });\n        \n        code += `    keyboard = builder.as_markup()\n    # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º inline –∫–Ω–æ–ø–æ–∫\n    await message.answer(text, reply_markup=ReplyKeyboardRemove())\n    await message.answer(\"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\", reply_markup=keyboard)\n`;\n      } else {\n        code += `    # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏\n    await message.answer(text, reply_markup=ReplyKeyboardRemove())\n`;\n      }\n    }\n  });\n\n  // Generate synonym handlers for commands\n  const nodesWithSynonyms = nodes.filter((node: any) => \n    (node.type === 'start' || node.type === 'command') && \n    node.data.synonyms && \n    node.data.synonyms.length > 0\n  );\n\n  if (nodesWithSynonyms.length > 0) {\n    code += `\n\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –∫–æ–º–∞–Ω–¥`;\n    nodesWithSynonyms.forEach((node: any) => {\n      if (node.data.synonyms) {\n        node.data.synonyms.forEach((synonym: string) => {\n          const sanitizedSynonym = synonym.replace(/[^a-zA-Z–∞-—è–ê-–Ø0-9_]/g, '_');\n          const originalCommand = node.data.command || (node.type === 'start' ? '/start' : '/help');\n          const functionName = originalCommand.replace('/', '').replace(/[^a-zA-Z0-9_]/g, '_');\n          \n          code += `\n@dp.message(lambda message: message.text and message.text.lower() == \"${synonym.toLowerCase()}\")\nasync def ${functionName}_synonym_${sanitizedSynonym}_handler(message: types.Message):\n    # –°–∏–Ω–æ–Ω–∏–º –¥–ª—è –∫–æ–º–∞–Ω–¥—ã ${originalCommand}\n`;\n          \n          if (node.type === 'start') {\n            code += '    await start_handler(message)';\n          } else {\n            code += `    await ${functionName}_handler(message)`;\n          }\n        });\n      }\n    });\n  }\n\n  code += `\n\n# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞\nasync def main():\n    try:\n        print(\"–ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞...\")\n        await dp.start_polling(bot)\n    except Exception as e:\n        print(f\"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}\")\n        raise\n\nif __name__ == '__main__':\n    try:\n        asyncio.run(main())\n    except KeyboardInterrupt:\n        print(\"–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω\")\n    except Exception as e:\n        print(f\"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}\")\n        exit(1)\n`;\n\n  return code;\n}\n\n// Function to ensure at least one default project exists\nasync function ensureDefaultProject() {\n  try {\n    const projects = await storage.getAllBotProjects();\n    if (projects.length === 0) {\n      // Create a default project if none exists\n      const defaultProject = {\n        name: \"–ú–æ–π –ø–µ—Ä–≤—ã–π –±–æ—Ç\",\n        description: \"–ë–∞–∑–æ–≤—ã–π –±–æ—Ç —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º\",\n        data: {\n          nodes: [\n            {\n              id: \"start\",\n              type: \"start\",\n              position: { x: 100, y: 100 },\n              data: {\n                messageText: \"–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –Ω–æ–≤—ã–π –±–æ—Ç. –ù–∞–∂–º–∏—Ç–µ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏.\",\n                keyboardType: \"none\",\n                buttons: [],\n                resizeKeyboard: true,\n                oneTimeKeyboard: false\n              }\n            }\n          ],\n          connections: []\n        }\n      };\n      await storage.createBotProject(defaultProject);\n      console.log(\"‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\");\n    }\n  } catch (error) {\n    console.error(\"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:\", error);\n  }\n}\n\n// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\nlet isDbReady = false;\nlet areTemplatesReady = false;\nlet isTelegramReady = false;\n\n// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ —Ñ–æ–Ω–µ\nasync function initializeComponents() {\n  try {\n    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n    console.log('üîß Initializing database...');\n    const dbInitSuccess = await initializeDatabaseTables();\n    if (dbInitSuccess) {\n      isDbReady = true;\n      console.log('‚úÖ Database ready');\n      \n      // –ü–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î –∑–∞–ø—É—Å–∫–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã\n      Promise.all([\n        // –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤\n        seedDefaultTemplates(true).then(() => {\n          areTemplatesReady = true;\n          console.log('‚úÖ Templates ready');\n        }).catch(err => console.error('‚ùå Templates failed:', err)),\n        \n        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n        ensureDefaultProject().then(() => {\n          console.log('‚úÖ Default project ready');\n        }).catch(err => console.error('‚ùå Default project failed:', err)),\n        \n        // –û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –±–æ—Ç–æ–≤\n        cleanupBotStates().then(() => {\n          console.log('‚úÖ Bot states cleaned');\n        }).catch(err => console.error('‚ùå Bot cleanup failed:', err)),\n        \n        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram –∫–ª–∏–µ–Ω—Ç–æ–≤\n        initializeTelegramManager().then(() => {\n          isTelegramReady = true;\n          console.log('‚úÖ Telegram clients ready');\n        }).catch(err => console.error('‚ùå Telegram initialization failed:', err))\n      ]).catch(err => console.error('‚ùå Component initialization failed:', err));\n    } else {\n      console.error('‚ùå Database initialization failed');\n    }\n  } catch (error) {\n    console.error('‚ùå Critical initialization error:', error);\n  }\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤ —Ñ–æ–Ω–µ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞\n  initializeComponents();\n\n  // Simple API root endpoint for health checks\n  app.get(\"/api\", (req, res) => {\n    res.json({ status: \"ok\", ready: isDbReady && areTemplatesReady });\n  });\n\n  app.head(\"/api\", (req, res) => {\n    res.sendStatus(204);\n  });\n\n  // API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\n  app.get(\"/api/health\", (req, res) => {\n    res.json({\n      database: isDbReady,\n      templates: areTemplatesReady,\n      telegram: isTelegramReady,\n      ready: isDbReady && areTemplatesReady\n    });\n  });\n\n  app.head(\"/api/health\", (req, res) => {\n    res.sendStatus(204);\n  });\n\n  // Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π\n  const requireDbReady = (req: any, res: any, next: any) => {\n    if (!isDbReady) {\n      return res.status(503).json({ \n        message: \"–°–µ—Ä–≤–µ—Ä –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥\",\n        database: isDbReady,\n        ready: false\n      });\n    }\n    next();\n  };\n  \n  // Register database management routes\n  app.use(\"/api/database\", dbRoutes);\n  \n  // Get all bot projects\n  app.get(\"/api/projects\", requireDbReady, async (req, res) => {\n    try {\n      const projects = await getCachedOrExecute(\n        'all-projects',\n        () => storage.getAllBotProjects(),\n        30000 // –ö–µ—à–∏—Ä—É–µ–º –Ω–∞ 30 —Å–µ–∫—É–Ω–¥\n      );\n      res.json(projects);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch projects\" });\n    }\n  });\n\n  // Get single bot project\n  app.get(\"/api/projects/:id\", requireDbReady, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const project = await storage.getBotProject(id);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      \n      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª–µ–π –≤ —É–∑–ª—ã\n      const normalizedProject = normalizeProjectData(project);\n      \n      res.json(normalizedProject);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch project\" });\n    }\n  });\n\n  // Create new bot project\n  app.post(\"/api/projects\", requireDbReady, async (req, res) => {\n    try {\n      const validatedData = insertBotProjectSchema.parse(req.body);\n      const project = await storage.createBotProject(validatedData);\n      res.status(201).json(project);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create project\" });\n    }\n  });\n\n  // Update bot project\n  app.put(\"/api/projects/:id\", requireDbReady, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertBotProjectSchema.partial().parse(req.body);\n      const project = await storage.updateBotProject(id, validatedData);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      \n      // –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è data (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–æ—Ç–∞), –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –µ—Å–ª–∏ –æ–Ω –∑–∞–ø—É—â–µ–Ω\n      if (validatedData.data) {\n        console.log(`–ü—Ä–æ–µ–∫—Ç ${id} –æ–±–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞...`);\n        const restartResult = await restartBotIfRunning(id);\n        if (!restartResult.success) {\n          console.error(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ ${id}:`, restartResult.error);\n        }\n      }\n      \n      res.json(project);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to update project\" });\n    }\n  });\n\n  // Delete bot project\n  app.delete(\"/api/projects/:id\", requireDbReady, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      console.log(`üóëÔ∏è –ù–∞—á–∏–Ω–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ ${id}`);\n      \n      // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–æ–µ–∫—Ç\n      const project = await storage.getBotProject(id);\n      if (!project) {\n        console.log(`‚ùå –ü—Ä–æ–µ–∫—Ç ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      console.log(`‚úÖ –ü—Ä–æ–µ–∫—Ç ${id} –Ω–∞–π–¥–µ–Ω: ${project.name}`);\n\n      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞, –µ—Å–ª–∏ –æ–Ω –∑–∞–ø—É—â–µ–Ω\n      try {\n        const botInstance = await storage.getBotInstance(id);\n        console.log(`ü§ñ –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ ${id}:`, botInstance ? `ID: ${botInstance.id}, —Å—Ç–∞—Ç—É—Å: ${botInstance.status}` : '–Ω–µ –Ω–∞–π–¥–µ–Ω');\n        \n        if (botInstance && botInstance.status === 'running') {\n          console.log(`üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞ ${id} –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞...`);\n          await stopBot(id);\n          console.log(`‚úÖ –ë–æ—Ç ${id} –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`);\n        }\n      } catch (stopError) {\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞ ${id}:`, stopError);\n        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å\n      }\n\n      // –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ\n      try {\n        // 1. –£–¥–∞–ª—è–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –∏–∑ –±–∞–∑—ã (–µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)\n        const botInstance = await storage.getBotInstance(id);\n        if (botInstance) {\n          console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ ${botInstance.id} –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ ${id}`);\n          const instanceDeleted = await storage.deleteBotInstance(botInstance.id);\n          console.log(`${instanceDeleted ? '‚úÖ' : '‚ùå'} –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ ${instanceDeleted ? '—É–¥–∞–ª–µ–Ω' : '–Ω–µ —É–¥–∞–ª–µ–Ω'}`);\n        }\n\n        // 2. –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞ (CASCADE –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)\n        try {\n          console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º —Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞ ${id}`);\n          const tokens = await storage.getBotTokensByProject(id);\n          for (const token of tokens) {\n            await storage.deleteBotToken(token.id);\n          }\n          console.log(`‚úÖ –¢–æ–∫–µ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞ ${id} —É–¥–∞–ª–µ–Ω—ã`);\n        } catch (tokenError) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤:`, tokenError);\n        }\n\n        // 3. –£–¥–∞–ª—è–µ–º –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã\n        try {\n          console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ ${id}`);\n          const mediaFiles = await storage.getMediaFilesByProject(id);\n          for (const mediaFile of mediaFiles) {\n            await storage.deleteMediaFile(mediaFile.id);\n          }\n          console.log(`‚úÖ –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ ${id} —É–¥–∞–ª–µ–Ω—ã`);\n        } catch (mediaError) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤:`, mediaError);\n        }\n\n        // 4. –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\n        try {\n          console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ ${id}`);\n          const userData = await storage.getUserBotDataByProject(id);\n          for (const data of userData) {\n            await storage.deleteUserBotData(data.id);\n          }\n          console.log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ ${id} —É–¥–∞–ª–µ–Ω—ã`);\n        } catch (userDataError) {\n          console.error(`‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö:`, userDataError);\n        }\n        \n        // 5. –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –±–æ—Ç–∞\n        const filePath = join(process.cwd(), 'bots', `bot_${id}.py`);\n        if (existsSync(filePath)) {\n          unlinkSync(filePath);\n          console.log(`‚úÖ –§–∞–π–ª –±–æ—Ç–∞ ${id} —É–¥–∞–ª–µ–Ω`);\n        } else {\n          console.log(`üìÑ –§–∞–π–ª –±–æ—Ç–∞ ${id} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`);\n        }\n      } catch (cleanupError) {\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞ ${id}:`, cleanupError);\n        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞\n      }\n\n      // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–µ–∫—Ç\n      console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º –ø—Ä–æ–µ–∫—Ç ${id} –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö`);\n      const deleted = await storage.deleteBotProject(id);\n      console.log(`${deleted ? '‚úÖ' : '‚ùå'} –ü—Ä–æ–µ–∫—Ç ${deleted ? '—É–¥–∞–ª–µ–Ω' : '–Ω–µ —É–¥–∞–ª–µ–Ω'} –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö`);\n      \n      if (!deleted) {\n        return res.status(500).json({ message: \"Failed to delete project from database\" });\n      }\n      \n      console.log(`üéâ –ü—Ä–æ–µ–∫—Ç ${id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω`);\n      res.json({ message: \"Project deleted successfully\" });\n    } catch (error) {\n      console.error(\"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:\", error);\n      console.error(\"‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:\", error instanceof Error ? error.stack : 'Unknown error');\n      res.status(500).json({ message: \"Failed to delete project\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Generate Python code\n  app.post(\"/api/projects/:id/export\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const project = await storage.getBotProject(id);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –ø—Ä–æ—Å—Ç—É—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞\n      const convertSheetsToSimpleBotData = (data: any) => {\n        // –ï—Å–ª–∏ —É–∂–µ –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å\n        if (data.nodes && data.connections) {\n          return data;\n        }\n        \n        // –ï—Å–ª–∏ –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–∑–ª—ã –∏ —Å–≤—è–∑–∏\n        if (data.sheets && Array.isArray(data.sheets)) {\n          let allNodes: any[] = [];\n          let allConnections: any[] = [];\n          \n          data.sheets.forEach((sheet: any) => {\n            if (sheet.nodes) allNodes.push(...sheet.nodes);\n            if (sheet.connections) allConnections.push(...sheet.connections);\n          });\n          \n          // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã–µ —Å–≤—è–∑–∏\n          if (data.interSheetConnections) {\n            allConnections.push(...data.interSheetConnections);\n          }\n          \n          return {\n            nodes: allNodes,\n            connections: allConnections\n          };\n        }\n        \n        // –ï—Å–ª–∏ –Ω–µ—Ç —É–∑–ª–æ–≤ –≤–æ–æ–±—â–µ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É\n        return {\n          nodes: [],\n          connections: []\n        };\n      }\n\n      // Generate Python code using dynamic import with cache busting\n      const modUrl = new URL(\"../client/src/lib/bot-generator.js\", import.meta.url);\n      modUrl.searchParams.set(\"t\", Date.now().toString());\n      const { generatePythonCode } = await import(modUrl.href);\n      const simpleBotData = convertSheetsToSimpleBotData(project.data);\n      const pythonCode = generatePythonCode(simpleBotData as any, project.name);\n      res.json({ code: pythonCode });\n    } catch (error) {\n      console.error(\"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞:\", error);\n      res.status(500).json({ message: \"Failed to generate code\", error: String(error) });\n    }\n  });\n\n  // Bot management endpoints\n  \n  // Get bot instance status\n  app.get(\"/api/projects/:id/bot\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const instance = await storage.getBotInstance(projectId);\n      if (!instance) {\n        return res.json({ status: 'stopped', instance: null });\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –±–∞–∑–µ –∏ –≤ –ø–∞–º—è—Ç–∏\n      const activeProcessInfo = findActiveProcessForProject(projectId);\n      let actualStatus = 'stopped';\n      \n      // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤ –ø–∞–º—è—Ç–∏\n      if (activeProcessInfo) {\n        actualStatus = 'running';\n      } else {\n        // –ü—Ä–æ—Ü–µ—Å—Å–∞ –Ω–µ—Ç –≤ –ø–∞–º—è—Ç–∏, –ø—Ä–æ–≤–µ—Ä—è–µ–º PID –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –≤ –±–∞–∑–µ\n        console.log(`–ë–æ—Ç ${projectId} –≤ –±–∞–∑–µ –ø–æ–∫–∞–∑–∞–Ω –∫–∞–∫ ${instance.status}, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å –ø–æ PID ${instance.processId}`);\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ PID (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –≤ –±–∞–∑–µ)\n      if (!activeProcessInfo && instance.processId) {\n        try {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–Ω–µ —É–±–∏–≤–∞–µ–º, —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º)\n          process.kill(parseInt(instance.processId), 0);\n          console.log(`–ü—Ä–æ—Ü–µ—Å—Å ${instance.processId} –¥–ª—è –±–æ—Ç–∞ ${projectId} –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ`);\n          \n          // –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è\n          const mockProcess = {\n            pid: parseInt(instance.processId),\n            killed: false,\n            exitCode: null,\n            kill: (signal: any) => {\n              try {\n                process.kill(parseInt(instance.processId!), signal);\n                return true;\n              } catch {\n                return false;\n              }\n            }\n          } as any;\n          \n          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º tokenId –∏–∑ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞)\n          if (instance.tokenId) {\n            const processKey = `${projectId}_${instance.tokenId}`;\n            botProcesses.set(processKey, mockProcess);\n          }\n          actualStatus = 'running';\n        } catch (error) {\n          console.log(`–ü—Ä–æ—Ü–µ—Å—Å ${instance.processId} –¥–ª—è –±–æ—Ç–∞ ${projectId} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ`);\n          actualStatus = 'stopped';\n        }\n      }\n      \n      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ ps –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è\n      if (!activeProcessInfo && instance.processId && actualStatus === 'stopped') {\n        try {\n          const { execSync } = require('child_process');\n          const psOutput = execSync(`ps -p ${instance.processId} -o pid,ppid,cmd --no-headers`, { encoding: 'utf8' }).trim();\n          \n          if (psOutput && psOutput.includes('python')) {\n            console.log(`–ü—Ä–æ—Ü–µ—Å—Å ${instance.processId} –¥–ª—è –±–æ—Ç–∞ ${projectId} –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ ps, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ`);\n            \n            // –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è\n            const mockProcess = {\n              pid: parseInt(instance.processId),\n              killed: false,\n              exitCode: null,\n              kill: (signal: any) => {\n                try {\n                  process.kill(parseInt(instance.processId!), signal);\n                  return true;\n                } catch {\n                  return false;\n                }\n              }\n            } as any;\n            \n            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞\n            botProcesses.set(projectId, mockProcess);\n            actualStatus = 'running';\n          }\n        } catch (error) {\n          // ps –∫–æ–º–∞–Ω–¥–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞, –ø—Ä–æ—Ü–µ—Å—Å —Ç–æ—á–Ω–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n          console.log(`–ü—Ä–æ—Ü–µ—Å—Å ${instance.processId} –¥–ª—è –±–æ—Ç–∞ ${projectId} –Ω–µ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ ps`);\n        }\n      }\n      \n      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å –Ω—É–∂–Ω—ã–º —Ñ–∞–π–ª–æ–º –±–æ—Ç–∞\n      if (!activeProcessInfo && actualStatus === 'stopped') {\n        try {\n          const { execSync } = require('child_process');\n          // –ò—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–∞–π–ª —ç—Ç–æ–≥–æ –±–æ—Ç–∞\n          const botFileName = `bot_${projectId}.py`;\n          const allPythonProcesses = execSync(`ps aux | grep python | grep -v grep`, { encoding: 'utf8' }).trim();\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Å —Ñ–∞–π–ª–æ–º —ç—Ç–æ–≥–æ –±–æ—Ç–∞\n          if (allPythonProcesses.includes(botFileName)) {\n            console.log(`–ù–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –±–æ—Ç–∞ ${projectId} (—Ñ–∞–π–ª: ${botFileName}), –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ`);\n            \n            // –ò–∑–≤–ª–µ–∫–∞–µ–º PID –∏–∑ –≤—ã–≤–æ–¥–∞ ps\n            const lines = allPythonProcesses.split('\\n');\n            for (const line of lines) {\n              if (line.includes(botFileName)) {\n                const parts = line.trim().split(/\\s+/);\n                const realPid = parseInt(parts[1]);\n                \n                console.log(`–û–±–Ω–∞—Ä—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π PID ${realPid} –¥–ª—è –±–æ—Ç–∞ ${projectId}, –æ–±–Ω–æ–≤–ª—è–µ–º –≤ –±–∞–∑–µ`);\n                \n                // –û–±–Ω–æ–≤–ª—è–µ–º PID –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n                await storage.updateBotInstance(instance.id, { processId: realPid.toString() });\n                \n                // –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è\n                const mockProcess = {\n                  pid: realPid,\n                  killed: false,\n                  exitCode: null,\n                  kill: (signal: any) => {\n                    try {\n                      process.kill(realPid, signal);\n                      return true;\n                    } catch {\n                      return false;\n                    }\n                  }\n                } as any;\n                \n                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞\n                botProcesses.set(projectId, mockProcess);\n                actualStatus = 'running';\n                break;\n              }\n            }\n          }\n        } catch (error) {\n          // –ö–æ–º–∞–Ω–¥–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞, –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω\n          console.log(`–ü—Ä–æ—Ü–µ—Å—Å –¥–ª—è –±–æ—Ç–∞ ${projectId} –Ω–µ –Ω–∞–π–¥–µ–Ω —Å—Ä–µ–¥–∏ Python –ø—Ä–æ—Ü–µ—Å—Å–æ–≤`);\n        }\n      }\n      \n      // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é - –∏—Å–ø—Ä–∞–≤–ª—è–µ–º\n      if (instance.status !== actualStatus) {\n        console.log(`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –±–æ—Ç–∞ ${projectId}. –ë–∞–∑–∞: ${instance.status}, –†–µ–∞–ª—å–Ω–æ—Å—Ç—å: ${actualStatus}. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º.`);\n        await storage.updateBotInstance(instance.id, { \n          status: actualStatus,\n          errorMessage: actualStatus === 'stopped' ? '–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω' : null\n        });\n        const updatedInstance = { ...instance, status: actualStatus };\n        return res.json({ status: actualStatus, instance: updatedInstance });\n      }\n      \n      res.json({ status: instance.status, instance });\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞:', error);\n      res.status(500).json({ message: \"Failed to get bot status\" });\n    }\n  });\n\n  // Start bot\n  app.post(\"/api/projects/:id/bot/start\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { token, tokenId } = req.body;\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–µ–∫—Ç\n      const project = await storage.getBotProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      let botToken = token;\n      let actualTokenId = tokenId;\n\n      // –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω —Ç–æ–∫–µ–Ω –Ω–∞–ø—Ä—è–º—É—é, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–∫–µ–Ω –ø–æ ID –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n      if (!botToken) {\n        if (tokenId) {\n          const selectedToken = await storage.getBotToken(tokenId);\n          if (selectedToken && selectedToken.projectId === projectId) {\n            botToken = selectedToken.token;\n            actualTokenId = selectedToken.id;\n          }\n        } else {\n          // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–∫–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n          const defaultToken = await storage.getDefaultBotToken(projectId);\n          if (defaultToken) {\n            botToken = defaultToken.token;\n            actualTokenId = defaultToken.id;\n          }\n        }\n      }\n\n      if (!botToken || !actualTokenId) {\n        return res.status(400).json({ message: \"Bot token is required\" });\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–æ—Ç (—Ç–æ–∫–µ–Ω)\n      const existingInstance = await storage.getBotInstanceByToken(actualTokenId);\n      if (existingInstance && existingInstance.status === 'running') {\n        return res.status(400).json({ message: \"Bot is already running\" });\n      }\n\n      const result = await startBot(projectId, botToken, actualTokenId);\n      if (result.success) {\n        // –û—Ç–º–µ—á–∞–µ–º —Ç–æ–∫–µ–Ω –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π\n        await storage.markTokenAsUsed(actualTokenId);\n        \n        res.json({ \n          message: \"Bot started successfully\", \n          processId: result.processId,\n          tokenUsed: true\n        });\n      } else {\n        res.status(500).json({ message: result.error || \"Failed to start bot\" });\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to start bot\" });\n    }\n  });\n\n  // Stop bot\n  app.post(\"/api/projects/:id/bot/stop\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { tokenId } = req.body;\n      \n      if (!tokenId) {\n        return res.status(400).json({ message: \"Token ID is required\" });\n      }\n      \n      const result = await stopBot(projectId, tokenId);\n      if (result.success) {\n        res.json({ message: \"Bot stopped successfully\" });\n      } else {\n        res.status(500).json({ message: result.error || \"Failed to stop bot\" });\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to stop bot\" });\n    }\n  });\n\n  // Restart bot\n  app.post(\"/api/projects/:id/bot/restart\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      \n      // –°–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞\n      const stopResult = await stopBot(projectId);\n      if (!stopResult.success) {\n        return res.status(500).json({ message: stopResult.error || \"Failed to stop bot\" });\n      }\n      \n      // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞\n      const project = await storage.getBotProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      \n      let botToken = null;\n      \n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–∫–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      let botTokenId = null;\n      if (defaultToken) {\n        botToken = defaultToken.token;\n        botTokenId = defaultToken.id;\n      } else {\n        return res.status(400).json({ message: \"Default bot token not found\" });\n      }\n      \n      if (!botToken || !botTokenId) {\n        return res.status(400).json({ message: \"Bot token is required\" });\n      }\n      \n      // –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –∑–∞–Ω–æ–≤–æ\n      const startResult = await startBot(projectId, botToken, botTokenId);\n      if (startResult.success) {\n        res.json({ \n          message: \"Bot restarted successfully\", \n          processId: startResult.processId\n        });\n      } else {\n        res.status(500).json({ message: startResult.error || \"Failed to start bot after restart\" });\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞:', error);\n      res.status(500).json({ message: \"Failed to restart bot\" });\n    }\n  });\n\n  // Get saved bot token\n  app.get(\"/api/projects/:id/token\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const project = await storage.getBotProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.json({ \n        hasToken: !!project.botToken, \n        tokenPreview: project.botToken ? `${project.botToken.substring(0, 10)}...` : null \n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get token info\" });\n    }\n  });\n\n  // Clear saved bot token\n  app.delete(\"/api/projects/:id/token\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const project = await storage.updateBotProject(projectId, { botToken: null });\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.json({ message: \"Token cleared successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to clear token\" });\n    }\n  });\n\n  // Get all bot instances\n  app.get(\"/api/bots\", async (req, res) => {\n    try {\n      const instances = await storage.getAllBotInstances();\n      res.json(instances);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch bot instances\" });\n    }\n  });\n\n  // Template management endpoints\n  \n  // Force update templates\n  app.post(\"/api/templates/refresh\", async (req, res) => {\n    try {\n      console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ API –∑–∞–ø—Ä–æ—Å—É');\n      await seedDefaultTemplates(true);\n      res.json({ message: \"Templates refreshed successfully\" });\n    } catch (error) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤:', error);\n      res.status(500).json({ message: \"Failed to refresh templates\" });\n    }\n  });\n\n  // Recreate templates with hierarchy\n  app.post(\"/api/templates/recreate\", async (req, res) => {\n    try {\n      console.log('üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π –ø–æ API –∑–∞–ø—Ä–æ—Å—É');\n      await seedDefaultTemplates(true);\n      res.json({ message: \"Templates recreated with hierarchy successfully\" });\n    } catch (error) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤:', error);\n      res.status(500).json({ message: \"Failed to recreate templates\" });\n    }\n  });\n  \n  // Get all templates\n  app.get(\"/api/templates\", requireDbReady, async (req, res) => {\n    try {\n      const templates = await storage.getAllBotTemplates();\n      // –ú–∞–ø–ø–∏–Ω–≥ data -> flow_data –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º\n      const mappedTemplates = templates.map(template => ({\n        ...template,\n        flow_data: template.data\n      }));\n      res.json(mappedTemplates);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch templates\" });\n    }\n  });\n\n  // Get featured templates (must be before /api/templates/:id)\n  app.get(\"/api/templates/featured\", async (req, res) => {\n    try {\n      const templates = await storage.getFeaturedTemplates();\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch featured templates\" });\n    }\n  });\n\n  // Get templates by category (must be before /api/templates/:id)\n  app.get(\"/api/templates/category/:category\", async (req, res) => {\n    try {\n      const { category } = req.params;\n      const templates = await storage.getTemplatesByCategory(category);\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch templates by category\" });\n    }\n  });\n\n  // Search templates (must be before /api/templates/:id)\n  app.get(\"/api/templates/search\", async (req, res) => {\n    try {\n      const { q } = req.query;\n      if (!q || typeof q !== 'string') {\n        return res.status(400).json({ message: \"Search query is required\" });\n      }\n      const templates = await storage.searchTemplates(q);\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to search templates\" });\n    }\n  });\n\n  // Get single template\n  app.get(\"/api/templates/:id\", requireDbReady, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const template = await storage.getBotTemplate(id);\n      if (!template) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch template\" });\n    }\n  });\n\n  // Create new template\n  app.post(\"/api/templates\", requireDbReady, async (req, res) => {\n    try {\n      const validatedData = insertBotTemplateSchema.parse(req.body);\n      const template = await storage.createBotTemplate(validatedData);\n      res.status(201).json(template);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create template\" });\n    }\n  });\n\n  // Update template\n  app.put(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertBotTemplateSchema.partial().parse(req.body);\n      const template = await storage.updateBotTemplate(id, validatedData);\n      if (!template) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json(template);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to update template\" });\n    }\n  });\n\n  // Delete template\n  app.delete(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteBotTemplate(id);\n      if (!success) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json({ message: \"Template deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete template\" });\n    }\n  });\n\n  // Use template (increment use count)\n  app.post(\"/api/templates/:id/use\", requireDbReady, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.incrementTemplateUseCount(id);\n      if (!success) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json({ message: \"Template use count incremented\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to increment use count\" });\n    }\n  });\n\n  // Rate template\n  app.post(\"/api/templates/:id/rate\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { rating } = req.body;\n      \n      if (!rating || rating < 1 || rating > 5) {\n        return res.status(400).json({ message: \"Rating must be between 1 and 5\" });\n      }\n\n      const success = await storage.rateTemplate(id, rating);\n      if (!success) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json({ message: \"Template rated successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to rate template\" });\n    }\n  });\n\n  // Increment template view count\n  app.post(\"/api/templates/:id/view\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.incrementTemplateViewCount(id);\n      if (!success) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json({ message: \"View count incremented\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to increment view count\" });\n    }\n  });\n\n  // Increment template download count\n  app.post(\"/api/templates/:id/download\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.incrementTemplateDownloadCount(id);\n      if (!success) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json({ message: \"Download count incremented\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to increment download count\" });\n    }\n  });\n\n  // Toggle template like\n  app.post(\"/api/templates/:id/like\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { liked } = req.body;\n      \n      if (typeof liked !== 'boolean') {\n        return res.status(400).json({ message: \"liked must be a boolean\" });\n      }\n      \n      const success = await storage.toggleTemplateLike(id, liked);\n      if (!success) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      \n      res.json({ message: liked ? \"Template liked\" : \"Template unliked\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to toggle like\" });\n    }\n  });\n\n  // Toggle template bookmark\n  app.post(\"/api/templates/:id/bookmark\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { bookmarked } = req.body;\n      \n      if (typeof bookmarked !== 'boolean') {\n        return res.status(400).json({ message: \"bookmarked must be a boolean\" });\n      }\n      \n      const success = await storage.toggleTemplateBookmark(id, bookmarked);\n      if (!success) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      \n      res.json({ message: bookmarked ? \"Template bookmarked\" : \"Template unbookmarked\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to toggle bookmark\" });\n    }\n  });\n\n  // Token management endpoints\n  \n  // Get all tokens for a project\n  app.get(\"/api/projects/:id/tokens\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const tokens = await storage.getBotTokensByProject(projectId);\n      \n      // Hide actual token values for security\n      const safeTokens = tokens.map(token => ({\n        ...token,\n        token: `${token.token.substring(0, 10)}...`\n      }));\n      \n      res.json(safeTokens);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch tokens\" });\n    }\n  });\n\n  // Parse bot information from Telegram API\n  app.post(\"/api/projects/:id/tokens/parse\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { token } = req.body;\n      \n      if (!token) {\n        return res.status(400).json({ message: \"Token is required\" });\n      }\n      \n      // Get bot information via Telegram Bot API\n      const telegramApiUrl = `https://api.telegram.org/bot${token}/getMe`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        }\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Invalid bot token or failed to get bot info\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      const botInfo = result.result;\n      \n      // Get bot description and short description\n      let botDescription = null;\n      let botShortDescription = null;\n      \n      try {\n        // Get full description\n        const descResponse = await fetch(`https://api.telegram.org/bot${token}/getMyDescription`);\n        if (descResponse.ok) {\n          const descResult = await descResponse.json();\n          if (descResult.ok && descResult.result && descResult.result.description) {\n            botDescription = descResult.result.description;\n          }\n        }\n        \n        // Get short description  \n        const shortDescResponse = await fetch(`https://api.telegram.org/bot${token}/getMyShortDescription`);\n        if (shortDescResponse.ok) {\n          const shortDescResult = await shortDescResponse.json();\n          if (shortDescResult.ok && shortDescResult.result && shortDescResult.result.short_description) {\n            botShortDescription = shortDescResult.result.short_description;\n          }\n        }\n      } catch (descError) {\n        console.warn(\"Failed to get bot descriptions:\", descError);\n      }\n      \n      // Get bot photo URL if exists\n      let photoUrl = null;\n      if (botInfo.photo && botInfo.photo.big_file_id) {\n        try {\n          const fileResponse = await fetch(`https://api.telegram.org/bot${token}/getFile`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              file_id: botInfo.photo.big_file_id\n            })\n          });\n          \n          const fileResult = await fileResponse.json();\n          \n          if (fileResponse.ok && fileResult.result && fileResult.result.file_path) {\n            photoUrl = `https://api.telegram.org/file/bot${token}/${fileResult.result.file_path}`;\n          }\n        } catch (photoError) {\n          console.warn(\"Failed to get bot photo URL:\", photoError);\n        }\n      }\n\n      // Return parsed bot information\n      const parsedBotInfo = {\n        botFirstName: botInfo.first_name,\n        botUsername: botInfo.username,\n        botDescription: botDescription,\n        botShortDescription: botShortDescription,\n        botPhotoUrl: photoUrl,\n        botCanJoinGroups: botInfo.can_join_groups ? 1 : 0,\n        botCanReadAllGroupMessages: botInfo.can_read_all_group_messages ? 1 : 0,\n        botSupportsInlineQueries: botInfo.supports_inline_queries ? 1 : 0,\n        botHasMainWebApp: botInfo.has_main_web_app ? 1 : 0,\n      };\n\n      res.json(parsedBotInfo);\n    } catch (error) {\n      console.error(\"Failed to parse bot info:\", error);\n      res.status(500).json({ message: \"Failed to parse bot info\" });\n    }\n  });\n\n  // Update bot information via Telegram API\n  app.put(\"/api/projects/:id/tokens/:tokenId/bot-info\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const tokenId = parseInt(req.params.tokenId);\n      const { field, value } = req.body;\n      \n      if (!field || value === undefined) {\n        return res.status(400).json({ message: \"Field and value are required\" });\n      }\n      \n      // Get bot token\n      const token = await storage.getBotToken(tokenId);\n      if (!token || token.projectId !== projectId) {\n        return res.status(404).json({ message: \"Token not found\" });\n      }\n      \n      // Update bot information via Telegram API\n      let telegramApiMethod;\n      let requestBody: any = {};\n      \n      switch (field) {\n        case 'name':\n          telegramApiMethod = 'setMyName';\n          requestBody = { name: value };\n          break;\n        case 'description':\n          telegramApiMethod = 'setMyDescription';\n          requestBody = { description: value };\n          break;\n        case 'shortDescription':\n          telegramApiMethod = 'setMyShortDescription';\n          requestBody = { short_description: value };\n          break;\n        default:\n          return res.status(400).json({ message: \"Invalid field\" });\n      }\n      \n      // Call Telegram API\n      const telegramApiUrl = `https://api.telegram.org/bot${token.token}/${telegramApiMethod}`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody)\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: `Failed to update ${field}`, \n          error: result.description || \"Unknown error\"\n        });\n      }\n      \n      // Update local database with new information\n      let updateData: Partial<any> = {};\n      switch (field) {\n        case 'name':\n          updateData.botFirstName = value;\n          break;\n        case 'description':\n          updateData.botDescription = value;\n          break;\n        case 'shortDescription':\n          updateData.botShortDescription = value;\n          break;\n      }\n      \n      await storage.updateBotToken(tokenId, updateData);\n      \n      res.json({ success: true, field, value });\n    } catch (error) {\n      console.error(`Failed to update bot ${req.body.field}:`, error);\n      res.status(500).json({ message: `Failed to update bot ${req.body.field}` });\n    }\n  });\n\n  // Create a new token\n  app.post(\"/api/projects/:id/tokens\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const tokenData = insertBotTokenSchema.parse({\n        ...req.body,\n        projectId\n      });\n      \n      const token = await storage.createBotToken(tokenData);\n      \n      // Hide actual token value for security\n      const safeToken = {\n        ...token,\n        token: `${token.token.substring(0, 10)}...`\n      };\n      \n      res.status(201).json(safeToken);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create token\" });\n    }\n  });\n\n  // Update a token\n  app.put(\"/api/tokens/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updateData = insertBotTokenSchema.partial().parse(req.body);\n      \n      const token = await storage.updateBotToken(id, updateData);\n      if (!token) {\n        return res.status(404).json({ message: \"Token not found\" });\n      }\n      \n      // Hide actual token value for security\n      const safeToken = {\n        ...token,\n        token: `${token.token.substring(0, 10)}...`\n      };\n      \n      res.json(safeToken);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to update token\" });\n    }\n  });\n\n  // Delete a token\n  app.delete(\"/api/tokens/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteBotToken(id);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"Token not found\" });\n      }\n      \n      res.json({ message: \"Token deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete token\" });\n    }\n  });\n\n  // Delete a token for a specific project\n  app.delete(\"/api/projects/:projectId/tokens/:tokenId\", async (req, res) => {\n    try {\n      const tokenId = parseInt(req.params.tokenId);\n      const success = await storage.deleteBotToken(tokenId);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"Token not found\" });\n      }\n      \n      res.json({ message: \"Token deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete token\" });\n    }\n  });\n\n  // Set default token\n  app.post(\"/api/projects/:projectId/tokens/:tokenId/set-default\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const tokenId = parseInt(req.params.tokenId);\n      \n      const success = await storage.setDefaultBotToken(projectId, tokenId);\n      if (!success) {\n        return res.status(404).json({ message: \"Token not found\" });\n      }\n      \n      res.json({ message: \"Default token set successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to set default token\" });\n    }\n  });\n\n  // Get default token for a project\n  app.get(\"/api/projects/:id/tokens/default\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const token = await storage.getDefaultBotToken(projectId);\n      \n      if (!token) {\n        return res.json({ hasDefault: false, token: null });\n      }\n      \n      // Hide actual token value for security\n      const safeToken = {\n        ...token,\n        token: `${token.token.substring(0, 10)}...`\n      };\n      \n      res.json({ hasDefault: true, token: safeToken });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch default token\" });\n    }\n  });\n\n  // === –ú–ï–î–ò–ê–§–ê–ô–õ–´ ===\n  \n  // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞ (–æ–¥–∏–Ω–æ—á–Ω–∞—è) —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π\n  app.post(\"/api/media/upload/:projectId\", upload.single('file'), async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const file = req.file;\n      const { description, tags, isPublic } = req.body;\n      \n      if (!file) {\n        return res.status(400).json({ \n          message: \"–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω\",\n          code: \"NO_FILE\"\n        });\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n      const project = await storage.getBotProject(projectId);\n      if (!project) {\n        // –£–¥–∞–ª—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\n        if (existsSync(file.path)) {\n          unlinkSync(file.path);\n        }\n        return res.status(404).json({ \n          message: \"–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\",\n          code: \"PROJECT_NOT_FOUND\"\n        });\n      }\n      \n      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞\n      const validation = validateFileDetailed(file);\n      if (!validation.valid) {\n        // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\n        if (existsSync(file.path)) {\n          unlinkSync(file.path);\n        }\n        return res.status(400).json({ \n          message: validation.error,\n          code: \"VALIDATION_ERROR\"\n        });\n      }\n      \n      // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–µ–∫—Ç–∞\n      const relativePath = file.path.replace(process.cwd(), '').replace(/\\\\/g, '/');\n      const fileUrl = relativePath.startsWith('/') ? relativePath : `/${relativePath}`;\n      \n      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–≥–∏\n      const processedTags = tags ? \n        (Array.isArray(tags) ? tags : tags.split(','))\n          .map((tag: string) => tag.trim().toLowerCase())\n          .filter((tag: string) => tag.length > 0 && tag.length <= 50)\n          .slice(0, 10) // –ú–∞–∫—Å–∏–º—É–º 10 —Ç–µ–≥–æ–≤\n        : [];\n      \n      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞\n      const autoTags = [];\n      if (validation.category) {\n        autoTags.push(validation.category);\n      }\n      if (file.mimetype.includes('gif')) {\n        autoTags.push('–∞–Ω–∏–º–∞—Ü–∏—è');\n      }\n      if (file.size > 10 * 1024 * 1024) {\n        autoTags.push('–±–æ–ª—å—à–æ–π_—Ñ–∞–π–ª');\n      }\n      \n      const finalTags = Array.from(new Set([...processedTags, ...autoTags]));\n      \n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n      const mediaFile = await storage.createMediaFile({\n        projectId,\n        fileName: file.originalname,\n        fileType: getFileType(file.mimetype),\n        filePath: file.path,\n        fileSize: file.size,\n        mimeType: file.mimetype,\n        url: fileUrl,\n        description: description || `${validation.category || '–§–∞–π–ª'} - ${file.originalname}`,\n        tags: finalTags,\n        isPublic: isPublic === 'true' || isPublic === true ? 1 : 0\n      });\n      \n      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ\n      res.json({\n        ...mediaFile,\n        uploadInfo: {\n          category: validation.category,\n          sizeMB: Math.round(file.size / (1024 * 1024) * 100) / 100,\n          autoTagsAdded: autoTags.length,\n          uploadDate: new Date().toISOString()\n        }\n      });\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞:\", error);\n      \n      // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏\n      if (req.file && existsSync(req.file.path)) {\n        try {\n          unlinkSync(req.file.path);\n        } catch (unlinkError) {\n          console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\", unlinkError);\n        }\n      }\n      \n      const errorMessage = error instanceof Error ? error.message : \"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞\";\n      res.status(500).json({ \n        message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞\",\n        error: errorMessage,\n        code: \"UPLOAD_ERROR\"\n      });\n    }\n  });\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π\n  app.post(\"/api/media/upload-multiple/:projectId\", upload.array('files', 20), async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const files = req.files as Express.Multer.File[];\n      \n      const { isPublic, defaultDescription } = req.body;\n      \n      if (!files || files.length === 0) {\n        return res.status(400).json({ \n          message: \"–§–∞–π–ª—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã\",\n          code: \"NO_FILES\"\n        });\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n      const project = await storage.getBotProject(projectId);\n      if (!project) {\n        // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\n        files.forEach(file => {\n          if (existsSync(file.path)) {\n            unlinkSync(file.path);\n          }\n        });\n        return res.status(404).json({ \n          message: \"–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\",\n          code: \"PROJECT_NOT_FOUND\"\n        });\n      }\n      \n      const uploadedFiles = [];\n      const errors = [];\n      const warnings: string[] = [];\n      \n      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –ø–æ —Ç–∏–ø–∞–º –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏\n      const fileStats = {\n        photo: 0,\n        video: 0,\n        audio: 0,\n        document: 0\n      };\n      \n      for (const file of files) {\n        try {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞\n          const maxSize = file.mimetype.startsWith('video/') ? 100 * 1024 * 1024 : 50 * 1024 * 1024;\n          if (file.size > maxSize) {\n            // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç\n            unlinkSync(file.path);\n            errors.push({\n              fileName: file.originalname,\n              error: `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ${file.mimetype.startsWith('video/') ? '100' : '50'}–ú–ë`\n            });\n            continue;\n          }\n          \n          // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É\n          const fileUrl = `/uploads/${file.filename}`;\n          \n          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n          const mediaFile = await storage.createMediaFile({\n            projectId,\n            fileName: file.originalname,\n            fileType: getFileType(file.mimetype),\n            filePath: file.path,\n            fileSize: file.size,\n            mimeType: file.mimetype,\n            url: fileUrl,\n            description: defaultDescription || '',\n            tags: [],\n            isPublic: isPublic ? 1 : 0\n          });\n          \n          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤\n          const fileType = getFileType(file.mimetype);\n          fileStats[fileType]++;\n          \n          uploadedFiles.push(mediaFile);\n        } catch (fileError) {\n          console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞ ${file.originalname}:`, fileError);\n          \n          // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏\n          if (existsSync(file.path)) {\n            try {\n              unlinkSync(file.path);\n            } catch (unlinkError) {\n              console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\", unlinkError);\n            }\n          }\n          \n          errors.push({\n            fileName: file.originalname,\n            error: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞\"\n          });\n        }\n      }\n      \n      // –°–æ–±–∏—Ä–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n      const totalSize = uploadedFiles.reduce((sum, file) => sum + file.fileSize, 0);\n      \n      res.json({\n        success: uploadedFiles.length,\n        errors: errors.length,\n        uploadedFiles,\n        errorDetails: errors,\n        statistics: {\n          totalFiles: files.length,\n          totalSize,\n          fileTypes: fileStats,\n          averageSize: uploadedFiles.length > 0 ? Math.round(totalSize / uploadedFiles.length) : 0\n        },\n        warnings: warnings.length > 0 ? warnings : undefined\n      });\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤:\", error);\n      \n      // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏\n      if (req.files) {\n        (req.files as Express.Multer.File[]).forEach(file => {\n          if (existsSync(file.path)) {\n            try {\n              unlinkSync(file.path);\n            } catch (unlinkError) {\n              console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\", unlinkError);\n            }\n          }\n        });\n      }\n      \n      res.status(500).json({ message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤\" });\n    }\n  });\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π\n  app.post(\"/api/media/check-url\", async (req, res) => {\n    try {\n      const { url } = req.body;\n      \n      if (!url || typeof url !== 'string') {\n        return res.status(400).json({ \n          message: \"URL –Ω–µ —É–∫–∞–∑–∞–Ω\",\n          code: \"MISSING_URL\"\n        });\n      }\n\n      const result = await checkUrlAccessibility(url);\n      \n      if (!result.accessible) {\n        return res.status(400).json({\n          accessible: false,\n          error: result.error,\n          code: \"URL_NOT_ACCESSIBLE\"\n        });\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞\n      const validation = validateFileDetailed({\n        mimetype: result.mimeType || 'application/octet-stream',\n        size: result.size || 0,\n        originalname: result.fileName || 'file'\n      } as any);\n\n      if (!validation.valid) {\n        return res.status(400).json({\n          accessible: false,\n          error: validation.error,\n          code: \"UNSUPPORTED_FILE_TYPE\"\n        });\n      }\n\n      res.json({\n        accessible: true,\n        fileInfo: {\n          mimeType: result.mimeType,\n          size: result.size,\n          fileName: result.fileName,\n          fileType: result.mimeType ? getFileType(result.mimeType) : 'document',\n          category: validation.category,\n          sizeMB: result.size ? Math.round(result.size / (1024 * 1024) * 100) / 100 : 0\n        }\n      });\n\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ URL:', error);\n      res.status(500).json({ \n        accessible: false,\n        error: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ URL\",\n        code: \"CHECK_ERROR\"\n      });\n    }\n  });\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –ø–æ URL —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏\n  app.post(\"/api/media/download-url/:projectId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { url, description, tags, isPublic, customFileName } = req.body;\n      \n      if (!url || typeof url !== 'string') {\n        return res.status(400).json({ \n          message: \"URL –Ω–µ —É–∫–∞–∑–∞–Ω\",\n          code: \"MISSING_URL\"\n        });\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n      const project = await storage.getBotProject(projectId);\n      if (!project) {\n        return res.status(404).json({ \n          message: \"–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\",\n          code: \"PROJECT_NOT_FOUND\"\n        });\n      }\n\n      // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞\n      const urlCheck = await checkUrlAccessibility(url);\n      if (!urlCheck.accessible) {\n        return res.status(400).json({\n          message: \"–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Å—ã–ª–∫–µ\",\n          error: urlCheck.error,\n          code: \"URL_NOT_ACCESSIBLE\"\n        });\n      }\n\n      // –°–æ–∑–¥–∞–µ–º –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n      const date = new Date().toISOString().split('T')[0];\n      const uploadDir = join(process.cwd(), 'uploads', projectId.toString(), date);\n      \n      if (!existsSync(uploadDir)) {\n        mkdirSync(uploadDir, { recursive: true });\n      }\n\n      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞\n      const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n      const originalFileName = customFileName || urlCheck.fileName || 'downloaded-file';\n      const extension = originalFileName.split('.').pop()?.toLowerCase() || 'bin';\n      const baseName = originalFileName\n        .split('.')[0]\n        .replace(/[^a-zA-Z0-9._-]/g, '_')\n        .substring(0, 50);\n      \n      const fileName = `${uniqueSuffix}-${baseName}.${extension}`;\n      const filePath = join(uploadDir, fileName);\n\n      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª\n      const downloadResult = await downloadFileFromUrl(url, filePath);\n      \n      if (!downloadResult.success) {\n        return res.status(400).json({\n          message: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞\",\n          error: downloadResult.error,\n          code: \"DOWNLOAD_FAILED\"\n        });\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª\n      const validation = validateFileDetailed({\n        mimetype: downloadResult.mimeType || 'application/octet-stream',\n        size: downloadResult.size || 0,\n        originalname: originalFileName,\n        path: filePath\n      } as any);\n\n      if (!validation.valid) {\n        // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –µ—Å–ª–∏ –æ–Ω –Ω–µ –ø—Ä–æ—à–µ–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é\n        if (existsSync(filePath)) {\n          unlinkSync(filePath);\n        }\n        return res.status(400).json({\n          message: validation.error,\n          code: \"VALIDATION_FAILED\"\n        });\n      }\n\n      // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É\n      const fileUrl = `/uploads/${projectId}/${date}/${fileName}`;\n\n      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–≥–∏\n      const processedTags = tags \n        ? tags\n            .split(',')\n            .map((tag: string) => tag.trim().toLowerCase())\n            .filter((tag: string) => tag.length > 0 && tag.length <= 50)\n            .slice(0, 10)\n        : [];\n\n      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥–∏\n      const autoTags = ['–∑–∞–≥—Ä—É–∂–µ–Ω–æ_–ø–æ_url'];\n      if (validation.category) {\n        autoTags.push(validation.category);\n      }\n      if (downloadResult.mimeType?.includes('gif')) {\n        autoTags.push('–∞–Ω–∏–º–∞—Ü–∏—è');\n      }\n      if (downloadResult.size && downloadResult.size > 10 * 1024 * 1024) {\n        autoTags.push('–±–æ–ª—å—à–æ–π_—Ñ–∞–π–ª');\n      }\n\n      const finalTags = Array.from(new Set([...processedTags, ...autoTags]));\n\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n      const mediaFile = await storage.createMediaFile({\n        projectId,\n        fileName: originalFileName,\n        fileType: getFileType(downloadResult.mimeType || 'application/octet-stream'),\n        filePath: filePath,\n        fileSize: downloadResult.size || 0,\n        mimeType: downloadResult.mimeType || 'application/octet-stream',\n        url: fileUrl,\n        description: description || `–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ: ${originalFileName}`,\n        tags: finalTags,\n        isPublic: isPublic === 'true' || isPublic === true ? 1 : 0\n      });\n\n      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ\n      res.json({\n        ...mediaFile,\n        downloadInfo: {\n          sourceUrl: url,\n          category: validation.category,\n          sizeMB: Math.round((downloadResult.size || 0) / (1024 * 1024) * 100) / 100,\n          autoTagsAdded: autoTags.length,\n          downloadDate: new Date().toISOString(),\n          method: 'url_download'\n        }\n      });\n\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –ø–æ URL:', error);\n      \n      const errorMessage = error instanceof Error ? error.message : \"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞\";\n      res.status(500).json({ \n        message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –ø–æ URL\",\n        error: errorMessage,\n        code: \"DOWNLOAD_ERROR\"\n      });\n    }\n  });\n\n  // –ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ URL (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)\n  app.post(\"/api/media/download-urls/:projectId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { urls, isPublic, defaultDescription } = req.body;\n      \n      if (!urls || !Array.isArray(urls) || urls.length === 0) {\n        return res.status(400).json({ \n          message: \"URLs –Ω–µ —É–∫–∞–∑–∞–Ω—ã\",\n          code: \"MISSING_URLS\"\n        });\n      }\n\n      if (urls.length > 10) {\n        return res.status(400).json({ \n          message: \"–ú–∞–∫—Å–∏–º—É–º 10 URL –∑–∞ —Ä–∞–∑\",\n          code: \"TOO_MANY_URLS\"\n        });\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n      const project = await storage.getBotProject(projectId);\n      if (!project) {\n        return res.status(404).json({ \n          message: \"–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\",\n          code: \"PROJECT_NOT_FOUND\"\n        });\n      }\n\n      const downloadedFiles = [];\n      const errors = [];\n      \n      // –°–æ–∑–¥–∞–µ–º –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n      const date = new Date().toISOString().split('T')[0];\n      const uploadDir = join(process.cwd(), 'uploads', projectId.toString(), date);\n      \n      if (!existsSync(uploadDir)) {\n        mkdirSync(uploadDir, { recursive: true });\n      }\n\n      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π URL\n      for (let i = 0; i < urls.length; i++) {\n        const urlData = urls[i];\n        const url = typeof urlData === 'string' ? urlData : urlData.url;\n        const customFileName = typeof urlData === 'object' ? urlData.fileName : undefined;\n        const customDescription = typeof urlData === 'object' ? urlData.description : undefined;\n        \n        try {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å\n          const urlCheck = await checkUrlAccessibility(url);\n          if (!urlCheck.accessible) {\n            errors.push({\n              url: url,\n              error: `–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${urlCheck.error}`\n            });\n            continue;\n          }\n\n          // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—É—Ç—å –¥–ª—è —Ñ–∞–π–ª–∞\n          const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n          const originalFileName = customFileName || urlCheck.fileName || `file-${i + 1}`;\n          const extension = originalFileName.split('.').pop()?.toLowerCase() || 'bin';\n          const baseName = originalFileName\n            .split('.')[0]\n            .replace(/[^a-zA-Z0-9._-]/g, '_')\n            .substring(0, 50);\n          \n          const fileName = `${uniqueSuffix}-${baseName}.${extension}`;\n          const filePath = join(uploadDir, fileName);\n\n          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª\n          const downloadResult = await downloadFileFromUrl(url, filePath);\n          \n          if (!downloadResult.success) {\n            errors.push({\n              url: url,\n              error: `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${downloadResult.error}`\n            });\n            continue;\n          }\n\n          // –í–∞–ª–∏–¥–∞—Ü–∏—è\n          const validation = validateFileDetailed({\n            mimetype: downloadResult.mimeType || 'application/octet-stream',\n            size: downloadResult.size || 0,\n            originalname: originalFileName,\n            path: filePath\n          } as any);\n\n          if (!validation.valid) {\n            if (existsSync(filePath)) {\n              unlinkSync(filePath);\n            }\n            errors.push({\n              url: url,\n              error: `–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞: ${validation.error}`\n            });\n            continue;\n          }\n\n          // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞\n          const fileUrl = `/uploads/${projectId}/${date}/${fileName}`;\n\n          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n          const mediaFile = await storage.createMediaFile({\n            projectId,\n            fileName: originalFileName,\n            fileType: getFileType(downloadResult.mimeType || 'application/octet-stream'),\n            filePath: filePath,\n            fileSize: downloadResult.size || 0,\n            mimeType: downloadResult.mimeType || 'application/octet-stream',\n            url: fileUrl,\n            description: customDescription || defaultDescription || `–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ: ${originalFileName}`,\n            tags: ['–∑–∞–≥—Ä—É–∂–µ–Ω–æ_–ø–æ_url', validation.category || '—Ñ–∞–π–ª'],\n            isPublic: isPublic ? 1 : 0\n          });\n\n          downloadedFiles.push({\n            ...mediaFile,\n            sourceUrl: url\n          });\n\n        } catch (error) {\n          console.error(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ URL ${url}:`, error);\n          errors.push({\n            url: url,\n            error: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'\n          });\n        }\n      }\n\n      res.json({\n        success: downloadedFiles.length,\n        errors: errors.length,\n        downloadedFiles,\n        errorDetails: errors,\n        summary: {\n          total: urls.length,\n          successful: downloadedFiles.length,\n          failed: errors.length,\n          totalSize: downloadedFiles.reduce((sum, file) => sum + file.fileSize, 0)\n        }\n      });\n\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ URL:', error);\n      res.status(500).json({ \n        message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ –ø–æ URL\",\n        code: \"BATCH_DOWNLOAD_ERROR\"\n      });\n    }\n  });\n  \n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞\n  app.get(\"/api/media/project/:projectId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const fileType = req.query.type as string;\n      \n      let mediaFiles;\n      if (fileType && ['photo', 'video', 'audio', 'document'].includes(fileType)) {\n        mediaFiles = await storage.getMediaFilesByType(projectId, fileType);\n      } else {\n        mediaFiles = await storage.getMediaFilesByProject(projectId);\n      }\n      \n      res.json(mediaFiles);\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤:\", error);\n      res.status(500).json({ message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤\" });\n    }\n  });\n  \n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞\n  app.get(\"/api/media/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const mediaFile = await storage.getMediaFile(id);\n      \n      if (!mediaFile) {\n        return res.status(404).json({ message: \"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω\" });\n      }\n      \n      res.json(mediaFile);\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\", error);\n      res.status(500).json({ message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞\" });\n    }\n  });\n  \n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞\n  app.put(\"/api/media/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n      \n      const mediaFile = await storage.updateMediaFile(id, updates);\n      \n      if (!mediaFile) {\n        return res.status(404).json({ message: \"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω\" });\n      }\n      \n      res.json(mediaFile);\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\", error);\n      res.status(500).json({ message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞\" });\n    }\n  });\n  \n  // –£–¥–∞–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞\n  app.delete(\"/api/media/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º\n      const mediaFile = await storage.getMediaFile(id);\n      if (!mediaFile) {\n        return res.status(404).json({ message: \"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω\" });\n      }\n      \n      // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞\n      try {\n        unlinkSync(mediaFile.filePath);\n      } catch (error) {\n        console.warn(\"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞:\", error);\n      }\n      \n      // –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n      const success = await storage.deleteMediaFile(id);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\" });\n      }\n      \n      res.json({ message: \"–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω\" });\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\", error);\n      res.status(500).json({ message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞\" });\n    }\n  });\n  \n  // –ü–æ–∏—Å–∫ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤\n  app.get(\"/api/media/search/:projectId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const query = req.query.q as string;\n      \n      if (!query) {\n        return res.status(400).json({ message: \"–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º\" });\n      }\n      \n      const mediaFiles = await storage.searchMediaFiles(projectId, query);\n      res.json(mediaFiles);\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ñ–∞–π–ª–æ–≤:\", error);\n      res.status(500).json({ message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ñ–∞–π–ª–æ–≤\" });\n    }\n  });\n  \n  // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞\n  app.post(\"/api/media/:id/use\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.incrementMediaFileUsage(id);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω\" });\n      }\n      \n      res.json({ message: \"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –æ—Ç–º–µ—á–µ–Ω–æ\" });\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞:\", error);\n      res.status(500).json({ message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞\" });\n    }\n  });\n\n  // User Bot Data Management endpoints\n  \n  // Get all user data for a project\n  app.get(\"/api/projects/:id/users\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      console.log(`Fetching users for project ${projectId}`);\n      \n      // Connect directly to PostgreSQL to get data from bot_users table\n      const { Pool } = await import('pg');\n      const pool = new Pool({\n        connectionString: process.env.DATABASE_URL\n      });\n      \n      const result = await pool.query(`\n        SELECT \n          user_id,\n          username,\n          first_name,\n          last_name,\n          registered_at,\n          last_interaction,\n          interaction_count,\n          user_data,\n          is_active\n        FROM bot_users \n        ORDER BY last_interaction DESC\n      `);\n      \n      await pool.end();\n      \n      console.log(`Found ${result.rows.length} users for project ${projectId}`);\n      res.json(result.rows);\n    } catch (error) {\n      console.error(\"Error fetching user data:\", error);\n      // Fallback to storage interface if bot_users table doesn't exist\n      try {\n        const users = await storage.getUserBotDataByProject(parseInt(req.params.id));\n        const projectId = parseInt(req.params.id);\n        console.log(`Found ${users.length} users for project ${projectId} from fallback`);\n        res.json(users);\n      } catch (fallbackError) {\n        res.status(500).json({ message: \"Failed to fetch user data\" });\n      }\n    }\n  });\n\n  // Get user data stats for a project\n  app.get(\"/api/projects/:id/users/stats\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      console.log(`Fetching user stats for project ${projectId}`);\n      \n      // Use direct PostgreSQL query on bot_users table\n      const { Pool } = await import('pg');\n      const pool = new Pool({\n        connectionString: process.env.DATABASE_URL\n      });\n      \n      const result = await pool.query(`\n        SELECT \n          COUNT(*) as \"totalUsers\",\n          COUNT(*) FILTER (WHERE is_active = 1) as \"activeUsers\",\n          COUNT(*) FILTER (WHERE is_active = 0) as \"blockedUsers\",\n          0 as \"premiumUsers\",\n          COUNT(*) FILTER (WHERE user_data IS NOT NULL AND user_data != '{}' AND (user_data::text LIKE '%response_%' OR user_data::text LIKE '%feedback%' OR user_data::text LIKE '%answer%' OR user_data::text LIKE '%input%' OR user_data::text LIKE '%user_%')) as \"usersWithResponses\",\n          COALESCE(SUM(interaction_count), 0) as \"totalInteractions\",\n          COALESCE(AVG(interaction_count), 0) as \"avgInteractionsPerUser\"\n        FROM bot_users\n      `);\n      \n      await pool.end();\n      \n      const stats = result.rows[0];\n      // Convert strings to numbers\n      Object.keys(stats).forEach(key => {\n        if (typeof stats[key] === 'string' && !isNaN(stats[key] as any)) {\n          stats[key] = parseInt(stats[key] as any);\n        }\n      });\n      \n      console.log(`User stats for project ${projectId}:`, stats);\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching user stats:\", error);\n      // Fallback to user_bot_data table if bot_users doesn't exist\n      try {\n        const { Pool } = await import('pg');\n        const pool = new Pool({\n          connectionString: process.env.DATABASE_URL\n        });\n        \n        const result = await pool.query(`\n          SELECT \n            COUNT(*) as \"totalUsers\",\n            COUNT(*) FILTER (WHERE is_active = 1) as \"activeUsers\",\n            COUNT(*) FILTER (WHERE is_active = 0) as \"blockedUsers\",\n            COUNT(*) FILTER (WHERE is_premium = 1) as \"premiumUsers\",\n            COUNT(*) FILTER (WHERE user_data IS NOT NULL AND user_data != '{}' AND (user_data::text LIKE '%response_%' OR user_data::text LIKE '%feedback%' OR user_data::text LIKE '%answer%' OR user_data::text LIKE '%input%' OR user_data::text LIKE '%user_%')) as \"usersWithResponses\",\n            COALESCE(SUM(interaction_count), 0) as \"totalInteractions\",\n            COALESCE(AVG(interaction_count), 0) as \"avgInteractionsPerUser\"\n          FROM user_bot_data\n          WHERE project_id = $1\n        `, [req.params.id]);\n        \n        await pool.end();\n        \n        const stats = result.rows[0];\n        Object.keys(stats).forEach(key => {\n          if (typeof stats[key] === 'string' && !isNaN(stats[key] as any)) {\n            stats[key] = parseInt(stats[key] as any);\n          }\n        });\n        \n        res.json(stats);\n      } catch (fallbackError) {\n        res.status(500).json({ message: \"Failed to fetch user stats\" });\n      }\n    }\n  });\n\n  // Get detailed user responses for a project\n  app.get(\"/api/projects/:id/responses\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      \n      // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ PostgreSQL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ bot_users\n      const { Pool } = await import('pg');\n      const pool = new Pool({\n        connectionString: process.env.DATABASE_URL\n      });\n      \n      const result = await pool.query(`\n        SELECT \n          user_id,\n          username,\n          first_name,\n          last_name,\n          user_data,\n          registered_at,\n          last_interaction\n        FROM bot_users \n        WHERE user_data IS NOT NULL \n          AND user_data != '{}'\n        ORDER BY last_interaction DESC\n      `);\n      \n      await pool.end();\n      \n      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç—ã\n      const processedResponses = result.rows.map(user => {\n        const responses: any[] = [];\n        \n        if (user.user_data && typeof user.user_data === 'object') {\n          Object.entries(user.user_data).forEach(([key, value]) => {\n            // –ü—Ä–∏–Ω–∏–º–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫—Ä–æ–º–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö –∏ generic button clicks\n            if (!key.startsWith('input_') && !key.startsWith('waiting_') && key !== 'button_click' && key !== 'last_button_click') {\n              let responseData;\n              let responseType = 'text';\n              let timestamp = null;\n              let nodeId = null;\n              let responseValue = value;\n              \n              try {\n                // –ï—Å–ª–∏ value —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º, –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n                if (typeof value === 'object' && value !== null) {\n                  responseData = value as any;\n                  responseValue = responseData.value || value;\n                  responseType = responseData.type || 'text';\n                  timestamp = responseData.timestamp;\n                  nodeId = responseData.nodeId;\n                } else {\n                  // –ü—Ä–æ—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\n                  responseValue = value;\n                  responseType = 'text';\n                }\n                \n                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É\n                if (key === 'button_click') {\n                  responseType = 'button';\n                  // –ï—Å–ª–∏ —ç—Ç–æ callback data (–≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ node ID), –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ\n                  if (typeof responseValue === 'string' && \n                      (responseValue.match(/^[a-zA-Z0-9_-]{15,25}$/) || \n                       responseValue.match(/^--[a-zA-Z0-9_-]{10,}$/) ||\n                       responseValue.includes('-') && responseValue.length > 10)) {\n                    responseValue = '–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É';\n                  }\n                } else if (key.includes('–∂–µ–ª–∞–Ω–∏–µ') || key.includes('–ø–æ–ª') || key.includes('choice')) {\n                  responseType = 'button';\n                } else if (typeof responseValue === 'string' && \n                          (responseValue === '–î–∞' || responseValue === '–ù–µ—Ç' || \n                           responseValue === '–ñ–µ–Ω—â–∏–Ω–∞' || responseValue === '–ú—É–∂—á–∏–Ω–∞')) {\n                  responseType = 'button';\n                }\n                \n                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∑–∞–º–µ–Ω—ã node IDs –Ω–∞ –ø–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è\n                if (typeof responseValue === 'string') {\n                  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã node ID\n                  if (responseValue.match(/^--[a-zA-Z0-9_-]{10,}$/) ||\n                      responseValue.match(/^[a-zA-Z0-9_-]{15,}$/) ||\n                      responseValue.match(/^[a-zA-Z0-9-]{20,}$/)) {\n                    responseValue = '–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É';\n                    responseType = 'button';\n                  }\n                }\n                \n                // –ï—Å–ª–∏ –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ\n                if (!timestamp) {\n                  timestamp = user.last_interaction;\n                }\n                \n              } catch (error) {\n                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É\n                responseValue = value;\n                responseType = 'text';\n                timestamp = user.last_interaction;\n              }\n              \n              responses.push({\n                key,\n                value: responseValue,\n                type: responseType,\n                timestamp: timestamp,\n                nodeId: nodeId,\n                variable: key\n              });\n            }\n          });\n        }\n        \n        return {\n          user_id: user.user_id,\n          username: user.username,\n          first_name: user.first_name,\n          last_name: user.last_name,\n          registered_at: user.registered_at,\n          last_interaction: user.last_interaction,\n          responses: responses.sort((a, b) => \n            new Date(b.timestamp || 0).getTime() - new Date(a.timestamp || 0).getTime()\n          ),\n          responseCount: responses.length\n        };\n      }).filter(user => user.responses.length > 0); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ—Ç–≤–µ—Ç–∞–º–∏\n      \n      res.json(processedResponses);\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:\", error);\n      res.status(500).json({ message: \"Failed to fetch user responses\" });\n    }\n  });\n\n  // Get specific user data by ID\n  app.get(\"/api/users/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const userData = await storage.getUserBotData(id);\n      if (!userData) {\n        return res.status(404).json({ message: \"User data not found\" });\n      }\n      res.json(userData);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user data\" });\n    }\n  });\n\n  // Get user data by project and telegram user ID\n  app.get(\"/api/projects/:projectId/users/:userId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const userId = req.params.userId;\n      const userData = await storage.getUserBotDataByProjectAndUser(projectId, userId);\n      if (!userData) {\n        return res.status(404).json({ message: \"User data not found\" });\n      }\n      res.json(userData);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user data\" });\n    }\n  });\n\n  // Create new user data\n  app.post(\"/api/projects/:id/users\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const validatedData = insertUserBotDataSchema.parse({\n        ...req.body,\n        projectId\n      });\n      const userData = await storage.createUserBotData(validatedData);\n      res.status(201).json(userData);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create user data\" });\n    }\n  });\n\n  // Update user data in bot_users table\n  app.put(\"/api/users/:id\", async (req, res) => {\n    try {\n      const userId = req.params.id; // This is telegram user_id as string\n      \n      // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ PostgreSQL –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ bot_users\n      const { Pool } = await import('pg');\n      const pool = new Pool({\n        connectionString: process.env.DATABASE_URL\n      });\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫–∏–µ –ø–æ–ª—è –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å\n      const updateFields = [];\n      const values = [];\n      let paramIndex = 1;\n      \n      if (req.body.isActive !== undefined) {\n        updateFields.push(`is_active = $${paramIndex++}`);\n        values.push(Boolean(req.body.isActive === 1 || req.body.isActive === true));\n      }\n      \n      // Note: is_blocked and is_premium columns don't exist in bot_users table\n      // These fields are handled through user_data JSON field if needed\n      \n      if (updateFields.length === 0) {\n        await pool.end();\n        return res.status(400).json({ message: \"No valid fields to update\" });\n      }\n      \n      const query = `\n        UPDATE bot_users \n        SET ${updateFields.join(', ')}, last_interaction = NOW()\n        WHERE user_id = $${paramIndex}\n        RETURNING *\n      `;\n      values.push(userId);\n      \n      console.log('Updating user:', userId, 'with query:', query, 'values:', values);\n      \n      const result = await pool.query(query, values);\n      await pool.end();\n      \n      console.log('Update result:', result.rows.length, 'rows affected');\n      \n      if (result.rows.length === 0) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json(result.rows[0]);\n    } catch (error) {\n      console.error(\"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ bot_users:\", error);\n      // Fallback to regular update if bot_users table doesn't exist\n      try {\n        const id = parseInt(req.params.id);\n        const validatedData = insertUserBotDataSchema.partial().parse(req.body);\n        const userData = await storage.updateUserBotData(id, validatedData);\n        if (!userData) {\n          return res.status(404).json({ message: \"User data not found\" });\n        }\n        res.json(userData);\n      } catch (fallbackError) {\n        res.status(500).json({ message: \"Failed to update user data\" });\n      }\n    }\n  });\n\n  // Delete user data\n  app.delete(\"/api/users/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL –¥–ª—è –ø—Ä—è–º–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è\n      const pool = new Pool({\n        connectionString: process.env.DATABASE_URL,\n      });\n\n      try {\n        // –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å –∏–∑ bot_users –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞–ª user_id\n        const deleteResult = await pool.query(\n          `DELETE FROM bot_users WHERE user_id = $1`,\n          [id]\n        );\n        \n        await pool.end();\n        \n        if (deleteResult.rowCount && deleteResult.rowCount > 0) {\n          console.log(`Deleted user ${id} from bot_users table`);\n          return res.json({ message: \"User data deleted successfully\" });\n        }\n      } catch (dbError) {\n        await pool.end();\n        console.log(\"bot_users table not found, falling back to user_bot_data\");\n      }\n\n      // Fallback: —É–¥–∞–ª—è–µ–º –∏–∑ user_bot_data —Ç–∞–±–ª–∏—Ü—ã\n      const success = await storage.deleteUserBotData(id);\n      if (!success) {\n        return res.status(404).json({ message: \"User data not found\" });\n      }\n      res.json({ message: \"User data deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete user data:\", error);\n      res.status(500).json({ message: \"Failed to delete user data\" });\n    }\n  });\n\n  // Delete all user data for a project\n  app.delete(\"/api/projects/:id/users\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      let totalDeleted = 0;\n      \n      // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL\n      const pool = new Pool({\n        connectionString: process.env.DATABASE_URL,\n      });\n\n      try {\n        // –£–¥–∞–ª—è–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã bot_users –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞\n        const deleteResult = await pool.query(\n          `DELETE FROM bot_users WHERE project_id = $1`,\n          [projectId]\n        );\n        \n        totalDeleted += deleteResult.rowCount || 0;\n        console.log(`Deleted ${deleteResult.rowCount || 0} users from bot_users for project ${projectId}`);\n      } catch (dbError) {\n        console.log(\"bot_users table not found or error:\", (dbError as any).message);\n      }\n\n      await pool.end();\n      \n      // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ user_bot_data –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º\n      const existingUserData = await storage.getUserBotDataByProject(projectId);\n      const userBotDataCount = existingUserData.length;\n      \n      // –£–¥–∞–ª—è–µ–º –∏–∑ user_bot_data —Ç–∞–±–ª–∏—Ü—ã\n      const fallbackSuccess = await storage.deleteUserBotDataByProject(projectId);\n      if (fallbackSuccess) {\n        totalDeleted += userBotDataCount;\n        console.log(`Deleted ${userBotDataCount} users from user_bot_data for project ${projectId}`);\n      }\n      \n      res.json({ \n        message: \"All user data deleted successfully\", \n        deleted: true,\n        deletedCount: totalDeleted\n      });\n    } catch (error) {\n      console.error(\"Failed to delete user data:\", error);\n      res.status(500).json({ message: \"Failed to delete user data\" });\n    }\n  });\n\n  // Search user data\n  app.get(\"/api/projects/:id/users/search\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const query = req.query.q as string;\n      \n      if (!query || query.trim().length === 0) {\n        return res.status(400).json({ message: \"Search query is required\" });\n      }\n      \n      const users = await storage.searchUserBotData(projectId, query.trim());\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to search user data\" });\n    }\n  });\n\n  // Increment user interaction count\n  app.post(\"/api/users/:id/interaction\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.incrementUserInteraction(id);\n      if (!success) {\n        return res.status(404).json({ message: \"User data not found\" });\n      }\n      res.json({ message: \"Interaction count incremented\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to increment interaction\" });\n    }\n  });\n\n  // Update user state\n  app.put(\"/api/users/:id/state\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { state } = req.body;\n      \n      if (!state || typeof state !== 'string') {\n        return res.status(400).json({ message: \"State is required and must be a string\" });\n      }\n      \n      const success = await storage.updateUserState(id, state);\n      if (!success) {\n        return res.status(404).json({ message: \"User data not found\" });\n      }\n      res.json({ message: \"User state updated successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update user state\" });\n    }\n  });\n\n  // Bot Groups API\n  // Get groups for a project\n  app.get(\"/api/projects/:id/groups\", async (req, res) => {\n    console.log(\"=== GROUPS API CALLED ===\");\n    try {\n      const projectId = parseInt(req.params.id);\n      if (isNaN(projectId)) {\n        return res.status(400).json({ message: \"Invalid project ID\" });\n      }\n      \n      console.log(\"Getting groups for project\", projectId);\n      console.log(\"Storage methods available:\", Object.getOwnPropertyNames(storage).includes('getBotGroupsByProject'));\n      console.log(\"Storage prototype methods:\", Object.getOwnPropertyNames(Object.getPrototypeOf(storage)));\n      \n      const groups = await storage.getBotGroupsByProject(projectId);\n      console.log(\"Groups found:\", groups);\n      res.json(groups);\n    } catch (error) {\n      console.error(\"Failed to get groups:\", error);\n      res.status(500).json({ message: \"Failed to get groups\" });\n    }\n  });\n\n  // Create a new group\n  app.post(\"/api/projects/:id/groups\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      if (isNaN(projectId)) {\n        return res.status(400).json({ message: \"Invalid project ID\" });\n      }\n      \n      console.log(\"=== CREATE GROUP DEBUG ===\");\n      console.log(\"Request body:\", JSON.stringify(req.body, null, 2));\n      console.log(\"Project ID:\", projectId);\n      console.log(\"Data to validate:\", JSON.stringify({ ...req.body, projectId }, null, 2));\n      \n      const result = insertBotGroupSchema.safeParse({ ...req.body, projectId });\n      if (!result.success) {\n        console.log(\"Validation errors:\", JSON.stringify(result.error.errors, null, 2));\n        return res.status(400).json({ message: \"Invalid group data\", errors: result.error.errors });\n      }\n      \n      console.log(\"Validation successful, data:\", JSON.stringify(result.data, null, 2));\n      \n      const group = await storage.createBotGroup(result.data);\n      res.json(group);\n    } catch (error) {\n      console.error(\"Failed to create group:\", error);\n      res.status(500).json({ message: \"Failed to create group\" });\n    }\n  });\n\n  // Update a group\n  app.put(\"/api/projects/:projectId/groups/:groupId\", async (req, res) => {\n    try {\n      const groupId = parseInt(req.params.groupId);\n      if (isNaN(groupId)) {\n        return res.status(400).json({ message: \"Invalid group ID\" });\n      }\n      \n      const group = await storage.updateBotGroup(groupId, req.body);\n      if (!group) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n      \n      res.json(group);\n    } catch (error) {\n      console.error(\"Failed to update group:\", error);\n      res.status(500).json({ message: \"Failed to update group\" });\n    }\n  });\n\n  // Delete a group\n  app.delete(\"/api/projects/:projectId/groups/:groupId\", async (req, res) => {\n    try {\n      const groupId = parseInt(req.params.groupId);\n      if (isNaN(groupId)) {\n        return res.status(400).json({ message: \"Invalid group ID\" });\n      }\n      \n      const success = await storage.deleteBotGroup(groupId);\n      if (!success) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n      \n      res.json({ message: \"Group deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete group:\", error);\n      res.status(500).json({ message: \"Failed to delete group\" });\n    }\n  });\n\n  // Get bot information (getMe)\n  app.get(\"/api/projects/:id/bot/info\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      \n      // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      // Get bot token for this project\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found. Please add a token first.\" });\n      }\n\n      // Get bot information via Telegram Bot API with cache busting\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/getMe?_t=${Date.now()}`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Cache-Control': 'no-cache',\n          'Pragma': 'no-cache'\n        }\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to get bot info\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      const botInfo = result.result;\n      \n      // –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –æ—Ç Telegram API –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n      console.log('Telegram API response:', JSON.stringify({\n        first_name: botInfo.first_name,\n        username: botInfo.username,\n        description: botInfo.description,\n        short_description: botInfo.short_description\n      }, null, 2));\n      \n      // If bot has photo, get the file URL\n      let photoUrl = null;\n      if (botInfo.photo && botInfo.photo.big_file_id) {\n        try {\n          // Get file info\n          const fileResponse = await fetch(`https://api.telegram.org/bot${defaultToken.token}/getFile`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              file_id: botInfo.photo.big_file_id\n            })\n          });\n          \n          const fileResult = await fileResponse.json();\n          \n          if (fileResponse.ok && fileResult.result && fileResult.result.file_path) {\n            // Construct full photo URL\n            photoUrl = `https://api.telegram.org/file/bot${defaultToken.token}/${fileResult.result.file_path}`;\n          }\n        } catch (photoError) {\n          console.warn(\"Failed to get bot photo URL:\", photoError);\n          // Continue without photo - not a critical error\n        }\n      }\n\n      // Add photo URL to response\n      const responseData = {\n        ...botInfo,\n        photoUrl: photoUrl\n      };\n\n      res.json(responseData);\n    } catch (error) {\n      console.error(\"Failed to get bot info:\", error);\n      res.status(500).json({ message: \"Failed to get bot info\" });\n    }\n  });\n\n  // Update bot name\n  app.put(\"/api/projects/:id/bot/name\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { name, language_code = 'ru' } = req.body;\n\n      console.log('üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –±–æ—Ç–∞:', { projectId, name, language_code });\n\n      // Get bot token for this project\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        console.error('‚ùå –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞', projectId);\n        return res.status(400).json({ message: \"Bot token not found. Please add a token first.\" });\n      }\n\n      console.log('‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ Telegram API...');\n\n      // Update bot name via Telegram Bot API\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/setMyName`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ name, language_code })\n      });\n\n      const result = await response.json();\n      \n      console.log('üì° –û—Ç–≤–µ—Ç –æ—Ç Telegram API setMyName:', { status: response.status, result });\n      \n      if (!response.ok) {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç Telegram API:', result);\n        return res.status(400).json({ \n          message: \"Failed to update bot name\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      console.log('‚úÖ –ò–º—è –±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ Telegram API');\n      res.json({ message: \"Bot name updated successfully\" });\n    } catch (error) {\n      console.error(\"Failed to update bot name:\", error);\n      res.status(500).json({ message: \"Failed to update bot name\" });\n    }\n  });\n\n  // Update bot description\n  app.put(\"/api/projects/:id/bot/description\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { description, language_code = 'ru' } = req.body;\n\n      console.log('üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –±–æ—Ç–∞:', { projectId, description, language_code });\n\n      // Get bot token for this project\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        console.error('‚ùå –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞', projectId);\n        return res.status(400).json({ message: \"Bot token not found. Please add a token first.\" });\n      }\n\n      console.log('‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ Telegram API...');\n\n      // Update bot description via Telegram Bot API\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/setMyDescription`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ description, language_code })\n      });\n\n      const result = await response.json();\n      \n      console.log('üì° –û—Ç–≤–µ—Ç –æ—Ç Telegram API setMyDescription:', { status: response.status, result });\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to update bot description\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ message: \"Bot description updated successfully\" });\n    } catch (error) {\n      console.error(\"Failed to update bot description:\", error);\n      res.status(500).json({ message: \"Failed to update bot description\" });\n    }\n  });\n\n  // Update bot short description\n  app.put(\"/api/projects/:id/bot/short-description\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { short_description, language_code = 'ru' } = req.body;\n\n      // Get bot token for this project\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found. Please add a token first.\" });\n      }\n\n      // Update bot short description via Telegram Bot API\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/setMyShortDescription`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ short_description, language_code })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to update bot short description\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ message: \"Bot short description updated successfully\" });\n    } catch (error) {\n      console.error(\"Failed to update bot short description:\", error);\n      res.status(500).json({ message: \"Failed to update bot short description\" });\n    }\n  });\n\n  // Telegram Bot API integration for groups\n  // Send message to group\n  app.post(\"/api/projects/:projectId/bot/send-group-message\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, message } = req.body;\n      \n      if (!groupId || !message) {\n        return res.status(400).json({ message: \"Group ID and message are required\" });\n      }\n\n      // Get bot token for this project\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found. Please add a token first.\" });\n      }\n\n      // Send message via Telegram Bot API\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/sendMessage`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          text: message,\n          parse_mode: 'HTML'\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to send message\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ \n        message: \"Message sent successfully\", \n        messageId: result.result.message_id \n      });\n    } catch (error) {\n      console.error(\"Failed to send group message:\", error);\n      res.status(500).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // Get group chat information\n  app.get(\"/api/projects/:projectId/bot/group-info/:groupId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId } = req.params;\n      \n      // Check if groupId is null, undefined, or \"null\" string\n      if (!groupId || groupId === 'null' || groupId === 'undefined') {\n        return res.status(400).json({ \n          message: \"–ù–µ —É–∫–∞–∑–∞–Ω ID –≥—Ä—É–ø–ø—ã\", \n          error: \"–î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å chat_id. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Å–ª–∞–π—Ç–µ –µ–≥–æ –≤ @userinfobot —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å chat_id –≥—Ä—É–ø–ø—ã.\"\n        });\n      }\n      \n      // Get bot token for this project\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found. Please add a token first.\" });\n      }\n\n      // Get chat information via Telegram Bot API\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/getChat`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to get group info\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      const chatInfo = result.result;\n      \n      // If chat has photo, get the file URL\n      let avatarUrl = null;\n      if (chatInfo.photo && chatInfo.photo.big_file_id) {\n        try {\n          // Get file info\n          const fileResponse = await fetch(`https://api.telegram.org/bot${defaultToken.token}/getFile`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              file_id: chatInfo.photo.big_file_id\n            })\n          });\n          \n          const fileResult = await fileResponse.json();\n          \n          if (fileResponse.ok && fileResult.result && fileResult.result.file_path) {\n            // Construct full photo URL\n            avatarUrl = `https://api.telegram.org/file/bot${defaultToken.token}/${fileResult.result.file_path}`;\n          }\n        } catch (photoError) {\n          console.warn(\"Failed to get group photo URL:\", photoError);\n          // Continue without photo - not a critical error\n        }\n      }\n\n      // Add avatar URL to response\n      const responseData = {\n        ...chatInfo,\n        avatarUrl: avatarUrl\n      };\n\n      res.json(responseData);\n    } catch (error) {\n      console.error(\"Failed to get group info:\", error);\n      res.status(500).json({ message: \"Failed to get group info\" });\n    }\n  });\n\n  // Get group members count\n  app.get(\"/api/projects/:projectId/bot/group-members-count/:groupId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId } = req.params;\n      \n      // Check if groupId is null, undefined, or \"null\" string\n      if (!groupId || groupId === 'null' || groupId === 'undefined') {\n        return res.status(400).json({ \n          message: \"–ù–µ —É–∫–∞–∑–∞–Ω ID –≥—Ä—É–ø–ø—ã\", \n          error: \"–î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å chat_id. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Å–ª–∞–π—Ç–µ –µ–≥–æ –≤ @userinfobot —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å chat_id –≥—Ä—É–ø–ø—ã.\"\n        });\n      }\n      \n      // Get bot token for this project\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found. Please add a token first.\" });\n      }\n\n      // Get members count via Telegram Bot API\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/getChatMemberCount`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to get members count\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ count: result.result });\n    } catch (error) {\n      console.error(\"Failed to get members count:\", error);\n      res.status(500).json({ message: \"Failed to get members count\" });\n    }\n  });\n\n  // Get bot admin status in group\n  app.get(\"/api/projects/:projectId/bot/admin-status/:groupId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId } = req.params;\n      \n      // Check if groupId is null, undefined, or \"null\" string\n      if (!groupId || groupId === 'null' || groupId === 'undefined') {\n        return res.status(400).json({ \n          message: \"–ù–µ —É–∫–∞–∑–∞–Ω ID –≥—Ä—É–ø–ø—ã\", \n          error: \"–î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å chat_id. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Å–ª–∞–π—Ç–µ –µ–≥–æ –≤ @userinfobot —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å chat_id –≥—Ä—É–ø–ø—ã.\"\n        });\n      }\n      \n      // Get bot token for this project\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found. Please add a token first.\" });\n      }\n\n      // Get bot information first\n      const botInfoResponse = await fetch(`https://api.telegram.org/bot${defaultToken.token}/getMe`);\n      const botInfo = await botInfoResponse.json();\n      \n      if (!botInfoResponse.ok) {\n        return res.status(400).json({ message: \"Failed to get bot info\" });\n      }\n\n      const botId = botInfo.result.id;\n\n      // Check bot admin status\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/getChatMember`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          user_id: botId\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to get admin status\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      const isAdmin = ['administrator', 'creator'].includes(result.result.status);\n      \n      res.json({ \n        isAdmin,\n        status: result.result.status,\n        permissions: result.result\n      });\n    } catch (error) {\n      console.error(\"Failed to get admin status:\", error);\n      res.status(500).json({ message: \"Failed to get admin status\" });\n    }\n  });\n\n  // Get group administrators\n  app.get(\"/api/projects/:projectId/bot/group-admins/:groupId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId } = req.params;\n      \n      if (!groupId || groupId === \"null\") {\n        return res.status(400).json({ message: \"Group ID is required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/getChatAdministrators`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to get administrators\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      // –ù–∞–π—Ç–∏ –±–æ—Ç–∞ —Å—Ä–µ–¥–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –∏–∑–≤–ª–µ—á—å –µ–≥–æ –ø—Ä–∞–≤–∞\n      let botAdminRights = null;\n      const botUser = await fetch(`https://api.telegram.org/bot${defaultToken.token}/getMe`);\n      const botInfo = await botUser.json();\n      \n      if (botUser.ok && result.result) {\n        const botAdmin = result.result.find((admin: any) => \n          admin.user && admin.user.id === botInfo.result.id\n        );\n        \n        if (botAdmin && botAdmin.status === 'administrator') {\n          // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –±–æ—Ç–∞\n          botAdminRights = {\n            can_manage_chat: botAdmin.can_manage_chat || false,\n            can_change_info: botAdmin.can_change_info || false,\n            can_delete_messages: botAdmin.can_delete_messages || false,\n            can_invite_users: botAdmin.can_invite_users || false,\n            can_restrict_members: botAdmin.can_restrict_members || false,\n            can_pin_messages: botAdmin.can_pin_messages || false,\n            can_promote_members: botAdmin.can_promote_members || false,\n            can_manage_video_chats: botAdmin.can_manage_video_chats || false\n          };\n        }\n      }\n\n      res.json({ \n        administrators: result.result,\n        botAdminRights: botAdminRights\n      });\n    } catch (error) {\n      console.error(\"Failed to get administrators:\", error);\n      res.status(500).json({ message: \"Failed to get administrators\" });\n    }\n  });\n\n  // Get all group members (works only for small groups <200 members)\n  app.get(\"/api/projects/:projectId/bot/group-members/:groupId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId } = req.params;\n      \n      if (!groupId || groupId === \"null\") {\n        return res.status(400).json({ message: \"Group ID is required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      // First check if this is a small group by getting chat info\n      const chatInfoResponse = await fetch(`https://api.telegram.org/bot${defaultToken.token}/getChat`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId\n        })\n      });\n\n      const chatInfo = await chatInfoResponse.json();\n      \n      if (!chatInfoResponse.ok) {\n        return res.status(400).json({ \n          message: \"Failed to get chat info\", \n          error: chatInfo.description || \"Unknown error\"\n        });\n      }\n\n      // For large groups, we can only provide administrators\n      // Check only member count, not group type - small supergroups should work\n      if (chatInfo.result.members_count && chatInfo.result.members_count > 200) {\n        return res.status(400).json({ \n          message: \"Cannot get member list for large groups\", \n          error: \"Telegram API allows getting full member list only for small groups (<200 members). For large groups, only administrators are available.\",\n          membersCount: chatInfo.result.members_count\n        });\n      }\n\n      // Telegram Bot API has limitations for getting chat members\n      // For privacy reasons, even small groups only allow getting administrators\n      try {\n        const adminsResponse = await fetch(`https://api.telegram.org/bot${defaultToken.token}/getChatAdministrators`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            chat_id: groupId\n          })\n        });\n\n        const adminsResult = await adminsResponse.json();\n        \n        if (!adminsResponse.ok) {\n          return res.status(400).json({ \n            message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\", \n            error: adminsResult.description || \"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞\"\n          });\n        }\n\n        // Include information about group size\n        const memberCount = chatInfo.result.members_count || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n        \n        return res.json({ \n          members: adminsResult.result,\n          isPartialList: true,\n          totalCount: memberCount,\n          message: `–ì—Ä—É–ø–ø–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç ${memberCount} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (${adminsResult.result.length}).`,\n          explanation: \"Telegram API –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–ø–∏—Å–∫—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏. –î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã.\"\n        });\n\n      } catch (error) {\n        console.error(\"Error getting members:\", error);\n        res.status(500).json({ message: \"Failed to get group members\" });\n      }\n\n    } catch (error) {\n      console.error(\"Failed to get group members:\", error);\n      res.status(500).json({ message: \"Failed to get group members\" });\n    }\n  });\n\n  // Check specific member status\n  app.get(\"/api/projects/:projectId/bot/check-member/:groupId/:userId\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, userId } = req.params;\n      \n      if (!groupId || groupId === \"null\" || !userId) {\n        return res.status(400).json({ message: \"Group ID and User ID are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/getChatMember`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          user_id: parseInt(userId)\n        })\n      });\n\n      const result = await response.json();\n      \n      console.log(\"Telegram API response for check member:\", {\n        ok: response.ok,\n        status: response.status,\n        result: result,\n        groupId: groupId,\n        userId: userId\n      });\n      \n      if (!response.ok) {\n        console.error(\"Failed to check member status via Telegram API:\", result);\n        // –ï—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ username, –ø—Ä–æ–±—É–µ–º –æ–±—ä—è—Å–Ω–∏—Ç—å\n        if (result.description && result.description.includes(\"user not found\")) {\n          return res.status(400).json({ \n            message: \"User not found\", \n            error: \"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã —É–∫–∞–∑–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π @username –∏–ª–∏ —á–∏—Å–ª–æ–≤–æ–π ID.\"\n          });\n        }\n        return res.status(400).json({ \n          message: \"Failed to check member status\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      // Return member info with friendly status\n      const member = result.result;\n      const friendlyStatus = {\n        'creator': '–°–æ–∑–¥–∞—Ç–µ–ª—å',\n        'administrator': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', \n        'member': '–£—á–∞—Å—Ç–Ω–∏–∫',\n        'restricted': '–û–≥—Ä–∞–Ω–∏—á–µ–Ω',\n        'left': '–ü–æ–∫–∏–Ω—É–ª –≥—Ä—É–ø–ø—É',\n        'kicked': '–ò—Å–∫–ª—é—á–µ–Ω'\n      };\n\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –µ–≥–æ —Ç–∞–º –µ—â–µ –Ω–µ—Ç\n      try {\n        // –ù–∞—Ö–æ–¥–∏–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID –≥—Ä—É–ø–ø—ã –∏–∑ botGroups —Ç–∞–±–ª–∏—Ü—ã\n        const group = await storage.getBotGroupByProjectAndGroupId(projectId, groupId);\n        if (group) {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π —É—á–∞—Å—Ç–Ω–∏–∫ –≤ –±–∞–∑–µ\n          const existingMembers = await storage.getGroupMembers(group.id);\n          const existingMember = existingMembers.find(m => m.userId.toString() === userId);\n          \n          if (!existingMember) {\n            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞\n            const memberData = {\n              groupId: group.id,\n              userId: parseInt(userId),\n              username: member.user?.username || null,\n              firstName: member.user?.first_name || null,\n              lastName: member.user?.last_name || null,\n              status: member.status,\n              isBot: member.user?.is_bot ? 1 : 0,\n              isActive: 1,\n              adminRights: member.status === 'administrator' ? {\n                can_change_info: member.can_change_info || false,\n                can_delete_messages: member.can_delete_messages || false,\n                can_restrict_members: member.can_restrict_members || false,\n                can_invite_users: member.can_invite_users || false,\n                can_pin_messages: member.can_pin_messages || false,\n                can_promote_members: member.can_promote_members || false,\n                can_manage_video_chats: member.can_manage_video_chats || false,\n                can_be_anonymous: member.is_anonymous || false\n              } : {},\n              customTitle: member.custom_title || null,\n              restrictions: {},\n              messageCount: 0,\n              lastSeen: new Date()\n            };\n            \n            await storage.createGroupMember(memberData);\n            console.log(`‚úÖ –£—á–∞—Å—Ç–Ω–∏–∫ ${member.user?.first_name || userId} —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö`);\n          } else {\n            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞\n            const updateData = {\n              status: member.status,\n              username: member.user?.username || existingMember.username,\n              firstName: member.user?.first_name || existingMember.firstName,\n              lastName: member.user?.last_name || existingMember.lastName,\n              isActive: 1,\n              adminRights: member.status === 'administrator' ? {\n                can_change_info: member.can_change_info || false,\n                can_delete_messages: member.can_delete_messages || false,\n                can_restrict_members: member.can_restrict_members || false,\n                can_invite_users: member.can_invite_users || false,\n                can_pin_messages: member.can_pin_messages || false,\n                can_promote_members: member.can_promote_members || false,\n                can_manage_video_chats: member.can_manage_video_chats || false,\n                can_be_anonymous: member.is_anonymous || false\n              } : {},\n              customTitle: member.custom_title || existingMember.customTitle,\n              restrictions: existingMember.restrictions || {},\n              messageCount: existingMember.messageCount || 0,\n              lastSeen: new Date()\n            };\n            \n            await storage.updateGroupMember(existingMember.id, updateData);\n            console.log(`‚úÖ –£—á–∞—Å—Ç–Ω–∏–∫ ${member.user?.first_name || userId} –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö`);\n          }\n        }\n      } catch (dbError) {\n        console.error(\"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –±–∞–∑—É:\", dbError);\n        // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É\n      }\n\n      const responseData = { \n        member: {\n          ...member,\n          friendlyStatus: friendlyStatus[member.status as keyof typeof friendlyStatus] || member.status\n        }\n      };\n      \n      console.log(\"Sending response:\", responseData);\n      res.json(responseData);\n    } catch (error) {\n      console.error(\"Failed to check member status:\", error);\n      res.status(500).json({ message: \"Failed to check member status\" });\n    }\n  });\n\n  // Get saved group members from database\n  app.get(\"/api/projects/:projectId/groups/:groupId/saved-members\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId } = req.params;\n      \n      if (!groupId || groupId === \"null\") {\n        return res.status(400).json({ message: \"Group ID is required\" });\n      }\n\n      // –ù–∞—Ö–æ–¥–∏–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID –≥—Ä—É–ø–ø—ã –∏–∑ botGroups —Ç–∞–±–ª–∏—Ü—ã\n      const group = await storage.getBotGroupByProjectAndGroupId(projectId, groupId);\n      if (!group) {\n        return res.json({ members: [] }); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –µ—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n      const savedMembers = await storage.getGroupMembers(group.id);\n      \n      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º\n      const members = savedMembers.map(member => ({\n        user: {\n          id: member.userId,\n          username: member.username || undefined,\n          first_name: member.firstName || undefined,\n          last_name: member.lastName || undefined,\n          is_bot: member.isBot === 1\n        },\n        status: member.status,\n        custom_title: member.customTitle || undefined,\n        friendlyStatus: {\n          'creator': '–°–æ–∑–¥–∞—Ç–µ–ª—å',\n          'administrator': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', \n          'member': '–£—á–∞—Å—Ç–Ω–∏–∫',\n          'restricted': '–û–≥—Ä–∞–Ω–∏—á–µ–Ω',\n          'left': '–ü–æ–∫–∏–Ω—É–ª –≥—Ä—É–ø–ø—É',\n          'kicked': '–ò—Å–∫–ª—é—á–µ–Ω'\n        }[member.status as keyof typeof member.status] || member.status,\n        savedFromDatabase: true, // –§–ª–∞–≥ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞\n        lastSeen: member.lastSeen,\n        messageCount: member.messageCount,\n        ...(typeof member.adminRights === 'object' && member.adminRights ? member.adminRights : {}) // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n      }));\n\n      console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${members.length} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã ${groupId} –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö`);\n      res.json({ members });\n      \n    } catch (error) {\n      console.error(\"Failed to get saved group members:\", error);\n      res.status(500).json({ message: \"Failed to get saved group members\" });\n    }\n  });\n\n  // Ban group member\n  app.post(\"/api/projects/:projectId/bot/ban-member\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, userId, untilDate } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ message: \"Group ID and User ID are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/banChatMember`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          user_id: userId,\n          until_date: untilDate || undefined\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to ban member\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Member banned successfully\" });\n    } catch (error) {\n      console.error(\"Failed to ban member:\", error);\n      res.status(500).json({ message: \"Failed to ban member\" });\n    }\n  });\n\n  // Unban group member\n  app.post(\"/api/projects/:projectId/bot/unban-member\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, userId } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ message: \"Group ID and User ID are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/unbanChatMember`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          user_id: userId,\n          only_if_banned: true\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to unban member\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Member unbanned successfully\" });\n    } catch (error) {\n      console.error(\"Failed to unban member:\", error);\n      res.status(500).json({ message: \"Failed to unban member\" });\n    }\n  });\n\n  // Promote group member to admin\n  app.post(\"/api/projects/:projectId/bot/promote-member\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { \n        groupId, \n        userId, \n        can_manage_chat,\n        can_change_info,\n        can_delete_messages,\n        can_invite_users,\n        can_restrict_members,\n        can_pin_messages,\n        can_promote_members,\n        can_manage_video_chats\n      } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ message: \"Group ID and User ID are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –≥—Ä—É–ø–ø—ã\n      const memberCheckUrl = `https://api.telegram.org/bot${defaultToken.token}/getChatMember`;\n      const memberCheckResponse = await fetch(memberCheckUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          user_id: parseInt(userId)\n        })\n      });\n\n      const memberCheckResult = await memberCheckResponse.json();\n      \n      if (!memberCheckResponse.ok) {\n        if (memberCheckResult.error_code === 400 && memberCheckResult.description?.includes('user not found')) {\n          return res.status(400).json({\n            message: \"User is not a member of this group\",\n            error: \"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –≥—Ä—É–ø–ø—ã. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É, –∞ –∑–∞—Ç–µ–º –Ω–∞–∑–Ω–∞—á—å—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.\"\n          });\n        }\n        return res.status(400).json({\n          message: \"Failed to check user membership\",\n          error: memberCheckResult.description || \"Unknown error\"\n        });\n      }\n\n      const memberStatus = memberCheckResult.result?.status;\n      if (memberStatus === 'left' || memberStatus === 'kicked') {\n        return res.status(400).json({\n          message: \"User is not a member of this group\",\n          error: \"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∏–Ω—É–ª –≥—Ä—É–ø–ø—É –∏–ª–∏ –±—ã–ª –∏—Å–∫–ª—é—á–µ–Ω. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É.\"\n        });\n      }\n\n      console.log('User membership status:', memberStatus);\n      console.log('Promoting user with rights:', {\n        groupId,\n        userId,\n        can_manage_chat,\n        can_change_info,\n        can_delete_messages,\n        can_invite_users,\n        can_restrict_members,\n        can_pin_messages,\n        can_promote_members,\n        can_manage_video_chats\n      });\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/promoteChatMember`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          user_id: parseInt(userId),\n          can_manage_chat: can_manage_chat !== undefined ? can_manage_chat : true,\n          can_change_info: can_change_info !== undefined ? can_change_info : true,\n          can_delete_messages: can_delete_messages !== undefined ? can_delete_messages : true,\n          can_invite_users: can_invite_users !== undefined ? can_invite_users : true,\n          can_restrict_members: can_restrict_members !== undefined ? can_restrict_members : true,\n          can_pin_messages: can_pin_messages !== undefined ? can_pin_messages : true,\n          can_promote_members: can_promote_members !== undefined ? can_promote_members : true,\n          can_manage_video_chats: can_manage_video_chats !== undefined ? can_manage_video_chats : true,\n          can_post_stories: true,\n          can_edit_stories: true,\n          can_delete_stories: true,\n          is_anonymous: true\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        console.error('Telegram API error:', result);\n        return res.status(400).json({ \n          message: \"Failed to promote member\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Member promoted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to promote member:\", error);\n      res.status(500).json({ message: \"Failed to promote member\" });\n    }\n  });\n\n  // Demote admin to regular member\n  app.post(\"/api/projects/:projectId/bot/demote-member\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, userId } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ message: \"Group ID and User ID are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/promoteChatMember`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          user_id: userId,\n          can_manage_chat: false,\n          can_change_info: false,\n          can_delete_messages: false,\n          can_invite_users: false,\n          can_restrict_members: false,\n          can_pin_messages: false,\n          can_promote_members: false,\n          can_manage_video_chats: false\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to demote member\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Member demoted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to demote member:\", error);\n      res.status(500).json({ message: \"Failed to demote member\" });\n    }\n  });\n\n  // Search user by username or ID for promotion\n  app.get(\"/api/projects/:projectId/bot/search-user/:query\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const query = req.params.query;\n      \n      if (!query) {\n        return res.status(400).json({ message: \"Search query is required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n      const localUserBotData = await storage.searchUserBotData(projectId, query);\n      const localBotUsers = await storage.searchBotUsers(query);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º user_bot_data (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞)\n      if (localUserBotData && localUserBotData.length > 0) {\n        const user = localUserBotData[0];\n        return res.json({\n          success: true,\n          user: {\n            id: parseInt(user.userId),\n            first_name: user.firstName,\n            last_name: user.lastName,\n            username: user.userName,\n            type: 'private'\n          },\n          userId: user.userId,\n          source: 'local_project'\n        });\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º bot_users (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)\n      if (localBotUsers && localBotUsers.length > 0) {\n        const user = localBotUsers[0];\n        return res.json({\n          success: true,\n          user: {\n            id: user.userId,\n            first_name: user.firstName,\n            last_name: user.lastName,\n            username: user.username,\n            type: 'private'\n          },\n          userId: user.userId.toString(),\n          source: 'local_global'\n        });\n      }\n\n      // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ Telegram API\n      const isNumeric = /^\\d+$/.test(query);\n      let userId = null;\n      \n      if (isNumeric) {\n        userId = query;\n      } else {\n        // –ï—Å–ª–∏ —ç—Ç–æ username, —É–±–∏—Ä–∞–µ–º @ –µ—Å–ª–∏ –µ—Å—Ç—å\n        const username = query.startsWith('@') ? query.slice(1) : query;\n        \n        // –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ username –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å getChatMember –∏–ª–∏ getChat\n        // –ù–æ Bot API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä—è–º–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ username\n        // –ü–æ—ç—Ç–æ–º—É –ø–æ–ø—Ä–æ–±—É–µ–º —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ @username\n        try {\n          const chatResponse = await fetch(`https://api.telegram.org/bot${defaultToken.token}/getChat`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              chat_id: `@${username}`\n            })\n          });\n          \n          const chatResult = await chatResponse.json();\n          if (chatResponse.ok && chatResult.result && chatResult.result.id) {\n            userId = chatResult.result.id.toString();\n          }\n        } catch (error) {\n          console.log('Username search failed, user might not have public username');\n        }\n      }\n      \n      if (!userId) {\n        return res.status(404).json({ \n          message: \"User not found\", \n          error: \"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∏ —á–µ—Ä–µ–∑ Telegram API. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª —Å –±–æ—Ç–æ–º –∏–ª–∏ –∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π username.\" \n        });\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ\n      const userResponse = await fetch(`https://api.telegram.org/bot${defaultToken.token}/getChat`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: userId\n        })\n      });\n\n      const userResult = await userResponse.json();\n      \n      if (!userResponse.ok) {\n        return res.status(400).json({ \n          message: \"Failed to get user info\", \n          error: userResult.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ \n        success: true, \n        user: userResult.result,\n        userId: userId,\n        source: 'telegram'\n      });\n    } catch (error) {\n      console.error(\"Failed to search user:\", error);\n      res.status(500).json({ message: \"Failed to search user\" });\n    }\n  });\n\n  // Restrict group member\n  app.post(\"/api/projects/:projectId/bot/restrict-member\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, userId, permissions, untilDate } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ message: \"Group ID and User ID are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/restrictChatMember`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          user_id: userId,\n          permissions: permissions,\n          until_date: untilDate || undefined\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        console.error(\"Bot API restrict member failed:\", result);\n        return res.status(400).json({ \n          message: \"Failed to restrict member\", \n          error: result.description || \"Unknown error\",\n          details: result\n        });\n      }\n\n      res.json({ success: true, message: \"Member restricted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to restrict member:\", error);\n      res.status(500).json({ message: \"Failed to restrict member\" });\n    }\n  });\n\n  // Set group photo using Bot API\n  app.post(\"/api/projects/:projectId/bot/set-group-photo\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, photoPath } = req.body;\n      \n      if (!groupId || !photoPath) {\n        return res.status(400).json({ message: \"Group ID and photo path are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ multipart/form-data\n      const fs = await import('fs');\n      const path = await import('path');\n      \n      const photoBuffer = fs.readFileSync(photoPath);\n      const fileName = path.basename(photoPath);\n      \n      // –°–æ–∑–¥–∞–µ–º multipart form data –≤—Ä—É—á–Ω—É—é\n      const boundary = '----formdata-replit-' + Math.random().toString(36);\n      const CRLF = '\\r\\n';\n      \n      let body = '';\n      body += `--${boundary}${CRLF}`;\n      body += `Content-Disposition: form-data; name=\"chat_id\"${CRLF}${CRLF}`;\n      body += `${groupId}${CRLF}`;\n      body += `--${boundary}${CRLF}`;\n      body += `Content-Disposition: form-data; name=\"photo\"; filename=\"${fileName}\"${CRLF}`;\n      body += `Content-Type: image/png${CRLF}${CRLF}`;\n      \n      const bodyBuffer = Buffer.concat([\n        Buffer.from(body, 'utf8'),\n        photoBuffer,\n        Buffer.from(`${CRLF}--${boundary}--${CRLF}`, 'utf8')\n      ]);\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/setChatPhoto`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': `multipart/form-data; boundary=${boundary}`,\n          'Content-Length': bodyBuffer.length.toString(),\n        },\n        body: bodyBuffer,\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to set group photo\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Group photo updated successfully\" });\n    } catch (error: any) {\n      console.error(\"Failed to set group photo:\", error);\n      res.status(500).json({ \n        message: \"Failed to set group photo\", \n        error: error.message || \"Unknown error\"\n      });\n    }\n  });\n\n  // Set group title\n  app.post(\"/api/projects/:projectId/bot/set-group-title\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, title } = req.body;\n      \n      if (!groupId || !title) {\n        return res.status(400).json({ message: \"Group ID and title are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/setChatTitle`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          title: title\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to set group title\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Group title updated successfully\" });\n    } catch (error) {\n      console.error(\"Failed to set group title:\", error);\n      res.status(500).json({ message: \"Failed to set group title\" });\n    }\n  });\n\n  // Set group description\n  app.post(\"/api/projects/:projectId/bot/set-group-description\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, description } = req.body;\n      \n      if (!groupId || !description) {\n        return res.status(400).json({ message: \"Group ID and description are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/setChatDescription`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          description: description\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to set group description\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Group description updated successfully\" });\n    } catch (error) {\n      console.error(\"Failed to set group description:\", error);\n      res.status(500).json({ message: \"Failed to set group description\" });\n    }\n  });\n\n  // Set group username (make public/private)\n  app.post(\"/api/projects/:projectId/bot/set-group-username\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, username } = req.body;\n      \n      if (!groupId) {\n        return res.status(400).json({ message: \"Group ID is required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      // –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ username –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—è –∏–ª–∏ –∞–¥–º–∏–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º Client API –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω\n      try {\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ Telegram Client API –¥–æ—Å—Ç—É–ø\n        const clientManager = telegramClientManager;\n        if (clientManager) {\n          // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Client API –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ username\n          const result = await clientManager.setChatUsername('default', groupId, username);\n          \n          res.json({ \n            success: true, \n            message: username ? \"Group username set successfully\" : \"Group made private successfully\",\n            result \n          });\n          return;\n        }\n      } catch (clientError) {\n        console.log(\"Client API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º Bot API:\", clientError);\n      }\n\n      // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º Bot API (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)\n      // Bot API –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å username, —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å —á–µ—Ä–µ–∑ Client API\n      return res.status(400).json({ \n        message: \"Setting group username requires creator/admin privileges. Please use Telegram Client API authorization.\",\n        requiresClientApi: true\n      });\n\n    } catch (error) {\n      console.error(\"Failed to set group username:\", error);\n      res.status(500).json({ message: \"Failed to set group username\" });\n    }\n  });\n\n  // Pin message in group\n  app.post(\"/api/projects/:projectId/bot/pin-message\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, messageId, disableNotification } = req.body;\n      \n      if (!groupId || !messageId) {\n        return res.status(400).json({ message: \"Group ID and message ID are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/pinChatMessage`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          message_id: messageId,\n          disable_notification: disableNotification || false\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to pin message\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Message pinned successfully\" });\n    } catch (error) {\n      console.error(\"Failed to pin message:\", error);\n      res.status(500).json({ message: \"Failed to pin message\" });\n    }\n  });\n\n  // Unpin message in group\n  app.post(\"/api/projects/:projectId/bot/unpin-message\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, messageId } = req.body;\n      \n      if (!groupId) {\n        return res.status(400).json({ message: \"Group ID is required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = messageId \n        ? `https://api.telegram.org/bot${defaultToken.token}/unpinChatMessage`\n        : `https://api.telegram.org/bot${defaultToken.token}/unpinAllChatMessages`;\n        \n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          ...(messageId && { message_id: messageId })\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to unpin message\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: messageId ? \"Message unpinned successfully\" : \"All messages unpinned successfully\" });\n    } catch (error) {\n      console.error(\"Failed to unpin message:\", error);\n      res.status(500).json({ message: \"Failed to unpin message\" });\n    }\n  });\n\n  // Create new invite link for group\n  app.post(\"/api/projects/:projectId/bot/create-invite-link\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, name, expireDate, memberLimit, createsJoinRequest } = req.body;\n      \n      if (!groupId) {\n        return res.status(400).json({ message: \"Group ID is required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/createChatInviteLink`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          name: name || undefined,\n          expire_date: expireDate || undefined,\n          member_limit: memberLimit || undefined,\n          creates_join_request: createsJoinRequest || false\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to create invite link\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ \n        success: true, \n        inviteLink: result.result,\n        message: \"Invite link created successfully\" \n      });\n    } catch (error) {\n      console.error(\"Failed to create invite link:\", error);\n      res.status(500).json({ message: \"Failed to create invite link\" });\n    }\n  });\n\n  // Delete message in group\n  app.post(\"/api/projects/:projectId/bot/delete-message\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { groupId, messageId } = req.body;\n      \n      if (!groupId || !messageId) {\n        return res.status(400).json({ message: \"Group ID and message ID are required\" });\n      }\n\n      const defaultToken = await storage.getDefaultBotToken(projectId);\n      if (!defaultToken) {\n        return res.status(400).json({ message: \"Bot token not found for this project\" });\n      }\n\n      const telegramApiUrl = `https://api.telegram.org/bot${defaultToken.token}/deleteMessage`;\n      const response = await fetch(telegramApiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: groupId,\n          message_id: messageId\n        })\n      });\n\n      const result = await response.json();\n      \n      if (!response.ok) {\n        return res.status(400).json({ \n          message: \"Failed to delete message\", \n          error: result.description || \"Unknown error\"\n        });\n      }\n\n      res.json({ success: true, message: \"Message deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete message:\", error);\n      res.status(500).json({ message: \"Failed to delete message\" });\n    }\n  });\n\n  // Telegram Client API endpoints\n  \n  // Save user Telegram API credentials\n  app.post(\"/api/telegram-settings\", async (req, res) => {\n    try {\n      const { userId, apiId, apiHash, phoneNumber } = req.body;\n      \n      if (!userId || !apiId || !apiHash) {\n        return res.status(400).json({ \n          message: \"userId, apiId, and apiHash are required\" \n        });\n      }\n\n      // Here we would save to database - for now, return success\n      // TODO: Implement storage.createUserTelegramSettings()\n      \n      res.json({ \n        message: \"Telegram API credentials saved successfully\",\n        success: true \n      });\n    } catch (error) {\n      console.error(\"Failed to save Telegram API credentials:\", error);\n      res.status(500).json({ message: \"Failed to save credentials\" });\n    }\n  });\n\n  // Get group members using Telegram Client API\n  app.get(\"/api/projects/:projectId/telegram-client/group-members/:groupId\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      \n      // Check if API credentials are available\n      const apiId = process.env.TELEGRAM_API_ID;\n      const apiHash = process.env.TELEGRAM_API_HASH;\n      \n      if (!apiId || !apiHash) {\n        console.log('‚ö†Ô∏è CLIENT API: Telegram API credentials not configured, returning demo data');\n        \n        // Return demo data when credentials are not configured\n        return res.json({\n          success: true,\n          message: \"üé≠ –î–µ–º–æ-—Ä–µ–∂–∏–º: –ø–æ–∫–∞–∑–∞–Ω—ã –ø—Ä–∏–º–µ—Ä–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏\",\n          explanation: \"–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ TELEGRAM_API_ID –∏ TELEGRAM_API_HASH\",\n          groupId,\n          memberCount: 3,\n          members: [\n            {\n              id: 123456789,\n              username: \"demo_user1\",\n              firstName: \"–î–µ–º–æ\",\n              lastName: \"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1\",\n              isBot: false,\n              status: \"active\",\n              joinedAt: new Date().toISOString(),\n              source: \"demo_data\"\n            },\n            {\n              id: 987654321,\n              username: \"demo_user2\", \n              firstName: \"–î–µ–º–æ\",\n              lastName: \"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2\",\n              isBot: false,\n              status: \"active\",\n              joinedAt: new Date().toISOString(),\n              source: \"demo_data\"\n            },\n            {\n              id: 555666777,\n              username: \"demo_bot\",\n              firstName: \"–î–µ–º–æ\",\n              lastName: \"–ë–æ—Ç\",\n              isBot: true,\n              status: \"active\",\n              joinedAt: new Date().toISOString(),\n              source: \"demo_data\"\n            }\n          ],\n          isDemoMode: true,\n          note: \"–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ API credentials.\"\n        });\n      }\n\n      console.log(`üîç CLIENT API: –ü–æ–ª—É—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã ${groupId} —á–µ—Ä–µ–∑ Client API`);\n\n      try {\n        // Try to use real Telegram Client API to get group members\n        const members = await telegramClientManager.getGroupMembers('default', groupId);\n        \n        if (members && members.length > 0) {\n          console.log(`‚úÖ CLIENT API: –ù–∞–π–¥–µ–Ω–æ ${members.length} —Ä–µ–∞–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã`);\n          \n          res.json({\n            success: true,\n            message: `‚úÖ –ü–æ–ª—É—á–µ–Ω –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ Client API`,\n            explanation: \"Client API –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤\",\n            groupId,\n            memberCount: members.length,\n            members: members.map((member: any) => ({\n              id: member.id,\n              username: member.username,\n              firstName: member.firstName,\n              lastName: member.lastName,\n              isBot: member.isBot,\n              status: member.status,\n              joinedAt: member.joinedAt,\n              source: \"client_api\"\n            })),\n            advantages: [\n              `–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã (${members.length} —Ä–µ–∞–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)`,\n              \"–í–∫–ª—é—á–∞–µ—Ç –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–æ–≤\", \n              \"–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö\",\n              \"–û–±—Ö–æ–¥–∏—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Bot API\"\n            ]\n          });\n        } else {\n          throw new Error('No members found or Client API not connected');\n        }\n      } catch (error: any) {\n        console.log(`‚ö†Ô∏è CLIENT API: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: ${error?.message || 'Unknown error'}`);\n        console.log('üìù CLIENT API: –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –∫–ª–∏–µ–Ω—Ç–∞');\n        \n        res.status(400).json({\n          success: false,\n          message: \"‚ùå Client API —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\",\n          explanation: \"–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram Client API —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞\",\n          groupId,\n          error: error?.message || 'Unknown error',\n          requirements: [\n            \"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram Client API —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞\",\n            \"–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\",\n            \"–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –≥—Ä—É–ø–ø—ã\"\n          ],\n          note: \"Bot API –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤, Client API –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\"\n        });\n      }\n    } catch (error) {\n      console.error(\"Failed to get group members via Client API:\", error);\n      res.status(500).json({ message: \"Failed to get group members via Client API\" });\n    }\n  });\n\n  // Send verification code to phone number\n  app.post(\"/api/telegram-auth/send-code\", async (req, res) => {\n    try {\n      const { phoneNumber } = req.body;\n      \n      if (!phoneNumber) {\n        return res.status(400).json({\n          success: false,\n          error: \"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"\n        });\n      }\n\n      const result = await telegramClientManager.sendCode('default', phoneNumber);\n      \n      if (result.success) {\n        res.json({\n          success: true,\n          message: \"–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à –Ω–æ–º–µ—Ä\",\n          phoneCodeHash: result.phoneCodeHash\n        });\n      } else {\n        res.status(400).json({\n          success: false,\n          error: result.error\n        });\n      }\n    } catch (error: any) {\n      console.error(\"Failed to send verification code:\", error);\n      res.status(500).json({ \n        success: false,\n        error: \"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞\" \n      });\n    }\n  });\n\n  // Verify phone code\n  app.post(\"/api/telegram-auth/verify-code\", async (req, res) => {\n    try {\n      const { phoneNumber, phoneCode, phoneCodeHash } = req.body;\n      \n      if (!phoneNumber || !phoneCode || !phoneCodeHash) {\n        return res.status(400).json({\n          success: false,\n          error: \"–í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\"\n        });\n      }\n\n      const result = await telegramClientManager.verifyCode('default', phoneNumber, phoneCode, phoneCodeHash);\n      \n      if (result.success) {\n        res.json({\n          success: true,\n          message: \"–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞\"\n        });\n      } else if (result.needsPassword) {\n        // –ö–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å 2FA - —ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, –∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞\n        res.json({\n          success: false,\n          error: result.error,\n          needsPassword: true\n        });\n      } else {\n        res.status(400).json({\n          success: false,\n          error: result.error\n        });\n      }\n    } catch (error: any) {\n      console.error(\"Failed to verify code:\", error);\n      res.status(500).json({ \n        success: false,\n        error: \"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞\" \n      });\n    }\n  });\n\n  // Verify 2FA password\n  app.post(\"/api/telegram-auth/verify-password\", async (req, res) => {\n    try {\n      const { password } = req.body;\n      \n      if (!password) {\n        return res.status(400).json({\n          success: false,\n          error: \"–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"\n        });\n      }\n\n      const result = await telegramClientManager.verifyPassword('default', password);\n      \n      if (result.success) {\n        res.json({\n          success: true,\n          message: \"–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å 2FA —É—Å–ø–µ—à–Ω–∞\"\n        });\n      } else {\n        res.status(400).json({\n          success: false,\n          error: result.error\n        });\n      }\n    } catch (error: any) {\n      console.error(\"Failed to verify password:\", error);\n      res.status(500).json({ \n        success: false,\n        error: \"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è\" \n      });\n    }\n  });\n\n  // Save API credentials\n  app.post(\"/api/telegram-auth/save-credentials\", async (req, res) => {\n    try {\n      const { apiId, apiHash } = req.body;\n      \n      if (!apiId || !apiHash) {\n        return res.status(400).json({\n          success: false,\n          error: \"API ID –∏ API Hash –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\"\n        });\n      }\n\n      const result = await telegramClientManager.setCredentials('default', apiId, apiHash);\n      \n      if (result.success) {\n        res.json({\n          success: true,\n          message: \"API credentials —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã\"\n        });\n      } else {\n        res.status(400).json({\n          success: false,\n          error: result.error\n        });\n      }\n    } catch (error: any) {\n      console.error(\"Failed to save credentials:\", error);\n      res.status(500).json({ \n        success: false,\n        error: \"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è credentials\" \n      });\n    }\n  });\n\n  // Get authentication status\n  app.get(\"/api/telegram-auth/status\", async (req, res) => {\n    try {\n      const status = await telegramClientManager.getAuthStatus('default');\n      res.json(status);\n    } catch (error: any) {\n      console.error(\"Failed to get auth status:\", error);\n      res.status(500).json({ \n        isAuthenticated: false,\n        error: \"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\" \n      });\n    }\n  });\n\n  // Client API —Ä–æ—É—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏\n  \n  // –ò—Å–∫–ª—é—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–µ—Ä–µ–∑ Client API\n  app.post(\"/api/projects/:projectId/telegram-client/kick-member\", async (req, res) => {\n    try {\n      const { groupId, userId } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ \n          success: false, \n          message: \"Group ID –∏ User ID –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\" \n        });\n      }\n\n      const result = await telegramClientManager.kickMember('default', groupId, userId);\n      \n      res.json({\n        success: true,\n        message: \"–£—á–∞—Å—Ç–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω —á–µ—Ä–µ–∑ Client API\"\n      });\n    } catch (error: any) {\n      console.error(\"Failed to kick member via Client API:\", error);\n      res.status(500).json({ \n        success: false,\n        message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞\",\n        error: error.message || \"Unknown error\"\n      });\n    }\n  });\n\n  // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–µ—Ä–µ–∑ Client API\n  app.post(\"/api/projects/:projectId/telegram-client/ban-member\", async (req, res) => {\n    try {\n      const { groupId, userId, untilDate } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ \n          success: false, \n          message: \"Group ID –∏ User ID –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\" \n        });\n      }\n\n      const result = await telegramClientManager.banMember('default', groupId, userId, untilDate);\n      \n      res.json({\n        success: true,\n        message: \"–£—á–∞—Å—Ç–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Client API\"\n      });\n    } catch (error: any) {\n      console.error(\"Failed to ban member via Client API:\", error);\n      res.status(500).json({ \n        success: false,\n        message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞\",\n        error: error.message || \"Unknown error\"\n      });\n    }\n  });\n\n  // –ó–∞–º—É—Ç–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–µ—Ä–µ–∑ Client API\n  app.post(\"/api/projects/:projectId/telegram-client/restrict-member\", async (req, res) => {\n    try {\n      const { groupId, userId, untilDate } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ \n          success: false, \n          message: \"Group ID –∏ User ID –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\" \n        });\n      }\n\n      const result = await telegramClientManager.restrictMember('default', groupId, userId, untilDate);\n      \n      res.json({\n        success: true,\n        message: \"–£—á–∞—Å—Ç–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–º—É—á–µ–Ω —á–µ—Ä–µ–∑ Client API\"\n      });\n    } catch (error: any) {\n      console.error(\"Failed to restrict member via Client API:\", error);\n      res.status(500).json({ \n        success: false,\n        message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥–ª—É—à–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞\",\n        error: error.message || \"Unknown error\"\n      });\n    }\n  });\n\n  // –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ Client API\n  app.post(\"/api/projects/:projectId/telegram-client/promote-member\", async (req, res) => {\n    try {\n      const { groupId, userId, adminRights } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ \n          success: false, \n          message: \"Group ID –∏ User ID –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\" \n        });\n      }\n\n      const result = await telegramClientManager.promoteMember('default', groupId, userId, adminRights);\n      \n      res.json({\n        success: true,\n        message: \"–£—á–∞—Å—Ç–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ Client API\"\n      });\n    } catch (error: any) {\n      console.error(\"Failed to promote member via Client API:\", error);\n      res.status(500).json({ \n        success: false,\n        message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\",\n        error: error.message || \"Unknown error\"\n      });\n    }\n  });\n\n  // –°–Ω—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ Client API\n  app.post(\"/api/projects/:projectId/telegram-client/demote-member\", async (req, res) => {\n    try {\n      const { groupId, userId } = req.body;\n      \n      if (!groupId || !userId) {\n        return res.status(400).json({ \n          success: false, \n          message: \"Group ID –∏ User ID –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\" \n        });\n      }\n\n      const result = await telegramClientManager.demoteMember('default', groupId, userId);\n      \n      res.json({\n        success: true,\n        message: \"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ —É—Å–ø–µ—à–Ω–æ —Å–Ω—è—Ç—ã —á–µ—Ä–µ–∑ Client API\"\n      });\n    } catch (error: any) {\n      console.error(\"Failed to demote member via Client API:\", error);\n      res.status(500).json({ \n        success: false,\n        message: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤\",\n        error: error.message || \"Unknown error\"\n      });\n    }\n  });\n\n  // Force update templates - Admin endpoint to refresh all system templates\n  app.post(\"/api/templates/refresh\", async (req, res) => {\n    try {\n      console.log(\"üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤...\");\n      await seedDefaultTemplates(true); // force = true\n      console.log(\"‚úÖ –®–∞–±–ª–æ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ\");\n      res.json({ \n        message: \"Templates updated successfully\",\n        timestamp: new Date().toISOString()\n      });\n    } catch (error) {\n      console.error(\"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤:\", error);\n      res.status(500).json({ \n        message: \"Failed to update templates\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n\n","size_bytes":215191},"server/seed-templates-backup.ts":{"content":"import { storage } from \"./storage\";\n\n// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏\nexport async function seedDefaultTemplates() {\n  try {\n    const existingTemplates = await storage.getAllBotTemplates();\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã\n    const systemTemplates = existingTemplates.filter(t => t.authorName === '–°–∏—Å—Ç–µ–º–∞');\n    if (systemTemplates.length >= 6) {\n      console.log('–°–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');\n      return;\n    }\n\n    // –ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–æ—Ç\n    await storage.createBotTemplate({\n      name: \"–ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–æ—Ç\",\n      description: \"–ë–∞–∑–æ–≤—ã–π –±–æ—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –≥–ª–∞–≤–Ω—ã–º –º–µ–Ω—é –∏ –∫–æ–º–∞–Ω–¥–∞–º–∏\",\n      category: \"business\",\n      tags: [\"–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\", \"–º–µ–Ω—é\", \"–±–∞–∑–æ–≤—ã–π\"],\n      isPublic: 1,\n      difficulty: \"easy\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 3,\n      estimatedTime: 10,\n      data: {\n        nodes: [\n          {\n            id: \"start-1\",\n            type: \"start\",\n            position: { x: 100, y: 100 },\n            data: {\n              command: \"/start\",\n              description: \"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\",\n              messageText: \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! üëã\\n\\n–Ø –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–æ—Ç. –í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç:\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-1\",\n                  text: \"üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\",\n                  action: \"goto\",\n                  target: \"info-1\"\n                },\n                {\n                  id: \"btn-2\",\n                  text: \"üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã\",\n                  action: \"goto\",\n                  target: \"contacts-1\"\n                },\n                {\n                  id: \"btn-3\",\n                  text: \"‚ùì –ü–æ–º–æ—â—å\",\n                  action: \"command\",\n                  target: \"/help\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"info-1\",\n            type: \"message\",\n            position: { x: 350, y: 100 },\n            data: {\n              messageText: \"‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å\\n\\n–ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –∏ –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –Ω–∞—à–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º.\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-back-1\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"contacts-1\",\n            type: \"message\",\n            position: { x: 350, y: 250 },\n            data: {\n              messageText: \"üìû –ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã:\\n\\nüìß Email: info@example.com\\nüì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67\\nüåê –°–∞–π—Ç: example.com\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-back-2\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"help-1\",\n            type: \"command\",\n            position: { x: 100, y: 250 },\n            data: {\n              command: \"/help\",\n              description: \"–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É\",\n              messageText: \"‚ùì –°–ø—Ä–∞–≤–∫–∞\\n\\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –±–æ—Ç—É.\\n\\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\\n/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\\n/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-menu\",\n                  text: \"üìã –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          }\n        ],\n        connections: [\n          {\n            id: \"conn-1\",\n            source: \"start-1\",\n            target: \"info-1\"\n          },\n          {\n            id: \"conn-2\",\n            source: \"start-1\",\n            target: \"contacts-1\"\n          },\n          {\n            id: \"conn-3\",\n            source: \"start-1\",\n            target: \"help-1\"\n          }\n        ]\n      }\n    });\n\n    // –ü—Ä–æ—Å—Ç–æ–π FAQ –±–æ—Ç\n    await storage.createBotTemplate({\n      name: \"FAQ –±–æ—Ç\",\n      description: \"–ë–æ—Ç –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å –ø–æ–∏—Å–∫–æ–º –ø–æ —Ç–µ–º–∞–º\",\n      category: \"utility\",\n      tags: [\"faq\", \"–≤–æ–ø—Ä–æ—Å—ã\", \"–ø–æ–¥–¥–µ—Ä–∂–∫–∞\"],\n      isPublic: 1,\n      difficulty: \"medium\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 5,\n      estimatedTime: 15,\n      data: {\n        nodes: [\n          {\n            id: \"start-1\",\n            type: \"start\",\n            position: { x: 100, y: 100 },\n            data: {\n              command: \"/start\",\n              description: \"–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é FAQ\",\n              messageText: \"ü§ñ –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤–æ–ø—Ä–æ—Å–∞:\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-tech\",\n                  text: \"üíª –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã\",\n                  action: \"goto\",\n                  target: \"tech-1\"\n                },\n                {\n                  id: \"btn-billing\",\n                  text: \"üí≥ –í–æ–ø—Ä–æ—Å—ã –æ–ø–ª–∞—Ç—ã\",\n                  action: \"goto\",\n                  target: \"billing-1\"\n                },\n                {\n                  id: \"btn-general\",\n                  text: \"‚ùì –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã\",\n                  action: \"goto\",\n                  target: \"general-1\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"tech-1\",\n            type: \"message\",\n            position: { x: 400, y: 50 },\n            data: {\n              messageText: \"üíª –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã:\\n\\n‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –≤—Ö–æ–¥–æ–º\\n‚Ä¢ –û—à–∏–±–∫–∏ –≤ —Ä–∞–±–æ—Ç–µ\\n‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å:\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-login\",\n                  text: \"üîê –ü—Ä–æ–±–ª–µ–º—ã —Å –≤—Ö–æ–¥–æ–º\",\n                  action: \"goto\",\n                  target: \"login-help\"\n                },\n                {\n                  id: \"btn-back-tech\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"billing-1\",\n            type: \"message\",\n            position: { x: 400, y: 150 },\n            data: {\n              messageText: \"üí≥ –í–æ–ø—Ä–æ—Å—ã –æ–ø–ª–∞—Ç—ã:\\n\\n‚Ä¢ –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã\\n‚Ä¢ –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤\\n‚Ä¢ –¢–∞—Ä–∏—Ñ—ã\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å:\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-payment\",\n                  text: \"üí∞ –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã\",\n                  action: \"goto\",\n                  target: \"payment-help\"\n                },\n                {\n                  id: \"btn-back-billing\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"general-1\",\n            type: \"message\",\n            position: { x: 400, y: 250 },\n            data: {\n              messageText: \"‚ùì –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã:\\n\\n‚Ä¢ –û –∫–æ–º–ø–∞–Ω–∏–∏\\n‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç—ã\\n‚Ä¢ –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-contact\",\n                  text: \"üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏\",\n                  action: \"url\",\n                  url: \"https://t.me/support\"\n                },\n                {\n                  id: \"btn-back-general\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          }\n        ],\n        connections: [\n          {\n            id: \"conn-1\",\n            source: \"start-1\",\n            target: \"tech-1\"\n          },\n          {\n            id: \"conn-2\",\n            source: \"start-1\",\n            target: \"billing-1\"\n          },\n          {\n            id: \"conn-3\",\n            source: \"start-1\",\n            target: \"general-1\"\n          }\n        ]\n      }\n    });\n\n    // –ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω\n    await storage.createBotTemplate({\n      name: \"–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω\",\n      description: \"–ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω –±–æ—Ç–∞ –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤\",\n      category: \"business\",\n      tags: [\"–º–∞–≥–∞–∑–∏–Ω\", \"—Ç–æ–≤–∞—Ä—ã\", \"–ø—Ä–æ–¥–∞–∂–∏\"],\n      isPublic: 1,\n      difficulty: \"medium\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\", \n      version: \"1.0.0\",\n      language: \"ru\",\n      complexity: 6,\n      estimatedTime: 20,\n      data: {\n        nodes: [\n          {\n            id: \"start-1\",\n            type: \"start\",\n            position: { x: 100, y: 100 },\n            data: {\n              command: \"/start\",\n              description: \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω\",\n              messageText: \"üõçÔ∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω!\\n\\n–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-catalog\",\n                  text: \"üì¶ –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤\",\n                  action: \"goto\",\n                  target: \"catalog-1\"\n                },\n                {\n                  id: \"btn-cart\",\n                  text: \"üõí –ö–æ—Ä–∑–∏–Ω–∞\",\n                  action: \"goto\",\n                  target: \"cart-1\"\n                },\n                {\n                  id: \"btn-info\",\n                  text: \"‚ÑπÔ∏è –û –¥–æ—Å—Ç–∞–≤–∫–µ\",\n                  action: \"goto\",\n                  target: \"delivery-1\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"catalog-1\",\n            type: \"message\",\n            position: { x: 400, y: 100 },\n            data: {\n              messageText: \"üì¶ –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤:\\n\\nüè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏:\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-electronics\",\n                  text: \"üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞\",\n                  action: \"goto\",\n                  target: \"electronics-1\"\n                },\n                {\n                  id: \"btn-clothes\",\n                  text: \"üëï –û–¥–µ–∂–¥–∞\",\n                  action: \"goto\",\n                  target: \"clothes-1\"\n                },\n                {\n                  id: \"btn-home\",\n                  text: \"üè† –î–ª—è –¥–æ–º–∞\",\n                  action: \"goto\",\n                  target: \"home-1\"\n                },\n                {\n                  id: \"btn-back-catalog\",\n                  text: \"‚óÄÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"cart-1\",\n            type: \"message\",\n            position: { x: 400, y: 200 },\n            data: {\n              messageText: \"üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞\\n\\n–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞!\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-to-catalog\",\n                  text: \"üì¶ –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ç–∞–ª–æ–≥—É\",\n                  action: \"goto\",\n                  target: \"catalog-1\"\n                },\n                {\n                  id: \"btn-back-cart\",\n                  text: \"‚óÄÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"delivery-1\",\n            type: \"message\",\n            position: { x: 400, y: 300 },\n            data: {\n              messageText: \"üöö –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ:\\n\\nüì¶ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –æ—Ç 2000‚ÇΩ\\n‚è±Ô∏è –î–æ—Å—Ç–∞–≤–∫–∞ 1-3 –¥–Ω—è\\nüìç –î–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏\\n\\nüí≥ –û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–ª–∏ –∫–∞—Ä—Ç–æ–π\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-back-delivery\",\n                  text: \"‚óÄÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          }\n        ],\n        connections: [\n          {\n            id: \"conn-1\",\n            source: \"start-1\",\n            target: \"catalog-1\"\n          },\n          {\n            id: \"conn-2\",\n            source: \"start-1\",\n            target: \"cart-1\"\n          },\n          {\n            id: \"conn-3\",\n            source: \"start-1\",\n            target: \"delivery-1\"\n          }\n        ]\n      }\n    });\n\n    // –ü—Ä–æ—Å—Ç–æ–π –±–æ—Ç —Å –∫–æ–º–∞–Ω–¥–æ–π —Å—Ç–∞—Ä—Ç –∏ —Å–∏–Ω–æ–Ω–∏–º–æ–º\n    await storage.createBotTemplate({\n      name: \"–ë–∞–∑–æ–≤—ã–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–æ—Ç\",\n      description: \"–ü—Ä–æ—Å—Ç–æ–π –±–æ—Ç —Å –∫–æ–º–∞–Ω–¥–æ–π /start –∏ —Å–∏–Ω–æ–Ω–∏–º–æ–º '—Å—Ç–∞—Ä—Ç' –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö\",\n      category: \"education\",\n      tags: [\"—Å—Ç–∞—Ä—Ç\", \"–±–∞–∑–æ–≤—ã–π\", \"–æ–±—É—á–µ–Ω–∏–µ\"],\n      isPublic: 1,\n      difficulty: \"easy\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 2,\n      estimatedTime: 5,\n      data: {\n        nodes: [\n          {\n            id: \"start-1\",\n            type: \"start\",\n            position: { x: 100, y: 100 },\n            data: {\n              command: \"/start\",\n              synonyms: [\"—Å—Ç–∞—Ä—Ç\"],\n              description: \"–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞\",\n              messageText: \"üöÄ –ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ø–µ—Ä–≤—ã–π –±–æ—Ç!\\n\\n–¢—ã –º–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å:\\n‚Ä¢ /start - —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–µ–Ω—è\\n‚Ä¢ —Å—Ç–∞—Ä—Ç - —ç—Ç–æ —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!\\n\\n–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-info\",\n                  text: \"‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\",\n                  action: \"goto\",\n                  target: \"info-1\"\n                },\n                {\n                  id: \"btn-help\",\n                  text: \"‚ùì –ü–æ–º–æ—â—å\",\n                  action: \"goto\",\n                  target: \"help-1\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"info-1\",\n            type: \"message\",\n            position: { x: 350, y: 100 },\n            data: {\n              messageText: \"üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ:\\n\\n–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–π –±–æ—Ç-–ø—Ä–∏–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:\\n‚Ä¢ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–º–∞–Ω–¥—ã\\n‚Ä¢ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω–æ–Ω–∏–º—ã\\n‚Ä¢ –ë–∞–∑–æ–≤—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é\\n\\n–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ!\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-back-info\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"help-1\",\n            type: \"message\",\n            position: { x: 350, y: 250 },\n            data: {\n              messageText: \"‚ùì –°–ø—Ä–∞–≤–∫–∞:\\n\\nüî§ –ö–æ–º–∞–Ω–¥—ã:\\n‚Ä¢ /start –∏–ª–∏ —Å—Ç–∞—Ä—Ç - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞\\n\\nüéØ –°–æ–≤–µ—Ç—ã:\\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\\n‚Ä¢ –°–∏–Ω–æ–Ω–∏–º—ã –¥–µ–ª–∞—é—Ç –±–æ—Ç–∞ —É–¥–æ–±–Ω–µ–µ\\n‚Ä¢ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏!\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-back-help\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          }\n        ],\n        connections: [\n          {\n            id: \"conn-1\",\n            source: \"start-1\",\n            target: \"info-1\"\n          },\n          {\n            id: \"conn-2\",\n            source: \"start-1\",\n            target: \"help-1\"\n          }\n        ]\n      }\n    });\n\n    // –£–ª—å—Ç—Ä–∞-–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–ª–∏—Ç–∏–∫–æ-–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –æ–ø—Ä–æ—Å\n    await storage.createBotTemplate({\n      name: \"üèõÔ∏è –£–ª—å—Ç—Ä–∞-–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ü–æ–ª–∏—Ç–∏–∫–æ-–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –û–ø—Ä–æ—Å\",\n      description: \"–ú–∞—Å—à—Ç–∞–±–Ω—ã–π –æ–ø—Ä–æ—Å –ø–æ –ø–æ–ª–∏—Ç–æ–ª–æ–≥–∏–∏, –∏—Å—Ç–æ—Ä–∏–∏, —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –∏ —Å–æ—Ü–∏–æ–ª–æ–≥–∏–∏ —Å –≥–ª—É–±–æ–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º –≤–∑–≥–ª—è–¥–æ–≤ –∏ –∑–Ω–∞–Ω–∏–π\",\n      category: \"education\",\n      tags: [\"–ø–æ–ª–∏—Ç–∏–∫–∞\", \"–∏—Å—Ç–æ—Ä–∏—è\", \"—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è\", \"—Å–æ—Ü–∏–æ–ª–æ–≥–∏—è\", \"–æ–ø—Ä–æ—Å\", \"–∞–Ω–∞–ª–∏–∑\", \"–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ\", \"–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π\"],\n      isPublic: 1,\n      difficulty: \"hard\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 10,\n      estimatedTime: 60,\n      data: {\n        \"nodes\": [\n          {\n            \"id\": \"start-poll\",\n            \"type\": \"start\",\n            \"position\": {\"x\": 100, \"y\": 100},\n            \"data\": {\n              \"command\": \"/start\",\n              \"description\": \"–ó–∞–ø—É—Å–∫ —É–ª—å—Ç—Ä–∞-–∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –ø–æ–ª–∏—Ç–∏–∫–æ-–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–æ—Å–∞\",\n              \"messageText\": \"üèõÔ∏è **–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í –£–õ–¨–¢–†–ê-–ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ü–û–õ–ò–¢–ò–ö–û-–ò–°–¢–û–†–ò–ß–ï–°–ö–ò–ô –û–ü–†–û–°!**\\n\\nüìö –≠—Ç–æ—Ç –æ–ø—Ä–æ—Å –≤–∫–ª—é—á–∞–µ—Ç:\\n‚Ä¢ üó≥Ô∏è **–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–∑–≥–ª—è–¥—ã** (20+ –≤–æ–ø—Ä–æ—Å–æ–≤)\\n‚Ä¢ üìú **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞–Ω–∏–µ** (25+ –≤–æ–ø—Ä–æ—Å–æ–≤)\\n‚Ä¢ ü§î **–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –≤–æ–∑–∑—Ä–µ–Ω–∏—è** (15+ –≤–æ–ø—Ä–æ—Å–æ–≤)\\n‚Ä¢ üåç **–°–æ—Ü–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** (20+ –≤–æ–ø—Ä–æ—Å–æ–≤)\\n\\n‚è±Ô∏è **–í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è:** 45-60 –º–∏–Ω—É—Ç\\nüéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö –≤–∑–≥–ª—è–¥–æ–≤\\n\\n**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –≥–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ?**\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"start-survey\",\n                  \"text\": \"üöÄ –ù–∞—á–∞—Ç—å –æ–ø—Ä–æ—Å\",\n                  \"action\": \"goto\",\n                  \"target\": \"political-intro\"\n                },\n                {\n                  \"id\": \"view-sections\",\n                  \"text\": \"üìã –û–±–∑–æ—Ä —Ä–∞–∑–¥–µ–ª–æ–≤\",\n                  \"action\": \"goto\",\n                  \"target\": \"sections-overview\"\n                },\n                {\n                  \"id\": \"instructions\",\n                  \"text\": \"üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"survey-instructions\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"sections-overview\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 400, \"y\": 50},\n            \"data\": {\n              \"messageText\": \"üìã **–†–ê–ó–î–ï–õ–´ –û–ü–†–û–°–ê:**\\n\\nüó≥Ô∏è **–ë–õ–û–ö –ê: –ü–û–õ–ò–¢–û–õ–û–ì–ò–Ø** (20 –≤–æ–ø—Ä–æ—Å–æ–≤)\\n‚Ä¢ –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è\\n‚Ä¢ –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –≤–ª–∞—Å—Ç–∏ –∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤—É\\n‚Ä¢ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –≤–∑–≥–ª—è–¥—ã\\n‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞\\n\\nüìú **–ë–õ–û–ö –ë: –ò–°–¢–û–†–ò–Ø** (25 –≤–æ–ø—Ä–æ—Å–æ–≤)\\n‚Ä¢ –ó–Ω–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π\\n‚Ä¢ –û—Ü–µ–Ω–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ª–∏—á–Ω–æ—Å—Ç–µ–π\\n‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤\\n‚Ä¢ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è\\n\\nü§î **–ë–õ–û–ö –í: –§–ò–õ–û–°–û–§–ò–Ø** (15 –≤–æ–ø—Ä–æ—Å–æ–≤)\\n‚Ä¢ –≠—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–∑—Ä–µ–Ω–∏—è\\n‚Ä¢ –ú–µ—Ç–∞—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –≤–∑–≥–ª—è–¥—ã\\n‚Ä¢ –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è\\n‚Ä¢ –°–º—ã—Å–ª –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏\\n\\nüåç **–ë–õ–û–ö –ì: –°–û–¶–ò–û–õ–û–ì–ò–Ø** (20 –≤–æ–ø—Ä–æ—Å–æ–≤)\\n‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã\\n‚Ä¢ –ú–µ–∂–≥—Ä—É–ø–ø–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è\\n‚Ä¢ –ì–ª–æ–±–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫—É–ª—å—Ç—É—Ä–∞\\n‚Ä¢ –ë—É–¥—É—â–µ–µ –æ–±—â–µ—Å—Ç–≤–∞\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"back-to-start\",\n                  \"text\": \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –Ω–∞—á–∞–ª—É\",\n                  \"action\": \"goto\",\n                  \"target\": \"start-poll\"\n                },\n                {\n                  \"id\": \"start-from-overview\",\n                  \"text\": \"üöÄ –ù–∞—á–∞—Ç—å –æ–ø—Ä–æ—Å\",\n                  \"action\": \"goto\",\n                  \"target\": \"political-intro\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"political-intro\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 700, \"y\": 100},\n            \"data\": {\n              \"messageText\": \"üó≥Ô∏è **–ë–õ–û–ö –ê: –ü–û–õ–ò–¢–û–õ–û–ì–ò–Ø**\\n\\n**–ò—Å—Å–ª–µ–¥—É–µ–º –≤–∞—à–∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–∑–≥–ª—è–¥—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è**\\n\\n–í —ç—Ç–æ–º –±–ª–æ–∫–µ 20 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ:\\n‚Ä¢ –†–æ–ª–∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞ –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ\\n‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ\\n‚Ä¢ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö\\n‚Ä¢ –ü—Ä–∞–≤–∞—Ö –∏ —Å–≤–æ–±–æ–¥–∞—Ö\\n‚Ä¢ –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö\\n\\n**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑?**\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"start-political\",\n                  \"text\": \"üó≥Ô∏è –ù–∞—á–∞—Ç—å –ø–æ–ª–∏—Ç–±–ª–æ–∫\",\n                  \"action\": \"goto\",\n                  \"target\": \"pol-q1\"\n                },\n                {\n                  \"id\": \"skip-to-history\",\n                  \"text\": \"üìú –ü–µ—Ä–µ–π—Ç–∏ –∫ –∏—Å—Ç–æ—Ä–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"history-intro\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"pol-q1\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 1000, \"y\": 250},\n            \"data\": {\n              \"messageText\": \"üó≥Ô∏è **–í–û–ü–†–û–° 1/20** (–ü–æ–ª–∏—Ç–æ–ª–æ–≥–∏—è)\\n\\n**–ö–∞–∫—É—é —Ä–æ–ª—å –¥–æ–ª–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ?**\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏–π –≤–∞–º –≤–∞—Ä–∏–∞–Ω—Ç:\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"pol-q1-opt1\",\n                  \"text\": \"A) –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–æ–ª—å - —Å–≤–æ–±–æ–¥–Ω—ã–π...\",\n                  \"action\": \"goto\",\n                  \"target\": \"pol-q1-result\"\n                },\n                {\n                  \"id\": \"pol-q1-opt2\",\n                  \"text\": \"B) –£–º–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ...\",\n                  \"action\": \"goto\",\n                  \"target\": \"pol-q1-result\"\n                },\n                {\n                  \"id\": \"pol-q1-opt3\",\n                  \"text\": \"C) –ê–∫—Ç–∏–≤–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ...\",\n                  \"action\": \"goto\",\n                  \"target\": \"pol-q1-result\"\n                },\n                {\n                  \"id\": \"pol-q1-opt4\",\n                  \"text\": \"D) –ü–æ–ª–Ω—ã–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π...\",\n                  \"action\": \"goto\",\n                  \"target\": \"pol-q1-result\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"pol-q1-result\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 1400, \"y\": 250},\n            \"data\": {\n              \"messageText\": \"‚úÖ **–û—Ç–≤–µ—Ç –∑–∞–ø–∏—Å–∞–Ω!**\\n\\n**–ü–æ–ª–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:**\\n\\nA) –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–æ–ª—å - —Å–≤–æ–±–æ–¥–Ω—ã–π —Ä—ã–Ω–æ–∫\\n\\nB) –£–º–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –æ—Ç—Ä–∞—Å–ª–µ–π\\n\\nC) –ê–∫—Ç–∏–≤–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ\\n\\nD) –ü–æ–ª–Ω—ã–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å\\n\\nüìä **–ü—Ä–æ–≥—Ä–µ—Å—Å:** 1/20 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–ª–∏—Ç–±–ª–æ–∫–∞\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"pol-q1-next\",\n                  \"text\": \"‚û°Ô∏è –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å\",\n                  \"action\": \"goto\",\n                  \"target\": \"history-intro\"\n                },\n                {\n                  \"id\": \"pol-q1-skip-to-history\",\n                  \"text\": \"üìú –ü–µ—Ä–µ–π—Ç–∏ –∫ –∏—Å—Ç–æ—Ä–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"history-intro\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"history-intro\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 100, \"y\": 500},\n            \"data\": {\n              \"messageText\": \"üìú **–ë–õ–û–ö –ë: –ò–°–¢–û–†–ò–Ø**\\n\\n**–ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞—à–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏**\\n\\n–í —ç—Ç–æ–º –±–ª–æ–∫–µ 25 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ:\\n‚Ä¢ –ö–ª—é—á–µ–≤—ã—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö\\n‚Ä¢ –í–µ–ª–∏–∫–∏—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ª–∏—á–Ω–æ—Å—Ç—è—Ö\\n‚Ä¢ –ü—Ä–∏—á–∏–Ω–∞—Ö –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è—Ö —Å–æ–±—ã—Ç–∏–π\\n‚Ä¢ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö —Ä–∞–∑–≤–∏—Ç–∏—è\\n‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—è—Ö\\n\\n**–ì–æ—Ç–æ–≤—ã –æ–∫—É–Ω—É—Ç—å—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é?**\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"start-history\",\n                  \"text\": \"üìú –ù–∞—á–∞—Ç—å –∏—Å—Ç–±–ª–æ–∫\",\n                  \"action\": \"goto\",\n                  \"target\": \"hist-q1\"\n                },\n                {\n                  \"id\": \"skip-to-philosophy\",\n                  \"text\": \"ü§î –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"philosophy-intro\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"hist-q1\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 400, \"y\": 700},\n            \"data\": {\n              \"messageText\": \"üìú **–í–û–ü–†–û–° 1/25** (–ò—Å—Ç–æ—Ä–∏—è)\\n\\n**–ß—Ç–æ —Å—Ç–∞–ª–æ –≥–ª–∞–≤–Ω–æ–π –ø—Ä–∏—á–∏–Ω–æ–π –ü–µ—Ä–≤–æ–π –º–∏—Ä–æ–≤–æ–π –≤–æ–π–Ω—ã?**\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"hist-q1-opt1\",\n                  \"text\": \"A) –£–±–∏–π—Å—Ç–≤–æ —ç—Ä—Ü–≥–µ—Ä—Ü–æ–≥–∞...\",\n                  \"action\": \"goto\",\n                  \"target\": \"hist-q1-result\"\n                },\n                {\n                  \"id\": \"hist-q1-opt2\",\n                  \"text\": \"B) –ò–º–ø–µ—Ä–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è...\",\n                  \"action\": \"goto\",\n                  \"target\": \"hist-q1-result\"\n                },\n                {\n                  \"id\": \"hist-q1-opt3\",\n                  \"text\": \"C) –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è...\",\n                  \"action\": \"goto\",\n                  \"target\": \"hist-q1-result\"\n                },\n                {\n                  \"id\": \"hist-q1-opt4\",\n                  \"text\": \"D) –ì–æ–Ω–∫–∞ –≤–æ–æ—Ä—É–∂–µ–Ω–∏–π...\",\n                  \"action\": \"goto\",\n                  \"target\": \"hist-q1-result\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"hist-q1-result\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 800, \"y\": 700},\n            \"data\": {\n              \"messageText\": \"‚úÖ **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω!**\\n\\n**–ü–æ–ª–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n\\nA) –£–±–∏–π—Å—Ç–≤–æ —ç—Ä—Ü–≥–µ—Ä—Ü–æ–≥–∞ –§—Ä–∞–Ω—Ü–∞ –§–µ—Ä–¥–∏–Ω–∞–Ω–¥–∞\\n\\nB) –ò–º–ø–µ—Ä–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –≤–µ–ª–∏–∫–∏—Ö –¥–µ—Ä–∂–∞–≤\\n\\nC) –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è –Ω–∞ –ë–∞–ª–∫–∞–Ω–∞—Ö\\n\\nD) –ì–æ–Ω–∫–∞ –≤–æ–æ—Ä—É–∂–µ–Ω–∏–π –∏ –º–∏–ª–∏—Ç–∞—Ä–∏–∑–º\\n\\nüìä **–ü—Ä–æ–≥—Ä–µ—Å—Å:** 1/25 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏—Å—Ç–æ—Ä–∏–±–ª–æ–∫–∞\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"hist-q1-next\",\n                  \"text\": \"ü§î –ö –±–ª–æ–∫—É –§–∏–ª–æ—Å–æ—Ñ–∏—è\",\n                  \"action\": \"goto\",\n                  \"target\": \"philosophy-intro\"\n                },\n                {\n                  \"id\": \"hist-q1-skip-to-philosophy\",\n                  \"text\": \"ü§î –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"philosophy-intro\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"philosophy-intro\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 100, \"y\": 1000},\n            \"data\": {\n              \"messageText\": \"ü§î **–ë–õ–û–ö –í: –§–ò–õ–û–°–û–§–ò–Ø**\\n\\n**–ò—Å—Å–ª–µ–¥—É–µ–º –≤–∞—à–∏ –º–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω—á–µ—Å–∫–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏**\\n\\n–í —ç—Ç–æ–º –±–ª–æ–∫–µ 15 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ:\\n‚Ä¢ –≠—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö –∏ –º–æ—Ä–∞–ª–∏\\n‚Ä¢ –ú–µ—Ç–∞—Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –≤–∑–≥–ª—è–¥–∞—Ö –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å\\n‚Ä¢ –°–º—ã—Å–ª–µ –∂–∏–∑–Ω–∏ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è—Ö\\n‚Ä¢ –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏\\n‚Ä¢ –≠–ø–∏—Å—Ç–µ–º–æ–ª–æ–≥–∏–∏ –∏ –ø–æ–∑–Ω–∞–Ω–∏–∏\\n\\n**–ì–æ—Ç–æ–≤—ã –∫ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–º—É –∞–Ω–∞–ª–∏–∑—É?**\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"start-philosophy\",\n                  \"text\": \"ü§î –ù–∞—á–∞—Ç—å —Ñ–∏–ª–±–ª–æ–∫\",\n                  \"action\": \"goto\",\n                  \"target\": \"phil-q1\"\n                },\n                {\n                  \"id\": \"skip-to-sociology\",\n                  \"text\": \"üåç –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ—Ü–∏–æ–ª–æ–≥–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"sociology-intro\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"phil-q1\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 400, \"y\": 1200},\n            \"data\": {\n              \"messageText\": \"ü§î **–í–û–ü–†–û–° 1/15** (–§–∏–ª–æ—Å–æ—Ñ–∏—è)\\n\\n**–ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –º–æ—Ä–∞–ª—å–Ω—ã—Ö —Å—É–∂–¥–µ–Ω–∏–π?**\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –≤–∑–≥–ª—è–¥:\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"phil-q1-opt1\",\n                  \"text\": \"A) –í—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ –º–æ—Ä–∞–ª—å–Ω—ã–µ...\",\n                  \"action\": \"goto\",\n                  \"target\": \"phil-q1-result\"\n                },\n                {\n                  \"id\": \"phil-q1-opt2\",\n                  \"text\": \"B) –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –¥–µ–π—Å—Ç–≤–∏–π...\",\n                  \"action\": \"goto\",\n                  \"target\": \"phil-q1-result\"\n                },\n                {\n                  \"id\": \"phil-q1-opt3\",\n                  \"text\": \"C) –î–æ–ª–≥ –∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ...\",\n                  \"action\": \"goto\",\n                  \"target\": \"phil-q1-result\"\n                },\n                {\n                  \"id\": \"phil-q1-opt4\",\n                  \"text\": \"D) –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è...\",\n                  \"action\": \"goto\",\n                  \"target\": \"phil-q1-result\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"phil-q1-result\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 800, \"y\": 1200},\n            \"data\": {\n              \"messageText\": \"‚úÖ **–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è –ø–æ–∑–∏—Ü–∏—è —É—á—Ç–µ–Ω–∞!**\\n\\n**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è:**\\n\\nA) –í—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ –º–æ—Ä–∞–ª—å–Ω—ã–µ –∏–Ω—Ç—É–∏—Ü–∏–∏\\n\\nB) –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –¥–µ–π—Å—Ç–≤–∏–π (—É—Ç–∏–ª–∏—Ç–∞—Ä–∏–∑–º)\\n\\nC) –î–æ–ª–≥ –∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã\\n\\nD) –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –∏ –∫—É–ª—å—Ç—É—Ä–∞\\n\\nüìä **–ü—Ä–æ–≥—Ä–µ—Å—Å:** 1/15 –≤–æ–ø—Ä–æ—Å–æ–≤ —Ñ–∏–ª–±–ª–æ–∫–∞\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"phil-q1-next\",\n                  \"text\": \"üåç –ö –±–ª–æ–∫—É –°–æ—Ü–∏–æ–ª–æ–≥–∏—è\",\n                  \"action\": \"goto\",\n                  \"target\": \"sociology-intro\"\n                },\n                {\n                  \"id\": \"phil-q1-skip-to-sociology\",\n                  \"text\": \"üåç –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ—Ü–∏–æ–ª–æ–≥–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"sociology-intro\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"sociology-intro\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 100, \"y\": 1500},\n            \"data\": {\n              \"messageText\": \"üåç **–ë–õ–û–ö –ì: –°–û–¶–ò–û–õ–û–ì–ò–Ø**\\n\\n**–ò–∑—É—á–∞–µ–º –≤–∞—à–∏ –≤–∑–≥–ª—è–¥—ã –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã**\\n\\n–í —ç—Ç–æ–º –±–ª–æ–∫–µ 20 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ:\\n‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–æ–º –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–µ –∏ —Å—Ç—Ä–∞—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏\\n‚Ä¢ –ì–ª–æ–±–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö\\n‚Ä¢ –ú–µ–∂–≥—Ä—É–ø–ø–æ–≤—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö\\n‚Ä¢ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö –∏ –±—É–¥—É—â–µ–º –æ–±—â–µ—Å—Ç–≤–∞\\n‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏\\n\\n**–ì–æ—Ç–æ–≤—ã –∫ —Å–æ—Ü–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º—É –∞–Ω–∞–ª–∏–∑—É?**\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"start-sociology\",\n                  \"text\": \"üåç –ù–∞—á–∞—Ç—å —Å–æ—Ü–∏–æ–±–ª–æ–∫\",\n                  \"action\": \"goto\",\n                  \"target\": \"soc-q1\"\n                },\n                {\n                  \"id\": \"skip-to-results\",\n                  \"text\": \"üìä –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º\",\n                  \"action\": \"goto\",\n                  \"target\": \"final-results\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"soc-q1\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 400, \"y\": 1700},\n            \"data\": {\n              \"messageText\": \"üåç **–í–û–ü–†–û–° 1/20** (–°–æ—Ü–∏–æ–ª–æ–≥–∏—è)\\n\\n**–ì–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞:**\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Å–æ—Ü–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –≤–∑–≥–ª—è–¥:\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"soc-q1-opt1\",\n                  \"text\": \"A) –†–∞–∑–ª–∏—á–∏—è –≤ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö...\",\n                  \"action\": \"goto\",\n                  \"target\": \"soc-q1-result\"\n                },\n                {\n                  \"id\": \"soc-q1-opt2\",\n                  \"text\": \"B) –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏...\",\n                  \"action\": \"goto\",\n                  \"target\": \"soc-q1-result\"\n                },\n                {\n                  \"id\": \"soc-q1-opt3\",\n                  \"text\": \"C) –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ...\",\n                  \"action\": \"goto\",\n                  \"target\": \"soc-q1-result\"\n                },\n                {\n                  \"id\": \"soc-q1-opt4\",\n                  \"text\": \"D) –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã...\",\n                  \"action\": \"goto\",\n                  \"target\": \"soc-q1-result\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"soc-q1-result\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 800, \"y\": 1700},\n            \"data\": {\n              \"messageText\": \"‚úÖ **–°–æ—Ü–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–∑–∏—Ü–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞!**\\n\\n**–í–∞—Ä–∏–∞–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞:**\\n\\nA) –†–∞–∑–ª–∏—á–∏—è –≤ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö –∏ —Ç–∞–ª–∞–Ω—Ç–µ\\n\\nB) –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã\\n\\nC) –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è\\n\\nD) –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –∏ –Ω–∞—Å–ª–µ–¥–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ\\n\\nüìä **–ü—Ä–æ–≥—Ä–µ—Å—Å:** 1/20 –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–æ—Ü–∏–æ–±–ª–æ–∫–∞\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"soc-q1-next\",\n                  \"text\": \"üéâ –ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º!\",\n                  \"action\": \"goto\",\n                  \"target\": \"final-results\"\n                },\n                {\n                  \"id\": \"soc-q1-skip-to-results\",\n                  \"text\": \"üìä –ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º\",\n                  \"action\": \"goto\",\n                  \"target\": \"final-results\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"final-results\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 100, \"y\": 2000},\n            \"data\": {\n              \"messageText\": \"üéâ **–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú –° –ó–ê–í–ï–†–®–ï–ù–ò–ï–ú –£–õ–¨–¢–†–ê-–ö–û–ú–ü–õ–ï–ö–°–ù–û–ì–û –û–ü–†–û–°–ê!**\\n\\nüìä **–í–ê–®–ò –†–ï–ó–£–õ–¨–¢–ê–¢–´:**\\n\\nüó≥Ô∏è **–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å:** –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è...\\nüìú **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –û—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è...\\nü§î **–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –≤–∑–≥–ª—è–¥—ã:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è...\\nüåç **–°–æ—Ü–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏:** –°–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è...\\n\\n‚è±Ô∏è **–í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è:** –í–ø–µ—á–∞—Ç–ª—è—é—â–∞—è —Å—Ç–æ–π–∫–æ—Å—Ç—å!\\nüéØ **–ü–æ–ª–Ω–æ—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤:** 80+ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ\\n\\n**–ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≥–æ—Ç–æ–≤–∏—Ç—Å—è...**\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"detailed-analysis\",\n                  \"text\": \"üìä –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑\",\n                  \"action\": \"goto\",\n                  \"target\": \"detailed-analysis\"\n                },\n                {\n                  \"id\": \"recommendations\",\n                  \"text\": \"üìö –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"recommendations\"\n                },\n                {\n                  \"id\": \"restart-survey\",\n                  \"text\": \"üîÑ –ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞\",\n                  \"action\": \"goto\",\n                  \"target\": \"start-poll\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"detailed-analysis\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 400, \"y\": 2200},\n            \"data\": {\n              \"messageText\": \"üìä **–î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –†–ï–ó–£–õ–¨–¢–ê–¢–û–í**\\n\\nüó≥Ô∏è **–ü–û–õ–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–õ–û–ö:**\\n‚Ä¢ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –≤–∑–≥–ª—è–¥—ã: –°–º–µ—à–∞–Ω–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞\\n‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞: –£–º–µ—Ä–µ–Ω–Ω–æ-–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è\\n‚Ä¢ –í–Ω–µ—à–Ω—è—è –ø–æ–ª–∏—Ç–∏–∫–∞: –ú–Ω–æ–≥–æ—Å—Ç–æ—Ä–æ–Ω–Ω–æ—Å—Ç—å\\n‚Ä¢ –ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–∏–∑–º vs –õ–∏–±–µ—Ä–∞–ª–∏–∑–º: –õ–∏–±–µ—Ä–∞–ª—å–Ω–æ-–¥–µ–º–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∏–π\\n\\nüìú **–ò–°–¢–û–†–ò–ß–ï–°–ö–ò–ô –ë–õ–û–ö:**\\n‚Ä¢ –ó–Ω–∞–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤: –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å\\n‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: –°–∏—Å—Ç–µ–º–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ\\n‚Ä¢ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π: –ú–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑\\n‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏: –†–∞–∑–≤–∏—Ç–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ\\n\\nü§î **–§–ò–õ–û–°–û–§–°–ö–ò–ô –ë–õ–û–ö:**\\n‚Ä¢ –≠—Ç–∏–∫–∞: –î–µ–æ–Ω—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ-—É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–π —Å–∏–Ω—Ç–µ–∑\\n‚Ä¢ –ú–µ—Ç–∞—Ñ–∏–∑–∏–∫–∞: –ú–∞—Ç–µ—Ä–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∞–ª–∏–∑–º\\n‚Ä¢ –≠–ø–∏—Å—Ç–µ–º–æ–ª–æ–≥–∏—è: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–º\\n‚Ä¢ –°–º—ã—Å–ª –∂–∏–∑–Ω–∏: –°–∞–º–æ–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–ª—É–∂–µ–Ω–∏–µ\\n\\nüåç **–°–û–¶–ò–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ë–õ–û–ö:**\\n‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–æ\\n‚Ä¢ –ì–ª–æ–±–∞–ª–∏–∑–∞—Ü–∏—è: –°–ª–æ–∂–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å –ø–ª—é—Å–∞–º–∏ –∏ –º–∏–Ω—É—Å–∞–º–∏\\n‚Ä¢ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—Ç –æ–±—â–µ—Å—Ç–≤–æ\\n‚Ä¢ –ë—É–¥—É—â–µ–µ: –û—Å—Ç–æ—Ä–æ–∂–Ω—ã–π –æ–ø—Ç–∏–º–∏–∑–º\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"back-to-results\",\n                  \"text\": \"‚¨ÖÔ∏è –ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º\",\n                  \"action\": \"goto\",\n                  \"target\": \"final-results\"\n                },\n                {\n                  \"id\": \"profile-comparison\",\n                  \"text\": \"üë• –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"profile-comparison\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"profile-comparison\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 800, \"y\": 2200},\n            \"data\": {\n              \"messageText\": \"üë• **–°–†–ê–í–ù–ï–ù–ò–ï –° –¢–ò–ü–ò–ß–ù–´–ú–ò –ü–†–û–§–ò–õ–Ø–ú–ò**\\n\\nüéØ **–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∏–∑–æ–∫ –∫:**\\n\\n**\\\"–ü—Ä–æ—Å–≤–µ—â–µ–Ω–Ω—ã–π –¶–µ–Ω—Ç—Ä–∏—Å—Ç\\\"** - 87% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ\\n‚Ä¢ –†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –ø–æ–ª–∏—Ç–∏–∫–µ\\n‚Ä¢ –ì–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏\\n‚Ä¢ –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–æ—Å—Ç—å\\n‚Ä¢ –°–∏—Å—Ç–µ–º–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –æ –æ–±—â–µ—Å—Ç–≤–µ\\n\\nüìä **–î—Ä—É–≥–∏–µ –±–ª–∏–∑–∫–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏:**\\n‚Ä¢ –õ–∏–±–µ—Ä–∞–ª—å–Ω—ã–π –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª - 78%\\n‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ü—Ä–∞–≥–º–∞—Ç–∏–∫ - 74%\\n‚Ä¢ –°–æ—Ü–∏–∞–ª-–¥–µ–º–æ–∫—Ä–∞—Ç - 71%\\n\\nüîç **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —á–µ—Ä—Ç—ã –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è:**\\n‚Ä¢ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã—Ö –≤–∑–≥–ª—è–¥–æ–≤\\n‚Ä¢ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ —Å –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å—é\\n‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—É–∂–¥–µ–Ω–∏—è—Ö\\n‚Ä¢ –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è –≥–ª—É–±–∏–Ω–∞ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–º –∞–Ω–∞–ª–∏–∑–µ\\n\\n**–í—ã –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç–µ —Ä–µ–¥–∫–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è –∏ —á–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç–∏!**\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"back-to-analysis\",\n                  \"text\": \"‚¨ÖÔ∏è –ö –∞–Ω–∞–ª–∏–∑—É\",\n                  \"action\": \"goto\",\n                  \"target\": \"detailed-analysis\"\n                },\n                {\n                  \"id\": \"view-recommendations\",\n                  \"text\": \"üìö –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\",\n                  \"action\": \"goto\",\n                  \"target\": \"recommendations\"\n                }\n              ],\n              \"markdown\": true\n            }\n          },\n          {\n            \"id\": \"recommendations\",\n            \"type\": \"message\",\n            \"position\": {\"x\": 400, \"y\": 2400},\n            \"data\": {\n              \"messageText\": \"üìö **–ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –†–ê–ó–í–ò–¢–ò–Ø**\\n\\nüìñ **–ö–Ω–∏–≥–∏ –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π:**\\n‚Ä¢ \\\"–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è\\\" - –†–æ–±–µ—Ä—Ç –ü–æ–ª –í–æ–ª—å—Ñ\\n‚Ä¢ \\\"–°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–π\\\" - –°—ç–º—é—ç–ª –•–∞–Ω—Ç–∏–Ω–≥—Ç–æ–Ω\\n‚Ä¢ \\\"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å\\\" - –ú–∞–π–∫–ª –°—ç–Ω–¥–µ–ª\\n‚Ä¢ \\\"–ü–æ—Å—Ç–∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω–æ–µ –æ–±—â–µ—Å—Ç–≤–æ\\\" - –î—ç–Ω–∏–µ–ª –ë–µ–ª–ª\\n\\nüéì **–û–±–ª–∞—Å—Ç–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:**\\n‚Ä¢ –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–æ–ª–æ–≥–∏—è\\n‚Ä¢ –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏—Å—Ç–æ—Ä–∏–∏\\n‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è\\n‚Ä¢ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —ç–∫–æ–Ω–æ–º–∏—è\\n\\nüí≠ **–¢–µ–º—ã –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è:**\\n‚Ä¢ –ö–∞–∫ —Å–æ–≤–º–µ—Å—Ç–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –±–ª–∞–≥–æ?\\n‚Ä¢ –ö–∞–∫–∏–µ —É—Ä–æ–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏?\\n‚Ä¢ –ö–∞–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏–∑–º–µ–Ω—è—Ç –ø—Ä–∏—Ä–æ–¥—É –¥–µ–º–æ–∫—Ä–∞—Ç–∏–∏?\\n‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ –ª–∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?\\n\\nüåü **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**\\n‚Ä¢ –£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∏—Å–∫—É—Å—Å–∏—è—Ö\\n‚Ä¢ –ò–∑—É—á–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è\\n‚Ä¢ –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–æ–±—ã—Ç–∏—è–º\\n‚Ä¢ –†–∞–∑–≤–∏–≤–∞–π—Ç–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ\",\n              \"keyboardType\": \"inline\",\n              \"buttons\": [\n                {\n                  \"id\": \"back-to-results-final\",\n                  \"text\": \"‚¨ÖÔ∏è –ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º\",\n                  \"action\": \"goto\",\n                  \"target\": \"final-results\"\n                },\n                {\n                  \"id\": \"new-survey\",\n                  \"text\": \"üÜï –ù–æ–≤—ã–π –æ–ø—Ä–æ—Å\",\n                  \"action\": \"goto\",\n                  \"target\": \"start-poll\"\n                }\n              ],\n              \"markdown\": true\n            }\n          }\n        ],\n        \"connections\": [\n          {\n            \"id\": \"conn-start-overview\",\n            \"source\": \"start-poll\",\n            \"target\": \"sections-overview\"\n          },\n          {\n            \"id\": \"conn-start-instructions\",\n            \"source\": \"start-poll\",\n            \"target\": \"survey-instructions\"\n          },\n          {\n            \"id\": \"conn-start-political\",\n            \"source\": \"start-poll\",\n            \"target\": \"political-intro\"\n          },\n          {\n            \"id\": \"conn-overview-start\",\n            \"source\": \"sections-overview\",\n            \"target\": \"start-poll\"\n          },\n          {\n            \"id\": \"conn-political-history\",\n            \"source\": \"political-intro\",\n            \"target\": \"history-intro\"\n          },\n          {\n            \"id\": \"conn-history-philosophy\",\n            \"source\": \"history-intro\",\n            \"target\": \"philosophy-intro\"\n          },\n          {\n            \"id\": \"conn-philosophy-sociology\",\n            \"source\": \"philosophy-intro\",\n            \"target\": \"sociology-intro\"\n          },\n          {\n            \"id\": \"conn-sociology-results\",\n            \"source\": \"sociology-intro\",\n            \"target\": \"final-results\"\n          },\n          {\n            \"id\": \"conn-results-analysis\",\n            \"source\": \"final-results\",\n            \"target\": \"detailed-analysis\"\n          },\n          {\n            \"id\": \"conn-analysis-comparison\",\n            \"source\": \"detailed-analysis\",\n            \"target\": \"profile-comparison\"\n          },\n          {\n            \"id\": \"conn-results-recommendations\",\n            \"source\": \"final-results\",\n            \"target\": \"recommendations\"\n          }\n        ]\n      }\n    });\n\n    // –ü—Ä–æ—Å—Ç–æ–π –æ–ø—Ä–æ—Å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–≤–æ–¥–æ–º\n    await storage.createBotTemplate({\n      name: \"üìù –û–ø—Ä–æ—Å —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –≤–≤–æ–¥–æ–º\",\n      description: \"–ü—Ä–æ—Å—Ç–æ–π –±–æ—Ç –¥–ª—è —Å–±–æ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–ª–µ–º –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞\",\n      category: \"business\",\n      tags: [\"–æ–ø—Ä–æ—Å\", \"–≤–≤–æ–¥\", \"–æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å\", \"–∞–Ω–∫–µ—Ç–∞\"],\n      isPublic: 1,\n      difficulty: \"medium\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 4,\n      estimatedTime: 15,\n      data: {\n        nodes: [\n          {\n            id: \"start-1\",\n            type: \"start\",\n            position: { x: 100, y: 100 },\n            data: {\n              command: \"/start\",\n              description: \"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –Ω–∞—á–∞–ª–æ –æ–ø—Ä–æ—Å–∞\",\n              messageText: \"üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏!\\n\\n–ú—ã –æ—á–µ–Ω—å —Ü–µ–Ω–∏–º –º–Ω–µ–Ω–∏–µ –Ω–∞—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏!\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-start-survey\",\n                  text: \"üìù –ù–∞—á–∞—Ç—å –æ–ø—Ä–æ—Å\",\n                  action: \"goto\",\n                  target: \"survey-question\"\n                },\n                {\n                  id: \"btn-skip\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"thank-you\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"survey-question\",\n            type: \"message\",\n            position: { x: 400, y: 100 },\n            data: {\n              messageText: \"üìã –í–æ–ø—Ä–æ—Å 1 –∏–∑ 2\\n\\n–ö–∞–∫ –±—ã –≤—ã –æ—Ü–µ–Ω–∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞?\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-excellent\",\n                  text: \"‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—Ç–ª–∏—á–Ω–æ\",\n                  action: \"goto\",\n                  target: \"feedback-input\"\n                },\n                {\n                  id: \"btn-good\",\n                  text: \"‚≠ê‚≠ê‚≠ê‚≠ê –•–æ—Ä–æ—à–æ\",\n                  action: \"goto\",\n                  target: \"feedback-input\"\n                },\n                {\n                  id: \"btn-average\",\n                  text: \"‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω–µ\",\n                  action: \"goto\",\n                  target: \"feedback-input\"\n                },\n                {\n                  id: \"btn-poor\",\n                  text: \"‚≠ê‚≠ê –ü–ª–æ—Ö–æ\",\n                  action: \"goto\",\n                  target: \"feedback-input\"\n                },\n                {\n                  id: \"btn-terrible\",\n                  text: \"‚≠ê –£–∂–∞—Å–Ω–æ\",\n                  action: \"goto\",\n                  target: \"feedback-input\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"feedback-input\",\n            type: \"user-input\",\n            position: { x: 700, y: 100 },\n            data: {\n              messageText: \"üí¨ –í–æ–ø—Ä–æ—Å 2 –∏–∑ 2\\n\\n–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–≤–æ–∏—Ö –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è—Ö. –ß—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –∏–ª–∏ —á—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å?\\n\\n‚úçÔ∏è –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤:\",\n              inputType: \"text\",\n              inputVariable: \"user_feedback\",\n              placeholder: \"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤ –∑–¥–µ—Å—å...\",\n              isRequired: true,\n              minLength: 10,\n              maxLength: 500,\n              validationMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–∑—ã–≤ –æ—Ç 10 –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤\",\n              timeoutSeconds: 300,\n              timeoutMessage: \"‚è∞ –í—Ä–µ–º—è –¥–ª—è –≤–≤–æ–¥–∞ –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –ø–æ–∑–∂–µ.\",\n              saveToDatabase: true,\n              successTarget: \"thank-you\",\n              errorTarget: \"feedback-error\"\n            }\n          },\n          {\n            id: \"feedback-error\",\n            type: \"message\",\n            position: { x: 700, y: 250 },\n            data: {\n              messageText: \"‚ùå –û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–∑—ã–≤ (–æ—Ç 10 –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤).\\n\\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑:\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-retry\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"feedback-input\"\n                },\n                {\n                  id: \"btn-skip-feedback\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"thank-you\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"thank-you\",\n            type: \"message\",\n            position: { x: 1000, y: 100 },\n            data: {\n              messageText: \"üéâ –°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!\\n\\n–í–∞—à–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—á–µ–Ω—å –≤–∞–∂–Ω–∞ –¥–ª—è –Ω–∞—Å –∏ –ø–æ–º–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å –Ω–∞—à —Å–µ—Ä–≤–∏—Å.\\n\\n–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è!\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-restart\",\n                  text: \"üîÑ –ü—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å —Å–Ω–æ–≤–∞\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                },\n                {\n                  id: \"btn-help\",\n                  text: \"‚ùì –ü–æ–º–æ—â—å\",\n                  action: \"command\",\n                  target: \"/help\"\n                }\n              ],\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          }\n        ],\n        connections: [\n          {\n            id: \"conn-1\",\n            source: \"start-1\",\n            target: \"survey-question\"\n          },\n          {\n            id: \"conn-2\",\n            source: \"start-1\",\n            target: \"thank-you\"\n          },\n          {\n            id: \"conn-3\",\n            source: \"survey-question\",\n            target: \"feedback-input\"\n          },\n          {\n            id: \"conn-4\",\n            source: \"feedback-input\",\n            target: \"thank-you\"\n          },\n          {\n            id: \"conn-5\",\n            source: \"feedback-input\",\n            target: \"feedback-error\"\n          },\n          {\n            id: \"conn-6\",\n            source: \"feedback-error\",\n            target: \"feedback-input\"\n          },\n          {\n            id: \"conn-7\",\n            source: \"feedback-error\",\n            target: \"thank-you\"\n          },\n          {\n            id: \"conn-8\",\n            source: \"thank-you\",\n            target: \"start-1\"\n          }\n        ]\n      }\n    });\n\n    console.log('–ë–∞–∑–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã');\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤:', error);\n  }\n}\n    await storage.createBotTemplate({\n      name: \"üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö\",\n      description: \"–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞: —Ç–µ–∫—Å—Ç–æ–≤—ã–π, –∫–Ω–æ–ø–æ—á–Ω—ã–π, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä, –º–µ–¥–∏–∞\",\n      category: \"official\",\n      tags: [\"—Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö\", \"—Ñ–æ—Ä–º—ã\", \"–æ–ø—Ä–æ—Å—ã\", \"–≤–≤–æ–¥\", \"–∫–Ω–æ–ø–∫–∏\"],\n      isPublic: 1,\n      difficulty: \"hard\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 8,\n      estimatedTime: 25,\n      data: {\n        nodes: [\n          {\n            id: \"start-1\",\n            type: \"start\",\n            position: { x: 100, y: 100 },\n            data: {\n              command: \"/start\",\n              description: \"–ù–∞—á–∞–ª–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö\",\n              messageText: \"üéØ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö!\\n\\n–≠—Ç–æ—Ç –±–æ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞:\\n\\n‚Ä¢ üìù –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥\\n‚Ä¢ üîò –ö–Ω–æ–ø–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã\\n‚Ä¢ ‚òëÔ∏è –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\\n‚Ä¢ üì± –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã\\n‚Ä¢ üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\\n\\n–ù–∞—á–Ω–µ–º —Å–±–æ—Ä –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö?\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-start-survey\",\n                  text: \"üöÄ –ù–∞—á–∞—Ç—å —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö\",\n                  action: \"goto\",\n                  target: \"name-input\"\n                },\n                {\n                  id: \"btn-skip-all\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ\",\n                  action: \"goto\",\n                  target: \"final-results\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"name-input\",\n            type: \"user-input\",\n            position: { x: 400, y: 100 },\n            data: {\n              messageText: \"üë§ –®–∞–≥ 1: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\\n\\n–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?\\n\\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è (–æ—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤):\",\n              responseType: \"text\",\n              inputType: \"text\",\n              inputVariable: \"user_name\",\n              placeholder: \"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è...\",\n              isRequired: true,\n              minLength: 2,\n              maxLength: 50,\n              validationMessage: \"–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤\",\n              timeoutSeconds: 120,\n              timeoutMessage: \"‚è∞ –í—Ä–µ–º—è –≤–≤–æ–¥–∞ –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.\",\n              saveToDatabase: true,\n              successTarget: \"age-buttons\",\n              errorTarget: \"name-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"name-error\",\n            type: \"message\",\n            position: { x: 400, y: 250 },\n            data: {\n              messageText: \"‚ùå –û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è (–æ—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤).\\n\\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑:\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-retry-name\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"name-input\"\n                },\n                {\n                  id: \"btn-skip-name\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"age-buttons\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"age-buttons\",\n            type: \"user-input\",\n            position: { x: 700, y: 100 },\n            data: {\n              messageText: \"üéÇ –®–∞–≥ 2: –í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É –≤–æ–∑—Ä–∞—Å—Ç–Ω—É—é –≥—Ä—É–ø–ø—É:\\n\\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞:\",\n              responseType: \"buttons\",\n              responseOptions: [\n                {\n                  id: \"age-18-25\",\n                  text: \"18-25 –ª–µ—Ç\",\n                  value: \"18-25\"\n                },\n                {\n                  id: \"age-26-35\",\n                  text: \"26-35 –ª–µ—Ç\",\n                  value: \"26-35\"\n                },\n                {\n                  id: \"age-36-45\",\n                  text: \"36-45 –ª–µ—Ç\",\n                  value: \"36-45\"\n                },\n                {\n                  id: \"age-46-55\",\n                  text: \"46-55 –ª–µ—Ç\",\n                  value: \"46-55\"\n                },\n                {\n                  id: \"age-55+\",\n                  text: \"55+ –ª–µ—Ç\",\n                  value: \"55+\"\n                }\n              ],\n              allowMultipleSelection: false,\n              inputVariable: \"user_age_group\",\n              isRequired: true,\n              saveToDatabase: true,\n              successTarget: \"interests-multiple\",\n              errorTarget: \"age-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"age-error\",\n            type: \"message\",\n            position: { x: 700, y: 250 },\n            data: {\n              messageText: \"‚ùå –û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø.\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-retry-age\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—ã–±–æ—Ä\",\n                  action: \"goto\",\n                  target: \"age-buttons\"\n                },\n                {\n                  id: \"btn-skip-age\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"interests-multiple\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"interests-multiple\",\n            type: \"user-input\",\n            position: { x: 1000, y: 100 },\n            data: {\n              messageText: \"üéØ –®–∞–≥ 3: –ò–Ω—Ç–µ—Ä–µ—Å—ã (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä)\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ):\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –Ω–∞–∂–º–∏—Ç–µ \\\"–ì–æ—Ç–æ–≤–æ\\\":\",\n              responseType: \"buttons\",\n              responseOptions: [\n                {\n                  id: \"int-tech\",\n                  text: \"üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\",\n                  value: \"technology\"\n                },\n                {\n                  id: \"int-sport\",\n                  text: \"‚öΩ –°–ø–æ—Ä—Ç\",\n                  value: \"sport\"\n                },\n                {\n                  id: \"int-music\",\n                  text: \"üéµ –ú—É–∑—ã–∫–∞\",\n                  value: \"music\"\n                },\n                {\n                  id: \"int-travel\",\n                  text: \"‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è\",\n                  value: \"travel\"\n                },\n                {\n                  id: \"int-cooking\",\n                  text: \"üë®‚Äçüç≥ –ö—É–ª–∏–Ω–∞—Ä–∏—è\",\n                  value: \"cooking\"\n                },\n                {\n                  id: \"int-books\",\n                  text: \"üìö –ö–Ω–∏–≥–∏\",\n                  value: \"books\"\n                },\n                {\n                  id: \"int-done\",\n                  text: \"‚úÖ –ì–æ—Ç–æ–≤–æ\",\n                  value: \"done\"\n                }\n              ],\n              allowMultipleSelection: true,\n              inputVariable: \"user_interests\",\n              isRequired: true,\n              saveToDatabase: true,\n              successTarget: \"contact-input\",\n              errorTarget: \"interests-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"interests-error\",\n            type: \"message\",\n            position: { x: 1000, y: 250 },\n            data: {\n              messageText: \"‚ùå –û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä–µ—Å –∏ –Ω–∞–∂–º–∏—Ç–µ \\\"–ì–æ—Ç–æ–≤–æ\\\".\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-retry-interests\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—ã–±–æ—Ä\",\n                  action: \"goto\",\n                  target: \"interests-multiple\"\n                },\n                {\n                  id: \"btn-skip-interests\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"contact-input\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"contact-input\",\n            type: \"user-input\",\n            position: { x: 1300, y: 100 },\n            data: {\n              messageText: \"üì± –®–∞–≥ 4: –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\\n\\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω:\\n\\n–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å –≤–∞–º–∏:\",\n              responseType: \"text\",\n              inputType: \"email\",\n              inputVariable: \"user_contact\",\n              placeholder: \"example@email.com –∏–ª–∏ +7-999-123-45-67\",\n              isRequired: false,\n              minLength: 5,\n              maxLength: 100,\n              validationMessage: \"–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω\",\n              timeoutSeconds: 180,\n              timeoutMessage: \"‚è∞ –í—Ä–µ–º—è –≤–≤–æ–¥–∞ –∏—Å—Ç–µ–∫–ª–æ. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É.\",\n              saveToDatabase: true,\n              successTarget: \"experience-rating\",\n              errorTarget: \"contact-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"contact-error\",\n            type: \"message\",\n            position: { x: 1300, y: 250 },\n            data: {\n              messageText: \"‚ùå –û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-retry-contact\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"contact-input\"\n                },\n                {\n                  id: \"btn-skip-contact\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"experience-rating\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"experience-rating\",\n            type: \"user-input\",\n            position: { x: 1600, y: 100 },\n            data: {\n              messageText: \"‚≠ê –®–∞–≥ 5: –û—Ü–µ–Ω–∫–∞ –æ–ø—ã—Ç–∞\\n\\n–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ –æ–ø—ã—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ –±–æ—Ç–∞?\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥:\",\n              responseType: \"buttons\",\n              responseOptions: [\n                {\n                  id: \"star-1\",\n                  text: \"‚≠ê 1 –∑–≤–µ–∑–¥–∞\",\n                  value: \"1\"\n                },\n                {\n                  id: \"star-2\",\n                  text: \"‚≠ê‚≠ê 2 –∑–≤–µ–∑–¥—ã\",\n                  value: \"2\"\n                },\n                {\n                  id: \"star-3\",\n                  text: \"‚≠ê‚≠ê‚≠ê 3 –∑–≤–µ–∑–¥—ã\",\n                  value: \"3\"\n                },\n                {\n                  id: \"star-4\",\n                  text: \"‚≠ê‚≠ê‚≠ê‚≠ê 4 –∑–≤–µ–∑–¥—ã\",\n                  value: \"4\"\n                },\n                {\n                  id: \"star-5\",\n                  text: \"‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 –∑–≤–µ–∑–¥\",\n                  value: \"5\"\n                }\n              ],\n              allowMultipleSelection: false,\n              inputVariable: \"user_rating\",\n              isRequired: true,\n              saveToDatabase: true,\n              successTarget: \"final-comment\",\n              errorTarget: \"rating-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"rating-error\",\n            type: \"message\",\n            position: { x: 1600, y: 250 },\n            data: {\n              messageText: \"‚ùå –û—à–∏–±–∫–∞ –æ—Ü–µ–Ω–∫–∏\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5 –∑–≤–µ–∑–¥.\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-retry-rating\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ü–µ–Ω–∫—É\",\n                  action: \"goto\",\n                  target: \"experience-rating\"\n                },\n                {\n                  id: \"btn-skip-rating\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"final-comment\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"final-comment\",\n            type: \"user-input\",\n            position: { x: 1900, y: 100 },\n            data: {\n              messageText: \"üí≠ –®–∞–≥ 6: –ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\\n\\n–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è?\\n\\n–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –º–Ω–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):\",\n              responseType: \"text\",\n              inputType: \"text\",\n              inputVariable: \"user_comment\",\n              placeholder: \"–í–∞—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è...\",\n              isRequired: false,\n              minLength: 0,\n              maxLength: 1000,\n              validationMessage: \"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 1000 —Å–∏–º–≤–æ–ª–æ–≤\",\n              timeoutSeconds: 300,\n              timeoutMessage: \"‚è∞ –í—Ä–µ–º—è –≤–≤–æ–¥–∞ –∏—Å—Ç–µ–∫–ª–æ. –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.\",\n              saveToDatabase: true,\n              successTarget: \"final-results\",\n              errorTarget: \"comment-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"comment-error\",\n            type: \"message\",\n            position: { x: 1900, y: 250 },\n            data: {\n              messageText: \"‚ùå –û—à–∏–±–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è\\n\\n–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π. –ú–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤.\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-retry-comment\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"final-comment\"\n                },\n                {\n                  id: \"btn-skip-comment\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"final-results\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n          {\n            id: \"final-results\",\n            type: \"message\",\n            position: { x: 2200, y: 100 },\n            data: {\n              messageText: \"üéâ –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω!\\n\\n–°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!\\n\\n–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –≤—Å–µ —Ç–∏–ø—ã —Å–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞:\\n\\n‚úÖ –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ - –∏–º—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏\\n‚úÖ –û–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä - –≤–æ–∑—Ä–∞—Å—Ç –∏ —Ä–µ–π—Ç–∏–Ω–≥\\n‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä - –∏–Ω—Ç–µ—Ä–µ—Å—ã\\n‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö - –ø—Ä–æ–≤–µ—Ä–∫–∞ email/—Ç–µ–ª–µ—Ñ–æ–Ω–∞\\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ - –ø–æ–≤—Ç–æ—Ä—ã –∏ –ø—Ä–æ–ø—É—Å–∫–∏\\n\\n–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≥–æ—Ç–æ–≤—ã –∫ –∞–Ω–∞–ª–∏–∑—É.\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-restart\",\n                  text: \"üîÑ –ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞\",\n                  action: \"goto\",\n                  target: \"start-1\"\n                },\n                {\n                  id: \"btn-admin\",\n                  text: \"üë®‚Äçüíº –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\",\n                  action: \"command\",\n                  target: \"/admin\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\",\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          }\n        ],\n        connections: [\n          {\n            id: \"conn-1\",\n            source: \"start-1\",\n            target: \"name-input\"\n          },\n          {\n            id: \"conn-2\",\n            source: \"start-1\",\n            target: \"final-results\"\n          },\n          {\n            id: \"conn-3\",\n            source: \"name-input\",\n            target: \"age-buttons\"\n          },\n          {\n            id: \"conn-4\",\n            source: \"name-input\",\n            target: \"name-error\"\n          },\n          {\n            id: \"conn-5\",\n            source: \"name-error\",\n            target: \"name-input\"\n          },\n          {\n            id: \"conn-6\",\n            source: \"name-error\",\n            target: \"age-buttons\"\n          },\n          {\n            id: \"conn-7\",\n            source: \"age-buttons\",\n            target: \"interests-multiple\"\n          },\n          {\n            id: \"conn-8\",\n            source: \"age-buttons\",\n            target: \"age-error\"\n          },\n          {\n            id: \"conn-9\",\n            source: \"age-error\",\n            target: \"age-buttons\"\n          },\n          {\n            id: \"conn-10\",\n            source: \"age-error\",\n            target: \"interests-multiple\"\n          },\n          {\n            id: \"conn-11\",\n            source: \"interests-multiple\",\n            target: \"contact-input\"\n          },\n          {\n            id: \"conn-12\",\n            source: \"interests-multiple\",\n            target: \"interests-error\"\n          },\n          {\n            id: \"conn-13\",\n            source: \"interests-error\",\n            target: \"interests-multiple\"\n          },\n          {\n            id: \"conn-14\",\n            source: \"interests-error\",\n            target: \"contact-input\"\n          },\n          {\n            id: \"conn-15\",\n            source: \"contact-input\",\n            target: \"experience-rating\"\n          },\n          {\n            id: \"conn-16\",\n            source: \"contact-input\",\n            target: \"contact-error\"\n          },\n          {\n            id: \"conn-17\",\n            source: \"contact-error\",\n            target: \"contact-input\"\n          },\n          {\n            id: \"conn-18\",\n            source: \"contact-error\",\n            target: \"experience-rating\"\n          },\n          {\n            id: \"conn-19\",\n            source: \"experience-rating\",\n            target: \"final-comment\"\n          },\n          {\n            id: \"conn-20\",\n            source: \"experience-rating\",\n            target: \"rating-error\"\n          },\n          {\n            id: \"conn-21\",\n            source: \"rating-error\",\n            target: \"experience-rating\"\n          },\n          {\n            id: \"conn-22\",\n            source: \"rating-error\",\n            target: \"final-comment\"\n          },\n          {\n            id: \"conn-23\",\n            source: \"final-comment\",\n            target: \"final-results\"\n          },\n          {\n            id: \"conn-24\",\n            source: \"final-comment\",\n            target: \"comment-error\"\n          },\n          {\n            id: \"conn-25\",\n            source: \"comment-error\",\n            target: \"final-comment\"\n          },\n          {\n            id: \"conn-26\",\n            source: \"comment-error\",\n            target: \"final-results\"\n          },\n          {\n            id: \"conn-27\",\n            source: \"final-results\",\n            target: \"start-1\"\n          }\n        ]\n      }\n    });\n\n    // –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–±–æ—Ä –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n    await storage.createBotTemplate({\n      name: \"üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–±–æ—Ä –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\",\n      description: \"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –∏ –ø—Ä–æ–µ–∫—Ç–∞—Ö —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π\",\n      category: \"business\",\n      tags: [\"–∞–Ω–∫–µ—Ç–∞\", \"—Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö\", \"–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π\", \"–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π\", \"–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π\", \"–º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π\"],\n      isPublic: 1,\n      difficulty: \"hard\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 9,\n      estimatedTime: 45,\n      data: {\n        nodes: [\n          {\n            id: \"start-welcome\",\n            type: \"start\",\n            position: { x: 100, y: 100 },\n            data: {\n              command: \"/start\",\n              description: \"–ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\",\n              messageText: \"üè¢ –î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í –°–ò–°–¢–ï–ú–£ –°–ë–û–†–ê –ö–û–†–ü–û–†–ê–¢–ò–í–ù–û–ô –ò–ù–§–û–†–ú–ê–¶–ò–ò\\n\\nüìã –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤–∫–ª—é—á–∞–µ—Ç:\\n‚Ä¢ üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞\\n‚Ä¢ üè¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏\\n‚Ä¢ üíº –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ–ø—ã—Ç\\n‚Ä¢ üìä –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã\\n‚Ä¢ üéØ –¶–µ–ª–∏ –∏ –ø–ª–∞–Ω—ã\\n‚Ä¢ üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\\n‚Ä¢ üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å\\n\\n‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è: 30-45 –º–∏–Ω—É—Ç\\nüéØ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü–æ–ª–Ω–∞—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∞–Ω–∫–µ—Ç–∞\\n\\n–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏?\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"start-process\",\n                  text: \"üöÄ –ù–∞—á–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ\",\n                  action: \"goto\",\n                  target: \"personal-info\"\n                },\n                {\n                  id: \"view-privacy\",\n                  text: \"üîí –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏\",\n                  action: \"goto\",\n                  target: \"privacy-policy\"\n                },\n                {\n                  id: \"instructions\",\n                  text: \"üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\",\n                  action: \"goto\",\n                  target: \"filling-instructions\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"privacy-policy\",\n            type: \"message\",\n            position: { x: 400, y: 50 },\n            data: {\n              messageText: \"üîí –ü–û–õ–ò–¢–ò–ö–ê –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò\\n\\n‚úÖ –ú—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º:\\n‚Ä¢ –ó–∞—â–∏—Ç—É –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ü–µ–ª–µ–π\\n‚Ä¢ –°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π GDPR –∏ 152-–§–ó\\n‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–ø—Ä–æ—Å—É\\n\\nüõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:\\n‚Ä¢ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ\\n‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\\n‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∞—É–¥–∏—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\\n\\nüìß –ö–æ–Ω—Ç–∞–∫—Ç—ã: privacy@company.com\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"accept-privacy\",\n                  text: \"‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"personal-info\"\n                },\n                {\n                  id: \"back-to-start\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –Ω–∞—á–∞–ª—É\",\n                  action: \"goto\",\n                  target: \"start-welcome\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"filling-instructions\",\n            type: \"message\",\n            position: { x: 400, y: 150 },\n            data: {\n              messageText: \"üìñ –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ó–ê–ü–û–õ–ù–ï–ù–ò–Æ\\n\\nüéØ –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\\n‚Ä¢ –ó–∞–ø–æ–ª–Ω—è–π—Ç–µ –≤—Å–µ –ø–æ–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω–æ\\n‚Ä¢ –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É \\\"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\\\"\\n‚Ä¢ –ú–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Ä–∞–∑–¥–µ–ª–∞–º\\n‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\\n\\n‚ö° –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã:\\n‚Ä¢ /help - –ø–æ–º–æ—â—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è\\n‚Ä¢ /status - —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å\\n‚Ä¢ /reset - –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\\n\\nüí° –°–æ–≤–µ—Ç: –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∑–∞—Ä–∞–Ω–µ–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞—Ö\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"start-after-instructions\",\n                  text: \"üöÄ –ù–∞—á–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ\",\n                  action: \"goto\",\n                  target: \"personal-info\"\n                },\n                {\n                  id: \"back-from-instructions\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –Ω–∞—á–∞–ª—É\",\n                  action: \"goto\",\n                  target: \"start-welcome\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"personal-info\",\n            type: \"user-input\",\n            position: { x: 700, y: 100 },\n            data: {\n              messageText: \"üë§ –†–ê–ó–î–ï–õ 1: –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï\\n\\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –ø–æ–ª–Ω–æ–µ –∏–º—è:\\n\\n–ü—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á\\n\\nüìù –£–∫–∞–∂–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é, –∏–º—è –∏ –æ—Ç—á–µ—Å—Ç–≤–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é\",\n              responseType: \"text\",\n              inputType: \"text\",\n              inputVariable: \"full_name\",\n              minLength: 3,\n              maxLength: 100,\n              inputTimeout: 300,\n              inputRequired: true,\n              allowSkip: false,\n              saveToDatabase: true,\n              inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –ø–æ–ª–Ω–æ–µ –∏–º—è (–º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞)\",\n              inputSuccessMessage: \"‚úÖ –ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ\",\n              placeholder: \"–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ\",\n              successTarget: \"position-info\",\n              errorTarget: \"personal-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"personal-error\",\n            type: \"message\",\n            position: { x: 950, y: 100 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–í–û–î–ê –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–ª–Ω–æ–µ –∏–º—è.\\n\\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\\n‚Ä¢ –ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞\\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤\\n‚Ä¢ –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ –ø—Ä–æ–±–µ–ª—ã\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-personal\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"personal-info\"\n                },\n                {\n                  id: \"skip-personal\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"position-info\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"position-info\",\n            type: \"user-input\",\n            position: { x: 700, y: 250 },\n            data: {\n              messageText: \"üíº –†–ê–ó–î–ï–õ 2: –î–û–õ–ñ–ù–û–°–¢–¨ –ò –û–¢–î–ï–õ\\n\\n–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É —Ç–µ–∫—É—â—É—é –¥–æ–ª–∂–Ω–æ—Å—Ç—å:\\n\\n–ü—Ä–∏–º–µ—Ä: –í–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ / –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ / –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫\\n\\nüìù –£–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏\",\n              responseType: \"text\",\n              inputType: \"text\",\n              inputVariable: \"position_title\",\n              minLength: 3,\n              maxLength: 150,\n              inputTimeout: 300,\n              inputRequired: true,\n              allowSkip: false,\n              saveToDatabase: true,\n              inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –¥–æ–ª–∂–Ω–æ—Å—Ç—å (–º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞)\",\n              inputSuccessMessage: \"‚úÖ –î–æ–ª–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞\",\n              placeholder: \"–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏\",\n              successTarget: \"department-choice\",\n              errorTarget: \"position-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"position-error\",\n            type: \"message\",\n            position: { x: 950, y: 250 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–í–û–î–ê –î–û–õ–ñ–ù–û–°–¢–ò\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏.\\n\\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\\n‚Ä¢ –ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞\\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 150 —Å–∏–º–≤–æ–ª–æ–≤\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-position\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"position-info\"\n                },\n                {\n                  id: \"skip-position\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"department-choice\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"department-choice\",\n            type: \"user-input\",\n            position: { x: 700, y: 400 },\n            data: {\n              messageText: \"üè¢ –†–ê–ó–î–ï–õ 3: –û–¢–î–ï–õ/–ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–ï\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –æ—Ç–¥–µ–ª:\\n\\n–ï—Å–ª–∏ –≤–∞—à–µ–≥–æ –æ—Ç–¥–µ–ª–∞ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, –≤—ã–±–µ—Ä–∏—Ç–µ \\\"–î—Ä—É–≥–æ–µ\\\"\",\n              responseType: \"buttons\",\n              responseOptions: [\n                {\n                  id: \"dept-it\",\n                  text: \"üíª IT-–æ—Ç–¥–µ–ª\",\n                  value: \"IT\"\n                },\n                {\n                  id: \"dept-sales\",\n                  text: \"üìà –û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂\",\n                  value: \"sales\"\n                },\n                {\n                  id: \"dept-marketing\",\n                  text: \"üì¢ –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥\",\n                  value: \"marketing\"\n                },\n                {\n                  id: \"dept-hr\",\n                  text: \"üë• HR-–æ—Ç–¥–µ–ª\",\n                  value: \"hr\"\n                },\n                {\n                  id: \"dept-finance\",\n                  text: \"üí∞ –§–∏–Ω–∞–Ω—Å—ã\",\n                  value: \"finance\"\n                },\n                {\n                  id: \"dept-operations\",\n                  text: \"‚öôÔ∏è –û–ø–µ—Ä–∞—Ü–∏–∏\",\n                  value: \"operations\"\n                },\n                {\n                  id: \"dept-management\",\n                  text: \"üëî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ\",\n                  value: \"management\"\n                },\n                {\n                  id: \"dept-other\",\n                  text: \"üìã –î—Ä—É–≥–æ–µ\",\n                  value: \"other\"\n                }\n              ],\n              allowMultipleSelection: false,\n              inputVariable: \"department\",\n              isRequired: true,\n              saveToDatabase: true,\n              successTarget: \"experience-level\",\n              errorTarget: \"department-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"department-error\",\n            type: \"message\",\n            position: { x: 950, y: 400 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–´–ë–û–†–ê –û–¢–î–ï–õ–ê\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –æ—Ç–¥–µ–ª –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-department\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—ã–±–æ—Ä\",\n                  action: \"goto\",\n                  target: \"department-choice\"\n                },\n                {\n                  id: \"skip-department\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"experience-level\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"experience-level\",\n            type: \"user-input\",\n            position: { x: 700, y: 550 },\n            data: {\n              messageText: \"‚≠ê –†–ê–ó–î–ï–õ 4: –û–ü–´–¢ –†–ê–ë–û–¢–´\\n\\n–£–∫–∞–∂–∏—Ç–µ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞:\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç\",\n              responseType: \"buttons\",\n              responseOptions: [\n                {\n                  id: \"exp-junior\",\n                  text: \"üå± –ù–∞—á–∏–Ω–∞—é—â–∏–π (0-2 –≥–æ–¥–∞)\",\n                  value: \"junior\"\n                },\n                {\n                  id: \"exp-middle\",\n                  text: \"üíº –°—Ä–µ–¥–Ω–∏–π (2-5 –ª–µ—Ç)\",\n                  value: \"middle\"\n                },\n                {\n                  id: \"exp-senior\",\n                  text: \"üéØ –°—Ç–∞—Ä—à–∏–π (5-10 –ª–µ—Ç)\",\n                  value: \"senior\"\n                },\n                {\n                  id: \"exp-lead\",\n                  text: \"üëë –í–µ–¥—É—â–∏–π (10+ –ª–µ—Ç)\",\n                  value: \"lead\"\n                },\n                {\n                  id: \"exp-executive\",\n                  text: \"üèÜ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å\",\n                  value: \"executive\"\n                }\n              ],\n              allowMultipleSelection: false,\n              inputVariable: \"experience_level\",\n              isRequired: true,\n              saveToDatabase: true,\n              successTarget: \"company-info\",\n              errorTarget: \"experience-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"experience-error\",\n            type: \"message\",\n            position: { x: 950, y: 550 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–´–ë–û–†–ê –û–ü–´–¢–ê\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-experience\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—ã–±–æ—Ä\",\n                  action: \"goto\",\n                  target: \"experience-level\"\n                },\n                {\n                  id: \"skip-experience\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"company-info\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"company-info\",\n            type: \"user-input\",\n            position: { x: 1100, y: 100 },\n            data: {\n              messageText: \"üè¢ –†–ê–ó–î–ï–õ 5: –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ö–û–ú–ü–ê–ù–ò–ò\\n\\n–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏:\\n\\n–ü—Ä–∏–º–µ—Ä: –û–û–û \\\"–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è\\\" / –ê–û \\\"–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏\\\" / –ò–ü –ò–≤–∞–Ω–æ–≤ –ò.–ò.\\n\\nüìù –ü–æ–ª–Ω–æ–µ –∏–ª–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ\",\n              responseType: \"text\",\n              inputType: \"text\",\n              inputVariable: \"company_name\",\n              minLength: 2,\n              maxLength: 200,\n              inputTimeout: 300,\n              inputRequired: true,\n              allowSkip: false,\n              saveToDatabase: true,\n              inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)\",\n              inputSuccessMessage: \"‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ\",\n              placeholder: \"–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏\",\n              successTarget: \"company-size\",\n              errorTarget: \"company-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"company-error\",\n            type: \"message\",\n            position: { x: 1350, y: 100 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–í–û–î–ê –ö–û–ú–ü–ê–ù–ò–ò\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏.\\n\\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\\n‚Ä¢ –ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞\\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-company\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"company-info\"\n                },\n                {\n                  id: \"skip-company\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"company-size\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"company-size\",\n            type: \"user-input\",\n            position: { x: 1100, y: 250 },\n            data: {\n              messageText: \"üìä –†–ê–ó–î–ï–õ 6: –†–ê–ó–ú–ï–† –ö–û–ú–ü–ê–ù–ò–ò\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏:\\n\\n–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤\",\n              responseType: \"buttons\",\n              responseOptions: [\n                {\n                  id: \"size-micro\",\n                  text: \"üë§ –ú–∏–∫—Ä–æ (1-10 —á–µ–ª–æ–≤–µ–∫)\",\n                  value: \"micro\"\n                },\n                {\n                  id: \"size-small\",\n                  text: \"üë• –ú–∞–ª–∞—è (11-50 —á–µ–ª–æ–≤–µ–∫)\",\n                  value: \"small\"\n                },\n                {\n                  id: \"size-medium\",\n                  text: \"üè¢ –°—Ä–µ–¥–Ω—è—è (51-250 —á–µ–ª–æ–≤–µ–∫)\",\n                  value: \"medium\"\n                },\n                {\n                  id: \"size-large\",\n                  text: \"üè¨ –ë–æ–ª—å—à–∞—è (251-1000 —á–µ–ª–æ–≤–µ–∫)\",\n                  value: \"large\"\n                },\n                {\n                  id: \"size-enterprise\",\n                  text: \"üè≠ –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏—è (1000+ —á–µ–ª–æ–≤–µ–∫)\",\n                  value: \"enterprise\"\n                }\n              ],\n              allowMultipleSelection: false,\n              inputVariable: \"company_size\",\n              isRequired: true,\n              saveToDatabase: true,\n              successTarget: \"project-info\",\n              errorTarget: \"size-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"size-error\",\n            type: \"message\",\n            position: { x: 1350, y: 250 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–´–ë–û–†–ê –†–ê–ó–ú–ï–†–ê\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-size\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—ã–±–æ—Ä\",\n                  action: \"goto\",\n                  target: \"company-size\"\n                },\n                {\n                  id: \"skip-size\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"project-info\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"project-info\",\n            type: \"user-input\",\n            position: { x: 1100, y: 400 },\n            data: {\n              messageText: \"üìã –†–ê–ó–î–ï–õ 7: –¢–ï–ö–£–©–ò–ï –ü–†–û–ï–ö–¢–´\\n\\n–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã:\\n\\n–ü—Ä–∏–º–µ—Ä: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ CRM-—Å–∏—Å—Ç–µ–º—ã, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤\\n\\nüìù –£–∫–∞–∂–∏—Ç–µ 2-3 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞\",\n              responseType: \"text\",\n              inputType: \"text\",\n              inputVariable: \"current_projects\",\n              minLength: 10,\n              maxLength: 1000,\n              inputTimeout: 600,\n              inputRequired: true,\n              allowSkip: true,\n              saveToDatabase: true,\n              inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã –ø–æ–¥—Ä–æ–±–Ω–µ–µ (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤)\",\n              inputSuccessMessage: \"‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–∞—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞\",\n              placeholder: \"–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤...\",\n              successTarget: \"goals-objectives\",\n              errorTarget: \"project-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"project-error\",\n            type: \"message\",\n            position: { x: 1350, y: 400 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–í–û–î–ê –ü–†–û–ï–ö–¢–û–í\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ.\\n\\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\\n‚Ä¢ –ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤\\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-project\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"project-info\"\n                },\n                {\n                  id: \"skip-project\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"goals-objectives\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"goals-objectives\",\n            type: \"user-input\",\n            position: { x: 1100, y: 550 },\n            data: {\n              messageText: \"üéØ –†–ê–ó–î–ï–õ 8: –¶–ï–õ–ò –ò –ó–ê–î–ê–ß–ò\\n\\n–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏:\\n\\n–ü—Ä–∏–º–µ—Ä: –†–∞–∑–≤–∏—Ç–∏–µ –≤ –æ–±–ª–∞—Å—Ç–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ —Ç–∏–º–ª–∏–¥–∞\\n\\nüìù –£–∫–∞–∂–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏\",\n              responseType: \"text\",\n              inputType: \"text\",\n              inputVariable: \"professional_goals\",\n              minLength: 10,\n              maxLength: 800,\n              inputTimeout: 600,\n              inputRequired: true,\n              allowSkip: true,\n              saveToDatabase: true,\n              inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ —Ü–µ–ª–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤)\",\n              inputSuccessMessage: \"‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã\",\n              placeholder: \"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏...\",\n              successTarget: \"contact-info\",\n              errorTarget: \"goals-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"goals-error\",\n            type: \"message\",\n            position: { x: 1350, y: 550 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–í–û–î–ê –¶–ï–õ–ï–ô\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ —Ü–µ–ª–∏ –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ.\\n\\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\\n‚Ä¢ –ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤\\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 800 —Å–∏–º–≤–æ–ª–æ–≤\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-goals\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"goals-objectives\"\n                },\n                {\n                  id: \"skip-goals\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"contact-info\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"contact-info\",\n            type: \"user-input\",\n            position: { x: 1500, y: 100 },\n            data: {\n              messageText: \"üìû –†–ê–ó–î–ï–õ 9: –ö–û–ù–¢–ê–ö–¢–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø\\n\\n–£–∫–∞–∂–∏—Ç–µ –≤–∞—à —Ä–∞–±–æ—á–∏–π email:\\n\\n–ü—Ä–∏–º–µ—Ä: ivan.ivanov@company.com\\n\\nüìß –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π email –¥–ª—è —Å–≤—è–∑–∏\",\n              responseType: \"text\",\n              inputType: \"email\",\n              inputVariable: \"work_email\",\n              minLength: 5,\n              maxLength: 150,\n              inputTimeout: 300,\n              inputRequired: true,\n              allowSkip: false,\n              saveToDatabase: true,\n              inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å\",\n              inputSuccessMessage: \"‚úÖ Email —Å–æ—Ö—Ä–∞–Ω–µ–Ω\",\n              placeholder: \"email@company.com\",\n              successTarget: \"phone-info\",\n              errorTarget: \"contact-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"contact-error\",\n            type: \"message\",\n            position: { x: 1750, y: 100 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–í–û–î–ê EMAIL\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å.\\n\\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\\n‚Ä¢ –§–æ—Ä–º–∞—Ç: name@domain.com\\n‚Ä¢ –ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤\\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 150 —Å–∏–º–≤–æ–ª–æ–≤\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-contact\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"contact-info\"\n                },\n                {\n                  id: \"skip-contact\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"phone-info\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"phone-info\",\n            type: \"user-input\",\n            position: { x: 1500, y: 250 },\n            data: {\n              messageText: \"üì± –†–ê–ó–î–ï–õ 10: –¢–ï–õ–ï–§–û–ù\\n\\n–£–∫–∞–∂–∏—Ç–µ –≤–∞—à —Ä–∞–±–æ—á–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω:\\n\\n–ü—Ä–∏–º–µ—Ä: +7 (999) 123-45-67\\n\\nüìû –†–∞–±–æ—á–∏–π –∏–ª–∏ –º–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏\",\n              responseType: \"text\",\n              inputType: \"phone\",\n              inputVariable: \"work_phone\",\n              minLength: 10,\n              maxLength: 20,\n              inputTimeout: 300,\n              inputRequired: true,\n              allowSkip: true,\n              saveToDatabase: true,\n              inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞\",\n              inputSuccessMessage: \"‚úÖ –¢–µ–ª–µ—Ñ–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω\",\n              placeholder: \"+7 (999) 123-45-67\",\n              successTarget: \"additional-info\",\n              errorTarget: \"phone-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"phone-error\",\n            type: \"message\",\n            position: { x: 1750, y: 250 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –í–í–û–î–ê –¢–ï–õ–ï–§–û–ù–ê\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.\\n\\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\\n‚Ä¢ –§–æ—Ä–º–∞—Ç: +7 (999) 123-45-67\\n‚Ä¢ –ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤\\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-phone\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"phone-info\"\n                },\n                {\n                  id: \"skip-phone\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"additional-info\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"additional-info\",\n            type: \"user-input\",\n            position: { x: 1500, y: 400 },\n            data: {\n              messageText: \"üìù –†–ê–ó–î–ï–õ 11: –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø\\n\\n–ï—Å—Ç—å –ª–∏ —á—Ç–æ-—Ç–æ –µ—â–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –¥–æ–±–∞–≤–∏—Ç—å?\\n\\n–ü—Ä–∏–º–µ—Ä: –ù–∞–≤—ã–∫–∏, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é\\n\\nüí° –õ—é–±–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å –∏–ª–∏ –≤–∞—à–µ–π —Ä–∞–±–æ—Ç–µ\",\n              responseType: \"text\",\n              inputType: \"text\",\n              inputVariable: \"additional_notes\",\n              minLength: 0,\n              maxLength: 1000,\n              inputTimeout: 600,\n              inputRequired: false,\n              allowSkip: true,\n              saveToDatabase: true,\n              inputRetryMessage: \"–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ –¥–æ 1000 —Å–∏–º–≤–æ–ª–æ–≤\",\n              inputSuccessMessage: \"‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞\",\n              placeholder: \"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)...\",\n              successTarget: \"final-review\",\n              errorTarget: \"additional-error\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"additional-error\",\n            type: \"message\",\n            position: { x: 1750, y: 400 },\n            data: {\n              messageText: \"‚ùå –û–®–ò–ë–ö–ê –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ô –ò–ù–§–û–†–ú–ê–¶–ò–ò\\n\\n–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.\\n\\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"retry-additional\",\n                  text: \"üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–≤–æ–¥\",\n                  action: \"goto\",\n                  target: \"additional-info\"\n                },\n                {\n                  id: \"skip-additional\",\n                  text: \"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\",\n                  action: \"goto\",\n                  target: \"final-review\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"final-review\",\n            type: \"message\",\n            position: { x: 1500, y: 550 },\n            data: {\n              messageText: \"üéâ –°–ë–û–† –ò–ù–§–û–†–ú–ê–¶–ò–ò –ó–ê–í–ï–†–®–ï–ù!\\n\\n‚úÖ –°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:\\n‚Ä¢ üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\\n‚Ä¢ üíº –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\\n‚Ä¢ üè¢ –î–∞–Ω–Ω—ã–µ –æ –∫–æ–º–ø–∞–Ω–∏–∏\\n‚Ä¢ üìä –ü—Ä–æ–µ–∫—Ç—ã –∏ —Ü–µ–ª–∏\\n‚Ä¢ üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\\n\\nüîÑ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:\\n‚Ä¢ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ\\n‚Ä¢ –í—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ email\\n‚Ä¢ –ú–æ–∂–µ—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è\\n\\n–°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"download-pdf\",\n                  text: \"üìÑ –°–∫–∞—á–∞—Ç—å PDF\",\n                  action: \"goto\",\n                  target: \"download-info\"\n                },\n                {\n                  id: \"send-email\",\n                  text: \"üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ email\",\n                  action: \"goto\",\n                  target: \"email-confirmation\"\n                },\n                {\n                  id: \"restart-process\",\n                  text: \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\",\n                  action: \"goto\",\n                  target: \"start-welcome\"\n                },\n                {\n                  id: \"main-menu\",\n                  text: \"üìã –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                  action: \"command\",\n                  target: \"/menu\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"download-info\",\n            type: \"message\",\n            position: { x: 1800, y: 450 },\n            data: {\n              messageText: \"üìÑ –°–ö–ê–ß–ò–í–ê–ù–ò–ï PDF –û–¢–ß–ï–¢–ê\\n\\nüîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç...\\n\\nüìä –û—Ç—á–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:\\n‚Ä¢ –í—Å–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\\n‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–∏–¥\\n‚Ä¢ Timestamp —Å–æ–∑–¥–∞–Ω–∏—è\\n‚Ä¢ –ü–æ–¥–ø–∏—Å—å —Å–∏—Å—Ç–µ–º—ã\\n\\n‚è±Ô∏è –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ 10-15 —Å–µ–∫—É–Ω–¥\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"pdf-ready\",\n                  text: \"‚úÖ PDF –≥–æ—Ç–æ–≤\",\n                  action: \"goto\",\n                  target: \"final-review\"\n                },\n                {\n                  id: \"back-to-review\",\n                  text: \"‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º\",\n                  action: \"goto\",\n                  target: \"final-review\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          },\n          {\n            id: \"email-confirmation\",\n            type: \"message\",\n            position: { x: 1800, y: 550 },\n            data: {\n              messageText: \"üìß –û–¢–ü–†–ê–í–ö–ê –ù–ê EMAIL\\n\\n‚úÖ –ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞:\\n{work_email}\\n\\nüì¨ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∏—Å—å–º–∞:\\n‚Ä¢ –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏\\n‚Ä¢ –°—Å—ã–ª–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\\n‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏\\n\\n‚è±Ô∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"email-sent\",\n                  text: \"‚úÖ –ü–æ–Ω—è—Ç–Ω–æ\",\n                  action: \"goto\",\n                  target: \"final-review\"\n                },\n                {\n                  id: \"resend-email\",\n                  text: \"üîÑ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ\",\n                  action: \"goto\",\n                  target: \"email-confirmation\"\n                }\n              ],\n              formatMode: \"none\",\n              formatMode: \"none\"\n            }\n          }\n        ],\n        connections: [\n          { id: \"conn-1\", source: \"start-welcome\", target: \"personal-info\" },\n          { id: \"conn-2\", source: \"start-welcome\", target: \"privacy-policy\" },\n          { id: \"conn-3\", source: \"start-welcome\", target: \"filling-instructions\" },\n          { id: \"conn-4\", source: \"privacy-policy\", target: \"personal-info\" },\n          { id: \"conn-5\", source: \"privacy-policy\", target: \"start-welcome\" },\n          { id: \"conn-6\", source: \"filling-instructions\", target: \"personal-info\" },\n          { id: \"conn-7\", source: \"filling-instructions\", target: \"start-welcome\" },\n          { id: \"conn-8\", source: \"personal-info\", target: \"position-info\" },\n          { id: \"conn-9\", source: \"personal-info\", target: \"personal-error\" },\n          { id: \"conn-10\", source: \"personal-error\", target: \"personal-info\" },\n          { id: \"conn-11\", source: \"personal-error\", target: \"position-info\" },\n          { id: \"conn-12\", source: \"position-info\", target: \"department-choice\" },\n          { id: \"conn-13\", source: \"position-info\", target: \"position-error\" },\n          { id: \"conn-14\", source: \"position-error\", target: \"position-info\" },\n          { id: \"conn-15\", source: \"position-error\", target: \"department-choice\" },\n          { id: \"conn-16\", source: \"department-choice\", target: \"experience-level\" },\n          { id: \"conn-17\", source: \"department-choice\", target: \"department-error\" },\n          { id: \"conn-18\", source: \"department-error\", target: \"department-choice\" },\n          { id: \"conn-19\", source: \"department-error\", target: \"experience-level\" },\n          { id: \"conn-20\", source: \"experience-level\", target: \"company-info\" },\n          { id: \"conn-21\", source: \"experience-level\", target: \"experience-error\" },\n          { id: \"conn-22\", source: \"experience-error\", target: \"experience-level\" },\n          { id: \"conn-23\", source: \"experience-error\", target: \"company-info\" },\n          { id: \"conn-24\", source: \"company-info\", target: \"company-size\" },\n          { id: \"conn-25\", source: \"company-info\", target: \"company-error\" },\n          { id: \"conn-26\", source: \"company-error\", target: \"company-info\" },\n          { id: \"conn-27\", source: \"company-error\", target: \"company-size\" },\n          { id: \"conn-28\", source: \"company-size\", target: \"project-info\" },\n          { id: \"conn-29\", source: \"company-size\", target: \"size-error\" },\n          { id: \"conn-30\", source: \"size-error\", target: \"company-size\" },\n          { id: \"conn-31\", source: \"size-error\", target: \"project-info\" },\n          { id: \"conn-32\", source: \"project-info\", target: \"goals-objectives\" },\n          { id: \"conn-33\", source: \"project-info\", target: \"project-error\" },\n          { id: \"conn-34\", source: \"project-error\", target: \"project-info\" },\n          { id: \"conn-35\", source: \"project-error\", target: \"goals-objectives\" },\n          { id: \"conn-36\", source: \"goals-objectives\", target: \"contact-info\" },\n          { id: \"conn-37\", source: \"goals-objectives\", target: \"goals-error\" },\n          { id: \"conn-38\", source: \"goals-error\", target: \"goals-objectives\" },\n          { id: \"conn-39\", source: \"goals-error\", target: \"contact-info\" },\n          { id: \"conn-40\", source: \"contact-info\", target: \"phone-info\" },\n          { id: \"conn-41\", source: \"contact-info\", target: \"contact-error\" },\n          { id: \"conn-42\", source: \"contact-error\", target: \"contact-info\" },\n          { id: \"conn-43\", source: \"contact-error\", target: \"phone-info\" },\n          { id: \"conn-44\", source: \"phone-info\", target: \"additional-info\" },\n          { id: \"conn-45\", source: \"phone-info\", target: \"phone-error\" },\n          { id: \"conn-46\", source: \"phone-error\", target: \"phone-info\" },\n          { id: \"conn-47\", source: \"phone-error\", target: \"additional-info\" },\n          { id: \"conn-48\", source: \"additional-info\", target: \"final-review\" },\n          { id: \"conn-49\", source: \"additional-info\", target: \"additional-error\" },\n          { id: \"conn-50\", source: \"additional-error\", target: \"additional-info\" },\n          { id: \"conn-51\", source: \"additional-error\", target: \"final-review\" },\n          { id: \"conn-52\", source: \"final-review\", target: \"download-info\" },\n          { id: \"conn-53\", source: \"final-review\", target: \"email-confirmation\" },\n          { id: \"conn-54\", source: \"final-review\", target: \"start-welcome\" },\n          { id: \"conn-55\", source: \"download-info\", target: \"final-review\" },\n          { id: \"conn-56\", source: \"email-confirmation\", target: \"final-review\" },\n          { id: \"conn-57\", source: \"email-confirmation\", target: \"email-confirmation\" }\n        ]\n      }\n    });\n\n    console.log('‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã');\n  } catch (error) {\n    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤:', error);\n  }\n}","size_bytes":119204},"server/seed-templates.ts":{"content":"import { storage } from \"./storage\";\n\n// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏\nasync function seedDefaultTemplates(force = false) {\n  try {\n    console.log(`üìã seedDefaultTemplates –≤—ã–∑–≤–∞–Ω —Å force=${force}`);\n    const existingTemplates = await storage.getAllBotTemplates();\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã\n    const systemTemplates = existingTemplates.filter(t => t.authorName === '–°–∏—Å—Ç–µ–º–∞');\n    console.log(`üìä –ù–∞–π–¥–µ–Ω–æ ${systemTemplates.length} —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤`);\n    \n    if (force) {\n      console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤...');\n      // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã\n      for (const template of systemTemplates) {\n        await storage.deleteBotTemplate(template.id);\n      }\n      console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ ${systemTemplates.length} —Å—Ç–∞—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤`);\n    } else if (systemTemplates.length >= 1) {\n      console.log('–°–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');\n      return;\n    }\n\n    // –°–æ–∑–¥–∞–µ–º —à–∞–±–ª–æ–Ω VProgulke Bot –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤\n    await storage.createBotTemplate({\n      name: \"üåü VProgulke Bot - –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞ –°–ü–±\",\n      description: \"–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –±–æ—Ç –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –¥–ª—è –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞–Ω–∫–µ—Ç–æ–π, —Å–∏—Å—Ç–µ–º–æ–π –º–µ—Ç—Ä–æ –∏ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏\",\n      category: \"community\",\n      tags: [\"–∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞\", \"–ø—Ä–æ—Ñ–∏–ª—å\", \"–º–µ—Ç—Ä–æ\", \"–∏–Ω—Ç–µ—Ä–µ—Å—ã\", \"–°–ü–±\", \"–∞–Ω–∫–µ—Ç–∞\", \"—á–∞—Ç\"],\n      isPublic: 1,\n      difficulty: \"hard\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"3.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 9,\n      estimatedTime: 45,\n      data: {\n        nodes: [\n          {\n            id: \"start\",\n            type: \"start\",\n            position: { x: 100, y: 50 },\n            data: {\n              command: \"/start\",\n              description: \"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫\",\n              messageText: \"üåü –ü—Ä–∏–≤–µ—Ç –æ—Ç ·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á Bot!\\n\\n–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ –Ω–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –ª—é–¥–µ–π –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ!\\n\\n–û—Ç–∫—É–¥–∞ —Ç—ã —É–∑–Ω–∞–ª –æ –Ω–∞—à–µ–º —á–∞—Ç–µ? üòé\",\n              synonyms: [\"—Å—Ç–∞—Ä—Ç\", \"–Ω–∞—á–∞—Ç—å\", \"–ø—Ä–∏–≤–µ—Ç\", \"–Ω–∞—á–∞–ª–æ\", \"–Ω–∞—á–∏–Ω–∞–µ–º\"],\n              keyboardType: \"none\",\n              buttons: [],\n              collectUserInput: true,\n              enableTextInput: true,\n              inputVariable: \"user_source\",\n              inputTargetNodeId: \"join_request\",\n              markdown: false,\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          },\n\n          {\n            id: \"join_request\",\n            type: \"message\",\n            position: { x: 100, y: 250 },\n            data: {\n              messageText: \"–•–æ—á–µ—à—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –Ω–∞—à–µ–º—É —á–∞—Ç—É? üöÄ\",\n              synonyms: [],\n              keyboardType: \"inline\",\n              collectUserInput: true,\n              inputVariable: \"join_request_response\",\n              buttons: [\n                {\n                  id: \"btn-yes\",\n                  text: \"–î–∞ üòé\",\n                  value: \"yes\",\n                  action: \"goto\",\n                  target: \"gender_selection\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-no\", \n                  text: \"–ù–µ—Ç üôÖ\",\n                  value: \"no\",\n                  action: \"goto\",\n                  target: \"decline_response\",\n                  buttonType: \"option\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: true,\n              resizeKeyboard: true\n            }\n          },\n\n          {\n            id: \"decline_response\",\n            type: \"message\",\n            position: { x: 100, y: 450 },\n            data: {\n              messageText: \"–ü–æ–Ω—è—Ç–Ω–æ! –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—à—å, –Ω–∞–ø–∏—à–∏ /start! üòä\",\n              synonyms: [],\n              keyboardType: \"none\",\n              removeKeyboard: true,\n              buttons: [],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"gender_selection\",\n            type: \"message\",\n            position: { x: 500, y: 250 },\n            data: {\n              messageText: \"–£–∫–∞–∂–∏ —Å–≤–æ–π –ø–æ–ª: üë®üë©\",\n              keyboardType: \"inline\",\n              collectUserInput: true,\n              inputVariable: \"gender\",\n              synonyms: [\"–ø–æ–ª\", \"–≥–µ–Ω–¥–µ—Ä\", \"–º—É–∂—á–∏–Ω–∞\", \"–∂–µ–Ω—â–∏–Ω–∞\"],\n              buttons: [\n                {\n                  id: \"btn-male\",\n                  text: \"–ú—É–∂—á–∏–Ω–∞ üë®\",\n                  value: \"male\",\n                  action: \"goto\",\n                  target: \"name_input\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-female\",\n                  text: \"–ñ–µ–Ω—â–∏–Ω–∞ üë©\",\n                  value: \"female\",\n                  action: \"goto\",\n                  target: \"name_input\",\n                  buttonType: \"option\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: true,\n              resizeKeyboard: true\n            }\n          },\n\n          {\n            id: \"name_input\",\n            type: \"message\",\n            position: { x: 900, y: 250 },\n            data: {\n              messageText: \"–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? ‚úèÔ∏è\\n\\n–ù–∞–ø–∏—à–∏ —Å–≤–æ—ë –∏–º—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:\",\n              keyboardType: \"none\",\n              collectUserInput: true,\n              enableTextInput: true,\n              inputVariable: \"user_name\",\n              synonyms: [\"–∏–º—è\", \"–∑–æ–≤—É—Ç\", \"–Ω–∞–∑—ã–≤–∞—é—Ç\", \"–∫–∞–∫ –∑–æ–≤—É—Ç\"],\n              inputTargetNodeId: \"age_input\",\n              buttons: [],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"age_input\",\n            type: \"message\",\n            position: { x: 1300, y: 250 },\n            data: {\n              messageText: \"–°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç? üéÇ\\n\\n–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç —á–∏—Å–ª–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 25):\",\n              keyboardType: \"none\",\n              collectUserInput: true,\n              enableTextInput: true,\n              inputVariable: \"user_age\",\n              synonyms: [\"–≤–æ–∑—Ä–∞—Å—Ç\", \"–ª–µ—Ç\", \"–≥–æ–¥—ã\", \"—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç\"],\n              inputTargetNodeId: \"metro_selection\",\n              buttons: [],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"metro_selection\",\n            type: \"message\",\n            position: { x: 100, y: 450 },\n            data: {\n              messageText: \"–ù–∞ –∫–∞–∫–æ–π —Å—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ —Ç—ã –æ–±—ã—á–Ω–æ –±—ã–≤–∞–µ—à—å? üöá\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é –≤–µ—Ç–∫—É:\",\n              keyboardType: \"inline\",\n              collectUserInput: true,\n              inputVariable: \"metro_stations\",\n              synonyms: [\"–º–µ—Ç—Ä–æ\", \"—Å—Ç–∞–Ω—Ü–∏—è\", \"–≥–¥–µ –∂–∏–≤—É\", \"—Ä–∞–π–æ–Ω\"],\n              buttons: [\n                {\n                  id: \"btn-red\",\n                  text: \"–ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\",\n                  action: \"goto\",\n                  target: \"red_line_stations\",\n                  buttonType: \"option\",\n                  skipDataCollection: true\n                },\n                {\n                  id: \"btn-blue\",\n                  text: \"–°–∏–Ω—è—è –≤–µ—Ç–∫–∞ üü¶\",\n                  action: \"goto\", \n                  target: \"blue_line_stations\",\n                  buttonType: \"option\",\n                  skipDataCollection: true\n                },\n                {\n                  id: \"btn-green\",\n                  text: \"–ó–µ–ª—ë–Ω–∞—è –≤–µ—Ç–∫–∞ üü©\",\n                  action: \"goto\",\n                  target: \"green_line_stations\",\n                  buttonType: \"option\",\n                  skipDataCollection: true\n                },\n                {\n                  id: \"btn-orange\",\n                  text: \"–û—Ä–∞–Ω–∂–µ–≤–∞—è –≤–µ—Ç–∫–∞ üüß\",\n                  action: \"goto\",\n                  target: \"orange_line_stations\",\n                  buttonType: \"option\",\n                  skipDataCollection: true\n                },\n                {\n                  id: \"btn-purple\",\n                  text: \"–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞ üü™\",\n                  action: \"goto\",\n                  target: \"purple_line_stations\",\n                  buttonType: \"option\",\n                  skipDataCollection: true\n                },\n                {\n                  id: \"btn-lo\",\n                  text: \"–Ø –∏–∑ –õ–û üè°\",\n                  value: \"–õ–û\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-not-spb\",\n                  text: \"–Ø –Ω–µ –≤ –ü–∏—Ç–µ—Ä–µ üåç\",\n                  value: \"–ù–µ –≤ –°–ü–±\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"option\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: true,\n              resizeKeyboard: true\n            }\n          },\n\n          // –ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ (–ö–∏—Ä–æ–≤—Å–∫–æ-–í—ã–±–æ—Ä–≥—Å–∫–∞—è) - —Å—Ç–∞–Ω—Ü–∏–∏\n          {\n            id: \"red_line_stations\",\n            type: \"message\",\n            position: { x: 1500, y: 450 },\n            data: {\n              messageText: \"üü• –ö–∏—Ä–æ–≤—Å–∫–æ-–í—ã–±–æ—Ä–≥—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n              synonyms: [\"–∫—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è\", \"–∫–∏—Ä–æ–≤—Å–∫–æ-–≤—ã–±–æ—Ä–≥—Å–∫–∞—è\", \"–∫—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"metro_stations\",\n              continueButtonTarget: \"interests_categories\",\n              buttons: [\n                { id: \"red-devyatkino\", text: \"üü• –î–µ–≤—è—Ç–∫–∏–Ω–æ\", action: \"selection\", target: \"devyatkino\", buttonType: \"option\" },\n                { id: \"red-grazhdansky\", text: \"üü• –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"grazhdansky\", buttonType: \"option\" },\n                { id: \"red-akademicheskaya\", text: \"üü• –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è\", action: \"selection\", target: \"akademicheskaya\", buttonType: \"option\" },\n                { id: \"red-politehnicheskaya\", text: \"üü• –ü–æ–ª–∏—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è\", action: \"selection\", target: \"politehnicheskaya\", buttonType: \"option\" },\n                { id: \"red-pl-muzhestva\", text: \"üü• –ü–ª–æ—â–∞–¥—å –ú—É–∂–µ—Å—Ç–≤–∞\", action: \"selection\", target: \"pl_muzhestva\", buttonType: \"option\" },\n                { id: \"red-lesnaya\", text: \"üü• –õ–µ—Å–Ω–∞—è\", action: \"selection\", target: \"lesnaya\", buttonType: \"option\" },\n                { id: \"red-vyborgskaya\", text: \"üü• –í—ã–±–æ—Ä–≥—Å–∫–∞—è\", action: \"selection\", target: \"vyborgskaya\", buttonType: \"option\" },\n                { id: \"red-pl-lenina\", text: \"üü• –ü–ª–æ—â–∞–¥—å –õ–µ–Ω–∏–Ω–∞\", action: \"selection\", target: \"pl_lenina\", buttonType: \"option\" },\n                { id: \"red-chernyshevskaya\", text: \"üü• –ß–µ—Ä–Ω—ã—à–µ–≤—Å–∫–∞—è\", action: \"selection\", target: \"chernyshevskaya\", buttonType: \"option\" },\n                { id: \"red-pl-vosstaniya\", text: \"üü• –ü–ª–æ—â–∞–¥—å –í–æ—Å—Å—Ç–∞–Ω–∏—è\", action: \"selection\", target: \"pl_vosstaniya\", buttonType: \"option\" },\n                { id: \"red-vladimirskaya\", text: \"üü• –í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è\", action: \"selection\", target: \"vladimirskaya\", buttonType: \"option\" },\n                { id: \"red-pushkinskaya\", text: \"üü• –ü—É—à–∫–∏–Ω—Å–∫–∞—è\", action: \"selection\", target: \"pushkinskaya\", buttonType: \"option\" },\n                { id: \"red-tehinstitut1\", text: \"üü• –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç–∏—Ç—É—Ç-1\", action: \"selection\", target: \"tehinstitut1\", buttonType: \"option\" },\n                { id: \"red-baltiyskaya\", text: \"üü• –ë–∞–ª—Ç–∏–π—Å–∫–∞—è\", action: \"selection\", target: \"baltiyskaya\", buttonType: \"option\" },\n                { id: \"red-narvskaya\", text: \"üü• –ù–∞—Ä–≤—Å–∫–∞—è\", action: \"selection\", target: \"narvskaya\", buttonType: \"option\" },\n                { id: \"red-kirovsky\", text: \"üü• –ö–∏—Ä–æ–≤—Å–∫–∏–π –∑–∞–≤–æ–¥\", action: \"selection\", target: \"kirovsky\", buttonType: \"option\" },\n                { id: \"red-avtovo\", text: \"üü• –ê–≤—Ç–æ–≤–æ\", action: \"selection\", target: \"avtovo\", buttonType: \"option\" },\n                { id: \"red-leninsky\", text: \"üü• –õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"leninsky\", buttonType: \"option\" },\n                { id: \"red-veteranov\", text: \"üü• –ü—Ä–æ—Å–ø–µ–∫—Ç –í–µ—Ç–µ—Ä–∞–Ω–æ–≤\", action: \"selection\", target: \"veteranov\", buttonType: \"option\" },\n                { id: \"btn-back-metro\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n              ],\n              markdown: false\n            }\n          },\n\n          // –°–∏–Ω—è—è –≤–µ—Ç–∫–∞ (–ú–æ—Å–∫–æ–≤—Å–∫–æ-–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è) - —Å—Ç–∞–Ω—Ü–∏–∏\n          {\n            id: \"blue_line_stations\",\n            type: \"message\",\n            position: { x: 1900, y: 450 },\n            data: {\n              messageText: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–æ-–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n              synonyms: [\"—Å–∏–Ω—è—è –ª–∏–Ω–∏—è\", \"–º–æ—Å–∫–æ–≤—Å–∫–æ-–ø–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è\", \"—Å–∏–Ω—è—è –≤–µ—Ç–∫–∞\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"metro_stations\",\n              continueButtonTarget: \"interests_categories\",\n              buttons: [\n                { id: \"blue-parnas\", text: \"üü¶ –ü–∞—Ä–Ω–∞—Å\", action: \"selection\", target: \"parnas\", buttonType: \"option\" },\n                { id: \"blue-prosp-prosvesh\", text: \"üü¶ –ü—Ä–æ—Å–ø–µ–∫—Ç –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è\", action: \"selection\", target: \"prosp_prosvesh\", buttonType: \"option\" },\n                { id: \"blue-ozerki\", text: \"üü¶ –û–∑–µ—Ä–∫–∏\", action: \"selection\", target: \"ozerki\", buttonType: \"option\" },\n                { id: \"blue-udelnaya\", text: \"üü¶ –£–¥–µ–ª—å–Ω–∞—è\", action: \"selection\", target: \"udelnaya\", buttonType: \"option\" },\n                { id: \"blue-pionerskaya\", text: \"üü¶ –ü–∏–æ–Ω–µ—Ä—Å–∫–∞—è\", action: \"selection\", target: \"pionerskaya\", buttonType: \"option\" },\n                { id: \"blue-chernaya\", text: \"üü¶ –ß–µ—Ä–Ω–∞—è —Ä–µ—á–∫–∞\", action: \"selection\", target: \"chernaya\", buttonType: \"option\" },\n                { id: \"blue-petrogradskaya\", text: \"üü¶ –ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è\", action: \"selection\", target: \"petrogradskaya\", buttonType: \"option\" },\n                { id: \"blue-gorkovskaya\", text: \"üü¶ –ì–æ—Ä—å–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"gorkovskaya\", buttonType: \"option\" },\n                { id: \"blue-nevsky\", text: \"üü¶ –ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"nevsky\", buttonType: \"option\" },\n                { id: \"blue-sennaya\", text: \"üü¶ –°–µ–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å\", action: \"selection\", target: \"sennaya\", buttonType: \"option\" },\n                { id: \"blue-tehinstitut2\", text: \"üü¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç–∏—Ç—É—Ç-2\", action: \"selection\", target: \"tehinstitut2\", buttonType: \"option\" },\n                { id: \"blue-frunzenskaya\", text: \"üü¶ –§—Ä—É–Ω–∑–µ–Ω—Å–∫–∞—è\", action: \"selection\", target: \"frunzenskaya\", buttonType: \"option\" },\n                { id: \"blue-mosk-vorota\", text: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–∏–µ –≤–æ—Ä–æ—Ç–∞\", action: \"selection\", target: \"mosk_vorota\", buttonType: \"option\" },\n                { id: \"blue-elektrosila\", text: \"üü¶ –≠–ª–µ–∫—Ç—Ä–æ—Å–∏–ª–∞\", action: \"selection\", target: \"elektrosila\", buttonType: \"option\" },\n                { id: \"blue-park-pobedy\", text: \"üü¶ –ü–∞—Ä–∫ –ü–æ–±–µ–¥—ã\", action: \"selection\", target: \"park_pobedy\", buttonType: \"option\" },\n                { id: \"blue-moskovskaya\", text: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"moskovskaya\", buttonType: \"option\" },\n                { id: \"blue-zvezdnaya\", text: \"üü¶ –ó–≤–µ–∑–¥–Ω–∞—è\", action: \"selection\", target: \"zvezdnaya\", buttonType: \"option\" },\n                { id: \"blue-kupchino\", text: \"üü¶ –ö—É–ø—á–∏–Ω–æ\", action: \"selection\", target: \"kupchino\", buttonType: \"option\" },\n                { id: \"btn-back-metro-blue\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n              ],\n              markdown: false\n            }\n          },\n\n          // –ó–µ–ª—ë–Ω–∞—è –≤–µ—Ç–∫–∞ (–ù–µ–≤—Å–∫–æ-–í–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è) - —Å—Ç–∞–Ω—Ü–∏–∏\n          {\n            id: \"green_line_stations\",\n            type: \"message\",\n            position: { x: 2300, y: 450 },\n            data: {\n              messageText: \"üü© –ù–µ–≤—Å–∫–æ-–í–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n              synonyms: [\"–∑–µ–ª–µ–Ω–∞—è –ª–∏–Ω–∏—è\", \"–Ω–µ–≤—Å–∫–æ-–≤–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è\", \"–∑–µ–ª–µ–Ω–∞—è –≤–µ—Ç–∫–∞\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"metro_stations\",\n              continueButtonTarget: \"interests_categories\",\n              buttons: [\n                { id: \"green-primorskaya\", text: \"üü© –ü—Ä–∏–º–æ—Ä—Å–∫–∞—è\", action: \"selection\", target: \"primorskaya\", buttonType: \"option\" },\n                { id: \"green-vasileostr\", text: \"üü© –í–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"vasileostr\", buttonType: \"option\" },\n                { id: \"green-gostiny\", text: \"üü© –ì–æ—Å—Ç–∏–Ω—ã–π –¥–≤–æ—Ä\", action: \"selection\", target: \"gostiny\", buttonType: \"option\" },\n                { id: \"green-mayakovskaya\", text: \"üü© –ú–∞—è–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"mayakovskaya\", buttonType: \"option\" },\n                { id: \"green-pl-nevsk\", text: \"üü© –ü–ª–æ—â–∞–¥—å –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ù–µ–≤—Å–∫–æ–≥–æ-1\", action: \"selection\", target: \"pl_nevsk\", buttonType: \"option\" },\n                { id: \"green-elizarovskaya\", text: \"üü© –ï–ª–∏–∑–∞—Ä–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"elizarovskaya\", buttonType: \"option\" },\n                { id: \"green-lomonosovskaya\", text: \"üü© –õ–æ–º–æ–Ω–æ—Å–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"lomonosovskaya\", buttonType: \"option\" },\n                { id: \"green-proletarskaya\", text: \"üü© –ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∞—è\", action: \"selection\", target: \"proletarskaya\", buttonType: \"option\" },\n                { id: \"green-obuhovo\", text: \"üü© –û–±—É—Ö–æ–≤–æ\", action: \"selection\", target: \"obuhovo\", buttonType: \"option\" },\n                { id: \"green-rybackoe\", text: \"üü© –†—ã–±–∞—Ü–∫–æ–µ\", action: \"selection\", target: \"rybackoe\", buttonType: \"option\" },\n                { id: \"green-novokrestovsk\", text: \"üü© –ù–æ–≤–æ–∫—Ä–µ—Å—Ç–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"novokrestovsk\", buttonType: \"option\" },\n                { id: \"green-begovaya\", text: \"üü© –ë–µ–≥–æ–≤–∞—è\", action: \"selection\", target: \"begovaya\", buttonType: \"option\" },\n                { id: \"btn-back-metro-green\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n              ],\n              markdown: false\n            }\n          },\n\n          // –û—Ä–∞–Ω–∂–µ–≤–∞—è –≤–µ—Ç–∫–∞ (–ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω–∞—è) - —Å—Ç–∞–Ω—Ü–∏–∏\n          {\n            id: \"orange_line_stations\",\n            type: \"message\",\n            position: { x: 2700, y: 450 },\n            data: {\n              messageText: \"üüß –ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n              synonyms: [\"–æ—Ä–∞–Ω–∂–µ–≤–∞—è –ª–∏–Ω–∏—è\", \"–ø—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω–∞—è\", \"–æ—Ä–∞–Ω–∂–µ–≤–∞—è –≤–µ—Ç–∫–∞\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"metro_stations\",\n              continueButtonTarget: \"interests_categories\",\n              buttons: [\n                { id: \"orange-spasskaya\", text: \"üüß –°–ø–∞—Å—Å–∫–∞—è\", action: \"selection\", target: \"spasskaya\", buttonType: \"option\" },\n                { id: \"orange-dostoevskaya\", text: \"üüß –î–æ—Å—Ç–æ–µ–≤—Å–∫–∞—è\", action: \"selection\", target: \"dostoevskaya\", buttonType: \"option\" },\n                { id: \"orange-ligovsky\", text: \"üüß –õ–∏–≥–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"ligovsky\", buttonType: \"option\" },\n                { id: \"orange-pl-nevsk2\", text: \"üüß –ü–ª–æ—â–∞–¥—å –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ù–µ–≤—Å–∫–æ–≥–æ-2\", action: \"selection\", target: \"pl_nevsk2\", buttonType: \"option\" },\n                { id: \"orange-novocherk\", text: \"üüß –ù–æ–≤–æ—á–µ—Ä–∫–∞—Å—Å–∫–∞—è\", action: \"selection\", target: \"novocherk\", buttonType: \"option\" },\n                { id: \"orange-ladozhskaya\", text: \"üüß –õ–∞–¥–æ–∂—Å–∫–∞—è\", action: \"selection\", target: \"ladozhskaya\", buttonType: \"option\" },\n                { id: \"orange-bolshevikov\", text: \"üüß –ü—Ä–æ—Å–ø–µ–∫—Ç –ë–æ–ª—å—à–µ–≤–∏–∫–æ–≤\", action: \"selection\", target: \"bolshevikov\", buttonType: \"option\" },\n                { id: \"orange-dybenko\", text: \"üüß –î—ã–±–µ–Ω–∫–æ\", action: \"selection\", target: \"dybenko\", buttonType: \"option\" },\n                { id: \"orange-gorny\", text: \"üüß –ì–æ—Ä–Ω—ã–π –∏–Ω—Å—Ç–∏—Ç—É—Ç\", action: \"selection\", target: \"gorny\", buttonType: \"option\" },\n                { id: \"btn-back-metro-orange\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n              ],\n              markdown: false\n            }\n          },\n\n          // –§–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞ (–§—Ä—É–Ω–∑–µ–Ω—Å–∫–æ-–ü—Ä–∏–º–æ—Ä—Å–∫–∞—è) - —Å—Ç–∞–Ω—Ü–∏–∏\n          {\n            id: \"purple_line_stations\",\n            type: \"message\",\n            position: { x: 3100, y: 450 },\n            data: {\n              messageText: \"üü™ –§—Ä—É–Ω–∑–µ–Ω—Å–∫–æ-–ü—Ä–∏–º–æ—Ä—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n              synonyms: [\"—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è\", \"—Ñ—Ä—É–Ω–∑–µ–Ω—Å–∫–æ-–ø—Ä–∏–º–æ—Ä—Å–∫–∞—è\", \"—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"metro_stations\",\n              continueButtonTarget: \"interests_categories\",\n              buttons: [\n                { id: \"purple-komendantsky\", text: \"üü™ –ö–æ–º–µ–Ω–¥–∞–Ω—Ç—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"komendantsky\", buttonType: \"option\" },\n                { id: \"purple-staraya\", text: \"üü™ –°—Ç–∞—Ä–∞—è –î–µ—Ä–µ–≤–Ω—è\", action: \"selection\", target: \"staraya\", buttonType: \"option\" },\n                { id: \"purple-krestovsky\", text: \"üü™ –ö—Ä–µ—Å—Ç–æ–≤—Å–∫–∏–π –æ—Å—Ç—Ä–æ–≤\", action: \"selection\", target: \"krestovsky\", buttonType: \"option\" },\n                { id: \"purple-chkalovskaya\", text: \"üü™ –ß–∫–∞–ª–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"chkalovskaya\", buttonType: \"option\" },\n                { id: \"purple-sportivnaya\", text: \"üü™ –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è\", action: \"selection\", target: \"sportivnaya\", buttonType: \"option\" },\n                { id: \"purple-admiralteyskaya\", text: \"üü™ –ê–¥–º–∏—Ä–∞–ª—Ç–µ–π—Å–∫–∞—è\", action: \"selection\", target: \"admiralteyskaya\", buttonType: \"option\" },\n                { id: \"purple-sadovaya\", text: \"üü™ –°–∞–¥–æ–≤–∞—è\", action: \"selection\", target: \"sadovaya\", buttonType: \"option\" },\n                { id: \"purple-zvenigorodskaya\", text: \"üü™ –ó–≤–µ–Ω–∏–≥–æ—Ä–æ–¥—Å–∫–∞—è\", action: \"selection\", target: \"zvenigorodskaya\", buttonType: \"option\" },\n                { id: \"purple-obvodniy\", text: \"üü™ –û–±–≤–æ–¥–Ω—ã–π –∫–∞–Ω–∞–ª\", action: \"selection\", target: \"obvodniy\", buttonType: \"option\" },\n                { id: \"purple-volkovskaya\", text: \"üü™ –í–æ–ª–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"volkovskaya\", buttonType: \"option\" },\n                { id: \"purple-buharestskaya\", text: \"üü™ –ë—É—Ö–∞—Ä–µ—Å—Ç—Å–∫–∞—è\", action: \"selection\", target: \"buharestskaya\", buttonType: \"option\" },\n                { id: \"purple-mezhdunar\", text: \"üü™ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è\", action: \"selection\", target: \"mezhdunar\", buttonType: \"option\" },\n                { id: \"purple-slavy\", text: \"üü™ –ü—Ä–æ—Å–ø–µ–∫—Ç –°–ª–∞–≤—ã\", action: \"selection\", target: \"slavy\", buttonType: \"option\" },\n                { id: \"purple-dunayskaya\", text: \"üü™ –î—É–Ω–∞–π—Å–∫–∞—è\", action: \"selection\", target: \"dunayskaya\", buttonType: \"option\" },\n                { id: \"purple-shushary\", text: \"üü™ –®—É—à–∞—Ä—ã\", action: \"selection\", target: \"shushary\", buttonType: \"option\" },\n                { id: \"btn-back-metro-purple\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"interests_categories\",\n            type: \"message\",\n            position: { x: 500, y: 450 },\n            data: {\n              messageText: \"–í—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ üéØ:\",\n              keyboardType: \"inline\",\n              synonyms: [\"–∏–Ω—Ç–µ—Ä–µ—Å—ã\", \"—Ö–æ–±–±–∏\", \"—É–≤–ª–µ—á–µ–Ω–∏—è\", \"–Ω—Ä–∞–≤–∏—Ç—Å—è\"],\n              buttons: [\n                {\n                  id: \"btn-hobby\",\n                  text: \"üéÆ –•–æ–±–±–∏\",\n                  action: \"goto\",\n                  target: \"hobby_interests\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-social\",\n                  text: \"üë• –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å\",\n                  action: \"goto\",\n                  target: \"social_interests\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-creativity\",\n                  text: \"üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ\", \n                  action: \"goto\",\n                  target: \"creativity_interests\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-active\",\n                  text: \"üèÉ –ê–∫—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏\",\n                  action: \"goto\",\n                  target: \"active_interests\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-food\",\n                  text: \"üçï –ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏\",\n                  action: \"goto\",\n                  target: \"food_interests\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-sport\",\n                  text: \"‚öΩ –°–ø–æ—Ä—Ç\",\n                  action: \"goto\",\n                  target: \"sport_interests\",\n                  buttonType: \"option\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"hobby_interests\",\n            type: \"message\",\n            position: { x: 900, y: 450 },\n            data: {\n              messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üéÆ –•–æ–±–±–∏:\",\n              synonyms: [\"—Ö–æ–±–±–∏\", \"—É–≤–ª–µ—á–µ–Ω–∏—è\", \"–∑–∞–Ω—è—Ç–∏—è\", \"–∏–≥—Ä—ã\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"user_interests\",\n              continueButtonTarget: \"marital_status\",\n              buttons: [\n                {\n                  id: \"hobby-games\",\n                  text: \"üéÆ –ö–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∏–≥—Ä—ã\",\n                  action: \"selection\",\n                  target: \"computer_games\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-fashion\",\n                  text: \"üíÑ –ú–æ–¥–∞ –∏ –∫—Ä–∞—Å–æ—Ç–∞\",\n                  action: \"selection\",\n                  target: \"fashion\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-cars\",\n                  text: \"üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–∏\",\n                  action: \"selection\",\n                  target: \"cars\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-it\",\n                  text: \"üíª IT –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\",\n                  action: \"selection\",\n                  target: \"it_tech\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-psychology\",\n                  text: \"üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è\",\n                  action: \"selection\",\n                  target: \"psychology\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-astrology\",\n                  text: \"üîÆ –ê—Å—Ç—Ä–æ–ª–æ–≥–∏—è\",\n                  action: \"selection\",\n                  target: \"astrology\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-meditation\",\n                  text: \"üßò –ú–µ–¥–∏—Ç–∞—Ü–∏–∏\",\n                  action: \"selection\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-books\",\n                  text: \"üìö –ö–Ω–∏–≥–∏\",\n                  action: \"selection\",\n                  target: \"books\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-anime\",\n                  text: \"üå∏ –ê–Ω–∏–º–µ\",\n                  action: \"selection\",\n                  target: \"anime\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"hobby-crypto\",\n                  text: \"üí∞ –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã\",\n                  action: \"selection\",\n                  target: \"crypto\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-back-categories\",\n                  text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"social_interests\",\n            type: \"message\",\n            position: { x: 1300, y: 450 },\n            data: {\n              messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üë• –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å:\",\n              synonyms: [\"–æ–±—â–µ–Ω–∏–µ\", \"—Å–æ—Ü–∏–∞–ª—å–Ω–æ–µ\", \"–ª—é–¥–∏\", \"—Ç—É—Å–æ–≤–∫–∏\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"user_interests\",\n              continueButtonTarget: \"marital_status\",\n              buttons: [\n                {\n                  id: \"social-parties\",\n                  text: \"üéâ –í–µ—á–µ—Ä–∏–Ω–∫–∏\",\n                  action: \"selection\",\n                  target: \"parties\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"social-networking\",\n                  text: \"ü§ù –ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥\",\n                  action: \"selection\",\n                  target: \"networking\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"social-dating\",\n                  text: \"üíï –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞\",\n                  action: \"selection\",\n                  target: \"dating\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"social-volunteering\",\n                  text: \"ü§≤ –í–æ–ª–æ–Ω—Ç—ë—Ä—Å—Ç–≤–æ\",\n                  action: \"selection\",\n                  target: \"volunteering\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"social-events\",\n                  text: \"üé™ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è\",\n                  action: \"selection\",\n                  target: \"events\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"social-community\",\n                  text: \"üë• –°–æ–æ–±—â–µ—Å—Ç–≤–∞\",\n                  action: \"selection\",\n                  target: \"community\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-back-categories-social\",\n                  text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"creativity_interests\",\n            type: \"message\",\n            position: { x: 100, y: 650 },\n            data: {\n              messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ:\",\n              synonyms: [\"—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ\", \"–∏—Å–∫—É—Å—Å—Ç–≤–æ\", \"—Ä–∏—Å–æ–≤–∞–Ω–∏–µ\", \"–º—É–∑—ã–∫–∞\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"user_interests\",\n              continueButtonTarget: \"marital_status\",\n              buttons: [\n                {\n                  id: \"creativity-art\",\n                  text: \"üé® –†–∏—Å–æ–≤–∞–Ω–∏–µ\",\n                  action: \"selection\",\n                  target: \"art\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"creativity-music\",\n                  text: \"üéµ –ú—É–∑—ã–∫–∞\",\n                  action: \"selection\",\n                  target: \"music\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"creativity-photography\",\n                  text: \"üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è\",\n                  action: \"selection\",\n                  target: \"photography\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"creativity-writing\",\n                  text: \"‚úçÔ∏è –ü–∏—Å–∞—Ç–µ–ª—å—Å—Ç–≤–æ\",\n                  action: \"selection\",\n                  target: \"writing\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"creativity-design\",\n                  text: \"üñåÔ∏è –î–∏–∑–∞–π–Ω\",\n                  action: \"selection\",\n                  target: \"design\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"creativity-handmade\",\n                  text: \"üß∂ –†—É–∫–æ–¥–µ–ª–∏–µ\",\n                  action: \"selection\",\n                  target: \"handmade\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"creativity-theater\",\n                  text: \"üé≠ –¢–µ–∞—Ç—Ä\",\n                  action: \"selection\",\n                  target: \"theater\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-back-categories-creativity\",\n                  text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"active_interests\",\n            type: \"message\",\n            position: { x: 500, y: 650 },\n            data: {\n              messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üèÉ –ê–∫—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏:\",\n              synonyms: [\"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\", \"–∞–∫—Ç–∏–≤–Ω—ã–π\", \"–¥–≤–∏–∂–µ–Ω–∏–µ\", \"–∑–¥–æ—Ä–æ–≤—å–µ\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"user_interests\",\n              continueButtonTarget: \"marital_status\",\n              buttons: [\n                {\n                  id: \"active-running\",\n                  text: \"üèÉ –ë–µ–≥\",\n                  action: \"selection\",\n                  target: \"running\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"active-gym\",\n                  text: \"üí™ –¢—Ä–µ–Ω–∞–∂—ë—Ä–Ω—ã–π –∑–∞–ª\",\n                  action: \"selection\",\n                  target: \"gym\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"active-cycling\",\n                  text: \"üö¥ –í–µ–ª–æ—Å–∏–ø–µ–¥\",\n                  action: \"selection\",\n                  target: \"cycling\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"active-hiking\",\n                  text: \"ü•æ –ü–æ—Ö–æ–¥—ã\",\n                  action: \"selection\",\n                  target: \"hiking\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"active-yoga\",\n                  text: \"üßò –ô–æ–≥–∞\",\n                  action: \"selection\",\n                  target: \"yoga\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"active-swimming\",\n                  text: \"üèä –ü–ª–∞–≤–∞–Ω–∏–µ\",\n                  action: \"selection\",\n                  target: \"swimming\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"active-dancing\",\n                  text: \"üíÉ –¢–∞–Ω—Ü—ã\",\n                  action: \"selection\",\n                  target: \"dancing\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-back-categories-active\",\n                  text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"food_interests\",\n            type: \"message\",\n            position: { x: 900, y: 650 },\n            data: {\n              messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üçï –ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏:\",\n              synonyms: [\"–µ–¥–∞\", \"–Ω–∞–ø–∏—Ç–∫–∏\", \"–∫—É—Ö–Ω—è\", \"—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"user_interests\",\n              continueButtonTarget: \"marital_status\",\n              buttons: [\n                {\n                  id: \"food-cooking\",\n                  text: \"üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∫–∞\",\n                  action: \"selection\",\n                  target: \"cooking\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"food-restaurants\",\n                  text: \"üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω—ã\",\n                  action: \"selection\",\n                  target: \"restaurants\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"food-wine\",\n                  text: \"üç∑ –í–∏–Ω–æ\",\n                  action: \"selection\",\n                  target: \"wine\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"food-coffee\",\n                  text: \"‚òï –ö–æ—Ñ–µ\",\n                  action: \"selection\",\n                  target: \"coffee\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"food-baking\",\n                  text: \"üßÅ –í—ã–ø–µ—á–∫–∞\",\n                  action: \"selection\",\n                  target: \"baking\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"food-street\",\n                  text: \"üåÆ –°—Ç—Ä–∏—Ç-—Ñ—É–¥\",\n                  action: \"selection\",\n                  target: \"street_food\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"food-healthy\",\n                  text: \"ü•ó –ó–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ\",\n                  action: \"selection\",\n                  target: \"healthy_food\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-back-categories-food\",\n                  text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"sport_interests\",\n            type: \"message\",\n            position: { x: 1300, y: 650 },\n            data: {\n              messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚öΩ –°–ø–æ—Ä—Ç:\",\n              synonyms: [\"—Å–ø–æ—Ä—Ç\", \"—Ñ–∏—Ç–Ω–µ—Å\", \"—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\", \"—Ñ—É—Ç–±–æ–ª\"],\n              keyboardType: \"inline\",\n              allowMultipleSelection: true,\n              multiSelectVariable: \"user_interests\",\n              continueButtonTarget: \"marital_status\",\n              buttons: [\n                {\n                  id: \"sport-football\",\n                  text: \"‚öΩ –§—É—Ç–±–æ–ª\",\n                  action: \"selection\",\n                  target: \"football\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"sport-basketball\",\n                  text: \"üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª\",\n                  action: \"selection\",\n                  target: \"basketball\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"sport-tennis\",\n                  text: \"üéæ –¢–µ–Ω–Ω–∏—Å\",\n                  action: \"selection\",\n                  target: \"tennis\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"sport-hockey\",\n                  text: \"üèí –•–æ–∫–∫–µ–π\",\n                  action: \"selection\",\n                  target: \"hockey\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"sport-volleyball\",\n                  text: \"üèê –í–æ–ª–µ–π–±–æ–ª\",\n                  action: \"selection\",\n                  target: \"volleyball\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"sport-mma\",\n                  text: \"ü•ä –ï–¥–∏–Ω–æ–±–æ—Ä—Å—Ç–≤–∞\",\n                  action: \"selection\",\n                  target: \"mma\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"sport-esports\",\n                  text: \"üéÆ –ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç\",\n                  action: \"selection\",\n                  target: \"esports\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-back-categories-sport\",\n                  text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"marital_status\",\n            type: \"message\",\n            position: { x: 1300, y: 450 },\n            data: {\n              messageText: \"–í—ã–±–µ—Ä–∏ —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ üíç:\",\n              keyboardType: \"inline\",\n              collectUserInput: true,\n              inputVariable: \"marital_status\",\n              synonyms: [\"—Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\", \"—Å—Ç–∞—Ç—É—Å\", \"–æ—Ç–Ω–æ—à–µ–Ω–∏—è\", \"—Å–µ–º—å—è\"],\n              buttons: [\n                {\n                  id: \"btn-single\",\n                  text: \"–í –∞–∫—Ç–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ ‚ù§Ô∏è\",\n                  value: \"single\",\n                  action: \"goto\",\n                  target: \"sexual_orientation\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-relationship\",\n                  text: \"–í –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö üíï\",\n                  value: \"relationship\",\n                  action: \"goto\",\n                  target: \"sexual_orientation\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-married\",\n                  text: \"–ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º üíí\",\n                  value: \"married\",\n                  action: \"goto\",\n                  target: \"sexual_orientation\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-complicated\",\n                  text: \"–í—Å—ë —Å–ª–æ–∂–Ω–æ ü§∑\",\n                  value: \"complicated\",\n                  action: \"goto\",\n                  target: \"sexual_orientation\",\n                  buttonType: \"option\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: true,\n              resizeKeyboard: true\n            }\n          },\n\n          {\n            id: \"sexual_orientation\",\n            type: \"message\",\n            position: { x: 100, y: 650 },\n            data: {\n              messageText: \"–£–∫–∞–∂–∏ —Å–≤–æ—é —Å–µ–∫—Å—É–∞–ª—å–Ω—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é üåà:\",\n              keyboardType: \"inline\",\n              collectUserInput: true,\n              inputVariable: \"sexual_orientation\",\n              synonyms: [\"–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è\", \"–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è\", \"–∫–æ–≥–æ –∏—â—É\"],\n              buttons: [\n                {\n                  id: \"btn-hetero\",\n                  text: \"–ì–µ—Ç–µ—Ä–æ üë´\",\n                  value: \"hetero\",\n                  action: \"goto\",\n                  target: \"channel_choice\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-gay\",\n                  text: \"–ì–µ–π üë¨\",\n                  value: \"gay\",\n                  action: \"goto\",\n                  target: \"channel_choice\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-lesbian\",\n                  text: \"–õ–µ—Å–±–∏ üë≠\",\n                  value: \"lesbian\",\n                  action: \"goto\",\n                  target: \"channel_choice\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-bi\",\n                  text: \"–ë–∏ üåà\",\n                  value: \"bi\",\n                  action: \"goto\",\n                  target: \"channel_choice\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-other\",\n                  text: \"–î—Ä—É–≥–æ–µ üí´\",\n                  value: \"other\",\n                  action: \"goto\",\n                  target: \"channel_choice\",\n                  buttonType: \"option\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: true,\n              resizeKeyboard: true\n            }\n          },\n\n          {\n            id: \"channel_choice\",\n            type: \"message\",\n            position: { x: 500, y: 650 },\n            data: {\n              messageText: \"–•–æ—á–µ—à—å —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–π —Ç–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª? üì¢\\n\\n–í–≤–µ–¥–∏ —Å—Å—ã–ª–∫—É, –Ω–∏–∫ —Å @ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏–º—è –∫–∞–Ω–∞–ª–∞, –ª–∏–±–æ –Ω–∞–∂–º–∏ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å':\",\n              keyboardType: \"inline\",\n              collectUserInput: true,\n              enableTextInput: true,\n              inputVariable: \"telegram_channel\",\n              synonyms: [\"—Ç–≥–∫\", \"—Ç–µ–ª–µ–≥—Ä–∞–º\", \"–∫–∞–Ω–∞–ª\", \"—Ç–≥ –∫–∞–Ω–∞–ª\"],\n              inputTargetNodeId: \"extra_info\",\n              buttons: [\n                {\n                  id: \"btn-skip-channel\",\n                  text: \"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚è≠Ô∏è\",\n                  action: \"goto\",\n                  target: \"extra_info\",\n                  buttonType: \"option\",\n                  skipDataCollection: true\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"extra_info\",\n            type: \"message\",\n            position: { x: 1300, y: 650 },\n            data: {\n              messageText: \"–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —á—Ç–æ-—Ç–æ –µ—â—ë –æ —Å–µ–±–µ? üìù\\n\\n–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ (–¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤) –∏–ª–∏ –Ω–∞–∂–º–∏ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å':\",\n              keyboardType: \"inline\",\n              collectUserInput: true,\n              enableTextInput: true,\n              inputVariable: \"extra_info\",\n              synonyms: [\"–æ —Å–µ–±–µ\", \"–æ–ø–∏—Å–∞–Ω–∏–µ\", \"—Ä–∞—Å—Å–∫–∞–∂–∏\", \"–∏–Ω—Ñ–æ\"],\n              inputTargetNodeId: \"profile_complete\",\n              buttons: [\n                {\n                  id: \"btn-skip-extra\",\n                  text: \"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚è≠Ô∏è\",\n                  action: \"goto\",\n                  target: \"profile_complete\",\n                  buttonType: \"option\",\n                  skipDataCollection: true\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"profile_complete\",\n            type: \"message\",\n            position: { x: 100, y: 850 },\n            data: {\n              messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n              synonyms: [],\n              keyboardType: \"inline\",\n              removeKeyboard: false,\n              enableConditionalMessages: true,\n              conditionalMessages: [\n                {\n                  id: \"with_both\",\n                  condition: \"user_data_exists\",\n                  variableNames: [\"telegram_channel\", \"extra_info\"],\n                  messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n–¢–µ–ª–µ–≥—Ä–∞–º: {telegram_channel} üì¢\\n–û —Å–µ–±–µ: {extra_info} üìù\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n                  formatMode: \"text\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-profile\",\n                      text: \"üìã –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∫–µ—Ç—É\",\n                      action: \"command\",\n                      target: \"/profile\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-chat-link\",\n                      text: \"üîó –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç\",\n                      action: \"goto\",\n                      target: \"chat_link\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  priority: 1\n                },\n                {\n                  id: \"with_telegram_only\",\n                  condition: \"user_data_exists\",\n                  variableNames: [\"telegram_channel\"],\n                  messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n–¢–µ–ª–µ–≥—Ä–∞–º: {telegram_channel} üì¢\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n                  formatMode: \"text\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-profile\",\n                      text: \"üìã –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∫–µ—Ç—É\",\n                      action: \"command\",\n                      target: \"/profile\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-chat-link\",\n                      text: \"üîó –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç\",\n                      action: \"goto\",\n                      target: \"chat_link\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  priority: 2\n                },\n                {\n                  id: \"with_extra_only\",\n                  condition: \"user_data_exists\",\n                  variableNames: [\"extra_info\"],\n                  messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n–û —Å–µ–±–µ: {extra_info} üìù\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n                  formatMode: \"text\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-profile\",\n                      text: \"üìã –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∫–µ—Ç—É\",\n                      action: \"command\",\n                      target: \"/profile\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-chat-link\",\n                      text: \"üîó –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç\",\n                      action: \"goto\",\n                      target: \"chat_link\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  priority: 3\n                }\n              ],\n              buttons: [\n                {\n                  id: \"btn-profile\",\n                  text: \"üìã –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∫–µ—Ç—É\",\n                  action: \"command\",\n                  target: \"/profile\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-chat-link\",\n                  text: \"üîó –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç\",\n                  action: \"goto\",\n                  target: \"chat_link\",\n                  buttonType: \"option\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"show_profile\",\n            type: \"command\",\n            position: { x: 500, y: 850 },\n            data: {\n              command: \"/profile\",\n              commandName: \"/profile\",\n              description: \"–ü–æ–∫–∞–∑–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\",\n              synonyms: [\"–ø—Ä–æ—Ñ–∏–ª—å\", \"–∞–Ω–∫–µ—Ç–∞\", \"–º–æ–π –ø—Ä–æ—Ñ–∏–ª—å\", \"–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å\", \"—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å\"],\n              messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n              keyboardType: \"inline\",\n              enableConditionalMessages: true,\n              conditionalMessages: [\n                {\n                  id: \"with_both_show\",\n                  condition: \"user_data_exists\",\n                  variableNames: [\"telegram_channel\", \"extra_info\"],\n                  messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n–¢–µ–ª–µ–≥—Ä–∞–º: {telegram_channel} üì¢\\n–û —Å–µ–±–µ: {extra_info} üìù\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                  formatMode: \"text\",\n                  keyboardType: \"inline\",\n                  buttons: [\n\n                    {\n                      id: \"btn-edit-gender\",\n                      text: \"üë®üë© –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª\",\n                      action: \"goto\",\n                      target: \"gender_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-name\",\n                      text: \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è\",\n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-age\",\n                      text: \"üéÇ –ò–∑–º–µ–Ω–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç\",\n                      action: \"goto\",\n                      target: \"age_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-metro\",\n                      text: \"üöá –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç—Ä–æ\",\n                      action: \"goto\",\n                      target: \"metro_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-interests\",\n                      text: \"üéØ –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-marital\",\n                      text: \"üíç –ò–∑–º–µ–Ω–∏—Ç—å —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\",\n                      action: \"goto\",\n                      target: \"marital_status\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-orientation\",\n                      text: \"üåà –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-channel\",\n                      text: \"üì¢ –ò–∑–º–µ–Ω–∏—Ç—å –¢–ì–ö\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-extra\",\n                      text: \"üìù –ò–∑–º–µ–Ω–∏—Ç—å –æ —Å–µ–±–µ\",\n                      action: \"goto\",\n                      target: \"extra_info\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-restart-from-profile\",\n                      text: \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\",\n                      action: \"command\",\n                      target: \"/start\",\n                      buttonType: \"navigation\"\n                    }\n                  ],\n                  priority: 1\n                },\n                {\n                  id: \"with_telegram_show\",\n                  condition: \"user_data_exists\",\n                  variableNames: [\"telegram_channel\"],\n                  messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n–¢–µ–ª–µ–≥—Ä–∞–º: {telegram_channel} üì¢\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                  formatMode: \"text\",\n                  keyboardType: \"inline\",\n                  buttons: [\n\n                    {\n                      id: \"btn-edit-gender\",\n                      text: \"üë®üë© –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª\",\n                      action: \"goto\",\n                      target: \"gender_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-name\",\n                      text: \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è\",\n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-age\",\n                      text: \"üéÇ –ò–∑–º–µ–Ω–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç\",\n                      action: \"goto\",\n                      target: \"age_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-metro\",\n                      text: \"üöá –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç—Ä–æ\",\n                      action: \"goto\",\n                      target: \"metro_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-interests\",\n                      text: \"üéØ –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-marital\",\n                      text: \"üíç –ò–∑–º–µ–Ω–∏—Ç—å —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\",\n                      action: \"goto\",\n                      target: \"marital_status\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-orientation\",\n                      text: \"üåà –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-channel\",\n                      text: \"üì¢ –ò–∑–º–µ–Ω–∏—Ç—å –¢–ì–ö\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-extra\",\n                      text: \"üìù –î–æ–±–∞–≤–∏—Ç—å –æ —Å–µ–±–µ\",\n                      action: \"goto\",\n                      target: \"extra_info\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-restart-from-profile\",\n                      text: \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\",\n                      action: \"command\",\n                      target: \"/start\",\n                      buttonType: \"navigation\"\n                    }\n                  ],\n                  priority: 2\n                },\n                {\n                  id: \"with_extra_show\",\n                  condition: \"user_data_exists\",\n                  variableNames: [\"extra_info\"],\n                  messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n–û —Å–µ–±–µ: {extra_info} üìù\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                  formatMode: \"text\",\n                  keyboardType: \"inline\",\n                  buttons: [\n\n                    {\n                      id: \"btn-edit-gender\",\n                      text: \"üë®üë© –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª\",\n                      action: \"goto\",\n                      target: \"gender_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-name\",\n                      text: \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è\",\n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-age\",\n                      text: \"üéÇ –ò–∑–º–µ–Ω–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç\",\n                      action: \"goto\",\n                      target: \"age_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-metro\",\n                      text: \"üöá –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç—Ä–æ\",\n                      action: \"goto\",\n                      target: \"metro_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-interests\",\n                      text: \"üéØ –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-marital\",\n                      text: \"üíç –ò–∑–º–µ–Ω–∏—Ç—å —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\",\n                      action: \"goto\",\n                      target: \"marital_status\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-orientation\",\n                      text: \"üåà –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-channel\",\n                      text: \"üì¢ –£–∫–∞–∑–∞—Ç—å –¢–ì–ö\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-extra\",\n                      text: \"üìù –ò–∑–º–µ–Ω–∏—Ç—å –æ —Å–µ–±–µ\",\n                      action: \"goto\",\n                      target: \"extra_info\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-restart-from-profile\",\n                      text: \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\",\n                      action: \"command\",\n                      target: \"/start\",\n                      buttonType: \"navigation\"\n                    }\n                  ],\n                  priority: 3\n                }\n              ],\n              buttons: [\n                {\n                  id: \"btn-edit-gender\",\n                  text: \"üë®üë© –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª\",\n                  action: \"goto\",\n                  target: \"gender_selection\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-edit-name\",\n                  text: \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è\",\n                  action: \"goto\",\n                  target: \"name_input\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-edit-age\",\n                  text: \"üéÇ –ò–∑–º–µ–Ω–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç\",\n                  action: \"goto\",\n                  target: \"age_input\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-edit-metro\",\n                  text: \"üöá –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç—Ä–æ\",\n                  action: \"goto\",\n                  target: \"metro_selection\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-edit-interests\",\n                  text: \"üéØ –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã\",\n                  action: \"goto\",\n                  target: \"interests_categories\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-edit-marital\",\n                  text: \"üíç –ò–∑–º–µ–Ω–∏—Ç—å —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\",\n                  action: \"goto\",\n                  target: \"marital_status\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-edit-orientation\",\n                  text: \"üåà –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é\",\n                  action: \"goto\",\n                  target: \"sexual_orientation\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-edit-channel\",\n                  text: \"üì¢ –£–∫–∞–∑–∞—Ç—å –¢–ì–ö\",\n                  action: \"goto\",\n                  target: \"channel_choice\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-edit-extra\",\n                  text: \"üìù –î–æ–±–∞–≤–∏—Ç—å –æ —Å–µ–±–µ\",\n                  action: \"goto\",\n                  target: \"extra_info\",\n                  buttonType: \"option\"\n                },\n                {\n                  id: \"btn-restart-from-profile\",\n                  text: \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\",\n                  action: \"command\",\n                  target: \"/start\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"chat_link\",\n            type: \"command\",\n            position: { x: 900, y: 850 },\n            data: {\n              command: \"/link\",\n              commandName: \"/link\",\n              description: \"–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞\",\n              synonyms: [\"—Å—Å—ã–ª–∫–∞\", \"—á–∞—Ç\", \"—Å–æ–æ–±—â–µ—Å—Ç–≤–æ\", \"–≤–ø—Ä–æ–≥—É–ª–∫–µ\", \"–ª–∏–Ω–∫\"],\n              messageText: \"üîó –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç:\\n\\nhttps://t.me/+agkIVgCzHtY2ZTA6\\n\\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ ·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á! üéâ\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-back-profile\",\n                  text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∞–Ω–∫–µ—Ç–µ\",\n                  action: \"command\",\n                  target: \"/profile\",\n                  buttonType: \"navigation\"\n                },\n                {\n                  id: \"btn-restart\",\n                  text: \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\",\n                  action: \"command\",\n                  target: \"/start\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: false\n            }\n          },\n\n          {\n            id: \"help_command\",\n            type: \"command\",\n            position: { x: 1300, y: 850 },\n            data: {\n              command: \"/help\",\n              commandName: \"/help\",\n              description: \"–ü–æ–º–æ—â—å –∏ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏\",\n              synonyms: [\"–ø–æ–º–æ—â—å\", \"—Å–ø—Ä–∞–≤–∫–∞\", \"–∫–æ–º–∞–Ω–¥—ã\", \"—á—Ç–æ –ø–∏—Å–∞—Ç—å\", \"–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è\"],\n              messageText: \"ü§ñ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä!**\\n\\nüåü **·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á Bot**\\n*–¢–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞—Ö*\\n\\n\\nüéØ **–û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´**\\n\\nüöÄ **Start** ‚Äî –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\\n   üìù *—Å—Ç–∞—Ä—Ç, –Ω–∞—á–∞—Ç—å, –ø—Ä–∏–≤–µ—Ç, –Ω–∞—á–∞–ª–æ, –Ω–∞—á–∏–Ω–∞–µ–º*\\n\\nüë§ **Profile** ‚Äî –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å\\n   üìù *–ø—Ä–æ—Ñ–∏–ª—å, –∞–Ω–∫–µ—Ç–∞, –º–æ–π –ø—Ä–æ—Ñ–∏–ª—å, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å*\\n\\nüîó **Link** ‚Äî –°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç\\n   üìù *—Å—Å—ã–ª–∫–∞, —á–∞—Ç, —Å–æ–æ–±—â–µ—Å—Ç–≤–æ, –≤–ø—Ä–æ–≥—É–ª–∫–µ, –ª–∏–Ω–∫*\\n\\nüÜò **Help** ‚Äî –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\\n   üìù *–ø–æ–º–æ—â—å, —Å–ø—Ä–∞–≤–∫–∞, –∫–æ–º–∞–Ω–¥—ã, —á—Ç–æ –ø–∏—Å–∞—Ç—å*\\n\\n\\nüìã **–ó–ê–ü–û–õ–ù–ï–ù–ò–ï –ê–ù–ö–ï–¢–´**\\n\\nüë´ **–ü–æ–ª** ‚Äî –º—É–∂—Å–∫–æ–π, –∂–µ–Ω—Å–∫–∏–π\\nüè∑Ô∏è **–ò–º—è** ‚Äî –ª—é–±–æ–µ –∏–º—è\\nüéÇ **–í–æ–∑—Ä–∞—Å—Ç** ‚Äî —á–∏—Å–ª–æ –æ—Ç 18 –¥–æ 99\\nüöá **–ú–µ—Ç—Ä–æ** ‚Äî –≤—ã–±–æ—Ä –ª–∏–Ω–∏–∏ –∏ —Å—Ç–∞–Ω—Ü–∏–∏\\n\\nüé® **–ò–ù–¢–ï–†–ï–°–´**\\nüéÆ –•–æ–±–±–∏ ‚Ä¢ ü§ù –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å ‚Ä¢ üé≠ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ\\nüí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Ä¢ üçï –ï–¥–∞ ‚Ä¢ ‚öΩ –°–ø–æ—Ä—Ç\\n\\nüíë **–°–ï–ú–ï–ô–ù–û–ï –ü–û–õ–û–ñ–ï–ù–ò–ï**\\n–ü–æ–∏—Å–∫ ‚Ä¢ –û—Ç–Ω–æ—à–µ–Ω–∏—è ‚Ä¢ –ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º ‚Ä¢ –°–ª–æ–∂–Ω–æ\\n\\nüåà **–û–†–ò–ï–ù–¢–ê–¶–ò–Ø**\\n–ì–µ—Ç–µ—Ä–æ ‚Ä¢ –ì–µ–π ‚Ä¢ –õ–µ—Å–±–∏ ‚Ä¢ –ë–∏ ‚Ä¢ –î—Ä—É–≥–æ–µ\\n\\nüì∫ **–¢–ï–õ–ï–ì–†–ê–ú-–ö–ê–ù–ê–õ** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\\nüìñ **–û –°–ï–ë–ï** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\\n\\n\\nüí° **–ü–û–õ–ï–ó–ù–´–ï –°–û–í–ï–¢–´**\\n\\n‚ú® –ü–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —Å–∏–Ω–æ–Ω–∏–º—ã –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ\\n‚ú® –ë–æ—Ç –ø–æ–π–º–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∞–∂–µ –±–µ–∑ –∫–æ–º–∞–Ω–¥\\n‚ú® –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–Ω–æ–≤–æ\\n‚ú® –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /profile –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö\\n\\nüéâ **–£–¥–∞—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –≤ –ü–∏—Ç–µ—Ä–µ!**\",\n              keyboardType: \"inline\",\n              buttons: [\n                {\n                  id: \"btn-help-start\",\n                  text: \"üöÄ –ù–∞—á–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ\",\n                  action: \"command\",\n                  target: \"/start\",\n                  buttonType: \"navigation\"\n                },\n                {\n                  id: \"btn-help-profile\",\n                  text: \"üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å\",\n                  action: \"command\",\n                  target: \"/profile\",\n                  buttonType: \"navigation\"\n                },\n                {\n                  id: \"btn-help-link\",\n                  text: \"üîó –°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç\",\n                  action: \"command\",\n                  target: \"/link\",\n                  buttonType: \"navigation\"\n                }\n              ],\n              markdown: true\n            }\n          }\n        ],\n        connections: [\n          {\n            id: \"conn-1\",\n            sourceNodeId: \"start\",\n            targetNodeId: \"join_request\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-2\",\n            sourceNodeId: \"join_request\",\n            targetNodeId: \"gender_selection\",\n            sourceHandle: \"btn-yes\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-3\",\n            sourceNodeId: \"join_request\",\n            targetNodeId: \"decline_response\",\n            sourceHandle: \"btn-no\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-4\",\n            sourceNodeId: \"gender_selection\",\n            targetNodeId: \"name_input\",\n            sourceHandle: \"btn-male\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-5\",\n            sourceNodeId: \"gender_selection\",\n            targetNodeId: \"name_input\",\n            sourceHandle: \"btn-female\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-6\",\n            sourceNodeId: \"name_input\",\n            targetNodeId: \"age_input\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-7\",\n            sourceNodeId: \"age_input\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          // Connections from metro_selection to different line stations\n          {\n            id: \"conn-8a\",\n            sourceNodeId: \"metro_selection\", \n            targetNodeId: \"red_line_stations\",\n            sourceHandle: \"btn-red\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8b\",\n            sourceNodeId: \"metro_selection\",\n            targetNodeId: \"blue_line_stations\", \n            sourceHandle: \"btn-blue\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8c\",\n            sourceNodeId: \"metro_selection\",\n            targetNodeId: \"green_line_stations\",\n            sourceHandle: \"btn-green\", \n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8d\",\n            sourceNodeId: \"metro_selection\",\n            targetNodeId: \"orange_line_stations\",\n            sourceHandle: \"btn-orange\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8e\",\n            sourceNodeId: \"metro_selection\",\n            targetNodeId: \"purple_line_stations\",\n            sourceHandle: \"btn-purple\",\n            targetHandle: \"target\"\n          },\n          // Direct connections to interests for –õ–û and non-SPb users\n          {\n            id: \"conn-8f\",\n            sourceNodeId: \"metro_selection\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-lo\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8g\",\n            sourceNodeId: \"metro_selection\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-not-spb\",\n            targetHandle: \"target\"\n          },\n          // Back connections from station nodes to metro selection\n          {\n            id: \"conn-8h\",\n            sourceNodeId: \"red_line_stations\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"btn-back-metro\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8i\",\n            sourceNodeId: \"blue_line_stations\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"btn-back-metro-blue\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8j\",\n            sourceNodeId: \"green_line_stations\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"btn-back-metro-green\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8k\",\n            sourceNodeId: \"orange_line_stations\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"btn-back-metro-orange\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8l\",\n            sourceNodeId: \"purple_line_stations\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"btn-back-metro-purple\",\n            targetHandle: \"target\"\n          },\n          // Forward connections from station nodes to interests\n          {\n            id: \"conn-8m\",\n            sourceNodeId: \"red_line_stations\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8n\",\n            sourceNodeId: \"blue_line_stations\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8o\",\n            sourceNodeId: \"green_line_stations\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8p\",\n            sourceNodeId: \"orange_line_stations\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-8q\",\n            sourceNodeId: \"purple_line_stations\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-9\",\n            sourceNodeId: \"interests_categories\",\n            targetNodeId: \"hobby_interests\",\n            sourceHandle: \"btn-hobby\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-10\",\n            sourceNodeId: \"hobby_interests\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-back-categories\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-11\",\n            sourceNodeId: \"hobby_interests\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-30\",\n            sourceNodeId: \"interests_categories\",\n            targetNodeId: \"social_interests\",\n            sourceHandle: \"btn-social\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-31\",\n            sourceNodeId: \"social_interests\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-back-categories-social\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-32\",\n            sourceNodeId: \"social_interests\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-33\",\n            sourceNodeId: \"interests_categories\",\n            targetNodeId: \"creativity_interests\",\n            sourceHandle: \"btn-creativity\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-34\",\n            sourceNodeId: \"creativity_interests\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-back-categories-creativity\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-35\",\n            sourceNodeId: \"creativity_interests\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-36\",\n            sourceNodeId: \"interests_categories\",\n            targetNodeId: \"active_interests\",\n            sourceHandle: \"btn-active\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-37\",\n            sourceNodeId: \"active_interests\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-back-categories-active\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-38\",\n            sourceNodeId: \"active_interests\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-39\",\n            sourceNodeId: \"interests_categories\",\n            targetNodeId: \"food_interests\",\n            sourceHandle: \"btn-food\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-40\",\n            sourceNodeId: \"food_interests\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-back-categories-food\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-41\",\n            sourceNodeId: \"food_interests\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-42\",\n            sourceNodeId: \"interests_categories\",\n            targetNodeId: \"sport_interests\",\n            sourceHandle: \"btn-sport\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-43\",\n            sourceNodeId: \"sport_interests\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-back-categories-sport\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-44\",\n            sourceNodeId: \"sport_interests\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-12\",\n            sourceNodeId: \"marital_status\",\n            targetNodeId: \"sexual_orientation\",\n            sourceHandle: \"btn-single\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-13\",\n            sourceNodeId: \"marital_status\",\n            targetNodeId: \"sexual_orientation\",\n            sourceHandle: \"btn-relationship\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-14\",\n            sourceNodeId: \"marital_status\",\n            targetNodeId: \"sexual_orientation\",\n            sourceHandle: \"btn-married\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-15\",\n            sourceNodeId: \"marital_status\",\n            targetNodeId: \"sexual_orientation\",\n            sourceHandle: \"btn-complicated\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-16\",\n            sourceNodeId: \"sexual_orientation\",\n            targetNodeId: \"channel_choice\",\n            sourceHandle: \"btn-hetero\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-17\",\n            sourceNodeId: \"sexual_orientation\",\n            targetNodeId: \"channel_choice\",\n            sourceHandle: \"btn-gay\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-18\",\n            sourceNodeId: \"sexual_orientation\",\n            targetNodeId: \"channel_choice\",\n            sourceHandle: \"btn-lesbian\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-19\",\n            sourceNodeId: \"sexual_orientation\",\n            targetNodeId: \"channel_choice\",\n            sourceHandle: \"btn-bi\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-20\",\n            sourceNodeId: \"sexual_orientation\",\n            targetNodeId: \"channel_choice\",\n            sourceHandle: \"btn-other\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-21\",\n            sourceNodeId: \"channel_choice\",\n            targetNodeId: \"extra_info\",\n            sourceHandle: \"btn-skip-channel\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-22\",\n            sourceNodeId: \"channel_choice\",\n            targetNodeId: \"extra_info\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-24\",\n            sourceNodeId: \"extra_info\",\n            targetNodeId: \"profile_complete\",\n            sourceHandle: \"btn-skip-extra\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-25\",\n            sourceNodeId: \"extra_info\",\n            targetNodeId: \"profile_complete\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-27\",\n            sourceNodeId: \"profile_complete\",\n            targetNodeId: \"chat_link\",\n            sourceHandle: \"btn-chat-link\",\n            targetHandle: \"target\"\n          },\n          // Connections for profile editing buttons\n          {\n            id: \"conn-edit-1\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"gender_selection\",\n            sourceHandle: \"btn-edit-gender\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-edit-2\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"name_input\",\n            sourceHandle: \"btn-edit-name\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-edit-3\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"age_input\",\n            sourceHandle: \"btn-edit-age\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-edit-4\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"btn-edit-metro\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-edit-5\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-edit-interests\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-edit-6\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"btn-edit-marital\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-edit-7\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"sexual_orientation\",\n            sourceHandle: \"btn-edit-orientation\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-edit-8\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"channel_choice\",\n            sourceHandle: \"btn-edit-channel\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"conn-edit-9\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"extra_info\",\n            sourceHandle: \"btn-edit-extra\",\n            targetHandle: \"target\"\n          }\n        ]\n      }\n    });\n\n    console.log('‚úÖ –®–∞–±–ª–æ–Ω VProgulke Bot —Å–æ–∑–¥–∞–Ω');\n\n    // –°–æ–∑–¥–∞–µ–º —à–∞–±–ª–æ–Ω —Å –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π\n    await storage.createBotTemplate({\n      name: \"üè¢ –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π –±–∏–∑–Ω–µ—Å-–±–æ—Ç\",\n      description: \"–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏: —É—Å–ª—É–≥–∏, –ø—Ä–∞–π—Å, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã\",\n      category: \"business\",\n      tags: [\"–º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π\", \"–Ω–∞–≤–∏–≥–∞—Ü–∏—è\", \"–±–∏–∑–Ω–µ—Å\", \"–º–µ–Ω—é\", \"—Å—Ç—Ä—É–∫—Ç—É—Ä–∞\", \"—Ä–∞–∑–¥–µ–ª—ã\"],\n      isPublic: 1,\n      difficulty: \"medium\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 6,\n      estimatedTime: 25,\n      data: {\n        sheets: [\n          {\n            id: \"main_sheet\",\n            name: \"–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n            nodes: [\n              {\n                id: \"start\",\n                type: \"start\",\n                position: { x: 400, y: 100 },\n                data: {\n                  command: \"/start\",\n                  description: \"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                  messageText: \"üè¢ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É –∫–æ–º–ø–∞–Ω–∏—é!\\n\\n–ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –≤ –æ–±–ª–∞—Å—Ç–∏ IT-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å —Ä–∞–∑–¥–µ–ª:\",\n                  synonyms: [\"—Å—Ç–∞—Ä—Ç\", \"–Ω–∞—á–∞—Ç—å\", \"–º–µ–Ω—é\", \"–≥–ª–∞–≤–Ω–∞—è\"],\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-services\",\n                      text: \"üíº –ù–∞—à–∏ —É—Å–ª—É–≥–∏\",\n                      action: \"goto\",\n                      target: \"services_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-portfolio\",\n                      text: \"üìÅ –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ\",\n                      action: \"goto\", \n                      target: \"portfolio_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-pricing\",\n                      text: \"üí∞ –ü—Ä–∞–π—Å-–ª–∏—Å—Ç\",\n                      action: \"goto\",\n                      target: \"pricing_main\", \n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-contacts\",\n                      text: \"üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-about\",\n                      text: \"‚ÑπÔ∏è –û –∫–æ–º–ø–∞–Ω–∏–∏\",\n                      action: \"goto\",\n                      target: \"about_company\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: false,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"about_company\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"‚ÑπÔ∏è –û –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏:\\n\\nüîπ –†–∞–±–æ—Ç–∞–µ–º –Ω–∞ —Ä—ã–Ω–∫–µ —Å 2018 –≥–æ–¥–∞\\nüîπ –ö–æ–º–∞–Ω–¥–∞ –∏–∑ 15+ –æ–ø—ã—Ç–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤\\nüîπ –ë–æ–ª–µ–µ 200 —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤\\nüîπ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç –∏–¥–µ–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞\\nüîπ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ 24/7\\n\\n–ù–∞—à–∞ –º–∏—Å—Å–∏—è - —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ IT-—Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –±–∏–∑–Ω–µ—Å—É —Ä–∞—Å—Ç–∏ –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è.\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-main\",\n                      text: \"‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                      action: \"goto\",\n                      target: \"start\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              }\n            ],\n            connections: [\n              {\n                id: \"conn-start-services\",\n                source: \"start\",\n                target: \"services_main\",\n                sourceHandle: \"btn-services\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-start-portfolio\", \n                source: \"start\",\n                target: \"portfolio_main\",\n                sourceHandle: \"btn-portfolio\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-start-pricing\",\n                source: \"start\", \n                target: \"pricing_main\",\n                sourceHandle: \"btn-pricing\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-start-contacts\",\n                source: \"start\",\n                target: \"contacts_main\", \n                sourceHandle: \"btn-contacts\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-start-about\",\n                source: \"start\",\n                target: \"about_company\",\n                sourceHandle: \"btn-about\", \n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-about-main\",\n                source: \"about_company\",\n                target: \"start\",\n                sourceHandle: \"btn-back-main\",\n                targetHandle: \"target\"\n              }\n            ],\n            viewState: {\n              position: { x: 0, y: 0 },\n              zoom: 1\n            }\n          },\n          {\n            id: \"services_sheet\",\n            name: \"–£—Å–ª—É–≥–∏\",\n            nodes: [\n              {\n                id: \"services_main\",\n                type: \"message\",\n                position: { x: 400, y: 100 },\n                data: {\n                  messageText: \"üíº –ù–∞—à–∏ —É—Å–ª—É–≥–∏:\\n\\n–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–ª–Ω—ã–π —Å–ø–µ–∫—Ç—Ä IT-—É—Å–ª—É–≥ –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞.\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é:\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-web-dev\",\n                      text: \"üåê –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞\",\n                      action: \"goto\",\n                      target: \"web_development\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-mobile-dev\",\n                      text: \"üì± –ú–æ–±–∏–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞\",\n                      action: \"goto\", \n                      target: \"mobile_development\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-design\",\n                      text: \"üé® –î–∏–∑–∞–π–Ω\",\n                      action: \"goto\",\n                      target: \"design_services\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-consulting\",\n                      text: \"üß† IT-–∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥\",\n                      action: \"goto\",\n                      target: \"consulting\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-back-services\",\n                      text: \"‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                      action: \"goto\",\n                      target: \"start\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"web_development\",\n                type: \"message\",\n                position: { x: 100, y: 300 },\n                data: {\n                  messageText: \"üåê –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:\\n\\n‚úÖ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–∞–π—Ç—ã\\n‚úÖ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω—ã\\n‚úÖ –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\\n‚úÖ CRM –∏ ERP —Å–∏—Å—Ç–µ–º—ã\\n‚úÖ API —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞\\n‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ\\n\\n–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: React, Vue.js, Node.js, Python, PHP\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-services-web\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —É—Å–ª—É–≥–∞–º\",\n                      action: \"goto\",\n                      target: \"services_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-consultation-web\",\n                      text: \"üìû –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"mobile_development\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"üì± –ú–æ–±–∏–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:\\n\\n‚úÖ –ù–∞—Ç–∏–≤–Ω—ã–µ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\\n‚úÖ –ù–∞—Ç–∏–≤–Ω—ã–µ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\\n‚úÖ –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è\\n‚úÖ –ò–≥—Ä—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤\\n‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏\\n‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ App Store –∏ Google Play\\n\\n–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: Swift, Kotlin, React Native, Flutter\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-services-mobile\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —É—Å–ª—É–≥–∞–º\",\n                      action: \"goto\",\n                      target: \"services_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-consultation-mobile\",\n                      text: \"üìû –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"design_services\",\n                type: \"message\",\n                position: { x: 700, y: 300 },\n                data: {\n                  messageText: \"üé® –î–∏–∑–∞–π–Ω —É—Å–ª—É–≥–∏:\\n\\n‚úÖ UI/UX –¥–∏–∑–∞–π–Ω –≤–µ–±-—Å–∞–π—Ç–æ–≤\\n‚úÖ –î–∏–∑–∞–π–Ω –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π\\n‚úÖ –ë—Ä–µ–Ω–¥–∏–Ω–≥ –∏ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å\\n‚úÖ –õ–æ–≥–æ—Ç–∏–ø—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∞\\n‚úÖ –ê–Ω–∏–º–∞—Ü–∏—è –∏ –≤–∏–¥–µ–æ\\n‚úÖ –ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ\\n\\n–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: Figma, Adobe Creative Suite, Sketch\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-services-design\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —É—Å–ª—É–≥–∞–º\",\n                      action: \"goto\",\n                      target: \"services_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-portfolio-design\",\n                      text: \"üìÅ –°–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ\",\n                      action: \"goto\",\n                      target: \"portfolio_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"consulting\",\n                type: \"message\",\n                position: { x: 1000, y: 300 },\n                data: {\n                  messageText: \"üß† IT-–∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥:\\n\\n‚úÖ –ê—É–¥–∏—Ç —Ç–µ–∫—É—â–∏—Ö IT-—Ä–µ—à–µ–Ω–∏–π\\n‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏\\n‚úÖ –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π\\n‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ\\n‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤\\n‚úÖ –û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã\\n\\n–ü–æ–º–æ–∂–µ–º –≤—ã–±—Ä–∞—Ç—å –Ω–∞–∏–ª—É—á—à–∏–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞!\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-services-consulting\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —É—Å–ª—É–≥–∞–º\",\n                      action: \"goto\",\n                      target: \"services_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-consultation-consulting\",\n                      text: \"üìû –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              }\n            ],\n            connections: [\n              {\n                id: \"conn-services-web\",\n                source: \"services_main\",\n                target: \"web_development\",\n                sourceHandle: \"btn-web-dev\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-services-mobile\",\n                source: \"services_main\",\n                target: \"mobile_development\",\n                sourceHandle: \"btn-mobile-dev\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-services-design\",\n                source: \"services_main\",\n                target: \"design_services\",\n                sourceHandle: \"btn-design\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-services-consulting\",\n                source: \"services_main\",\n                target: \"consulting\",\n                sourceHandle: \"btn-consulting\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-web-back\",\n                source: \"web_development\",\n                target: \"services_main\",\n                sourceHandle: \"btn-back-services-web\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-mobile-back\",\n                source: \"mobile_development\",\n                target: \"services_main\",\n                sourceHandle: \"btn-back-services-mobile\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-design-back\",\n                source: \"design_services\",\n                target: \"services_main\",\n                sourceHandle: \"btn-back-services-design\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-consulting-back\",\n                source: \"consulting\",\n                target: \"services_main\",\n                sourceHandle: \"btn-back-services-consulting\",\n                targetHandle: \"target\"\n              }\n            ],\n            viewState: {\n              position: { x: 0, y: 0 },\n              zoom: 1\n            }\n          },\n          {\n            id: \"portfolio_sheet\", \n            name: \"–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ\",\n            nodes: [\n              {\n                id: \"portfolio_main\",\n                type: \"message\",\n                position: { x: 400, y: 100 },\n                data: {\n                  messageText: \"üìÅ –ù–∞—à–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ:\\n\\n–ú—ã –≥–æ—Ä–¥–∏–º—Å—è –Ω–∞—à–∏–º–∏ —Ä–∞–±–æ—Ç–∞–º–∏ –∏ —Ä–∞–¥—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–æ–≤:\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-web-portfolio\",\n                      text: \"üåê –í–µ–±-–ø—Ä–æ–µ–∫—Ç—ã\",\n                      action: \"goto\",\n                      target: \"web_portfolio\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-mobile-portfolio\",\n                      text: \"üì± –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\",\n                      action: \"goto\",\n                      target: \"mobile_portfolio\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-design-portfolio\",\n                      text: \"üé® –î–∏–∑–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç—ã\",\n                      action: \"goto\",\n                      target: \"design_portfolio\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-back-portfolio\",\n                      text: \"‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                      action: \"goto\",\n                      target: \"start\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"web_portfolio\",\n                type: \"message\",\n                position: { x: 100, y: 300 },\n                data: {\n                  messageText: \"üåê –í–µ–±-–ø—Ä–æ–µ–∫—Ç—ã:\\n\\nüîπ **–¢–µ—Ö–Ω–æ–ú–∞—Ä—Ç** - –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏\\n   ‚Ä¢ React + Node.js\\n   ‚Ä¢ 10,000+ —Ç–æ–≤–∞—Ä–æ–≤\\n   ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1–°\\n\\nüîπ **–ú–µ–¥–ö–ª–∏–Ω–∏–∫–∞ –ü–ª—é—Å** - –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–∏ –∫ –≤—Ä–∞—á–∞–º\\n   ‚Ä¢ Vue.js + Python\\n   ‚Ä¢ –û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏\\n   ‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\\n\\nüîπ **LogiTrans** - CRM –¥–ª—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏\\n   ‚Ä¢ Angular + .NET\\n   ‚Ä¢ –¢—Ä–µ–∫–∏–Ω–≥ –≥—Ä—É–∑–æ–≤\\n   ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-portfolio-web\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ\",\n                      action: \"goto\",\n                      target: \"portfolio_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-consultation-portfolio\",\n                      text: \"üìû –û–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              },\n              {\n                id: \"mobile_portfolio\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"üì± –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\\n\\nüîπ **FitTracker** - –§–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä (iOS/Android)\\n   ‚Ä¢ React Native\\n   ‚Ä¢ 50,000+ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π\\n   ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —É–º–Ω—ã–º–∏ —á–∞—Å–∞–º–∏\\n\\nüîπ **BankSecure** - –ë–∞–Ω–∫–æ–≤—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\\n   ‚Ä¢ Native iOS/Android\\n   ‚Ä¢ –ë–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è\\n   ‚Ä¢ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\\n\\nüîπ **DeliveryFast** - –î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã\\n   ‚Ä¢ Flutter\\n   ‚Ä¢ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è\\n   ‚Ä¢ –û–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–∏\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-portfolio-mobile\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ\",\n                      action: \"goto\",\n                      target: \"portfolio_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-consultation-mobile-portfolio\",\n                      text: \"üìû –û–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              },\n              {\n                id: \"design_portfolio\",\n                type: \"message\",\n                position: { x: 700, y: 300 },\n                data: {\n                  messageText: \"üé® –î–∏–∑–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç—ã:\\n\\nüîπ **EcoStyle** - –ë—Ä–µ–Ω–¥–∏–Ω–≥ —ç–∫–æ-–º–∞–≥–∞–∑–∏–Ω–∞\\n   ‚Ä¢ –õ–æ–≥–æ—Ç–∏–ø –∏ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å\\n   ‚Ä¢ –î–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏\\n   ‚Ä¢ –í–µ–±-–¥–∏–∑–∞–π–Ω\\n\\nüîπ **StartupHub** - UI/UX –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã\\n   ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å\\n   ‚Ä¢ –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è\\n   ‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –∏–∫–æ–Ω–æ–∫\\n\\nüîπ **RestaurantChain** - –î–∏–∑–∞–π–Ω —Å–µ—Ç–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤\\n   ‚Ä¢ –ú–µ–Ω—é –∏ –∏–Ω—Ç–µ—Ä—å–µ—Ä\\n   ‚Ä¢ –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\\n   ‚Ä¢ –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-portfolio-design\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ\",\n                      action: \"goto\",\n                      target: \"portfolio_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-consultation-design-portfolio\",\n                      text: \"üìû –û–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              }\n            ],\n            connections: [\n              {\n                id: \"conn-portfolio-web\",\n                source: \"portfolio_main\",\n                target: \"web_portfolio\",\n                sourceHandle: \"btn-web-portfolio\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-portfolio-mobile\",\n                source: \"portfolio_main\",\n                target: \"mobile_portfolio\",\n                sourceHandle: \"btn-mobile-portfolio\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-portfolio-design\",\n                source: \"portfolio_main\",\n                target: \"design_portfolio\",\n                sourceHandle: \"btn-design-portfolio\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-web-portfolio-back\",\n                source: \"web_portfolio\",\n                target: \"portfolio_main\",\n                sourceHandle: \"btn-back-portfolio-web\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-mobile-portfolio-back\",\n                source: \"mobile_portfolio\",\n                target: \"portfolio_main\",\n                sourceHandle: \"btn-back-portfolio-mobile\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-design-portfolio-back\",\n                source: \"design_portfolio\",\n                target: \"portfolio_main\",\n                sourceHandle: \"btn-back-portfolio-design\",\n                targetHandle: \"target\"\n              }\n            ],\n            viewState: {\n              position: { x: 0, y: 0 },\n              zoom: 1\n            }\n          },\n          {\n            id: \"pricing_sheet\",\n            name: \"–ü—Ä–∞–π—Å-–ª–∏—Å—Ç\",\n            nodes: [\n              {\n                id: \"pricing_main\",\n                type: \"message\",\n                position: { x: 400, y: 100 },\n                data: {\n                  messageText: \"üí∞ –ü—Ä–∞–π—Å-–ª–∏—Å—Ç:\\n\\n–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ –Ω–∞—à–∏ —É—Å–ª—É–≥–∏. –°—Ç–æ–∏–º–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é:\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-web-pricing\",\n                      text: \"üåê –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞\",\n                      action: \"goto\",\n                      target: \"web_pricing\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-mobile-pricing\",\n                      text: \"üì± –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\",\n                      action: \"goto\",\n                      target: \"mobile_pricing\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-design-pricing\",\n                      text: \"üé® –î–∏–∑–∞–π–Ω\",\n                      action: \"goto\",\n                      target: \"design_pricing\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-packages\",\n                      text: \"üì¶ –ì–æ—Ç–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã\",\n                      action: \"goto\",\n                      target: \"pricing_packages\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-back-pricing\",\n                      text: \"‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                      action: \"goto\",\n                      target: \"start\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"web_pricing\",\n                type: \"message\",\n                position: { x: 100, y: 300 },\n                data: {\n                  messageText: \"üåê –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ - —Ü–µ–Ω—ã:\\n\\nüíº **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç**\\n   ‚Ä¢ –õ–µ–Ω–¥–∏–Ω–≥: –æ—Ç 50,000‚ÇΩ\\n   ‚Ä¢ –ú–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π: –æ—Ç 120,000‚ÇΩ\\n   ‚Ä¢ –° –∞–¥–º–∏–Ω–∫–æ–π: –æ—Ç 180,000‚ÇΩ\\n\\nüõí **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω**\\n   ‚Ä¢ –ü—Ä–æ—Å—Ç–æ–π: –æ—Ç 200,000‚ÇΩ\\n   ‚Ä¢ –°—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –æ—Ç 400,000‚ÇΩ\\n   ‚Ä¢ –ö—Ä—É–ø–Ω—ã–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å: –æ—Ç 800,000‚ÇΩ\\n\\nüîß **–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**\\n   ‚Ä¢ CRM/ERP: –æ—Ç 500,000‚ÇΩ\\n   ‚Ä¢ SaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞: –æ—Ç 1,000,000‚ÇΩ\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-pricing-web\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–∞–π—Å—É\",\n                      action: \"goto\",\n                      target: \"pricing_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-calculate-web\",\n                      text: \"üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              },\n              {\n                id: \"mobile_pricing\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"üì± –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - —Ü–µ–Ω—ã:\\n\\nüì≤ **iOS / Android (–Ω–∞—Ç–∏–≤–Ω—ã–µ)**\\n   ‚Ä¢ –ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –æ—Ç 300,000‚ÇΩ\\n   ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –æ—Ç 600,000‚ÇΩ\\n   ‚Ä¢ –°–ª–æ–∂–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –æ—Ç 1,200,000‚ÇΩ\\n\\nüîÑ **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ**\\n   ‚Ä¢ React Native: –æ—Ç 250,000‚ÇΩ\\n   ‚Ä¢ Flutter: –æ—Ç 280,000‚ÇΩ\\n\\nüéÆ **–ò–≥—Ä—ã**\\n   ‚Ä¢ –ü—Ä–æ—Å—Ç–∞—è –∏–≥—Ä–∞: –æ—Ç 400,000‚ÇΩ\\n   ‚Ä¢ –ò–≥—Ä–∞ —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –æ—Ç 800,000‚ÇΩ\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-pricing-mobile\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–∞–π—Å—É\",\n                      action: \"goto\",\n                      target: \"pricing_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-calculate-mobile\",\n                      text: \"üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              },\n              {\n                id: \"design_pricing\",\n                type: \"message\",\n                position: { x: 700, y: 300 },\n                data: {\n                  messageText: \"üé® –î–∏–∑–∞–π–Ω - —Ü–µ–Ω—ã:\\n\\nüéØ **UI/UX –¥–∏–∑–∞–π–Ω**\\n   ‚Ä¢ –õ–µ–Ω–¥–∏–Ω–≥: –æ—Ç 30,000‚ÇΩ\\n   ‚Ä¢ –°–∞–π—Ç (5-10 —Å—Ç—Ä–∞–Ω–∏—Ü): –æ—Ç 60,000‚ÇΩ\\n   ‚Ä¢ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –æ—Ç 80,000‚ÇΩ\\n\\nüè∑Ô∏è **–ë—Ä–µ–Ω–¥–∏–Ω–≥**\\n   ‚Ä¢ –õ–æ–≥–æ—Ç–∏–ø: –æ—Ç 20,000‚ÇΩ\\n   ‚Ä¢ –§–∏—Ä–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å: –æ—Ç 50,000‚ÇΩ\\n   ‚Ä¢ –ü–æ–ª–Ω—ã–π —Ä–µ–±—Ä–µ–Ω–¥–∏–Ω–≥: –æ—Ç 150,000‚ÇΩ\\n\\nüì± **–ú–æ–±–∏–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω**\\n   ‚Ä¢ –ü—Ä–æ—Ç–æ—Ç–∏–ø: –æ—Ç 40,000‚ÇΩ\\n   ‚Ä¢ –ü–æ–ª–Ω—ã–π –¥–∏–∑–∞–π–Ω: –æ—Ç 100,000‚ÇΩ\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-pricing-design\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–∞–π—Å—É\",\n                      action: \"goto\",\n                      target: \"pricing_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-calculate-design\",\n                      text: \"üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              },\n              {\n                id: \"pricing_packages\",\n                type: \"message\",\n                position: { x: 1000, y: 300 },\n                data: {\n                  messageText: \"üì¶ –ì–æ—Ç–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã:\\n\\nüöÄ **–°–¢–ê–†–¢–ê–ü** - 150,000‚ÇΩ\\n   ‚Ä¢ –õ–µ–Ω–¥–∏–Ω–≥ + –¥–∏–∑–∞–π–Ω\\n   ‚Ä¢ –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è\\n   ‚Ä¢ –ë–∞–∑–æ–≤–∞—è SEO\\n   ‚Ä¢ 3 –º–µ—Å—è—Ü–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏\\n\\nüíº **–ë–ò–ó–ù–ï–°** - 400,000‚ÇΩ\\n   ‚Ä¢ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç\\n   ‚Ä¢ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å\\n   ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏\\n   ‚Ä¢ 6 –º–µ—Å—è—Ü–µ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏\\n\\nüè¢ **ENTERPRISE** - 1,000,000‚ÇΩ\\n   ‚Ä¢ –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞\\n   ‚Ä¢ –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\\n   ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏\\n   ‚Ä¢ –ì–æ–¥ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ + —Ä–∞–∑–≤–∏—Ç–∏–µ\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-pricing-packages\",\n                      text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–∞–π—Å—É\",\n                      action: \"goto\",\n                      target: \"pricing_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-choose-package\",\n                      text: \"‚úÖ –í—ã–±—Ä–∞—Ç—å –ø–∞–∫–µ—Ç\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              }\n            ],\n            connections: [\n              {\n                id: \"conn-pricing-web\",\n                source: \"pricing_main\",\n                target: \"web_pricing\",\n                sourceHandle: \"btn-web-pricing\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-pricing-mobile\",\n                source: \"pricing_main\",\n                target: \"mobile_pricing\",\n                sourceHandle: \"btn-mobile-pricing\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-pricing-design\",\n                source: \"pricing_main\",\n                target: \"design_pricing\",\n                sourceHandle: \"btn-design-pricing\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-pricing-packages\",\n                source: \"pricing_main\",\n                target: \"pricing_packages\",\n                sourceHandle: \"btn-packages\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-web-pricing-back\",\n                source: \"web_pricing\",\n                target: \"pricing_main\",\n                sourceHandle: \"btn-back-pricing-web\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-mobile-pricing-back\",\n                source: \"mobile_pricing\",\n                target: \"pricing_main\",\n                sourceHandle: \"btn-back-pricing-mobile\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-design-pricing-back\",\n                source: \"design_pricing\",\n                target: \"pricing_main\",\n                sourceHandle: \"btn-back-pricing-design\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-packages-pricing-back\",\n                source: \"pricing_packages\",\n                target: \"pricing_main\",\n                sourceHandle: \"btn-back-pricing-packages\",\n                targetHandle: \"target\"\n              }\n            ],\n            viewState: {\n              position: { x: 0, y: 0 },\n              zoom: 1\n            }\n          },\n          {\n            id: \"contacts_sheet\",\n            name: \"–ö–æ–Ω—Ç–∞–∫—Ç—ã\",\n            nodes: [\n              {\n                id: \"contacts_main\",\n                type: \"message\",\n                position: { x: 400, y: 100 },\n                data: {\n                  messageText: \"üìû –ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã:\\n\\nüè¢ **–ê–¥—Ä–µ—Å –æ—Ñ–∏—Å–∞:**\\n–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, –¥. 15, –æ—Ñ–∏—Å 401\\n\\nüìß **Email:**\\ninfo@itcompany.ru\\n\\nüì± **–¢–µ–ª–µ—Ñ–æ–Ω:**\\n+7 (495) 123-45-67\\n\\nüïí **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:**\\n–ü–Ω-–ü—Ç: 9:00 - 18:00\\n–°–±-–í—Å: –≤—ã—Ö–æ–¥–Ω—ã–µ\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-call-request\",\n                      text: \"üìû –ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫\",\n                      action: \"goto\",\n                      target: \"call_request\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-consultation\",\n                      text: \"üí¨ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è\",\n                      action: \"goto\",\n                      target: \"consultation_form\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-social-links\",\n                      text: \"üåê –ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö\",\n                      action: \"goto\",\n                      target: \"social_links\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-back-contacts\",\n                      text: \"‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                      action: \"goto\",\n                      target: \"start\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              },\n              {\n                id: \"call_request\",\n                type: \"message\",\n                position: { x: 100, y: 300 },\n                data: {\n                  messageText: \"üìû –ó–∞–∫–∞–∑–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫:\\n\\n–û—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∏ –º—ã –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.\\n\\n–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:\",\n                  keyboardType: \"none\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"phone_number\",\n                  inputTargetNodeId: \"call_confirmation\",\n                  inputType: \"phone\",\n                  inputValidation: \"^\\\\+?[1-9]\\\\d{1,14}$\",\n                  inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞\",\n                  markdown: false\n                }\n              },\n              {\n                id: \"call_confirmation\",\n                type: \"message\",\n                position: { x: 100, y: 500 },\n                data: {\n                  messageText: \"‚úÖ –°–ø–∞—Å–∏–±–æ! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞.\\n\\n–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞: {phone_number}\\n\\n–ú—ã –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º –≤–∞–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-contacts-call\",\n                      text: \"‚¨ÖÔ∏è –ö –∫–æ–Ω—Ç–∞–∫—Ç–∞–º\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-main-menu-call\",\n                      text: \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                      action: \"goto\",\n                      target: \"start\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"consultation_form\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"üí¨ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è:\\n\\n–û–ø–∏—à–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –∑–∞–¥–∞—á—É, –∏ –º—ã –ø—Ä–µ–¥–ª–æ–∂–∏–º –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.\\n\\n–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:\",\n                  keyboardType: \"none\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"project_description\",\n                  inputTargetNodeId: \"consultation_contact\",\n                  inputType: \"text\",\n                  minLength: 10,\n                  maxLength: 2000,\n                  inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤)\",\n                  markdown: false\n                }\n              },\n              {\n                id: \"consultation_contact\",\n                type: \"message\",\n                position: { x: 400, y: 500 },\n                data: {\n                  messageText: \"–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏—Ç–µ –≤–∞—à –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏:\",\n                  keyboardType: \"none\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"consultation_phone\",\n                  inputTargetNodeId: \"consultation_confirmation\",\n                  inputType: \"phone\",\n                  inputValidation: \"^\\\\+?[1-9]\\\\d{1,14}$\",\n                  inputRetryMessage: \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞\",\n                  markdown: false\n                }\n              },\n              {\n                id: \"consultation_confirmation\",\n                type: \"message\",\n                position: { x: 400, y: 700 },\n                data: {\n                  messageText: \"üéâ –ó–∞—è–≤–∫–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!\\n\\nüìù **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:**\\n{project_description}\\n\\nüìû **–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω:**\\n{consultation_phone}\\n\\n–ù–∞—à —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-contacts-consultation\",\n                      text: \"‚¨ÖÔ∏è –ö –∫–æ–Ω—Ç–∞–∫—Ç–∞–º\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-main-menu-consultation\",\n                      text: \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                      action: \"goto\",\n                      target: \"start\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              },\n              {\n                id: \"social_links\",\n                type: \"message\",\n                position: { x: 700, y: 300 },\n                data: {\n                  messageText: \"üåê –ú—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö:\\n\\nüìò **–í–ö–æ–Ω—Ç–∞–∫—Ç–µ:** vk.com/itcompany\\nüì∏ **Instagram:** @itcompany_official\\nüíº **LinkedIn:** IT Company\\nüìπ **YouTube:** IT Company Channel\\nüí¨ **Telegram:** @itcompany_chat\\n\\n–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –Ω–∞—à–∏ –∫–∞–Ω–∞–ª—ã –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–æ–≤–æ—Å—Ç—è–º–∏ –∏ –ø–æ–ª–µ–∑–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏!\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-back-contacts-social\",\n                      text: \"‚¨ÖÔ∏è –ö –∫–æ–Ω—Ç–∞–∫—Ç–∞–º\",\n                      action: \"goto\",\n                      target: \"contacts_main\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: true\n                }\n              }\n            ],\n            connections: [\n              {\n                id: \"conn-contacts-call\",\n                source: \"contacts_main\",\n                target: \"call_request\",\n                sourceHandle: \"btn-call-request\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-contacts-consultation\",\n                source: \"contacts_main\",\n                target: \"consultation_form\",\n                sourceHandle: \"btn-consultation\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-contacts-social\",\n                source: \"contacts_main\",\n                target: \"social_links\",\n                sourceHandle: \"btn-social-links\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-call-confirmation\",\n                source: \"call_request\",\n                target: \"call_confirmation\",\n                sourceHandle: \"input-phone\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-consultation-contact\",\n                source: \"consultation_form\",\n                target: \"consultation_contact\",\n                sourceHandle: \"input-description\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-consultation-confirmation\",\n                source: \"consultation_contact\",\n                target: \"consultation_confirmation\",\n                sourceHandle: \"input-phone\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-call-back-contacts\",\n                source: \"call_confirmation\",\n                target: \"contacts_main\",\n                sourceHandle: \"btn-back-contacts-call\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-consultation-back-contacts\",\n                source: \"consultation_confirmation\",\n                target: \"contacts_main\",\n                sourceHandle: \"btn-back-contacts-consultation\",\n                targetHandle: \"target\"\n              },\n              {\n                id: \"conn-social-back-contacts\",\n                source: \"social_links\",\n                target: \"contacts_main\",\n                sourceHandle: \"btn-back-contacts-social\",\n                targetHandle: \"target\"\n              }\n            ],\n            viewState: {\n              position: { x: 0, y: 0 },\n              zoom: 1\n            }\n          }\n        ],\n        // –ú–µ–∂–ª–∏—Å—Ç–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n        interSheetConnections: [\n          {\n            id: \"inter-main-services\",\n            sourceSheetId: \"main_sheet\",\n            targetSheetId: \"services_sheet\", \n            sourceNodeId: \"start\",\n            targetNodeId: \"services_main\",\n            sourceHandle: \"btn-services\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-main-portfolio\",\n            sourceSheetId: \"main_sheet\",\n            targetSheetId: \"portfolio_sheet\",\n            sourceNodeId: \"start\", \n            targetNodeId: \"portfolio_main\",\n            sourceHandle: \"btn-portfolio\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-main-pricing\",\n            sourceSheetId: \"main_sheet\",\n            targetSheetId: \"pricing_sheet\",\n            sourceNodeId: \"start\",\n            targetNodeId: \"pricing_main\",\n            sourceHandle: \"btn-pricing\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-main-contacts\",\n            sourceSheetId: \"main_sheet\", \n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"start\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-contacts\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-services-main\",\n            sourceSheetId: \"services_sheet\",\n            targetSheetId: \"main_sheet\",\n            sourceNodeId: \"services_main\",\n            targetNodeId: \"start\",\n            sourceHandle: \"btn-back-services\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-portfolio-main\",\n            sourceSheetId: \"portfolio_sheet\",\n            targetSheetId: \"main_sheet\",\n            sourceNodeId: \"portfolio_main\",\n            targetNodeId: \"start\",\n            sourceHandle: \"btn-back-portfolio\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-pricing-main\",\n            sourceSheetId: \"pricing_sheet\",\n            targetSheetId: \"main_sheet\",\n            sourceNodeId: \"pricing_main\",\n            targetNodeId: \"start\",\n            sourceHandle: \"btn-back-pricing\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-contacts-main\",\n            sourceSheetId: \"contacts_sheet\",\n            targetSheetId: \"main_sheet\",\n            sourceNodeId: \"contacts_main\",\n            targetNodeId: \"start\",\n            sourceHandle: \"btn-back-contacts\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-services-contacts\",\n            sourceSheetId: \"services_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"web_development\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-consultation-web\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-services-contacts-mobile\",\n            sourceSheetId: \"services_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"mobile_development\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-consultation-mobile\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-services-portfolio\",\n            sourceSheetId: \"services_sheet\",\n            targetSheetId: \"portfolio_sheet\",\n            sourceNodeId: \"design_services\",\n            targetNodeId: \"portfolio_main\",\n            sourceHandle: \"btn-portfolio-design\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-services-contacts-consulting\",\n            sourceSheetId: \"services_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"consulting\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-consultation-consulting\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-portfolio-contacts\",\n            sourceSheetId: \"portfolio_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"web_portfolio\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-consultation-portfolio\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-portfolio-contacts-mobile\",\n            sourceSheetId: \"portfolio_sheet\",\n            targetSheetId: \"contacts_sheet\", \n            sourceNodeId: \"mobile_portfolio\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-consultation-mobile-portfolio\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-portfolio-contacts-design\",\n            sourceSheetId: \"portfolio_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"design_portfolio\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-consultation-design-portfolio\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-pricing-contacts-web\",\n            sourceSheetId: \"pricing_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"web_pricing\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-calculate-web\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-pricing-contacts-mobile\",\n            sourceSheetId: \"pricing_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"mobile_pricing\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-calculate-mobile\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-pricing-contacts-design\",\n            sourceSheetId: \"pricing_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"design_pricing\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-calculate-design\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-pricing-contacts-packages\",\n            sourceSheetId: \"pricing_sheet\",\n            targetSheetId: \"contacts_sheet\",\n            sourceNodeId: \"pricing_packages\",\n            targetNodeId: \"contacts_main\",\n            sourceHandle: \"btn-choose-package\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-contacts-main-call\",\n            sourceSheetId: \"contacts_sheet\",\n            targetSheetId: \"main_sheet\",\n            sourceNodeId: \"call_confirmation\",\n            targetNodeId: \"start\",\n            sourceHandle: \"btn-main-menu-call\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-contacts-main-consultation\",\n            sourceSheetId: \"contacts_sheet\",\n            targetSheetId: \"main_sheet\",\n            sourceNodeId: \"consultation_confirmation\",\n            targetNodeId: \"start\",\n            sourceHandle: \"btn-main-menu-consultation\",\n            targetHandle: \"target\"\n          }\n        ]\n      }\n    });\n\n    console.log('‚úÖ –®–∞–±–ª–æ–Ω –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–∑–¥–∞–Ω');\n\n    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω –í–ü—Ä–æ–≥—É–ª–∫–µ\n    await storage.createBotTemplate({\n      name: \"üåü –í–ü—Ä–æ–≥—É–ª–∫–µ Multi-Sheet - –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞ –°–ü–±\",\n      description: \"–ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –±–æ—Ç–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã: –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ, –º–µ—Ç—Ä–æ, –∏–Ω—Ç–µ—Ä–µ—Å—ã, –ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª—å\",\n      category: \"community\",\n      tags: [\"–∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞\", \"–º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π\", \"–º–µ—Ç—Ä–æ\", \"–∏–Ω—Ç–µ—Ä–µ—Å—ã\", \"–°–ü–±\", \"–∞–Ω–∫–µ—Ç–∞\", \"–Ω–∞–≤–∏–≥–∞—Ü–∏—è\"],\n      isPublic: 1,\n      difficulty: \"hard\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"4.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 9,\n      estimatedTime: 50,\n      data: {\n        sheets: [\n          // –õ–∏—Å—Ç 1: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n          {\n            id: \"welcome_sheet\",\n            name: \"üéâ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\",\n            nodes: [\n              {\n                id: \"start\",\n                type: \"start\",\n                position: { x: 400, y: 100 },\n                data: {\n                  command: \"/start\",\n                  description: \"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫\",\n                  messageText: \"üåü –ü—Ä–∏–≤–µ—Ç –æ—Ç ·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á Bot!\\n\\n–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ –Ω–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –ª—é–¥–µ–π –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ!\\n\\n–û—Ç–∫—É–¥–∞ —Ç—ã —É–∑–Ω–∞–ª –æ –Ω–∞—à–µ–º —á–∞—Ç–µ? üòé\",\n                  synonyms: [\"—Å—Ç–∞—Ä—Ç\", \"–Ω–∞—á–∞—Ç—å\", \"–ø—Ä–∏–≤–µ—Ç\", \"–Ω–∞—á–∞–ª–æ\", \"–Ω–∞—á–∏–Ω–∞–µ–º\"],\n                  keyboardType: \"none\",\n                  buttons: [],\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"user_source\",\n                  inputTargetNodeId: \"join_request\",\n                  markdown: false,\n                  oneTimeKeyboard: false,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"join_request\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–•–æ—á–µ—à—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –Ω–∞—à–µ–º—É —á–∞—Ç—É? üöÄ\",\n                  synonyms: [],\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"join_request_response\",\n                  buttons: [\n                    {\n                      id: \"btn-yes\",\n                      text: \"–î–∞ üòé\",\n                      value: \"yes\",\n                      action: \"goto\",\n                      target: \"gender_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-no\", \n                      text: \"–ù–µ—Ç üôÖ\",\n                      value: \"no\",\n                      action: \"goto\",\n                      target: \"decline_response\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"decline_response\",\n                type: \"message\",\n                position: { x: 400, y: 500 },\n                data: {\n                  messageText: \"–ü–æ–Ω—è—Ç–Ω–æ! –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—à—å, –Ω–∞–ø–∏—à–∏ /start! üòä\",\n                  synonyms: [],\n                  keyboardType: \"none\",\n                  removeKeyboard: true,\n                  buttons: [],\n                  markdown: false\n                }\n              }\n            ]\n          },\n\n          // –õ–∏—Å—Ç 2: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–ø–æ–ª, –∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç)\n          {\n            id: \"basic_info_sheet\", \n            name: \"üë§ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\",\n            nodes: [\n              {\n                id: \"gender_selection\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–£–∫–∞–∂–∏ —Å–≤–æ–π –ø–æ–ª: üë®üë©\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"gender\",\n                  synonyms: [\"–ø–æ–ª\", \"–≥–µ–Ω–¥–µ—Ä\", \"–º—É–∂—á–∏–Ω–∞\", \"–∂–µ–Ω—â–∏–Ω–∞\"],\n                  buttons: [\n                    {\n                      id: \"btn-male\",\n                      text: \"–ú—É–∂—á–∏–Ω–∞ üë®\",\n                      value: \"male\",\n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-female\",\n                      text: \"–ñ–µ–Ω—â–∏–Ω–∞ üë©\",\n                      value: \"female\", \n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"name_input\",\n                type: \"message\",\n                position: { x: 400, y: 500 },\n                data: {\n                  messageText: \"–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? ‚úèÔ∏è\\n\\n–ù–∞–ø–∏—à–∏ —Å–≤–æ—ë –∏–º—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:\",\n                  keyboardType: \"none\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"user_name\",\n                  synonyms: [\"–∏–º—è\", \"–∑–æ–≤—É—Ç\", \"–Ω–∞–∑—ã–≤–∞—é—Ç\", \"–∫–∞–∫ –∑–æ–≤—É—Ç\"],\n                  inputTargetNodeId: \"age_input\",\n                  buttons: [],\n                  markdown: false\n                }\n              },\n              {\n                id: \"age_input\",\n                type: \"message\",\n                position: { x: 400, y: 700 },\n                data: {\n                  messageText: \"–°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç? üéÇ\\n\\n–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç —á–∏—Å–ª–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 25):\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"user_age\",\n                  synonyms: [\"–≤–æ–∑—Ä–∞—Å—Ç\", \"–ª–µ—Ç\", \"–≥–æ–¥—ã\", \"—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç\"],\n                  inputTargetNodeId: \"metro_selection\",\n                  buttons: [],\n                  markdown: false\n                }\n              },\n            ]\n          },\n\n          // –õ–∏—Å—Ç 3: –ú–µ—Ç—Ä–æ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ\n          {\n            id: \"metro_sheet\",\n            name: \"üöá –ú–µ—Ç—Ä–æ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ\",\n            nodes: [\n              {\n                id: \"metro_selection\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–ù–∞ –∫–∞–∫–æ–π —Å—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ —Ç—ã –æ–±—ã—á–Ω–æ –±—ã–≤–∞–µ—à—å? üöá\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é –≤–µ—Ç–∫—É:\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"metro_stations\",\n                  synonyms: [\"–º–µ—Ç—Ä–æ\", \"—Å—Ç–∞–Ω—Ü–∏—è\", \"–≥–¥–µ –∂–∏–≤—É\", \"—Ä–∞–π–æ–Ω\"],\n                  buttons: [\n                    {\n                      id: \"btn-red\",\n                      text: \"–ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\",\n                      action: \"goto\",\n                      target: \"red_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-blue\",\n                      text: \"–°–∏–Ω—è—è –≤–µ—Ç–∫–∞ üü¶\",\n                      action: \"goto\", \n                      target: \"blue_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-green\",\n                      text: \"–ó–µ–ª—ë–Ω–∞—è –≤–µ—Ç–∫–∞ üü©\",\n                      action: \"goto\",\n                      target: \"green_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-orange\",\n                      text: \"–û—Ä–∞–Ω–∂–µ–≤–∞—è –≤–µ—Ç–∫–∞ üüß\",\n                      action: \"goto\",\n                      target: \"orange_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-purple\",\n                      text: \"–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞ üü™\",\n                      action: \"goto\",\n                      target: \"purple_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-lo\",\n                      text: \"–Ø –∏–∑ –õ–û üè°\",\n                      value: \"–õ–û\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-not-spb\",\n                      text: \"–Ø –Ω–µ –≤ –ü–∏—Ç–µ—Ä–µ üåç\",\n                      value: \"–ù–µ –≤ –°–ü–±\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"red_line_stations\",\n                type: \"message\",\n                position: { x: 100, y: 500 },\n                data: {\n                  messageText: \"üü• –ö–∏—Ä–æ–≤—Å–∫–æ-–í—ã–±–æ—Ä–≥—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"–∫—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è\", \"–∫–∏—Ä–æ–≤—Å–∫–æ-–≤—ã–±–æ—Ä–≥—Å–∫–∞—è\", \"–∫—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"red-devyatkino\", text: \"üü• –î–µ–≤—è—Ç–∫–∏–Ω–æ\", action: \"selection\", target: \"devyatkino\", buttonType: \"option\" },\n                    { id: \"red-grazhdansky\", text: \"üü• –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"grazhdansky\", buttonType: \"option\" },\n                    { id: \"red-akademicheskaya\", text: \"üü• –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è\", action: \"selection\", target: \"akademicheskaya\", buttonType: \"option\" },\n                    { id: \"red-politehnicheskaya\", text: \"üü• –ü–æ–ª–∏—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è\", action: \"selection\", target: \"politehnicheskaya\", buttonType: \"option\" },\n                    { id: \"red-pl-muzhestva\", text: \"üü• –ü–ª–æ—â–∞–¥—å –ú—É–∂–µ—Å—Ç–≤–∞\", action: \"selection\", target: \"pl_muzhestva\", buttonType: \"option\" },\n                    { id: \"red-lesnaya\", text: \"üü• –õ–µ—Å–Ω–∞—è\", action: \"selection\", target: \"lesnaya\", buttonType: \"option\" },\n                    { id: \"red-vyborgskaya\", text: \"üü• –í—ã–±–æ—Ä–≥—Å–∫–∞—è\", action: \"selection\", target: \"vyborgskaya\", buttonType: \"option\" },\n                    { id: \"red-pl-lenina\", text: \"üü• –ü–ª–æ—â–∞–¥—å –õ–µ–Ω–∏–Ω–∞\", action: \"selection\", target: \"pl_lenina\", buttonType: \"option\" },\n                    { id: \"red-chernyshevskaya\", text: \"üü• –ß–µ—Ä–Ω—ã—à–µ–≤—Å–∫–∞—è\", action: \"selection\", target: \"chernyshevskaya\", buttonType: \"option\" },\n                    { id: \"red-pl-vosstaniya\", text: \"üü• –ü–ª–æ—â–∞–¥—å –í–æ—Å—Å—Ç–∞–Ω–∏—è\", action: \"selection\", target: \"pl_vosstaniya\", buttonType: \"option\" },\n                    { id: \"red-vladimirskaya\", text: \"üü• –í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è\", action: \"selection\", target: \"vladimirskaya\", buttonType: \"option\" },\n                    { id: \"red-pushkinskaya\", text: \"üü• –ü—É—à–∫–∏–Ω—Å–∫–∞—è\", action: \"selection\", target: \"pushkinskaya\", buttonType: \"option\" },\n                    { id: \"red-tehinstitut1\", text: \"üü• –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç–∏—Ç—É—Ç-1\", action: \"selection\", target: \"tehinstitut1\", buttonType: \"option\" },\n                    { id: \"red-baltiyskaya\", text: \"üü• –ë–∞–ª—Ç–∏–π—Å–∫–∞—è\", action: \"selection\", target: \"baltiyskaya\", buttonType: \"option\" },\n                    { id: \"red-narvskaya\", text: \"üü• –ù–∞—Ä–≤—Å–∫–∞—è\", action: \"selection\", target: \"narvskaya\", buttonType: \"option\" },\n                    { id: \"red-kirovsky\", text: \"üü• –ö–∏—Ä–æ–≤—Å–∫–∏–π –∑–∞–≤–æ–¥\", action: \"selection\", target: \"kirovsky\", buttonType: \"option\" },\n                    { id: \"red-avtovo\", text: \"üü• –ê–≤—Ç–æ–≤–æ\", action: \"selection\", target: \"avtovo\", buttonType: \"option\" },\n                    { id: \"red-leninsky\", text: \"üü• –õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"leninsky\", buttonType: \"option\" },\n                    { id: \"red-veteranov\", text: \"üü• –ü—Ä–æ—Å–ø–µ–∫—Ç –í–µ—Ç–µ—Ä–∞–Ω–æ–≤\", action: \"selection\", target: \"veteranov\", buttonType: \"option\" },\n                    { id: \"btn-back-metro\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"blue_line_stations\",\n                type: \"message\",\n                position: { x: 700, y: 500 },\n                data: {\n                  messageText: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–æ-–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"—Å–∏–Ω—è—è –ª–∏–Ω–∏—è\", \"–º–æ—Å–∫–æ–≤—Å–∫–æ-–ø–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è\", \"—Å–∏–Ω—è—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"blue-parnas\", text: \"üü¶ –ü–∞—Ä–Ω–∞—Å\", action: \"selection\", target: \"parnas\", buttonType: \"option\" },\n                    { id: \"blue-prosp-prosvesh\", text: \"üü¶ –ü—Ä–æ—Å–ø–µ–∫—Ç –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è\", action: \"selection\", target: \"prosp_prosvesh\", buttonType: \"option\" },\n                    { id: \"blue-ozerki\", text: \"üü¶ –û–∑–µ—Ä–∫–∏\", action: \"selection\", target: \"ozerki\", buttonType: \"option\" },\n                    { id: \"blue-udelnaya\", text: \"üü¶ –£–¥–µ–ª—å–Ω–∞—è\", action: \"selection\", target: \"udelnaya\", buttonType: \"option\" },\n                    { id: \"blue-pionerskaya\", text: \"üü¶ –ü–∏–æ–Ω–µ—Ä—Å–∫–∞—è\", action: \"selection\", target: \"pionerskaya\", buttonType: \"option\" },\n                    { id: \"blue-chernaya\", text: \"üü¶ –ß–µ—Ä–Ω–∞—è —Ä–µ—á–∫–∞\", action: \"selection\", target: \"chernaya\", buttonType: \"option\" },\n                    { id: \"blue-petrogradskaya\", text: \"üü¶ –ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è\", action: \"selection\", target: \"petrogradskaya\", buttonType: \"option\" },\n                    { id: \"blue-gorkovskaya\", text: \"üü¶ –ì–æ—Ä—å–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"gorkovskaya\", buttonType: \"option\" },\n                    { id: \"blue-nevsky\", text: \"üü¶ –ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"nevsky\", buttonType: \"option\" },\n                    { id: \"blue-sennaya\", text: \"üü¶ –°–µ–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å\", action: \"selection\", target: \"sennaya\", buttonType: \"option\" },\n                    { id: \"blue-tehinstitut2\", text: \"üü¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç–∏—Ç—É—Ç-2\", action: \"selection\", target: \"tehinstitut2\", buttonType: \"option\" },\n                    { id: \"blue-frunzenskaya\", text: \"üü¶ –§—Ä—É–Ω–∑–µ–Ω—Å–∫–∞—è\", action: \"selection\", target: \"frunzenskaya\", buttonType: \"option\" },\n                    { id: \"blue-mosk-vorota\", text: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–∏–µ –≤–æ—Ä–æ—Ç–∞\", action: \"selection\", target: \"mosk_vorota\", buttonType: \"option\" },\n                    { id: \"blue-elektrosila\", text: \"üü¶ –≠–ª–µ–∫—Ç—Ä–æ—Å–∏–ª–∞\", action: \"selection\", target: \"elektrosila\", buttonType: \"option\" },\n                    { id: \"blue-park-pobedy\", text: \"üü¶ –ü–∞—Ä–∫ –ü–æ–±–µ–¥—ã\", action: \"selection\", target: \"park_pobedy\", buttonType: \"option\" },\n                    { id: \"blue-moskovskaya\", text: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"moskovskaya\", buttonType: \"option\" },\n                    { id: \"blue-zvezdnaya\", text: \"üü¶ –ó–≤–µ–∑–¥–Ω–∞—è\", action: \"selection\", target: \"zvezdnaya\", buttonType: \"option\" },\n                    { id: \"blue-kupchino\", text: \"üü¶ –ö—É–ø—á–∏–Ω–æ\", action: \"selection\", target: \"kupchino\", buttonType: \"option\" },\n                    { id: \"btn-back-metro-blue\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"green_line_stations\",\n                type: \"message\",\n                position: { x: 1000, y: 500 },\n                data: {\n                  messageText: \"üü© –ù–µ–≤—Å–∫–æ-–í–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"–∑–µ–ª–µ–Ω–∞—è –ª–∏–Ω–∏—è\", \"–Ω–µ–≤—Å–∫–æ-–≤–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è\", \"–∑–µ–ª–µ–Ω–∞—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"green-primorskaya\", text: \"üü© –ü—Ä–∏–º–æ—Ä—Å–∫–∞—è\", action: \"selection\", target: \"primorskaya\", buttonType: \"option\" },\n                    { id: \"green-vasileostr\", text: \"üü© –í–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"vasileostr\", buttonType: \"option\" },\n                    { id: \"green-gostiny\", text: \"üü© –ì–æ—Å—Ç–∏–Ω—ã–π –¥–≤–æ—Ä\", action: \"selection\", target: \"gostiny\", buttonType: \"option\" },\n                    { id: \"green-mayakovskaya\", text: \"üü© –ú–∞—è–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"mayakovskaya\", buttonType: \"option\" },\n                    { id: \"green-pl-nevsk\", text: \"üü© –ü–ª–æ—â–∞–¥—å –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ù–µ–≤—Å–∫–æ–≥–æ-1\", action: \"selection\", target: \"pl_nevsk\", buttonType: \"option\" },\n                    { id: \"green-elizarovskaya\", text: \"üü© –ï–ª–∏–∑–∞—Ä–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"elizarovskaya\", buttonType: \"option\" },\n                    { id: \"green-lomonosovskaya\", text: \"üü© –õ–æ–º–æ–Ω–æ—Å–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"lomonosovskaya\", buttonType: \"option\" },\n                    { id: \"green-proletarskaya\", text: \"üü© –ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∞—è\", action: \"selection\", target: \"proletarskaya\", buttonType: \"option\" },\n                    { id: \"green-obuhovo\", text: \"üü© –û–±—É—Ö–æ–≤–æ\", action: \"selection\", target: \"obuhovo\", buttonType: \"option\" },\n                    { id: \"green-rybackoe\", text: \"üü© –†—ã–±–∞—Ü–∫–æ–µ\", action: \"selection\", target: \"rybackoe\", buttonType: \"option\" },\n                    { id: \"green-novokrestovsk\", text: \"üü© –ù–æ–≤–æ–∫—Ä–µ—Å—Ç–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"novokrestovsk\", buttonType: \"option\" },\n                    { id: \"green-begovaya\", text: \"üü© –ë–µ–≥–æ–≤–∞—è\", action: \"selection\", target: \"begovaya\", buttonType: \"option\" },\n                    { id: \"btn-back-metro-green\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"orange_line_stations\",\n                type: \"message\",\n                position: { x: 1300, y: 500 },\n                data: {\n                  messageText: \"üüß –ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"–æ—Ä–∞–Ω–∂–µ–≤–∞—è –ª–∏–Ω–∏—è\", \"–ø—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω–∞—è\", \"–æ—Ä–∞–Ω–∂–µ–≤–∞—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"orange-spasskaya\", text: \"üüß –°–ø–∞—Å—Å–∫–∞—è\", action: \"selection\", target: \"spasskaya\", buttonType: \"option\" },\n                    { id: \"orange-dostoevskaya\", text: \"üüß –î–æ—Å—Ç–æ–µ–≤—Å–∫–∞—è\", action: \"selection\", target: \"dostoevskaya\", buttonType: \"option\" },\n                    { id: \"orange-ligovsky\", text: \"üüß –õ–∏–≥–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"ligovsky\", buttonType: \"option\" },\n                    { id: \"orange-pl-nevsk2\", text: \"üüß –ü–ª–æ—â–∞–¥—å –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ù–µ–≤—Å–∫–æ–≥–æ-2\", action: \"selection\", target: \"pl_nevsk2\", buttonType: \"option\" },\n                    { id: \"orange-novocherk\", text: \"üüß –ù–æ–≤–æ—á–µ—Ä–∫–∞—Å—Å–∫–∞—è\", action: \"selection\", target: \"novocherk\", buttonType: \"option\" },\n                    { id: \"orange-ladozhskaya\", text: \"üüß –õ–∞–¥–æ–∂—Å–∫–∞—è\", action: \"selection\", target: \"ladozhskaya\", buttonType: \"option\" },\n                    { id: \"orange-bolshevikov\", text: \"üüß –ü—Ä–æ—Å–ø–µ–∫—Ç –ë–æ–ª—å—à–µ–≤–∏–∫–æ–≤\", action: \"selection\", target: \"bolshevikov\", buttonType: \"option\" },\n                    { id: \"orange-dybenko\", text: \"üüß –î—ã–±–µ–Ω–∫–æ\", action: \"selection\", target: \"dybenko\", buttonType: \"option\" },\n                    { id: \"orange-gorny\", text: \"üüß –ì–æ—Ä–Ω—ã–π –∏–Ω—Å—Ç–∏—Ç—É—Ç\", action: \"selection\", target: \"gorny\", buttonType: \"option\" },\n                    { id: \"btn-back-metro-orange\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"purple_line_stations\",\n                type: \"message\",\n                position: { x: 1600, y: 500 },\n                data: {\n                  messageText: \"üü™ –§—Ä—É–Ω–∑–µ–Ω—Å–∫–æ-–ü—Ä–∏–º–æ—Ä—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è\", \"—Ñ—Ä—É–Ω–∑–µ–Ω—Å–∫–æ-–ø—Ä–∏–º–æ—Ä—Å–∫–∞—è\", \"—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"purple-komendantsky\", text: \"üü™ –ö–æ–º–µ–Ω–¥–∞–Ω—Ç—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"komendantsky\", buttonType: \"option\" },\n                    { id: \"purple-staraya\", text: \"üü™ –°—Ç–∞—Ä–∞—è –î–µ—Ä–µ–≤–Ω—è\", action: \"selection\", target: \"staraya\", buttonType: \"option\" },\n                    { id: \"purple-krestovsky\", text: \"üü™ –ö—Ä–µ—Å—Ç–æ–≤—Å–∫–∏–π –æ—Å—Ç—Ä–æ–≤\", action: \"selection\", target: \"krestovsky\", buttonType: \"option\" },\n                    { id: \"purple-chkalovskaya\", text: \"üü™ –ß–∫–∞–ª–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"chkalovskaya\", buttonType: \"option\" },\n                    { id: \"purple-sportivnaya\", text: \"üü™ –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è\", action: \"selection\", target: \"sportivnaya\", buttonType: \"option\" },\n                    { id: \"purple-admiralteyskaya\", text: \"üü™ –ê–¥–º–∏—Ä–∞–ª—Ç–µ–π—Å–∫–∞—è\", action: \"selection\", target: \"admiralteyskaya\", buttonType: \"option\" },\n                    { id: \"purple-sadovaya\", text: \"üü™ –°–∞–¥–æ–≤–∞—è\", action: \"selection\", target: \"sadovaya\", buttonType: \"option\" },\n                    { id: \"purple-zvenigorodskaya\", text: \"üü™ –ó–≤–µ–Ω–∏–≥–æ—Ä–æ–¥—Å–∫–∞—è\", action: \"selection\", target: \"zvenigorodskaya\", buttonType: \"option\" },\n                    { id: \"purple-obvodniy\", text: \"üü™ –û–±–≤–æ–¥–Ω—ã–π –∫–∞–Ω–∞–ª\", action: \"selection\", target: \"obvodniy\", buttonType: \"option\" },\n                    { id: \"purple-volkovskaya\", text: \"üü™ –í–æ–ª–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"volkovskaya\", buttonType: \"option\" },\n                    { id: \"purple-buharestskaya\", text: \"üü™ –ë—É—Ö–∞—Ä–µ—Å—Ç—Å–∫–∞—è\", action: \"selection\", target: \"buharestskaya\", buttonType: \"option\" },\n                    { id: \"purple-mezhdunar\", text: \"üü™ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è\", action: \"selection\", target: \"mezhdunar\", buttonType: \"option\" },\n                    { id: \"btn-back-metro-purple\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n            ]\n          },\n\n          // –õ–∏—Å—Ç 4: –ò–Ω—Ç–µ—Ä–µ—Å—ã –∏ —Ö–æ–±–±–∏\n          {\n            id: \"interests_sheet\",\n            name: \"üéØ –ò–Ω—Ç–µ—Ä–µ—Å—ã\",\n            nodes: [\n              {\n                id: \"interests_categories\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤: üéØ\\n\\n(–ú–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)\",\n                  synonyms: [\"–∏–Ω—Ç–µ—Ä–µ—Å—ã\", \"—Ö–æ–±–±–∏\", \"—É–≤–ª–µ—á–µ–Ω–∏—è\", \"—á—Ç–æ –Ω—Ä–∞–≤–∏—Ç—Å—è\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"interests_categories\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    {\n                      id: \"btn-music\",\n                      text: \"üéµ –ú—É–∑—ã–∫–∞\",\n                      action: \"goto\",\n                      target: \"music_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-hobby\",\n                      text: \"üé® –•–æ–±–±–∏\",\n                      action: \"goto\",\n                      target: \"hobby_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-social\",\n                      text: \"üë• –û–±—â–µ–Ω–∏–µ\",\n                      action: \"goto\",\n                      target: \"social_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-creativity\",\n                      text: \"üé≠ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ\",\n                      action: \"goto\",\n                      target: \"creativity_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-active\",\n                      text: \"‚öΩ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\",\n                      action: \"goto\",\n                      target: \"active_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-food\",\n                      text: \"üçî –ï–¥–∞\",\n                      action: \"goto\",\n                      target: \"food_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-sport\",\n                      text: \"üèãÔ∏è –°–ø–æ—Ä—Ç\",\n                      action: \"goto\",\n                      target: \"sport_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"music_interests\",\n                type: \"message\",\n                position: { x: 100, y: 500 },\n                data: {\n                  messageText: \"üéµ –ö–∞–∫–∞—è –º—É–∑—ã–∫–∞ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?\\n\\n(–ú–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)\",\n                  synonyms: [\"–º—É–∑—ã–∫–∞\", \"–ø–µ—Å–Ω–∏\", \"—Ç—Ä–µ–∫–∏\", \"–∂–∞–Ω—Ä—ã\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"music-pop\", text: \"üé§ –ü–æ–ø\", action: \"selection\", target: \"pop\", buttonType: \"option\" },\n                    { id: \"music-rock\", text: \"üé∏ –†–æ–∫\", action: \"selection\", target: \"rock\", buttonType: \"option\" },\n                    { id: \"music-electronic\", text: \"üéß –≠–ª–µ–∫—Ç—Ä–æ\", action: \"selection\", target: \"electronic\", buttonType: \"option\" },\n                    { id: \"music-jazz\", text: \"üé∫ –î–∂–∞–∑\", action: \"selection\", target: \"jazz\", buttonType: \"option\" },\n                    { id: \"music-classical\", text: \"üéº –ö–ª–∞—Å—Å–∏–∫–∞\", action: \"selection\", target: \"classical\", buttonType: \"option\" },\n                    { id: \"music-hiphop\", text: \"üé§ –•–∏–ø-—Ö–æ–ø\", action: \"selection\", target: \"hiphop\", buttonType: \"option\" },\n                    { id: \"music-indie\", text: \"üé∏ –ò–Ω–¥–∏\", action: \"selection\", target: \"indie\", buttonType: \"option\" },\n                    { id: \"music-rnb\", text: \"üéµ R&B\", action: \"selection\", target: \"rnb\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-music\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"hobby_interests\",\n                type: \"message\",\n                position: { x: 700, y: 500 },\n                data: {\n                  messageText: \"üé® –ö–∞–∫–∏–µ —É —Ç–µ–±—è —Ö–æ–±–±–∏?\\n\\n(–ú–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)\",\n                  synonyms: [\"—Ö–æ–±–±–∏\", \"—É–≤–ª–µ—á–µ–Ω–∏—è\", \"–∑–∞–Ω—è—Ç–∏—è\", \"–¥–æ—Å—É–≥\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"hobby-reading\", text: \"üìö –ß—Ç–µ–Ω–∏–µ\", action: \"selection\", target: \"reading\", buttonType: \"option\" },\n                    { id: \"hobby-gaming\", text: \"üéÆ –ò–≥—Ä—ã\", action: \"selection\", target: \"gaming\", buttonType: \"option\" },\n                    { id: \"hobby-cooking\", text: \"üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∫–∞\", action: \"selection\", target: \"cooking\", buttonType: \"option\" },\n                    { id: \"hobby-gardening\", text: \"üå± –°–∞–¥–æ–≤–æ–¥—Å—Ç–≤–æ\", action: \"selection\", target: \"gardening\", buttonType: \"option\" },\n                    { id: \"hobby-collecting\", text: \"üè∫ –ö–æ–ª–ª–µ–∫—Ü–∏–∏\", action: \"selection\", target: \"collecting\", buttonType: \"option\" },\n                    { id: \"hobby-diy\", text: \"üî® DIY\", action: \"selection\", target: \"diy\", buttonType: \"option\" },\n                    { id: \"hobby-pets\", text: \"üêï –ñ–∏–≤–æ—Ç–Ω—ã–µ\", action: \"selection\", target: \"pets\", buttonType: \"option\" },\n                    { id: \"hobby-tech\", text: \"üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\", action: \"selection\", target: \"tech\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-hobby\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"social_interests\",\n                type: \"message\",\n                position: { x: 100, y: 500 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üë• –û–±—â–µ–Ω–∏–µ:\",\n                  synonyms: [\"–æ–±—â–µ–Ω–∏–µ\", \"—Å–æ—Ü–∏–∞–ª—å–Ω–æ–µ\", \"–ª—é–¥–∏\", \"—Ç—É—Å–æ–≤–∫–∏\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"social-parties\", text: \"üéâ –í–µ—á–µ—Ä–∏–Ω–∫–∏\", action: \"selection\", target: \"parties\", buttonType: \"option\" },\n                    { id: \"social-networking\", text: \"ü§ù –ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥\", action: \"selection\", target: \"networking\", buttonType: \"option\" },\n                    { id: \"social-dating\", text: \"üíï –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞\", action: \"selection\", target: \"dating\", buttonType: \"option\" },\n                    { id: \"social-volunteering\", text: \"ü§≤ –í–æ–ª–æ–Ω—Ç—ë—Ä—Å—Ç–≤–æ\", action: \"selection\", target: \"volunteering\", buttonType: \"option\" },\n                    { id: \"social-events\", text: \"üé™ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è\", action: \"selection\", target: \"events\", buttonType: \"option\" },\n                    { id: \"social-community\", text: \"üë• –°–æ–æ–±—â–µ—Å—Ç–≤–∞\", action: \"selection\", target: \"community\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-social\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"creativity_interests\",\n                type: \"message\",\n                position: { x: 700, y: 700 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üé≠ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ:\",\n                  synonyms: [\"—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ\", \"–∏—Å–∫—É—Å—Å—Ç–≤–æ\", \"—Ä–∏—Å–æ–≤–∞–Ω–∏–µ\", \"–º—É–∑—ã–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"creativity-art\", text: \"üé® –†–∏—Å–æ–≤–∞–Ω–∏–µ\", action: \"selection\", target: \"art\", buttonType: \"option\" },\n                    { id: \"creativity-music\", text: \"üéµ –ú—É–∑—ã–∫–∞\", action: \"selection\", target: \"music\", buttonType: \"option\" },\n                    { id: \"creativity-photography\", text: \"üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è\", action: \"selection\", target: \"photography\", buttonType: \"option\" },\n                    { id: \"creativity-writing\", text: \"‚úçÔ∏è –ü–∏—Å–∞—Ç–µ–ª—å—Å—Ç–≤–æ\", action: \"selection\", target: \"writing\", buttonType: \"option\" },\n                    { id: \"creativity-design\", text: \"üñåÔ∏è –î–∏–∑–∞–π–Ω\", action: \"selection\", target: \"design\", buttonType: \"option\" },\n                    { id: \"creativity-handmade\", text: \"üß∂ –†—É–∫–æ–¥–µ–ª–∏–µ\", action: \"selection\", target: \"handmade\", buttonType: \"option\" },\n                    { id: \"creativity-theater\", text: \"üé≠ –¢–µ–∞—Ç—Ä\", action: \"selection\", target: \"theater\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-creativity\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"active_interests\",\n                type: \"message\",\n                position: { x: 1000, y: 700 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚öΩ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:\",\n                  synonyms: [\"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\", \"–∞–∫—Ç–∏–≤–Ω—ã–π\", \"–¥–≤–∏–∂–µ–Ω–∏–µ\", \"–∑–¥–æ—Ä–æ–≤—å–µ\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"active-running\", text: \"üèÉ –ë–µ–≥\", action: \"selection\", target: \"running\", buttonType: \"option\" },\n                    { id: \"active-gym\", text: \"üí™ –¢—Ä–µ–Ω–∞–∂—ë—Ä–Ω—ã–π –∑–∞–ª\", action: \"selection\", target: \"gym\", buttonType: \"option\" },\n                    { id: \"active-cycling\", text: \"üö¥ –í–µ–ª–æ—Å–∏–ø–µ–¥\", action: \"selection\", target: \"cycling\", buttonType: \"option\" },\n                    { id: \"active-hiking\", text: \"ü•æ –ü–æ—Ö–æ–¥—ã\", action: \"selection\", target: \"hiking\", buttonType: \"option\" },\n                    { id: \"active-yoga\", text: \"üßò –ô–æ–≥–∞\", action: \"selection\", target: \"yoga\", buttonType: \"option\" },\n                    { id: \"active-swimming\", text: \"üèä –ü–ª–∞–≤–∞–Ω–∏–µ\", action: \"selection\", target: \"swimming\", buttonType: \"option\" },\n                    { id: \"active-dancing\", text: \"üíÉ –¢–∞–Ω—Ü—ã\", action: \"selection\", target: \"dancing\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-active\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"food_interests\",\n                type: \"message\",\n                position: { x: 1300, y: 700 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üçî –ï–¥–∞:\",\n                  synonyms: [\"–µ–¥–∞\", \"–Ω–∞–ø–∏—Ç–∫–∏\", \"–∫—É—Ö–Ω—è\", \"—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"food-cooking\", text: \"üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∫–∞\", action: \"selection\", target: \"cooking\", buttonType: \"option\" },\n                    { id: \"food-restaurants\", text: \"üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω—ã\", action: \"selection\", target: \"restaurants\", buttonType: \"option\" },\n                    { id: \"food-wine\", text: \"üç∑ –í–∏–Ω–æ\", action: \"selection\", target: \"wine\", buttonType: \"option\" },\n                    { id: \"food-coffee\", text: \"‚òï –ö–æ—Ñ–µ\", action: \"selection\", target: \"coffee\", buttonType: \"option\" },\n                    { id: \"food-baking\", text: \"üßÅ –í—ã–ø–µ—á–∫–∞\", action: \"selection\", target: \"baking\", buttonType: \"option\" },\n                    { id: \"food-street\", text: \"üåÆ –°—Ç—Ä–∏—Ç-—Ñ—É–¥\", action: \"selection\", target: \"street_food\", buttonType: \"option\" },\n                    { id: \"food-healthy\", text: \"ü•ó –ó–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ\", action: \"selection\", target: \"healthy_food\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-food\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"sport_interests\",\n                type: \"message\",\n                position: { x: 1600, y: 700 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üèãÔ∏è –°–ø–æ—Ä—Ç:\",\n                  synonyms: [\"—Å–ø–æ—Ä—Ç\", \"—Ñ–∏—Ç–Ω–µ—Å\", \"—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\", \"—Ñ—É—Ç–±–æ–ª\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"sport-football\", text: \"‚öΩ –§—É—Ç–±–æ–ª\", action: \"selection\", target: \"football\", buttonType: \"option\" },\n                    { id: \"sport-basketball\", text: \"üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª\", action: \"selection\", target: \"basketball\", buttonType: \"option\" },\n                    { id: \"sport-tennis\", text: \"üéæ –¢–µ–Ω–Ω–∏—Å\", action: \"selection\", target: \"tennis\", buttonType: \"option\" },\n                    { id: \"sport-hockey\", text: \"üèí –•–æ–∫–∫–µ–π\", action: \"selection\", target: \"hockey\", buttonType: \"option\" },\n                    { id: \"sport-volleyball\", text: \"üèê –í–æ–ª–µ–π–±–æ–ª\", action: \"selection\", target: \"volleyball\", buttonType: \"option\" },\n                    { id: \"sport-mma\", text: \"ü•ä –ï–¥–∏–Ω–æ–±–æ—Ä—Å—Ç–≤–∞\", action: \"selection\", target: \"mma\", buttonType: \"option\" },\n                    { id: \"sport-esports\", text: \"üéÆ –ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç\", action: \"selection\", target: \"esports\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-sport\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n            ]\n          },\n\n          // –õ–∏—Å—Ç 5: –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n          {\n            id: \"personal_sheet\",\n            name: \"üíù –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\",\n            nodes: [\n              {\n                id: \"marital_status\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–¢–≤–æ–µ —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: üíç\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"marital_status\",\n                  synonyms: [\"—Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\", \"–æ—Ç–Ω–æ—à–µ–Ω–∏—è\", \"—Å—Ç–∞—Ç—É—Å\"],\n                  buttons: [\n                    {\n                      id: \"btn-single\",\n                      text: \"–•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º üíö\",\n                      value: \"single\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-relationship\",\n                      text: \"–í –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö üíô\",\n                      value: \"relationship\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-married\",\n                      text: \"–ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º üíõ\",\n                      value: \"married\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-complicated\",\n                      text: \"–í—Å—ë —Å–ª–æ–∂–Ω–æ ü§∑\",\n                      value: \"complicated\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"sexual_orientation\",\n                type: \"message\",\n                position: { x: 400, y: 500 },\n                data: {\n                  messageText: \"–¢–≤–æ—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: üåà\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"sexual_orientation\",\n                  synonyms: [\"–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è\", \"–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è\", \"–∏–Ω—Ç–µ—Ä–µ—Å\"],\n                  buttons: [\n                    {\n                      id: \"btn-hetero\",\n                      text: \"–ì–µ—Ç–µ—Ä–æ üë´\",\n                      value: \"heterosexual\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-gay\",\n                      text: \"–ì–µ–π üë¨\",\n                      value: \"gay\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-lesbian\",\n                      text: \"–õ–µ—Å–±–∏—è–Ω–∫–∞ üë≠\",\n                      value: \"lesbian\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-bi\",\n                      text: \"–ë–∏ üåà\",\n                      value: \"bisexual\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-other\",\n                      text: \"–î—Ä—É–≥–æ–µ üé≠\",\n                      value: \"other\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"channel_choice\",\n                type: \"message\",\n                position: { x: 400, y: 700 },\n                data: {\n                  messageText: \"–•–æ—á–µ—à—å —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–π —Ç–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª? üì¢\\n\\n–í–≤–µ–¥–∏ —Å—Å—ã–ª–∫—É, –Ω–∏–∫ —Å @ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏–º—è –∫–∞–Ω–∞–ª–∞, –ª–∏–±–æ –Ω–∞–∂–º–∏ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å':\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"telegram_channel\",\n                  synonyms: [\"–∫–∞–Ω–∞–ª\", \"—Ç–≥\", \"—Ç–µ–ª–µ–≥—Ä–∞–º\", \"—Å—Å—ã–ª–∫–∞\"],\n                  inputTargetNodeId: \"extra_info\",\n                  buttons: [\n                    {\n                      id: \"btn-skip-channel\",\n                      text: \"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚è≠Ô∏è\",\n                      action: \"goto\",\n                      target: \"extra_info\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"extra_info\",\n                type: \"message\",\n                position: { x: 400, y: 900 },\n                data: {\n                  messageText: \"–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —á—Ç–æ-—Ç–æ –µ—â—ë –æ —Å–µ–±–µ? üìù\\n\\n–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ (–¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤) –∏–ª–∏ –Ω–∞–∂–º–∏ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å':\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"extra_info\",\n                  synonyms: [\"–æ —Å–µ–±–µ\", \"–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ\", \"–±–æ–ª—å—à–µ\", \"–µ—â–µ\"],\n                  inputTargetNodeId: \"profile_complete\",\n                  buttons: [\n                    {\n                      id: \"btn-skip-extra\",\n                      text: \"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚è≠Ô∏è\",\n                      action: \"goto\",\n                      target: \"profile_complete\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n            ]\n          },\n\n          // –õ–∏—Å—Ç 6: –ü—Ä–æ—Ñ–∏–ª—å –∏ –∫–æ–º–∞–Ω–¥—ã\n          {\n            id: \"profile_sheet\",\n            name: \"üë§ –ü—Ä–æ—Ñ–∏–ª—å\",\n            nodes: [\n              {\n                id: \"profile_complete\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n                  synonyms: [],\n                  keyboardType: \"inline\",\n                  removeKeyboard: false,\n                  enableConditionalMessages: true,\n                  conditionalMessages: [\n                    {\n                      id: \"with_both\",\n                      condition: \"user_data_exists\",\n                      variableNames: [\"telegram_channel\", \"extra_info\"],\n                      messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n–¢–µ–ª–µ–≥—Ä–∞–º: {telegram_channel} üì¢\\n–û —Å–µ–±–µ: {extra_info} üìù\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n                      formatMode: \"text\",\n                      keyboardType: \"inline\",\n                      buttons: [\n                        {\n                          id: \"btn-chat-link\",\n                          text: \"–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç üîó\",\n                          action: \"command\",\n                          target: \"/link\",\n                          buttonType: \"normal\"\n                        },\n                        {\n                          id: \"btn-show-profile-edit\",\n                          text: \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚úèÔ∏è\",\n                          action: \"command\",\n                          target: \"/profile\",\n                          buttonType: \"normal\"\n                        }\n                      ],\n                      priority: 1\n                    },\n                    {\n                      id: \"with_telegram_only\",\n                      condition: \"user_data_exists\",\n                      variableNames: [\"telegram_channel\"],\n                      messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n–¢–µ–ª–µ–≥—Ä–∞–º: {telegram_channel} üì¢\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n                      formatMode: \"text\",\n                      keyboardType: \"inline\",\n                      buttons: [\n                        {\n                          id: \"btn-chat-link\",\n                          text: \"–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç üîó\",\n                          action: \"command\",\n                          target: \"/link\",\n                          buttonType: \"normal\"\n                        },\n                        {\n                          id: \"btn-show-profile-edit\",\n                          text: \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚úèÔ∏è\",\n                          action: \"command\",\n                          target: \"/profile\",\n                          buttonType: \"normal\"\n                        }\n                      ],\n                      priority: 2\n                    },\n                    {\n                      id: \"with_extra_only\",\n                      condition: \"user_data_exists\",\n                      variableNames: [\"extra_info\"],\n                      messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n–û —Å–µ–±–µ: {extra_info} üìù\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n                      formatMode: \"text\",\n                      keyboardType: \"inline\",\n                      buttons: [\n                        {\n                          id: \"btn-chat-link\",\n                          text: \"–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç üîó\",\n                          action: \"command\",\n                          target: \"/link\",\n                          buttonType: \"normal\"\n                        },\n                        {\n                          id: \"btn-show-profile-edit\",\n                          text: \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚úèÔ∏è\",\n                          action: \"command\",\n                          target: \"/profile\",\n                          buttonType: \"normal\"\n                        }\n                      ],\n                      priority: 3\n                    }\n                  ],\n                  buttons: [\n                    {\n                      id: \"btn-chat-link\",\n                      text: \"–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç üîó\",\n                      action: \"command\",\n                      target: \"/link\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-show-profile-edit\",\n                      text: \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚úèÔ∏è\",\n                      action: \"command\",\n                      target: \"/profile\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"show_profile\",\n                type: \"command\",\n                position: { x: 400, y: 500 },\n                data: {\n                  command: \"/profile\",\n                  commandName: \"/profile\",\n                  description: \"–ü–æ–∫–∞–∑–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\",\n                  synonyms: [\"–ø—Ä–æ—Ñ–∏–ª—å\", \"–∞–Ω–∫–µ—Ç–∞\", \"–º–æ–∏ –¥–∞–Ω–Ω—ã–µ\", \"—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å\"],\n                  messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                  keyboardType: \"inline\",\n                  enableConditionalMessages: true,\n                  conditionalMessages: [\n                    {\n                      id: \"with_both_show\",\n                      condition: \"user_data_exists\",\n                      variableNames: [\"telegram_channel\", \"extra_info\"],\n                      messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n–¢–µ–ª–µ–≥—Ä–∞–º: {telegram_channel} üì¢\\n–û —Å–µ–±–µ: {extra_info} üìù\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                      formatMode: \"text\",\n                      keyboardType: \"inline\",\n                      priority: 1\n                    },\n                    {\n                      id: \"with_telegram_only_show\",\n                      condition: \"user_data_exists\",\n                      variableNames: [\"telegram_channel\"],\n                      messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n–¢–µ–ª–µ–≥—Ä–∞–º: {telegram_channel} üì¢\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                      formatMode: \"text\",\n                      keyboardType: \"inline\",\n                      priority: 2\n                    },\n                    {\n                      id: \"with_extra_only_show\",\n                      condition: \"user_data_exists\",\n                      variableNames: [\"extra_info\"],\n                      messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n–û —Å–µ–±–µ: {extra_info} üìù\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                      formatMode: \"text\",\n                      keyboardType: \"inline\",\n                      priority: 3\n                    }\n                  ],\n                  buttons: [\n                    {\n                      id: \"btn-edit-gender\",\n                      text: \"üë§ –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª\",\n                      action: \"goto\",\n                      target: \"gender_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-name\",\n                      text: \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è\",\n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-age\",\n                      text: \"üéÇ –ò–∑–º–µ–Ω–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç\",\n                      action: \"goto\",\n                      target: \"age_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-metro\",\n                      text: \"üöá –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç—Ä–æ\",\n                      action: \"goto\",\n                      target: \"metro_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-interests\",\n                      text: \"üéØ –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-marital\",\n                      text: \"üíç –ò–∑–º–µ–Ω–∏—Ç—å —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\",\n                      action: \"goto\",\n                      target: \"marital_status\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-orientation\",\n                      text: \"üåà –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-channel\",\n                      text: \"üì¢ –£–∫–∞–∑–∞—Ç—å –¢–ì–ö\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-extra\",\n                      text: \"üìù –î–æ–±–∞–≤–∏—Ç—å –æ —Å–µ–±–µ\",\n                      action: \"goto\",\n                      target: \"extra_info\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-restart-from-profile\",\n                      text: \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\",\n                      action: \"command\",\n                      target: \"/start\",\n                      buttonType: \"navigation\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"chat_link\",\n                type: \"command\",\n                position: { x: 400, y: 700 },\n                data: {\n                  command: \"/link\",\n                  commandName: \"/link\",\n                  description: \"–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞\",\n                  synonyms: [\"—Å—Å—ã–ª–∫–∞\", \"—á–∞—Ç\", \"—Å–æ–æ–±—â–µ—Å—Ç–≤–æ\", \"–≤–ø—Ä–æ–≥—É–ª–∫–µ\", \"–ª–∏–Ω–∫\"],\n                  messageText: \"üîó –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç:\\n\\nhttps://t.me/+agkIVgCzHtY2ZTA6\\n\\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ ·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á! üéâ\",\n                  keyboardType: \"none\",\n                  buttons: [],\n                  markdown: false\n                }\n              },\n              {\n                id: \"help_command\",\n                type: \"command\",\n                position: { x: 400, y: 900 },\n                data: {\n                  command: \"/help\",\n                  commandName: \"/help\", \n                  description: \"–ü–æ–º–æ—â—å –∏ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏\",\n                  synonyms: [\"–ø–æ–º–æ—â—å\", \"—Å–ø—Ä–∞–≤–∫–∞\", \"–∫–æ–º–∞–Ω–¥—ã\", \"—á—Ç–æ –ø–∏—Å–∞—Ç—å\", \"–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è\"],\n                  messageText: \"ü§ñ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä!**\\n\\nüåü **·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á Bot**\\n*–¢–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞—Ö*\\n\\n\\nüìã **–î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´**\\n\\nüöÄ **Start** ‚Äî –ù–∞—á–∞—Ç—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ\\n   üìù *—Å—Ç–∞—Ä—Ç, –Ω–∞—á–∞—Ç—å, –ø—Ä–∏–≤–µ—Ç, –Ω–∞—á–∞–ª–æ, –Ω–∞—á–∏–Ω–∞–µ–º*\\n\\nüë§ **Profile** ‚Äî –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å\\n   üìù *–ø—Ä–æ—Ñ–∏–ª—å, –∞–Ω–∫–µ—Ç–∞, –º–æ–∏ –¥–∞–Ω–Ω—ã–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å*\\n\\nüîó **Link** ‚Äî –°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç\\n   üìù *—Å—Å—ã–ª–∫–∞, —á–∞—Ç, —Å–æ–æ–±—â–µ—Å—Ç–≤–æ, –≤–ø—Ä–æ–≥—É–ª–∫–µ, –ª–∏–Ω–∫*\\n\\n‚ùì **Help** ‚Äî –°–ø—Ä–∞–≤–∫–∞ –∏ –∫–æ–º–∞–Ω–¥—ã\\n   üìù *–ø–æ–º–æ—â—å, —Å–ø—Ä–∞–≤–∫–∞, –∫–æ–º–∞–Ω–¥—ã, —á—Ç–æ –ø–∏—Å–∞—Ç—å*\\n\\n\\nüí° **–ö–ê–ö –ü–û–õ–¨–ó–û–í–ê–¢–¨–°–Ø**\\n\\n‚ú® –ü–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —Å–∏–Ω–æ–Ω–∏–º—ã –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ\\n‚ú® –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã —Å —Å–∏–º–≤–æ–ª–æ–º /\\n‚ú® –ë–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Ä–µ—á—å!\\n\\nüéâ **–£–¥–∞—á–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ!**\",\n                  keyboardType: \"none\",\n                  buttons: [],\n                  markdown: true\n                }\n              }\n            ]\n          }\n        ],\n\n        // –°–≤—è–∑–∏ –º–µ–∂–¥—É –ª–∏—Å—Ç–∞–º–∏\n        interSheetConnections: [\n          // –ò–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n          {\n            id: \"inter-welcome-basic\",\n            sourceSheetId: \"welcome_sheet\",\n            targetSheetId: \"basic_info_sheet\",\n            sourceNodeId: \"join_request\",\n            targetNodeId: \"gender_selection\",\n            sourceHandle: \"btn-yes\",\n            targetHandle: \"target\"\n          },\n          // –ò–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫ –º–µ—Ç—Ä–æ\n          {\n            id: \"inter-basic-metro\",\n            sourceSheetId: \"basic_info_sheet\",\n            targetSheetId: \"metro_sheet\",\n            sourceNodeId: \"age_input\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          // –ò–∑ –º–µ—Ç—Ä–æ –∫ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º\n          {\n            id: \"inter-metro-interests\",\n            sourceSheetId: \"metro_sheet\",\n            targetSheetId: \"interests_sheet\",\n            sourceNodeId: \"metro_selection\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          // –ò–∑ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –∫ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n          {\n            id: \"inter-interests-personal\",\n            sourceSheetId: \"interests_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"interests_categories\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          // –ò–∑ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫ –ø—Ä–æ—Ñ–∏–ª—é\n          {\n            id: \"inter-personal-profile\",\n            sourceSheetId: \"personal_sheet\",\n            targetSheetId: \"profile_sheet\",\n            sourceNodeId: \"extra_info\",\n            targetNodeId: \"profile_complete\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è - –≤–æ–∑–≤—Ä–∞—Ç –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ª–∏—Å—Ç–∞–º\n          {\n            id: \"inter-profile-basic-gender\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"basic_info_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"gender_selection\",\n            sourceHandle: \"btn-edit-gender\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-basic-name\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"basic_info_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"name_input\",\n            sourceHandle: \"btn-edit-name\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-basic-age\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"basic_info_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"age_input\",\n            sourceHandle: \"btn-edit-age\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-metro\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"metro_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"btn-edit-metro\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-interests\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"interests_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-edit-interests\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-personal-marital\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"btn-edit-marital\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-personal-orientation\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"sexual_orientation\",\n            sourceHandle: \"btn-edit-orientation\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-personal-channel\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"channel_choice\",\n            sourceHandle: \"btn-edit-channel\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-personal-extra\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"extra_info\",\n            sourceHandle: \"btn-edit-extra\",\n            targetHandle: \"target\"\n          }\n        ]\n      }\n    });\n\n    console.log('‚úÖ –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω –í–ü—Ä–æ–≥—É–ª–∫–µ —Å–æ–∑–¥–∞–Ω');\n\n    // –°–æ–∑–¥–∞–µ–º —à–∞–±–ª–æ–Ω —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n    await storage.createBotTemplate({\n      name: \"üëÆ‚Äç‚ôÇÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞\",\n      description: \"–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –≥—Ä—É–ø–ø—ã: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\",\n      category: \"utility\",\n      tags: [\"–º–æ–¥–µ—Ä–∞—Ü–∏—è\", \"–∞–¥–º–∏–Ω\", \"—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\", \"–≥—Ä—É–ø–ø–∞\", \"–∫–æ–Ω—Ç–µ–Ω—Ç\", \"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏\", \"–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ\"],\n      isPublic: 1,\n      difficulty: \"medium\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"1.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 6,\n      estimatedTime: 20,\n      data: {\n        sheets: [\n          {\n            id: \"main_sheet\",\n            name: \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n            description: \"–û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º –º–æ–¥–µ—Ä–∞—Ü–∏–∏\",\n            nodes: [\n              {\n                id: \"start\",\n                type: \"start\",\n                position: { x: 400, y: 200 },\n                data: {\n                  command: \"/start\",\n                  description: \"–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é\",\n                  messageText: \"üëÆ‚Äç‚ôÇÔ∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞!\\n\\n–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —É–ø—Ä–∞–≤–ª—è—Ç—å –≥—Ä—É–ø–ø–æ–π —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥.\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-help\",\n                      text: \"‚ùì –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º\",\n                      action: \"goto\",\n                      target: \"help_commands\",\n                      buttonType: \"navigation\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"help_commands\",\n                type: \"command\",\n                position: { x: 400, y: 500 },\n                data: {\n                  command: \"/help\",\n                  description: \"–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞\",\n                  messageText: \"‚ùì **–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞**\\n\\n**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º:**\\nüìå `/pin_message` - –ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `–∑–∞–∫—Ä–µ–ø–∏—Ç—å`, `–ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å`, `–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å`\\n\\nüìå‚ùå `/unpin_message` - –û—Ç–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `–æ—Ç–∫—Ä–µ–ø–∏—Ç—å`, `–æ—Ç—Ü–µ–ø–∏—Ç—å`, `—É–±—Ä–∞—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ`\\n\\nüóëÔ∏è `/delete_message` - –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `—É–¥–∞–ª–∏—Ç—å`, `—Å—Ç–µ—Ä–µ—Ç—å`, `—É–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ`\\n\\n**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:**\\nüö´ `/ban_user` - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `–∑–∞–±–∞–Ω–∏—Ç—å`, `–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å`, `–±–∞–Ω`\\n\\n‚úÖ `/unban_user` - –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `—Ä–∞–∑–±–∞–Ω–∏—Ç—å`, `—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å`, `unb–∞–Ω`\\n\\nüîá `/mute_user` - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `–∑–∞–º—É—Ç–∏—Ç—å`, `–∑–∞–≥–ª—É—à–∏—Ç—å`, `–º—É—Ç`\\n\\nüîä `/unmute_user` - –°–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `—Ä–∞–∑–º—É—Ç–∏—Ç—å`, `—Ä–∞–∑–≥–ª—É—à–∏—Ç—å`, `–∞–Ω–º—É—Ç`\\n\\nüë¢ `/kick_user` - –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `–∫–∏–∫–Ω—É—Ç—å`, `–∏—Å–∫–ª—é—á–∏—Ç—å`, `–≤—ã–≥–Ω–∞—Ç—å`\\n\\nüëë `/promote_user` - –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `–ø–æ–≤—ã—Å–∏—Ç—å`, `–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º`, `–ø—Ä–æ–º–æ—É—Ç`\\n\\nüë§ `/demote_user` - –°–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `–ø–æ–Ω–∏–∑–∏—Ç—å`, `—Å–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∞`, `–¥–µ–º–æ—É—Ç`\\n\\n‚öôÔ∏è `/admin_rights` - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\\n   –°–∏–Ω–æ–Ω–∏–º—ã: `–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞`, `–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞`, `—Ç–≥ –ø—Ä–∞–≤–∞`\\n   ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≥—Ä—É–ø–ø—ã!\\n   üí° –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ–º–∞–Ω–¥–æ–π\\n\\n**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**\\n‚Ä¢ –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π –¥–ª—è –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏\\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π\\n‚Ä¢ –ö–æ–º–∞–Ω–¥—ã —Å –ø—Ä–∞–≤–∞–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö/—Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞—Ö\\n‚Ä¢ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏\",\n                  synonyms: [\"—Å–ø—Ä–∞–≤–∫–∞\", \"–ø–æ–º–æ—â—å\", \"–∫–æ–º–∞–Ω–¥—ã\", \"—Ö–µ–ª–ø\"],\n                  markdown: true,\n                  formatMode: \"markdown\",\n                  keyboardType: \"none\",\n                  buttons: [],\n                  showInMenu: true,\n                  isPrivateOnly: false,\n                  requiresAuth: false,\n                  adminOnly: false\n                }\n              }\n            ],\n            connections: [\n              {\n                id: \"start-help\",\n                sourceNodeId: \"start\",\n                targetNodeId: \"help_commands\",\n                sourceHandle: \"btn-help\",\n                targetHandle: \"target\"\n              }\n            ]\n          },\n          {\n            id: \"content_sheet\",\n            name: \"üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\",\n            description: \"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞\",\n            nodes: [\n              {\n                id: \"pin_message_node\",\n                type: \"pin_message\",\n                position: { x: 200, y: 300 },\n                data: {\n                  command: \"/pin_message\",\n                  messageText: \"üìå –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ!\",\n                  synonyms: [\"–∑–∞–∫—Ä–µ–ø–∏—Ç—å\", \"–ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å\", \"–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å\"],\n                  disableNotification: false,\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"unpin_message_node\",\n                type: \"unpin_message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  command: \"/unpin_message\",\n                  messageText: \"üìå‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–æ!\",\n                  synonyms: [\"–æ—Ç–∫—Ä–µ–ø–∏—Ç—å\", \"–æ—Ç—Ü–µ–ø–∏—Ç—å\", \"—É–±—Ä–∞—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"delete_message_node\",\n                type: \"delete_message\",\n                position: { x: 600, y: 300 },\n                data: {\n                  command: \"/delete_message\",\n                  messageText: \"üóëÔ∏è –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!\",\n                  synonyms: [\"—É–¥–∞–ª–∏—Ç—å\", \"—Å—Ç–µ—Ä–µ—Ç—å\", \"—É–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              }\n            ],\n            connections: []\n          },\n          {\n            id: \"users_sheet\",\n            name: \"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\",\n            description: \"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã\",\n            nodes: [\n              {\n                id: \"ban_user_node\",\n                type: \"ban_user\",\n                position: { x: 100, y: 500 },\n                data: {\n                  command: \"/ban_user\",\n                  messageText: \"üö´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –≥—Ä—É–ø–ø–µ!\",\n                  synonyms: [\"–∑–∞–±–∞–Ω–∏—Ç—å\", \"–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å\", \"–±–∞–Ω\"],\n                  reason: \"–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã\",\n                  untilDate: 0,\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"unban_user_node\",\n                type: \"unban_user\",\n                position: { x: 250, y: 500 },\n                data: {\n                  command: \"/unban_user\",\n                  messageText: \"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!\",\n                  synonyms: [\"—Ä–∞–∑–±–∞–Ω–∏—Ç—å\", \"—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å\", \"unb–∞–Ω\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"mute_user_node\",\n                type: \"mute_user\",\n                position: { x: 400, y: 500 },\n                data: {\n                  command: \"/mute_user\",\n                  messageText: \"üîá –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –≤ –ø—Ä–∞–≤–∞—Ö!\",\n                  synonyms: [\"–∑–∞–º—É—Ç–∏—Ç—å\", \"–∑–∞–≥–ª—É—à–∏—Ç—å\", \"–º—É—Ç\"],\n                  reason: \"–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã\",\n                  duration: 3600,\n                  canSendMessages: false,\n                  canSendMediaMessages: false,\n                  canSendPolls: false,\n                  canSendOtherMessages: false,\n                  canAddWebPagePreviews: false,\n                  canChangeGroupInfo: false,\n                  canInviteUsers2: false,\n                  canPinMessages2: false,\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"unmute_user_node\",\n                type: \"unmute_user\",\n                position: { x: 550, y: 500 },\n                data: {\n                  command: \"/unmute_user\",\n                  messageText: \"üîä –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–Ω—è—Ç—ã!\",\n                  synonyms: [\"—Ä–∞–∑–º—É—Ç–∏—Ç—å\", \"—Ä–∞–∑–≥–ª—É—à–∏—Ç—å\", \"–∞–Ω–º—É—Ç\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"kick_user_node\",\n                type: \"kick_user\",\n                position: { x: 700, y: 500 },\n                data: {\n                  command: \"/kick_user\",\n                  messageText: \"üë¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ –≥—Ä—É–ø–ø—ã!\",\n                  synonyms: [\"–∫–∏–∫–Ω—É—Ç—å\", \"–∏—Å–∫–ª—é—á–∏—Ç—å\", \"–≤—ã–≥–Ω–∞—Ç—å\"],\n                  reason: \"–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã\",\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"promote_user_node\",\n                type: \"promote_user\",\n                position: { x: 500, y: 700 },\n                data: {\n                  command: \"/promote_user\",\n                  messageText: \"üëë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!\",\n                  synonyms: [\"–ø–æ–≤—ã—Å–∏—Ç—å\", \"–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º\", \"–ø—Ä–æ–º–æ—É—Ç\"],\n                  canChangeInfo: false,\n                  canDeleteMessages: true,\n                  canBanUsers: false,\n                  canInviteUsers: true,\n                  canPinMessages: true,\n                  canAddAdmins: false,\n                  canRestrictMembers: false,\n                  canPromoteMembers: false,\n                  canManageVideoChats: false,\n                  isAnonymous: false,\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"demote_user_node\",\n                type: \"demote_user\",\n                position: { x: 700, y: 700 },\n                data: {\n                  command: \"/demote_user\",\n                  messageText: \"üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω—è—Ç —Å –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!\",\n                  synonyms: [\"–ø–æ–Ω–∏–∑–∏—Ç—å\", \"—Å–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∞\", \"–¥–µ–º–æ—É—Ç\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"admin_rights_node\",\n                type: \"admin_rights\",\n                position: { x: 300, y: 900 },\n                data: {\n                  command: \"/admin_rights\",\n                  messageText: \"‚öôÔ∏è –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!\\n\\nüí° –ß—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /admin_rights\",\n                  synonyms: [\"–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞\", \"–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞\", \"—Ç–≥ –ø—Ä–∞–≤–∞\", \"–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\", \"admin rights\"],\n                  description: \"–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –≥—Ä—É–ø–ø–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)\",\n                  adminUserIdSource: \"reply_to_message\", // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ–º reply –≤–º–µ—Å—Ç–æ last_message\n                  adminOnly: true, // –î–æ–±–∞–≤–ª–µ–Ω–æ: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å\n                  requiresGroup: true, // –î–æ–±–∞–≤–ª–µ–Ω–æ: –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö\n                  isPrivateOnly: false, // –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≥—Ä—É–ø–ø, –Ω–µ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤\n                  // –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n                  can_manage_chat: false,\n                  can_delete_messages: true,\n                  can_manage_video_chats: false,\n                  can_restrict_members: true,\n                  can_promote_members: false,\n                  can_change_info: false,\n                  can_invite_users: true,\n                  can_pin_messages: true,\n                  can_manage_topics: false,\n                  is_anonymous: false,\n                  adminChatIdSource: \"current_chat\",\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              }\n            ],\n            connections: []\n          }\n        ],\n        interSheetConnections: []\n      }\n    });\n\n    console.log('‚úÖ –®–∞–±–ª–æ–Ω –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–Ω');\n\n    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω: –í–ü—Ä–æ–≥—É–ª–∫–µ + –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (–ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø)\n    await storage.createBotTemplate({\n      name: \"üåüüëÆ‚Äç‚ôÇÔ∏è –í–ü—Ä–æ–≥—É–ª–∫–µ + –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è\",\n      description: \"–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω: –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –±–æ—Ç –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –¥–ª—è –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞ —Å–æ –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ (–º–µ—Ç—Ä–æ, –∏–Ω—Ç–µ—Ä–µ—Å—ã, –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è) + –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –≥—Ä—É–ø–ø—ã\",\n      category: \"community\", \n      tags: [\"–∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞\", \"–º–æ–¥–µ—Ä–∞—Ü–∏—è\", \"–∞–¥–º–∏–Ω\", \"–º–µ—Ç—Ä–æ\", \"–∏–Ω—Ç–µ—Ä–µ—Å—ã\", \"–°–ü–±\", \"–∞–Ω–∫–µ—Ç–∞\", \"—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\", \"–≥—Ä—É–ø–ø–∞\", \"–∫–æ–Ω—Ç–µ–Ω—Ç\", \"–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è\", \"–ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π\"],\n      isPublic: 1,\n      difficulty: \"hard\",\n      authorName: \"–°–∏—Å—Ç–µ–º–∞\",\n      version: \"2.0.0\",\n      featured: 1,\n      language: \"ru\",\n      complexity: 10,\n      estimatedTime: 80,\n      data: {\n        sheets: [\n          // ===== –õ–ò–°–¢–´ –ò–ó –í–ü—Ä–æ–≥—É–ª–∫–µ Multi-Sheet (–ü–û–õ–ù–ê–Ø –ö–û–ü–ò–Ø) =====\n          \n          // –õ–∏—Å—Ç 1: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\n          {\n            id: \"welcome_sheet\",\n            name: \"üéâ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\",\n            nodes: [\n              {\n                id: \"start\",\n                type: \"start\",\n                position: { x: 400, y: 100 },\n                data: {\n                  command: \"/start\",\n                  description: \"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫\",\n                  messageText: \"üåü –ü—Ä–∏–≤–µ—Ç –æ—Ç ·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á Bot!\\n\\n–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ –Ω–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –ª—é–¥–µ–π –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ!\\n\\n–û—Ç–∫—É–¥–∞ —Ç—ã —É–∑–Ω–∞–ª –æ –Ω–∞—à–µ–º —á–∞—Ç–µ? üòé\",\n                  synonyms: [\"—Å—Ç–∞—Ä—Ç\", \"–Ω–∞—á–∞—Ç—å\", \"–ø—Ä–∏–≤–µ—Ç\", \"–Ω–∞—á–∞–ª–æ\", \"–Ω–∞—á–∏–Ω–∞–µ–º\"],\n                  keyboardType: \"none\",\n                  buttons: [],\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"user_source\",\n                  inputTargetNodeId: \"join_request\",\n                  markdown: false,\n                  oneTimeKeyboard: false,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"join_request\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–•–æ—á–µ—à—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –Ω–∞—à–µ–º—É —á–∞—Ç—É? üöÄ\",\n                  synonyms: [],\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"join_request_response\",\n                  buttons: [\n                    {\n                      id: \"btn-yes\",\n                      text: \"–î–∞ üòé\",\n                      value: \"yes\",\n                      action: \"goto\",\n                      target: \"gender_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-no\", \n                      text: \"–ù–µ—Ç üôÖ\",\n                      value: \"no\",\n                      action: \"goto\",\n                      target: \"decline_response\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"decline_response\",\n                type: \"message\",\n                position: { x: 400, y: 500 },\n                data: {\n                  messageText: \"–ü–æ–Ω—è—Ç–Ω–æ! –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—à—å, –Ω–∞–ø–∏—à–∏ /start! üòä\",\n                  synonyms: [],\n                  keyboardType: \"none\",\n                  removeKeyboard: true,\n                  buttons: [],\n                  markdown: false\n                }\n              }\n            ]\n          },\n\n          // –õ–∏—Å—Ç 2: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–ø–æ–ª, –∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç)\n          {\n            id: \"basic_info_sheet\", \n            name: \"üë§ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\",\n            nodes: [\n              {\n                id: \"gender_selection\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–£–∫–∞–∂–∏ —Å–≤–æ–π –ø–æ–ª: üë®üë©\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"gender\",\n                  synonyms: [\"–ø–æ–ª\", \"–≥–µ–Ω–¥–µ—Ä\", \"–º—É–∂—á–∏–Ω–∞\", \"–∂–µ–Ω—â–∏–Ω–∞\"],\n                  buttons: [\n                    {\n                      id: \"btn-male\",\n                      text: \"–ú—É–∂—á–∏–Ω–∞ üë®\",\n                      value: \"male\",\n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-female\",\n                      text: \"–ñ–µ–Ω—â–∏–Ω–∞ üë©\",\n                      value: \"female\", \n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"name_input\",\n                type: \"message\",\n                position: { x: 400, y: 500 },\n                data: {\n                  messageText: \"–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? ‚úèÔ∏è\\n\\n–ù–∞–ø–∏—à–∏ —Å–≤–æ—ë –∏–º—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:\",\n                  keyboardType: \"none\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"user_name\",\n                  synonyms: [\"–∏–º—è\", \"–∑–æ–≤—É—Ç\", \"–Ω–∞–∑—ã–≤–∞—é—Ç\", \"–∫–∞–∫ –∑–æ–≤—É—Ç\"],\n                  inputTargetNodeId: \"age_input\",\n                  buttons: [],\n                  markdown: false\n                }\n              },\n              {\n                id: \"age_input\",\n                type: \"message\",\n                position: { x: 400, y: 700 },\n                data: {\n                  messageText: \"–°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç? üéÇ\\n\\n–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç —á–∏—Å–ª–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 25):\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"user_age\",\n                  synonyms: [\"–≤–æ–∑—Ä–∞—Å—Ç\", \"–ª–µ—Ç\", \"–≥–æ–¥—ã\", \"—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç\"],\n                  inputTargetNodeId: \"metro_selection\",\n                  buttons: [],\n                  markdown: false\n                }\n              },\n            ]\n          },\n\n          // –õ–∏—Å—Ç 3: –ú–µ—Ç—Ä–æ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ\n          {\n            id: \"metro_sheet\",\n            name: \"üöá –ú–µ—Ç—Ä–æ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ\",\n            nodes: [\n              {\n                id: \"metro_selection\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–ù–∞ –∫–∞–∫–æ–π —Å—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ —Ç—ã –æ–±—ã—á–Ω–æ –±—ã–≤–∞–µ—à—å? üöá\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é –≤–µ—Ç–∫—É:\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"metro_stations\",\n                  synonyms: [\"–º–µ—Ç—Ä–æ\", \"—Å—Ç–∞–Ω—Ü–∏—è\", \"–≥–¥–µ –∂–∏–≤—É\", \"—Ä–∞–π–æ–Ω\"],\n                  buttons: [\n                    {\n                      id: \"btn-red\",\n                      text: \"–ö—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞ üü•\",\n                      action: \"goto\",\n                      target: \"red_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-blue\",\n                      text: \"–°–∏–Ω—è—è –≤–µ—Ç–∫–∞ üü¶\",\n                      action: \"goto\", \n                      target: \"blue_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-green\",\n                      text: \"–ó–µ–ª—ë–Ω–∞—è –≤–µ—Ç–∫–∞ üü©\",\n                      action: \"goto\",\n                      target: \"green_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-purple\",\n                      text: \"–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞ üü™\",\n                      action: \"goto\",\n                      target: \"purple_line_stations\",\n                      buttonType: \"option\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-lo\",\n                      text: \"–Ø –∏–∑ –õ–û üè°\",\n                      value: \"–õ–û\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-not-spb\",\n                      text: \"–Ø –Ω–µ –≤ –ü–∏—Ç–µ—Ä–µ üåç\",\n                      value: \"–ù–µ –≤ –°–ü–±\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"red_line_stations\",\n                type: \"message\",\n                position: { x: 100, y: 500 },\n                data: {\n                  messageText: \"üü• –ö–∏—Ä–æ–≤—Å–∫–æ-–í—ã–±–æ—Ä–≥—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"–∫—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è\", \"–∫–∏—Ä–æ–≤—Å–∫–æ-–≤—ã–±–æ—Ä–≥—Å–∫–∞—è\", \"–∫—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"red-devyatkino\", text: \"üü• –î–µ–≤—è—Ç–∫–∏–Ω–æ\", action: \"selection\", target: \"devyatkino\", buttonType: \"option\" },\n                    { id: \"red-grazhdansky\", text: \"üü• –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"grazhdansky\", buttonType: \"option\" },\n                    { id: \"red-akademicheskaya\", text: \"üü• –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è\", action: \"selection\", target: \"akademicheskaya\", buttonType: \"option\" },\n                    { id: \"red-politehnicheskaya\", text: \"üü• –ü–æ–ª–∏—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è\", action: \"selection\", target: \"politehnicheskaya\", buttonType: \"option\" },\n                    { id: \"red-pl-muzhestva\", text: \"üü• –ü–ª–æ—â–∞–¥—å –ú—É–∂–µ—Å—Ç–≤–∞\", action: \"selection\", target: \"pl_muzhestva\", buttonType: \"option\" },\n                    { id: \"red-lesnaya\", text: \"üü• –õ–µ—Å–Ω–∞—è\", action: \"selection\", target: \"lesnaya\", buttonType: \"option\" },\n                    { id: \"red-vyborgskaya\", text: \"üü• –í—ã–±–æ—Ä–≥—Å–∫–∞—è\", action: \"selection\", target: \"vyborgskaya\", buttonType: \"option\" },\n                    { id: \"red-pl-lenina\", text: \"üü• –ü–ª–æ—â–∞–¥—å –õ–µ–Ω–∏–Ω–∞\", action: \"selection\", target: \"pl_lenina\", buttonType: \"option\" },\n                    { id: \"red-chernyshevskaya\", text: \"üü• –ß–µ—Ä–Ω—ã—à–µ–≤—Å–∫–∞—è\", action: \"selection\", target: \"chernyshevskaya\", buttonType: \"option\" },\n                    { id: \"red-pl-vosstaniya\", text: \"üü• –ü–ª–æ—â–∞–¥—å –í–æ—Å—Å—Ç–∞–Ω–∏—è\", action: \"selection\", target: \"pl_vosstaniya\", buttonType: \"option\" },\n                    { id: \"red-vladimirskaya\", text: \"üü• –í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è\", action: \"selection\", target: \"vladimirskaya\", buttonType: \"option\" },\n                    { id: \"red-pushkinskaya\", text: \"üü• –ü—É—à–∫–∏–Ω—Å–∫–∞—è\", action: \"selection\", target: \"pushkinskaya\", buttonType: \"option\" },\n                    { id: \"red-tehinstitut1\", text: \"üü• –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç–∏—Ç—É—Ç-1\", action: \"selection\", target: \"tehinstitut1\", buttonType: \"option\" },\n                    { id: \"red-baltiyskaya\", text: \"üü• –ë–∞–ª—Ç–∏–π—Å–∫–∞—è\", action: \"selection\", target: \"baltiyskaya\", buttonType: \"option\" },\n                    { id: \"red-narvskaya\", text: \"üü• –ù–∞—Ä–≤—Å–∫–∞—è\", action: \"selection\", target: \"narvskaya\", buttonType: \"option\" },\n                    { id: \"red-kirovsky\", text: \"üü• –ö–∏—Ä–æ–≤—Å–∫–∏–π –∑–∞–≤–æ–¥\", action: \"selection\", target: \"kirovsky\", buttonType: \"option\" },\n                    { id: \"red-avtovo\", text: \"üü• –ê–≤—Ç–æ–≤–æ\", action: \"selection\", target: \"avtovo\", buttonType: \"option\" },\n                    { id: \"red-leninsky\", text: \"üü• –õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"leninsky\", buttonType: \"option\" },\n                    { id: \"red-veteranov\", text: \"üü• –ü—Ä–æ—Å–ø–µ–∫—Ç –í–µ—Ç–µ—Ä–∞–Ω–æ–≤\", action: \"selection\", target: \"veteranov\", buttonType: \"option\" },\n                    { id: \"btn-back-metro\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"blue_line_stations\",\n                type: \"message\",\n                position: { x: 700, y: 500 },\n                data: {\n                  messageText: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–æ-–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"—Å–∏–Ω—è—è –ª–∏–Ω–∏—è\", \"–º–æ—Å–∫–æ–≤—Å–∫–æ-–ø–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è\", \"—Å–∏–Ω—è—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"blue-parnas\", text: \"üü¶ –ü–∞—Ä–Ω–∞—Å\", action: \"selection\", target: \"parnas\", buttonType: \"option\" },\n                    { id: \"blue-prosp-prosvesh\", text: \"üü¶ –ü—Ä–æ—Å–ø–µ–∫—Ç –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è\", action: \"selection\", target: \"prosp_prosvesh\", buttonType: \"option\" },\n                    { id: \"blue-ozerki\", text: \"üü¶ –û–∑–µ—Ä–∫–∏\", action: \"selection\", target: \"ozerki\", buttonType: \"option\" },\n                    { id: \"blue-udelnaya\", text: \"üü¶ –£–¥–µ–ª—å–Ω–∞—è\", action: \"selection\", target: \"udelnaya\", buttonType: \"option\" },\n                    { id: \"blue-pionerskaya\", text: \"üü¶ –ü–∏–æ–Ω–µ—Ä—Å–∫–∞—è\", action: \"selection\", target: \"pionerskaya\", buttonType: \"option\" },\n                    { id: \"blue-chernaya\", text: \"üü¶ –ß–µ—Ä–Ω–∞—è —Ä–µ—á–∫–∞\", action: \"selection\", target: \"chernaya\", buttonType: \"option\" },\n                    { id: \"blue-petrogradskaya\", text: \"üü¶ –ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è\", action: \"selection\", target: \"petrogradskaya\", buttonType: \"option\" },\n                    { id: \"blue-gorkovskaya\", text: \"üü¶ –ì–æ—Ä—å–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"gorkovskaya\", buttonType: \"option\" },\n                    { id: \"blue-nevsky\", text: \"üü¶ –ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"nevsky\", buttonType: \"option\" },\n                    { id: \"blue-sennaya\", text: \"üü¶ –°–µ–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å\", action: \"selection\", target: \"sennaya\", buttonType: \"option\" },\n                    { id: \"blue-tehinstitut2\", text: \"üü¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç–∏—Ç—É—Ç-2\", action: \"selection\", target: \"tehinstitut2\", buttonType: \"option\" },\n                    { id: \"blue-frunzenskaya\", text: \"üü¶ –§—Ä—É–Ω–∑–µ–Ω—Å–∫–∞—è\", action: \"selection\", target: \"frunzenskaya\", buttonType: \"option\" },\n                    { id: \"blue-mosk-vorota\", text: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–∏–µ –≤–æ—Ä–æ—Ç–∞\", action: \"selection\", target: \"mosk_vorota\", buttonType: \"option\" },\n                    { id: \"blue-elektrosila\", text: \"üü¶ –≠–ª–µ–∫—Ç—Ä–æ—Å–∏–ª–∞\", action: \"selection\", target: \"elektrosila\", buttonType: \"option\" },\n                    { id: \"blue-park-pobedy\", text: \"üü¶ –ü–∞—Ä–∫ –ü–æ–±–µ–¥—ã\", action: \"selection\", target: \"park_pobedy\", buttonType: \"option\" },\n                    { id: \"blue-moskovskaya\", text: \"üü¶ –ú–æ—Å–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"moskovskaya\", buttonType: \"option\" },\n                    { id: \"blue-zvezdnaya\", text: \"üü¶ –ó–≤–µ–∑–¥–Ω–∞—è\", action: \"selection\", target: \"zvezdnaya\", buttonType: \"option\" },\n                    { id: \"blue-kupchino\", text: \"üü¶ –ö—É–ø—á–∏–Ω–æ\", action: \"selection\", target: \"kupchino\", buttonType: \"option\" },\n                    { id: \"btn-back-metro-blue\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"green_line_stations\",\n                type: \"message\",\n                position: { x: 1000, y: 500 },\n                data: {\n                  messageText: \"üü© –ù–µ–≤—Å–∫–æ-–í–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"–∑–µ–ª–µ–Ω–∞—è –ª–∏–Ω–∏—è\", \"–Ω–µ–≤—Å–∫–æ-–≤–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è\", \"–∑–µ–ª–µ–Ω–∞—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"green-primorskaya\", text: \"üü© –ü—Ä–∏–º–æ—Ä—Å–∫–∞—è\", action: \"selection\", target: \"primorskaya\", buttonType: \"option\" },\n                    { id: \"green-vasileostr\", text: \"üü© –í–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"vasileostr\", buttonType: \"option\" },\n                    { id: \"green-gostiny\", text: \"üü© –ì–æ—Å—Ç–∏–Ω—ã–π –¥–≤–æ—Ä\", action: \"selection\", target: \"gostiny\", buttonType: \"option\" },\n                    { id: \"green-mayakovskaya\", text: \"üü© –ú–∞—è–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"mayakovskaya\", buttonType: \"option\" },\n                    { id: \"green-pl-nevsk\", text: \"üü© –ü–ª–æ—â–∞–¥—å –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ù–µ–≤—Å–∫–æ–≥–æ-1\", action: \"selection\", target: \"pl_nevsk\", buttonType: \"option\" },\n                    { id: \"green-elizarovskaya\", text: \"üü© –ï–ª–∏–∑–∞—Ä–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"elizarovskaya\", buttonType: \"option\" },\n                    { id: \"green-lomonosovskaya\", text: \"üü© –õ–æ–º–æ–Ω–æ—Å–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"lomonosovskaya\", buttonType: \"option\" },\n                    { id: \"green-proletarskaya\", text: \"üü© –ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∞—è\", action: \"selection\", target: \"proletarskaya\", buttonType: \"option\" },\n                    { id: \"green-obuhovo\", text: \"üü© –û–±—É—Ö–æ–≤–æ\", action: \"selection\", target: \"obuhovo\", buttonType: \"option\" },\n                    { id: \"green-rybackoe\", text: \"üü© –†—ã–±–∞—Ü–∫–æ–µ\", action: \"selection\", target: \"rybackoe\", buttonType: \"option\" },\n                    { id: \"green-novokrestovsk\", text: \"üü© –ù–æ–≤–æ–∫—Ä–µ—Å—Ç–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"novokrestovsk\", buttonType: \"option\" },\n                    { id: \"green-begovaya\", text: \"üü© –ë–µ–≥–æ–≤–∞—è\", action: \"selection\", target: \"begovaya\", buttonType: \"option\" },\n                    { id: \"btn-back-metro-green\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"purple_line_stations\",\n                type: \"message\",\n                position: { x: 1600, y: 500 },\n                data: {\n                  messageText: \"üü™ –§—Ä—É–Ω–∑–µ–Ω—Å–∫–æ-–ü—Ä–∏–º–æ—Ä—Å–∫–∞—è –ª–∏–Ω–∏—è\\n\\n–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∞–Ω—Ü–∏—é:\",\n                  synonyms: [\"—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è\", \"—Ñ—Ä—É–Ω–∑–µ–Ω—Å–∫–æ-–ø—Ä–∏–º–æ—Ä—Å–∫–∞—è\", \"—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"metro_stations\",\n                  continueButtonTarget: \"interests_categories\",\n                  buttons: [\n                    { id: \"purple-komendantsky\", text: \"üü™ –ö–æ–º–µ–Ω–¥–∞–Ω—Ç—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç\", action: \"selection\", target: \"komendantsky\", buttonType: \"option\" },\n                    { id: \"purple-staraya\", text: \"üü™ –°—Ç–∞—Ä–∞—è –î–µ—Ä–µ–≤–Ω—è\", action: \"selection\", target: \"staraya\", buttonType: \"option\" },\n                    { id: \"purple-krestovsky\", text: \"üü™ –ö—Ä–µ—Å—Ç–æ–≤—Å–∫–∏–π –æ—Å—Ç—Ä–æ–≤\", action: \"selection\", target: \"krestovsky\", buttonType: \"option\" },\n                    { id: \"purple-chkalovskaya\", text: \"üü™ –ß–∫–∞–ª–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"chkalovskaya\", buttonType: \"option\" },\n                    { id: \"purple-sportivnaya\", text: \"üü™ –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è\", action: \"selection\", target: \"sportivnaya\", buttonType: \"option\" },\n                    { id: \"purple-admiralteyskaya\", text: \"üü™ –ê–¥–º–∏—Ä–∞–ª—Ç–µ–π—Å–∫–∞—è\", action: \"selection\", target: \"admiralteyskaya\", buttonType: \"option\" },\n                    { id: \"purple-sadovaya\", text: \"üü™ –°–∞–¥–æ–≤–∞—è\", action: \"selection\", target: \"sadovaya\", buttonType: \"option\" },\n                    { id: \"purple-zvenigorodskaya\", text: \"üü™ –ó–≤–µ–Ω–∏–≥–æ—Ä–æ–¥—Å–∫–∞—è\", action: \"selection\", target: \"zvenigorodskaya\", buttonType: \"option\" },\n                    { id: \"purple-obvodniy\", text: \"üü™ –û–±–≤–æ–¥–Ω—ã–π –∫–∞–Ω–∞–ª\", action: \"selection\", target: \"obvodniy\", buttonType: \"option\" },\n                    { id: \"purple-volkovskaya\", text: \"üü™ –í–æ–ª–∫–æ–≤—Å–∫–∞—è\", action: \"selection\", target: \"volkovskaya\", buttonType: \"option\" },\n                    { id: \"purple-buharestskaya\", text: \"üü™ –ë—É—Ö–∞—Ä–µ—Å—Ç—Å–∫–∞—è\", action: \"selection\", target: \"buharestskaya\", buttonType: \"option\" },\n                    { id: \"purple-mezhdunar\", text: \"üü™ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è\", action: \"selection\", target: \"mezhdunar\", buttonType: \"option\" },\n                    { id: \"btn-back-metro-purple\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–µ—Ç–∫–∞–º\", action: \"goto\", target: \"metro_selection\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n            ]\n          },\n\n          // –õ–∏—Å—Ç 4: –ò–Ω—Ç–µ—Ä–µ—Å—ã –∏ —Ö–æ–±–±–∏\n          {\n            id: \"interests_sheet\",\n            name: \"üéØ –ò–Ω—Ç–µ—Ä–µ—Å—ã\",\n            nodes: [\n              {\n                id: \"interests_categories\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤: üéØ\\n\\n(–ú–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)\",\n                  synonyms: [\"–∏–Ω—Ç–µ—Ä–µ—Å—ã\", \"—Ö–æ–±–±–∏\", \"—É–≤–ª–µ—á–µ–Ω–∏—è\", \"—á—Ç–æ –Ω—Ä–∞–≤–∏—Ç—Å—è\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"interests_categories\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    {\n                      id: \"btn-music\",\n                      text: \"üéµ –ú—É–∑—ã–∫–∞\",\n                      action: \"goto\",\n                      target: \"music_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-hobby\",\n                      text: \"üé® –•–æ–±–±–∏\",\n                      action: \"goto\",\n                      target: \"hobby_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-social\",\n                      text: \"üë• –û–±—â–µ–Ω–∏–µ\",\n                      action: \"goto\",\n                      target: \"social_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-creativity\",\n                      text: \"üé≠ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ\",\n                      action: \"goto\",\n                      target: \"creativity_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-active\",\n                      text: \"‚öΩ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\",\n                      action: \"goto\",\n                      target: \"active_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-food\",\n                      text: \"üçî –ï–¥–∞\",\n                      action: \"goto\",\n                      target: \"food_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    },\n                    {\n                      id: \"btn-sport\",\n                      text: \"üèãÔ∏è –°–ø–æ—Ä—Ç\",\n                      action: \"goto\",\n                      target: \"sport_interests\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"music_interests\",\n                type: \"message\",\n                position: { x: 100, y: 500 },\n                data: {\n                  messageText: \"üéµ –ö–∞–∫–∞—è –º—É–∑—ã–∫–∞ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?\\n\\n(–ú–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)\",\n                  synonyms: [\"–º—É–∑—ã–∫–∞\", \"–ø–µ—Å–Ω–∏\", \"—Ç—Ä–µ–∫–∏\", \"–∂–∞–Ω—Ä—ã\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"music-pop\", text: \"üé§ –ü–æ–ø\", action: \"selection\", target: \"pop\", buttonType: \"option\" },\n                    { id: \"music-rock\", text: \"üé∏ –†–æ–∫\", action: \"selection\", target: \"rock\", buttonType: \"option\" },\n                    { id: \"music-electronic\", text: \"üéß –≠–ª–µ–∫—Ç—Ä–æ\", action: \"selection\", target: \"electronic\", buttonType: \"option\" },\n                    { id: \"music-jazz\", text: \"üé∫ –î–∂–∞–∑\", action: \"selection\", target: \"jazz\", buttonType: \"option\" },\n                    { id: \"music-classical\", text: \"üéº –ö–ª–∞—Å—Å–∏–∫–∞\", action: \"selection\", target: \"classical\", buttonType: \"option\" },\n                    { id: \"music-hiphop\", text: \"üé§ –•–∏–ø-—Ö–æ–ø\", action: \"selection\", target: \"hiphop\", buttonType: \"option\" },\n                    { id: \"music-indie\", text: \"üé∏ –ò–Ω–¥–∏\", action: \"selection\", target: \"indie\", buttonType: \"option\" },\n                    { id: \"music-rnb\", text: \"üéµ R&B\", action: \"selection\", target: \"rnb\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-music\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"hobby_interests\",\n                type: \"message\",\n                position: { x: 700, y: 500 },\n                data: {\n                  messageText: \"üé® –ö–∞–∫–∏–µ —É —Ç–µ–±—è —Ö–æ–±–±–∏?\\n\\n(–ú–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)\",\n                  synonyms: [\"—Ö–æ–±–±–∏\", \"—É–≤–ª–µ—á–µ–Ω–∏—è\", \"–∑–∞–Ω—è—Ç–∏—è\", \"–¥–æ—Å—É–≥\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"hobby-reading\", text: \"üìö –ß—Ç–µ–Ω–∏–µ\", action: \"selection\", target: \"reading\", buttonType: \"option\" },\n                    { id: \"hobby-gaming\", text: \"üéÆ –ò–≥—Ä—ã\", action: \"selection\", target: \"gaming\", buttonType: \"option\" },\n                    { id: \"hobby-cooking\", text: \"üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∫–∞\", action: \"selection\", target: \"cooking\", buttonType: \"option\" },\n                    { id: \"hobby-gardening\", text: \"üå± –°–∞–¥–æ–≤–æ–¥—Å—Ç–≤–æ\", action: \"selection\", target: \"gardening\", buttonType: \"option\" },\n                    { id: \"hobby-collecting\", text: \"üè∫ –ö–æ–ª–ª–µ–∫—Ü–∏–∏\", action: \"selection\", target: \"collecting\", buttonType: \"option\" },\n                    { id: \"hobby-diy\", text: \"üî® DIY\", action: \"selection\", target: \"diy\", buttonType: \"option\" },\n                    { id: \"hobby-pets\", text: \"üêï –ñ–∏–≤–æ—Ç–Ω—ã–µ\", action: \"selection\", target: \"pets\", buttonType: \"option\" },\n                    { id: \"hobby-tech\", text: \"üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\", action: \"selection\", target: \"tech\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-hobby\", text: \"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"social_interests\",\n                type: \"message\",\n                position: { x: 100, y: 500 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üë• –û–±—â–µ–Ω–∏–µ:\",\n                  synonyms: [\"–æ–±—â–µ–Ω–∏–µ\", \"—Å–æ—Ü–∏–∞–ª—å–Ω–æ–µ\", \"–ª—é–¥–∏\", \"—Ç—É—Å–æ–≤–∫–∏\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"social-parties\", text: \"üéâ –í–µ—á–µ—Ä–∏–Ω–∫–∏\", action: \"selection\", target: \"parties\", buttonType: \"option\" },\n                    { id: \"social-networking\", text: \"ü§ù –ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥\", action: \"selection\", target: \"networking\", buttonType: \"option\" },\n                    { id: \"social-dating\", text: \"üíï –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞\", action: \"selection\", target: \"dating\", buttonType: \"option\" },\n                    { id: \"social-volunteering\", text: \"ü§≤ –í–æ–ª–æ–Ω—Ç—ë—Ä—Å—Ç–≤–æ\", action: \"selection\", target: \"volunteering\", buttonType: \"option\" },\n                    { id: \"social-events\", text: \"üé™ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è\", action: \"selection\", target: \"events\", buttonType: \"option\" },\n                    { id: \"social-community\", text: \"üë• –°–æ–æ–±—â–µ—Å—Ç–≤–∞\", action: \"selection\", target: \"community\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-social\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"creativity_interests\",\n                type: \"message\",\n                position: { x: 700, y: 700 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üé≠ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ:\",\n                  synonyms: [\"—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ\", \"–∏—Å–∫—É—Å—Å—Ç–≤–æ\", \"—Ä–∏—Å–æ–≤–∞–Ω–∏–µ\", \"–º—É–∑—ã–∫–∞\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"creativity-art\", text: \"üé® –†–∏—Å–æ–≤–∞–Ω–∏–µ\", action: \"selection\", target: \"art\", buttonType: \"option\" },\n                    { id: \"creativity-music\", text: \"üéµ –ú—É–∑—ã–∫–∞\", action: \"selection\", target: \"music\", buttonType: \"option\" },\n                    { id: \"creativity-photography\", text: \"üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è\", action: \"selection\", target: \"photography\", buttonType: \"option\" },\n                    { id: \"creativity-writing\", text: \"‚úçÔ∏è –ü–∏—Å–∞—Ç–µ–ª—å—Å—Ç–≤–æ\", action: \"selection\", target: \"writing\", buttonType: \"option\" },\n                    { id: \"creativity-design\", text: \"üñåÔ∏è –î–∏–∑–∞–π–Ω\", action: \"selection\", target: \"design\", buttonType: \"option\" },\n                    { id: \"creativity-handmade\", text: \"üß∂ –†—É–∫–æ–¥–µ–ª–∏–µ\", action: \"selection\", target: \"handmade\", buttonType: \"option\" },\n                    { id: \"creativity-theater\", text: \"üé≠ –¢–µ–∞—Ç—Ä\", action: \"selection\", target: \"theater\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-creativity\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"active_interests\",\n                type: \"message\",\n                position: { x: 1000, y: 700 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚öΩ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:\",\n                  synonyms: [\"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\", \"–∞–∫—Ç–∏–≤–Ω—ã–π\", \"–¥–≤–∏–∂–µ–Ω–∏–µ\", \"–∑–¥–æ—Ä–æ–≤—å–µ\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"active-running\", text: \"üèÉ –ë–µ–≥\", action: \"selection\", target: \"running\", buttonType: \"option\" },\n                    { id: \"active-gym\", text: \"üí™ –¢—Ä–µ–Ω–∞–∂—ë—Ä–Ω—ã–π –∑–∞–ª\", action: \"selection\", target: \"gym\", buttonType: \"option\" },\n                    { id: \"active-cycling\", text: \"üö¥ –í–µ–ª–æ—Å–∏–ø–µ–¥\", action: \"selection\", target: \"cycling\", buttonType: \"option\" },\n                    { id: \"active-hiking\", text: \"ü•æ –ü–æ—Ö–æ–¥—ã\", action: \"selection\", target: \"hiking\", buttonType: \"option\" },\n                    { id: \"active-yoga\", text: \"üßò –ô–æ–≥–∞\", action: \"selection\", target: \"yoga\", buttonType: \"option\" },\n                    { id: \"active-swimming\", text: \"üèä –ü–ª–∞–≤–∞–Ω–∏–µ\", action: \"selection\", target: \"swimming\", buttonType: \"option\" },\n                    { id: \"active-dancing\", text: \"üíÉ –¢–∞–Ω—Ü—ã\", action: \"selection\", target: \"dancing\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-active\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"food_interests\",\n                type: \"message\",\n                position: { x: 1300, y: 700 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üçî –ï–¥–∞:\",\n                  synonyms: [\"–µ–¥–∞\", \"–Ω–∞–ø–∏—Ç–∫–∏\", \"–∫—É—Ö–Ω—è\", \"—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"food-cooking\", text: \"üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∫–∞\", action: \"selection\", target: \"cooking\", buttonType: \"option\" },\n                    { id: \"food-restaurants\", text: \"üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω—ã\", action: \"selection\", target: \"restaurants\", buttonType: \"option\" },\n                    { id: \"food-wine\", text: \"üç∑ –í–∏–Ω–æ\", action: \"selection\", target: \"wine\", buttonType: \"option\" },\n                    { id: \"food-coffee\", text: \"‚òï –ö–æ—Ñ–µ\", action: \"selection\", target: \"coffee\", buttonType: \"option\" },\n                    { id: \"food-baking\", text: \"üßÅ –í—ã–ø–µ—á–∫–∞\", action: \"selection\", target: \"baking\", buttonType: \"option\" },\n                    { id: \"food-street\", text: \"üåÆ –°—Ç—Ä–∏—Ç-—Ñ—É–¥\", action: \"selection\", target: \"street_food\", buttonType: \"option\" },\n                    { id: \"food-healthy\", text: \"ü•ó –ó–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ\", action: \"selection\", target: \"healthy_food\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-food\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"sport_interests\",\n                type: \"message\",\n                position: { x: 1600, y: 700 },\n                data: {\n                  messageText: \"–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ üèãÔ∏è –°–ø–æ—Ä—Ç:\",\n                  synonyms: [\"—Å–ø–æ—Ä—Ç\", \"—Ñ–∏—Ç–Ω–µ—Å\", \"—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\", \"—Ñ—É—Ç–±–æ–ª\"],\n                  keyboardType: \"inline\",\n                  allowMultipleSelection: true,\n                  multiSelectVariable: \"user_interests\",\n                  continueButtonTarget: \"marital_status\",\n                  buttons: [\n                    { id: \"sport-football\", text: \"‚öΩ –§—É—Ç–±–æ–ª\", action: \"selection\", target: \"football\", buttonType: \"option\" },\n                    { id: \"sport-basketball\", text: \"üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª\", action: \"selection\", target: \"basketball\", buttonType: \"option\" },\n                    { id: \"sport-tennis\", text: \"üéæ –¢–µ–Ω–Ω–∏—Å\", action: \"selection\", target: \"tennis\", buttonType: \"option\" },\n                    { id: \"sport-hockey\", text: \"üèí –•–æ–∫–∫–µ–π\", action: \"selection\", target: \"hockey\", buttonType: \"option\" },\n                    { id: \"sport-volleyball\", text: \"üèê –í–æ–ª–µ–π–±–æ–ª\", action: \"selection\", target: \"volleyball\", buttonType: \"option\" },\n                    { id: \"sport-mma\", text: \"ü•ä –ï–¥–∏–Ω–æ–±–æ—Ä—Å—Ç–≤–∞\", action: \"selection\", target: \"mma\", buttonType: \"option\" },\n                    { id: \"sport-esports\", text: \"üéÆ –ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç\", action: \"selection\", target: \"esports\", buttonType: \"option\" },\n                    { id: \"btn-back-categories-sport\", text: \"‚¨ÖÔ∏è –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\", action: \"goto\", target: \"interests_categories\", buttonType: \"navigation\" }\n                  ],\n                  markdown: false\n                }\n              },\n            ]\n          },\n\n          // –õ–∏—Å—Ç 5: –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n          {\n            id: \"personal_sheet\",\n            name: \"üíù –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\",\n            nodes: [\n              {\n                id: \"marital_status\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"–¢–≤–æ–µ —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: üíç\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"marital_status\",\n                  synonyms: [\"—Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\", \"–æ—Ç–Ω–æ—à–µ–Ω–∏—è\", \"—Å—Ç–∞—Ç—É—Å\"],\n                  buttons: [\n                    {\n                      id: \"btn-single\",\n                      text: \"–•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º üíö\",\n                      value: \"single\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-relationship\",\n                      text: \"–í –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö üíô\",\n                      value: \"relationship\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-married\",\n                      text: \"–ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º üíõ\",\n                      value: \"married\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-complicated\",\n                      text: \"–í—Å—ë —Å–ª–æ–∂–Ω–æ ü§∑\",\n                      value: \"complicated\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"sexual_orientation\",\n                type: \"message\",\n                position: { x: 400, y: 500 },\n                data: {\n                  messageText: \"–¢–≤–æ—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: üåà\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  inputVariable: \"sexual_orientation\",\n                  synonyms: [\"–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è\", \"–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è\", \"–∏–Ω—Ç–µ—Ä–µ—Å\"],\n                  buttons: [\n                    {\n                      id: \"btn-hetero\",\n                      text: \"–ì–µ—Ç–µ—Ä–æ üë´\",\n                      value: \"heterosexual\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-gay\",\n                      text: \"–ì–µ–π üë¨\",\n                      value: \"gay\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-lesbian\",\n                      text: \"–õ–µ—Å–±–∏—è–Ω–∫–∞ üë≠\",\n                      value: \"lesbian\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-bi\",\n                      text: \"–ë–∏ üåà\",\n                      value: \"bisexual\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-other\",\n                      text: \"–î—Ä—É–≥–æ–µ üé≠\",\n                      value: \"other\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"channel_choice\",\n                type: \"message\",\n                position: { x: 400, y: 700 },\n                data: {\n                  messageText: \"–•–æ—á–µ—à—å —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–π —Ç–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª? üì¢\\n\\n–í–≤–µ–¥–∏ —Å—Å—ã–ª–∫—É, –Ω–∏–∫ —Å @ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏–º—è –∫–∞–Ω–∞–ª–∞, –ª–∏–±–æ –Ω–∞–∂–º–∏ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å':\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"telegram_channel\",\n                  synonyms: [\"–∫–∞–Ω–∞–ª\", \"—Ç–≥\", \"—Ç–µ–ª–µ–≥—Ä–∞–º\", \"—Å—Å—ã–ª–∫–∞\"],\n                  inputTargetNodeId: \"extra_info\",\n                  buttons: [\n                    {\n                      id: \"btn-skip-channel\",\n                      text: \"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚è≠Ô∏è\",\n                      action: \"goto\",\n                      target: \"extra_info\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"extra_info\",\n                type: \"message\",\n                position: { x: 400, y: 900 },\n                data: {\n                  messageText: \"–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —á—Ç–æ-—Ç–æ –µ—â—ë –æ —Å–µ–±–µ? üìù\\n\\n–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ (–¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤) –∏–ª–∏ –Ω–∞–∂–º–∏ '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å':\",\n                  keyboardType: \"inline\",\n                  collectUserInput: true,\n                  enableTextInput: true,\n                  inputVariable: \"extra_info\",\n                  synonyms: [\"–æ —Å–µ–±–µ\", \"–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ\", \"–±–æ–ª—å—à–µ\", \"–µ—â–µ\"],\n                  inputTargetNodeId: \"profile_complete\",\n                  buttons: [\n                    {\n                      id: \"btn-skip-extra\",\n                      text: \"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚è≠Ô∏è\",\n                      action: \"goto\",\n                      target: \"profile_complete\",\n                      buttonType: \"normal\",\n                      skipDataCollection: true\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n            ]\n          },\n\n          // –õ–∏—Å—Ç 6: –ü—Ä–æ—Ñ–∏–ª—å –∏ –∫–æ–º–∞–Ω–¥—ã\n          {\n            id: \"profile_sheet\",\n            name: \"üë§ –ü—Ä–æ—Ñ–∏–ª—å\",\n            nodes: [\n              {\n                id: \"profile_complete\",\n                type: \"message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  messageText: \"üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω!\\n\\nüë§ –¢–≤–æ—è –∞–Ω–∫–µ—Ç–∞:\\n–ü–æ–ª: {gender}\\n–ò–º—è: {user_name}\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age}\\n–ú–µ—Ç—Ä–æ: {metro_stations}\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status}\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation}\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n–ú–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∫–µ—Ç—É –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç!\",\n                  synonyms: [],\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-chat-link\",\n                      text: \"–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç üîó\",\n                      action: \"command\",\n                      target: \"/link\",\n                      buttonType: \"normal\"\n                    },\n                    {\n                      id: \"btn-show-profile-edit\",\n                      text: \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚úèÔ∏è\",\n                      action: \"command\",\n                      target: \"/profile\",\n                      buttonType: \"normal\"\n                    }\n                  ],\n                  markdown: false,\n                  oneTimeKeyboard: true,\n                  resizeKeyboard: true\n                }\n              },\n              {\n                id: \"show_profile\",\n                type: \"command\",\n                position: { x: 400, y: 500 },\n                data: {\n                  command: \"/profile\",\n                  commandName: \"/profile\",\n                  description: \"–ü–æ–∫–∞–∑–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\",\n                  synonyms: [\"–ø—Ä–æ—Ñ–∏–ª—å\", \"–∞–Ω–∫–µ—Ç–∞\", \"–º–æ–∏ –¥–∞–Ω–Ω—ã–µ\", \"—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å\"],\n                  messageText: \"üë§ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:\\n\\n–ü–æ–ª: {gender} üë§\\n–ò–º—è: {user_name} ‚úèÔ∏è\\n–í–æ–∑—Ä–∞—Å—Ç: {user_age} üéÇ\\n–ú–µ—Ç—Ä–æ: {metro_stations} üöá\\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests} üéØ\\n–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: {marital_status} üíç\\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {sexual_orientation} üåà\\n\\nüí¨ –ò—Å—Ç–æ—á–Ω–∏–∫: {user_source}\\n\\n‚úèÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-edit-gender\",\n                      text: \"üë§ –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª\",\n                      action: \"goto\",\n                      target: \"gender_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-name\",\n                      text: \"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è\",\n                      action: \"goto\",\n                      target: \"name_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-age\",\n                      text: \"üéÇ –ò–∑–º–µ–Ω–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç\",\n                      action: \"goto\",\n                      target: \"age_input\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-metro\",\n                      text: \"üöá –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç—Ä–æ\",\n                      action: \"goto\",\n                      target: \"metro_selection\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-interests\",\n                      text: \"üéØ –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã\",\n                      action: \"goto\",\n                      target: \"interests_categories\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-marital\",\n                      text: \"üíç –ò–∑–º–µ–Ω–∏—Ç—å —Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ\",\n                      action: \"goto\",\n                      target: \"marital_status\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-orientation\",\n                      text: \"üåà –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é\",\n                      action: \"goto\",\n                      target: \"sexual_orientation\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-channel\",\n                      text: \"üì¢ –£–∫–∞–∑–∞—Ç—å –¢–ì–ö\",\n                      action: \"goto\",\n                      target: \"channel_choice\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-edit-extra\",\n                      text: \"üìù –î–æ–±–∞–≤–∏—Ç—å –æ —Å–µ–±–µ\",\n                      action: \"goto\",\n                      target: \"extra_info\",\n                      buttonType: \"option\"\n                    },\n                    {\n                      id: \"btn-restart-from-profile\",\n                      text: \"üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\",\n                      action: \"command\",\n                      target: \"/start\",\n                      buttonType: \"navigation\"\n                    }\n                  ],\n                  markdown: false\n                }\n              },\n              {\n                id: \"chat_link\",\n                type: \"command\",\n                position: { x: 400, y: 700 },\n                data: {\n                  command: \"/link\",\n                  commandName: \"/link\",\n                  description: \"–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞\",\n                  synonyms: [\"—Å—Å—ã–ª–∫–∞\", \"—á–∞—Ç\", \"—Å–æ–æ–±—â–µ—Å—Ç–≤–æ\", \"–≤–ø—Ä–æ–≥—É–ª–∫–µ\", \"–ª–∏–Ω–∫\"],\n                  messageText: \"üîó –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç:\\n\\nhttps://t.me/+agkIVgCzHtY2ZTA6\\n\\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ ·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á! üéâ\",\n                  keyboardType: \"none\",\n                  buttons: [],\n                  markdown: false\n                }\n              },\n              {\n                id: \"help_command\",\n                type: \"command\",\n                position: { x: 400, y: 900 },\n                data: {\n                  command: \"/help\",\n                  commandName: \"/help\",\n                  description: \"–ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º –±–æ—Ç–∞ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏\",\n                  synonyms: [\"–ø–æ–º–æ—â—å\", \"—Å–ø—Ä–∞–≤–∫–∞\", \"–∫–æ–º–∞–Ω–¥—ã\", \"—á—Ç–æ –ø–∏—Å–∞—Ç—å\", \"–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è\", \"–∞–¥–º–∏–Ω —Å–ø—Ä–∞–≤–∫–∞\", \"–∞–¥–º–∏–Ω –ø–æ–º–æ—â—å\", \"–∞–¥–º–∏–Ω –∫–æ–º–∞–Ω–¥—ã\"],\n                  messageText: \"ü§ñ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä!**\\n\\nüåü **·¥†·¥®·¥©·¥è·¥¶ è·¥ß·¥ã·¥á Bot**\\n*–¢–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞—Ö*\\n\\nüéØ **–û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´:**\\n\\nüöÄ `/start` ‚Äî *–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ*\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `—Å—Ç–∞—Ä—Ç`, `–Ω–∞—á–∞—Ç—å`, `–ø—Ä–∏–≤–µ—Ç`, `–Ω–∞—á–∞–ª–æ`, `–Ω–∞—á–∏–Ω–∞–µ–º`\\n\\nüë§ `/profile` ‚Äî *–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å*\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–ø—Ä–æ—Ñ–∏–ª—å`, `–∞–Ω–∫–µ—Ç–∞`, `–º–æ–π –ø—Ä–æ—Ñ–∏–ª—å`, `–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å`, `—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å`\\n\\nüîó `/link` ‚Äî *–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç*\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `—Å—Å—ã–ª–∫–∞`, `—á–∞—Ç`, `—Å–æ–æ–±—â–µ—Å—Ç–≤–æ`, `–≤–ø—Ä–æ–≥—É–ª–∫–µ`, `–ª–∏–Ω–∫`\\n\\nüÜò `/help` ‚Äî *–≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞*\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–ø–æ–º–æ—â—å`, `—Å–ø—Ä–∞–≤–∫–∞`, `–∫–æ–º–∞–Ω–¥—ã`, `—á—Ç–æ –ø–∏—Å–∞—Ç—å`, `–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è`\\n\\nüìã **–†–ê–ó–î–ï–õ–´ –ê–ù–ö–ï–¢–´ –ò –ò–• –°–ò–ù–û–ù–ò–ú–´:**\\n\\nüë´ **–ü–æ–ª:** –º—É–∂—Å–∫–æ–π, –∂–µ–Ω—Å–∫–∏–π\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–ø–æ–ª`, `gender`\\n\\nüè∑Ô∏è **–ò–º—è:** –ª—é–±–æ–µ –∏–º—è\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–∏–º—è`, `–∫–∞–∫ –∑–æ–≤—É—Ç`, `–Ω–∞–∑–æ–≤–∏—Å—å`\\n\\nüéÇ **–í–æ–∑—Ä–∞—Å—Ç:** —á–∏—Å–ª–æ –æ—Ç 18 –¥–æ 99\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–≤–æ–∑—Ä–∞—Å—Ç`, `–ª–µ—Ç`, `—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç`\\n\\nüöá **–ú–µ—Ç—Ä–æ:** –≤—ã–±–æ—Ä –ª–∏–Ω–∏–∏ –∏ —Å—Ç–∞–Ω—Ü–∏–∏\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–º–µ—Ç—Ä–æ`, `—Å—Ç–∞–Ω—Ü–∏—è`\\n   üü• –ö—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è: `–∫—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è`, `–∫–∏—Ä–æ–≤—Å–∫–æ-–≤—ã–±–æ—Ä–≥—Å–∫–∞—è`, `–∫—Ä–∞—Å–Ω–∞—è –≤–µ—Ç–∫–∞`\\n   üü¶ –°–∏–Ω—è—è –ª–∏–Ω–∏—è: `—Å–∏–Ω—è—è –ª–∏–Ω–∏—è`, `–º–æ—Å–∫–æ–≤—Å–∫–æ-–ø–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∞—è`, `—Å–∏–Ω—è—è –≤–µ—Ç–∫–∞`\\n   üü© –ó–µ–ª–µ–Ω–∞—è –ª–∏–Ω–∏—è: `–∑–µ–ª–µ–Ω–∞—è –ª–∏–Ω–∏—è`, `–Ω–µ–≤—Å–∫–æ-–≤–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è`, `–∑–µ–ª–µ–Ω–∞—è –≤–µ—Ç–∫–∞`\\n   üüß –û—Ä–∞–Ω–∂–µ–≤–∞—è –ª–∏–Ω–∏—è: `–æ—Ä–∞–Ω–∂–µ–≤–∞—è –ª–∏–Ω–∏—è`, `–ø—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω–∞—è`, `–æ—Ä–∞–Ω–∂–µ–≤–∞—è –≤–µ—Ç–∫–∞`\\n   üü™ –§–∏–æ–ª–µ—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è: `—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è`, `—Ñ—Ä—É–Ω–∑–µ–Ω—Å–∫–æ-–ø—Ä–∏–º–æ—Ä—Å–∫–∞—è`, `—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –≤–µ—Ç–∫–∞`\\n\\nüé® **–ò–Ω—Ç–µ—Ä–µ—Å—ã –∏ –∏—Ö —Å–∏–Ω–æ–Ω–∏–º—ã:**\\n   üéÆ –•–æ–±–±–∏: `—Ö–æ–±–±–∏`, `—É–≤–ª–µ—á–µ–Ω–∏—è`, `–∑–∞–Ω—è—Ç–∏—è`, `–∏–≥—Ä—ã`\\n   ü§ù –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å: `–æ–±—â–µ–Ω–∏–µ`, `—Å–æ—Ü–∏–∞–ª—å–Ω–æ–µ`, `–ª—é–¥–∏`, `—Ç—É—Å–æ–≤–∫–∏`\\n   üé≠ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ: `—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ`, `–∏—Å–∫—É—Å—Å—Ç–≤–æ`, `—Ä–∏—Å–æ–≤–∞–Ω–∏–µ`, `–º—É–∑—ã–∫–∞`\\n   üí™ –ê–∫—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏: `–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å`, `–∞–∫—Ç–∏–≤–Ω—ã–π`, `–¥–≤–∏–∂–µ–Ω–∏–µ`, `–∑–¥–æ—Ä–æ–≤—å–µ`\\n   üçï –ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏: `–µ–¥–∞`, `–Ω–∞–ø–∏—Ç–∫–∏`, `–∫—É—Ö–Ω—è`, `—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã`\\n   ‚öΩ –°–ø–æ—Ä—Ç: `—Å–ø–æ—Ä—Ç`, `—Ñ–∏—Ç–Ω–µ—Å`, `—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏`, `—Ñ—É—Ç–±–æ–ª`\\n\\nüíë **–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ø–æ–∏—Å–∫, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∂–µ–Ω–∞—Ç/–∑–∞–º—É–∂–µ–º, —Å–ª–æ–∂–Ω–æ\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `—Å–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ`, `—Å—Ç–∞—Ç—É—Å`, `–æ—Ç–Ω–æ—à–µ–Ω–∏—è`, `—Å–µ–º—å—è`\\n\\nüåà **–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:** –≥–µ—Ç–µ—Ä–æ, –≥–µ–π, –ª–µ—Å–±–∏, –±–∏, –¥—Ä—É–≥–æ–µ\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è`, `–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è`\\n\\nüì∫ **–¢–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª:** –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `—Ç–≥–∫`, `—Ç–µ–ª–µ–≥—Ä–∞–º`, `–∫–∞–Ω–∞–ª`, `—Ç–≥ –∫–∞–Ω–∞–ª`\\n\\nüìñ **–û —Å–µ–±–µ:** –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–æ —Å–µ–±–µ`, `–æ–ø–∏—Å–∞–Ω–∏–µ`, `—Ä–∞—Å—Å–∫–∞–∂–∏`, `–∏–Ω—Ñ–æ`\\n\\nüëÆ‚Äç‚ôÇÔ∏è **–ö–û–ú–ê–ù–î–´ –ú–û–î–ï–†–ê–¶–ò–ò:**\\n\\n**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º:**\\nüìå `/pin_message` - –ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–∑–∞–∫—Ä–µ–ø–∏—Ç—å`, `–ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å`, `–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å`\\n\\nüìå‚ùå `/unpin_message` - –û—Ç–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–æ—Ç–∫—Ä–µ–ø–∏—Ç—å`, `–æ—Ç—Ü–µ–ø–∏—Ç—å`, `—É–±—Ä–∞—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ`\\n\\nüóëÔ∏è `/delete_message` - –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `—É–¥–∞–ª–∏—Ç—å`, `—Å—Ç–µ—Ä–µ—Ç—å`, `—É–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ`\\n\\n**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:**\\nüö´ `/ban_user` - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–∑–∞–±–∞–Ω–∏—Ç—å`, `–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å`, `–±–∞–Ω`\\n\\n‚úÖ `/unban_user` - –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `—Ä–∞–∑–±–∞–Ω–∏—Ç—å`, `—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å`, `unb√°n`\\n\\nüîá `/mute_user` - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–∑–∞–º—É—Ç–∏—Ç—å`, `–∑–∞–≥–ª—É—à–∏—Ç—å`, `–º—É—Ç`\\n\\nüîä `/unmute_user` - –°–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `—Ä–∞–∑–º—É—Ç–∏—Ç—å`, `—Ä–∞–∑–≥–ª—É—à–∏—Ç—å`, `–∞–Ω–º—É—Ç`\\n\\nüë¢ `/kick_user` - –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–∫–∏–∫–Ω—É—Ç—å`, `–∏—Å–∫–ª—é—á–∏—Ç—å`, `–≤—ã–≥–Ω–∞—Ç—å`\\n\\nüëë `/promote_user` - –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–ø–æ–≤—ã—Å–∏—Ç—å`, `–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º`, `–ø—Ä–æ–º–æ—É—Ç`\\n\\nüë§ `/demote_user` - –°–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–ø–æ–Ω–∏–∑–∏—Ç—å`, `—Å–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∞`, `–¥–µ–º–æ—É—Ç`\\n\\n‚öôÔ∏è `/admin_rights` - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\\n   üìù –°–∏–Ω–æ–Ω–∏–º—ã: `–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞`, `–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞`, `—Ç–≥ –ø—Ä–∞–≤–∞`\\n   ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≥—Ä—É–ø–ø—ã!\\n   üí° –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ–º–∞–Ω–¥–æ–π\\n\\n**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**\\n‚Ä¢ –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π –¥–ª—è –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏\\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π\\n‚Ä¢ –ö–æ–º–∞–Ω–¥—ã —Å –ø—Ä–∞–≤–∞–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö/—Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞—Ö\\n‚Ä¢ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏\\n\\nüí° **–ü–û–õ–ï–ó–ù–´–ï –°–û–í–ï–¢–´:**\\n\\n‚ú® –ú–æ–∂–µ—à—å –ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —Å–∏–Ω–æ–Ω–∏–º—ã –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞\\n‚ú® –ë–æ—Ç –ø–æ–π–º–µ—Ç —Ç–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∞–∂–µ –±–µ–∑ –∫–æ–º–∞–Ω–¥\\n‚ú® –í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –º–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å /start –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–Ω–æ–≤–æ\\n‚ú® –ò—Å–ø–æ–ª—å–∑—É–π /profile –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª—é–±—ã—Ö –¥–∞–Ω–Ω—ã—Ö\\n‚ú® –ù–∞–∂–º–∏ –Ω–∞ –ª—é–±–æ–µ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–ª–æ–≤–æ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ!\\n\\nüéâ **–£–¥–∞—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –≤ –ü–∏—Ç–µ—Ä–µ!** üéâ\",\n                  keyboardType: \"inline\",\n                  buttons: [\n                    {\n                      id: \"btn-help-start\",\n                      text: \"üöÄ –ù–∞—á–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ\",\n                      action: \"command\",\n                      target: \"/start\",\n                      buttonType: \"navigation\"\n                    },\n                    {\n                      id: \"btn-help-profile\",\n                      text: \"üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å\",\n                      action: \"command\",\n                      target: \"/profile\",\n                      buttonType: \"navigation\"\n                    },\n                    {\n                      id: \"btn-help-link\",\n                      text: \"üîó –°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç\",\n                      action: \"command\",\n                      target: \"/link\",\n                      buttonType: \"navigation\"\n                    }\n                  ],\n                  markdown: true,\n                  formatMode: \"markdown\",\n                  showInMenu: true,\n                  isPrivateOnly: false,\n                  requiresAuth: false,\n                  adminOnly: false\n                }\n              }\n            ]\n          },\n\n          // ===== –õ–ò–°–¢–´ –ò–ó –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò –ú–û–î–ï–†–ê–¢–û–†–ê =====\n\n          // –õ–∏—Å—Ç 8: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n          {\n            id: \"content_sheet\",\n            name: \"üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\",\n            description: \"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞\",\n            nodes: [\n              {\n                id: \"pin_message_node\",\n                type: \"pin_message\",\n                position: { x: 200, y: 300 },\n                data: {\n                  command: \"/pin_message\",\n                  messageText: \"üìå –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ!\",\n                  synonyms: [\"–∑–∞–∫—Ä–µ–ø–∏—Ç—å\", \"–ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å\", \"–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å\"],\n                  disableNotification: false,\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"unpin_message_node\",\n                type: \"unpin_message\",\n                position: { x: 400, y: 300 },\n                data: {\n                  command: \"/unpin_message\",\n                  messageText: \"üìå‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–æ!\",\n                  synonyms: [\"–æ—Ç–∫—Ä–µ–ø–∏—Ç—å\", \"–æ—Ç—Ü–µ–ø–∏—Ç—å\", \"—É–±—Ä–∞—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"delete_message_node\",\n                type: \"delete_message\",\n                position: { x: 600, y: 300 },\n                data: {\n                  command: \"/delete_message\",\n                  messageText: \"üóëÔ∏è –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!\",\n                  synonyms: [\"—É–¥–∞–ª–∏—Ç—å\", \"—Å—Ç–µ—Ä–µ—Ç—å\", \"—É–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              }\n            ],\n            connections: []\n          },\n\n          // –õ–∏—Å—Ç 9: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n          {\n            id: \"users_sheet\",\n            name: \"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\",\n            description: \"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã\",\n            nodes: [\n              {\n                id: \"ban_user_node\",\n                type: \"ban_user\",\n                position: { x: 100, y: 500 },\n                data: {\n                  command: \"/ban_user\",\n                  messageText: \"üö´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –≥—Ä—É–ø–ø–µ!\",\n                  synonyms: [\"–∑–∞–±–∞–Ω–∏—Ç—å\", \"–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å\", \"–±–∞–Ω\"],\n                  reason: \"–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã\",\n                  untilDate: 0,\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"unban_user_node\",\n                type: \"unban_user\",\n                position: { x: 250, y: 500 },\n                data: {\n                  command: \"/unban_user\",\n                  messageText: \"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!\",\n                  synonyms: [\"—Ä–∞–∑–±–∞–Ω–∏—Ç—å\", \"—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å\", \"unb–∞–Ω\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"mute_user_node\",\n                type: \"mute_user\",\n                position: { x: 400, y: 500 },\n                data: {\n                  command: \"/mute_user\",\n                  messageText: \"üîá –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –≤ –ø—Ä–∞–≤–∞—Ö!\",\n                  synonyms: [\"–∑–∞–º—É—Ç–∏—Ç—å\", \"–∑–∞–≥–ª—É—à–∏—Ç—å\", \"–º—É—Ç\"],\n                  reason: \"–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã\",\n                  duration: 3600,\n                  canSendMessages: false,\n                  canSendMediaMessages: false,\n                  canSendPolls: false,\n                  canSendOtherMessages: false,\n                  canAddWebPagePreviews: false,\n                  canChangeGroupInfo: false,\n                  canInviteUsers2: false,\n                  canPinMessages2: false,\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"unmute_user_node\",\n                type: \"unmute_user\",\n                position: { x: 550, y: 500 },\n                data: {\n                  command: \"/unmute_user\",\n                  messageText: \"üîä –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–Ω—è—Ç—ã!\",\n                  synonyms: [\"—Ä–∞–∑–º—É—Ç–∏—Ç—å\", \"—Ä–∞–∑–≥–ª—É—à–∏—Ç—å\", \"–∞–Ω–º—É—Ç\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"kick_user_node\",\n                type: \"kick_user\",\n                position: { x: 700, y: 500 },\n                data: {\n                  command: \"/kick_user\",\n                  messageText: \"üë¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ –≥—Ä—É–ø–ø—ã!\",\n                  synonyms: [\"–∫–∏–∫–Ω—É—Ç—å\", \"–∏—Å–∫–ª—é—á–∏—Ç—å\", \"–≤—ã–≥–Ω–∞—Ç—å\"],\n                  reason: \"–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã\",\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"promote_user_node\",\n                type: \"promote_user\",\n                position: { x: 500, y: 700 },\n                data: {\n                  command: \"/promote_user\",\n                  messageText: \"üëë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!\",\n                  synonyms: [\"–ø–æ–≤—ã—Å–∏—Ç—å\", \"–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º\", \"–ø—Ä–æ–º–æ—É—Ç\"],\n                  canChangeInfo: false,\n                  canDeleteMessages: true,\n                  canBanUsers: false,\n                  canInviteUsers: true,\n                  canPinMessages: true,\n                  canAddAdmins: false,\n                  canRestrictMembers: false,\n                  canPromoteMembers: false,\n                  canManageVideoChats: false,\n                  isAnonymous: false,\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"demote_user_node\",\n                type: \"demote_user\",\n                position: { x: 700, y: 700 },\n                data: {\n                  command: \"/demote_user\",\n                  messageText: \"üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω—è—Ç —Å –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!\",\n                  synonyms: [\"–ø–æ–Ω–∏–∑–∏—Ç—å\", \"—Å–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∞\", \"–¥–µ–º–æ—É—Ç\"],\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              },\n              {\n                id: \"admin_rights_node\",\n                type: \"admin_rights\",\n                position: { x: 300, y: 900 },\n                data: {\n                  command: \"/admin_rights\",\n                  messageText: \"‚öôÔ∏è –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!\\n\\nüí° –ß—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /admin_rights\",\n                  synonyms: [\"–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞\", \"–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞\", \"—Ç–≥ –ø—Ä–∞–≤–∞\", \"–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\", \"admin rights\"],\n                  description: \"–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –≥—Ä—É–ø–ø–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)\",\n                  adminUserIdSource: \"reply_to_message\",\n                  adminOnly: true,\n                  requiresGroup: true,\n                  isPrivateOnly: false,\n                  can_manage_chat: false,\n                  can_delete_messages: true,\n                  can_manage_video_chats: false,\n                  can_restrict_members: true,\n                  can_promote_members: false,\n                  can_change_info: false,\n                  can_invite_users: true,\n                  can_pin_messages: true,\n                  can_manage_topics: false,\n                  is_anonymous: false,\n                  adminChatIdSource: \"current_chat\",\n                  keyboardType: \"none\",\n                  buttons: []\n                }\n              }\n            ],\n            connections: []\n          }\n        ],\n\n        // –°–≤—è–∑–∏ –º–µ–∂–¥—É –ª–∏—Å—Ç–∞–º–∏\n        interSheetConnections: [\n          // === –û–°–ù–û–í–ù–û–ô –ü–û–¢–û–ö –í–ü—Ä–æ–≥—É–ª–∫–µ ===\n          // –ò–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n          {\n            id: \"inter-welcome-basic\",\n            sourceSheetId: \"welcome_sheet\",\n            targetSheetId: \"basic_info_sheet\",\n            sourceNodeId: \"join_request\",\n            targetNodeId: \"gender_selection\",\n            sourceHandle: \"btn-yes\",\n            targetHandle: \"target\"\n          },\n          // –ò–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫ –º–µ—Ç—Ä–æ\n          {\n            id: \"inter-basic-metro\",\n            sourceSheetId: \"basic_info_sheet\",\n            targetSheetId: \"metro_sheet\",\n            sourceNodeId: \"age_input\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          // –ò–∑ –º–µ—Ç—Ä–æ –∫ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º\n          {\n            id: \"inter-metro-interests\",\n            sourceSheetId: \"metro_sheet\",\n            targetSheetId: \"interests_sheet\",\n            sourceNodeId: \"metro_selection\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          // –ò–∑ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –∫ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n          {\n            id: \"inter-interests-personal\",\n            sourceSheetId: \"interests_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"interests_categories\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n          // –ò–∑ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫ –ø—Ä–æ—Ñ–∏–ª—é\n          {\n            id: \"inter-personal-profile\",\n            sourceSheetId: \"personal_sheet\",\n            targetSheetId: \"profile_sheet\",\n            sourceNodeId: \"extra_info\",\n            targetNodeId: \"profile_complete\",\n            sourceHandle: \"source\",\n            targetHandle: \"target\"\n          },\n\n          // === –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–§–ò–õ–Ø (–í–æ–∑–≤—Ä–∞—Ç –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ª–∏—Å—Ç–∞–º) ===\n          {\n            id: \"inter-profile-basic-gender\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"basic_info_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"gender_selection\",\n            sourceHandle: \"btn-edit-gender\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-basic-name\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"basic_info_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"name_input\",\n            sourceHandle: \"btn-edit-name\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-basic-age\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"basic_info_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"age_input\",\n            sourceHandle: \"btn-edit-age\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-metro\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"metro_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"metro_selection\",\n            sourceHandle: \"btn-edit-metro\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-interests\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"interests_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"interests_categories\",\n            sourceHandle: \"btn-edit-interests\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-personal-marital\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"marital_status\",\n            sourceHandle: \"btn-edit-marital\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-personal-orientation\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"sexual_orientation\",\n            sourceHandle: \"btn-edit-orientation\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-personal-channel\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"channel_choice\",\n            sourceHandle: \"btn-edit-channel\",\n            targetHandle: \"target\"\n          },\n          {\n            id: \"inter-profile-personal-extra\",\n            sourceSheetId: \"profile_sheet\",\n            targetSheetId: \"personal_sheet\",\n            sourceNodeId: \"show_profile\",\n            targetNodeId: \"extra_info\",\n            sourceHandle: \"btn-edit-extra\",\n            targetHandle: \"target\"\n          }\n        ]\n      }\n    });\n\n    console.log('‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –í–ü—Ä–æ–≥—É–ª–∫–µ + –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —Å–æ–∑–¥–∞–Ω');\n    console.log('‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–æ–∑–¥–∞–Ω—ã');\n\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤:', error);\n  }\n}\n\nexport { seedDefaultTemplates };","size_bytes":299906},"server/storage.ts":{"content":"import { \n  botProjects, \n  botInstances,\n  botTemplates,\n  botTokens,\n  mediaFiles,\n  userBotData,\n  botGroups,\n  groupMembers,\n  botUsers,\n  type BotProject, \n  type InsertBotProject,\n  type BotInstance,\n  type InsertBotInstance,\n  type BotTemplate,\n  type InsertBotTemplate,\n  type BotToken,\n  type InsertBotToken,\n  type MediaFile,\n  type InsertMediaFile,\n  type UserBotData,\n  type InsertUserBotData,\n  type BotGroup,\n  type InsertBotGroup,\n  type GroupMember,\n  type InsertGroupMember,\n  type BotUser\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, asc, and, like, or, ilike, sql } from \"drizzle-orm\";\nimport { dbManager } from \"./db-utils\";\nimport { cachedOps } from \"./db-cache\";\n\nexport interface IStorage {\n  getBotProject(id: number): Promise<BotProject | undefined>;\n  getAllBotProjects(): Promise<BotProject[]>;\n  createBotProject(project: InsertBotProject): Promise<BotProject>;\n  updateBotProject(id: number, project: Partial<InsertBotProject>): Promise<BotProject | undefined>;\n  deleteBotProject(id: number): Promise<boolean>;\n  \n  // Bot instances\n  getBotInstance(projectId: number): Promise<BotInstance | undefined>;\n  getBotInstanceByToken(tokenId: number): Promise<BotInstance | undefined>;\n  getBotInstancesByProject(projectId: number): Promise<BotInstance[]>;\n  getAllBotInstances(): Promise<BotInstance[]>;\n  createBotInstance(instance: InsertBotInstance): Promise<BotInstance>;\n  updateBotInstance(id: number, instance: Partial<InsertBotInstance>): Promise<BotInstance | undefined>;\n  deleteBotInstance(id: number): Promise<boolean>;\n  stopBotInstance(projectId: number): Promise<boolean>;\n  stopBotInstanceByToken(tokenId: number): Promise<boolean>;\n  \n  // Bot templates\n  getBotTemplate(id: number): Promise<BotTemplate | undefined>;\n  getAllBotTemplates(): Promise<BotTemplate[]>;\n  createBotTemplate(template: InsertBotTemplate): Promise<BotTemplate>;\n  updateBotTemplate(id: number, template: Partial<InsertBotTemplate>): Promise<BotTemplate | undefined>;\n  deleteBotTemplate(id: number): Promise<boolean>;\n  incrementTemplateUseCount(id: number): Promise<boolean>;\n  incrementTemplateViewCount(id: number): Promise<boolean>;\n  incrementTemplateDownloadCount(id: number): Promise<boolean>;\n  toggleTemplateLike(id: number, liked: boolean): Promise<boolean>;\n  toggleTemplateBookmark(id: number, bookmarked: boolean): Promise<boolean>;\n  rateTemplate(id: number, rating: number): Promise<boolean>;\n  getFeaturedTemplates(): Promise<BotTemplate[]>;\n  getTemplatesByCategory(category: string): Promise<BotTemplate[]>;\n  searchTemplates(query: string): Promise<BotTemplate[]>;\n  \n  // Bot tokens\n  getBotToken(id: number): Promise<BotToken | undefined>;\n  getBotTokensByProject(projectId: number): Promise<BotToken[]>;\n  getDefaultBotToken(projectId: number): Promise<BotToken | undefined>;\n  createBotToken(token: InsertBotToken): Promise<BotToken>;\n  updateBotToken(id: number, token: Partial<InsertBotToken>): Promise<BotToken | undefined>;\n  deleteBotToken(id: number): Promise<boolean>;\n  setDefaultBotToken(projectId: number, tokenId: number): Promise<boolean>;\n  markTokenAsUsed(id: number): Promise<boolean>;\n  \n  // Media files\n  getMediaFile(id: number): Promise<MediaFile | undefined>;\n  getMediaFilesByProject(projectId: number): Promise<MediaFile[]>;\n  getMediaFilesByType(projectId: number, fileType: string): Promise<MediaFile[]>;\n  createMediaFile(file: InsertMediaFile): Promise<MediaFile>;\n  updateMediaFile(id: number, file: Partial<InsertMediaFile>): Promise<MediaFile | undefined>;\n  deleteMediaFile(id: number): Promise<boolean>;\n  incrementMediaFileUsage(id: number): Promise<boolean>;\n  searchMediaFiles(projectId: number, query: string): Promise<MediaFile[]>;\n  \n  // User bot data\n  getUserBotData(id: number): Promise<UserBotData | undefined>;\n  getUserBotDataByProjectAndUser(projectId: number, userId: string): Promise<UserBotData | undefined>;\n  getUserBotDataByProject(projectId: number): Promise<UserBotData[]>;\n  getAllUserBotData(): Promise<UserBotData[]>;\n  createUserBotData(userData: InsertUserBotData): Promise<UserBotData>;\n  updateUserBotData(id: number, userData: Partial<InsertUserBotData>): Promise<UserBotData | undefined>;\n  deleteUserBotData(id: number): Promise<boolean>;\n  deleteUserBotDataByProject(projectId: number): Promise<boolean>;\n  incrementUserInteraction(id: number): Promise<boolean>;\n  updateUserState(id: number, state: string): Promise<boolean>;\n  searchUserBotData(projectId: number, query: string): Promise<UserBotData[]>;\n  getUserBotDataStats(projectId: number): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    blockedUsers: number;\n    premiumUsers: number;\n    totalInteractions: number;\n    avgInteractionsPerUser: number;\n  }>;\n  \n  // Bot groups\n  getBotGroup(id: number): Promise<BotGroup | undefined>;\n  getBotGroupsByProject(projectId: number): Promise<BotGroup[]>;\n  getBotGroupByProjectAndGroupId(projectId: number, groupId: string): Promise<BotGroup | undefined>;\n  createBotGroup(group: InsertBotGroup): Promise<BotGroup>;\n  updateBotGroup(id: number, group: Partial<InsertBotGroup>): Promise<BotGroup | undefined>;\n  deleteBotGroup(id: number): Promise<boolean>;\n  \n  // Group members\n  getGroupMembers(groupId: number): Promise<GroupMember[]>;\n  createGroupMember(member: InsertGroupMember): Promise<GroupMember>;\n  updateGroupMember(id: number, member: Partial<InsertGroupMember>): Promise<GroupMember | undefined>;\n  deleteGroupMember(id: number): Promise<boolean>;\n}\n\n// Legacy Memory Storage - kept for reference\nclass MemStorage implements IStorage {\n  private projects: Map<number, BotProject>;\n  private instances: Map<number, BotInstance>;\n  private templates: Map<number, BotTemplate>;\n  currentId: number;\n  currentInstanceId: number;\n  currentTemplateId: number;\n\n  constructor() {\n    this.projects = new Map();\n    this.instances = new Map();\n    this.templates = new Map();\n    this.currentId = 1;\n    this.currentInstanceId = 1;\n    this.currentTemplateId = 1;\n    \n    // Add a default project\n    const defaultProject: BotProject = {\n      id: 1,\n      name: \"–ú–æ–π –ø–µ—Ä–≤—ã–π –±–æ—Ç\",\n      description: \"–ü—Ä–∏–º–µ—Ä –±–æ—Ç–∞ –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º\",\n      data: {\n        nodes: [\n          {\n            id: \"start-1\",\n            type: \"start\",\n            position: { x: 100, y: 100 },\n            data: {\n              command: \"/start\",\n              description: \"–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\",\n              messageText: \"–ü—Ä–∏–≤–µ—Ç! üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –±–æ—Ç!\",\n              keyboardType: \"reply\",\n              buttons: [\n                {\n                  id: \"btn-1\",\n                  text: \"üìã –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n                  action: \"goto\",\n                  target: \"menu-1\"\n                },\n                {\n                  id: \"btn-2\", \n                  text: \"‚ÑπÔ∏è –û –Ω–∞—Å\",\n                  action: \"goto\",\n                  target: \"about-1\"\n                }\n              ],\n              markdown: false,\n              oneTimeKeyboard: false,\n              resizeKeyboard: true\n            }\n          }\n        ],\n        connections: []\n      },\n      botToken: null,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n    \n    this.projects.set(1, defaultProject);\n    this.currentId = 2;\n  }\n\n  async getBotProject(id: number): Promise<BotProject | undefined> {\n    return this.projects.get(id);\n  }\n\n  async getAllBotProjects(): Promise<BotProject[]> {\n    return Array.from(this.projects.values());\n  }\n\n  async createBotProject(insertProject: InsertBotProject): Promise<BotProject> {\n    const id = this.currentId++;\n    const project: BotProject = {\n      ...insertProject,\n      id,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      description: insertProject.description || null,\n      botToken: insertProject.botToken ?? null,\n    };\n    this.projects.set(id, project);\n    return project;\n  }\n\n  async updateBotProject(id: number, updateData: Partial<InsertBotProject>): Promise<BotProject | undefined> {\n    const project = this.projects.get(id);\n    if (!project) return undefined;\n\n    const updatedProject: BotProject = {\n      ...project,\n      ...updateData,\n      updatedAt: new Date(),\n    };\n    \n    this.projects.set(id, updatedProject);\n    return updatedProject;\n  }\n\n  async deleteBotProject(id: number): Promise<boolean> {\n    return this.projects.delete(id);\n  }\n\n  // Bot instances methods\n  async getBotInstance(projectId: number): Promise<BotInstance | undefined> {\n    return Array.from(this.instances.values()).find(instance => instance.projectId === projectId);\n  }\n\n  async getBotInstanceByToken(tokenId: number): Promise<BotInstance | undefined> {\n    return Array.from(this.instances.values()).find(instance => instance.tokenId === tokenId);\n  }\n\n  async getBotInstancesByProject(projectId: number): Promise<BotInstance[]> {\n    return Array.from(this.instances.values()).filter(instance => instance.projectId === projectId);\n  }\n\n  async getAllBotInstances(): Promise<BotInstance[]> {\n    return Array.from(this.instances.values());\n  }\n\n  async createBotInstance(insertInstance: InsertBotInstance): Promise<BotInstance> {\n    // –¢–µ–ø–µ—Ä—å —É–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –∂–µ —Ç–æ–∫–µ–Ω–∞\n    const existingInstance = await this.getBotInstanceByToken(insertInstance.tokenId);\n    if (existingInstance) {\n      await this.deleteBotInstance(existingInstance.id);\n    }\n\n    const id = this.currentInstanceId++;\n    const instance: BotInstance = {\n      ...insertInstance,\n      id,\n      startedAt: new Date(),\n      stoppedAt: null,\n      errorMessage: insertInstance.errorMessage || null,\n      processId: insertInstance.processId || null,\n    };\n    this.instances.set(id, instance);\n    return instance;\n  }\n\n  async updateBotInstance(id: number, updateData: Partial<InsertBotInstance>): Promise<BotInstance | undefined> {\n    const instance = this.instances.get(id);\n    if (!instance) return undefined;\n\n    const updatedInstance: BotInstance = {\n      ...instance,\n      ...updateData,\n      stoppedAt: updateData.status === 'stopped' ? new Date() : instance.stoppedAt,\n    };\n    \n    this.instances.set(id, updatedInstance);\n    return updatedInstance;\n  }\n\n  async deleteBotInstance(id: number): Promise<boolean> {\n    return this.instances.delete(id);\n  }\n\n  async stopBotInstance(projectId: number): Promise<boolean> {\n    const instance = await this.getBotInstance(projectId);\n    if (!instance) return false;\n    \n    const updated = await this.updateBotInstance(instance.id, { \n      status: 'stopped'\n    });\n    return !!updated;\n  }\n\n  async stopBotInstanceByToken(tokenId: number): Promise<boolean> {\n    const instance = await this.getBotInstanceByToken(tokenId);\n    if (!instance) return false;\n    \n    const updated = await this.updateBotInstance(instance.id, { \n      status: 'stopped'\n    });\n    return !!updated;\n  }\n\n  // Bot templates methods\n  async getBotTemplate(id: number): Promise<BotTemplate | undefined> {\n    return this.templates.get(id);\n  }\n\n  async getAllBotTemplates(): Promise<BotTemplate[]> {\n    return Array.from(this.templates.values());\n  }\n\n  async createBotTemplate(insertTemplate: InsertBotTemplate): Promise<BotTemplate> {\n    const id = this.currentTemplateId++;\n    const template: BotTemplate = {\n      ...insertTemplate,\n      id,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      category: insertTemplate.category || \"custom\",\n      tags: insertTemplate.tags || [],\n      isPublic: insertTemplate.isPublic || 0,\n      description: insertTemplate.description || null,\n      difficulty: insertTemplate.difficulty || \"easy\",\n      authorId: insertTemplate.authorId || null,\n      authorName: insertTemplate.authorName || null,\n      useCount: 0,\n      rating: 0,\n      ratingCount: 0,\n      featured: 0,\n      version: insertTemplate.version || \"1.0.0\",\n      previewImage: insertTemplate.previewImage || null,\n      lastUsedAt: null,\n      downloadCount: 0,\n      likeCount: 0,\n      bookmarkCount: 0,\n      viewCount: 0,\n      language: insertTemplate.language || \"ru\",\n      requiresToken: insertTemplate.requiresToken || 0,\n      complexity: insertTemplate.complexity || 1,\n      estimatedTime: insertTemplate.estimatedTime || 5,\n    };\n    this.templates.set(id, template);\n    return template;\n  }\n\n  async updateBotTemplate(id: number, updateData: Partial<InsertBotTemplate>): Promise<BotTemplate | undefined> {\n    const template = this.templates.get(id);\n    if (!template) return undefined;\n\n    const updatedTemplate: BotTemplate = {\n      ...template,\n      ...updateData,\n      updatedAt: new Date(),\n    };\n    \n    this.templates.set(id, updatedTemplate);\n    return updatedTemplate;\n  }\n\n  async deleteBotTemplate(id: number): Promise<boolean> {\n    return this.templates.delete(id);\n  }\n\n  async incrementTemplateUseCount(id: number): Promise<boolean> {\n    const template = this.templates.get(id);\n    if (!template) return false;\n\n    const updatedTemplate = {\n      ...template,\n      useCount: (template.useCount || 0) + 1,\n      lastUsedAt: new Date(),\n      updatedAt: new Date(),\n    };\n    \n    this.templates.set(id, updatedTemplate);\n    return true;\n  }\n\n  async incrementTemplateViewCount(id: number): Promise<boolean> {\n    const template = this.templates.get(id);\n    if (!template) return false;\n\n    const updatedTemplate = {\n      ...template,\n      viewCount: (template.viewCount || 0) + 1,\n      updatedAt: new Date(),\n    };\n    \n    this.templates.set(id, updatedTemplate);\n    return true;\n  }\n\n  async incrementTemplateDownloadCount(id: number): Promise<boolean> {\n    const template = this.templates.get(id);\n    if (!template) return false;\n\n    const updatedTemplate = {\n      ...template,\n      downloadCount: (template.downloadCount || 0) + 1,\n      updatedAt: new Date(),\n    };\n    \n    this.templates.set(id, updatedTemplate);\n    return true;\n  }\n\n  async toggleTemplateLike(id: number, liked: boolean): Promise<boolean> {\n    const template = this.templates.get(id);\n    if (!template) return false;\n\n    const updatedTemplate = {\n      ...template,\n      likeCount: Math.max(0, (template.likeCount || 0) + (liked ? 1 : -1)),\n      updatedAt: new Date(),\n    };\n    \n    this.templates.set(id, updatedTemplate);\n    return true;\n  }\n\n  async toggleTemplateBookmark(id: number, bookmarked: boolean): Promise<boolean> {\n    const template = this.templates.get(id);\n    if (!template) return false;\n\n    const updatedTemplate = {\n      ...template,\n      bookmarkCount: Math.max(0, (template.bookmarkCount || 0) + (bookmarked ? 1 : -1)),\n      updatedAt: new Date(),\n    };\n    \n    this.templates.set(id, updatedTemplate);\n    return true;\n  }\n\n  async rateTemplate(id: number, rating: number): Promise<boolean> {\n    const template = this.templates.get(id);\n    if (!template) return false;\n\n    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥\n    const currentRatingCount = template.ratingCount || 0;\n    const currentRating = template.rating || 0;\n    const newRatingCount = currentRatingCount + 1;\n    const newRating = Math.round(((currentRating * currentRatingCount) + rating) / newRatingCount);\n\n    const updatedTemplate = {\n      ...template,\n      rating: newRating,\n      ratingCount: newRatingCount,\n      updatedAt: new Date(),\n    };\n    \n    this.templates.set(id, updatedTemplate);\n    return true;\n  }\n\n  async getFeaturedTemplates(): Promise<BotTemplate[]> {\n    return Array.from(this.templates.values()).filter(template => template.featured === 1);\n  }\n\n  async getTemplatesByCategory(category: string): Promise<BotTemplate[]> {\n    return Array.from(this.templates.values()).filter(template => template.category === category);\n  }\n\n  async searchTemplates(query: string): Promise<BotTemplate[]> {\n    const searchTerm = query.toLowerCase();\n    return Array.from(this.templates.values()).filter(template => \n      template.name.toLowerCase().includes(searchTerm) ||\n      (template.description && template.description.toLowerCase().includes(searchTerm)) ||\n      (template.tags && template.tags.some(tag => tag.toLowerCase().includes(searchTerm)))\n    );\n  }\n\n  // Bot Tokens (Memory implementation)\n  async getBotToken(id: number): Promise<BotToken | undefined> {\n    // In memory implementation - tokens are not stored\n    return undefined;\n  }\n\n  async getBotTokensByProject(projectId: number): Promise<BotToken[]> {\n    // In memory implementation - tokens are not stored\n    return [];\n  }\n\n  async getDefaultBotToken(projectId: number): Promise<BotToken | undefined> {\n    // In memory implementation - tokens are not stored\n    return undefined;\n  }\n\n  async createBotToken(insertToken: InsertBotToken): Promise<BotToken> {\n    // In memory implementation - create temporary token\n    const token: BotToken = {\n      ...insertToken,\n      id: this.currentTemplateId++, // Reuse template ID counter\n      description: insertToken.description || null,\n      lastUsedAt: null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π\n      botFirstName: insertToken.botFirstName || null,\n      botUsername: insertToken.botUsername || null,\n      botDescription: insertToken.botDescription || null,\n      botShortDescription: insertToken.botShortDescription || null,\n      botPhotoUrl: insertToken.botPhotoUrl || null,\n      botCanJoinGroups: insertToken.botCanJoinGroups || null,\n      botCanReadAllGroupMessages: insertToken.botCanReadAllGroupMessages || null,\n      botSupportsInlineQueries: insertToken.botSupportsInlineQueries || null,\n      botHasMainWebApp: insertToken.botHasMainWebApp || null,\n    };\n    return token;\n  }\n\n  async updateBotToken(id: number, updateData: Partial<InsertBotToken>): Promise<BotToken | undefined> {\n    // In memory implementation - not supported\n    return undefined;\n  }\n\n  async deleteBotToken(id: number): Promise<boolean> {\n    // In memory implementation - not supported\n    return false;\n  }\n\n  async setDefaultBotToken(projectId: number, tokenId: number): Promise<boolean> {\n    // In memory implementation - not supported\n    return false;\n  }\n\n  async markTokenAsUsed(id: number): Promise<boolean> {\n    // In memory implementation - not supported\n    return false;\n  }\n\n  // Media Files (Memory implementation - not supported)\n  async getMediaFile(id: number): Promise<MediaFile | undefined> {\n    return undefined;\n  }\n\n  async getMediaFilesByProject(projectId: number): Promise<MediaFile[]> {\n    return [];\n  }\n\n  async getMediaFilesByType(projectId: number, fileType: string): Promise<MediaFile[]> {\n    return [];\n  }\n\n  async createMediaFile(insertFile: InsertMediaFile): Promise<MediaFile> {\n    const file: MediaFile = {\n      ...insertFile,\n      id: this.currentTemplateId++,\n      description: insertFile.description || null,\n      usageCount: 0,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    return file;\n  }\n\n  async updateMediaFile(id: number, updateData: Partial<InsertMediaFile>): Promise<MediaFile | undefined> {\n    return undefined;\n  }\n\n  async deleteMediaFile(id: number): Promise<boolean> {\n    return false;\n  }\n\n  async incrementMediaFileUsage(id: number): Promise<boolean> {\n    return false;\n  }\n\n  async searchMediaFiles(projectId: number, query: string): Promise<MediaFile[]> {\n    return [];\n  }\n\n  // User Bot Data (Memory implementation - not supported)\n  async getUserBotData(id: number): Promise<UserBotData | undefined> {\n    return undefined;\n  }\n\n  async getUserBotDataByProjectAndUser(projectId: number, userId: string): Promise<UserBotData | undefined> {\n    return undefined;\n  }\n\n  async getUserBotDataByProject(projectId: number): Promise<UserBotData[]> {\n    return [];\n  }\n\n  async getAllUserBotData(): Promise<UserBotData[]> {\n    return [];\n  }\n\n  async createUserBotData(insertUserData: InsertUserBotData): Promise<UserBotData> {\n    const userData: UserBotData = {\n      ...insertUserData,\n      id: this.currentTemplateId++,\n      userName: insertUserData.userName || null,\n      firstName: insertUserData.firstName || null,\n      lastName: insertUserData.lastName || null,\n      languageCode: insertUserData.languageCode || null,\n      lastInteraction: new Date(),\n      interactionCount: insertUserData.interactionCount || 0,\n      userData: insertUserData.userData || {},\n      currentState: insertUserData.currentState || null,\n      preferences: insertUserData.preferences || {},\n      commandsUsed: insertUserData.commandsUsed || {},\n      sessionsCount: insertUserData.sessionsCount || 1,\n      totalMessagesSent: insertUserData.totalMessagesSent || 0,\n      totalMessagesReceived: insertUserData.totalMessagesReceived || 0,\n      deviceInfo: insertUserData.deviceInfo || null,\n      locationData: insertUserData.locationData || null,\n      contactData: insertUserData.contactData || null,\n      isBot: insertUserData.isBot || 0,\n      isPremium: insertUserData.isPremium || 0,\n      isBlocked: insertUserData.isBlocked || 0,\n      isActive: insertUserData.isActive || 1,\n      tags: insertUserData.tags || [],\n      notes: insertUserData.notes || null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    return userData;\n  }\n\n  async updateUserBotData(id: number, updateData: Partial<InsertUserBotData>): Promise<UserBotData | undefined> {\n    return undefined;\n  }\n\n  async deleteUserBotData(id: number): Promise<boolean> {\n    return false;\n  }\n\n  async deleteUserBotDataByProject(projectId: number): Promise<boolean> {\n    return false;\n  }\n\n  async incrementUserInteraction(id: number): Promise<boolean> {\n    return false;\n  }\n\n  async updateUserState(id: number, state: string): Promise<boolean> {\n    return false;\n  }\n\n  async searchUserBotData(projectId: number, query: string): Promise<UserBotData[]> {\n    return [];\n  }\n\n  async getUserBotDataStats(projectId: number): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    blockedUsers: number;\n    premiumUsers: number;\n    totalInteractions: number;\n    avgInteractionsPerUser: number;\n  }> {\n    return {\n      totalUsers: 0,\n      activeUsers: 0,\n      blockedUsers: 0,\n      premiumUsers: 0,\n      totalInteractions: 0,\n      avgInteractionsPerUser: 0\n    };\n  }\n  \n  // Bot Groups stubs\n  async getBotGroup(id: number): Promise<BotGroup | undefined> {\n    return undefined;\n  }\n\n  async getBotGroupsByProject(projectId: number): Promise<BotGroup[]> {\n    return [];\n  }\n\n  async getBotGroupByProjectAndGroupId(projectId: number, groupId: string): Promise<BotGroup | undefined> {\n    return undefined;\n  }\n\n  async createBotGroup(group: InsertBotGroup): Promise<BotGroup> {\n    throw new Error(\"MemStorage does not support groups\");\n  }\n\n  async updateBotGroup(id: number, group: Partial<InsertBotGroup>): Promise<BotGroup | undefined> {\n    return undefined;\n  }\n\n  async deleteBotGroup(id: number): Promise<boolean> {\n    return false;\n  }\n\n  // Group members stubs\n  async getGroupMembers(groupId: number): Promise<GroupMember[]> {\n    return [];\n  }\n\n  async createGroupMember(member: InsertGroupMember): Promise<GroupMember> {\n    throw new Error(\"MemStorage does not support group members\");\n  }\n\n  async updateGroupMember(id: number, member: Partial<InsertGroupMember>): Promise<GroupMember | undefined> {\n    return undefined;\n  }\n\n  async deleteGroupMember(id: number): Promise<boolean> {\n    return false;\n  }\n}\n\n// Database Storage Implementation\nexport class DatabaseStorage implements IStorage {\n  protected db = db;\n  \n  // Bot Projects\n  async getBotProject(id: number): Promise<BotProject | undefined> {\n    const [project] = await this.db.select().from(botProjects).where(eq(botProjects.id, id));\n    return project || undefined;\n  }\n\n  async getAllBotProjects(): Promise<BotProject[]> {\n    return await this.db.select().from(botProjects).orderBy(desc(botProjects.updatedAt));\n  }\n\n  async createBotProject(insertProject: InsertBotProject): Promise<BotProject> {\n    const [project] = await this.db\n      .insert(botProjects)\n      .values(insertProject)\n      .returning();\n    return project;\n  }\n\n  async updateBotProject(id: number, updateData: Partial<InsertBotProject>): Promise<BotProject | undefined> {\n    const [project] = await this.db\n      .update(botProjects)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(botProjects.id, id))\n      .returning();\n    return project || undefined;\n  }\n\n  async deleteBotProject(id: number): Promise<boolean> {\n    const result = await this.db.delete(botProjects).where(eq(botProjects.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Bot Instances\n  async getBotInstance(projectId: number): Promise<BotInstance | undefined> {\n    const [instance] = await this.db.select().from(botInstances).where(eq(botInstances.projectId, projectId));\n    return instance || undefined;\n  }\n\n  async getBotInstanceByToken(tokenId: number): Promise<BotInstance | undefined> {\n    const [instance] = await this.db.select().from(botInstances).where(eq(botInstances.tokenId, tokenId));\n    return instance || undefined;\n  }\n\n  async getBotInstancesByProject(projectId: number): Promise<BotInstance[]> {\n    return await this.db.select().from(botInstances).where(eq(botInstances.projectId, projectId));\n  }\n\n  async getAllBotInstances(): Promise<BotInstance[]> {\n    return await this.db.select().from(botInstances).orderBy(desc(botInstances.startedAt));\n  }\n\n  async createBotInstance(insertInstance: InsertBotInstance): Promise<BotInstance> {\n    const [instance] = await this.db\n      .insert(botInstances)\n      .values(insertInstance)\n      .returning();\n    return instance;\n  }\n\n  async updateBotInstance(id: number, updateData: Partial<InsertBotInstance>): Promise<BotInstance | undefined> {\n    const [instance] = await this.db\n      .update(botInstances)\n      .set(updateData)\n      .where(eq(botInstances.id, id))\n      .returning();\n    return instance || undefined;\n  }\n\n  async deleteBotInstance(id: number): Promise<boolean> {\n    const result = await this.db.delete(botInstances).where(eq(botInstances.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async stopBotInstance(projectId: number): Promise<boolean> {\n    const result = await this.db\n      .update(botInstances)\n      .set({ status: 'stopped', stoppedAt: new Date() })\n      .where(eq(botInstances.projectId, projectId));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async stopBotInstanceByToken(tokenId: number): Promise<boolean> {\n    const result = await this.db\n      .update(botInstances)\n      .set({ status: 'stopped', stoppedAt: new Date() })\n      .where(eq(botInstances.tokenId, tokenId));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Bot Templates\n  async getBotTemplate(id: number): Promise<BotTemplate | undefined> {\n    const [template] = await this.db.select().from(botTemplates).where(eq(botTemplates.id, id));\n    return template || undefined;\n  }\n\n  async getAllBotTemplates(): Promise<BotTemplate[]> {\n    return await this.db.select().from(botTemplates).orderBy(desc(botTemplates.createdAt));\n  }\n\n  async createBotTemplate(insertTemplate: InsertBotTemplate): Promise<BotTemplate> {\n    const [template] = await this.db\n      .insert(botTemplates)\n      .values(insertTemplate)\n      .returning();\n    return template;\n  }\n\n  async updateBotTemplate(id: number, updateData: Partial<InsertBotTemplate>): Promise<BotTemplate | undefined> {\n    const [template] = await this.db\n      .update(botTemplates)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(botTemplates.id, id))\n      .returning();\n    return template || undefined;\n  }\n\n  async deleteBotTemplate(id: number): Promise<boolean> {\n    const result = await this.db.delete(botTemplates).where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementTemplateUseCount(id: number): Promise<boolean> {\n    const [template] = await this.db.select().from(botTemplates).where(eq(botTemplates.id, id));\n    if (!template) return false;\n    \n    const result = await this.db\n      .update(botTemplates)\n      .set({ \n        useCount: (template.useCount || 0) + 1,\n        lastUsedAt: new Date()\n      })\n      .where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementTemplateViewCount(id: number): Promise<boolean> {\n    const [template] = await this.db.select().from(botTemplates).where(eq(botTemplates.id, id));\n    if (!template) return false;\n    \n    const result = await this.db\n      .update(botTemplates)\n      .set({ \n        viewCount: (template.viewCount || 0) + 1\n      })\n      .where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementTemplateDownloadCount(id: number): Promise<boolean> {\n    const [template] = await this.db.select().from(botTemplates).where(eq(botTemplates.id, id));\n    if (!template) return false;\n    \n    const result = await this.db\n      .update(botTemplates)\n      .set({ \n        downloadCount: (template.downloadCount || 0) + 1\n      })\n      .where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async toggleTemplateLike(id: number, liked: boolean): Promise<boolean> {\n    const [template] = await this.db.select().from(botTemplates).where(eq(botTemplates.id, id));\n    if (!template) return false;\n    \n    const current = template.likeCount || 0;\n    const newCount = liked ? current + 1 : Math.max(0, current - 1);\n    \n    const result = await this.db\n      .update(botTemplates)\n      .set({ \n        likeCount: newCount\n      })\n      .where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async toggleTemplateBookmark(id: number, bookmarked: boolean): Promise<boolean> {\n    const [template] = await this.db.select().from(botTemplates).where(eq(botTemplates.id, id));\n    if (!template) return false;\n    \n    const current = template.bookmarkCount || 0;\n    const newCount = bookmarked ? current + 1 : Math.max(0, current - 1);\n    \n    const result = await this.db\n      .update(botTemplates)\n      .set({ \n        bookmarkCount: newCount\n      })\n      .where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async rateTemplate(id: number, rating: number): Promise<boolean> {\n    const [template] = await this.db.select().from(botTemplates).where(eq(botTemplates.id, id));\n    if (!template) return false;\n\n    const currentRating = template.rating || 0;\n    const currentRatingCount = template.ratingCount || 0;\n    const newRatingCount = currentRatingCount + 1;\n    const newRating = Math.round(((currentRating * currentRatingCount) + rating) / newRatingCount);\n\n    const result = await this.db\n      .update(botTemplates)\n      .set({ \n        rating: newRating,\n        ratingCount: newRatingCount,\n        updatedAt: new Date()\n      })\n      .where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getFeaturedTemplates(): Promise<BotTemplate[]> {\n    return await this.db.select().from(botTemplates).where(eq(botTemplates.featured, 1)).orderBy(desc(botTemplates.rating));\n  }\n\n  async getTemplatesByCategory(category: string): Promise<BotTemplate[]> {\n    return await this.db.select().from(botTemplates).where(eq(botTemplates.category, category)).orderBy(desc(botTemplates.createdAt));\n  }\n\n  async searchTemplates(query: string): Promise<BotTemplate[]> {\n    const searchTerm = `%${query.toLowerCase()}%`;\n    return await this.db.select().from(botTemplates).where(\n      or(\n        ilike(botTemplates.name, searchTerm),\n        ilike(botTemplates.description, searchTerm)\n      )\n    ).orderBy(desc(botTemplates.rating));\n  }\n\n  // Bot Tokens\n  async getBotToken(id: number): Promise<BotToken | undefined> {\n    const [token] = await this.db.select().from(botTokens).where(eq(botTokens.id, id));\n    return token || undefined;\n  }\n\n  async getBotTokensByProject(projectId: number): Promise<BotToken[]> {\n    return await this.db.select().from(botTokens)\n      .where(eq(botTokens.projectId, projectId))\n      .orderBy(desc(botTokens.isDefault), desc(botTokens.createdAt));\n  }\n\n  async getDefaultBotToken(projectId: number): Promise<BotToken | undefined> {\n    const [token] = await this.db.select().from(botTokens)\n      .where(and(eq(botTokens.projectId, projectId), eq(botTokens.isDefault, 1)))\n      .orderBy(desc(botTokens.createdAt));\n    return token || undefined;\n  }\n\n  async createBotToken(insertToken: InsertBotToken): Promise<BotToken> {\n    if (insertToken.isDefault === 1) {\n      await this.db.update(botTokens)\n        .set({ isDefault: 0 })\n        .where(eq(botTokens.projectId, insertToken.projectId));\n    }\n\n    const [token] = await this.db\n      .insert(botTokens)\n      .values(insertToken)\n      .returning();\n    return token;\n  }\n\n  async updateBotToken(id: number, updateData: Partial<InsertBotToken>): Promise<BotToken | undefined> {\n    if (updateData.isDefault === 1) {\n      const [currentToken] = await this.db.select().from(botTokens).where(eq(botTokens.id, id));\n      if (currentToken) {\n        await this.db.update(botTokens)\n          .set({ isDefault: 0 })\n          .where(eq(botTokens.projectId, currentToken.projectId));\n      }\n    }\n\n    const [token] = await this.db\n      .update(botTokens)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(botTokens.id, id))\n      .returning();\n    return token || undefined;\n  }\n\n  async deleteBotToken(id: number): Promise<boolean> {\n    const result = await this.db.delete(botTokens).where(eq(botTokens.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async setDefaultBotToken(projectId: number, tokenId: number): Promise<boolean> {\n    await this.db.update(botTokens)\n      .set({ isDefault: 0 })\n      .where(eq(botTokens.projectId, projectId));\n\n    const result = await this.db.update(botTokens)\n      .set({ isDefault: 1 })\n      .where(eq(botTokens.id, tokenId));\n    \n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async markTokenAsUsed(id: number): Promise<boolean> {\n    const result = await this.db.update(botTokens)\n      .set({ lastUsedAt: new Date() })\n      .where(eq(botTokens.id, id));\n    \n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Media Files\n  async getMediaFile(id: number): Promise<MediaFile | undefined> {\n    const [file] = await this.db.select().from(mediaFiles).where(eq(mediaFiles.id, id));\n    return file || undefined;\n  }\n\n  async getMediaFilesByProject(projectId: number): Promise<MediaFile[]> {\n    return await this.db.select().from(mediaFiles)\n      .where(eq(mediaFiles.projectId, projectId))\n      .orderBy(desc(mediaFiles.createdAt));\n  }\n\n  async getMediaFilesByType(projectId: number, fileType: string): Promise<MediaFile[]> {\n    return await this.db.select().from(mediaFiles)\n      .where(and(eq(mediaFiles.projectId, projectId), eq(mediaFiles.fileType, fileType)))\n      .orderBy(desc(mediaFiles.createdAt));\n  }\n\n  async createMediaFile(insertFile: InsertMediaFile): Promise<MediaFile> {\n    const [file] = await this.db\n      .insert(mediaFiles)\n      .values(insertFile)\n      .returning();\n    return file;\n  }\n\n  async updateMediaFile(id: number, updateData: Partial<InsertMediaFile>): Promise<MediaFile | undefined> {\n    const [file] = await this.db\n      .update(mediaFiles)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(mediaFiles.id, id))\n      .returning();\n    return file || undefined;\n  }\n\n  async deleteMediaFile(id: number): Promise<boolean> {\n    const result = await this.db.delete(mediaFiles).where(eq(mediaFiles.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementMediaFileUsage(id: number): Promise<boolean> {\n    const [file] = await this.db.select().from(mediaFiles).where(eq(mediaFiles.id, id));\n    if (!file) return false;\n    \n    const result = await this.db\n      .update(mediaFiles)\n      .set({ \n        usageCount: (file.usageCount || 0) + 1,\n        updatedAt: new Date()\n      })\n      .where(eq(mediaFiles.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async searchMediaFiles(projectId: number, query: string): Promise<MediaFile[]> {\n    const searchTerm = `%${query.toLowerCase()}%`;\n    return await this.db.select().from(mediaFiles)\n      .where(\n        and(\n          eq(mediaFiles.projectId, projectId),\n          or(\n            ilike(mediaFiles.fileName, searchTerm),\n            ilike(mediaFiles.description, searchTerm)\n          )\n        )\n      )\n      .orderBy(desc(mediaFiles.usageCount), desc(mediaFiles.createdAt));\n  }\n\n  // User Bot Data\n  async getUserBotData(id: number): Promise<UserBotData | undefined> {\n    const [userData] = await this.db.select().from(userBotData).where(eq(userBotData.id, id));\n    return userData || undefined;\n  }\n\n  async getUserBotDataByProjectAndUser(projectId: number, userId: string): Promise<UserBotData | undefined> {\n    const [userData] = await this.db.select().from(userBotData)\n      .where(and(eq(userBotData.projectId, projectId), eq(userBotData.userId, userId)));\n    return userData || undefined;\n  }\n\n  async getUserBotDataByProject(projectId: number): Promise<UserBotData[]> {\n    return await this.db.select().from(userBotData)\n      .where(eq(userBotData.projectId, projectId))\n      .orderBy(desc(userBotData.lastInteraction));\n  }\n\n  async getAllUserBotData(): Promise<UserBotData[]> {\n    return await this.db.select().from(userBotData).orderBy(desc(userBotData.lastInteraction));\n  }\n\n  async createUserBotData(insertUserData: InsertUserBotData): Promise<UserBotData> {\n    const [userData] = await this.db\n      .insert(userBotData)\n      .values(insertUserData)\n      .returning();\n    return userData;\n  }\n\n  async updateUserBotData(id: number, updateData: Partial<InsertUserBotData>): Promise<UserBotData | undefined> {\n    const [userData] = await this.db\n      .update(userBotData)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(userBotData.id, id))\n      .returning();\n    return userData || undefined;\n  }\n\n  async deleteUserBotData(id: number): Promise<boolean> {\n    const result = await this.db.delete(userBotData).where(eq(userBotData.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async deleteUserBotDataByProject(projectId: number): Promise<boolean> {\n    const result = await this.db.delete(userBotData).where(eq(userBotData.projectId, projectId));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementUserInteraction(id: number): Promise<boolean> {\n    const [userData] = await this.db.select().from(userBotData).where(eq(userBotData.id, id));\n    if (!userData) return false;\n    \n    const result = await this.db\n      .update(userBotData)\n      .set({ \n        interactionCount: (userData.interactionCount || 0) + 1,\n        lastInteraction: new Date(),\n        updatedAt: new Date()\n      })\n      .where(eq(userBotData.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async updateUserState(id: number, state: string): Promise<boolean> {\n    const result = await this.db\n      .update(userBotData)\n      .set({ \n        currentState: state,\n        updatedAt: new Date()\n      })\n      .where(eq(userBotData.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async searchUserBotData(projectId: number, query: string): Promise<UserBotData[]> {\n    const searchTerm = `%${query.toLowerCase()}%`;\n    return await this.db.select().from(userBotData)\n      .where(\n        and(\n          eq(userBotData.projectId, projectId),\n          or(\n            ilike(userBotData.userName, searchTerm),\n            ilike(userBotData.firstName, searchTerm),\n            ilike(userBotData.lastName, searchTerm),\n            ilike(userBotData.notes, searchTerm)\n          )\n        )\n      )\n      .orderBy(desc(userBotData.lastInteraction));\n  }\n\n  async searchBotUsers(query: string): Promise<BotUser[]> {\n    // –£–±–∏—Ä–∞–µ–º @ —Å–∏–º–≤–æ–ª –µ—Å–ª–∏ –µ—Å—Ç—å\n    const cleanQuery = query.startsWith('@') ? query.slice(1) : query;\n    const searchTerm = `%${cleanQuery.toLowerCase()}%`;\n    const numericQuery = parseInt(cleanQuery);\n    \n    return await this.db.select().from(botUsers)\n      .where(\n        or(\n          ilike(botUsers.username, searchTerm),\n          ilike(botUsers.firstName, searchTerm),\n          ilike(botUsers.lastName, searchTerm),\n          isNaN(numericQuery) ? sql`false` : eq(botUsers.userId, numericQuery)\n        )\n      )\n      .orderBy(desc(botUsers.lastInteraction));\n  }\n\n  async getUserBotDataStats(projectId: number): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    blockedUsers: number;\n    premiumUsers: number;\n    totalInteractions: number;\n    avgInteractionsPerUser: number;\n  }> {\n    const users = await this.db.select().from(userBotData).where(eq(userBotData.projectId, projectId));\n    \n    const totalUsers = users.length;\n    const activeUsers = users.filter(u => u.isActive === 1).length;\n    const blockedUsers = users.filter(u => u.isBlocked === 1).length;\n    const premiumUsers = users.filter(u => u.isPremium === 1).length;\n    const totalInteractions = users.reduce((sum, u) => sum + (u.interactionCount || 0), 0);\n    const avgInteractionsPerUser = totalUsers > 0 ? totalInteractions / totalUsers : 0;\n\n    return {\n      totalUsers,\n      activeUsers,\n      blockedUsers,\n      premiumUsers,\n      totalInteractions,\n      avgInteractionsPerUser\n    };\n  }\n\n  // Bot Groups\n  async getBotGroup(id: number): Promise<BotGroup | undefined> {\n    const [group] = await this.db.select().from(botGroups).where(eq(botGroups.id, id));\n    return group || undefined;\n  }\n\n  async getBotGroupsByProject(projectId: number): Promise<BotGroup[]> {\n    return await this.db.select().from(botGroups)\n      .where(eq(botGroups.projectId, projectId))\n      .orderBy(desc(botGroups.createdAt));\n  }\n\n  async getBotGroupByProjectAndGroupId(projectId: number, groupId: string): Promise<BotGroup | undefined> {\n    const [group] = await this.db.select().from(botGroups)\n      .where(and(eq(botGroups.projectId, projectId), eq(botGroups.groupId, groupId)));\n    return group || undefined;\n  }\n\n  async createBotGroup(insertGroup: InsertBotGroup): Promise<BotGroup> {\n    const [group] = await this.db\n      .insert(botGroups)\n      .values(insertGroup)\n      .returning();\n    return group;\n  }\n\n  async updateBotGroup(id: number, updateData: Partial<InsertBotGroup>): Promise<BotGroup | undefined> {\n    const [group] = await this.db\n      .update(botGroups)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(botGroups.id, id))\n      .returning();\n    return group || undefined;\n  }\n\n  async deleteBotGroup(id: number): Promise<boolean> {\n    const result = await this.db.delete(botGroups).where(eq(botGroups.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Group members\n  async getGroupMembers(groupId: number): Promise<GroupMember[]> {\n    return await this.db.select().from(groupMembers)\n      .where(eq(groupMembers.groupId, groupId))\n      .orderBy(desc(groupMembers.joinedAt));\n  }\n\n  async createGroupMember(insertMember: InsertGroupMember): Promise<GroupMember> {\n    const [member] = await this.db\n      .insert(groupMembers)\n      .values(insertMember)\n      .returning();\n    return member;\n  }\n\n  async updateGroupMember(id: number, updateData: Partial<InsertGroupMember>): Promise<GroupMember | undefined> {\n    const [member] = await this.db\n      .update(groupMembers)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(groupMembers.id, id))\n      .returning();\n    return member || undefined;\n  }\n\n  async deleteGroupMember(id: number): Promise<boolean> {\n    const result = await this.db.delete(groupMembers).where(eq(groupMembers.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n}\n\n// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º\nexport class OptimizedDatabaseStorage extends DatabaseStorage {\n  private templateCache: Map<number, BotTemplate> = new Map();\n  private projectCache: Map<number, BotProject> = new Map();\n  private cacheTimeout = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç\n  \n  // Bot Projects (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)\n  async getBotProject(id: number): Promise<BotProject | undefined> {\n    const cached = this.projectCache.get(id);\n    if (cached) return cached;\n    \n    const [project] = await this.db.select().from(botProjects).where(eq(botProjects.id, id));\n    if (project) {\n      this.projectCache.set(id, project);\n      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ–º –∫—ç—à —á–µ—Ä–µ–∑ timeout\n      setTimeout(() => this.projectCache.delete(id), this.cacheTimeout);\n    }\n    return project || undefined;\n  }\n\n  async getAllBotProjects(): Promise<BotProject[]> {\n    return await this.db.select().from(botProjects).orderBy(desc(botProjects.updatedAt));\n  }\n\n  async createBotProject(insertProject: InsertBotProject): Promise<BotProject> {\n    const [project] = await this.db\n      .insert(botProjects)\n      .values(insertProject)\n      .returning();\n    this.projectCache.set(project.id, project);\n    return project;\n  }\n\n  async updateBotProject(id: number, updateData: Partial<InsertBotProject>): Promise<BotProject | undefined> {\n    const [project] = await this.db\n      .update(botProjects)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(botProjects.id, id))\n      .returning();\n    if (project) {\n      this.projectCache.set(id, project);\n    }\n    return project || undefined;\n  }\n\n  async deleteBotProject(id: number): Promise<boolean> {\n    const result = await this.db.delete(botProjects).where(eq(botProjects.id, id));\n    this.projectCache.delete(id);\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Bot Instances (–ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)\n  async getBotInstance(projectId: number): Promise<BotInstance | undefined> {\n    const [instance] = await this.db.select().from(botInstances).where(eq(botInstances.projectId, projectId));\n    return instance || undefined;\n  }\n\n  async getAllBotInstances(): Promise<BotInstance[]> {\n    return await this.db.select().from(botInstances).orderBy(desc(botInstances.startedAt));\n  }\n\n  async createBotInstance(insertInstance: InsertBotInstance): Promise<BotInstance> {\n    const [instance] = await this.db\n      .insert(botInstances)\n      .values(insertInstance)\n      .returning();\n    return instance;\n  }\n\n  async updateBotInstance(id: number, updateData: Partial<InsertBotInstance>): Promise<BotInstance | undefined> {\n    const [instance] = await this.db\n      .update(botInstances)\n      .set(updateData)\n      .where(eq(botInstances.id, id))\n      .returning();\n    return instance || undefined;\n  }\n\n  async deleteBotInstance(id: number): Promise<boolean> {\n    const result = await this.db.delete(botInstances).where(eq(botInstances.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async stopBotInstance(projectId: number): Promise<boolean> {\n    const result = await this.db\n      .update(botInstances)\n      .set({ status: 'stopped', stoppedAt: new Date() })\n      .where(eq(botInstances.projectId, projectId));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async stopBotInstanceByToken(tokenId: number): Promise<boolean> {\n    const result = await this.db\n      .update(botInstances)\n      .set({ status: 'stopped', stoppedAt: new Date() })\n      .where(eq(botInstances.tokenId, tokenId));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Bot Templates (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)\n  async getBotTemplate(id: number): Promise<BotTemplate | undefined> {\n    const cached = this.templateCache.get(id);\n    if (cached) return cached;\n    \n    const [template] = await this.db.select().from(botTemplates).where(eq(botTemplates.id, id));\n    if (template) {\n      this.templateCache.set(id, template);\n      setTimeout(() => this.templateCache.delete(id), this.cacheTimeout);\n    }\n    return template || undefined;\n  }\n\n  async getAllBotTemplates(): Promise<BotTemplate[]> {\n    return await this.db.select().from(botTemplates).orderBy(desc(botTemplates.createdAt));\n  }\n\n  async createBotTemplate(insertTemplate: InsertBotTemplate): Promise<BotTemplate> {\n    const [template] = await this.db\n      .insert(botTemplates)\n      .values(insertTemplate)\n      .returning();\n    this.templateCache.set(template.id, template);\n    return template;\n  }\n\n  async updateBotTemplate(id: number, updateData: Partial<InsertBotTemplate>): Promise<BotTemplate | undefined> {\n    const [template] = await this.db\n      .update(botTemplates)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(botTemplates.id, id))\n      .returning();\n    if (template) {\n      this.templateCache.set(id, template);\n    }\n    return template || undefined;\n  }\n\n  async deleteBotTemplate(id: number): Promise<boolean> {\n    const result = await this.db.delete(botTemplates).where(eq(botTemplates.id, id));\n    this.templateCache.delete(id);\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤\n  async incrementTemplateUseCount(id: number): Promise<boolean> {\n    const result = await this.db\n      .update(botTemplates)\n      .set({ lastUsedAt: new Date() })\n      .where(eq(botTemplates.id, id));\n    this.templateCache.delete(id); // –û—á–∏—â–∞–µ–º –∫—ç—à\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementTemplateViewCount(id: number): Promise<boolean> {\n    const result = await this.db\n      .update(botTemplates)\n      .set({}) // –ü—É—Å—Ç–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã\n      .where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementTemplateDownloadCount(id: number): Promise<boolean> {\n    const result = await this.db\n      .update(botTemplates)\n      .set({}) // –ü—É—Å—Ç–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã\n      .where(eq(botTemplates.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async toggleTemplateLike(id: number, liked: boolean): Promise<boolean> {\n    this.templateCache.delete(id);\n    return true;\n  }\n\n  async toggleTemplateBookmark(id: number, bookmarked: boolean): Promise<boolean> {\n    this.templateCache.delete(id);\n    return true;\n  }\n\n  async rateTemplate(id: number, rating: number): Promise<boolean> {\n    this.templateCache.delete(id);\n    return true;\n  }\n\n  async getFeaturedTemplates(): Promise<BotTemplate[]> {\n    return await this.db.select().from(botTemplates).where(eq(botTemplates.featured, 1)).orderBy(desc(botTemplates.rating));\n  }\n\n  async getTemplatesByCategory(category: string): Promise<BotTemplate[]> {\n    return await this.db.select().from(botTemplates).where(eq(botTemplates.category, category)).orderBy(desc(botTemplates.createdAt));\n  }\n\n  async searchTemplates(query: string): Promise<BotTemplate[]> {\n    const searchTerm = `%${query.toLowerCase()}%`;\n    return await this.db.select().from(botTemplates).where(\n      or(\n        ilike(botTemplates.name, searchTerm),\n        ilike(botTemplates.description, searchTerm)\n      )\n    ).orderBy(desc(botTemplates.rating));\n  }\n\n  // Bot Tokens\n  async getBotToken(id: number): Promise<BotToken | undefined> {\n    const [token] = await this.db.select().from(botTokens).where(eq(botTokens.id, id));\n    return token || undefined;\n  }\n\n  async getBotTokensByProject(projectId: number): Promise<BotToken[]> {\n    return await this.db.select().from(botTokens)\n      .where(eq(botTokens.projectId, projectId))\n      .orderBy(desc(botTokens.isDefault), desc(botTokens.createdAt));\n  }\n\n  async getDefaultBotToken(projectId: number): Promise<BotToken | undefined> {\n    const [token] = await this.db.select().from(botTokens)\n      .where(and(eq(botTokens.projectId, projectId), eq(botTokens.isDefault, 1)))\n      .orderBy(desc(botTokens.createdAt));\n    return token || undefined;\n  }\n\n  async createBotToken(insertToken: InsertBotToken): Promise<BotToken> {\n    // –ï—Å–ª–∏ —Å–æ–∑–¥–∞–µ–º —Ç–æ–∫–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ —Å –¥—Ä—É–≥–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤\n    if (insertToken.isDefault === 1) {\n      await this.db.update(botTokens)\n        .set({ isDefault: 0 })\n        .where(eq(botTokens.projectId, insertToken.projectId));\n    }\n\n    const [token] = await this.db\n      .insert(botTokens)\n      .values(insertToken)\n      .returning();\n    return token;\n  }\n\n  async updateBotToken(id: number, updateData: Partial<InsertBotToken>): Promise<BotToken | undefined> {\n    // –ï—Å–ª–∏ –¥–µ–ª–∞–µ–º —Ç–æ–∫–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ —Å –¥—Ä—É–≥–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤\n    if (updateData.isDefault === 1) {\n      const [currentToken] = await this.db.select().from(botTokens).where(eq(botTokens.id, id));\n      if (currentToken) {\n        await this.db.update(botTokens)\n          .set({ isDefault: 0 })\n          .where(eq(botTokens.projectId, currentToken.projectId));\n      }\n    }\n\n    const [token] = await this.db\n      .update(botTokens)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(botTokens.id, id))\n      .returning();\n    return token || undefined;\n  }\n\n  async deleteBotToken(id: number): Promise<boolean> {\n    const result = await this.db.delete(botTokens).where(eq(botTokens.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async setDefaultBotToken(projectId: number, tokenId: number): Promise<boolean> {\n    // –£–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞\n    await this.db.update(botTokens)\n      .set({ isDefault: 0 })\n      .where(eq(botTokens.projectId, projectId));\n\n    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞\n    const result = await this.db.update(botTokens)\n      .set({ isDefault: 1 })\n      .where(eq(botTokens.id, tokenId));\n    \n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async markTokenAsUsed(id: number): Promise<boolean> {\n    const result = await this.db.update(botTokens)\n      .set({ lastUsedAt: new Date() })\n      .where(eq(botTokens.id, id));\n    \n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Media Files (simplified implementation)\n  async getMediaFile(id: number): Promise<MediaFile | undefined> {\n    const [file] = await this.db.select().from(mediaFiles).where(eq(mediaFiles.id, id));\n    return file || undefined;\n  }\n\n  async getMediaFilesByProject(projectId: number): Promise<MediaFile[]> {\n    return await this.db.select().from(mediaFiles)\n      .where(eq(mediaFiles.projectId, projectId))\n      .orderBy(desc(mediaFiles.createdAt));\n  }\n\n  async getMediaFilesByType(projectId: number, fileType: string): Promise<MediaFile[]> {\n    return await this.db.select().from(mediaFiles)\n      .where(and(eq(mediaFiles.projectId, projectId), eq(mediaFiles.fileType, fileType)))\n      .orderBy(desc(mediaFiles.createdAt));\n  }\n\n  async createMediaFile(insertFile: InsertMediaFile): Promise<MediaFile> {\n    const [file] = await this.db\n      .insert(mediaFiles)\n      .values(insertFile)\n      .returning();\n    return file;\n  }\n\n  async updateMediaFile(id: number, updateData: Partial<InsertMediaFile>): Promise<MediaFile | undefined> {\n    const [file] = await this.db\n      .update(mediaFiles)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(mediaFiles.id, id))\n      .returning();\n    return file || undefined;\n  }\n\n  async deleteMediaFile(id: number): Promise<boolean> {\n    const result = await this.db.delete(mediaFiles).where(eq(mediaFiles.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementMediaFileUsage(id: number): Promise<boolean> {\n    const [file] = await this.db.select().from(mediaFiles).where(eq(mediaFiles.id, id));\n    if (!file) return false;\n    \n    const result = await this.db\n      .update(mediaFiles)\n      .set({ usageCount: (file.usageCount || 0) + 1 })\n      .where(eq(mediaFiles.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async searchMediaFiles(projectId: number, query: string): Promise<MediaFile[]> {\n    const searchTerm = `%${query.toLowerCase()}%`;\n    return await this.db.select().from(mediaFiles)\n      .where(\n        and(\n          eq(mediaFiles.projectId, projectId),\n          or(\n            ilike(mediaFiles.fileName, searchTerm),\n            ilike(mediaFiles.description, searchTerm)\n          )\n        )\n      )\n      .orderBy(desc(mediaFiles.createdAt));\n  }\n\n  // User Bot Data\n  async getUserBotData(id: number): Promise<UserBotData | undefined> {\n    const [userData] = await this.db.select().from(userBotData).where(eq(userBotData.id, id));\n    return userData || undefined;\n  }\n\n  async getUserBotDataByProjectAndUser(projectId: number, userId: string): Promise<UserBotData | undefined> {\n    const [userData] = await this.db.select().from(userBotData)\n      .where(and(eq(userBotData.projectId, projectId), eq(userBotData.userId, userId)));\n    return userData || undefined;\n  }\n\n  async getUserBotDataByProject(projectId: number): Promise<UserBotData[]> {\n    return await this.db.select().from(userBotData)\n      .where(eq(userBotData.projectId, projectId))\n      .orderBy(desc(userBotData.lastInteraction));\n  }\n\n  async getAllUserBotData(): Promise<UserBotData[]> {\n    return await this.db.select().from(userBotData)\n      .orderBy(desc(userBotData.lastInteraction));\n  }\n\n  async createUserBotData(insertUserData: InsertUserBotData): Promise<UserBotData> {\n    const [userData] = await this.db\n      .insert(userBotData)\n      .values(insertUserData)\n      .returning();\n    return userData;\n  }\n\n  async updateUserBotData(id: number, updateData: Partial<InsertUserBotData>): Promise<UserBotData | undefined> {\n    const [userData] = await this.db\n      .update(userBotData)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(userBotData.id, id))\n      .returning();\n    return userData || undefined;\n  }\n\n  async deleteUserBotData(id: number): Promise<boolean> {\n    const result = await this.db.delete(userBotData).where(eq(userBotData.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async deleteUserBotDataByProject(projectId: number): Promise<boolean> {\n    const result = await this.db.delete(userBotData).where(eq(userBotData.projectId, projectId));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async incrementUserInteraction(id: number): Promise<boolean> {\n    const [userData] = await this.db.select().from(userBotData).where(eq(userBotData.id, id));\n    if (!userData) return false;\n    \n    const result = await this.db\n      .update(userBotData)\n      .set({ \n        interactionCount: (userData.interactionCount || 0) + 1,\n        lastInteraction: new Date()\n      })\n      .where(eq(userBotData.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async updateUserState(id: number, state: string): Promise<boolean> {\n    const result = await this.db\n      .update(userBotData)\n      .set({ currentState: state, updatedAt: new Date() })\n      .where(eq(userBotData.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async searchUserBotData(projectId: number, query: string): Promise<UserBotData[]> {\n    const searchTerm = `%${query.toLowerCase()}%`;\n    return await this.db.select().from(userBotData)\n      .where(\n        and(\n          eq(userBotData.projectId, projectId),\n          or(\n            ilike(userBotData.firstName, searchTerm),\n            ilike(userBotData.lastName, searchTerm),\n            ilike(userBotData.userName, searchTerm),\n            ilike(userBotData.userId, searchTerm)\n          )\n        )\n      )\n      .orderBy(desc(userBotData.lastInteraction));\n  }\n\n  async getUserBotDataStats(projectId: number): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    blockedUsers: number;\n    premiumUsers: number;\n    totalInteractions: number;\n    avgInteractionsPerUser: number;\n  }> {\n    const users = await this.db.select().from(userBotData)\n      .where(eq(userBotData.projectId, projectId));\n    \n    const totalUsers = users.length;\n    const activeUsers = users.filter(u => u.isActive === 1).length;\n    const blockedUsers = users.filter(u => u.isBlocked === 1).length;\n    const premiumUsers = users.filter(u => u.isPremium === 1).length;\n    const totalInteractions = users.reduce((sum, u) => sum + (u.interactionCount || 0), 0);\n    const avgInteractionsPerUser = totalUsers > 0 ? Math.round(totalInteractions / totalUsers) : 0;\n\n    return {\n      totalUsers,\n      activeUsers,\n      blockedUsers,\n      premiumUsers,\n      totalInteractions,\n      avgInteractionsPerUser\n    };\n  }\n  \n  // Bot Groups\n  async getBotGroup(id: number): Promise<BotGroup | undefined> {\n    const [group] = await this.db.select().from(botGroups).where(eq(botGroups.id, id));\n    return group || undefined;\n  }\n\n  async getBotGroupsByProject(projectId: number): Promise<BotGroup[]> {\n    return await this.db.select().from(botGroups)\n      .where(eq(botGroups.projectId, projectId))\n      .orderBy(desc(botGroups.createdAt));\n  }\n\n  async getBotGroupByProjectAndGroupId(projectId: number, groupId: string): Promise<BotGroup | undefined> {\n    const [group] = await this.db.select().from(botGroups)\n      .where(and(eq(botGroups.projectId, projectId), eq(botGroups.groupId, groupId)));\n    return group || undefined;\n  }\n\n  async createBotGroup(insertGroup: InsertBotGroup): Promise<BotGroup> {\n    const [group] = await this.db\n      .insert(botGroups)\n      .values(insertGroup)\n      .returning();\n    return group;\n  }\n\n  async updateBotGroup(id: number, updateData: Partial<InsertBotGroup>): Promise<BotGroup | undefined> {\n    const [group] = await this.db\n      .update(botGroups)\n      .set({ ...updateData, updatedAt: new Date() })\n      .where(eq(botGroups.id, id))\n      .returning();\n    return group || undefined;\n  }\n\n  async deleteBotGroup(id: number): Promise<boolean> {\n    const result = await this.db.delete(botGroups).where(eq(botGroups.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n}\n\n// Enhanced Database Storage with caching and monitoring\nexport class EnhancedDatabaseStorage extends DatabaseStorage {\n  // Override methods to add caching and monitoring\n  \n  async getBotProject(id: number): Promise<BotProject | undefined> {\n    return await cachedOps.getProjectCached(id, () => super.getBotProject(id));\n  }\n\n  async getBotTemplate(id: number): Promise<BotTemplate | undefined> {\n    return await cachedOps.getTemplateCached(id, () => super.getBotTemplate(id));\n  }\n\n  async getTemplatesByCategory(category: string): Promise<BotTemplate[]> {\n    return await cachedOps.getTemplateListCached(category, () => super.getTemplatesByCategory(category));\n  }\n\n  async createBotProject(insertProject: InsertBotProject): Promise<BotProject> {\n    return await dbManager.executeWithRetry(async () => {\n      const project = await super.createBotProject(insertProject);\n      cachedOps.invalidateProject(project.id);\n      return project;\n    });\n  }\n\n  async updateBotProject(id: number, updateData: Partial<InsertBotProject>): Promise<BotProject | undefined> {\n    return await dbManager.executeWithRetry(async () => {\n      const project = await super.updateBotProject(id, updateData);\n      cachedOps.invalidateProject(id);\n      return project;\n    });\n  }\n\n  async createBotTemplate(insertTemplate: InsertBotTemplate): Promise<BotTemplate> {\n    return await dbManager.executeWithRetry(async () => {\n      const template = await super.createBotTemplate(insertTemplate);\n      cachedOps.invalidateAllTemplates();\n      return template;\n    });\n  }\n\n  async updateBotTemplate(id: number, updateData: Partial<InsertBotTemplate>): Promise<BotTemplate | undefined> {\n    return await dbManager.executeWithRetry(async () => {\n      const template = await super.updateBotTemplate(id, updateData);\n      cachedOps.invalidateTemplate(id);\n      return template;\n    });\n  }\n\n  // Transaction support for complex operations\n  async createProjectWithTemplate(projectData: InsertBotProject, templateData: InsertBotTemplate): Promise<{ project: BotProject; template: BotTemplate }> {\n    return await dbManager.transaction(async (tx) => {\n      const project = await super.createBotProject(projectData);\n      const template = await super.createBotTemplate({ ...templateData, authorId: project.id.toString() });\n      \n      cachedOps.invalidateProject(project.id);\n      cachedOps.invalidateAllTemplates();\n      \n      return { project, template };\n    });\n  }\n\n  // Bulk operations with better performance\n  async bulkCreateTemplates(templates: InsertBotTemplate[]): Promise<BotTemplate[]> {\n    return await dbManager.executeWithRetry(async () => {\n      const results = await Promise.all(\n        templates.map(template => super.createBotTemplate(template))\n      );\n      cachedOps.invalidateAllTemplates();\n      return results;\n    });\n  }\n\n  // Enhanced statistics with caching\n  async getDetailedStats(): Promise<{\n    projects: number;\n    templates: number;\n    activeInstances: number;\n    totalUsers: number;\n    systemHealth: any;\n    cacheStats: any;\n  }> {\n    const [projects, templates, instances, users] = await Promise.all([\n      this.getAllBotProjects(),\n      this.getAllBotTemplates(),\n      this.getAllBotInstances(),\n      this.getAllUserBotData()\n    ]);\n\n    return {\n      projects: projects.length,\n      templates: templates.length,\n      activeInstances: instances.filter(i => i.status === 'running').length,\n      totalUsers: users.length,\n      systemHealth: dbManager.getConnectionStats(),\n      cacheStats: cachedOps.getStats()\n    };\n  }\n\n  // Database maintenance operations\n  async performMaintenance(): Promise<void> {\n    console.log('Starting database maintenance...');\n    \n    // Optimize connections\n    await dbManager.optimizeConnections();\n    \n    // Clean up old data (older than 30 days)\n    await dbManager.cleanupOldData(30);\n    \n    // Clear expired cache entries\n    cachedOps.cleanup();\n    \n    console.log('Database maintenance completed');\n  }\n\n  // Backup operations\n  async createBackup(): Promise<string> {\n    return await dbManager.createBackup();\n  }\n\n  // Health check\n  async healthCheck(): Promise<boolean> {\n    return await dbManager.performHealthCheck();\n  }\n\n  // Bot groups methods - use parent implementation directly\n  async getBotGroup(id: number): Promise<BotGroup | undefined> {\n    const [group] = await this.db.select().from(botGroups).where(eq(botGroups.id, id));\n    return group || undefined;\n  }\n\n  async getBotGroupsByProject(projectId: number): Promise<BotGroup[]> {\n    return await this.db.select().from(botGroups)\n      .where(eq(botGroups.projectId, projectId))\n      .orderBy(desc(botGroups.createdAt));\n  }\n\n  async getBotGroupByProjectAndGroupId(projectId: number, groupId: string): Promise<BotGroup | undefined> {\n    const [group] = await this.db.select().from(botGroups)\n      .where(and(eq(botGroups.projectId, projectId), eq(botGroups.groupId, groupId)));\n    return group || undefined;\n  }\n\n  async createBotGroup(group: InsertBotGroup): Promise<BotGroup> {\n    const [newGroup] = await this.db\n      .insert(botGroups)\n      .values(group)\n      .returning();\n    return newGroup;\n  }\n\n  async updateBotGroup(id: number, group: Partial<InsertBotGroup>): Promise<BotGroup | undefined> {\n    const [updatedGroup] = await this.db\n      .update(botGroups)\n      .set({ ...group, updatedAt: new Date() })\n      .where(eq(botGroups.id, id))\n      .returning();\n    return updatedGroup || undefined;\n  }\n\n  async deleteBotGroup(id: number): Promise<boolean> {\n    const result = await this.db.delete(botGroups).where(eq(botGroups.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n}\n\n// –ò—Å–ø–æ–ª—å–∑—É–µ–º EnhancedDatabaseStorage –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö\nlet storageInstance: EnhancedDatabaseStorage | null = null;\n\nfunction initStorage(): EnhancedDatabaseStorage {\n  if (!storageInstance) {\n    storageInstance = new EnhancedDatabaseStorage();\n  }\n  return storageInstance;\n}\n\n// Export storage instance directly\nexport const storage = new EnhancedDatabaseStorage();\n","size_bytes":68782},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, jsonb, timestamp, bigint } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const botProjects = pgTable(\"bot_projects\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  data: jsonb(\"data\").notNull(),\n  botToken: text(\"bot_token\"), // –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const botInstances = pgTable(\"bot_instances\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => botProjects.id).notNull(),\n  tokenId: integer(\"token_id\").references(() => botTokens.id, { onDelete: \"cascade\" }).notNull(),\n  status: text(\"status\").notNull(), // \"running\", \"stopped\", \"error\"\n  token: text(\"token\").notNull(),\n  processId: text(\"process_id\"),\n  startedAt: timestamp(\"started_at\").defaultNow(),\n  stoppedAt: timestamp(\"stopped_at\"),\n  errorMessage: text(\"error_message\"),\n});\n\nexport const botTemplates = pgTable(\"bot_templates\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  data: jsonb(\"data\").notNull(),\n  category: text(\"category\").default(\"custom\"), // \"official\", \"community\", \"custom\", \"business\", \"entertainment\", \"education\", \"utility\", \"games\"\n  tags: text(\"tags\").array(),\n  isPublic: integer(\"is_public\").default(0), // 0 = private, 1 = public\n  difficulty: text(\"difficulty\").default(\"easy\"), // \"easy\", \"medium\", \"hard\"\n  authorId: text(\"author_id\"), // ID –∞–≤—Ç–æ—Ä–∞ —à–∞–±–ª–æ–Ω–∞\n  authorName: text(\"author_name\"), // –ò–º—è –∞–≤—Ç–æ—Ä–∞\n  useCount: integer(\"use_count\").notNull().default(0), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π\n  rating: integer(\"rating\").notNull().default(0), // –†–µ–π—Ç–∏–Ω–≥ –æ—Ç 1 –¥–æ 5\n  ratingCount: integer(\"rating_count\").notNull().default(0), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫\n  featured: integer(\"featured\").notNull().default(0), // 0 = –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π, 1 = —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π\n  version: text(\"version\").default(\"1.0.0\"), // –í–µ—Ä—Å–∏—è —à–∞–±–ª–æ–Ω–∞\n  previewImage: text(\"preview_image\"), // URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞\n  lastUsedAt: timestamp(\"last_used_at\"), // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n  downloadCount: integer(\"download_count\").notNull().default(0), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π\n  likeCount: integer(\"like_count\").notNull().default(0), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤\n  bookmarkCount: integer(\"bookmark_count\").notNull().default(0), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–ª–∞–¥–æ–∫\n  viewCount: integer(\"view_count\").notNull().default(0), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤\n  language: text(\"language\").default(\"ru\"), // –Ø–∑—ã–∫ —à–∞–±–ª–æ–Ω–∞\n  requiresToken: integer(\"requires_token\").notNull().default(0), // –¢—Ä–µ–±—É–µ—Ç –ª–∏ –±–æ—Ç —Ç–æ–∫–µ–Ω\n  complexity: integer(\"complexity\").notNull().default(1), // –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç 1 –¥–æ 10\n  estimatedTime: integer(\"estimated_time\").notNull().default(5), // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const botTokens = pgTable(\"bot_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => botProjects.id, { onDelete: \"cascade\" }).notNull(),\n  name: text(\"name\").notNull(), // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –∏–º—è –¥–ª—è —Ç–æ–∫–µ–Ω–∞\n  token: text(\"token\").notNull(), // –°–∞–º —Ç–æ–∫–µ–Ω\n  isDefault: integer(\"is_default\").default(0), // 0 = –Ω–µ—Ç, 1 = –¥–∞ (—Ç–æ–∫–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)\n  isActive: integer(\"is_active\").default(1), // 0 = –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, 1 = –∞–∫—Ç–∏–≤–µ–Ω\n  description: text(\"description\"), // –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞\n  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ –∏–∑ Telegram API\n  botFirstName: text(\"bot_first_name\"), // –ò–º—è –±–æ—Ç–∞\n  botUsername: text(\"bot_username\"), // @username –±–æ—Ç–∞\n  botDescription: text(\"bot_description\"), // –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞\n  botShortDescription: text(\"bot_short_description\"), // –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞\n  botPhotoUrl: text(\"bot_photo_url\"), // URL –∞–≤–∞—Ç–∞—Ä–∫–∏ –±–æ—Ç–∞\n  botCanJoinGroups: integer(\"bot_can_join_groups\"), // –ú–æ–∂–µ—Ç –ª–∏ –±–æ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–∞–º\n  botCanReadAllGroupMessages: integer(\"bot_can_read_all_group_messages\"), // –ú–æ–∂–µ—Ç –ª–∏ —á–∏—Ç–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–∞—Ö\n  botSupportsInlineQueries: integer(\"bot_supports_inline_queries\"), // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ –∏–Ω–ª–∞–π–Ω –∑–∞–ø—Ä–æ—Å—ã\n  botHasMainWebApp: integer(\"bot_has_main_web_app\"), // –ï—Å—Ç—å –ª–∏ –≥–ª–∞–≤–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\n  lastUsedAt: timestamp(\"last_used_at\"), // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const mediaFiles = pgTable(\"media_files\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => botProjects.id, { onDelete: \"cascade\" }).notNull(),\n  fileName: text(\"file_name\").notNull(), // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞\n  fileType: text(\"file_type\").notNull(), // photo, video, audio, document\n  filePath: text(\"file_path\").notNull(), // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ\n  fileSize: integer(\"file_size\").notNull(), // –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö\n  mimeType: text(\"mime_type\").notNull(), // MIME —Ç–∏–ø —Ñ–∞–π–ª–∞\n  url: text(\"url\").notNull(), // URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É\n  description: text(\"description\"), // –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–∞\n  tags: text(\"tags\").array().default([]), // –¢–µ–≥–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞\n  isPublic: integer(\"is_public\").default(0), // 0 = –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, 1 = –ø—É–±–ª–∏—á–Ω—ã–π\n  usageCount: integer(\"usage_count\").default(0), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const userBotData = pgTable(\"user_bot_data\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => botProjects.id, { onDelete: \"cascade\" }).notNull(),\n  userId: text(\"user_id\").notNull(), // Telegram user ID\n  userName: text(\"user_name\"), // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram\n  firstName: text(\"first_name\"), // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  lastName: text(\"last_name\"), // –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  languageCode: text(\"language_code\"), // –ö–æ–¥ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  isBot: integer(\"is_bot\").default(0), // 0 = —á–µ–ª–æ–≤–µ–∫, 1 = –±–æ—Ç\n  isPremium: integer(\"is_premium\").default(0), // 0 = –æ–±—ã—á–Ω—ã–π, 1 = –ø—Ä–µ–º–∏—É–º\n  // –î–∞–Ω–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π\n  lastInteraction: timestamp(\"last_interaction\").defaultNow(),\n  interactionCount: integer(\"interaction_count\").default(0),\n  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —É–∑–ª–æ–≤ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞\n  userData: jsonb(\"user_data\").default({}), // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —Ñ–æ—Ä–º—ã –∏ —Ç.–¥.)\n  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n  currentState: text(\"current_state\"), // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –¥–∏–∞–ª–æ–≥–µ —Å –±–æ—Ç–æ–º\n  preferences: jsonb(\"preferences\").default({}), // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n  commandsUsed: jsonb(\"commands_used\").default({}), // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥\n  sessionsCount: integer(\"sessions_count\").default(1), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π\n  totalMessagesSent: integer(\"total_messages_sent\").default(0), // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n  totalMessagesReceived: integer(\"total_messages_received\").default(0), // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ\n  deviceInfo: text(\"device_info\"), // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ\n  locationData: jsonb(\"location_data\"), // –î–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã)\n  contactData: jsonb(\"contact_data\"), // –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã)\n  isBlocked: integer(\"is_blocked\").default(0), // 0 = –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, 1 = –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω\n  isActive: integer(\"is_active\").default(1), // 0 = –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, 1 = –∞–∫—Ç–∏–≤–µ–Ω\n  tags: text(\"tags\").array().default([]), // –¢–µ–≥–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n  notes: text(\"notes\"), // –ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const botUsers = pgTable(\"bot_users\", {\n  userId: bigint(\"user_id\", { mode: \"number\" }).primaryKey(),\n  username: text(\"username\"),\n  firstName: text(\"first_name\"),\n  lastName: text(\"last_name\"),\n  registeredAt: timestamp(\"registered_at\").defaultNow(),\n  lastInteraction: timestamp(\"last_interaction\").defaultNow(),\n  interactionCount: integer(\"interaction_count\").default(0),\n  userData: jsonb(\"user_data\").default({}),\n  isActive: integer(\"is_active\").default(1),\n});\n\nexport const botGroups = pgTable(\"bot_groups\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => botProjects.id, { onDelete: \"cascade\" }).notNull(),\n  groupId: text(\"group_id\"), // Telegram group ID\n  name: text(\"name\").notNull(), // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\n  url: text(\"url\").notNull(), // –°—Å—ã–ª–∫–∞ –Ω–∞ –≥—Ä—É–ø–ø—É\n  isAdmin: integer(\"is_admin\").default(0), // 0 = —É—á–∞—Å—Ç–Ω–∏–∫, 1 = –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\n  memberCount: integer(\"member_count\"), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n  isActive: integer(\"is_active\").default(1), // 0 = –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è, 1 = –∞–∫—Ç–∏–≤–Ω–∞—è\n  description: text(\"description\"), // –û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\n  settings: jsonb(\"settings\").default({}), // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã\n  // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–∞–º–∏\n  avatarUrl: text(\"avatar_url\"), // URL –∞–≤–∞—Ç–∞—Ä–∫–∏ –≥—Ä—É–ø–ø—ã\n  chatType: text(\"chat_type\").default(\"group\"), // \"group\", \"supergroup\", \"channel\"\n  inviteLink: text(\"invite_link\"), // –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞\n  // –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ\n  adminRights: jsonb(\"admin_rights\").default({\n    can_manage_chat: false,\n    can_change_info: false,\n    can_delete_messages: false,\n    can_invite_users: false,\n    can_restrict_members: false,\n    can_pin_messages: false,\n    can_promote_members: false,\n    can_manage_video_chats: false\n  }),\n  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã\n  messagesCount: integer(\"messages_count\").default(0),\n  activeUsers: integer(\"active_users\").default(0),\n  lastActivity: timestamp(\"last_activity\"),\n  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n  isPublic: integer(\"is_public\").default(0), // 0 = —á–∞—Å—Ç–Ω–∞—è, 1 = –ø—É–±–ª–∏—á–Ω–∞—è\n  language: text(\"language\").default(\"ru\"), // –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –≥—Ä—É–ø–ø—ã\n  timezone: text(\"timezone\"), // –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –≥—Ä—É–ø–ø—ã\n  tags: text(\"tags\").array().default([]), // –¢–µ–≥–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏\n  notes: text(\"notes\"), // –ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// –¢–∞–±–ª–∏—Ü–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø\nexport const groupMembers = pgTable(\"group_members\", {\n  id: serial(\"id\").primaryKey(),\n  groupId: integer(\"group_id\").references(() => botGroups.id, { onDelete: \"cascade\" }).notNull(),\n  userId: bigint(\"user_id\", { mode: \"number\" }).notNull(), // Telegram user ID\n  username: text(\"username\"),\n  firstName: text(\"first_name\"),\n  lastName: text(\"last_name\"),\n  status: text(\"status\").default(\"member\"), // \"creator\", \"administrator\", \"member\", \"restricted\", \"left\", \"kicked\"\n  isBot: integer(\"is_bot\").default(0),\n  // –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω)\n  adminRights: jsonb(\"admin_rights\").default({}),\n  customTitle: text(\"custom_title\"), // –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç–∏—Ç—É–ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n  // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω)\n  restrictions: jsonb(\"restrictions\").default({}),\n  restrictedUntil: timestamp(\"restricted_until\"),\n  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n  lastSeen: timestamp(\"last_seen\"),\n  messageCount: integer(\"message_count\").default(0),\n  isActive: integer(\"is_active\").default(1),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è Telegram Client API\nexport const userTelegramSettings = pgTable(\"user_telegram_settings\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().unique(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, email –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID)\n  apiId: text(\"api_id\"), // Telegram API ID\n  apiHash: text(\"api_hash\"), // Telegram API Hash\n  phoneNumber: text(\"phone_number\"), // –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n  sessionString: text(\"session_string\"), // –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è\n  isActive: integer(\"is_active\").default(1), // 0 = –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, 1 = –∞–∫—Ç–∏–≤–µ–Ω\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertBotProjectSchema = createInsertSchema(botProjects).pick({\n  name: true,\n  description: true,\n  data: true,\n  botToken: true,\n}).extend({\n  botToken: z.string().nullish(),\n});\n\nexport const insertBotInstanceSchema = createInsertSchema(botInstances).pick({\n  projectId: true,\n  tokenId: true,\n  status: true,\n  token: true,\n  processId: true,\n  errorMessage: true,\n  startedAt: true,\n  stoppedAt: true,\n});\n\nexport const insertBotTemplateSchema = createInsertSchema(botTemplates).pick({\n  name: true,\n  description: true,\n  data: true,\n  category: true,\n  tags: true,\n  isPublic: true,\n  difficulty: true,\n  authorId: true,\n  authorName: true,\n  version: true,\n  previewImage: true,\n  featured: true,\n  language: true,\n  requiresToken: true,\n  complexity: true,\n  estimatedTime: true,\n}).extend({\n  category: z.enum([\"custom\", \"business\", \"entertainment\", \"education\", \"utility\", \"games\", \"official\", \"community\"]).default(\"custom\"),\n  difficulty: z.enum([\"easy\", \"medium\", \"hard\"]).default(\"easy\"),\n  language: z.enum([\"ru\", \"en\", \"es\", \"fr\", \"de\", \"it\", \"pt\", \"zh\", \"ja\", \"ko\"]).default(\"ru\"),\n  complexity: z.number().min(1).max(10).default(1),\n  estimatedTime: z.number().min(1).max(120).default(5),\n  rating: z.number().min(1).max(5).optional(),\n});\n\nexport const insertBotTokenSchema = createInsertSchema(botTokens).pick({\n  projectId: true,\n  name: true,\n  token: true,\n  isDefault: true,\n  isActive: true,\n  description: true,\n  botFirstName: true,\n  botUsername: true,\n  botDescription: true,\n  botShortDescription: true,\n  botPhotoUrl: true,\n  botCanJoinGroups: true,\n  botCanReadAllGroupMessages: true,\n  botSupportsInlineQueries: true,\n  botHasMainWebApp: true,\n}).extend({\n  name: z.string().min(1, \"–ò–º—è —Ç–æ–∫–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ\"),\n  token: z.string().min(1, \"–¢–æ–∫–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"),\n  isDefault: z.number().min(0).max(1).default(0),\n  isActive: z.number().min(0).max(1).default(1),\n  botCanJoinGroups: z.number().min(0).max(1).optional(),\n  botCanReadAllGroupMessages: z.number().min(0).max(1).optional(),\n  botSupportsInlineQueries: z.number().min(0).max(1).optional(),\n  botHasMainWebApp: z.number().min(0).max(1).optional(),\n});\n\nexport const insertMediaFileSchema = createInsertSchema(mediaFiles).pick({\n  projectId: true,\n  fileName: true,\n  fileType: true,\n  filePath: true,\n  fileSize: true,\n  mimeType: true,\n  url: true,\n  description: true,\n  tags: true,\n  isPublic: true,\n}).extend({\n  fileName: z.string().min(1, \"–ò–º—è —Ñ–∞–π–ª–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ\"),\n  fileType: z.enum([\"photo\", \"video\", \"audio\", \"document\"]),\n  filePath: z.string().min(1, \"–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"),\n  fileSize: z.number().min(1, \"–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0\"),\n  mimeType: z.string().min(1, \"MIME —Ç–∏–ø –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"),\n  url: z.string().url(\"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL\"),\n  tags: z.array(z.string()).default([]),\n  isPublic: z.number().min(0).max(1).default(0),\n});\n\nexport const insertUserBotDataSchema = createInsertSchema(userBotData).pick({\n  projectId: true,\n  userId: true,\n  userName: true,\n  firstName: true,\n  lastName: true,\n  languageCode: true,\n  isBot: true,\n  isPremium: true,\n  interactionCount: true,\n  userData: true,\n  currentState: true,\n  preferences: true,\n  commandsUsed: true,\n  sessionsCount: true,\n  totalMessagesSent: true,\n  totalMessagesReceived: true,\n  deviceInfo: true,\n  locationData: true,\n  contactData: true,\n  isBlocked: true,\n  isActive: true,\n  tags: true,\n  notes: true,\n}).extend({\n  userId: z.string().min(1, \"ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"),\n  userData: z.record(z.any()).default({}),\n  preferences: z.record(z.any()).default({}),\n  commandsUsed: z.record(z.any()).default({}),\n  tags: z.array(z.string()).default([]),\n  isBot: z.number().min(0).max(1).default(0),\n  isPremium: z.number().min(0).max(1).default(0),\n  isBlocked: z.number().min(0).max(1).default(0),\n  isActive: z.number().min(0).max(1).default(1),\n  sessionsCount: z.number().min(1).default(1),\n  totalMessagesSent: z.number().min(0).default(0),\n  totalMessagesReceived: z.number().min(0).default(0),\n});\n\nexport const insertBotUserSchema = createInsertSchema(botUsers).pick({\n  userId: true,\n  username: true,\n  firstName: true,\n  lastName: true,\n  interactionCount: true,\n  userData: true,\n  isActive: true,\n}).extend({\n  userId: z.number().positive(\"ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º\"),\n  userData: z.record(z.any()).default({}),\n  isActive: z.number().min(0).max(1).default(1),\n  interactionCount: z.number().min(0).default(0),\n});\n\nexport const insertBotGroupSchema = createInsertSchema(botGroups).pick({\n  projectId: true,\n  groupId: true,\n  name: true,\n  url: true,\n  isAdmin: true,\n  memberCount: true,\n  isActive: true,\n  description: true,\n  settings: true,\n  avatarUrl: true,\n  chatType: true,\n  inviteLink: true,\n  adminRights: true,\n  messagesCount: true,\n  activeUsers: true,\n  lastActivity: true,\n  isPublic: true,\n  language: true,\n  timezone: true,\n  tags: true,\n  notes: true,\n}).extend({\n  name: z.string().min(1, \"–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ\"),\n  url: z.string().optional().default(\"\"), // –°—Å—ã–ª–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö ID –≥—Ä—É–ø–ø\n  isAdmin: z.number().min(0).max(1).default(0),\n  isActive: z.number().min(0).max(1).default(1),\n  isPublic: z.number().min(0).max(1).default(0),\n  settings: z.record(z.any()).default({}),\n  adminRights: z.record(z.any()).default({\n    can_manage_chat: false,\n    can_change_info: false,\n    can_delete_messages: false,\n    can_invite_users: false,\n    can_restrict_members: false,\n    can_pin_messages: false,\n    can_promote_members: false,\n    can_manage_video_chats: false\n  }),\n  language: z.enum([\"ru\", \"en\", \"es\", \"fr\", \"de\", \"it\", \"pt\", \"zh\", \"ja\", \"ko\"]).default(\"ru\"),\n  chatType: z.enum([\"group\", \"supergroup\", \"channel\"]).default(\"group\"),\n  tags: z.array(z.string()).default([]),\n  messagesCount: z.number().min(0).default(0),\n  activeUsers: z.number().min(0).default(0),\n});\n\n// –°—Ö–µ–º–∞ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø\nexport const insertGroupMemberSchema = createInsertSchema(groupMembers).pick({\n  groupId: true,\n  userId: true,\n  username: true,\n  firstName: true,\n  lastName: true,\n  status: true,\n  isBot: true,\n  adminRights: true,\n  customTitle: true,\n  restrictions: true,\n  restrictedUntil: true,\n  joinedAt: true,\n  lastSeen: true,\n  messageCount: true,\n  isActive: true,\n}).extend({\n  userId: z.number().positive(\"ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º\"),\n  status: z.enum([\"creator\", \"administrator\", \"member\", \"restricted\", \"left\", \"kicked\"]).default(\"member\"),\n  isBot: z.number().min(0).max(1).default(0),\n  isActive: z.number().min(0).max(1).default(1),\n  adminRights: z.record(z.any()).default({}),\n  restrictions: z.record(z.any()).default({}),\n  messageCount: z.number().min(0).default(0),\n});\n\n// –°—Ö–µ–º–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram API\nexport const insertUserTelegramSettingsSchema = createInsertSchema(userTelegramSettings).pick({\n  userId: true,\n  apiId: true,\n  apiHash: true,\n  phoneNumber: true,\n  sessionString: true,\n  isActive: true,\n}).extend({\n  userId: z.string().min(1, \"ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"),\n  apiId: z.string().min(1, \"API ID –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"),\n  apiHash: z.string().min(1, \"API Hash –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\"),\n  phoneNumber: z.string().optional(),\n  isActive: z.number().min(0).max(1).default(1),\n});\n\n// –°—Ö–µ–º–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —à–∞–±–ª–æ–Ω–∞\nexport const rateTemplateSchema = z.object({\n  templateId: z.number(),\n  rating: z.number().min(1).max(5),\n});\n\nexport type InsertBotProject = z.infer<typeof insertBotProjectSchema>;\nexport type BotProject = typeof botProjects.$inferSelect;\nexport type InsertBotInstance = z.infer<typeof insertBotInstanceSchema>;\nexport type BotInstance = typeof botInstances.$inferSelect;\nexport type InsertBotTemplate = z.infer<typeof insertBotTemplateSchema>;\nexport type BotTemplate = typeof botTemplates.$inferSelect;\nexport type InsertBotToken = z.infer<typeof insertBotTokenSchema>;\nexport type BotToken = typeof botTokens.$inferSelect;\nexport type InsertMediaFile = z.infer<typeof insertMediaFileSchema>;\nexport type MediaFile = typeof mediaFiles.$inferSelect;\nexport type InsertUserBotData = z.infer<typeof insertUserBotDataSchema>;\nexport type UserBotData = typeof userBotData.$inferSelect;\nexport type InsertBotUser = z.infer<typeof insertBotUserSchema>;\nexport type BotUser = typeof botUsers.$inferSelect;\nexport type InsertBotGroup = z.infer<typeof insertBotGroupSchema>;\nexport type BotGroup = typeof botGroups.$inferSelect;\nexport type InsertGroupMember = z.infer<typeof insertGroupMemberSchema>;\nexport type GroupMember = typeof groupMembers.$inferSelect;\nexport type InsertUserTelegramSettings = z.infer<typeof insertUserTelegramSettingsSchema>;\nexport type UserTelegramSettings = typeof userTelegramSettings.$inferSelect;\n\n// Bot structure schemas\nexport const buttonSchema = z.object({\n  id: z.string(),\n  text: z.string(),\n  action: z.enum(['goto', 'command', 'url', 'contact', 'location', 'selection']),\n  target: z.string().optional(),\n  url: z.string().optional(),\n  requestContact: z.boolean().optional(),\n  requestLocation: z.boolean().optional(),\n  buttonType: z.enum(['normal', 'option', 'complete']).default('normal'),\n  skipDataCollection: z.boolean().default(false), // –û—Ç–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–π –∫–Ω–æ–ø–∫–∏\n});\n\nexport const nodeSchema = z.object({\n  id: z.string(),\n  type: z.enum(['start', 'message', 'photo', 'video', 'audio', 'document', 'keyboard', 'command', 'sticker', 'voice', 'animation', 'location', 'contact', 'pin_message', 'unpin_message', 'delete_message', 'ban_user', 'unban_user', 'mute_user', 'unmute_user', 'kick_user', 'promote_user', 'demote_user', 'admin_rights']),\n  position: z.object({\n    x: z.number(),\n    y: z.number(),\n  }),\n  data: z.object({\n    command: z.string().optional(),\n    description: z.string().optional(),\n    messageText: z.string().optional(),\n    imageUrl: z.string().optional(),\n    videoUrl: z.string().optional(),\n    audioUrl: z.string().optional(),\n    documentUrl: z.string().optional(),\n    documentName: z.string().optional(),\n    mediaCaption: z.string().optional(),\n    keyboardType: z.enum(['reply', 'inline', 'none']).default('none'),\n    buttons: z.array(buttonSchema).default([]),\n    oneTimeKeyboard: z.boolean().default(false),\n    resizeKeyboard: z.boolean().default(true),\n    markdown: z.boolean().default(false),\n    formatMode: z.enum(['html', 'markdown', 'none']).default('none'),\n    // –°–∏–Ω–æ–Ω–∏–º—ã –¥–ª—è –∫–æ–º–∞–Ω–¥ - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é\n    synonyms: z.array(z.string()).default([]),\n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n    isPrivateOnly: z.boolean().default(false),\n    adminOnly: z.boolean().default(false),\n    requiresAuth: z.boolean().default(false),\n    showInMenu: z.boolean().default(true),\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–∞–Ω–¥\n    commandTimeout: z.number().optional(), // –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö\n    cooldownTime: z.number().optional(), // –í—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏ –∫–æ–º–∞–Ω–¥—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö\n    maxUsagesPerDay: z.number().optional(), // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –≤ –¥–µ–Ω—å\n    enableStatistics: z.boolean().default(true), // –í–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏\n    customParameters: z.array(z.string()).default([]), // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥—ã\n    // –ü–æ–ª—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –≤ –≥—Ä—É–ø–ø–∞—Ö\n    targetMessageId: z.string().optional(), // ID —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è\n    messageIdSource: z.enum(['manual', 'variable', 'last_message']).default('last_message'), // –ò—Å—Ç–æ—á–Ω–∏–∫ ID —Å–æ–æ–±—â–µ–Ω–∏—è\n    variableName: z.string().optional(), // –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å ID —Å–æ–æ–±—â–µ–Ω–∏—è\n    disableNotification: z.boolean().default(false), // –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n    // –ü–æ–ª—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ –≥—Ä—É–ø–ø–∞—Ö\n    targetUserId: z.string().optional(), // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏\n    userIdSource: z.enum(['manual', 'variable', 'last_message']).default('last_message'), // –ò—Å—Ç–æ—á–Ω–∏–∫ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    userVariableName: z.string().optional(), // –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤\n    stickerUrl: z.string().optional(),\n    stickerFileId: z.string().optional(),\n    voiceUrl: z.string().optional(),\n    animationUrl: z.string().optional(),\n    latitude: z.number().optional(),\n    longitude: z.number().optional(),\n    title: z.string().optional(),\n    address: z.string().optional(),\n    foursquareId: z.string().optional(),\n    foursquareType: z.string().optional(),\n    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤\n    mapService: z.enum(['yandex', 'google', '2gis', 'custom']).default('custom'),\n    yandexMapUrl: z.string().optional(),\n    googleMapUrl: z.string().optional(),\n    gisMapUrl: z.string().optional(), // 2–ì–ò–°\n    mapZoom: z.number().min(1).max(20).default(15),\n    showDirections: z.boolean().default(false),\n    generateMapPreview: z.boolean().default(true),\n    phoneNumber: z.string().optional(),\n    firstName: z.string().optional(),\n    lastName: z.string().optional(),\n    userId: z.number().optional(),\n    vcard: z.string().optional(),\n    question: z.string().optional(),\n    options: z.array(z.string()).default([]),\n    allowsMultipleAnswers: z.boolean().default(false),\n    anonymousVoting: z.boolean().default(true),\n    emoji: z.string().optional(),\n    mediaDuration: z.number().optional(), // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö\n    width: z.number().optional(),\n    height: z.number().optional(),\n    performer: z.string().optional(),\n    fileSize: z.number().optional(),\n    filename: z.string().optional(),\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞\n    inputType: z.enum(['text', 'number', 'email', 'phone', 'photo', 'video', 'audio', 'document', 'location', 'contact', 'any']).default('text'),\n    responseType: z.enum(['text', 'buttons']).default('text'), // –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ –∏–ª–∏ –∫–Ω–æ–ø–∫–∏\n    responseOptions: z.array(z.object({\n      id: z.string(),\n      text: z.string(),\n      value: z.string().optional(),\n      action: z.enum(['goto', 'command', 'url']).default('goto'),\n      target: z.string().optional(),\n      url: z.string().optional()\n    })).default([]), // –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫\n    allowMultipleSelection: z.boolean().default(false), // –†–∞–∑—Ä–µ—à–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n    multiSelectVariable: z.string().optional(), // –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n    continueButtonText: z.string().optional(), // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞\n    continueButtonTarget: z.string().optional(), // –£–∑–µ–ª –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞\n    inputVariable: z.string().optional(), // –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞\n    inputPrompt: z.string().optional(), // –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –≤–≤–æ–¥–∞\n    inputValidation: z.string().optional(), // –ü—Ä–∞–≤–∏–ª–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (regex –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ)\n    inputRequired: z.boolean().default(true), // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞\n    inputTimeout: z.number().optional(), // –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö\n    inputRetryMessage: z.string().optional(), // –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω–æ–º –≤–≤–æ–¥–µ\n    inputSuccessMessage: z.string().optional(), // –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤–≤–æ–¥–µ\n    // –£—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n    enableConditionalMessages: z.boolean().default(false), // –í–∫–ª—é—á–∏—Ç—å —É—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n    conditionalMessages: z.array(z.object({\n      id: z.string(),\n      condition: z.enum(['user_data_exists', 'user_data_equals', 'user_data_not_exists', 'user_data_contains', 'first_time', 'returning_user']).default('user_data_exists'), // –¢–∏–ø —É—Å–ª–æ–≤–∏—è\n      variableName: z.string().optional(), // –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)\n      variableNames: z.array(z.string()).default([]), // –ú–∞—Å—Å–∏–≤ –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤\n      logicOperator: z.enum(['AND', 'OR']).default('AND'), // –õ–æ–≥–∏—á–µ—Å–∫–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n      expectedValue: z.string().optional(), // –û–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è\n      messageText: z.string(), // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —É—Å–ª–æ–≤–∏—è\n      formatMode: z.enum(['text', 'markdown', 'html']).default('text'), // –†–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n      keyboardType: z.enum(['reply', 'inline', 'none']).default('none'), // –¢–∏–ø –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n      buttons: z.array(buttonSchema).default([]), // –ö–Ω–æ–ø–∫–∏ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n      waitForTextInput: z.boolean().default(false), // –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è\n      textInputVariable: z.string().optional(), // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n      nextNodeAfterInput: z.string().optional(), // ID —É–∑–ª–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø–µ—Ä–µ–π—Ç–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–≤–æ–¥–∞\n      priority: z.number().default(0) // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (—á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)\n    })).default([]), // –ú–∞—Å—Å–∏–≤ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n    fallbackMessage: z.string().optional(), // –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ\n    saveToDatabase: z.boolean().default(false), // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n    allowSkip: z.boolean().default(false), // –†–∞–∑—Ä–µ—à–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫ –≤–≤–æ–¥–∞\n    \n    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤\n    collectUserInput: z.boolean().default(false), // –í–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞\n    inputTargetNodeId: z.string().optional(), // ID —É–∑–ª–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –ø–æ—Å–ª–µ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞\n    inputButtonType: z.enum(['inline', 'reply']).default('inline'), // –¢–∏–ø –∫–Ω–æ–ø–æ–∫ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤\n    minLength: z.number().optional(), // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞\n    maxLength: z.number().optional(), // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞\n    placeholder: z.string().optional(), // –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –≤–≤–æ–¥–∞\n    defaultValue: z.string().optional(), // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n    \n    \n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π\n    enableUserActions: z.boolean().default(false), // –í–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è\n    actionTrigger: z.enum(['join', 'leave', 'message', 'button_click', 'custom']).optional(), // –¢—Ä–∏–≥–≥–µ—Ä –¥–µ–π—Å—Ç–≤–∏—è\n    triggerText: z.string().optional(), // –¢–µ–∫—Å—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∞\n    userActionType: z.enum(['message', 'command', 'button', 'media']).optional(), // –¢–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è\n    actionTag: z.string().optional(), // –¢–µ–≥ –¥–µ–π—Å—Ç–≤–∏—è\n    actionMessage: z.string().optional(), // –°–æ–æ–±—â–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è\n    silentAction: z.boolean().default(false), // –ë–µ–∑–∑–≤—É—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ\n    \n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤\n    mimeType: z.string().optional(),\n    stickerSetName: z.string().optional(),\n    fileName: z.string().optional(),\n    city: z.string().optional(),\n    country: z.string().optional(),\n    enableTextInput: z.boolean().optional(),\n    name: z.string().optional(),\n    label: z.string().optional(),\n    checkmarkSymbol: z.string().optional(),\n    multiSelectCheckmark: z.string().optional(),\n    \n    // –ü–æ–ª—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (ID –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)\n    duration: z.number().optional(), // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö\n    muteDuration: z.number().optional(), // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è (–¥–ª—è mute) –≤ —Å–µ–∫—É–Ω–¥–∞—Ö\n    reason: z.string().optional(), // –ü—Ä–∏—á–∏–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è (–±–∞–Ω, –º—É—Ç –∏ —Ç.–¥.)\n    // –ü—Ä–∞–≤–∞ –¥–ª—è promote/demote\n    canChangeInfo: z.boolean().default(false), // –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä—É–ø–ø–µ\n    canDeleteMessages: z.boolean().default(false), // –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è\n    canBanUsers: z.boolean().default(false), // –ú–æ–∂–µ—Ç –±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n    canInviteUsers: z.boolean().default(false), // –ú–æ–∂–µ—Ç –ø—Ä–∏–≥–ª–∞—à–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n    canPinMessages: z.boolean().default(false), // –ú–æ–∂–µ—Ç –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è\n    canAddAdmins: z.boolean().default(false), // –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤\n    canRestrictMembers: z.boolean().default(false), // –ú–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n    canPromoteMembers: z.boolean().default(false), // –ú–æ–∂–µ—Ç –ø–æ–≤—ã—à–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n    canManageVideoChats: z.boolean().default(false), // –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ—á–∞—Ç–∞–º–∏\n    canManageTopics: z.boolean().default(false), // –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–º–∞–º–∏ (–¥–ª—è —Ñ–æ—Ä—É–º–æ–≤)\n    isAnonymous: z.boolean().default(false), // –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è restrict –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n    canSendMessages: z.boolean().default(true), // –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è\n    canSendMediaMessages: z.boolean().default(true), // –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–µ–¥–∏–∞\n    canSendPolls: z.boolean().default(true), // –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–ø—Ä–æ—Å—ã\n    canSendOtherMessages: z.boolean().default(true), // –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n    canAddWebPagePreviews: z.boolean().default(true), // –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–µ–≤—å—é –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü\n    canChangeGroupInfo: z.boolean().default(true), // –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä—É–ø–ø–µ\n    canInviteUsers2: z.boolean().default(true), // –ú–æ–∂–µ—Ç –ø—Ä–∏–≥–ª–∞—à–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥—É–±–ª–∏–∫–∞—Ç –¥–ª—è restrict)\n    canPinMessages2: z.boolean().default(true), // –ú–æ–∂–µ—Ç –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (–¥—É–±–ª–∏–∫–∞—Ç –¥–ª—è restrict)\n    untilDate: z.number().optional(), // –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (Unix timestamp)\n    \n    // –ü–æ–ª—è –¥–ª—è —É–∑–ª–∞ admin_rights - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å Telegram Bot API)\n    adminTargetUserId: z.string().optional(), // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤\n    adminUserIdSource: z.enum(['manual', 'variable', 'last_message']).default('last_message'), // –ò—Å—Ç–æ—á–Ω–∏–∫ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    adminUserVariableName: z.string().optional(), // –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    // –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ Telegram Bot API (promoteChatMember)\n    can_manage_chat: z.boolean().default(false), // –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —á–∞—Ç–æ–º\n    can_post_messages: z.boolean().default(false), // –ú–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª—ã)\n    can_edit_messages: z.boolean().default(false), // –ú–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª—ã)\n    can_delete_messages: z.boolean().default(false), // –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è\n    can_post_stories: z.boolean().default(false), // –ú–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏–∏\n    can_edit_stories: z.boolean().default(false), // –ú–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏–∏\n    can_delete_stories: z.boolean().default(false), // –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∏—Å—Ç–æ—Ä–∏–∏\n    can_manage_video_chats: z.boolean().default(false), // –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ—á–∞—Ç–∞–º–∏\n    can_restrict_members: z.boolean().default(false), // –ú–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n    can_promote_members: z.boolean().default(false), // –ú–æ–∂–µ—Ç –ø–æ–≤—ã—à–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n    can_change_info: z.boolean().default(false), // –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —á–∞—Ç–∞\n    can_invite_users: z.boolean().default(false), // –ú–æ–∂–µ—Ç –ø—Ä–∏–≥–ª–∞—à–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n    can_pin_messages: z.boolean().default(false), // –ú–æ–∂–µ—Ç –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è\n    can_manage_topics: z.boolean().default(false), // –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–º–∞–º–∏ (—Ç–æ–ª—å–∫–æ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—ã)\n    is_anonymous: z.boolean().default(false), // –ú–æ–∂–µ—Ç –±—ã—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—ã–º\n    // –°–≤—è–∑–∫–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —á–∞—Ç–æ–º –∏–ª–∏ –≥—Ä—É–ø–ø–æ–π\n    adminChatId: z.string().optional(), // ID —á–∞—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤\n    adminChatIdSource: z.enum(['manual', 'variable', 'current_chat']).default('current_chat'), // –ò—Å—Ç–æ—á–Ω–∏–∫ ID —á–∞—Ç–∞\n    adminChatVariableName: z.string().optional() // –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å ID —á–∞—Ç–∞\n  }),\n});\n\nexport const connectionSchema = z.object({\n  id: z.string(),\n  source: z.string(),\n  target: z.string(),\n  sourceHandle: z.string().optional(),\n  targetHandle: z.string().optional(),\n  // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n  sourceSheetId: z.string().optional(), // ID –ª–∏—Å—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, —Ç–æ —Ç–µ–∫—É—â–∏–π –ª–∏—Å—Ç)\n  targetSheetId: z.string().optional(), // ID –ª–∏—Å—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, —Ç–æ —Ç–µ–∫—É—â–∏–π –ª–∏—Å—Ç)\n  isInterSheet: z.boolean().default(false), // –§–ª–∞–≥ –º–µ–∂–ª–∏—Å—Ç–æ–≤–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n});\n\n// –°—Ö–µ–º–∞ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∏–¥–∞ –ª–∏—Å—Ç–∞ (–ø–æ–∑–∏—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±)\nexport const sheetViewStateSchema = z.object({\n  pan: z.object({\n    x: z.number().default(0),\n    y: z.number().default(0),\n  }).default({ x: 0, y: 0 }),\n  zoom: z.number().default(100),\n});\n\n// –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ —Ö–æ–ª—Å—Ç–∞\nexport const canvasSheetSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  nodes: z.array(nodeSchema).default([]),\n  connections: z.array(connectionSchema).default([]),\n  viewState: sheetViewStateSchema.default({ pan: { x: 0, y: 0 }, zoom: 100 }),\n  createdAt: z.date().optional(),\n  updatedAt: z.date().optional(),\n});\n\n// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–∏—Å—Ç–æ–≤\nexport const botDataWithSheetsSchema = z.object({\n  sheets: z.array(canvasSheetSchema).default([]),\n  activeSheetId: z.string().optional(),\n  // –í–µ—Ä—Å–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏\n  version: z.number().default(2),\n});\n\n// –°—Ç–∞—Ä–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\nexport const botDataSchema = z.object({\n  nodes: z.array(nodeSchema),\n  connections: z.array(connectionSchema),\n});\n\nexport type Button = z.infer<typeof buttonSchema>;\nexport type Node = z.infer<typeof nodeSchema>;\nexport type Connection = z.infer<typeof connectionSchema>;\nexport type SheetViewState = z.infer<typeof sheetViewStateSchema>;\nexport type CanvasSheet = z.infer<typeof canvasSheetSchema>;\nexport type BotDataWithSheets = z.infer<typeof botDataWithSheetsSchema>;\nexport type BotData = z.infer<typeof botDataSchema>;\n\n// Component definition for drag and drop\nexport interface ComponentDefinition {\n  id: string;\n  type: Node['type'];\n  name: string;\n  description: string;\n  icon: string;\n  color: string;\n  defaultData?: any;\n  [key: string]: any; // Allow additional properties for compatibility\n}\n","size_bytes":42914},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { ServerStatus } from \"@/components/server-status\";\nimport { lazy, Suspense } from \"react\";\nimport { Loader2 } from \"lucide-react\";\nimport React from \"react\";\n\n// –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\nconst Home = lazy(() => import(\"@/pages/home\"));\nconst Editor = lazy(() => import(\"@/pages/editor\"));\nconst TemplatesPage = lazy(() => import(\"@/pages/templates-wrapper\"));\nconst DatabaseManager = lazy(() => import(\"@/pages/DatabaseManager\"));\nconst NotFound = lazy(() => import(\"@/pages/not-found\"));\n\n// –ë–æ–ª–µ–µ –∫—Ä–∞—Å–∏–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏\nfunction LoadingSpinner() {\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-background\">\n      <div className=\"flex flex-col items-center space-y-6\">\n        {/* –õ–æ–≥–æ—Ç–∏–ø –∏–ª–∏ –∏–∫–æ–Ω–∫–∞ */}\n        <div className=\"relative\">\n          <div className=\"w-16 h-16 rounded-full border-4 border-primary/20\"></div>\n          <Loader2 className=\"h-16 w-16 animate-spin text-primary absolute inset-0\" />\n        </div>\n        \n        {/* –¢–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ */}\n        <div className=\"text-center space-y-2\">\n          <h3 className=\"text-lg font-medium text-foreground\">Telegram Bot Builder</h3>\n          <p className=\"text-sm text-muted-foreground\">–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å...</p>\n          \n          {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */}\n          <div className=\"w-48 h-1 bg-muted rounded-full overflow-hidden\">\n            <div className=\"h-full bg-primary rounded-full animate-pulse\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction Router() {\n  return (\n    <Suspense fallback={<LoadingSpinner />}>\n      <Switch>\n        <Route path=\"/projects\" component={Home} />\n        <Route path=\"/templates\" component={TemplatesPage} />\n        <Route path=\"/database\" component={DatabaseManager} />\n        <Route path=\"/editor/:id\" component={Editor} />\n        <Route path=\"/projects/:id\" component={Editor} />\n        <Route path=\"/\" component={Editor} />\n        <Route component={NotFound} />\n      </Switch>\n    </Suspense>\n  );\n}\n\nfunction App() {\n  return (\n    <ThemeProvider defaultTheme=\"system\" storageKey=\"telegram-bot-builder-theme\">\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <ServerStatus />\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </QueryClientProvider>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","size_bytes":2868},"client/src/index.css":{"content":"/* Font Awesome icons via CDN */\n@import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(20, 14.3%, 4.1%);\n  --muted: hsl(60, 4.8%, 95.9%);\n  --muted-foreground: hsl(25, 5.3%, 44.7%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(20, 14.3%, 4.1%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(20, 14.3%, 4.1%);\n  --border: hsl(20, 5.9%, 90%);\n  --input: hsl(20, 5.9%, 90%);\n  --primary: hsl(207, 90%, 54%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(60, 4.8%, 95.9%);\n  --secondary-foreground: hsl(24, 9.8%, 10%);\n  --accent: hsl(60, 4.8%, 95.9%);\n  --accent-foreground: hsl(24, 9.8%, 10%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(60, 9.1%, 97.8%);\n  --ring: hsl(20, 14.3%, 4.1%);\n  --radius: 0.5rem;\n  \n  /* Enhanced theme variables */\n  --success: hsl(142, 76%, 36%);\n  --success-foreground: hsl(355, 7%, 97%);\n  --warning: hsl(38, 92%, 50%);\n  --warning-foreground: hsl(48, 96%, 89%);\n  --info: hsl(199, 89%, 48%);\n  --info-foreground: hsl(210, 20%, 98%);\n  \n  /* Gradient colors */\n  --gradient-primary-start: hsl(207, 90%, 54%);\n  --gradient-primary-end: hsl(217, 100%, 64%);\n  --gradient-secondary-start: hsl(60, 4.8%, 95.9%);\n  --gradient-secondary-end: hsl(60, 4.8%, 88%);\n  \n  /* Shadow colors */\n  --shadow-light: hsl(20, 5.9%, 50% / 0.1);\n  --shadow-medium: hsl(20, 5.9%, 30% / 0.15);\n  --shadow-heavy: hsl(20, 5.9%, 10% / 0.2);\n}\n\n.dark {\n  --background: hsl(240, 10%, 3.9%);\n  --foreground: hsl(0, 0%, 98%);\n  --muted: hsl(240, 3.7%, 15.9%);\n  --muted-foreground: hsl(240, 5%, 64.9%);\n  --popover: hsl(240, 10%, 3.9%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --card: hsl(240, 10%, 7%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --border: hsl(240, 3.7%, 18%);\n  --input: hsl(240, 3.7%, 15.9%);\n  --primary: hsl(207, 90%, 60%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(240, 3.7%, 20%);\n  --secondary-foreground: hsl(0, 0%, 98%);\n  --accent: hsl(240, 3.7%, 20%);\n  --accent-foreground: hsl(0, 0%, 98%);\n  --destructive: hsl(0, 75%, 60%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --ring: hsl(240, 4.9%, 83.9%);\n  --radius: 0.5rem;\n  \n  /* Enhanced dark theme variables */\n  --success: hsl(142, 76%, 45%);\n  --success-foreground: hsl(355, 7%, 97%);\n  --warning: hsl(38, 92%, 55%);\n  --warning-foreground: hsl(48, 96%, 89%);\n  --info: hsl(199, 89%, 55%);\n  --info-foreground: hsl(210, 20%, 98%);\n  \n  /* Dark gradient colors */\n  --gradient-primary-start: hsl(207, 90%, 60%);\n  --gradient-primary-end: hsl(217, 100%, 70%);\n  --gradient-secondary-start: hsl(240, 3.7%, 20%);\n  --gradient-secondary-end: hsl(240, 3.7%, 30%);\n  \n  /* Dark shadow colors */\n  --shadow-light: hsl(0, 0%, 0% / 0.2);\n  --shadow-medium: hsl(0, 0%, 0% / 0.3);\n  --shadow-heavy: hsl(0, 0%, 0% / 0.5);\n  \n  /* Surface colors for better depth */\n  --surface-1: hsl(240, 8%, 8%);\n  --surface-2: hsl(240, 8%, 12%);\n  --surface-3: hsl(240, 8%, 16%);\n  \n  /* Glass effect colors */\n  --glass-bg: hsl(240, 10%, 10% / 0.8);\n  --glass-border: hsl(240, 10%, 30% / 0.2);\n  \n  /* Switch colors for better visibility */\n  --switch-unchecked-bg: hsl(240, 8%, 25%);\n  --switch-unchecked-border: hsl(240, 10%, 40%);\n  --switch-unchecked-thumb: hsl(240, 5%, 60%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n@layer utilities {\n  .line-clamp-3 {\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n\n  /* Grid background patterns */\n  .bg-grid-small {\n    background-image: radial-gradient(circle, hsl(var(--muted-foreground) / 0.3) 1px, transparent 1px);\n    background-size: 20px 20px;\n  }\n  \n  /* Enhanced Switch visibility in dark theme */\n  .dark [data-state=\"unchecked\"][role=\"switch\"] {\n    background-color: var(--switch-unchecked-bg) !important;\n    border: 1px solid var(--switch-unchecked-border) !important;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.1) !important;\n  }\n  \n  .dark [data-state=\"unchecked\"][role=\"switch\"] > span {\n    background-color: var(--switch-unchecked-thumb) !important;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4) !important;\n  }\n  \n  /* Hover effects for better interaction feedback */\n  .dark [data-state=\"unchecked\"][role=\"switch\"]:hover {\n    background-color: hsl(240, 8%, 30%) !important;\n    border-color: hsl(240, 10%, 50%) !important;\n    transform: translateY(-1px);\n    transition: all 0.2s ease;\n  }\n  \n  .dark [data-state=\"unchecked\"][role=\"switch\"]:hover > span {\n    background-color: hsl(240, 5%, 70%) !important;\n  }\n\n  .bg-grid-slate-200 {\n    background-image: radial-gradient(circle, rgb(226 232 240 / 0.5) 1px, transparent 1px);\n    background-size: 20px 20px;\n  }\n\n  .bg-grid-slate-800 {\n    background-image: radial-gradient(circle, rgb(30 41 59 / 0.5) 1px, transparent 1px);\n    background-size: 20px 20px;\n  }\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n::-webkit-scrollbar-track {\n  background: var(--muted);\n}\n\n::-webkit-scrollbar-thumb {\n  background: var(--muted-foreground);\n  border-radius: 3px;\n  transition: background-color 0.2s ease;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: var(--foreground);\n}\n\n/* Dark theme improvements */\n.dark {\n  color-scheme: dark;\n}\n\n/* Smooth transitions for theme switching */\n* {\n  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;\n}\n\n/* Enhanced focus styles for dark theme */\n.dark .focus\\:ring-primary:focus {\n  --tw-ring-color: hsl(var(--primary) / 0.5);\n}\n\n/* Better shadow for dark theme */\n.dark .shadow-lg {\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);\n}\n\n.dark .shadow-xl {\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);\n}\n\n/* Enhanced hover effects for dark theme */\n.dark .hover\\:shadow-xl:hover {\n  box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.4), 0 15px 15px -5px rgba(0, 0, 0, 0.3);\n}\n\n/* ResizablePanel enhancements for dark theme */\n[data-panel-resize-handle-enabled=\"true\"]:hover {\n  background: var(--primary) !important;\n  opacity: 0.8;\n}\n\n[data-panel-resize-handle-enabled=\"true\"][data-panel-resize-handle-active=\"true\"] {\n  background: var(--primary) !important;\n  opacity: 1;\n}\n\n.dark [data-panel-resize-handle-enabled=\"true\"] {\n  background: hsl(var(--border));\n  box-shadow: 0 0 0 1px hsl(var(--border));\n}\n\n.dark [data-panel-resize-handle-enabled=\"true\"]:hover {\n  background: hsl(var(--primary) / 0.6) !important;\n  box-shadow: 0 0 0 1px hsl(var(--primary) / 0.8);\n}\n\n.dark [data-panel-resize-handle-enabled=\"true\"][data-panel-resize-handle-active=\"true\"] {\n  background: hsl(var(--primary)) !important;\n  box-shadow: 0 0 0 1px hsl(var(--primary)), 0 0 8px hsl(var(--primary) / 0.3);\n}\n\n/* Enhanced resize handle cursor */\n[data-panel-resize-handle-enabled=\"true\"] {\n  cursor: col-resize;\n  transition: all 0.2s ease;\n}\n\n[data-panel-resize-handle-enabled=\"true\"][data-panel-group-direction=\"vertical\"] {\n  cursor: row-resize;\n}\n\n/* Smooth panel transitions */\n[data-panel-group] > [data-panel] {\n  transition: flex-basis 0.2s ease;\n}\n\n/* Enhanced visual feedback for resize handles */\n[data-panel-resize-handle-enabled=\"true\"] {\n  position: relative;\n  isolation: isolate;\n}\n\n[data-panel-resize-handle-enabled=\"true\"]::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: transparent;\n  transition: background-color 0.15s ease;\n  z-index: -1;\n}\n\n[data-panel-resize-handle-enabled=\"true\"]:hover::before {\n  background: hsl(var(--primary) / 0.05);\n}\n\n.dark [data-panel-resize-handle-enabled=\"true\"]:hover::before {\n  background: hsl(var(--primary) / 0.1);\n}\n\n[data-panel-resize-handle-enabled=\"true\"][data-panel-resize-handle-active=\"true\"]::before {\n  background: hsl(var(--primary) / 0.15);\n  animation: pulse-resize 0.6s ease-in-out infinite alternate;\n}\n\n.dark [data-panel-resize-handle-enabled=\"true\"][data-panel-resize-handle-active=\"true\"]::before {\n  background: hsl(var(--primary) / 0.2);\n}\n\n/* Pulse animation for active resize handles */\n@keyframes pulse-resize {\n  from {\n    background: hsl(var(--primary) / 0.1);\n  }\n  to {\n    background: hsl(var(--primary) / 0.25);\n  }\n}\n\n/* Connection line animations */\n@keyframes dash {\n  0% { stroke-dashoffset: 0; }\n  100% { stroke-dashoffset: -20; }\n}\n\n@keyframes connection-pulse {\n  0%, 100% { opacity: 0.3; }\n  50% { opacity: 1; }\n}\n\n@keyframes connection-glow {\n  0% { filter: drop-shadow(0 0 2px hsl(var(--primary) / 0.3)); }\n  50% { filter: drop-shadow(0 0 8px hsl(var(--primary) / 0.6)); }\n  100% { filter: drop-shadow(0 0 2px hsl(var(--primary) / 0.3)); }\n}\n\n/* Glow effect for dark theme */\n.dark [data-panel-resize-handle-enabled=\"true\"][data-panel-resize-handle-active=\"true\"] {\n  box-shadow: \n    0 0 0 1px hsl(var(--primary)), \n    0 0 8px hsl(var(--primary) / 0.3),\n    0 0 16px hsl(var(--primary) / 0.1);\n}\n\n/* Improved handle visibility in dark theme */\n.dark [data-panel-resize-handle-enabled=\"true\"] .grip-handle {\n  background: hsl(var(--muted));\n  border: 1px solid hsl(var(--border));\n}\n\n.dark [data-panel-resize-handle-enabled=\"true\"]:hover .grip-handle {\n  background: hsl(var(--muted-foreground) / 0.1);\n  border-color: hsl(var(--primary) / 0.5);\n  box-shadow: 0 2px 4px hsl(var(--background) / 0.1);\n}\n\n/* Smooth resize cursor transitions */\nbody {\n  cursor-transition: cursor 0.1s ease;\n}\n\n/* Panel borders enhancement for dark theme */\n.dark [data-panel-group] {\n  border-color: hsl(var(--border));\n}\n\n/* Responsive resize handles */\n@media (max-width: 768px) {\n  [data-panel-resize-handle-enabled=\"true\"] {\n    width: 8px !important;\n  }\n  \n  [data-panel-resize-handle-enabled=\"true\"][data-panel-group-direction=\"vertical\"] {\n    height: 8px !important;\n  }\n  \n  .grip-handle {\n    width: 20px !important;\n    height: 24px !important;\n  }\n}\n\n/* Empty State Enhancements for Dark Theme */\n.empty-state-icon {\n  position: relative;\n  transition: transform 0.3s ease;\n}\n\n.empty-state-icon:hover {\n  transform: scale(1.05);\n}\n\n.empty-state-icon::before {\n  content: '';\n  position: absolute;\n  inset: -4px;\n  background: linear-gradient(45deg, transparent, hsl(var(--primary) / 0.1), transparent);\n  border-radius: inherit;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  z-index: -1;\n}\n\n.empty-state-icon:hover::before {\n  opacity: 1;\n}\n\n/* Dark theme specific enhancements for empty state */\n.dark .empty-state-container {\n  background: linear-gradient(135deg, hsl(var(--background)) 0%, hsl(var(--muted) / 0.3) 100%);\n}\n\n.dark .empty-state-icon-bg {\n  background: linear-gradient(135deg, hsl(var(--muted) / 0.4) 0%, hsl(var(--muted) / 0.6) 100%);\n  border: 1px solid hsl(var(--border));\n  box-shadow: \n    0 4px 6px -1px hsl(var(--background) / 0.1),\n    0 2px 4px -1px hsl(var(--background) / 0.06);\n}\n\n.dark .empty-state-tip {\n  background: hsl(var(--muted) / 0.2);\n  border: 1px solid hsl(var(--border) / 0.5);\n  border-radius: 6px;\n  padding: 8px 12px;\n  transition: all 0.2s ease;\n}\n\n.dark .empty-state-tip:hover {\n  background: hsl(var(--muted) / 0.3);\n  border-color: hsl(var(--primary) / 0.3);\n  transform: translateY(-1px);\n}\n\n/* Floating animation for tips */\n.floating-tip {\n  animation: float 3s ease-in-out infinite;\n}\n\n.floating-tip:nth-child(2) {\n  animation-delay: 1.5s;\n}\n\n@keyframes float {\n  0%, 100% {\n    transform: translateY(0px);\n  }\n  50% {\n    transform: translateY(-2px);\n  }\n}\n\n/* Gradient text effect for dark theme */\n.dark .gradient-text {\n  background: linear-gradient(135deg, hsl(var(--foreground)) 0%, hsl(var(--muted-foreground)) 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n/* Enhanced pulse animation for dark theme */\n.dark .pulse-primary {\n  animation: pulse-primary-dark 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse-primary-dark {\n  0%, 100% {\n    opacity: 0.3;\n    transform: scale(1);\n  }\n  50% {\n    opacity: 0.6;\n    transform: scale(1.05);\n  }\n}\n\n/* Canvas Theme Support */\n.bg-canvas-bg {\n  background: linear-gradient(135deg, \n    hsl(var(--muted) / 0.1) 0%, \n    hsl(var(--muted) / 0.3) 25%, \n    hsl(var(--muted) / 0.1) 50%, \n    hsl(var(--muted) / 0.4) 75%, \n    hsl(var(--muted) / 0.2) 100%\n  );\n}\n\n.dark .bg-canvas-bg {\n  background: \n    radial-gradient(ellipse at top left, hsl(var(--primary) / 0.03) 0%, transparent 50%),\n    radial-gradient(ellipse at bottom right, hsl(var(--primary) / 0.02) 0%, transparent 50%),\n    linear-gradient(135deg, \n      hsl(var(--background)) 0%, \n      hsl(var(--surface-1)) 20%, \n      hsl(var(--background)) 40%, \n      hsl(var(--surface-2)) 60%, \n      hsl(var(--surface-1)) 80%, \n      hsl(var(--background)) 100%\n    );\n  position: relative;\n  overflow: hidden;\n}\n\n.dark .bg-canvas-bg::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: \n    radial-gradient(circle at 20% 30%, hsl(var(--primary) / 0.08) 0%, transparent 30%),\n    radial-gradient(circle at 80% 70%, hsl(var(--primary) / 0.05) 0%, transparent 30%),\n    radial-gradient(circle at 40% 80%, hsl(var(--accent) / 0.03) 0%, transparent 25%);\n  pointer-events: none;\n  opacity: 0.6;\n  animation: canvas-ambient 20s ease-in-out infinite alternate;\n}\n\n@keyframes canvas-ambient {\n  0% {\n    opacity: 0.4;\n    transform: scale(1) rotate(0deg);\n  }\n  50% {\n    opacity: 0.7;\n    transform: scale(1.05) rotate(1deg);\n  }\n  100% {\n    opacity: 0.6;\n    transform: scale(1.02) rotate(-0.5deg);\n  }\n}\n\n/* Enhanced Canvas Drop Zone Hint for Dark Theme */\n.dark .canvas-drop-hint {\n  background: \n    linear-gradient(135deg, \n      hsl(var(--card) / 0.85) 0%, \n      hsl(var(--surface-1) / 0.9) 100%\n    ),\n    radial-gradient(ellipse at center, \n      hsl(var(--primary) / 0.02) 0%, \n      transparent 70%\n    );\n  border: 2px dashed hsl(var(--border) / 0.5);\n  position: relative;\n  overflow: hidden;\n  backdrop-filter: blur(20px);\n  box-shadow: \n    0 20px 25px -5px hsl(var(--background) / 0.15),\n    0 10px 10px -5px hsl(var(--background) / 0.08),\n    inset 0 1px 0 hsl(var(--muted) / 0.15);\n  animation: drop-hint-pulse 3s ease-in-out infinite;\n}\n\n.dark .canvas-drop-hint::before {\n  content: '';\n  position: absolute;\n  inset: -2px;\n  background: linear-gradient(45deg, \n    transparent 0%, \n    hsl(var(--primary) / 0.1) 25%, \n    transparent 50%, \n    hsl(var(--primary) / 0.08) 75%, \n    transparent 100%\n  );\n  border-radius: inherit;\n  z-index: -1;\n  animation: border-glow 4s ease-in-out infinite alternate;\n}\n\n.dark .canvas-drop-hint:hover {\n  background: \n    linear-gradient(135deg, \n      hsl(var(--primary) / 0.1) 0%, \n      hsl(var(--surface-2) / 0.95) 50%, \n      hsl(var(--card) / 0.9) 100%\n    ),\n    radial-gradient(ellipse at center, \n      hsl(var(--primary) / 0.05) 0%, \n      transparent 60%\n    );\n  border-color: hsl(var(--primary) / 0.6);\n  transform: translateY(-2px) scale(1.02);\n  box-shadow: \n    0 32px 40px -12px hsl(var(--background) / 0.25),\n    0 16px 20px -8px hsl(var(--background) / 0.15),\n    inset 0 2px 0 hsl(var(--primary) / 0.2),\n    0 0 0 1px hsl(var(--primary) / 0.2),\n    0 0 20px hsl(var(--primary) / 0.1);\n  animation: drop-hint-hover 2s ease-in-out infinite alternate;\n}\n\n/* Canvas Drop Zone Icon Enhancement */\n.dark .canvas-drop-icon {\n  background: linear-gradient(135deg, \n    hsl(var(--muted) / 0.3) 0%, \n    hsl(var(--muted) / 0.15) 100%\n  );\n  border: 1px solid hsl(var(--border) / 0.3);\n  transition: all 0.3s ease;\n}\n\n.dark .canvas-drop-hint:hover .canvas-drop-icon {\n  background: linear-gradient(135deg, \n    hsl(var(--primary) / 0.2) 0%, \n    hsl(var(--primary) / 0.1) 100%\n  );\n  border-color: hsl(var(--primary) / 0.3);\n  transform: scale(1.05);\n}\n\n.dark .canvas-drop-icon i {\n  transition: all 0.3s ease;\n}\n\n.dark .canvas-drop-hint:hover .canvas-drop-icon i {\n  color: hsl(var(--primary));\n  transform: scale(1.1);\n}\n\n/* Enhanced Canvas Grid Pattern for Dark Theme */\n.dark .canvas-grid {\n  background-image: \n    radial-gradient(circle, hsl(var(--primary) / 0.15) 1px, transparent 1px),\n    linear-gradient(hsl(var(--muted-foreground) / 0.06) 1px, transparent 1px),\n    linear-gradient(90deg, hsl(var(--muted-foreground) / 0.06) 1px, transparent 1px) !important;\n  position: relative;\n  transition: all 0.3s ease;\n}\n\n.dark .canvas-grid::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: \n    radial-gradient(circle at 25% 25%, hsl(var(--primary) / 0.04) 0%, transparent 40%),\n    radial-gradient(circle at 75% 75%, hsl(var(--primary) / 0.03) 0%, transparent 40%),\n    conic-gradient(from 45deg at 50% 50%, \n      transparent 0deg, \n      hsl(var(--primary) / 0.01) 90deg, \n      transparent 180deg, \n      hsl(var(--primary) / 0.01) 270deg, \n      transparent 360deg\n    );\n  pointer-events: none;\n  opacity: 0.8;\n  animation: grid-shimmer 15s ease-in-out infinite alternate;\n}\n\n.dark .canvas-grid::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: \n    linear-gradient(45deg, \n      transparent 0%, \n      hsl(var(--muted) / 0.02) 25%, \n      transparent 50%, \n      hsl(var(--muted) / 0.015) 75%, \n      transparent 100%\n    ),\n    linear-gradient(-45deg, \n      transparent 0%, \n      hsl(var(--primary) / 0.01) 25%, \n      transparent 50%, \n      hsl(var(--primary) / 0.008) 75%, \n      transparent 100%\n    );\n  pointer-events: none;\n  opacity: 0.6;\n  animation: grid-overlay 12s ease-in-out infinite alternate-reverse;\n}\n\n@keyframes grid-shimmer {\n  0% {\n    opacity: 0.6;\n    transform: scale(1) translateX(0);\n  }\n  50% {\n    opacity: 0.9;\n    transform: scale(1.01) translateX(2px);\n  }\n  100% {\n    opacity: 0.8;\n    transform: scale(1.005) translateX(-1px);\n  }\n}\n\n@keyframes grid-overlay {\n  0% {\n    opacity: 0.4;\n    transform: translateY(0) rotate(0deg);\n  }\n  50% {\n    opacity: 0.7;\n    transform: translateY(1px) rotate(0.2deg);\n  }\n  100% {\n    opacity: 0.6;\n    transform: translateY(-0.5px) rotate(-0.1deg);\n  }\n}\n\n/* Dark Theme Drag Over State Enhancement */\n.dark .canvas-grid[data-drag-over=\"true\"] {\n  background-color: hsl(var(--primary) / 0.08) !important;\n  background-image: \n    radial-gradient(circle, hsl(var(--primary) / 0.4) 1px, transparent 1px),\n    linear-gradient(hsl(var(--primary) / 0.15) 1px, transparent 1px),\n    linear-gradient(90deg, hsl(var(--primary) / 0.15) 1px, transparent 1px) !important;\n  box-shadow: \n    inset 0 0 30px hsl(var(--primary) / 0.2),\n    inset 0 0 60px hsl(var(--primary) / 0.1);\n  animation: pulse-grid-dark 1.5s ease-in-out infinite alternate;\n}\n\n@keyframes pulse-grid-dark {\n  from {\n    opacity: 0.8;\n    box-shadow: \n      inset 0 0 30px hsl(var(--primary) / 0.2),\n      inset 0 0 60px hsl(var(--primary) / 0.1);\n  }\n  to {\n    opacity: 1;\n    box-shadow: \n      inset 0 0 40px hsl(var(--primary) / 0.25),\n      inset 0 0 80px hsl(var(--primary) / 0.15);\n  }\n}\n\n/* Canvas Controls Dark Theme Enhancement */\n.dark .canvas-controls {\n  animation: controls-fade-in 0.8s ease-out;\n}\n\n.dark .canvas-controls button {\n  background: \n    linear-gradient(135deg, \n      hsl(var(--card) / 0.95) 0%, \n      hsl(var(--surface-1) / 0.9) 100%\n    );\n  backdrop-filter: blur(16px);\n  border: 1px solid hsl(var(--border) / 0.4);\n  position: relative;\n  overflow: hidden;\n  box-shadow: \n    0 4px 6px -1px hsl(var(--background) / 0.1),\n    0 2px 4px -1px hsl(var(--background) / 0.06),\n    inset 0 1px 0 hsl(var(--muted) / 0.1);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.dark .canvas-controls button::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(45deg, \n    transparent 0%, \n    hsl(var(--primary) / 0.1) 50%, \n    transparent 100%\n  );\n  transform: translateX(-100%);\n  transition: transform 0.6s ease;\n}\n\n.dark .canvas-controls button:hover::before {\n  transform: translateX(100%);\n}\n\n.dark .canvas-controls button:hover {\n  background: \n    linear-gradient(135deg, \n      hsl(var(--primary) / 0.15) 0%, \n      hsl(var(--surface-2) / 0.8) 100%\n    );\n  border-color: hsl(var(--primary) / 0.5);\n  transform: translateY(-1px);\n  box-shadow: \n    0 10px 15px -3px hsl(var(--background) / 0.2),\n    0 4px 6px -2px hsl(var(--background) / 0.1),\n    inset 0 1px 0 hsl(var(--primary) / 0.2),\n    0 0 0 1px hsl(var(--primary) / 0.3);\n}\n\n.dark .canvas-controls button:active {\n  transform: translateY(0);\n  box-shadow: \n    0 4px 6px -1px hsl(var(--background) / 0.1),\n    0 2px 4px -1px hsl(var(--background) / 0.06),\n    inset 0 2px 4px hsl(var(--background) / 0.1);\n}\n\n.dark .canvas-controls .zoom-indicator {\n  background: \n    linear-gradient(135deg, \n      hsl(var(--muted) / 0.3) 0%, \n      hsl(var(--surface-1) / 0.4) 100%\n    );\n  border-color: hsl(var(--border) / 0.3);\n  color: hsl(var(--primary));\n  font-weight: 600;\n  position: relative;\n  overflow: hidden;\n}\n\n.dark .canvas-controls .zoom-indicator::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(90deg, \n    transparent 0%, \n    hsl(var(--primary) / 0.1) 50%, \n    transparent 100%\n  );\n  transform: translateX(-100%);\n  transition: transform 0.4s ease;\n}\n\n.dark .canvas-controls:hover .zoom-indicator::after {\n  animation: zoom-shimmer 2s ease-in-out infinite;\n}\n\n@keyframes controls-fade-in {\n  from {\n    opacity: 0;\n    transform: translateY(-10px) scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n@keyframes zoom-shimmer {\n  0%, 100% {\n    transform: translateX(-100%);\n  }\n  50% {\n    transform: translateX(100%);\n  }\n}\n\n/* Drop Hint Animations */\n@keyframes drop-hint-pulse {\n  0%, 100% {\n    border-color: hsl(var(--border) / 0.5);\n    box-shadow: \n      0 20px 25px -5px hsl(var(--background) / 0.15),\n      0 10px 10px -5px hsl(var(--background) / 0.08),\n      inset 0 1px 0 hsl(var(--muted) / 0.15);\n  }\n  50% {\n    border-color: hsl(var(--primary) / 0.3);\n    box-shadow: \n      0 24px 30px -6px hsl(var(--background) / 0.18),\n      0 12px 12px -6px hsl(var(--background) / 0.1),\n      inset 0 1px 0 hsl(var(--primary) / 0.1),\n      0 0 0 1px hsl(var(--primary) / 0.1);\n  }\n}\n\n@keyframes border-glow {\n  0% {\n    opacity: 0.3;\n    transform: scale(1);\n  }\n  100% {\n    opacity: 0.6;\n    transform: scale(1.02);\n  }\n}\n\n@keyframes drop-hint-hover {\n  0% {\n    box-shadow: \n      0 32px 40px -12px hsl(var(--background) / 0.25),\n      0 16px 20px -8px hsl(var(--background) / 0.15),\n      inset 0 2px 0 hsl(var(--primary) / 0.2),\n      0 0 0 1px hsl(var(--primary) / 0.2),\n      0 0 20px hsl(var(--primary) / 0.1);\n  }\n  100% {\n    box-shadow: \n      0 36px 45px -14px hsl(var(--background) / 0.3),\n      0 18px 24px -10px hsl(var(--background) / 0.18),\n      inset 0 3px 0 hsl(var(--primary) / 0.25),\n      0 0 0 2px hsl(var(--primary) / 0.25),\n      0 0 30px hsl(var(--primary) / 0.15);\n  }\n}\n\n/* Enhanced Canvas Node Interactions for Dark Theme */\n.dark .canvas-grid .canvas-node {\n  filter: drop-shadow(0 4px 8px hsl(var(--background) / 0.2));\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.dark .canvas-grid .canvas-node:hover {\n  filter: drop-shadow(0 8px 16px hsl(var(--background) / 0.3));\n  transform: translateY(-1px);\n}\n\n/* Canvas Cursor States */\n.dark .canvas-grid {\n  cursor: crosshair;\n}\n\n.dark .canvas-grid[data-drag-over=\"true\"] {\n  cursor: copy;\n}\n\n/* Advanced Settings Enhanced Theme Support */\n.advanced-settings-container {\n  background: linear-gradient(135deg, \n    hsl(var(--background)) 0%, \n    hsl(var(--muted) / 0.1) 100%\n  );\n  border: 1px solid hsl(var(--border) / 0.5);\n  border-radius: 0.5rem;\n  transition: all 0.3s ease;\n}\n\n.dark .advanced-settings-container {\n  background: linear-gradient(135deg, \n    hsl(var(--background)) 0%, \n    hsl(var(--muted) / 0.05) 100%\n  );\n  border: 1px solid hsl(var(--border) / 0.3);\n  box-shadow: \n    0 4px 6px -1px hsl(var(--background) / 0.1),\n    0 2px 4px -1px hsl(var(--background) / 0.06),\n    inset 0 1px 0 hsl(var(--muted) / 0.1);\n}\n\n/* Setting Item Enhanced Styling */\n.setting-item {\n  background: hsl(var(--card) / 0.5);\n  border: 1px solid hsl(var(--border) / 0.5);\n  border-radius: 0.5rem;\n  padding: 0.75rem;\n  transition: all 0.2s ease;\n  position: relative;\n  overflow: hidden;\n}\n\n.setting-item::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, transparent 0%, hsl(var(--primary) / 0.02) 100%);\n  opacity: 0;\n  transition: opacity 0.2s ease;\n  pointer-events: none;\n}\n\n.setting-item:hover::before {\n  opacity: 1;\n}\n\n.dark .setting-item {\n  background: hsl(var(--card) / 0.3);\n  border: 1px solid hsl(var(--border) / 0.4);\n  box-shadow: \n    0 1px 3px 0 hsl(var(--background) / 0.1),\n    0 1px 2px 0 hsl(var(--background) / 0.06);\n}\n\n.dark .setting-item:hover {\n  background: hsl(var(--card) / 0.6);\n  border-color: hsl(var(--primary) / 0.3);\n  box-shadow: \n    0 4px 6px -1px hsl(var(--background) / 0.1),\n    0 2px 4px -1px hsl(var(--background) / 0.06),\n    0 0 0 1px hsl(var(--primary) / 0.1);\n}\n\n/* Enhanced Switch Styling for Dark Theme */\n.dark [role=\"switch\"][data-state=\"checked\"] {\n  background: hsl(var(--primary));\n  border: 3px solid hsl(var(--primary));\n  box-shadow: \n    0 0 0 2px hsl(var(--background)),\n    0 0 0 4px hsl(var(--primary) / 0.5),\n    0 0 10px hsl(var(--primary) / 0.3),\n    0 2px 6px hsl(var(--background) / 0.2),\n    inset 0 1px 2px hsl(var(--primary) / 0.2);\n}\n\n.dark [role=\"switch\"][data-state=\"unchecked\"] {\n  background: hsl(var(--muted) / 0.3);\n  border: 3px solid hsl(var(--border) / 0.8);\n  box-shadow: \n    0 0 0 2px hsl(var(--border) / 0.4),\n    0 2px 4px hsl(var(--background) / 0.3),\n    inset 0 1px 2px hsl(var(--muted) / 0.3);\n}\n\n.dark [role=\"switch\"]:hover {\n  transform: scale(1.05);\n  box-shadow: \n    0 0 0 3px hsl(var(--background)),\n    0 0 0 6px hsl(var(--ring) / 0.3),\n    0 4px 8px hsl(var(--background) / 0.2);\n  transition: all 0.2s ease;\n}\n\n.dark [role=\"switch\"][data-state=\"checked\"]:hover {\n  box-shadow: \n    0 0 0 3px hsl(var(--background)),\n    0 0 0 6px hsl(var(--primary) / 0.5),\n    0 0 15px hsl(var(--primary) / 0.4),\n    0 4px 8px hsl(var(--background) / 0.2);\n}\n\n/* Enhanced Switch Thumb Styling for Dark Theme */\n.dark [role=\"switch\"] [data-state=\"checked\"] {\n  background: hsl(var(--primary-foreground));\n  border: 2px solid hsl(var(--primary-foreground));\n  box-shadow: \n    0 0 0 1px hsl(var(--primary)),\n    0 0 8px hsl(var(--primary) / 0.4),\n    0 3px 6px hsl(var(--background) / 0.3);\n}\n\n.dark [role=\"switch\"] [data-state=\"unchecked\"] {\n  background: hsl(var(--background));\n  border: 2px solid hsl(var(--muted-foreground) / 0.6);\n  box-shadow: \n    0 0 0 1px hsl(var(--border)),\n    0 3px 6px hsl(var(--background) / 0.4),\n    0 0 4px hsl(var(--muted) / 0.3);\n}\n\n/* Enhanced Checkbox Styling for Dark Theme */\n.dark input[type=\"checkbox\"] {\n  appearance: none;\n  width: 1.2rem;\n  height: 1.2rem;\n  border: 3px solid hsl(var(--border) / 0.8);\n  border-radius: 0.375rem;\n  background: hsl(var(--background));\n  position: relative;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  box-shadow: \n    0 0 0 1px hsl(var(--border) / 0.4),\n    0 2px 4px hsl(var(--background) / 0.3),\n    inset 0 1px 2px hsl(var(--muted) / 0.2);\n}\n\n.dark input[type=\"checkbox\"]:hover {\n  border-color: hsl(var(--primary) / 0.8);\n  box-shadow: \n    0 0 0 3px hsl(var(--primary) / 0.3),\n    0 0 8px hsl(var(--primary) / 0.2),\n    0 2px 4px hsl(var(--background) / 0.3);\n  transform: scale(1.08);\n}\n\n.dark input[type=\"checkbox\"]:checked {\n  background: hsl(var(--primary));\n  border-color: hsl(var(--primary));\n  box-shadow: \n    0 0 0 3px hsl(var(--primary) / 0.4),\n    0 0 10px hsl(var(--primary) / 0.3),\n    0 2px 6px hsl(var(--background) / 0.3),\n    inset 0 1px 2px hsl(var(--primary) / 0.2);\n}\n\n.dark input[type=\"checkbox\"]:checked::before {\n  content: '‚úì';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  color: hsl(var(--primary-foreground));\n  font-size: 0.875rem;\n  font-weight: 900;\n  line-height: 1;\n  text-shadow: 0 1px 2px hsl(var(--primary) / 0.3);\n}\n\n.dark input[type=\"checkbox\"]:focus {\n  outline: none;\n  box-shadow: \n    0 0 0 3px hsl(var(--ring) / 0.3),\n    0 0 0 6px hsl(var(--ring) / 0.15),\n    0 2px 4px hsl(var(--background) / 0.3);\n}\n\n.dark input[type=\"checkbox\"]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  filter: grayscale(0.5);\n}\n\n/* Enhanced Radix Checkbox Styling for Dark Theme */\n.dark [role=\"checkbox\"] {\n  border: 3px solid hsl(var(--border) / 0.8);\n  background: hsl(var(--background));\n  box-shadow: \n    0 0 0 1px hsl(var(--border) / 0.4),\n    0 2px 4px hsl(var(--background) / 0.3),\n    inset 0 1px 2px hsl(var(--muted) / 0.2);\n  transition: all 0.2s ease;\n}\n\n.dark [role=\"checkbox\"]:hover {\n  border-color: hsl(var(--primary) / 0.8);\n  box-shadow: \n    0 0 0 3px hsl(var(--primary) / 0.3),\n    0 0 8px hsl(var(--primary) / 0.2),\n    0 2px 4px hsl(var(--background) / 0.3);\n  transform: scale(1.08);\n}\n\n.dark [role=\"checkbox\"][data-state=\"checked\"] {\n  background: hsl(var(--primary));\n  border-color: hsl(var(--primary));\n  box-shadow: \n    0 0 0 3px hsl(var(--primary) / 0.4),\n    0 0 10px hsl(var(--primary) / 0.3),\n    0 2px 6px hsl(var(--background) / 0.3),\n    inset 0 1px 2px hsl(var(--primary) / 0.2);\n}\n\n.dark [role=\"checkbox\"][data-state=\"checked\"]:hover {\n  box-shadow: \n    0 0 0 3px hsl(var(--primary) / 0.5),\n    0 0 12px hsl(var(--primary) / 0.4),\n    0 2px 6px hsl(var(--background) / 0.3);\n}\n\n/* Enhanced Token Settings & Settings Panel Containers */\n.dark .toggle-container {\n  background: hsl(var(--card) / 0.4);\n  border: 2px solid hsl(var(--border) / 0.6);\n  border-radius: 0.75rem;\n  padding: 1rem;\n  box-shadow: \n    0 2px 4px hsl(var(--background) / 0.2),\n    0 0 0 1px hsl(var(--border) / 0.3),\n    inset 0 1px 2px hsl(var(--muted) / 0.1);\n}\n\n.dark .toggle-container:hover {\n  border-color: hsl(var(--primary) / 0.4);\n  box-shadow: \n    0 4px 8px hsl(var(--background) / 0.3),\n    0 0 0 2px hsl(var(--primary) / 0.2),\n    inset 0 1px 2px hsl(var(--muted) / 0.2);\n}\n\n/* Enhanced Labels for Toggle Items */\n.dark .toggle-label {\n  color: hsl(var(--foreground) / 0.9);\n  font-weight: 500;\n  text-shadow: 0 1px 2px hsl(var(--background) / 0.1);\n}\n\n.dark .toggle-description {\n  color: hsl(var(--muted-foreground) / 0.8);\n  font-size: 0.875rem;\n  text-shadow: 0 1px 1px hsl(var(--background) / 0.1);\n}\n\n/* Light Theme Enhancements for Checkboxes and Switches */\ninput[type=\"checkbox\"] {\n  appearance: none;\n  width: 1rem;\n  height: 1rem;\n  border: 2px solid hsl(var(--border));\n  border-radius: 0.25rem;\n  background: hsl(var(--background));\n  position: relative;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  box-shadow: \n    0 1px 2px hsl(var(--muted-foreground) / 0.1),\n    0 0 0 1px hsl(var(--border) / 0.3);\n}\n\ninput[type=\"checkbox\"]:hover {\n  border-color: hsl(var(--primary) / 0.6);\n  box-shadow: \n    0 0 0 2px hsl(var(--primary) / 0.2),\n    0 1px 2px hsl(var(--muted-foreground) / 0.1);\n  transform: scale(1.05);\n}\n\ninput[type=\"checkbox\"]:checked {\n  background: hsl(var(--primary));\n  border-color: hsl(var(--primary));\n  box-shadow: \n    0 0 0 2px hsl(var(--primary) / 0.3),\n    0 0 4px hsl(var(--primary) / 0.2),\n    0 1px 2px hsl(var(--muted-foreground) / 0.1);\n}\n\ninput[type=\"checkbox\"]:checked::before {\n  content: '‚úì';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  color: hsl(var(--primary-foreground));\n  font-size: 0.75rem;\n  font-weight: bold;\n  line-height: 1;\n}\n\ninput[type=\"checkbox\"]:focus {\n  outline: none;\n  box-shadow: \n    0 0 0 2px hsl(var(--ring) / 0.2),\n    0 0 0 4px hsl(var(--ring) / 0.1),\n    0 1px 2px hsl(var(--muted-foreground) / 0.1);\n}\n\n/* Enhanced Radix Checkbox Light Theme */\n[role=\"checkbox\"] {\n  border: 2px solid hsl(var(--border));\n  background: hsl(var(--background));\n  box-shadow: \n    0 1px 2px hsl(var(--muted-foreground) / 0.1),\n    0 0 0 1px hsl(var(--border) / 0.3);\n  transition: all 0.2s ease;\n}\n\n[role=\"checkbox\"]:hover {\n  border-color: hsl(var(--primary) / 0.6);\n  box-shadow: \n    0 0 0 2px hsl(var(--primary) / 0.2),\n    0 1px 2px hsl(var(--muted-foreground) / 0.1);\n  transform: scale(1.05);\n}\n\n[role=\"checkbox\"][data-state=\"checked\"] {\n  background: hsl(var(--primary));\n  border-color: hsl(var(--primary));\n  box-shadow: \n    0 0 0 2px hsl(var(--primary) / 0.3),\n    0 0 4px hsl(var(--primary) / 0.2),\n    0 1px 2px hsl(var(--muted-foreground) / 0.1);\n}\n\n[role=\"checkbox\"][data-state=\"checked\"]:hover {\n  box-shadow: \n    0 0 0 2px hsl(var(--primary) / 0.4),\n    0 0 6px hsl(var(--primary) / 0.3),\n    0 1px 2px hsl(var(--muted-foreground) / 0.1);\n}\n\n/* Enhanced Switch Light Theme */\n[role=\"switch\"][data-state=\"checked\"] {\n  background: hsl(var(--primary));\n  border: 2px solid hsl(var(--primary) / 0.3);\n  box-shadow: \n    0 0 0 2px hsl(var(--background)),\n    0 0 0 4px hsl(var(--primary) / 0.2),\n    0 2px 4px hsl(var(--muted-foreground) / 0.1);\n}\n\n[role=\"switch\"][data-state=\"unchecked\"] {\n  background: hsl(var(--input));\n  border: 2px solid hsl(var(--border));\n  box-shadow: \n    0 0 0 1px hsl(var(--border) / 0.5),\n    0 1px 2px hsl(var(--muted-foreground) / 0.1);\n}\n\n[role=\"switch\"]:hover {\n  transform: scale(1.02);\n  box-shadow: \n    0 0 0 2px hsl(var(--background)),\n    0 0 0 4px hsl(var(--ring) / 0.2),\n    0 2px 4px hsl(var(--muted-foreground) / 0.1);\n  transition: all 0.2s ease;\n}\n\n[role=\"switch\"][data-state=\"checked\"]:hover {\n  box-shadow: \n    0 0 0 2px hsl(var(--background)),\n    0 0 0 4px hsl(var(--primary) / 0.3),\n    0 0 8px hsl(var(--primary) / 0.2),\n    0 2px 4px hsl(var(--muted-foreground) / 0.1);\n}\n\n/* Accordion Enhanced Styling */\n.dark [data-state=\"open\"] > [data-orientation=\"horizontal\"] {\n  border-bottom-color: hsl(var(--border) / 0.5);\n}\n\n.dark [data-radix-accordion-trigger] {\n  transition: all 0.2s ease;\n}\n\n.dark [data-radix-accordion-trigger]:hover {\n  background: hsl(var(--muted) / 0.1);\n  border-radius: 0.25rem;\n}\n\n/* Enhanced Gradient Text for Dark Theme */\n.dark .gradient-command-text {\n  background: linear-gradient(135deg, \n    hsl(var(--foreground)) 0%, \n    hsl(var(--primary)) 50%, \n    hsl(var(--muted-foreground)) 100%\n  );\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n/* Setting Group Enhanced Styling */\n.setting-group {\n  background: linear-gradient(135deg, \n    hsl(var(--background)) 0%, \n    hsl(var(--muted) / 0.05) 100%\n  );\n  border: 1px solid hsl(var(--border) / 0.3);\n  border-radius: 0.5rem;\n  overflow: hidden;\n}\n\n.dark .setting-group {\n  background: linear-gradient(135deg, \n    hsl(var(--background)) 0%, \n    hsl(var(--muted) / 0.03) 100%\n  );\n  border: 1px solid hsl(var(--border) / 0.2);\n  box-shadow: \n    inset 0 1px 0 hsl(var(--muted) / 0.05),\n    0 1px 3px 0 hsl(var(--background) / 0.1);\n}\n\n/* Canvas Grid Enhancements */\n.canvas-grid {\n  position: relative;\n  transition: all 0.3s ease;\n}\n\n.canvas-grid::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: radial-gradient(circle at 50% 50%, \n    hsl(var(--primary) / 0.02) 0%, \n    transparent 50%\n  );\n  pointer-events: none;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.canvas-grid:hover::before {\n  opacity: 1;\n}\n\n.dark .canvas-grid {\n  background-image: \n    radial-gradient(circle, hsl(var(--muted-foreground) / 0.25) 1px, transparent 1px),\n    linear-gradient(hsl(var(--muted-foreground) / 0.05) 1px, transparent 1px),\n    linear-gradient(90deg, hsl(var(--muted-foreground) / 0.05) 1px, transparent 1px) !important;\n}\n\n/* Canvas Controls Enhancements */\n.canvas-controls {\n  animation: slideInFromTop 0.5s ease-out;\n}\n\n@keyframes slideInFromTop {\n  from {\n    opacity: 0;\n    transform: translateY(-20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.dark .canvas-controls button {\n  background: hsl(var(--background) / 0.9);\n  backdrop-filter: blur(10px);\n  border: 1px solid hsl(var(--border) / 0.7);\n  box-shadow: \n    0 4px 6px -1px hsl(var(--background) / 0.1),\n    0 2px 4px -1px hsl(var(--background) / 0.06),\n    inset 0 1px 0 hsl(var(--foreground) / 0.1);\n}\n\n.dark .canvas-controls button:hover {\n  background: hsl(var(--muted) / 0.8);\n  border-color: hsl(var(--primary) / 0.5);\n  box-shadow: \n    0 8px 10px -2px hsl(var(--background) / 0.15),\n    0 4px 6px -1px hsl(var(--background) / 0.1),\n    inset 0 1px 0 hsl(var(--foreground) / 0.15);\n}\n\n/* Modern Canvas Grid Styles */\n.canvas-grid-modern {\n  position: relative;\n  transition: all 0.3s ease;\n}\n\n.canvas-grid-modern[data-drag-over=\"true\"] {\n  background-color: rgba(59, 130, 246, 0.05) !important;\n  background-image: \n    radial-gradient(circle at 1px 1px, rgba(59, 130, 246, 0.4) 1px, transparent 0),\n    linear-gradient(90deg, rgba(59, 130, 246, 0.2) 1px, transparent 1px),\n    linear-gradient(rgba(59, 130, 246, 0.2) 1px, transparent 1px) !important;\n  box-shadow: inset 0 0 60px rgba(59, 130, 246, 0.1);\n}\n\n/* Dark theme canvas styles */\n.dark .canvas-grid-modern {\n  background-image: \n    radial-gradient(circle at 1px 1px, rgba(99, 102, 241, 0.2) 1px, transparent 0),\n    linear-gradient(90deg, rgba(100, 116, 139, 0.15) 1px, transparent 1px),\n    linear-gradient(rgba(100, 116, 139, 0.15) 1px, transparent 1px) !important;\n}\n\n.dark .canvas-grid-modern[data-drag-over=\"true\"] {\n  background-color: rgba(99, 102, 241, 0.08) !important;\n  background-image: \n    radial-gradient(circle at 1px 1px, rgba(99, 102, 241, 0.5) 1px, transparent 0),\n    linear-gradient(90deg, rgba(99, 102, 241, 0.25) 1px, transparent 1px),\n    linear-gradient(rgba(99, 102, 241, 0.25) 1px, transparent 1px) !important;\n  box-shadow: inset 0 0 80px rgba(99, 102, 241, 0.15);\n}\n\n/* Enhanced shadows for modern look */\n.shadow-3xl {\n  box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.25), 0 0 40px rgba(59, 130, 246, 0.1);\n}\n\n/* Modern canvas node shadows */\n.canvas-node-modern {\n  filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.1)) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.06));\n}\n\n.dark .canvas-node-modern {\n  filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.4)) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));\n}\n\n/* Canvas Zoom Indicator */\n.zoom-indicator {\n  position: relative;\n  overflow: hidden;\n}\n\n.zoom-indicator::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(90deg, \n    transparent 0%, \n    hsl(var(--primary) / 0.1) 50%, \n    transparent 100%\n  );\n  transform: translateX(-100%);\n  transition: transform 0.3s ease;\n}\n\n.zoom-indicator:hover::after {\n  transform: translateX(100%);\n}\n\n/* Canvas Selection Area */\n.canvas-selection {\n  position: absolute;\n  border: 2px dashed hsl(var(--primary));\n  background: hsl(var(--primary) / 0.1);\n  border-radius: 4px;\n  pointer-events: none;\n  animation: dash-border 1s linear infinite;\n}\n\n/* Enhanced Zoom Controls */\n.zoom-controls {\n  position: relative;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.zoom-controls:hover {\n  transform: scale(1.02);\n  box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.25);\n}\n\n.zoom-indicator {\n  position: relative;\n  overflow: hidden;\n  font-variant-numeric: tabular-nums;\n  transition: all 0.3s ease;\n}\n\n.zoom-indicator:hover {\n  background: linear-gradient(135deg, \n    hsl(var(--primary) / 0.1) 0%, \n    hsl(var(--primary) / 0.05) 100%\n  );\n  color: hsl(var(--primary));\n}\n\n.zoom-indicator::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(90deg, \n    transparent 0%, \n    hsl(var(--primary) / 0.1) 50%, \n    transparent 100%\n  );\n  transform: translateX(-100%);\n  transition: transform 0.4s ease;\n}\n\n.zoom-indicator:hover::before {\n  transform: translateX(100%);\n}\n\n/* Zoom Button States */\n.zoom-button {\n  position: relative;\n  overflow: hidden;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.zoom-button:hover {\n  background: linear-gradient(135deg, \n    hsl(var(--primary) / 0.1) 0%, \n    hsl(var(--primary) / 0.05) 100%\n  );\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px -2px hsl(var(--primary) / 0.3);\n}\n\n.zoom-button:active {\n  transform: translateY(0);\n  box-shadow: 0 2px 8px -2px hsl(var(--primary) / 0.3);\n}\n\n.zoom-button:disabled {\n  opacity: 0.4;\n  transform: none;\n  box-shadow: none;\n}\n\n.zoom-button::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(45deg, \n    transparent 0%, \n    hsl(var(--primary) / 0.1) 50%, \n    transparent 100%\n  );\n  transform: translateX(-100%);\n  transition: transform 0.6s ease;\n}\n\n.zoom-button:hover::before {\n  transform: translateX(100%);\n}\n\n/* Canvas Cursor States */\n.canvas-panning {\n  cursor: grabbing !important;\n}\n\n.canvas-panning * {\n  cursor: grabbing !important;\n}\n\n.canvas-zoom-cursor {\n  cursor: zoom-in;\n}\n\n.canvas-zoom-cursor.zoomed-in {\n  cursor: zoom-out;\n}\n\n/* Smooth Zoom Animation */\n.canvas-transform {\n  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.canvas-transform.fast {\n  transition: transform 0.1s ease-out;\n}\n\n/* Fit to Content Animation */\n@keyframes fit-content {\n  0% {\n    opacity: 0.8;\n    transform: scale(1.05);\n  }\n  50% {\n    opacity: 0.9;\n    transform: scale(0.95);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n.canvas-fit-animation {\n  animation: fit-content 0.8s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n/* Grid Background Zoom Effects */\n.canvas-grid-zoomed {\n  background-attachment: fixed;\n  background-repeat: repeat;\n}\n\n.canvas-grid-zoomed::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: radial-gradient(circle at 50% 50%, \n    hsl(var(--primary) / 0.03) 0%, \n    transparent 50%\n  );\n  pointer-events: none;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.canvas-grid-zoomed:hover::before {\n  opacity: 1;\n}\n\n/* Minimap Styles */\n.canvas-minimap {\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n  width: 200px;\n  height: 150px;\n  background: hsl(var(--card) / 0.9);\n  border: 1px solid hsl(var(--border));\n  border-radius: 8px;\n  backdrop-filter: blur(8px);\n  overflow: hidden;\n  transition: all 0.3s ease;\n}\n\n.canvas-minimap:hover {\n  transform: scale(1.1);\n  box-shadow: 0 8px 24px -4px rgba(0, 0, 0, 0.15);\n}\n\n.canvas-minimap-viewport {\n  position: absolute;\n  border: 2px solid hsl(var(--primary));\n  background: hsl(var(--primary) / 0.1);\n  cursor: move;\n  transition: all 0.2s ease;\n}\n\n.canvas-minimap-viewport:hover {\n  background: hsl(var(--primary) / 0.2);\n  border-color: hsl(var(--primary) / 0.8);\n}\n\n@keyframes dash-border {\n  to {\n    stroke-dashoffset: 20;\n  }\n}\n\n.dark .canvas-selection {\n  border-color: hsl(var(--primary) / 0.8);\n  background: hsl(var(--primary) / 0.15);\n  box-shadow: 0 0 10px hsl(var(--primary) / 0.3);\n}\n\n/* Live Preview Styles for Rich Text Editor */\n.live-preview-code {\n  background-color: rgba(255, 255, 255, 0.8);\n  color: #1f2937;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace;\n  font-size: 0.85em;\n  border: 1px solid rgba(255, 255, 255, 0.6);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n\n.dark .live-preview-code {\n  background-color: rgba(0, 0, 0, 0.3);\n  color: #f1f5f9;\n  border-color: rgba(255, 255, 255, 0.1);\n}\n\n.live-preview-bold {\n  font-weight: 700;\n  color: inherit;\n}\n\n.live-preview-italic {\n  font-style: italic;\n  color: inherit;\n}\n\n.live-preview-underline {\n  text-decoration: underline;\n  color: inherit;\n}\n\n.live-preview-strikethrough {\n  text-decoration: line-through;\n  color: inherit;\n}\n\n/* Inline Rich Editor Styles */\n.inline-format-bold {\n  font-weight: 700;\n  color: #1e40af;\n}\n\n.dark .inline-format-bold {\n  color: #60a5fa;\n}\n\n.inline-format-italic {\n  font-style: italic;\n  color: #7c3aed;\n}\n\n.dark .inline-format-italic {\n  color: #a78bfa;\n}\n\n.inline-format-underline {\n  text-decoration: underline;\n  color: #059669;\n}\n\n.dark .inline-format-underline {\n  color: #34d399;\n}\n\n.inline-format-strikethrough {\n  text-decoration: line-through;\n  color: #dc2626;\n}\n\n.dark .inline-format-strikethrough {\n  color: #f87171;\n}\n\n.inline-format-code {\n  background-color: #f1f5f9;\n  color: #475569;\n  padding: 2px 4px;\n  border-radius: 3px;\n  font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace;\n  font-size: 0.9em;\n  border: 1px solid #e2e8f0;\n}\n\n.dark .inline-format-code {\n  background-color: #334155;\n  color: #cbd5e1;\n  border-color: #475569;\n}\n\n.inline-format-pre {\n  background-color: #f8fafc;\n  color: #334155;\n  padding: 8px;\n  border-radius: 4px;\n  font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace;\n  white-space: pre-wrap;\n  margin: 8px 0;\n  border: 1px solid #e2e8f0;\n  display: block;\n}\n\n.dark .inline-format-pre {\n  background-color: #1e293b;\n  color: #e2e8f0;\n  border-color: #334155;\n}\n\n.inline-format-link {\n  color: #2563eb;\n  text-decoration: underline;\n}\n\n.dark .inline-format-link {\n  color: #3b82f6;\n}\n\n.inline-format-quote {\n  border-left: 4px solid #e2e8f0;\n  padding-left: 12px;\n  margin: 8px 0;\n  color: #64748b;\n  font-style: italic;\n  display: block;\n}\n\n.dark .inline-format-quote {\n  border-left-color: #334155;\n  color: #94a3b8;\n}\n\n.inline-format-heading {\n  font-size: 1.25rem;\n  font-weight: 600;\n  margin: 8px 0;\n  color: #1e293b;\n  display: block;\n}\n\n.dark .inline-format-heading {\n  color: #f1f5f9;\n}\n\n.live-preview-pre {\n  background-color: #f3f4f6;\n  color: #1f2937;\n  padding: 8px;\n  border-radius: 4px;\n  font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace;\n  white-space: pre-wrap;\n  margin: 8px 0;\n  border: 1px solid #e5e7eb;\n  overflow-x: auto;\n}\n\n.dark .live-preview-pre {\n  background-color: #374151;\n  color: #f9fafb;\n  border-color: #4b5563;\n}\n\n.live-preview-link {\n  color: #3b82f6;\n  text-decoration: underline;\n  cursor: pointer;\n}\n\n.dark .live-preview-link {\n  color: #60a5fa;\n}\n\n.live-preview-link:hover {\n  color: #1d4ed8;\n}\n\n.dark .live-preview-link:hover {\n  color: #93c5fd;\n}\n\n.live-preview-quote {\n  border-left: 4px solid #e5e7eb;\n  padding-left: 12px;\n  margin: 8px 0;\n  color: #6b7280;\n  font-style: italic;\n}\n\n.dark .live-preview-quote {\n  border-left-color: #4b5563;\n  color: #9ca3af;\n}\n\n.live-preview-heading {\n  font-size: 1.25rem;\n  font-weight: 600;\n  margin: 8px 0;\n  color: #1f2937;\n}\n\n.dark .live-preview-heading {\n  color: #f9fafb;\n}\n\n/* Touch styles –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */\n@media (pointer: coarse) {\n  .canvas-node {\n    touch-action: none;\n  }\n  \n  .component-item {\n    touch-action: none;\n    user-select: none;\n  }\n  \n  /* Touch drag feedback */\n  .component-item:active {\n    transform: scale(0.95);\n    opacity: 0.8;\n  }\n  \n  /* Prevent text selection during touch drag */\n  .components-sidebar * {\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n  }\n  \n  /* –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –Ω–∞ touch —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */\n  [draggable=\"true\"] {\n    -webkit-user-drag: element;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n  }\n  \n  /* Touch feedback –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ */\n  .components-sidebar [draggable=\"true\"]:active {\n    transform: scale(0.98);\n    transition: transform 0.1s ease;\n  }\n  \n  /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è touch –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è */\n  .components-sidebar button,\n  .components-sidebar [draggable=\"true\"] {\n    min-height: 44px;\n    min-width: 44px;\n  }\n}\n\n/* –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ touch —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */\n.touch-action-none {\n  touch-action: none;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.touch-action-manipulation {\n  touch-action: manipulation;\n}\n\n/* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ drag and drop */\n.no-select {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  -webkit-touch-callout: none;\n  -webkit-tap-highlight-color: transparent;\n}\n\n/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è touch drag and drop */\n.touch-dragging {\n  opacity: 0.7;\n  transform: scale(0.95);\n  transition: all 0.2s ease;\n  pointer-events: none;\n}\n\n/* –ú–æ–±–∏–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ */\n@media (pointer: coarse) {\n  .component-item {\n    min-height: 44px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ touch –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è */\n    padding: 12px 16px;\n  }\n  \n  .canvas-container {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n  }\n}\n\n","size_bytes":48609},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/theme-provider.tsx":{"content":"import React, { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\" | \"system\";\n\ninterface ThemeProviderProps {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n}\n\ninterface ThemeProviderState {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n}\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"telegram-bot-builder-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};","size_bytes":1628},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/components/theme-provider\";\n\nexport function ThemeToggle() {\n  const { setTheme, theme } = useTheme();\n\n  const toggleTheme = () => {\n    setTheme(theme === \"dark\" ? \"light\" : \"dark\");\n  };\n\n  return (\n    <Button \n      variant=\"outline\" \n      size=\"icon\" \n      className=\"relative overflow-hidden\"\n      onClick={toggleTheme}\n    >\n      <Sun className=\"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all duration-300 dark:-rotate-90 dark:scale-0\" />\n      <Moon className=\"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all duration-300 dark:rotate-0 dark:scale-100\" />\n      <span className=\"sr-only\">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</span>\n    </Button>\n  );\n}","size_bytes":803},"client/src/hooks/use-bot-editor.tsx":{"content":"import { useState, useCallback, useEffect, useRef } from 'react';\nimport { Node, Connection, Button, BotData } from '@shared/schema';\nimport { applyTemplateLayout } from '@/utils/hierarchical-layout';\n\ninterface HistoryState {\n  nodes: Node[];\n  connections: Connection[];\n}\n\nexport function useBotEditor(initialData?: BotData) {\n  const [nodes, setNodes] = useState<Node[]>(initialData?.nodes || []);\n  const [connections, setConnections] = useState<Connection[]>(initialData?.connections || []);\n  const [selectedNodeId, setSelectedNodeId] = useState<string | null>(null);\n  \n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —É–∑–ª–æ–≤\n  const [isNodeBeingDragged, setIsNodeBeingDragged] = useState(false);\n  \n  // –ò—Å—Ç–æ—Ä–∏—è –¥–ª—è undo/redo\n  const [history, setHistory] = useState<HistoryState[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const isRedoUndoActionRef = useRef(false);\n\n  const selectedNode = nodes.find(node => node.id === selectedNodeId) || null;\n\n  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é\n  const saveToHistory = useCallback(() => {\n    if (isRedoUndoActionRef.current) {\n      return; // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ undo/redo –æ–ø–µ—Ä–∞—Ü–∏—è—Ö\n    }\n    \n    const currentState: HistoryState = {\n      nodes: JSON.parse(JSON.stringify(nodes)),\n      connections: JSON.parse(JSON.stringify(connections))\n    };\n    \n    setHistory(prev => {\n      // –ï—Å–ª–∏ –º—ã –Ω–µ –≤ –∫–æ–Ω—Ü–µ –∏—Å—Ç–æ—Ä–∏–∏, —É–¥–∞–ª—è–µ–º –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞\n      const newHistory = prev.slice(0, historyIndex + 1);\n      newHistory.push(currentState);\n      \n      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ (–º–∞–∫—Å–∏–º—É–º 50 —Å–æ—Å—Ç–æ—è–Ω–∏–π)\n      if (newHistory.length > 50) {\n        return newHistory.slice(-50);\n      }\n      \n      return newHistory;\n    });\n    \n    setHistoryIndex(prev => Math.min(prev + 1, 49));\n  }, [nodes, connections, historyIndex, history.length]);\n\n  // –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ\n  const undo = useCallback(() => {\n    if (historyIndex > 0) {\n      const prevIndex = historyIndex - 1;\n      const prevState = history[prevIndex];\n      \n      isRedoUndoActionRef.current = true;\n      setHistoryIndex(prevIndex);\n      setSelectedNodeId(null);\n      \n      // –û–±–Ω–æ–≤–ª—è–µ–º nodes –∏ connections –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ç–∏–∫–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è useEffect\n      setTimeout(() => {\n        setNodes(prevState.nodes);\n        setConnections(prevState.connections);\n        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è\n        setTimeout(() => { isRedoUndoActionRef.current = false; }, 100);\n      }, 0);\n    }\n  }, [history, historyIndex]);\n\n  // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ\n  const redo = useCallback(() => {\n    if (historyIndex < history.length - 1) {\n      const nextIndex = historyIndex + 1;\n      const nextState = history[nextIndex];\n      \n      isRedoUndoActionRef.current = true;\n      setHistoryIndex(nextIndex);\n      setSelectedNodeId(null);\n      \n      // –û–±–Ω–æ–≤–ª—è–µ–º nodes –∏ connections –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ç–∏–∫–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è useEffect\n      setTimeout(() => {\n        setNodes(nextState.nodes);\n        setConnections(nextState.connections);\n        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è\n        setTimeout(() => { isRedoUndoActionRef.current = false; }, 100);\n      }, 0);\n    }\n  }, [history, historyIndex]);\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω—ã –ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ undo/redo\n  const canUndo = historyIndex > 0;\n  const canRedo = historyIndex < history.length - 1;\n\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ\n  useEffect(() => {\n    if (history.length === 0 && (nodes.length > 0 || connections.length > 0)) {\n      const initialState: HistoryState = {\n        nodes: JSON.parse(JSON.stringify(nodes)),\n        connections: JSON.parse(JSON.stringify(connections))\n      };\n      setHistory([initialState]);\n      setHistoryIndex(0);\n    }\n  }, [nodes, connections, history.length]);\n\n  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ nodes –∏–ª–∏ connections\n  useEffect(() => {\n    if (!isRedoUndoActionRef.current && history.length > 0) {\n      const timeoutId = setTimeout(saveToHistory, 300); // –£–≤–µ–ª–∏—á–µ–Ω –¥–µ–±–∞—É–Ω—Å –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π\n      return () => clearTimeout(timeoutId);\n    }\n  }, [nodes, connections, saveToHistory, history.length]);\n\n  const addNode = useCallback((node: Node) => {\n    setNodes(prev => [...prev, node]);\n  }, []);\n\n  const updateNode = useCallback((nodeId: string, updates: Partial<Node>) => {\n    setNodes(prev => prev.map(node => \n      node.id === nodeId ? { ...node, ...updates } : node\n    ));\n  }, []);\n\n  const deleteNode = useCallback((nodeId: string) => {\n    setNodes(prev => prev.filter(node => node.id !== nodeId));\n    setConnections(prev => prev.filter(conn => \n      conn.source !== nodeId && conn.target !== nodeId\n    ));\n    if (selectedNodeId === nodeId) {\n      setSelectedNodeId(null);\n    }\n  }, [selectedNodeId]);\n\n  const addConnection = useCallback((connection: Connection) => {\n    setConnections(prev => [...prev, connection]);\n  }, []);\n\n  const deleteConnection = useCallback((connectionId: string) => {\n    setConnections(prev => prev.filter(conn => conn.id !== connectionId));\n  }, []);\n\n  const updateConnection = useCallback((connectionId: string, updates: Partial<Connection>) => {\n    setConnections(prev => prev.map(conn => \n      conn.id === connectionId ? { ...conn, ...updates } : conn\n    ));\n  }, []);\n\n  const updateNodeData = useCallback((nodeId: string, data: Partial<Node['data']>) => {\n    setNodes(prev => prev.map(node => \n      node.id === nodeId \n        ? { ...node, data: { ...node.data, ...data } }\n        : node\n    ));\n  }, []);\n\n  const addButton = useCallback((nodeId: string, button: Button) => {\n    setNodes(prev => prev.map(node => \n      node.id === nodeId \n        ? { \n            ...node, \n            data: { \n              ...node.data, \n              buttons: [...(node.data.buttons || []), button] \n            } \n          }\n        : node\n    ));\n  }, []);\n\n  const updateButton = useCallback((nodeId: string, buttonId: string, updates: Partial<Button>) => {\n    setNodes(prev => prev.map(node => \n      node.id === nodeId \n        ? { \n            ...node, \n            data: { \n              ...node.data, \n              buttons: (node.data.buttons || []).map(btn => \n                btn.id === buttonId ? { ...btn, ...updates } : btn\n              )\n            } \n          }\n        : node\n    ));\n  }, []);\n\n  const deleteButton = useCallback((nodeId: string, buttonId: string) => {\n    setNodes(prev => prev.map(node => \n      node.id === nodeId \n        ? { \n            ...node, \n            data: { \n              ...node.data, \n              buttons: (node.data.buttons || []).filter(btn => btn.id !== buttonId)\n            } \n          }\n        : node\n    ));\n  }, []);\n\n  const updateNodes = useCallback((newNodes: Node[]) => {\n    setNodes(newNodes);\n  }, []);\n\n  // –§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —É–∑–ª–∞ (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–µ—Ä—Å–∏—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏)\n  const normalizeNodeData = useCallback((node: Node): Node => {\n    if (!node || !node.type) return node;\n\n    const normalizedData = { ...node.data };\n\n    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤\n    const defaultFields = {\n      buttons: [],\n      messageText: '',\n      keyboardType: 'none',\n      oneTimeKeyboard: false,\n      resizeKeyboard: true,\n      markdown: false,\n      isPrivateOnly: false,\n      adminOnly: false,\n      requiresAuth: false,\n      showInMenu: true,\n      enableStatistics: true\n    };\n\n    // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–æ–ª—è\n    for (const [key, value] of Object.entries(defaultFields)) {\n      if ((normalizedData as any)[key] === undefined) {\n        (normalizedData as any)[key] = value;\n      }\n    }\n\n    // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∫–æ–º–∞–Ω–¥ start –∏ command\n    if (node.type === 'start' || node.type === 'command') {\n      if (!normalizedData.command) {\n        normalizedData.command = node.type === 'start' ? '/start' : '/command';\n      }\n      if (!normalizedData.description) {\n        normalizedData.description = node.type === 'start' ? '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞' : '–ö–æ–º–∞–Ω–¥–∞ –±–æ—Ç–∞';\n      }\n    }\n\n    return {\n      ...node,\n      data: normalizedData\n    };\n  }, []);\n\n  const setBotData = useCallback((\n    botData: BotData, \n    templateName?: string, \n    nodeSizes?: Map<string, { width: number; height: number }>,\n    skipLayout?: boolean // –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ layout\n  ) => {\n    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞\n    \n    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —É–∑–ª—ã –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏\n    const normalizedNodes = (botData.nodes || []).map(normalizeNodeData);\n    \n    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é –∫–æ–º–ø–æ–Ω–æ–≤–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–∞\n    const finalNodes = skipLayout \n      ? normalizedNodes \n      : applyTemplateLayout(normalizedNodes, botData.connections || [], templateName, nodeSizes);\n    \n    setNodes(finalNodes);\n    setConnections(botData.connections || []);\n    setSelectedNodeId(null); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É–∑–µ–ª\n    \n    // setBotData –∑–∞–≤–µ—Ä—à–µ–Ω\n  }, [normalizeNodeData]);\n\n  const duplicateNode = useCallback((nodeId: string) => {\n    const nodeToDuplicate = nodes.find(node => node.id === nodeId);\n    if (!nodeToDuplicate) return;\n\n    // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é —É–∑–ª–∞ —Å –Ω–æ–≤—ã–º ID –∏ —Å–º–µ—â–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–µ–π\n    const duplicatedNode: Node = {\n      ...JSON.parse(JSON.stringify(nodeToDuplicate)), // –ì–ª—É–±–æ–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ\n      id: `${nodeId}_copy_${Date.now()}`, // –ù–æ–≤—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID\n      position: {\n        x: nodeToDuplicate.position.x + 50, // –°–º–µ—â–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ\n        y: nodeToDuplicate.position.y + 50  // –°–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑\n      }\n    };\n\n    setNodes(prev => [...prev, duplicatedNode]);\n    setSelectedNodeId(duplicatedNode.id); // –í—ã–±–∏—Ä–∞–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–∑–µ–ª\n  }, [nodes]);\n\n  const duplicateNodes = useCallback((nodeIds: string[]) => {\n    const nodesToDuplicate = nodes.filter(node => nodeIds.includes(node.id));\n    if (nodesToDuplicate.length === 0) return;\n\n    const idMapping: { [oldId: string]: string } = {};\n    const duplicatedNodes: Node[] = [];\n\n    // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏–∏ —É–∑–ª–æ–≤ —Å –Ω–æ–≤—ã–º–∏ ID\n    nodesToDuplicate.forEach(node => {\n      const newId = `${node.id}_copy_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      idMapping[node.id] = newId;\n\n      const duplicatedNode: Node = {\n        ...JSON.parse(JSON.stringify(node)), // –ì–ª—É–±–æ–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ\n        id: newId,\n        position: {\n          x: node.position.x + 50, // –°–º–µ—â–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ\n          y: node.position.y + 50  // –°–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑\n        }\n      };\n\n      duplicatedNodes.push(duplicatedNode);\n    });\n\n    // –ö–æ–ø–∏—Ä—É–µ–º —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —É–∑–ª–∞–º–∏\n    const duplicatedConnections: Connection[] = [];\n    connections.forEach(connection => {\n      const sourceId = idMapping[connection.source];\n      const targetId = idMapping[connection.target];\n      \n      // –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±–∞ —É–∑–ª–∞ –±—ã–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã\n      if (sourceId && targetId) {\n        const duplicatedConnection: Connection = {\n          ...JSON.parse(JSON.stringify(connection)), // –ì–ª—É–±–æ–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ\n          id: `${connection.id}_copy_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n          source: sourceId,\n          target: targetId\n        };\n        duplicatedConnections.push(duplicatedConnection);\n      }\n    });\n\n    setNodes(prev => [...prev, ...duplicatedNodes]);\n    setConnections(prev => [...prev, ...duplicatedConnections]);\n    \n    // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–∑–µ–ª\n    if (duplicatedNodes.length > 0) {\n      setSelectedNodeId(duplicatedNodes[0].id);\n    }\n  }, [nodes, connections]);\n\n  const getBotData = useCallback((): BotData => ({\n    nodes,\n    connections\n  }), [nodes, connections]);\n\n  // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç—ã\n  const copyToClipboard = useCallback((nodeIds: string[]) => {\n    const nodesToCopy = nodes.filter(node => nodeIds.includes(node.id));\n    const connectionsToCopy = connections.filter(conn => \n      nodeIds.includes(conn.source) && nodeIds.includes(conn.target)\n    );\n\n    const clipboardData = {\n      nodes: nodesToCopy,\n      connections: connectionsToCopy,\n      timestamp: Date.now(),\n      projectType: 'telegram-bot'\n    };\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –º–µ–∂–ø—Ä–æ–µ–∫—Ç–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞\n    localStorage.setItem('bot-clipboard', JSON.stringify(clipboardData));\n    \n    return clipboardData;\n  }, [nodes, connections]);\n\n  // –í—Å—Ç–∞–≤–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞\n  const pasteFromClipboard = useCallback((offsetX: number = 100, offsetY: number = 100) => {\n    try {\n      const clipboardDataStr = localStorage.getItem('bot-clipboard');\n      if (!clipboardDataStr) return false;\n\n      const clipboardData = JSON.parse(clipboardDataStr);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –∏ –Ω–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–µ (24 —á–∞—Å–∞)\n      if (!clipboardData.nodes || !Array.isArray(clipboardData.nodes) || \n          !clipboardData.timestamp || Date.now() - clipboardData.timestamp > 24 * 60 * 60 * 1000) {\n        return false;\n      }\n\n      const idMapping: { [oldId: string]: string } = {};\n      const pastedNodes: Node[] = [];\n\n      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ ID –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤\n      clipboardData.nodes.forEach((node: Node) => {\n        const newId = `${node.id}_paste_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        idMapping[node.id] = newId;\n\n        const pastedNode: Node = {\n          ...JSON.parse(JSON.stringify(node)),\n          id: newId,\n          position: {\n            x: node.position.x + offsetX,\n            y: node.position.y + offsetY\n          }\n        };\n\n        pastedNodes.push(pastedNode);\n      });\n\n      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ ID\n      const pastedConnections: Connection[] = [];\n      clipboardData.connections.forEach((connection: Connection) => {\n        const sourceId = idMapping[connection.source];\n        const targetId = idMapping[connection.target];\n        \n        if (sourceId && targetId) {\n          const pastedConnection: Connection = {\n            ...JSON.parse(JSON.stringify(connection)),\n            id: `${connection.id}_paste_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n            source: sourceId,\n            target: targetId\n          };\n          pastedConnections.push(pastedConnection);\n        }\n      });\n\n      // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Ö–æ–ª—Å—Ç\n      setNodes(prev => [...prev, ...pastedNodes]);\n      setConnections(prev => [...prev, ...pastedConnections]);\n\n      // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —É–∑–µ–ª\n      if (pastedNodes.length > 0) {\n        setSelectedNodeId(pastedNodes[0].id);\n      }\n\n      return true;\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞:', error);\n      return false;\n    }\n  }, []);\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –±—É—Ñ–µ—Ä–µ –æ–±–º–µ–Ω–∞\n  const hasClipboardData = useCallback(() => {\n    try {\n      const clipboardDataStr = localStorage.getItem('bot-clipboard');\n      if (!clipboardDataStr) return false;\n\n      const clipboardData = JSON.parse(clipboardDataStr);\n      return !!(clipboardData.nodes && Array.isArray(clipboardData.nodes) && \n               clipboardData.nodes.length > 0 && clipboardData.timestamp &&\n               Date.now() - clipboardData.timestamp <= 24 * 60 * 60 * 1000);\n    } catch {\n      return false;\n    }\n  }, []);\n\n  return {\n    nodes,\n    connections,\n    selectedNode,\n    selectedNodeId,\n    setSelectedNodeId,\n    addNode,\n    updateNode,\n    deleteNode,\n    duplicateNode,\n    duplicateNodes,\n    addConnection,\n    deleteConnection,\n    updateConnection,\n    updateNodeData,\n    addButton,\n    updateButton,\n    deleteButton,\n    updateNodes,\n    setBotData,\n    getBotData,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    copyToClipboard,\n    pasteFromClipboard,\n    hasClipboardData,\n    isNodeBeingDragged,\n    setIsNodeBeingDragged\n  };\n}\n","size_bytes":17221},"client/src/hooks/use-custom-layout.tsx":{"content":"import { useState, useCallback, useEffect } from 'react';\nimport { CustomLayoutConfig, LayoutElement } from '@/components/layout/custom-layout-editor';\n\nconst STORAGE_KEY = 'custom-layout-config';\n\nexport const useCustomLayout = (initialConfig?: CustomLayoutConfig) => {\n  const [config, setConfig] = useState<CustomLayoutConfig>(() => {\n    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ localStorage\n    if (typeof window !== 'undefined') {\n      const savedConfig = localStorage.getItem(STORAGE_KEY);\n      if (savedConfig) {\n        try {\n          const parsed = JSON.parse(savedConfig);\n          return {\n            ...parsed,\n            lastModified: new Date(parsed.lastModified)\n          };\n        } catch (error) {\n          console.warn('Failed to parse saved layout config:', error);\n        }\n      }\n    }\n    \n    return initialConfig || {\n      elements: [\n        {\n          id: 'header',\n          type: 'header',\n          name: '–®–∞–ø–∫–∞',\n          position: 'top',\n          size: 8,\n          visible: true,\n          order: 1,\n          content: null\n        },\n        {\n          id: 'sidebar',\n          type: 'sidebar',\n          name: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n          position: 'left',\n          size: 20,\n          visible: true,\n          order: 2,\n          content: null\n        },\n        {\n          id: 'canvas',\n          type: 'canvas',\n          name: '–•–æ–ª—Å—Ç',\n          position: 'center',\n          size: 55,\n          visible: true,\n          order: 3,\n          content: null\n        },\n        {\n          id: 'properties',\n          type: 'properties',\n          name: '–°–≤–æ–π—Å—Ç–≤–∞',\n          position: 'right',\n          size: 25,\n          visible: true,\n          order: 4,\n          content: null\n        }\n      ],\n      gridSize: 10,\n      snapToGrid: true,\n      showGrid: false,\n      compactMode: false,\n      lastModified: new Date()\n    };\n  });\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(config));\n    }\n  }, [config]);\n\n  const updateConfig = useCallback((newConfig: Partial<CustomLayoutConfig>) => {\n    setConfig(prev => ({\n      ...prev,\n      ...newConfig,\n      lastModified: new Date()\n    }));\n  }, []);\n\n  const updateElement = useCallback((elementId: string, updates: Partial<LayoutElement>) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(element =>\n        element.id === elementId\n          ? { ...element, ...updates }\n          : element\n      ),\n      lastModified: new Date()\n    }));\n  }, []);\n\n  const moveElement = useCallback((elementId: string, newPosition: LayoutElement['position']) => {\n    updateElement(elementId, { position: newPosition });\n  }, [updateElement]);\n\n  const resizeElement = useCallback((elementId: string, newSize: number) => {\n    updateElement(elementId, { size: newSize });\n  }, [updateElement]);\n\n  const toggleElementVisibility = useCallback((elementId: string) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(element =>\n        element.id === elementId\n          ? { ...element, visible: !element.visible }\n          : element\n      ),\n      lastModified: new Date()\n    }));\n  }, []);\n\n  const setElementVisibility = useCallback((elementId: string, visible: boolean) => {\n    updateElement(elementId, { visible });\n  }, [updateElement]);\n\n  const reorderElements = useCallback((elementIds: string[]) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(element => {\n        const newOrder = elementIds.indexOf(element.id);\n        return newOrder !== -1 ? { ...element, order: newOrder + 1 } : element;\n      }),\n      lastModified: new Date()\n    }));\n  }, []);\n\n  const resetConfig = useCallback(() => {\n    const defaultConfig: CustomLayoutConfig = {\n      elements: [\n        {\n          id: 'header',\n          type: 'header',\n          name: '–®–∞–ø–∫–∞',\n          position: 'top',\n          size: 8,\n          visible: true,\n          order: 1,\n          content: null\n        },\n        {\n          id: 'sidebar',\n          type: 'sidebar',\n          name: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n          position: 'left',\n          size: 20,\n          visible: true,\n          order: 2,\n          content: null\n        },\n        {\n          id: 'canvas',\n          type: 'canvas',\n          name: '–•–æ–ª—Å—Ç',\n          position: 'center',\n          size: 55,\n          visible: true,\n          order: 3,\n          content: null\n        },\n        {\n          id: 'properties',\n          type: 'properties',\n          name: '–°–≤–æ–π—Å—Ç–≤–∞',\n          position: 'right',\n          size: 25,\n          visible: true,\n          order: 4,\n          content: null\n        }\n      ],\n      gridSize: 10,\n      snapToGrid: true,\n      showGrid: false,\n      compactMode: false,\n      lastModified: new Date()\n    };\n    setConfig(defaultConfig);\n  }, []);\n\n  const loadPreset = useCallback((presetName: string) => {\n    const presets: Record<string, Partial<CustomLayoutConfig>> = {\n      'classic': {\n        elements: [\n          { id: 'header', position: 'top', size: 8, visible: true, order: 1 },\n          { id: 'sidebar', position: 'left', size: 20, visible: true, order: 2 },\n          { id: 'canvas', position: 'center', size: 55, visible: true, order: 3 },\n          { id: 'properties', position: 'right', size: 25, visible: true, order: 4 }\n        ]\n      },\n      'bottom-header': {\n        elements: [\n          { id: 'header', position: 'bottom', size: 8, visible: true, order: 4 },\n          { id: 'sidebar', position: 'left', size: 20, visible: true, order: 1 },\n          { id: 'canvas', position: 'center', size: 55, visible: true, order: 2 },\n          { id: 'properties', position: 'right', size: 25, visible: true, order: 3 }\n        ]\n      },\n      'minimal': {\n        elements: [\n          { id: 'header', position: 'top', size: 6, visible: true, order: 1 },\n          { id: 'sidebar', position: 'left', size: 15, visible: true, order: 2 },\n          { id: 'canvas', position: 'center', size: 70, visible: true, order: 3 },\n          { id: 'properties', position: 'right', size: 15, visible: true, order: 4 }\n        ]\n      },\n      'fullscreen': {\n        elements: [\n          { id: 'header', position: 'top', size: 5, visible: true, order: 1 },\n          { id: 'sidebar', position: 'left', size: 0, visible: false, order: 2 },\n          { id: 'canvas', position: 'center', size: 95, visible: true, order: 3 },\n          { id: 'properties', position: 'right', size: 0, visible: false, order: 4 }\n        ]\n      }\n    };\n\n    const preset = presets[presetName];\n    if (preset) {\n      setConfig(prev => ({\n        ...prev,\n        ...preset,\n        elements: prev.elements.map(element => {\n          const presetElement = preset.elements?.find(p => p.id === element.id);\n          return presetElement ? { ...element, ...presetElement } : element;\n        }),\n        lastModified: new Date()\n      }));\n    }\n  }, []);\n\n  const exportConfig = useCallback(() => {\n    return JSON.stringify(config, null, 2);\n  }, [config]);\n\n  const importConfig = useCallback((configString: string) => {\n    try {\n      const imported = JSON.parse(configString);\n      setConfig({\n        ...imported,\n        lastModified: new Date()\n      });\n      return true;\n    } catch (error) {\n      console.error('Failed to import config:', error);\n      return false;\n    }\n  }, []);\n\n  const getVisibleElements = useCallback(() => {\n    return config.elements.filter(element => element.visible);\n  }, [config.elements]);\n\n  const getElementByType = useCallback((type: LayoutElement['type']) => {\n    return config.elements.find(element => element.type === type);\n  }, [config.elements]);\n\n  const getElementsByPosition = useCallback((position: LayoutElement['position']) => {\n    return config.elements.filter(element => element.position === position && element.visible);\n  }, [config.elements]);\n\n  return {\n    config,\n    updateConfig,\n    updateElement,\n    moveElement,\n    resizeElement,\n    toggleElementVisibility,\n    setElementVisibility,\n    reorderElements,\n    resetConfig,\n    loadPreset,\n    exportConfig,\n    importConfig,\n    getVisibleElements,\n    getElementByType,\n    getElementsByPosition,\n    \n    // –£—Ç–∏–ª–∏—Ç—ã\n    isElementVisible: (elementId: string) => {\n      const element = config.elements.find(e => e.id === elementId);\n      return element?.visible ?? false;\n    },\n    \n    getElementPosition: (elementId: string) => {\n      const element = config.elements.find(e => e.id === elementId);\n      return element?.position ?? 'center';\n    },\n    \n    getElementSize: (elementId: string) => {\n      const element = config.elements.find(e => e.id === elementId);\n      return element?.size ?? 50;\n    }\n  };\n};","size_bytes":8941},"client/src/hooks/use-media.ts":{"content":"import { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { MediaFile, InsertMediaFile } from \"@shared/schema\";\n\nexport function useMediaFiles(projectId: number, fileType?: string) {\n  return useQuery({\n    queryKey: [\"/api/media/project\", projectId, fileType],\n    queryFn: async (): Promise<MediaFile[]> => {\n      const url = fileType \n        ? `/api/media/project/${projectId}?type=${fileType}`\n        : `/api/media/project/${projectId}`;\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤\");\n      }\n      return response.json();\n    },\n  });\n}\n\nexport function useUploadMedia(projectId: number) {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ \n      file, \n      description, \n      tags, \n      isPublic,\n      onProgress \n    }: { \n      file: File; \n      description?: string; \n      tags?: string[];\n      isPublic?: boolean;\n      onProgress?: (progress: number) => void;\n    }): Promise<MediaFile> => {\n      const formData = new FormData();\n      formData.append('file', file);\n      if (description) formData.append('description', description);\n      if (tags) formData.append('tags', tags.join(','));\n      if (isPublic !== undefined) formData.append('isPublic', isPublic.toString());\n      \n      return new Promise((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        \n        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏\n        if (onProgress) {\n          xhr.upload.addEventListener('progress', (e) => {\n            if (e.lengthComputable) {\n              const progress = Math.round((e.loaded / e.total) * 100);\n              onProgress(progress);\n            }\n          });\n        }\n        \n        xhr.addEventListener('load', () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            try {\n              const result = JSON.parse(xhr.responseText);\n              resolve(result);\n            } catch (parseError) {\n              console.error('Parse error:', parseError, 'Response:', xhr.responseText);\n              reject(new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞'));\n            }\n          } else {\n            try {\n              const error = JSON.parse(xhr.responseText);\n              console.error('Upload error:', error);\n              reject(new Error(error.message || `–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ (${xhr.status})`));\n            } catch (parseError) {\n              console.error('Error parsing error response:', parseError, 'Response:', xhr.responseText);\n              reject(new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${xhr.status} - ${xhr.statusText}`));\n            }\n          }\n        });\n        \n        xhr.addEventListener('error', () => {\n          reject(new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞'));\n        });\n        \n        xhr.addEventListener('abort', () => {\n          reject(new Error('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –±—ã–ª–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞'));\n        });\n        \n        xhr.open('POST', `/api/media/upload/${projectId}`);\n        xhr.send(formData);\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/media/project\", projectId] });\n    },\n  });\n}\n\nexport function useUploadMultipleMedia(projectId: number) {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ \n      files, \n      defaultDescription, \n      isPublic,\n      onProgress,\n      onFileProgress\n    }: { \n      files: File[]; \n      defaultDescription?: string; \n      isPublic?: boolean;\n      onProgress?: (progress: number) => void;\n      onFileProgress?: (fileIndex: number, progress: number) => void;\n    }): Promise<{\n      success: number;\n      errors: number;\n      uploadedFiles: MediaFile[];\n      errorDetails: any[];\n      statistics: any;\n    }> => {\n      const formData = new FormData();\n      \n      files.forEach(file => {\n        formData.append('files', file);\n      });\n      \n      if (defaultDescription) formData.append('defaultDescription', defaultDescription);\n      if (isPublic !== undefined) formData.append('isPublic', isPublic.toString());\n      \n      return new Promise((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        \n        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏\n        if (onProgress) {\n          xhr.upload.addEventListener('progress', (e) => {\n            if (e.lengthComputable) {\n              const progress = Math.round((e.loaded / e.total) * 100);\n              onProgress(progress);\n            }\n          });\n        }\n        \n        xhr.addEventListener('load', () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            try {\n              const result = JSON.parse(xhr.responseText);\n              resolve(result);\n            } catch (parseError) {\n              console.error('Multiple upload parse error:', parseError, 'Response:', xhr.responseText);\n              reject(new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞'));\n            }\n          } else {\n            try {\n              const error = JSON.parse(xhr.responseText);\n              console.error('Multiple upload error:', error);\n              reject(new Error(error.message || `–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ (${xhr.status})`));\n            } catch (parseError) {\n              console.error('Error parsing multiple upload error response:', parseError, 'Response:', xhr.responseText);\n              reject(new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${xhr.status} - ${xhr.statusText}`));\n            }\n          }\n        });\n        \n        xhr.addEventListener('error', () => {\n          reject(new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤'));\n        });\n        \n        xhr.addEventListener('abort', () => {\n          reject(new Error('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –±—ã–ª–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞'));\n        });\n        \n        xhr.open('POST', `/api/media/upload-multiple/${projectId}`);\n        xhr.send(formData);\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/media/project\", projectId] });\n    },\n  });\n}\n\nexport function useDeleteMedia() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (id: number): Promise<void> => {\n      const response = await apiRequest('DELETE', `/api/media/${id}`);\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞');\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/media/project\"] });\n    },\n  });\n}\n\nexport function useUpdateMedia() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ \n      id, \n      updates \n    }: { \n      id: number; \n      updates: Partial<InsertMediaFile> \n    }): Promise<MediaFile> => {\n      const response = await apiRequest('PUT', `/api/media/${id}`, updates);\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/media/project\"] });\n    },\n  });\n}\n\nexport function useIncrementUsage() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (id: number): Promise<void> => {\n      const response = await apiRequest('POST', `/api/media/${id}/use`);\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è');\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/media/project\"] });\n    },\n  });\n}\n\nexport function useSearchMedia(projectId: number, query: string) {\n  return useQuery({\n    queryKey: [\"/api/media/search\", projectId, query],\n    queryFn: async (): Promise<MediaFile[]> => {\n      if (!query.trim()) return [];\n      \n      const response = await fetch(`/api/media/search/${projectId}?q=${encodeURIComponent(query)}`);\n      if (!response.ok) {\n        throw new Error(\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ñ–∞–π–ª–æ–≤\");\n      }\n      return response.json();\n    },\n    enabled: !!query.trim(),\n  });\n}","size_bytes":8656},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\nexport function getIsMobile() {\n  if (typeof window === 'undefined') return false;\n  \n  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ innerWidth –∏ clientWidth\n  // –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ —ç–º—É–ª—è—Ü–∏–∏ DevTools\n  const effectiveWidth = Math.min(window.innerWidth, document.documentElement.clientWidth);\n  return effectiveWidth < MOBILE_BREAKPOINT;\n}\n\nexport function useIsMobile() {\n  // –°—Ä–∞–∑—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ window –¥–æ—Å—Ç—É–ø–µ–Ω\n  const [isMobile, setIsMobile] = React.useState<boolean>(() => getIsMobile())\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(getIsMobile());\n    }\n    \n    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏\n    setIsMobile(getIsMobile());\n    \n    mql.addEventListener(\"change\", onChange)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return isMobile\n}\n","size_bytes":1256},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/hooks/use-url-download.ts":{"content":"import { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { MediaFile } from \"@shared/schema\";\n\nexport interface UrlCheckResult {\n  accessible: boolean;\n  fileInfo?: {\n    mimeType?: string;\n    size?: number;\n    fileName?: string;\n    fileType?: string;\n    category?: string;\n    sizeMB?: number;\n  };\n  error?: string;\n  code?: string;\n}\n\nexport interface UrlDownloadResult extends MediaFile {\n  downloadInfo: {\n    sourceUrl: string;\n    category?: string;\n    sizeMB: number;\n    autoTagsAdded: number;\n    downloadDate: string;\n    method: 'url_download';\n  };\n}\n\nexport interface BatchDownloadResult {\n  success: number;\n  errors: number;\n  downloadedFiles: UrlDownloadResult[];\n  errorDetails: Array<{\n    url: string;\n    error: string;\n  }>;\n  summary: {\n    total: number;\n    successful: number;\n    failed: number;\n    totalSize: number;\n  };\n}\n\nexport function useCheckUrl() {\n  return useMutation<UrlCheckResult, Error, string>({\n    mutationFn: async (url: string) => {\n      return await apiRequest('POST', '/api/media/check-url', { url });\n    }\n  });\n}\n\nexport function useDownloadUrl(projectId: number) {\n  const queryClient = useQueryClient();\n  \n  return useMutation<UrlDownloadResult, Error, {\n    url: string;\n    description?: string;\n    tags?: string;\n    isPublic?: boolean;\n    customFileName?: string;\n  }>({\n    mutationFn: async ({ url, description, tags, isPublic, customFileName }) => {\n      return await apiRequest('POST', `/api/media/download-url/${projectId}`, { \n        url, \n        description, \n        tags, \n        isPublic, \n        customFileName \n      });\n    },\n    onSuccess: () => {\n      // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞\n      queryClient.invalidateQueries({ \n        queryKey: ['/api/media/project', projectId] \n      });\n    }\n  });\n}\n\nexport function useDownloadUrls(projectId: number) {\n  const queryClient = useQueryClient();\n  \n  return useMutation<BatchDownloadResult, Error, {\n    urls: Array<string | { \n      url: string; \n      fileName?: string; \n      description?: string; \n    }>;\n    isPublic?: boolean;\n    defaultDescription?: string;\n  }>({\n    mutationFn: async ({ urls, isPublic, defaultDescription }) => {\n      return await apiRequest('POST', `/api/media/download-urls/${projectId}`, { \n        urls, \n        isPublic, \n        defaultDescription \n      });\n    },\n    onSuccess: () => {\n      // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞\n      queryClient.invalidateQueries({ \n        queryKey: ['/api/media/project', projectId] \n      });\n    }\n  });\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ URL\nexport function isValidUrl(string: string): boolean {\n  try {\n    const url = new URL(string);\n    return ['http:', 'https:'].includes(url.protocol);\n  } catch {\n    return false;\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∏–∑ URL\nexport function extractFileNameFromUrl(url: string): string {\n  try {\n    const urlObj = new URL(url);\n    const pathname = urlObj.pathname;\n    const segments = pathname.split('/');\n    const fileName = segments[segments.length - 1];\n    \n    // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞\n    if (fileName && fileName.includes('.')) {\n      return fileName;\n    }\n    \n    // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –ø—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ Content-Disposition –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö\n    return fileName || 'downloaded-file';\n  } catch {\n    return 'downloaded-file';\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø–æ URL\nexport function getFileTypeFromUrl(url: string): 'photo' | 'video' | 'audio' | 'document' | 'unknown' {\n  const fileName = extractFileNameFromUrl(url).toLowerCase();\n  \n  // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n  if (/\\.(jpg|jpeg|png|gif|webp|svg|bmp)$/i.test(fileName)) {\n    return 'photo';\n  }\n  \n  // –í–∏–¥–µ–æ\n  if (/\\.(mp4|webm|avi|mov|mkv|flv|wmv)$/i.test(fileName)) {\n    return 'video';\n  }\n  \n  // –ê—É–¥–∏–æ\n  if (/\\.(mp3|wav|ogg|aac|flac|m4a)$/i.test(fileName)) {\n    return 'audio';\n  }\n  \n  // –î–æ–∫—É–º–µ–Ω—Ç—ã\n  if (/\\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx|zip|rar)$/i.test(fileName)) {\n    return 'document';\n  }\n  \n  return 'unknown';\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞\nexport function formatFileSize(bytes?: number): string {\n  if (!bytes) return '0 –ë';\n  \n  const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë'];\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\n  const formattedSize = (bytes / Math.pow(1024, i)).toFixed(1);\n  \n  return `${formattedSize} ${sizes[i]}`;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤\nexport function isSupportedFileType(url: string): boolean {\n  const fileType = getFileTypeFromUrl(url);\n  return fileType !== 'unknown';\n}","size_bytes":4952},"client/src/lib/bot-generator.ts":{"content":"import { BotData, Node, BotGroup } from '@shared/schema';\nimport { generateBotFatherCommands } from './commands';\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö —É–∑–ª–æ–≤ –∏ —Å–≤—è–∑–µ–π –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞\nfunction extractNodesAndConnections(botData: BotData) {\n  if (!botData) return { nodes: [], connections: [] };\n  \n  if ((botData as any).sheets && Array.isArray((botData as any).sheets)) {\n    // –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π –ø—Ä–æ–µ–∫—Ç - —Å–æ–±–∏—Ä–∞–µ–º —É–∑–ª—ã –∏ —Å–≤—è–∑–∏ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤\n    let allNodes: any[] = [];\n    let allConnections: any[] = [];\n    \n    (botData as any).sheets.forEach((sheet: any) => {\n      if (sheet.nodes && Array.isArray(sheet.nodes)) {\n        allNodes = allNodes.concat(sheet.nodes);\n      }\n      if (sheet.connections && Array.isArray(sheet.connections)) {\n        allConnections = allConnections.concat(sheet.connections);\n      }\n    });\n    \n    return { nodes: allNodes, connections: allConnections };\n  } else {\n    // –û–±—ã—á–Ω—ã–π –ø—Ä–æ–µ–∫—Ç\n    return { \n      nodes: botData.nodes || [], \n      connections: botData.connections || [] \n    };\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ Python\nfunction createSafeFunctionName(nodeId: string): string {\n  let safeName = nodeId.replace(/[^a-zA-Z0-9_]/g, '_');\n  // Python —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –º–æ–≥—É—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —Ü–∏—Ñ—Ä—ã\n  if (/^\\d/.test(safeName)) {\n    safeName = 'node_' + safeName;\n  }\n  return safeName;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ Python –∫–æ–¥–µ\nfunction escapeForPython(text: string): string {\n  return text.replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\r').replace(/\\t/g, '\\\\t');\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è HTML —Ç–µ–≥–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞\nfunction stripHtmlTags(text: string): string {\n  if (!text) return text;\n  return text.replace(/<[^>]*>/g, '');\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ—Å—Ç–∏\nfunction formatTextForPython(text: string): string {\n  if (!text) return '\"\"';\n  \n  // –î–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç—Ä–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏\n  if (text.includes('\\n')) {\n    return `\"\"\"${text}\"\"\"`;\n  } else {\n    // –î–ª—è –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∫–∞–≤—ã—á–∫–∏\n    return `\"${text.replace(/\"/g, '\\\\\"')}\"`;\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞\nfunction getParseMode(formatMode: string): string {\n  if (formatMode === 'html') {\n    return ', parse_mode=ParseMode.HTML';\n  } else if (formatMode === 'markdown') {\n    return ', parse_mode=ParseMode.MARKDOWN';\n  }\n  return '';\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ JavaScript boolean –≤ Python boolean\nfunction toPythonBoolean(value: any): string {\n  return value ? 'True' : 'False';\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö ID –¥–ª—è —É–∑–ª–æ–≤\nfunction generateUniqueShortId(nodeId: string, allNodeIds: string[]): string {\n  if (!nodeId) return 'node';\n  \n  // –û—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —É–∑–ª–æ–≤ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤\n  if (nodeId.endsWith('_interests')) {\n    const prefix = nodeId.replace('_interests', '');\n    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–µ 5-6 —Å–∏–º–≤–æ–ª–æ–≤ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏\n    return prefix.substring(0, Math.min(6, prefix.length));\n  }\n  \n  // –î–ª—è –º–µ—Ç—Ä–æ –∏ –¥—Ä—É–≥–∏—Ö —É–∑–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É\n  const baseShortId = nodeId.slice(-10).replace(/^_+/, '');\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —É–∑–ª–æ–≤\n  const conflicts = allNodeIds.filter(id => {\n    const otherShortId = id.slice(-10).replace(/^_+/, '');\n    return otherShortId === baseShortId && id !== nodeId;\n  });\n  \n  // –ï—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤—ã–π ID\n  if (conflicts.length === 0) {\n    return baseShortId;\n  }\n  \n  // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –±–µ—Ä–µ–º –±–æ–ª–µ–µ —É–Ω–∏–∫–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å\n  return nodeId.replace(/[^a-zA-Z0-9]/g, '').slice(-8);\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ JSON –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ\nfunction escapeForJsonString(text: string): string {\n  if (!text) return '';\n  return text.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\r').replace(/\\t/g, '\\\\t');\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫\nfunction calculateOptimalColumns(buttons: any[], nodeData?: any): number {\n  if (!buttons || buttons.length === 0) return 1;\n  \n  const totalButtons = buttons.length;\n  \n  // –ï—Å–ª–∏ —ç—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä, –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º 2 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤–∏–¥–∞\n  if (nodeData?.allowMultipleSelection) {\n    return 2;\n  }\n  \n  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫\n  if (totalButtons >= 6) {\n    return 2; // –î–ª—è 6+ –∫–Ω–æ–ø–æ–∫ - 2 –∫–æ–ª–æ–Ω–∫–∏\n  } else if (totalButtons >= 3) {\n    return 1; // –î–ª—è 3-5 –∫–Ω–æ–ø–æ–∫ - 1 –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è —É–¥–æ–±–æ—á–∏—Ç–∞–µ–º–æ—Å—Ç–∏\n  } else {\n    return 1; // –î–ª—è 1-2 –∫–Ω–æ–ø–æ–∫ - 1 –∫–æ–ª–æ–Ω–∫–∞\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –∫–æ–ª–æ–Ω–æ–∫\nfunction generateInlineKeyboardCode(buttons: any[], indentLevel: string, nodeId?: string, nodeData?: any, allNodeIds?: string[]): string {\n  if (!buttons || buttons.length === 0) return '';\n  \n  let code = '';\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ (selection) - –µ—Å–ª–∏ –¥–∞, —Ç–æ —ç—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n  const hasSelectionButtons = buttons.some(button => button.action === 'selection');\n  const isMultipleSelection = nodeData?.allowMultipleSelection === true;\n  \n  // –ï—Å–ª–∏ –µ—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è\n  if (hasSelectionButtons && isMultipleSelection) {\n    console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–£–ï–ú —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–ª—è —É–∑–ª–∞ ${nodeId}`);\n    const multiSelectVariable = nodeData?.multiSelectVariable || 'user_interests';\n    \n    code += `${indentLevel}# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n`;\n    code += `${indentLevel}if user_id not in user_data:\\n`;\n    code += `${indentLevel}    user_data[user_id] = {}\\n`;\n    code += `${indentLevel}\\n`;\n    code += `${indentLevel}# –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã\\n`;\n    code += `${indentLevel}saved_selections = []\\n`;\n    code += `${indentLevel}if user_vars:\\n`;\n    code += `${indentLevel}    for var_name, var_data in user_vars.items():\\n`;\n    code += `${indentLevel}        if var_name == \"${multiSelectVariable}\":\\n`;\n    code += `${indentLevel}            if isinstance(var_data, dict) and \"value\" in var_data:\\n`;\n    code += `${indentLevel}                selections_str = var_data[\"value\"]\\n`;\n    code += `${indentLevel}            elif isinstance(var_data, str):\\n`;\n    code += `${indentLevel}                selections_str = var_data\\n`;\n    code += `${indentLevel}            else:\\n`;\n    code += `${indentLevel}                continue\\n`;\n    code += `${indentLevel}            if selections_str and selections_str.strip():\\n`;\n    code += `${indentLevel}                saved_selections = [sel.strip() for sel in selections_str.split(\",\") if sel.strip()]\\n`;\n    code += `${indentLevel}                break\\n`;\n    code += `${indentLevel}\\n`;\n    code += `${indentLevel}# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç\\n`;\n    code += `${indentLevel}if \"multi_select_${nodeId}\" not in user_data[user_id]:\\n`;\n    code += `${indentLevel}    user_data[user_id][\"multi_select_${nodeId}\"] = saved_selections.copy()\\n`;\n    code += `${indentLevel}user_data[user_id][\"multi_select_node\"] = \"${nodeId}\"\\n`;\n    code += `${indentLevel}user_data[user_id][\"multi_select_type\"] = \"inline\"\\n`;\n    code += `${indentLevel}user_data[user_id][\"multi_select_variable\"] = \"${multiSelectVariable}\"\\n`;\n    code += `${indentLevel}logging.info(f\"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å {len(saved_selections)} —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏\")\\n`;\n    code += `${indentLevel}\\n`;\n  }\n  \n  code += `${indentLevel}builder = InlineKeyboardBuilder()\\n`;\n  \n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: generateInlineKeyboardCode –¥–ª—è —É–∑–ª–∞ ${nodeId}`);\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: nodeData.allowMultipleSelection = ${nodeData?.allowMultipleSelection}`);\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: hasSelectionButtons = ${hasSelectionButtons}, isMultipleSelection = ${isMultipleSelection}`);\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: continueButtonTarget = ${nodeData?.continueButtonTarget}`);\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç nodeData:`, JSON.stringify(nodeData, null, 2));\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: hasSelectionButtons=${hasSelectionButtons} && isMultipleSelection=${isMultipleSelection}`);\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: ${hasSelectionButtons && isMultipleSelection}`);\n  \n  buttons.forEach((button, index) => {\n    if (button.action === \"url\") {\n      code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", url=\"${button.url || '#'}\"))\\n`;\n    } else if (button.action === 'goto') {\n      const baseCallbackData = button.target || button.id || 'no_action';\n      // –î–ª—è –∫–Ω–æ–ø–æ–∫ goto –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º target –∫–∞–∫ callback_data –±–µ–∑ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤\n      code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${baseCallbackData}\"))\\n`;\n    } else if (button.action === 'command') {\n      const commandCallback = `cmd_${button.target ? button.target.replace('/', '') : 'unknown'}`;\n      code += `${indentLevel}logging.info(f\"–°–æ–∑–¥–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${button.text} -> ${commandCallback}\")\\n`;\n      code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${commandCallback}\"))\\n`;\n    } else if (button.action === 'selection') {\n      // –£–∫–æ—Ä–∞—á–∏–≤–∞–µ–º callback_data –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ Telegram –≤ 64 –±–∞–π—Ç–∞\n      const shortNodeId = nodeId ? generateUniqueShortId(nodeId, allNodeIds || []) : 'sel';\n      const shortTarget = button.target || button.id || 'btn'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—ã–π target –±–µ–∑ –æ–±—Ä–µ–∑–∫–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º\n      const callbackData = `ms_${shortNodeId}_${shortTarget}`;\n      console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ò–°–ü–†–ê–í–õ–ï–ù–û! –°–æ–∑–¥–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ selection: ${button.text} -> ${callbackData} (shortNodeId: ${shortNodeId}) (–¥–ª–∏–Ω–∞: ${callbackData.length})`);\n      \n      // –î–æ–±–∞–≤–ª—è–µ–º –≥–∞–ª–æ—á–∫–∏ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n      console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: üîç –ü–†–û–í–ï–†–Ø–ï–ú –≥–∞–ª–æ—á–∫–∏ –¥–ª—è ${button.text}: isMultipleSelection=${isMultipleSelection}`);\n      if (isMultipleSelection) {\n        console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –î–û–ë–ê–í–õ–Ø–ï–ú –ì–ê–õ–û–ß–ö–ò –¥–ª—è –∫–Ω–æ–ø–∫–∏ selection: ${button.text} (—É–∑–µ–ª: ${nodeId})`);\n        console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: üìã –î–ê–ù–ù–´–ï –ö–ù–û–ü–ö–ò: text=\"${button.text}\", target=\"${button.target}\", id=\"${button.id}\"`);\n        code += `${indentLevel}# –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ —Å –≥–∞–ª–æ—á–∫–∞–º–∏: ${button.text}\\n`;\n        code += `${indentLevel}logging.info(f\"üîß –ü–†–û–í–ï–†–Ø–ï–ú –ì–ê–õ–û–ß–ö–£: –∏—â–µ–º '${button.text}' –≤ —Å–ø–∏—Å–∫–µ: {user_data[user_id]['multi_select_${nodeId}']}\")\\n`;\n        code += `${indentLevel}selected_mark = \"‚úÖ \" if \"${button.text}\" in user_data[user_id][\"multi_select_${nodeId}\"] else \"\"\\n`;\n        code += `${indentLevel}logging.info(f\"üîç –†–ï–ó–£–õ–¨–¢–ê–¢ –ì–ê–õ–û–ß–ö–ò –¥–ª—è '${button.text}': selected_mark='{selected_mark}'\")\\n`;\n        code += `${indentLevel}final_text = f\"{selected_mark}${button.text}\"\\n`;\n        code += `${indentLevel}logging.info(f\"üì± –°–û–ó–î–ê–ï–ú –ö–ù–û–ü–ö–£: text='{final_text}', callback_data='${callbackData}'\")\\n`;\n        code += `${indentLevel}builder.add(InlineKeyboardButton(text=final_text, callback_data=\"${callbackData}\"))\\n`;\n        console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù –ö–û–î –ì–ê–õ–û–ß–ï–ö –¥–ª—è ${button.text} —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º`);\n      } else {\n        console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚ùå –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –≥–∞–ª–æ—á–∫–∏ –¥–ª—è ${button.text} (isMultipleSelection=${isMultipleSelection})`);\n        code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${callbackData}\"))\\n`;\n      }\n    } else {\n      const callbackData = button.target || button.id || 'no_action';\n      code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${callbackData}\"))\\n`;\n    }\n  });\n  \n  // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–û–ë–ê–í–õ–Ø–ï–ú –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n  if (hasSelectionButtons && isMultipleSelection) {\n    const continueText = nodeData?.continueButtonText || '–ì–æ—Ç–æ–≤–æ';\n    const callbackData = `multi_select_done_${nodeId}`;\n    console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –î–û–ë–ê–í–õ–Ø–ï–ú –∫–Ω–æ–ø–∫—É \"${continueText}\" –¥–ª—è —É–∑–ª–∞ ${nodeId} —Å callback_data: ${callbackData}`);\n    code += `${indentLevel}# –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n`;\n    code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${continueText}\", callback_data=\"${callbackData}\"))\\n`;\n  }\n  \n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —Å —É—á–µ—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö —É–∑–ª–∞ –∏ –∫–Ω–æ–ø–∫–∏ \"–ì–æ—Ç–æ–≤–æ\"\n  let allButtons = [...buttons];\n  if (hasSelectionButtons && isMultipleSelection) {\n    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞ –∫–æ–ª–æ–Ω–æ–∫\n    allButtons.push({ text: nodeData?.continueButtonText || '–ì–æ—Ç–æ–≤–æ' });\n  }\n  const columns = calculateOptimalColumns(allButtons, nodeData);\n  code += `${indentLevel}builder.adjust(${columns})\\n`;\n  code += `${indentLevel}keyboard = builder.as_markup()\\n`;\n  \n  return code;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–º–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–µ\nfunction generateVariableReplacement(variableName: string, indentLevel: string): string {\n  let code = '';\n  code += `${indentLevel}    # –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\\n`;\n  code += `${indentLevel}    if \"{${variableName}}\" in text:\\n`;\n  code += `${indentLevel}        if variable_value is not None:\\n`;\n  code += `${indentLevel}            text = text.replace(\"{${variableName}}\", str(variable_value))\\n`;\n  code += `${indentLevel}        else:\\n`;\n  code += `${indentLevel}            # –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç\\n`;\n  code += `${indentLevel}            text = text.replace(\"{${variableName}}\", \"${variableName}\")\\n`;\n  return code;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–º–µ–Ω—ã –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–µ\nfunction generateUniversalVariableReplacement(indentLevel: string): string {\n  let code = '';\n  code += `${indentLevel}# –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–µ–∫—Å—Ç\\n`;\n  code += `${indentLevel}user_vars = await get_user_from_db(user_id)\\n`;\n  code += `${indentLevel}if not user_vars:\\n`;\n  code += `${indentLevel}    user_vars = user_data.get(user_id, {})\\n`;\n  code += `${indentLevel}\\n`;\n  code += `${indentLevel}# get_user_from_db —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ user_data\\n`;\n  code += `${indentLevel}if not isinstance(user_vars, dict):\\n`;\n  code += `${indentLevel}    user_vars = {}\\n`;\n  code += `${indentLevel}\\n`;\n  code += `${indentLevel}# –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç–µ\\n`;\n  code += `${indentLevel}import re\\n`;\n  code += `${indentLevel}def replace_variables_in_text(text_content, variables_dict):\\n`;\n  code += `${indentLevel}    if not text_content or not variables_dict:\\n`;\n  code += `${indentLevel}        return text_content\\n`;\n  code += `${indentLevel}    \\n`;\n  code += `${indentLevel}    for var_name, var_data in variables_dict.items():\\n`;\n  code += `${indentLevel}        placeholder = \"{\" + var_name + \"}\"\\n`;\n  code += `${indentLevel}        if placeholder in text_content:\\n`;\n  code += `${indentLevel}            if isinstance(var_data, dict) and \"value\" in var_data:\\n`;\n  code += `${indentLevel}                var_value = str(var_data[\"value\"]) if var_data[\"value\"] is not None else var_name\\n`;\n  code += `${indentLevel}            elif var_data is not None:\\n`;\n  code += `${indentLevel}                var_value = str(var_data)\\n`;\n  code += `${indentLevel}            else:\\n`;\n  code += `${indentLevel}                var_value = var_name  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ—Ç\\n`;\n  code += `${indentLevel}            text_content = text_content.replace(placeholder, var_value)\\n`;\n  code += `${indentLevel}    return text_content\\n`;\n  code += `${indentLevel}\\n`;\n  code += `${indentLevel}text = replace_variables_in_text(text, user_vars)\\n`;\n  return code;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\nfunction generateConditionalKeyboard(condition: any, indentLevel: string, nodeData?: any): string {\n  if (!condition.keyboardType || condition.keyboardType === 'none' || !condition.buttons || condition.buttons.length === 0) {\n    return '';\n  }\n\n  let code = '';\n  \n  if (condition.keyboardType === 'inline') {\n    code += `${indentLevel}# –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n    code += `${indentLevel}builder = InlineKeyboardBuilder()\\n`;\n    \n    condition.buttons.forEach((button: any) => {\n      if (button.action === \"url\") {\n        code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", url=\"${button.url || '#'}\"))\\n`;\n      } else if (button.action === 'goto') {\n        const callbackData = button.target || button.id || 'no_action';\n        code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${callbackData}\"))\\n`;\n      } else if (button.action === 'command') {\n        // –î–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ –≤ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ\n        // –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é callback_data —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏–∑ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        const conditionalVariableName = condition.variableName || condition.variableNames?.[0] || (nodeData && nodeData.inputVariable);\n        if (conditionalVariableName) {\n          const conditionalCallback = `conditional_${conditionalVariableName}_${button.text}`;\n          code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${conditionalCallback}\"))\\n`;\n        } else {\n          const commandCallback = `cmd_${button.target ? button.target.replace('/', '') : 'unknown'}`;\n          code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${commandCallback}\"))\\n`;\n        }\n      } else {\n        const callbackData = button.target || button.id || 'no_action';\n        code += `${indentLevel}builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${callbackData}\"))\\n`;\n      }\n    });\n    \n    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\n    const columns = calculateOptimalColumns(condition.buttons, nodeData);\n    code += `${indentLevel}builder.adjust(${columns})\\n`;\n    code += `${indentLevel}keyboard = builder.as_markup()\\n`;\n    code += `${indentLevel}conditional_keyboard = keyboard\\n`;\n    \n  } else if (condition.keyboardType === 'reply') {\n    code += `${indentLevel}# –°–æ–∑–¥–∞–µ–º reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n    code += `${indentLevel}builder = ReplyKeyboardBuilder()\\n`;\n    \n    condition.buttons.forEach((button: any) => {\n      if (button.action === \"contact\" && button.requestContact) {\n        code += `${indentLevel}builder.add(KeyboardButton(text=\"${button.text}\", request_contact=True))\\n`;\n      } else if (button.action === \"location\" && button.requestLocation) {\n        code += `${indentLevel}builder.add(KeyboardButton(text=\"${button.text}\", request_location=True))\\n`;\n      } else {\n        code += `${indentLevel}builder.add(KeyboardButton(text=\"${button.text}\"))\\n`;\n      }\n    });\n    \n    code += `${indentLevel}keyboard = builder.as_markup(resize_keyboard=True, one_time_keyboard=False)\\n`;\n    code += `${indentLevel}conditional_keyboard = keyboard\\n`;\n  }\n  \n  return code;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\nfunction generateConditionalMessageLogic(conditionalMessages: any[], indentLevel: string = '    ', nodeData?: any): string {\n  if (!conditionalMessages || conditionalMessages.length === 0) {\n    return '';\n  }\n\n  let code = '';\n  const sortedConditions = [...conditionalMessages].sort((a, b) => (b.priority || 0) - (a.priority || 0));\n  \n  // Add variables to track conditional parse mode and keyboard\n  code += `${indentLevel}conditional_parse_mode = None\\n`;\n  code += `${indentLevel}conditional_keyboard = None\\n`;\n  \n  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –µ–¥–∏–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n  code += `${indentLevel}# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n`;\n  code += `${indentLevel}def check_user_variable(var_name, user_data_dict):\\n`;\n  code += `${indentLevel}    \"\"\"–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"\"\"\\n`;\n  code += `${indentLevel}    # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤ –ø–æ–ª–µ user_data (–∏–∑ –ë–î)\\n`;\n  code += `${indentLevel}    if \"user_data\" in user_data_dict and user_data_dict[\"user_data\"]:\\n`;\n  code += `${indentLevel}        try:\\n`;\n  code += `${indentLevel}            import json\\n`;\n  code += `${indentLevel}            parsed_data = json.loads(user_data_dict[\"user_data\"]) if isinstance(user_data_dict[\"user_data\"], str) else user_data_dict[\"user_data\"]\\n`;\n  code += `${indentLevel}            if var_name in parsed_data:\\n`;\n  code += `${indentLevel}                raw_value = parsed_data[var_name]\\n`;\n  code += `${indentLevel}                if isinstance(raw_value, dict) and \"value\" in raw_value:\\n`;\n  code += `${indentLevel}                    var_value = raw_value[\"value\"]\\n`;\n  code += `${indentLevel}                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–µ\\n`;\n  code += `${indentLevel}                    if var_value is not None and str(var_value).strip() != \"\":\\n`;\n  code += `${indentLevel}                        return True, str(var_value)\\n`;\n  code += `${indentLevel}                else:\\n`;\n  code += `${indentLevel}                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–µ\\n`;\n  code += `${indentLevel}                    if raw_value is not None and str(raw_value).strip() != \"\":\\n`;\n  code += `${indentLevel}                        return True, str(raw_value)\\n`;\n  code += `${indentLevel}        except (json.JSONDecodeError, TypeError):\\n`;\n  code += `${indentLevel}            pass\\n`;\n  code += `${indentLevel}    \\n`;\n  code += `${indentLevel}    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ user_data)\\n`;\n  code += `${indentLevel}    if var_name in user_data_dict:\\n`;\n  code += `${indentLevel}        variable_data = user_data_dict.get(var_name)\\n`;\n  code += `${indentLevel}        if isinstance(variable_data, dict) and \"value\" in variable_data:\\n`;\n  code += `${indentLevel}            var_value = variable_data[\"value\"]\\n`;\n  code += `${indentLevel}            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–µ\\n`;\n  code += `${indentLevel}            if var_value is not None and str(var_value).strip() != \"\":\\n`;\n  code += `${indentLevel}                return True, str(var_value)\\n`;\n  code += `${indentLevel}        elif variable_data is not None and str(variable_data).strip() != \"\":\\n`;\n  code += `${indentLevel}            return True, str(variable_data)\\n`;\n  code += `${indentLevel}    \\n`;\n  code += `${indentLevel}    return False, None\\n`;\n  code += `${indentLevel}\\n`;\n  \n  // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—É—é if/elif/else —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤—Å–µ—Ö —É—Å–ª–æ–≤–∏–π\n  for (let i = 0; i < sortedConditions.length; i++) {\n    const condition = sortedConditions[i];\n    const cleanedConditionText = stripHtmlTags(condition.messageText);\n    const conditionText = formatTextForPython(cleanedConditionText);\n    const conditionKeyword = i === 0 ? 'if' : 'elif';\n    \n    // Get variable names - support both new array format and legacy single variable\n    const variableNames = condition.variableNames && condition.variableNames.length > 0 \n      ? condition.variableNames \n      : (condition.variableName ? [condition.variableName] : []);\n    \n    const logicOperator = condition.logicOperator || 'AND';\n    \n    code += `${indentLevel}# –£—Å–ª–æ–≤–∏–µ ${i + 1}: ${condition.condition} –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: ${variableNames.join(', ')}\\n`;\n    \n    switch (condition.condition) {\n      case 'user_data_exists':\n        if (variableNames.length === 0) {\n          code += `${indentLevel}${conditionKeyword} False:  # –ù–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\\n`;\n          code += `${indentLevel}    pass\\n`;\n          break;\n        }\n        \n        // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—ã–π –±–ª–æ–∫ —É—Å–ª–æ–≤–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –í–ù–£–¢–†–ò\n        code += `${indentLevel}${conditionKeyword} (\\n`;\n        for (let j = 0; j < variableNames.length; j++) {\n          const varName = variableNames[j];\n          const operator = (j === variableNames.length - 1) ? '' : (logicOperator === 'AND' ? ' and' : ' or');\n          code += `${indentLevel}    check_user_variable(\"${varName}\", user_data_dict)[0]${operator}\\n`;\n        }\n        code += `${indentLevel}):\\n`;\n        \n        // –í–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —É—Å–ª–æ–≤–∏—è —Å–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n        code += `${indentLevel}    # –°–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\\n`;\n        code += `${indentLevel}    variable_values = {}\\n`;\n        for (const varName of variableNames) {\n          code += `${indentLevel}    _, variable_values[\"${varName}\"] = check_user_variable(\"${varName}\", user_data_dict)\\n`;\n        }\n        \n        code += `${indentLevel}    text = ${conditionText}\\n`;\n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º parse_mode –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        const parseMode1 = getParseMode(condition.formatMode || 'text');\n        if (parseMode1) {\n          code += `${indentLevel}    conditional_parse_mode = \"${parseMode1}\"\\n`;\n        } else {\n          code += `${indentLevel}    conditional_parse_mode = None\\n`;\n        }\n        \n        // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç–µ\n        for (const varName of variableNames) {\n          code += `${indentLevel}    if \"{${varName}}\" in text and variable_values[\"${varName}\"] is not None:\\n`;\n          code += `${indentLevel}        text = text.replace(\"{${varName}}\", variable_values[\"${varName}\"])\\n`;\n        }\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        code += generateConditionalKeyboard(condition, indentLevel + '    ', nodeData);\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n        code += `${indentLevel}    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n        code += `${indentLevel}    conditional_message_config = {\\n`;\n        code += `${indentLevel}        \"condition_id\": \"${condition.id}\",\\n`;\n        code += `${indentLevel}        \"wait_for_input\": ${toPythonBoolean(condition.waitForTextInput)},\\n`;\n        code += `${indentLevel}        \"input_variable\": \"${condition.textInputVariable || ''}\",\\n`;\n        code += `${indentLevel}        \"next_node_id\": \"${condition.nextNodeAfterInput || ''}\",\\n`;\n        code += `${indentLevel}        \"source_type\": \"conditional_message\"\\n`;\n        code += `${indentLevel}    }\\n`;\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞\n        if (condition.waitForTextInput) {\n          code += `${indentLevel}    \\n`;\n          code += `${indentLevel}    # –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≤–≤–æ–¥–∞\\n`;\n          code += `${indentLevel}    if conditional_message_config and conditional_message_config.get(\"wait_for_input\"):\\n`;\n          code += `${indentLevel}        user_data[user_id][\"waiting_for_conditional_input\"] = conditional_message_config\\n`;\n          code += `${indentLevel}        logging.info(f\"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞: {conditional_message_config}\")\\n`;\n        }\n        \n        code += `${indentLevel}    logging.info(f\"–£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ {variable_values} (${logicOperator})\")\\n`;\n        break;\n        \n      case 'user_data_not_exists':\n        if (variableNames.length === 0) {\n          code += `${indentLevel}${conditionKeyword} False:  # –ù–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\\n`;\n          code += `${indentLevel}    pass\\n`;\n          break;\n        }\n        \n        // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—ã–π –±–ª–æ–∫ —É—Å–ª–æ–≤–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –í–ù–£–¢–†–ò (–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏)\n        code += `${indentLevel}${conditionKeyword} (\\n`;\n        for (let j = 0; j < variableNames.length; j++) {\n          const varName = variableNames[j];\n          const operator = (j === variableNames.length - 1) ? '' : (logicOperator === 'AND' ? ' and' : ' or');\n          if (logicOperator === 'AND') {\n            code += `${indentLevel}    not check_user_variable(\"${varName}\", user_data_dict)[0]${operator}\\n`;\n          } else {\n            code += `${indentLevel}    not check_user_variable(\"${varName}\", user_data_dict)[0]${operator}\\n`;\n          }\n        }\n        code += `${indentLevel}):\\n`;\n        \n        code += `${indentLevel}    text = ${conditionText}\\n`;\n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º parse_mode –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        const parseMode2 = getParseMode(condition.formatMode || 'text');\n        if (parseMode2) {\n          code += `${indentLevel}    conditional_parse_mode = \"${parseMode2}\"\\n`;\n        } else {\n          code += `${indentLevel}    conditional_parse_mode = None\\n`;\n        }\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        code += generateConditionalKeyboard(condition, indentLevel + '    ', nodeData);\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n        code += `${indentLevel}    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n        code += `${indentLevel}    conditional_message_config = {\\n`;\n        code += `${indentLevel}        \"condition_id\": \"${condition.id}\",\\n`;\n        code += `${indentLevel}        \"wait_for_input\": ${toPythonBoolean(condition.waitForTextInput)},\\n`;\n        code += `${indentLevel}        \"input_variable\": \"${condition.textInputVariable || ''}\",\\n`;\n        code += `${indentLevel}        \"next_node_id\": \"${condition.nextNodeAfterInput || ''}\",\\n`;\n        code += `${indentLevel}        \"source_type\": \"conditional_message\"\\n`;\n        code += `${indentLevel}    }\\n`;\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è user_data_not_exists\n        if (condition.waitForTextInput) {\n          code += `${indentLevel}    \\n`;\n          code += `${indentLevel}    # –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≤–≤–æ–¥–∞\\n`;\n          code += `${indentLevel}    if conditional_message_config and conditional_message_config.get(\"wait_for_input\"):\\n`;\n          code += `${indentLevel}        user_data[user_id][\"waiting_for_conditional_input\"] = conditional_message_config\\n`;\n          code += `${indentLevel}        logging.info(f\"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞: {conditional_message_config}\")\\n`;\n        }\n        \n        code += `${indentLevel}    logging.info(f\"–£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ${variableNames} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç (${logicOperator})\")\\n`;\n        break;\n        \n      case 'user_data_equals':\n        if (variableNames.length === 0) {\n          code += `${indentLevel}${conditionKeyword} False:  # –ù–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\\n`;\n          code += `${indentLevel}    pass\\n`;\n          break;\n        }\n        \n        // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—ã–π –±–ª–æ–∫ —É—Å–ª–æ–≤–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –í–ù–£–¢–†–ò\n        code += `${indentLevel}${conditionKeyword} (\\n`;\n        for (let j = 0; j < variableNames.length; j++) {\n          const varName = variableNames[j];\n          const operator = (j === variableNames.length - 1) ? '' : (logicOperator === 'AND' ? ' and' : ' or');\n          code += `${indentLevel}    check_user_variable(\"${varName}\", user_data_dict)[1] == \"${condition.expectedValue || ''}\"${operator}\\n`;\n        }\n        code += `${indentLevel}):\\n`;\n        \n        // –í–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —É—Å–ª–æ–≤–∏—è —Å–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n        code += `${indentLevel}    # –°–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\\n`;\n        code += `${indentLevel}    variable_values = {}\\n`;\n        for (const varName of variableNames) {\n          code += `${indentLevel}    _, variable_values[\"${varName}\"] = check_user_variable(\"${varName}\", user_data_dict)\\n`;\n        }\n        \n        code += `${indentLevel}    text = ${conditionText}\\n`;\n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º parse_mode –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        const parseMode3 = getParseMode(condition.formatMode || 'text');\n        if (parseMode3) {\n          code += `${indentLevel}    conditional_parse_mode = \"${parseMode3}\"\\n`;\n        } else {\n          code += `${indentLevel}    conditional_parse_mode = None\\n`;\n        }\n        \n        // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç–µ\n        for (const varName of variableNames) {\n          code += `${indentLevel}    if \"{${varName}}\" in text and variable_values[\"${varName}\"] is not None:\\n`;\n          code += `${indentLevel}        text = text.replace(\"{${varName}}\", variable_values[\"${varName}\"])\\n`;\n        }\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        code += generateConditionalKeyboard(condition, indentLevel + '    ', nodeData);\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n        code += `${indentLevel}    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n        code += `${indentLevel}    conditional_message_config = {\\n`;\n        code += `${indentLevel}        \"condition_id\": \"${condition.id}\",\\n`;\n        code += `${indentLevel}        \"wait_for_input\": ${toPythonBoolean(condition.waitForTextInput)},\\n`;\n        code += `${indentLevel}        \"input_variable\": \"${condition.textInputVariable || ''}\",\\n`;\n        code += `${indentLevel}        \"next_node_id\": \"${condition.nextNodeAfterInput || ''}\",\\n`;\n        code += `${indentLevel}        \"source_type\": \"conditional_message\"\\n`;\n        code += `${indentLevel}    }\\n`;\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è user_data_equals\n        if (condition.waitForTextInput) {\n          code += `${indentLevel}    \\n`;\n          code += `${indentLevel}    # –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≤–≤–æ–¥–∞\\n`;\n          code += `${indentLevel}    if conditional_message_config and conditional_message_config.get(\"wait_for_input\"):\\n`;\n          code += `${indentLevel}        user_data[user_id][\"waiting_for_conditional_input\"] = conditional_message_config\\n`;\n          code += `${indentLevel}        logging.info(f\"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞: {conditional_message_config}\")\\n`;\n        }\n        \n        code += `${indentLevel}    logging.info(f\"–£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ {variable_values} —Ä–∞–≤–Ω—ã '${condition.expectedValue || ''}' (${logicOperator})\")\\n`;\n        break;\n        \n      case 'user_data_contains':\n        if (variableNames.length === 0) {\n          code += `${indentLevel}${conditionKeyword} False:  # –ù–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\\n`;\n          code += `${indentLevel}    pass\\n`;\n          break;\n        }\n        \n        // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—ã–π –±–ª–æ–∫ —É—Å–ª–æ–≤–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –í–ù–£–¢–†–ò\n        code += `${indentLevel}${conditionKeyword} (\\n`;\n        for (let j = 0; j < variableNames.length; j++) {\n          const varName = variableNames[j];\n          const operator = (j === variableNames.length - 1) ? '' : (logicOperator === 'AND' ? ' and' : ' or');\n          code += `${indentLevel}    (check_user_variable(\"${varName}\", user_data_dict)[1] is not None and \"${condition.expectedValue || ''}\" in str(check_user_variable(\"${varName}\", user_data_dict)[1]))${operator}\\n`;\n        }\n        code += `${indentLevel}):\\n`;\n        \n        // –í–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —É—Å–ª–æ–≤–∏—è —Å–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n        code += `${indentLevel}    # –°–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\\n`;\n        code += `${indentLevel}    variable_values = {}\\n`;\n        for (const varName of variableNames) {\n          code += `${indentLevel}    _, variable_values[\"${varName}\"] = check_user_variable(\"${varName}\", user_data_dict)\\n`;\n        }\n        \n        code += `${indentLevel}    text = ${conditionText}\\n`;\n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º parse_mode –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        const parseMode4 = getParseMode(condition.formatMode || 'text');\n        if (parseMode4) {\n          code += `${indentLevel}    conditional_parse_mode = \"${parseMode4}\"\\n`;\n        } else {\n          code += `${indentLevel}    conditional_parse_mode = None\\n`;\n        }\n        \n        // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç–µ\n        for (const varName of variableNames) {\n          code += `${indentLevel}    if \"{${varName}}\" in text and variable_values[\"${varName}\"] is not None:\\n`;\n          code += `${indentLevel}        text = text.replace(\"{${varName}}\", variable_values[\"${varName}\"])\\n`;\n        }\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        code += generateConditionalKeyboard(condition, indentLevel + '    ', nodeData);\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n        code += `${indentLevel}    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n        code += `${indentLevel}    conditional_message_config = {\\n`;\n        code += `${indentLevel}        \"condition_id\": \"${condition.id}\",\\n`;\n        code += `${indentLevel}        \"wait_for_input\": ${toPythonBoolean(condition.waitForTextInput)},\\n`;\n        code += `${indentLevel}        \"input_variable\": \"${condition.textInputVariable || ''}\",\\n`;\n        code += `${indentLevel}        \"next_node_id\": \"${condition.nextNodeAfterInput || ''}\",\\n`;\n        code += `${indentLevel}        \"source_type\": \"conditional_message\"\\n`;\n        code += `${indentLevel}    }\\n`;\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è user_data_contains\n        if (condition.waitForTextInput) {\n          code += `${indentLevel}    \\n`;\n          code += `${indentLevel}    # –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≤–≤–æ–¥–∞\\n`;\n          code += `${indentLevel}    if conditional_message_config and conditional_message_config.get(\"wait_for_input\"):\\n`;\n          code += `${indentLevel}        user_data[user_id][\"waiting_for_conditional_input\"] = conditional_message_config\\n`;\n          code += `${indentLevel}        logging.info(f\"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞: {conditional_message_config}\")\\n`;\n        }\n        \n        code += `${indentLevel}    logging.info(f\"–£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ {variable_values} —Å–æ–¥–µ—Ä–∂–∞—Ç '${condition.expectedValue || ''}' (${logicOperator})\")\\n`;\n        break;\n        \n      case 'first_time':\n        code += `${indentLevel}${conditionKeyword} user_record.get(\"interaction_count\", 0) <= 1:\\n`;\n        code += `${indentLevel}    text = ${conditionText}\\n`;\n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º parse_mode –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        const parseMode5 = getParseMode(condition.formatMode || 'text');\n        if (parseMode5) {\n          code += `${indentLevel}    conditional_parse_mode = \"${parseMode5}\"\\n`;\n        } else {\n          code += `${indentLevel}    conditional_parse_mode = None\\n`;\n        }\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        code += generateConditionalKeyboard(condition, indentLevel + '    ', nodeData);\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n        code += `${indentLevel}    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n        code += `${indentLevel}    conditional_message_config = {\\n`;\n        code += `${indentLevel}        \"condition_id\": \"${condition.id}\",\\n`;\n        code += `${indentLevel}        \"wait_for_input\": ${toPythonBoolean(condition.waitForTextInput)},\\n`;\n        code += `${indentLevel}        \"input_variable\": \"${condition.textInputVariable || ''}\",\\n`;\n        code += `${indentLevel}        \"next_node_id\": \"${condition.nextNodeAfterInput || ''}\",\\n`;\n        code += `${indentLevel}        \"source_type\": \"conditional_message\"\\n`;\n        code += `${indentLevel}    }\\n`;\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è first_time\n        if (condition.waitForTextInput) {\n          code += `${indentLevel}    \\n`;\n          code += `${indentLevel}    # –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≤–≤–æ–¥–∞\\n`;\n          code += `${indentLevel}    if conditional_message_config and conditional_message_config.get(\"wait_for_input\"):\\n`;\n          code += `${indentLevel}        user_data[user_id][\"waiting_for_conditional_input\"] = conditional_message_config\\n`;\n          code += `${indentLevel}        logging.info(f\"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞: {conditional_message_config}\")\\n`;\n        }\n        \n        code += `${indentLevel}    logging.info(\"–£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –ø–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\")\\n`;\n        break;\n        \n      case 'returning_user':\n        code += `${indentLevel}${conditionKeyword} user_record.get(\"interaction_count\", 0) > 1:\\n`;\n        code += `${indentLevel}    text = ${conditionText}\\n`;\n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º parse_mode –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        const parseMode6 = getParseMode(condition.formatMode || 'text');\n        if (parseMode6) {\n          code += `${indentLevel}    conditional_parse_mode = \"${parseMode6}\"\\n`;\n        } else {\n          code += `${indentLevel}    conditional_parse_mode = None\\n`;\n        }\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n        code += generateConditionalKeyboard(condition, indentLevel + '    ', nodeData);\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n        code += `${indentLevel}    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n        code += `${indentLevel}    conditional_message_config = {\\n`;\n        code += `${indentLevel}        \"condition_id\": \"${condition.id}\",\\n`;\n        code += `${indentLevel}        \"wait_for_input\": ${toPythonBoolean(condition.waitForTextInput)},\\n`;\n        code += `${indentLevel}        \"input_variable\": \"${condition.textInputVariable || ''}\",\\n`;\n        code += `${indentLevel}        \"next_node_id\": \"${condition.nextNodeAfterInput || ''}\",\\n`;\n        code += `${indentLevel}        \"source_type\": \"conditional_message\"\\n`;\n        code += `${indentLevel}    }\\n`;\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è returning_user\n        if (condition.waitForTextInput) {\n          code += `${indentLevel}    \\n`;\n          code += `${indentLevel}    # –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≤–≤–æ–¥–∞\\n`;\n          code += `${indentLevel}    if conditional_message_config and conditional_message_config.get(\"wait_for_input\"):\\n`;\n          code += `${indentLevel}        user_data[user_id][\"waiting_for_conditional_input\"] = conditional_message_config\\n`;\n          code += `${indentLevel}        logging.info(f\"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞: {conditional_message_config}\")\\n`;\n        }\n        \n        code += `${indentLevel}    logging.info(\"–£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\")\\n`;\n        break;\n        \n      default:\n        code += `${indentLevel}${conditionKeyword} False:  # –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ: ${condition.condition}\\n`;\n        code += `${indentLevel}    pass\\n`;\n        break;\n    }\n  }\n  \n  // –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º else –±–ª–æ–∫ –∑–¥–µ—Å—å - –æ–Ω –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π\n  return code;\n}\n\nexport function generatePythonCode(botData: BotData, botName: string = \"MyBot\", groups: BotGroup[] = []): string {\n  const { nodes, connections } = extractNodesAndConnections(botData);\n  \n  // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ ID —É–∑–ª–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö ID\n  const allNodeIds = nodes ? nodes.map(node => node.id) : [];\n  \n  // –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ì–ï–ù–ï–†–ê–¢–û–†–ê: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞\n  console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–† –ù–ê–ß–ê–õ –†–ê–ë–û–¢–£: —É–∑–ª–æ–≤ - ${nodes?.length || 0}, —Å–≤—è–∑–µ–π - ${connections?.length || 0}`);\n  \n  // –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ —É–∑–ª—ã —Å –∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞–º–∏\n  if (nodes && nodes.length > 0) {\n    console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ —É–∑–ª—ã:');\n    nodes.forEach((node, index) => {\n      const hasMultiSelect = node.data.allowMultipleSelection;\n      const hasButtons = node.data.buttons && node.data.buttons.length > 0;\n      const continueTarget = node.data.continueButtonTarget;\n      \n      console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –£–∑–µ–ª ${index + 1}: \"${node.id}\" (—Ç–∏–ø: ${node.type})`);\n      console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†:   - allowMultipleSelection: ${node.data.allowMultipleSelection}`);\n      console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†:   - hasMultiSelect: ${hasMultiSelect}`);\n      console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†:   - –∫–Ω–æ–ø–æ–∫: ${node.data.buttons?.length || 0}`);\n      console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†:   - keyboardType: ${node.data.keyboardType || '–Ω–µ—Ç'}`);\n      console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†:   - continueButtonTarget: ${continueTarget || '–Ω–µ—Ç'}`);\n      \n      if (node.id === 'interests_result') {\n        console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: –ù–ê–ô–î–ï–ù interests_result!`);\n        console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: interests_result –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:`, JSON.stringify(node.data, null, 2));\n      }\n    });\n    \n    // –ü—Ä–æ–≤–µ—Ä–∏–º —Å–≤—è–∑–∏\n    if (connections && connections.length > 0) {\n      console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–≤—è–∑–∏:');\n      connections.forEach((conn, index) => {\n        console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –°–≤—è–∑—å ${index + 1}: ${conn.source} -> ${conn.target}`);\n      });\n    }\n  }\n  \n  let code = '\"\"\"\\n';\n  code += `${botName} - Telegram Bot\\n`;\n  code += '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é TelegramBot Builder\\n';\n  \n  const botFatherCommands = generateBotFatherCommands(nodes);\n  if (botFatherCommands) {\n    code += '\\n–ö–æ–º–∞–Ω–¥—ã –¥–ª—è @BotFather:\\n';\n    code += botFatherCommands;\n  }\n  \n  code += '\"\"\"\\n\\n';\n  \n  code += 'import asyncio\\n';\n  code += 'import logging\\n';\n  code += 'import os\\n';\n  code += 'import sys\\n';\n  code += 'import locale\\n';\n  code += 'from aiogram import Bot, Dispatcher, types, F\\n';\n  code += 'from aiogram.filters import CommandStart, Command\\n';\n  code += 'from aiogram.exceptions import TelegramBadRequest\\n';\n  code += 'from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton, BotCommand, ReplyKeyboardRemove, URLInputFile, FSInputFile\\n';\n  code += 'from aiogram.utils.keyboard import ReplyKeyboardBuilder, InlineKeyboardBuilder\\n';\n  code += 'from aiogram.enums import ParseMode\\n';\n  code += 'from typing import Optional\\n';\n  code += 'import asyncpg\\n';\n  code += 'from datetime import datetime, timezone, timedelta\\n';\n  code += 'import json\\n\\n';\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º safe_edit_or_send helper —Ñ—É–Ω–∫—Ü–∏—é\n  code += '# Safe helper for editing messages with fallback to new message\\n';\n  code += 'async def safe_edit_or_send(cbq, text, **kwargs):\\n';\n  code += '    \"\"\"\\n';\n  code += '    –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å fallback –Ω–∞ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\\n';\n  code += '    –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É \"message can\\'t be edited\" –∫–æ–≥–¥–∞ –ø—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n';\n  code += '    \"\"\"\\n';\n  code += '    try:\\n';\n  code += '        # –ï—Å–ª–∏ —É callback –æ–±—ä–µ–∫—Ç–∞ –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ edit_text (–Ω–∞–ø—Ä–∏–º–µ—Ä, MockCallback), –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ\\n';\n  code += '        if hasattr(cbq, \"edit_text\") and callable(getattr(cbq, \"edit_text\")):\\n';\n  code += '            return await cbq.edit_text(text, **kwargs)\\n';\n  code += '        # –ò–Ω–∞—á–µ –ø—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–±\\n';\n  code += '        elif (hasattr(cbq, \"message\") and cbq.message):\\n';\n  code += '            return await cbq.message.edit_text(text, **kwargs)\\n';\n  code += '        else:\\n';\n  code += '            raise Exception(\"No valid edit method found\")\\n';\n  code += '    except Exception as e:\\n';\n  code += '        # –ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\\n';\n  code += '        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ ({e}), –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\")\\n';\n  code += '        if hasattr(cbq, \"message\") and cbq.message:\\n';\n  code += '            return await cbq.message.answer(text, **kwargs)\\n';\n  code += '        else:\\n';\n  code += '            logging.error(\"–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\")\\n';\n  code += '            raise\\n\\n';\n  \n  code += '# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è Windows\\n';\n  code += 'if sys.platform.startswith(\"win\"):\\n';\n  code += '    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫—É –¥–ª—è stdout –∏ stderr\\n';\n  code += '    import codecs\\n';\n  code += '    sys.stdout = codecs.getwriter(\"utf-8\")(sys.stdout.detach())\\n';\n  code += '    sys.stderr = codecs.getwriter(\"utf-8\")(sys.stderr.detach())\\n';\n  code += '    \\n';\n  code += '    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π Python\\n';\n  code += '    if hasattr(sys.stdout, \"reconfigure\"):\\n';\n  code += '        sys.stdout.reconfigure(encoding=\"utf-8\")\\n';\n  code += '        sys.stderr.reconfigure(encoding=\"utf-8\")\\n';\n  code += '    \\n';\n  code += '    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º locale –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å UTF-8\\n';\n  code += '    try:\\n';\n  code += '        locale.setlocale(locale.LC_ALL, \"en_US.UTF-8\")\\n';\n  code += '    except locale.Error:\\n';\n  code += '        try:\\n';\n  code += '            locale.setlocale(locale.LC_ALL, \"C.UTF-8\")\\n';\n  code += '        except locale.Error:\\n';\n  code += '            pass  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ locale –Ω–∞ Windows\\n\\n';\n  \n  code += '# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–æ—Å–∫–æ–≤—Å–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏\\n';\n  code += 'def get_moscow_time():\\n';\n  code += '    \"\"\"–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ\"\"\"\\n';\n  code += '    moscow_tz = timezone(timedelta(hours=3))  # UTC+3 –¥–ª—è –ú–æ—Å–∫–≤—ã\\n';\n  code += '    return datetime.now(moscow_tz).isoformat()\\n\\n';\n  \n  code += '# –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ (–ø–æ–ª—É—á–∏—Ç–µ —É @BotFather)\\n';\n  code += 'BOT_TOKEN = \"YOUR_BOT_TOKEN_HERE\"\\n\\n';\n  \n  code += '# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è\\n';\n  code += 'logging.basicConfig(level=logging.INFO)\\n\\n';\n  \n  code += '# –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞\\n';\n  code += 'bot = Bot(token=BOT_TOKEN)\\n';\n  code += 'dp = Dispatcher()\\n\\n';\n  \n  code += '# –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π Telegram ID)\\n';\n  code += 'ADMIN_IDS = [123456789]  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤\\n\\n';\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≥—Ä—É–ø–ø\n  if (groups && groups.length > 0) {\n    code += '# –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã\\n';\n    code += 'CONNECTED_GROUPS = {\\n';\n    groups.forEach((group, index) => {\n      const groupId = group.groupId || 'None';\n      const isLast = index === groups.length - 1;\n      code += `    \"${group.name}\": {\\n`;\n      code += `        \"id\": ${groupId === 'None' ? 'None' : `\"${groupId}\"`},\\n`;\n      code += `        \"url\": \"${group.url}\",\\n`;\n      code += `        \"is_admin\": ${group.isAdmin ? 'True' : 'False'},\\n`;\n      code += `        \"chat_type\": \"${group.chatType || 'group'}\",\\n`;\n      if (group.adminRights) {\n        code += `        \"admin_rights\": ${JSON.stringify(group.adminRights, null, 12).replace(/\"/g, \"'\")},\\n`;\n      }\n      code += `        \"description\": \"${group.description || ''}\"\\n`;\n      code += `    }${isLast ? '' : ','}\\n`;\n    });\n    code += '}\\n\\n';\n  }\n  \n  code += '# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\\n';\n  code += 'DATABASE_URL = os.getenv(\"DATABASE_URL\")\\n\\n';\n  \n  code += '# –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö\\n';\n  code += 'db_pool = None\\n\\n';\n  \n  code += '# –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –¥–ª—è —Å–ª—É—á–∞–µ–≤ –±–µ–∑ –ë–î)\\n';\n  code += 'user_data = {}\\n\\n';\n\n  // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö\n  code += '\\n# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö\\n';\n  code += 'async def init_database():\\n';\n  code += '    \"\"\"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü\"\"\"\\n';\n  code += '    global db_pool\\n';\n  code += '    try:\\n';\n  code += '        db_pool = await asyncpg.create_pool(DATABASE_URL, min_size=1, max_size=10)\\n';\n  code += '        # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç\\n';\n  code += '        async with db_pool.acquire() as conn:\\n';\n  code += '            await conn.execute(\"\"\"\\n';\n  code += '                CREATE TABLE IF NOT EXISTS bot_users (\\n';\n  code += '                    user_id BIGINT PRIMARY KEY,\\n';\n  code += '                    username TEXT,\\n';\n  code += '                    first_name TEXT,\\n';\n  code += '                    last_name TEXT,\\n';\n  code += '                    registered_at TIMESTAMP DEFAULT NOW(),\\n';\n  code += '                    last_interaction TIMESTAMP DEFAULT NOW(),\\n';\n  code += '                    interaction_count INTEGER DEFAULT 0,\\n';\n  code += '                    user_data JSONB DEFAULT \\'{}\\',\\n';\n  code += '                    is_active BOOLEAN DEFAULT TRUE\\n';\n  code += '                );\\n';\n  code += '            \"\"\")\\n';\n  code += '        logging.info(\"‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞\")\\n';\n  code += '    except Exception as e:\\n';\n  code += '        logging.warning(f\"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î: {e}. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.\")\\n';\n  code += '        db_pool = None\\n\\n';\n\n  code += 'async def save_user_to_db(user_id: int, username: Optional[str] = None, first_name: Optional[str] = None, last_name: Optional[str] = None):\\n';\n  code += '    \"\"\"–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\"\"\"\\n';\n  code += '    if not db_pool:\\n';\n  code += '        return False\\n';\n  code += '    try:\\n';\n  code += '        async with db_pool.acquire() as conn:\\n';\n  code += '            await conn.execute(\"\"\"\\n';\n  code += '                INSERT INTO bot_users (user_id, username, first_name, last_name)\\n';\n  code += '                VALUES ($1, $2, $3, $4)\\n';\n  code += '                ON CONFLICT (user_id) DO UPDATE SET\\n';\n  code += '                    username = EXCLUDED.username,\\n';\n  code += '                    first_name = EXCLUDED.first_name,\\n';\n  code += '                    last_name = EXCLUDED.last_name,\\n';\n  code += '                    last_interaction = NOW(),\\n';\n  code += '                    interaction_count = bot_users.interaction_count + 1\\n';\n  code += '            \"\"\", user_id, username, first_name, last_name)\\n';\n  code += '        return True\\n';\n  code += '    except Exception as e:\\n';\n  code += '        logging.error(f\"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î: {e}\")\\n';\n  code += '        return False\\n\\n';\n\n  code += 'async def get_user_from_db(user_id: int):\\n';\n  code += '    \"\"\"–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\"\"\"\\n';\n  code += '    if not db_pool:\\n';\n  code += '        return None\\n';\n  code += '    try:\\n';\n  code += '        async with db_pool.acquire() as conn:\\n';\n  code += '            row = await conn.fetchrow(\"SELECT * FROM bot_users WHERE user_id = $1\", user_id)\\n';\n  code += '            if row:\\n';\n  code += '                # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º Record –≤ —Å–ª–æ–≤–∞—Ä—å\\n';\n  code += '                row_dict = {key: row[key] for key in row.keys()}\\n';\n  code += '                # –ï—Å–ª–∏ –µ—Å—Ç—å user_data, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ\\n';\n  code += '                if \"user_data\" in row_dict and row_dict[\"user_data\"]:\\n';\n  code += '                    user_data = row_dict[\"user_data\"]\\n';\n  code += '                    if isinstance(user_data, str):\\n';\n  code += '                        try:\\n';\n  code += '                            import json\\n';\n  code += '                            return json.loads(user_data)\\n';\n  code += '                        except (json.JSONDecodeError, TypeError):\\n';\n  code += '                            return {}\\n';\n  code += '                    elif isinstance(user_data, dict):\\n';\n  code += '                        return user_data\\n';\n  code += '                    else:\\n';\n  code += '                        return {}\\n';\n  code += '                # –ï—Å–ª–∏ –Ω–µ—Ç user_data, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª–Ω—É—é –∑–∞–ø–∏—Å—å\\n';\n  code += '                return row_dict\\n';\n  code += '        return None\\n';\n  code += '    except Exception as e:\\n';\n  code += '        logging.error(f\"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î: {e}\")\\n';\n  code += '        return None\\n\\n';\n\n  // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ handle_command_ –∫–∞–∫ –∞–ª–∏–∞—Å—ã –¥–ª—è handlers\n  code += '# –ê–ª–∏–∞—Å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤\\n';\n  code += 'async def handle_command_start(message):\\n';\n  code += '    \"\"\"–ê–ª–∏–∞—Å –¥–ª—è start_handler, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö\"\"\"\\n';\n  code += '    await start_handler(message)\\n\\n';\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º –∞–ª–∏–∞—Å—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥\n  const commandAliasNodes = (nodes || []).filter(node => node.type === 'command' && node.data.command);\n  commandAliasNodes.forEach(node => {\n    const command = node.data.command.replace('/', '');\n    const functionName = command.replace(/[^a-zA-Z0-9_]/g, '_');\n    code += `async def handle_command_${functionName}(message):\\n`;\n    code += `    \"\"\"–ê–ª–∏–∞—Å –¥–ª—è ${functionName}_handler, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö\"\"\"\\n`;\n    code += `    await ${functionName}_handler(message)\\n\\n`;\n  });\n\n  code += 'async def update_user_data_in_db(user_id: int, data_key: str, data_value):\\n';\n  code += '    \"\"\"–û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\"\"\"\\n';\n  code += '    if not db_pool:\\n';\n  code += '        return False\\n';\n  code += '    try:\\n';\n  code += '        import json\\n';\n  code += '        async with db_pool.acquire() as conn:\\n';\n  code += '            # –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—ë–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å\\n';\n  code += '            await conn.execute(\"\"\"\\n';\n  code += '                INSERT INTO bot_users (user_id) \\n';\n  code += '                VALUES ($1) \\n';\n  code += '                ON CONFLICT (user_id) DO NOTHING\\n';\n  code += '            \"\"\", user_id)\\n';\n  code += '            \\n';\n  code += '            # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n';\n  code += '            update_data = {data_key: data_value}\\n';\n  code += '            await conn.execute(\"\"\"\\n';\n  code += '                UPDATE bot_users \\n';\n  code += '                SET user_data = COALESCE(user_data, \\'{}\\'::jsonb) || $2::jsonb,\\n';\n  code += '                    last_interaction = NOW()\\n';\n  code += '                WHERE user_id = $1\\n';\n  code += '            \"\"\", user_id, json.dumps(update_data))\\n';\n  code += '        return True\\n';\n  code += '    except Exception as e:\\n';\n  code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {e}\")\\n';\n  code += '        return False\\n\\n';\n\n  // –î–æ–±–∞–≤–ª—è–µ–º –∞–ª–∏–∞—Å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n  code += 'async def save_user_data_to_db(user_id: int, data_key: str, data_value):\\n';\n  code += '    \"\"\"–ê–ª–∏–∞—Å –¥–ª—è update_user_data_in_db –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\"\"\"\\n';\n  code += '    return await update_user_data_in_db(user_id, data_key, data_value)\\n\\n';\n\n  code += 'async def update_user_variable_in_db(user_id: int, variable_name: str, variable_value: str):\\n';\n  code += '    \"\"\"–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\"\"\"\\n';\n  code += '    if not db_pool:\\n';\n  code += '        return False\\n';\n  code += '    try:\\n';\n  code += '        import json\\n';\n  code += '        async with db_pool.acquire() as conn:\\n';\n  code += '            # –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—ë–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å\\n';\n  code += '            await conn.execute(\"\"\"\\n';\n  code += '                INSERT INTO bot_users (user_id) \\n';\n  code += '                VALUES ($1) \\n';\n  code += '                ON CONFLICT (user_id) DO NOTHING\\n';\n  code += '            \"\"\", user_id)\\n';\n  code += '            \\n';\n  code += '            # –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n';\n  code += '            update_data = {variable_name: variable_value}\\n';\n  code += '            await conn.execute(\"\"\"\\n';\n  code += '                UPDATE bot_users \\n';\n  code += '                SET user_data = COALESCE(user_data, \\'{}\\'::jsonb) || $2::jsonb,\\n';\n  code += '                    last_interaction = NOW()\\n';\n  code += '                WHERE user_id = $1\\n';\n  code += '            \"\"\", user_id, json.dumps(update_data))\\n';\n  code += '        return True\\n';\n  code += '    except Exception as e:\\n';\n  code += '        logging.error(f\"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {e}\")\\n';\n  code += '        return False\\n\\n';\n\n  // –î–æ–±–∞–≤–ª—è–µ–º —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\n  code += '\\n# –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\\n';\n  code += 'async def is_admin(user_id: int) -> bool:\\n';\n  code += '    return user_id in ADMIN_IDS\\n\\n';\n  \n  code += 'async def is_private_chat(message: types.Message) -> bool:\\n';\n  code += '    return message.chat.type == \"private\"\\n\\n';\n  \n  code += 'async def check_auth(user_id: int) -> bool:\\n';\n  code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ\\n';\n  code += '    if db_pool:\\n';\n  code += '        user = await get_user_from_db(user_id)\\n';\n  code += '        return user is not None\\n';\n  code += '    return user_id in user_data\\n\\n';\n  \n  code += 'def is_local_file(url: str) -> bool:\\n';\n  code += '    \"\"\"–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ URL –ª–æ–∫–∞–ª—å–Ω—ã–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–º\"\"\"\\n';\n  code += '    return url.startswith(\"/uploads/\") or url.startswith(\"uploads/\")\\n\\n';\n  \n  code += 'def get_local_file_path(url: str) -> str:\\n';\n  code += '    \"\"\"–ü–æ–ª—É—á–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–∑ URL\"\"\"\\n';\n  code += '    if url.startswith(\"/\"):\\n';\n  code += '        return url[1:]  # –£–±–∏—Ä–∞–µ–º –≤–µ–¥—É—â–∏–π —Å–ª–µ—à\\n';\n  code += '    return url\\n\\n';\n\n  // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏\n  code += 'def extract_coordinates_from_yandex(url: str) -> tuple:\\n';\n  code += '    \"\"\"–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å—Å—ã–ª–∫–∏ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç\"\"\"\\n';\n  code += '    import re\\n';\n  code += '    # –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ ll=longitude,latitude\\n';\n  code += '    match = re.search(r\"ll=([\\\\d.-]+),([\\\\d.-]+)\", url)\\n';\n  code += '    if match:\\n';\n  code += '        return float(match.group(2)), float(match.group(1))  # lat, lon\\n';\n  code += '    # –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ /longitude,latitude/\\n';\n  code += '    match = re.search(r\"/([\\\\d.-]+),([\\\\d.-]+)/\", url)\\n';\n  code += '    if match:\\n';\n  code += '        return float(match.group(2)), float(match.group(1))  # lat, lon\\n';\n  code += '    return None, None\\n\\n';\n\n  code += 'def extract_coordinates_from_google(url: str) -> tuple:\\n';\n  code += '    \"\"\"–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å—Å—ã–ª–∫–∏ Google Maps\"\"\"\\n';\n  code += '    import re\\n';\n  code += '    # –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ @latitude,longitude\\n';\n  code += '    match = re.search(r\"@([\\\\d.-]+),([\\\\d.-]+)\", url)\\n';\n  code += '    if match:\\n';\n  code += '        return float(match.group(1)), float(match.group(2))  # lat, lon\\n';\n  code += '    # –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ /latitude,longitude/\\n';\n  code += '    match = re.search(r\"/([\\\\d.-]+),([\\\\d.-]+)/\", url)\\n';\n  code += '    if match:\\n';\n  code += '        return float(match.group(1)), float(match.group(2))  # lat, lon\\n';\n  code += '    return None, None\\n\\n';\n\n  code += 'def extract_coordinates_from_2gis(url: str) -> tuple:\\n';\n  code += '    \"\"\"–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å—Å—ã–ª–∫–∏ 2–ì–ò–°\"\"\"\\n';\n  code += '    import re\\n';\n  code += '    # –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö 2–ì–ò–°\\n';\n  code += '    # –§–æ—Ä–º–∞—Ç: center/longitude,latitude\\n';\n  code += '    match = re.search(r\"center/([\\\\d.-]+),([\\\\d.-]+)\", url)\\n';\n  code += '    if match:\\n';\n  code += '        return float(match.group(2)), float(match.group(1))  # lat, lon\\n';\n  code += '    # –§–æ—Ä–º–∞—Ç: /longitude,latitude/\\n';\n  code += '    match = re.search(r\"/([\\\\d.-]+),([\\\\d.-]+)/\", url)\\n';\n  code += '    if match:\\n';\n  code += '        return float(match.group(2)), float(match.group(1))  # lat, lon\\n';\n  code += '    return None, None\\n\\n';\n\n  code += 'def generate_map_urls(latitude: float, longitude: float, title: str = \"\") -> dict:\\n';\n  code += '    \"\"\"–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã\"\"\"\\n';\n  code += '    import urllib.parse\\n';\n  code += '    \\n';\n  code += '    encoded_title = urllib.parse.quote(title) if title else \"\"\\n';\n  code += '    \\n';\n  code += '    return {\\n';\n  code += '        \"yandex\": f\"https://yandex.ru/maps/?ll={longitude},{latitude}&z=15&l=map&pt={longitude},{latitude}\",\\n';\n  code += '        \"google\": f\"https://maps.google.com/?q={latitude},{longitude}\",\\n';\n  code += '        \"2gis\": f\"https://2gis.ru/geo/{longitude},{latitude}\",\\n';\n  code += '        \"openstreetmap\": f\"https://www.openstreetmap.org/?mlat={latitude}&mlon={longitude}&zoom=15\"\\n';\n  code += '    }\\n\\n';\n\n  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥ –¥–ª—è BotFather\n  const menuCommands = (nodes || []).filter(node => \n    (node.type === 'start' || node.type === 'command') && \n    node.data.showInMenu && \n    node.data.command\n  );\n\n  if (menuCommands.length > 0) {\n    code += '\\n# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥\\n';\n    code += 'async def set_bot_commands():\\n';\n    code += '    commands = [\\n';\n    \n    menuCommands.forEach(node => {\n      const command = node.data.command?.replace('/', '') || '';\n      const description = node.data.description || '–ö–æ–º–∞–Ω–¥–∞ –±–æ—Ç–∞';\n      code += `        BotCommand(command=\"${command}\", description=\"${description}\"),\\n`;\n    });\n    \n    code += '    ]\\n';\n    code += '    await bot.set_my_commands(commands)\\n\\n';\n  }\n\n  // Generate handlers for each node\n  (nodes || []).forEach((node: Node) => {\n    if (node.type === \"start\") {\n      code += generateStartHandler(node);\n    } else if (node.type === \"command\") {\n      code += generateCommandHandler(node);\n    } else if (node.type === \"photo\") {\n      code += generatePhotoHandler(node);\n    } else if (node.type === \"video\") {\n      code += generateVideoHandler(node);\n    } else if (node.type === \"audio\") {\n      code += generateAudioHandler(node);\n    } else if (node.type === \"document\") {\n      code += generateDocumentHandler(node);\n    } else if (node.type === \"sticker\") {\n      code += generateStickerHandler(node);\n    } else if (node.type === \"voice\") {\n      code += generateVoiceHandler(node);\n    } else if (node.type === \"animation\") {\n      code += generateAnimationHandler(node);\n    } else if (node.type === \"location\") {\n      code += generateLocationHandler(node);\n    } else if (node.type === \"contact\") {\n      code += generateContactHandler(node);\n    } else if (node.type === \"pin_message\") {\n      code += generatePinMessageHandler(node);\n    } else if (node.type === \"unpin_message\") {\n      code += generateUnpinMessageHandler(node);\n    } else if (node.type === \"delete_message\") {\n      code += generateDeleteMessageHandler(node);\n    } else if (node.type === \"ban_user\") {\n      code += generateBanUserHandler(node);\n    } else if (node.type === \"unban_user\") {\n      code += generateUnbanUserHandler(node);\n    } else if (node.type === \"mute_user\") {\n      code += generateMuteUserHandler(node);\n    } else if (node.type === \"unmute_user\") {\n      code += generateUnmuteUserHandler(node);\n    } else if (node.type === \"kick_user\") {\n      code += generateKickUserHandler(node);\n    } else if (node.type === \"promote_user\") {\n      code += generatePromoteUserHandler(node);\n    } else if (node.type === \"demote_user\") {\n      code += generateDemoteUserHandler(node);\n    } else if (node.type === \"admin_rights\") {\n      code += generateAdminRightsHandler(node);\n    }\n    // Note: user-input and message nodes are handled via callback handlers, not as separate command handlers\n  });\n\n  // Generate synonym handlers for all nodes\n  const nodesWithSynonyms = (nodes || []).filter(node => \n    node.data.synonyms && \n    node.data.synonyms.length > 0\n  );\n\n  if (nodesWithSynonyms.length > 0) {\n    code += '\\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤\\n';\n    nodesWithSynonyms.forEach(node => {\n      if (node.data.synonyms) {\n        node.data.synonyms.forEach((synonym: string) => {\n          if (node.type === 'start' || node.type === 'command') {\n            code += generateSynonymHandler(node, synonym);\n          } else if (node.type === 'ban_user' || node.type === 'unban_user' || node.type === 'mute_user' || node.type === 'unmute_user' || \n                     node.type === 'kick_user' || node.type === 'promote_user' || node.type === 'demote_user' || node.type === 'admin_rights') {\n            code += generateUserManagementSynonymHandler(node, synonym);\n          } else {\n            code += generateMessageSynonymHandler(node, synonym);\n          }\n        });\n      }\n    });\n  }\n\n  // Generate callback handlers for inline buttons AND input target nodes\n  const inlineNodes = (nodes || []).filter(node => \n    node.data.keyboardType === 'inline' && node.data.buttons && node.data.buttons.length > 0\n  );\n\n  // Also collect all target nodes from user input collections\n  const inputTargetNodeIds = new Set<string>();\n  (nodes || []).forEach(node => {\n    if (node.data.inputTargetNodeId) {\n      inputTargetNodeIds.add(node.data.inputTargetNodeId);\n    }\n  });\n\n  // Collect all referenced node IDs and conditional message buttons\n  const allReferencedNodeIds = new Set<string>();\n  const allConditionalButtons = new Set<string>();\n  \n  // Add nodes from inline buttons\n  inlineNodes.forEach(node => {\n    node.data.buttons.forEach(button => {\n      if (button.action === 'goto' && button.target) {\n        allReferencedNodeIds.add(button.target);\n      }\n    });\n    \n    // Also add continueButtonTarget for multi-select nodes\n    if (node.data.continueButtonTarget) {\n      allReferencedNodeIds.add(node.data.continueButtonTarget);\n    }\n  });\n  \n  // Collect buttons from conditional messages\n  (nodes || []).forEach(node => {\n    if (node.data.conditionalMessages) {\n      node.data.conditionalMessages.forEach((condition: any) => {\n        if (condition.buttons) {\n          condition.buttons.forEach((button: any) => {\n            if (button.action === 'goto' && button.target) {\n              allConditionalButtons.add(button.target);\n            }\n          });\n        }\n      });\n    }\n  });\n  \n  // Add input target nodes\n  inputTargetNodeIds.forEach(nodeId => {\n    allReferencedNodeIds.add(nodeId);\n  });\n\n  // Add all connection targets to ensure every connected node gets a handler\n  console.log(`üîó –ì–ï–ù–ï–†–ê–¢–û–†: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º ${connections.length} —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π`);\n  connections.forEach((connection, index) => {\n    console.log(`üîó –ì–ï–ù–ï–†–ê–¢–û–†: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ ${index}: source=${connection.source} -> target=${connection.target}`);\n    if (connection.target) {\n      allReferencedNodeIds.add(connection.target);\n      console.log(`‚úÖ –ì–ï–ù–ï–†–ê–¢–û–†: –î–æ–±–∞–≤–ª–µ–Ω target ${connection.target} –≤ allReferencedNodeIds`);\n    }\n  });\n  console.log(`üéØ –ì–ï–ù–ï–†–ê–¢–û–†: –§–∏–Ω–∞–ª—å–Ω—ã–π allReferencedNodeIds: ${Array.from(allReferencedNodeIds).join(', ')}`);\n\n  if (inlineNodes.length > 0 || allReferencedNodeIds.size > 0 || allConditionalButtons.size > 0) {\n    code += '\\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ inline –∫–Ω–æ–ø–æ–∫\\n';\n    const processedCallbacks = new Set<string>();\n    \n    // Skip conditional placeholder handlers - they conflict with main handlers\n    // Main callback handlers below will handle all button interactions properly\n    \n    // Then, handle inline button nodes - create handlers for each unique button ID\n    inlineNodes.forEach(node => {\n      node.data.buttons.forEach(button => {\n        if (button.action === 'goto' && button.id) {\n          const callbackData = button.id; // Use button ID as callback_data\n          \n          // Avoid duplicate handlers for button IDs (not target IDs)\n          if (processedCallbacks.has(callbackData)) return;\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò–∑–±–µ–≥–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è target —É–∑–ª–æ–≤\n          if (button.target && processedCallbacks.has(button.target)) {\n            console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: –ü–†–û–ü–£–°–ö–ê–ï–ú –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è target ${button.target} - —É–∂–µ —Å–æ–∑–¥–∞–Ω`);\n            return;\n          }\n          \n          // Find target node (–º–æ–∂–µ—Ç –±—ã—Ç—å null –µ—Å–ª–∏ –Ω–µ—Ç target)\n          const targetNode = button.target ? nodes.find(n => n.id === button.target) : null;\n          \n          // –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—è target –∫–∞–∫ callback_data\n          const actualCallbackData = button.target || callbackData;\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º target —É–∑–µ–ª –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞\n          if (button.target && processedCallbacks.has(button.target)) {\n            console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–† –û–°–ù–û–í–ù–û–ô –¶–ò–ö–õ: –ü–†–û–ü–£–°–ö–ê–ï–ú –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è target ${button.target} - —É–∂–µ —Å–æ–∑–¥–∞–Ω`);\n            return;\n          }\n          \n          // Mark this button ID as processed\n          processedCallbacks.add(callbackData);\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º target –≤ processedCallbacks –°–†–ê–ó–£, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è\n          if (button.target) {\n            processedCallbacks.add(button.target);\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –£–∑–µ–ª ${button.target} –¥–æ–±–∞–≤–ª–µ–Ω –≤ processedCallbacks –î–û —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞`);\n          }\n          \n          // –û–¢–õ–ê–î–ö–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ —ç—Ç–æ interests_result –∏–ª–∏ metro_selection\n          if (button.target === 'interests_result') {\n            console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: –°–æ–∑–¥–∞–µ–º –ü–ï–†–í–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è interests_result –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ');\n            console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: processedCallbacks –¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', Array.from(processedCallbacks));\n          }\n          if (button.target === 'metro_selection') {\n            console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: –°–æ–∑–¥–∞–µ–º –ü–ï–†–í–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è metro_selection –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ');\n            console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: processedCallbacks –¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', Array.from(processedCallbacks));\n          }\n          \n          // –ï—Å–ª–∏ —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª –∏–º–µ–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–Ω–æ–ø–∫–∏ \"done_\"\n          const isDoneHandlerNeeded = targetNode && targetNode.data.allowMultipleSelection && targetNode.data.continueButtonTarget;\n          const shortNodeIdForDone = isDoneHandlerNeeded ? actualCallbackData.slice(-10).replace(/^_+/, '') : '';\n          \n          // –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è interests_result\n          if (actualCallbackData === 'interests_result') {\n            console.log('üö® –ì–ï–ù–ï–†–ê–¢–û–† –û–°–ù–û–í–ù–û–ô –¶–ò–ö–õ: –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è interests_result!');\n            console.log('üö® –ì–ï–ù–ï–†–ê–¢–û–†: –¢–µ–∫—É—â–∏–µ processedCallbacks:', Array.from(processedCallbacks));\n          }\n          \n          if (isDoneHandlerNeeded) {\n            code += `\\n@dp.callback_query(lambda c: c.data == \"${actualCallbackData}\" or c.data.startswith(\"${actualCallbackData}_btn_\") or c.data == \"multi_select_done_${shortNodeIdForDone}\")\\n`;\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï! –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ \"multi_select_done_${shortNodeIdForDone}\" –¥–ª—è —É–∑–ª–∞ ${actualCallbackData}`);\n          } else {\n            code += `\\n@dp.callback_query(lambda c: c.data == \"${actualCallbackData}\" or c.data.startswith(\"${actualCallbackData}_btn_\"))\\n`;\n          }\n          // –°–æ–∑–¥–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ target –∏–ª–∏ button ID\n          const safeFunctionName = actualCallbackData.replace(/[^a-zA-Z0-9_]/g, '_');\n          \n          if (actualCallbackData === 'interests_result') {\n            console.log('üö® –ì–ï–ù–ï–†–ê–¢–û–†: –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é handle_callback_interests_result –≤ –û–°–ù–û–í–ù–û–ú –¶–ò–ö–õ–ï');\n          }\n          \n          code += `async def handle_callback_${safeFunctionName}(callback_query: types.CallbackQuery):\\n`;\n          code += '    await callback_query.answer()\\n';\n          code += '    user_id = callback_query.from_user.id\\n';\n          code += '    callback_data = callback_query.data\\n';\n          code += '    \\n';\n          \n          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–Ω–æ–ø–∫–∏ \"done_\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n          if (isDoneHandlerNeeded) {\n            code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∫–Ω–æ–ø–∫–æ–π \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n            code += `    if callback_data == \"multi_select_done_${shortNodeIdForDone}\":\\n`;\n            code += '        logging.info(f\"üèÅ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –ì–æ—Ç–æ–≤–æ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞: {callback_data}\")\\n';\n            code += '        \\n';\n            \n            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n            const multiSelectVariable = targetNode.data.multiSelectVariable || 'user_interests';\n            code += '        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n            code += `        selected_options = user_data.get(user_id, {}).get(\"multi_select_${actualCallbackData}\", [])\\n`;\n            code += '        if selected_options:\\n';\n            code += '            selected_text = \", \".join(selected_options)\\n';\n            code += `            \\n`;\n            code += `            # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–∫–∫—É–º—É–ª—è—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤\\n`;\n            code += `            # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è\\n`;\n            code += `            existing_data = await get_user_data_from_db(user_id, \"${multiSelectVariable}\")\\n`;\n            code += `            existing_selections = []\\n`;\n            code += `            if existing_data and existing_data.strip():\\n`;\n            code += `                existing_selections = [s.strip() for s in existing_data.split(\",\") if s.strip()]\\n`;\n            code += `            \\n`;\n            code += `            # –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏ –Ω–æ–≤—ã–µ –≤—ã–±–æ—Ä—ã (—É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏)\\n`;\n            code += `            all_selections = list(set(existing_selections + selected_options))\\n`;\n            code += `            final_text = \", \".join(all_selections)\\n`;\n            code += `            await update_user_data_in_db(user_id, \"${multiSelectVariable}\", final_text)\\n`;\n            code += `            logging.info(f\"‚úÖ –ê–∫–∫—É–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ${multiSelectVariable}: {final_text}\")\\n`;\n            code += '        \\n';\n            \n            // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n            code += '        # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n            code += '        if user_id in user_data:\\n';\n            code += `            user_data[user_id].pop(\"multi_select_${actualCallbackData}\", None)\\n`;\n            code += '            user_data[user_id].pop(\"multi_select_node\", None)\\n';\n            code += '            user_data[user_id].pop(\"multi_select_type\", None)\\n';\n            code += '            user_data[user_id].pop(\"multi_select_variable\", None)\\n';\n            code += '        \\n';\n            \n            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É\n            if (targetNode.data.continueButtonTarget) {\n              const nextNodeId = targetNode.data.continueButtonTarget;\n              \n              // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–¢–õ–ê–î–ö–ê\n              console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–† CONTINUEBUTTON DEBUG:`);\n              console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: targetNode.id = \"${targetNode.id}\"`);\n              console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: targetNode.data.continueButtonTarget = \"${targetNode.data.continueButtonTarget}\"`);\n              console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: nextNodeId = \"${nextNodeId}\"`);\n              console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: actualCallbackData = \"${actualCallbackData}\"`);\n              \n              code += '        # –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É\\n';\n              code += `        next_node_id = \"${nextNodeId}\"\\n`;\n              code += `        logging.info(f\"üöÄ DEBUG: targetNode.id=${targetNode.id}, continueButtonTarget=${targetNode.data.continueButtonTarget}, nextNodeId=${nextNodeId}\")\\n`;\n              \n              // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è metro_selection -> interests_result\n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ü—Ä–æ–≤–µ—Ä—è–µ–º metro_selection -> interests_result: targetNode.id=\"${targetNode.id}\", nextNodeId=\"${nextNodeId}\"`);\n              if (targetNode.id.includes('metro_selection') && nextNodeId === 'interests_result') {\n                console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É metro_selection -> interests_result`);\n                code += '        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ—Ç—Ä–æ –≤—ã–±–æ—Ä –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\\n';\n                code += `        selected_metro = user_data.get(user_id, {}).get(\"multi_select_${actualCallbackData}\", [])\\n`;\n                code += '        if user_id not in user_data:\\n';\n                code += '            user_data[user_id] = {}\\n';\n                code += '        user_data[user_id][\"saved_metro_selection\"] = selected_metro\\n';\n                code += '        user_data[user_id][\"show_metro_keyboard\"] = True\\n';\n                code += '        logging.info(f\"üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: targetNode.id={targetNode.id}, nextNodeId={nextNodeId}\")\\n';\n                code += '        logging.info(f\"üöá –°–æ—Ö—Ä–∞–Ω–∏–ª–∏ –º–µ—Ç—Ä–æ –≤—ã–±–æ—Ä: {selected_metro}, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–ª–∞–≥ show_metro_keyboard=True\")\\n';\n                code += '        \\n';\n              } else {\n                console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚ùå –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É: targetNode.id=\"${targetNode.id}\", nextNodeId=\"${nextNodeId}\"`);\n              }\n              \n              code += '        try:\\n';\n              code += `            await handle_callback_${nextNodeId.replace(/[^a-zA-Z0-9_]/g, '_')}(callback_query)\\n`;\n              code += '        except Exception as e:\\n';\n              code += '            logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É {next_node_id}: {e}\")\\n';\n              code += `            await callback_query.message.edit_text(\"–ü–µ—Ä–µ—Ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω\")\\n`;\n            } else {\n              code += '        # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n              code += `        await safe_edit_or_send(callback_query, \"‚úÖ –í—ã–±–æ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω!\")\\n`;\n            }\n            code += '        return\\n';\n            code += '    \\n';\n          }\n          \n          // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫ \"–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä\" –∏ \"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\"\n          // –≠—Ç–∏ –∫–Ω–æ–ø–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ goto –∫–Ω–æ–ø–∫–∏ –∫ start —É–∑–ª—É\n          \n          // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–Ω–æ–ø–∫–∏\n          code += `    button_text = \"${button.text}\"\\n`;\n          code += '    \\n';\n          \n          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–∑–ª–∞\n          const parentNode = node; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª –∫–∞–∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π\n          \n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É skipDataCollection –¥–ª—è –∫–Ω–æ–ø–∫–∏\n          const shouldSkipDataCollection = button.skipDataCollection === true;\n          \n          if (!shouldSkipDataCollection) {\n            if (parentNode && parentNode.data.inputVariable) {\n              const variableName = parentNode.data.inputVariable;\n              \n              // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π\n              const variableValue = 'button_text';\n              \n              code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n              code += `    await update_user_data_in_db(user_id, \"${variableName}\", ${variableValue})\\n`;\n              code += `    logging.info(f\"–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${variableName} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: \" + str(${variableValue}) + f\" (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n`;\n              code += '    \\n';\n              \n              // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π\n              code += '    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ –¥–ª—è —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π\\n';\n              code += '    if user_id in user_data:\\n';\n              code += '        # –£–¥–∞–ª—è–µ–º waiting_for_input —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–ª –¥–∞–Ω–Ω—ã–µ\\n';\n              code += '        if \"waiting_for_input\" in user_data[user_id]:\\n';\n              code += `            if user_data[user_id][\"waiting_for_input\"] == \"${parentNode.id}\":\\n`;\n              code += '                del user_data[user_id][\"waiting_for_input\"]\\n';\n              code += `                logging.info(f\"–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ –æ—á–∏—â–µ–Ω–æ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π ${variableName} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n`;\n              code += '    \\n';\n            } else {\n              // Fallback: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –∫–∞–∫ –µ—Å—Ç—å\n              code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n              code += '    timestamp = get_moscow_time()\\n';\n              code += '    response_data = button_text  # –ü—Ä–æ—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\\n';\n              code += '    await update_user_data_in_db(user_id, button_text, response_data)\\n';\n              code += '    logging.info(f\"–ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: {button_text} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n';\n            }\n          } else {\n            code += '    # –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (skipDataCollection=true)\\n';\n            code += `    logging.info(f\"–ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞: {button_text} (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–∑-–∑–∞ skipDataCollection)\")\\n`;\n          }\n          code += '    \\n';\n          \n          if (targetNode) {\n            \n            // Handle message nodes with variable saving action\n            if (targetNode.type === 'message' && targetNode.data.action === 'save_variable') {\n              const action = targetNode.data.action || 'none';\n              const variableName = targetNode.data.variableName || '';\n              const variableValue = targetNode.data.variableValue || '';\n              const successMessage = targetNode.data.successMessage || '–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';\n              \n              if (action === 'save_variable' && variableName && variableValue) {\n                code += `    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é \"${variableName}\" = \"${variableValue}\"\\n`;\n                code += `    user_data[user_id][\"${variableName}\"] = \"${variableValue}\"\\n`;\n                code += `    await update_user_variable_in_db(user_id, \"${variableName}\", \"${variableValue}\")\\n`;\n                code += `    logging.info(f\"–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: ${variableName} = ${variableValue} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n`;\n                code += '    \\n';\n                \n                if (successMessage.includes('\\n')) {\n                  code += `    success_text = \"\"\"${successMessage}\"\"\"\\n`;\n                } else {\n                  const escapedMessage = successMessage.replace(/\"/g, '\\\\\"');\n                  code += `    success_text = \"${escapedMessage}\"\\n`;\n                }\n                \n                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ–± —É—Å–ø–µ—Ö–µ\n                code += `    # –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n                code += `    if \"{${variableName}}\" in success_text:\\n`;\n                code += `        success_text = success_text.replace(\"{${variableName}}\", \"${variableValue}\")\\n`;\n                \n                code += '    await callback_query.message.edit_text(success_text)\\n';\n              }\n            }\n            // Handle regular message nodes (like source_friends, source_search, etc.)\n            else if (targetNode.type === 'message') {\n              const messageText = targetNode.data.messageText || \"–°–æ–æ–±—â–µ–Ω–∏–µ\";\n              const cleanedMessageText = stripHtmlTags(messageText);\n              const formattedText = formatTextForPython(cleanedMessageText);\n              const parseMode = getParseMode(targetNode.data.formatMode);\n              \n              code += `    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É–∑–ª–∞ ${targetNode.id}\\n`;\n              code += `    text = ${formattedText}\\n`;\n              \n              // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n              code += '    \\n';\n              code += generateUniversalVariableReplacement('    ');\n              \n              // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '    \\n';\n                code += '    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\\n';\n                code += '    user_record = await get_user_from_db(user_id)\\n';\n                code += '    if not user_record:\\n';\n                code += '        user_record = user_data.get(user_id, {})\\n';\n                code += '    user_data_dict = user_record if user_record else user_data.get(user_id, {})\\n';\n                code += generateConditionalMessageLogic(targetNode.data.conditionalMessages, '    ');\n                code += '    \\n';\n                \n                // Use conditional message if available, otherwise use default\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —É—Å–ª–æ–≤–∏–µ\\n';\n                code += '    if \"text\" not in locals():\\n';\n                code += `        text = ${formattedText}\\n`;\n                code += '    \\n';\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –µ—Å—Ç—å\\n';\n                code += '    if conditional_keyboard is not None:\\n';\n                code += '        keyboard = conditional_keyboard\\n';\n                code += '    else:\\n';\n                code += '        keyboard = None\\n';\n              } else {\n                code += '    \\n';\n                code += '    # –ë–µ–∑ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\\n';\n                code += '    keyboard = None\\n';\n              }\n              \n              // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –ò–õ–ò –æ–±—ã—á–Ω—ã–µ inline –∫–Ω–æ–ø–∫–∏\n              const hasMultipleSelection = targetNode.data.allowMultipleSelection && targetNode.data.buttons && targetNode.data.buttons.length > 0;\n              const hasRegularInlineButtons = targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0;\n              \n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –£–∑–µ–ª ${targetNode.id} - allowMultipleSelection: ${targetNode.data.allowMultipleSelection}, –∫–Ω–æ–ø–æ–∫: ${targetNode.data.buttons?.length}, keyboardType: ${targetNode.data.keyboardType}`);\n              \n              if (hasMultipleSelection || hasRegularInlineButtons) {\n                console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –°–û–ó–î–ê–ï–ú –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É–∑–ª–∞ ${targetNode.id} (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä: ${hasMultipleSelection})`);\n                code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É—Å–ª–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞\\n';\n                code += '    if keyboard is None:\\n';\n                code += '        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\\n';\n                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é generateInlineKeyboardCode\n                const keyboardCode = generateInlineKeyboardCode(targetNode.data.buttons, '        ', targetNode.id, targetNode.data, allNodeIds);\n                code += keyboardCode;\n              } else if (targetNode.data.keyboardType !== \"inline\") {\n                // –°–æ—Ö—Ä–∞–Ω—è–µ–º keyboard = None —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞\n                code += '    if keyboard is None:\\n';\n                code += '        keyboard = None\\n';\n              }\n              \n              // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\\n';\n                code += '    if \"conditional_message_config\" in locals():\\n';\n                code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω–æ –ª–∏ –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\\n';\n                code += '        wait_for_input = conditional_message_config.get(\"wait_for_input\", False)\\n';\n                code += '        if wait_for_input:\\n';\n                code += '            # –ü–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª –∏–∑ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π\\n';\n                code += '            conditional_next_node = conditional_message_config.get(\"next_node_id\")\\n';\n                code += '            if conditional_next_node:\\n';\n                code += '                next_node_id = conditional_next_node\\n';\n                code += '            else:\\n';\n                const currentNodeConnections = connections.filter(conn => conn.source === targetNode.id);\n                if (currentNodeConnections.length > 0) {\n                  const nextNodeId = currentNodeConnections[0].target;\n                  code += `                next_node_id = \"${nextNodeId}\"\\n`;\n                } else {\n                  code += '                next_node_id = None\\n';\n                }\n                code += '            \\n';\n                code += '            # –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–≤–æ–¥–∞\\n';\n                code += '            input_variable = conditional_message_config.get(\"input_variable\")\\n';\n                code += '            if not input_variable:\\n';\n                code += '                input_variable = f\"conditional_response_{conditional_message_config.get(\\'condition_id\\', \\'unknown\\')}\"\\n';\n                code += '            \\n';\n                code += '            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\\n';\n                code += '            user_data[user_id][\"waiting_for_conditional_input\"] = {\\n';\n                code += '                \"node_id\": callback_query.data,\\n';\n                code += '                \"condition_id\": conditional_message_config.get(\"condition_id\"),\\n';\n                code += '                \"next_node_id\": next_node_id,\\n';\n                code += '                \"input_variable\": input_variable,\\n';\n                code += '                \"source_type\": \"conditional_message\"\\n';\n                code += '            }\\n';\n                code += '            logging.info(f\"–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: {conditional_message_config}\")\\n';\n                code += '    \\n';\n              }\n              \n              // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —É—Å–ª–æ–≤–∏–π\n              code += '    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ\\n';\n              code += '    try:\\n';\n              code += '        if keyboard is not None:\\n';\n              code += `            await safe_edit_or_send(callback_query, text, reply_markup=keyboard${parseMode})\\n`;\n              code += '        else:\\n';\n              code += `            await safe_edit_or_send(callback_query, text${parseMode})\\n`;\n              code += '    except Exception:\\n';\n              code += '        if keyboard is not None:\\n';\n              code += `            await callback_query.message.answer(text, reply_markup=keyboard${parseMode})\\n`;\n              code += '        else:\\n';\n              code += `            await callback_query.message.answer(text${parseMode})\\n`;\n              \n              // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–ê–Ø –õ–û–ì–ò–ö–ê: –ï—Å–ª–∏ —ç—Ç–æ—Ç —É–∑–µ–ª –∏–º–µ–µ—Ç collectUserInput, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è\n              if (targetNode.data.collectUserInput === true) {\n                const inputType = targetNode.data.inputType || 'text';\n                const inputVariable = targetNode.data.inputVariable || `response_${targetNode.id}`;\n                const inputTargetNodeId = targetNode.data.inputTargetNodeId;\n                \n                // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ —É —É–∑–ª–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –ò –ù–ï–¢ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞, –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\n                if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0 && !targetNode.data.enableTextInput) {\n                  code += '    \\n';\n                  code += `    logging.info(f\"‚úÖ –£–∑–µ–ª ${targetNode.id} –∏–º–µ–µ—Ç –∫–Ω–æ–ø–∫–∏ –ë–ï–ó —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ - –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\")\\n`;\n                  code += `    # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£ —É–∑–ª–∞ –µ—Å—Ç—å inline –∫–Ω–æ–ø–∫–∏ –±–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\\n`;\n                } else {\n                  code += '    \\n';\n                  code += `    logging.info(f\"DEBUG: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è —É–∑–ª–∞ ${targetNode.id}, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${inputVariable}\")\\n`;\n                  code += '    # –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è message —É–∑–ª–∞ —Å collectUserInput\\n';\n                  code += '    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º user_data –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\\n';\n                  code += '    if user_id not in user_data:\\n';\n                  code += '        user_data[user_id] = {}\\n';\n                  code += '    user_data[user_id][\"waiting_for_input\"] = {\\n';\n                  code += `        \"type\": \"${inputType}\",\\n`;\n                  code += `        \"variable\": \"${inputVariable}\",\\n`;\n                  code += '        \"save_to_database\": True,\\n';\n                  code += `        \"node_id\": \"${targetNode.id}\",\\n`;\n                  code += `        \"next_node_id\": \"${inputTargetNodeId || ''}\",\\n`;\n                  code += `        \"min_length\": ${targetNode.data.minLength || 0},\\n`;\n                  code += `        \"max_length\": ${targetNode.data.maxLength || 0},\\n`;\n                  code += '        \"retry_message\": \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\",\\n';\n                  code += '        \"success_message\": \"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!\"\\n';\n                  code += '    }\\n';\n                  code += `    logging.info(f\"‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ: ${inputType} –≤–≤–æ–¥ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π ${inputVariable}\")\\n`;\n                }\n              }\n            }\n            // Handle different target node types\n            else if (targetNode.type === 'photo') {\n              const caption = targetNode.data.mediaCaption || targetNode.data.messageText || \"üì∏ –§–æ—Ç–æ\";\n              const imageUrl = targetNode.data.imageUrl || \"https://picsum.photos/800/600?random=1\";\n              \n              code += `    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –¥–ª—è —É–∑–ª–∞ ${targetNode.id}\\n`;\n              \n              if (caption.includes('\\n')) {\n                code += `    caption = \"\"\"${caption}\"\"\"\\n`;\n              } else {\n                const escapedCaption = caption.replace(/\"/g, '\\\\\"');\n                code += `    caption = \"${escapedCaption}\"\\n`;\n              }\n              \n              // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥–ø–∏—Å–∏\n              code += '    \\n';\n              code += generateUniversalVariableReplacement('    ');\n              code += '    caption = replace_variables_in_text(caption, user_vars)\\n';\n              \n              // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ñ–æ—Ç–æ\n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '    \\n';\n                code += '    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ñ–æ—Ç–æ\\n';\n                code += '    user_record = await get_user_from_db(user_id)\\n';\n                code += '    if not user_record:\\n';\n                code += '        user_record = user_data.get(user_id, {})\\n';\n                code += '    user_data_dict = user_record if user_record else user_data.get(user_id, {})\\n';\n                code += generateConditionalMessageLogic(targetNode.data.conditionalMessages, '    ');\n                code += '    \\n';\n                \n                // Use conditional message if available, otherwise use default caption\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –ø–æ–¥–ø–∏—Å—å –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —É—Å–ª–æ–≤–∏–µ\\n';\n                code += '    if \"text\" in locals():\\n';\n                code += '        caption = text\\n';\n                code += '    \\n';\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –µ—Å—Ç—å\\n';\n                code += '    conditional_keyboard_for_photo = conditional_keyboard\\n';\n              }\n              \n              code += `    photo_url = \"${imageUrl}\"\\n`;\n              code += '    try:\\n';\n              code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º\\n';\n              code += '        if is_local_file(photo_url):\\n';\n              code += '            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª\\n';\n              code += '            file_path = get_local_file_path(photo_url)\\n';\n              code += '            if os.path.exists(file_path):\\n';\n              code += '                photo_file = FSInputFile(file_path)\\n';\n              code += '            else:\\n';\n              code += '                raise FileNotFoundError(f\"–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}\")\\n';\n              code += '        else:\\n';\n              code += '            # –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤\\n';\n              code += '            photo_file = photo_url\\n';\n              code += '        \\n';\n              \n              // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏–ª–∏ –æ–±—ã—á–Ω—É—é\n              code += '        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —Ñ–æ—Ç–æ\\n';\n              code += '        keyboard = None\\n';\n              \n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '        if conditional_keyboard_for_photo is not None:\\n';\n                code += '            keyboard = conditional_keyboard_for_photo\\n';\n                code += '        elif '\n              } else {\n                code += '        if ';\n              }\n              \n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += 'True:  # –£ —É–∑–ª–∞ –µ—Å—Ç—å –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏\\n';\n                code += '            builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command') {\n                    // –î–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é callback_data\n                    const commandCallback = `cmd_${btn.target ? btn.target.replace('/', '') : 'unknown'}`;\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                code += '            builder.adjust(2)  # –ò—Å–ø–æ–ª—å–∑—É–µ–º 2 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏\\n';\n                code += '            keyboard = builder.as_markup()\\n';\n              } else {\n                code += 'False:  # –ù–µ—Ç –∫–Ω–æ–ø–æ–∫\\n';\n                code += '            pass\\n';\n              }\n              \n              code += '        \\n';\n              code += '        await callback_query.message.delete()\\n';\n              code += '        if keyboard is not None:\\n';\n              code += '            await bot.send_photo(callback_query.from_user.id, photo_file, caption=caption, reply_markup=keyboard)\\n';\n              code += '        else:\\n';\n              code += '            await bot.send_photo(callback_query.from_user.id, photo_file, caption=caption)\\n';\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ: {e}\")\\n';\n              code += '        await safe_edit_or_send(callback_query, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ\\\\n{caption}\")\\n';\n              \n            } else if (targetNode.type === 'video') {\n              const caption = targetNode.data.mediaCaption || targetNode.data.messageText || \"üé• –í–∏–¥–µ–æ\";\n              const videoUrl = targetNode.data.videoUrl || \"https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4\";\n              \n              code += `    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ –¥–ª—è —É–∑–ª–∞ ${targetNode.id}\\n`;\n              \n              if (caption.includes('\\n')) {\n                code += `    caption = \"\"\"${caption}\"\"\"\\n`;\n              } else {\n                const escapedCaption = caption.replace(/\"/g, '\\\\\"');\n                code += `    caption = \"${escapedCaption}\"\\n`;\n              }\n              \n              // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥–ø–∏—Å–∏\n              code += '    \\n';\n              code += generateUniversalVariableReplacement('    ');\n              code += '    caption = replace_variables_in_text(caption, user_vars)\\n';\n              \n              // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –≤–∏–¥–µ–æ\n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '    \\n';\n                code += '    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –≤–∏–¥–µ–æ\\n';\n                code += '    user_record = await get_user_from_db(user_id)\\n';\n                code += '    if not user_record:\\n';\n                code += '        user_record = user_data.get(user_id, {})\\n';\n                code += '    user_data_dict = user_record if user_record else user_data.get(user_id, {})\\n';\n                code += generateConditionalMessageLogic(targetNode.data.conditionalMessages, '    ');\n                code += '    \\n';\n                \n                // Use conditional message if available, otherwise use default caption\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –ø–æ–¥–ø–∏—Å—å –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —É—Å–ª–æ–≤–∏–µ\\n';\n                code += '    if \"text\" in locals():\\n';\n                code += '        caption = text\\n';\n                code += '    \\n';\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –µ—Å—Ç—å\\n';\n                code += '    conditional_keyboard_for_video = conditional_keyboard\\n';\n              }\n              \n              code += `    video_url = \"${videoUrl}\"\\n`;\n              code += '    try:\\n';\n              code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º\\n';\n              code += '        if is_local_file(video_url):\\n';\n              code += '            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª\\n';\n              code += '            file_path = get_local_file_path(video_url)\\n';\n              code += '            if os.path.exists(file_path):\\n';\n              code += '                video_file = FSInputFile(file_path)\\n';\n              code += '            else:\\n';\n              code += '                raise FileNotFoundError(f\"–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}\")\\n';\n              code += '        else:\\n';\n              code += '            # –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤\\n';\n              code += '            video_file = video_url\\n';\n              code += '        \\n';\n              \n              // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏–ª–∏ –æ–±—ã—á–Ω—É—é\n              code += '        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤–∏–¥–µ–æ\\n';\n              code += '        keyboard = None\\n';\n              \n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '        if conditional_keyboard_for_video is not None:\\n';\n                code += '            keyboard = conditional_keyboard_for_video\\n';\n                code += '        elif '\n              } else {\n                code += '        if ';\n              }\n              \n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += 'True:  # –£ —É–∑–ª–∞ –µ—Å—Ç—å –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏\\n';\n                code += '            builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command') {\n                    // –î–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é callback_data\n                    const commandCallback = `cmd_${btn.target ? btn.target.replace('/', '') : 'unknown'}`;\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                code += '            builder.adjust(2)  # –ò—Å–ø–æ–ª—å–∑—É–µ–º 2 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏\\n';\n                code += '            keyboard = builder.as_markup()\\n';\n              } else {\n                code += 'False:  # –ù–µ—Ç –∫–Ω–æ–ø–æ–∫\\n';\n                code += '            pass\\n';\n              }\n              \n              code += '        \\n';\n              code += '        await callback_query.message.delete()\\n';\n              code += '        if keyboard is not None:\\n';\n              code += '            await bot.send_video(callback_query.from_user.id, video_file, caption=caption, reply_markup=keyboard)\\n';\n              code += '        else:\\n';\n              code += '            await bot.send_video(callback_query.from_user.id, video_file, caption=caption)\\n';\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–∏–¥–µ–æ: {e}\")\\n';\n              code += '        await safe_edit_or_send(callback_query, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ\\\\n{caption}\")\\n';\n              \n            } else if (targetNode.type === 'audio') {\n              const caption = targetNode.data.mediaCaption || targetNode.data.messageText || \"üéµ –ê—É–¥–∏–æ\";\n              const audioUrl = targetNode.data.audioUrl || \"https://www.soundjay.com/misc/beep-07a.wav\";\n              \n              code += `    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ –¥–ª—è —É–∑–ª–∞ ${targetNode.id}\\n`;\n              \n              if (caption.includes('\\n')) {\n                code += `    caption = \"\"\"${caption}\"\"\"\\n`;\n              } else {\n                const escapedCaption = caption.replace(/\"/g, '\\\\\"');\n                code += `    caption = \"${escapedCaption}\"\\n`;\n              }\n              \n              // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥–ø–∏—Å–∏\n              code += '    \\n';\n              code += generateUniversalVariableReplacement('    ');\n              code += '    caption = replace_variables_in_text(caption, user_vars)\\n';\n              \n              // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞—É–¥–∏–æ\n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '    \\n';\n                code += '    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞—É–¥–∏–æ\\n';\n                code += '    user_record = await get_user_from_db(user_id)\\n';\n                code += '    if not user_record:\\n';\n                code += '        user_record = user_data.get(user_id, {})\\n';\n                code += '    user_data_dict = user_record if user_record else user_data.get(user_id, {})\\n';\n                code += generateConditionalMessageLogic(targetNode.data.conditionalMessages, '    ');\n                code += '    \\n';\n                \n                // Use conditional message if available, otherwise use default caption\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –ø–æ–¥–ø–∏—Å—å –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —É—Å–ª–æ–≤–∏–µ\\n';\n                code += '    if \"text\" in locals():\\n';\n                code += '        caption = text\\n';\n                code += '    \\n';\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –µ—Å—Ç—å\\n';\n                code += '    conditional_keyboard_for_audio = conditional_keyboard\\n';\n              }\n              \n              code += `    audio_url = \"${audioUrl}\"\\n`;\n              code += '    try:\\n';\n              code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º\\n';\n              code += '        if is_local_file(audio_url):\\n';\n              code += '            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª\\n';\n              code += '            file_path = get_local_file_path(audio_url)\\n';\n              code += '            if os.path.exists(file_path):\\n';\n              code += '                audio_file = FSInputFile(file_path)\\n';\n              code += '            else:\\n';\n              code += '                raise FileNotFoundError(f\"–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}\")\\n';\n              code += '        else:\\n';\n              code += '            # –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤\\n';\n              code += '            audio_file = audio_url\\n';\n              code += '        \\n';\n              \n              // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏–ª–∏ –æ–±—ã—á–Ω—É—é\n              code += '        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –∞—É–¥–∏–æ\\n';\n              code += '        keyboard = None\\n';\n              \n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '        if conditional_keyboard_for_audio is not None:\\n';\n                code += '            keyboard = conditional_keyboard_for_audio\\n';\n                code += '        elif '\n              } else {\n                code += '        if ';\n              }\n              \n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += 'True:  # –£ —É–∑–ª–∞ –µ—Å—Ç—å –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏\\n';\n                code += '            builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command' && btn.target) {\n                    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è audio nodes\n                    const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                    code += `            # –ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${btn.text} -> ${btn.target}\\n`;\n                    code += `            builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                code += '            keyboard = builder.as_markup()\\n';\n              } else {\n                code += 'False:  # –ù–µ—Ç –∫–Ω–æ–ø–æ–∫\\n';\n                code += '            pass\\n';\n              }\n              \n              code += '        \\n';\n              code += '        await callback_query.message.delete()\\n';\n              code += '        if keyboard is not None:\\n';\n              code += '            await bot.send_audio(callback_query.from_user.id, audio_file, caption=caption, reply_markup=keyboard)\\n';\n              code += '        else:\\n';\n              code += '            await bot.send_audio(callback_query.from_user.id, audio_file, caption=caption)\\n';\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞—É–¥–∏–æ: {e}\")\\n';\n              code += '        await safe_edit_or_send(callback_query, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ\\\\n{caption}\")\\n';\n              \n            } else if (targetNode.type === 'document') {\n              const caption = targetNode.data.mediaCaption || targetNode.data.messageText || \"üìÑ –î–æ–∫—É–º–µ–Ω—Ç\";\n              const documentUrl = targetNode.data.documentUrl || \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\";\n              \n              if (caption.includes('\\n')) {\n                code += `    caption = \"\"\"${caption}\"\"\"\\n`;\n              } else {\n                const escapedCaption = caption.replace(/\"/g, '\\\\\"');\n                code += `    caption = \"${escapedCaption}\"\\n`;\n              }\n              \n              code += `    document_url = \"${documentUrl}\"\\n`;\n              const documentName = targetNode.data.documentName || \"document.pdf\";\n              code += `    document_name = \"${documentName}\"\\n`;\n              code += '    try:\\n';\n              code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º\\n';\n              code += '        if is_local_file(document_url):\\n';\n              code += '            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª\\n';\n              code += '            file_path = get_local_file_path(document_url)\\n';\n              code += '            if os.path.exists(file_path):\\n';\n              code += '                document_file = FSInputFile(file_path, filename=document_name)\\n';\n              code += '            else:\\n';\n              code += '                raise FileNotFoundError(f\"–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}\")\\n';\n              code += '        else:\\n';\n              code += '            # –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤\\n';\n              code += '            document_file = URLInputFile(document_url, filename=document_name)\\n';\n              code += '        \\n';\n              \n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += '        builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command' && btn.target) {\n                    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è document nodes\n                    const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                    code += `        # –ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${btn.text} -> ${btn.target}\\n`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                code += '        keyboard = builder.as_markup()\\n';\n                code += '        await callback_query.message.delete()\\n';\n                code += '        await bot.send_document(callback_query.from_user.id, document_file, caption=caption, reply_markup=keyboard)\\n';\n              } else {\n                code += '        await callback_query.message.delete()\\n';\n                code += '        await bot.send_document(callback_query.from_user.id, document_file, caption=caption)\\n';\n              }\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: {e}\")\\n';\n              code += '        await safe_edit_or_send(callback_query, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç\\\\n{caption}\")\\n';\n              \n            } else if (targetNode.type === 'sticker') {\n              const stickerUrl = targetNode.data.stickerUrl || \"CAACAgIAAxkBAAICGGXm2KvQAAG2X8cxTmZHJkRnYwYlAAJGAANWnb0KmgiEKEZDKVQeBA\";\n              \n              code += `    sticker_url = \"${stickerUrl}\"\\n`;\n              code += '    try:\\n';\n              code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º\\n';\n              code += '        if is_local_file(sticker_url):\\n';\n              code += '            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª\\n';\n              code += '            file_path = get_local_file_path(sticker_url)\\n';\n              code += '            if os.path.exists(file_path):\\n';\n              code += '                sticker_file = FSInputFile(file_path)\\n';\n              code += '            else:\\n';\n              code += '                raise FileNotFoundError(f\"–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}\")\\n';\n              code += '        else:\\n';\n              code += '            # –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –∏–ª–∏ file_id –¥–ª—è —Å—Ç–∏–∫–µ—Ä–æ–≤\\n';\n              code += '            sticker_file = sticker_url\\n';\n              code += '        \\n';\n              \n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += '        builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command' && btn.target) {\n                    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è sticker nodes\n                    const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                    code += `        # –ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${btn.text} -> ${btn.target}\\n`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                code += '        keyboard = builder.as_markup()\\n';\n                code += '        await callback_query.message.delete()\\n';\n                code += '        await bot.send_sticker(callback_query.from_user.id, sticker_file, reply_markup=keyboard)\\n';\n              } else {\n                code += '        await callback_query.message.delete()\\n';\n                code += '        await bot.send_sticker(callback_query.from_user.id, sticker_file)\\n';\n              }\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∏–∫–µ—Ä–∞: {e}\")\\n';\n              code += '        await safe_edit_or_send(callback_query, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∏–∫–µ—Ä\")\\n';\n              \n            } else if (targetNode.type === 'voice') {\n              const voiceUrl = targetNode.data.voiceUrl || \"https://www.soundjay.com/misc/beep-07a.wav\";\n              const duration = targetNode.data.duration || 30;\n              \n              code += `    voice_url = \"${voiceUrl}\"\\n`;\n              code += `    duration = ${duration}\\n`;\n              code += '    try:\\n';\n              code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º\\n';\n              code += '        if is_local_file(voice_url):\\n';\n              code += '            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª\\n';\n              code += '            file_path = get_local_file_path(voice_url)\\n';\n              code += '            if os.path.exists(file_path):\\n';\n              code += '                voice_file = FSInputFile(file_path)\\n';\n              code += '            else:\\n';\n              code += '                raise FileNotFoundError(f\"–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}\")\\n';\n              code += '        else:\\n';\n              code += '            # –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤\\n';\n              code += '            voice_file = voice_url\\n';\n              code += '        \\n';\n              \n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += '        builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command' && btn.target) {\n                    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è voice nodes\n                    const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                    code += `        # –ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${btn.text} -> ${btn.target}\\n`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                code += '        keyboard = builder.as_markup()\\n';\n                code += '        await callback_query.message.delete()\\n';\n                code += '        await bot.send_voice(callback_query.from_user.id, voice_file, duration=duration, reply_markup=keyboard)\\n';\n              } else {\n                code += '        await callback_query.message.delete()\\n';\n                code += '        await bot.send_voice(callback_query.from_user.id, voice_file, duration=duration)\\n';\n              }\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}\")\\n';\n              code += '        await safe_edit_or_send(callback_query, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\")\\n';\n              \n            } else if (targetNode.type === 'animation') {\n              const caption = targetNode.data.mediaCaption || \"üé¨ –ê–Ω–∏–º–∞—Ü–∏—è\";\n              const animationUrl = targetNode.data.animationUrl || \"https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif\";\n              \n              if (caption.includes('\\n')) {\n                code += `    caption = \"\"\"${caption}\"\"\"\\n`;\n              } else {\n                const escapedCaption = caption.replace(/\"/g, '\\\\\"');\n                code += `    caption = \"${escapedCaption}\"\\n`;\n              }\n              \n              code += `    animation_url = \"${animationUrl}\"\\n`;\n              code += '    try:\\n';\n              code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º\\n';\n              code += '        if is_local_file(animation_url):\\n';\n              code += '            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª\\n';\n              code += '            file_path = get_local_file_path(animation_url)\\n';\n              code += '            if os.path.exists(file_path):\\n';\n              code += '                animation_file = FSInputFile(file_path)\\n';\n              code += '            else:\\n';\n              code += '                raise FileNotFoundError(f\"–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}\")\\n';\n              code += '        else:\\n';\n              code += '            # –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤\\n';\n              code += '            animation_file = animation_url\\n';\n              code += '        \\n';\n              \n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += '        builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command' && btn.target) {\n                    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è animation nodes\n                    const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                    code += `        # –ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${btn.text} -> ${btn.target}\\n`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                code += '        keyboard = builder.as_markup()\\n';\n                code += '        await callback_query.message.delete()\\n';\n                code += '        await bot.send_animation(callback_query.from_user.id, animation_file, caption=caption, reply_markup=keyboard)\\n';\n              } else {\n                code += '        await callback_query.message.delete()\\n';\n                code += '        await bot.send_animation(callback_query.from_user.id, animation_file, caption=caption)\\n';\n              }\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–∏: {e}\")\\n';\n              code += '        await safe_edit_or_send(callback_query, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é\\\\n{caption}\")\\n';\n              \n            } else if (targetNode.type === 'location') {\n              let latitude = targetNode.data.latitude || 55.7558;\n              let longitude = targetNode.data.longitude || 37.6176;\n              const title = targetNode.data.title || \"\";\n              const address = targetNode.data.address || \"\";\n              const city = targetNode.data.city || \"\";\n              const country = targetNode.data.country || \"\";\n              const mapService = targetNode.data.mapService || 'custom';\n              const generateMapPreview = targetNode.data.generateMapPreview !== false;\n              \n              code += '    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∫–∞—Ä—Ç\\n';\n              \n              if (mapService === 'yandex' && targetNode.data.yandexMapUrl) {\n                code += `    yandex_url = \"${targetNode.data.yandexMapUrl}\"\\n`;\n                code += '    extracted_lat, extracted_lon = extract_coordinates_from_yandex(yandex_url)\\n';\n                code += '    if extracted_lat and extracted_lon:\\n';\n                code += '        latitude, longitude = extracted_lat, extracted_lon\\n';\n                code += '    else:\\n';\n                code += `        latitude, longitude = ${latitude}, ${longitude}  # Fallback –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\\n`;\n              } else if (mapService === 'google' && targetNode.data.googleMapUrl) {\n                code += `    google_url = \"${targetNode.data.googleMapUrl}\"\\n`;\n                code += '    extracted_lat, extracted_lon = extract_coordinates_from_google(google_url)\\n';\n                code += '    if extracted_lat and extracted_lon:\\n';\n                code += '        latitude, longitude = extracted_lat, extracted_lon\\n';\n                code += '    else:\\n';\n                code += `        latitude, longitude = ${latitude}, ${longitude}  # Fallback –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\\n`;\n              } else if (mapService === '2gis' && targetNode.data.gisMapUrl) {\n                code += `    gis_url = \"${targetNode.data.gisMapUrl}\"\\n`;\n                code += '    extracted_lat, extracted_lon = extract_coordinates_from_2gis(gis_url)\\n';\n                code += '    if extracted_lat and extracted_lon:\\n';\n                code += '        latitude, longitude = extracted_lat, extracted_lon\\n';\n                code += '    else:\\n';\n                code += `        latitude, longitude = ${latitude}, ${longitude}  # Fallback –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\\n`;\n              } else {\n                code += `    latitude, longitude = ${latitude}, ${longitude}\\n`;\n              }\n              \n              if (title) code += `    title = \"${title}\"\\n`;\n              if (address) code += `    address = \"${address}\"\\n`;\n              \n              code += '    try:\\n';\n              code += '        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\\n';\n              code += '        await callback_query.message.delete()\\n';\n              \n              code += '        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é\\n';\n              if (title || address) {\n                code += '        await bot.send_venue(\\n';\n                code += '            callback_query.from_user.id,\\n';\n                code += '            latitude=latitude,\\n';\n                code += '            longitude=longitude,\\n';\n                code += '            title=title,\\n';\n                code += '            address=address\\n';\n                code += '        )\\n';\n              } else {\n                code += '        await bot.send_location(\\n';\n                code += '            callback_query.from_user.id,\\n';\n                code += '            latitude=latitude,\\n';\n                code += '            longitude=longitude\\n';\n                code += '        )\\n';\n              }\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: {e}\")\\n';\n              code += '        await bot.send_message(callback_query.from_user.id, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é\")\\n';\n              \n              // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ\n              if (generateMapPreview) {\n                code += '        \\n';\n                code += '        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã\\n';\n                code += '        map_urls = generate_map_urls(latitude, longitude, title)\\n';\n                code += '        \\n';\n                code += '        # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–∞—Ä—Ç\\n';\n                code += '        map_builder = InlineKeyboardBuilder()\\n';\n                code += '        map_builder.add(InlineKeyboardButton(text=\"üó∫Ô∏è –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã\", url=map_urls[\"yandex\"]))\\n';\n                code += '        map_builder.add(InlineKeyboardButton(text=\"üåç Google Maps\", url=map_urls[\"google\"]))\\n';\n                code += '        map_builder.add(InlineKeyboardButton(text=\"üìç 2–ì–ò–°\", url=map_urls[\"2gis\"]))\\n';\n                code += '        map_builder.add(InlineKeyboardButton(text=\"üåê OpenStreetMap\", url=map_urls[\"openstreetmap\"]))\\n';\n                \n                if (targetNode.data.showDirections) {\n                  code += '        # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞\\n';\n                  code += '        map_builder.add(InlineKeyboardButton(text=\"üß≠ –ú–∞—Ä—à—Ä—É—Ç (–Ø–Ω–¥–µ–∫—Å)\", url=f\"https://yandex.ru/maps/?rtext=~{latitude},{longitude}\"))\\n';\n                  code += '        map_builder.add(InlineKeyboardButton(text=\"üöó –ú–∞—Ä—à—Ä—É—Ç (Google)\", url=f\"https://maps.google.com/maps/dir//{latitude},{longitude}\"))\\n';\n                }\n                \n                code += '        map_builder.adjust(2)  # –†–∞–∑–º–µ—â–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ 2 —Å—Ç–æ–ª–±—Ü–∞\\n';\n                code += '        map_keyboard = map_builder.as_markup()\\n';\n                code += '        \\n';\n                code += '        await bot.send_message(\\n';\n                code += '            callback_query.from_user.id,\\n';\n                if (targetNode.data.showDirections) {\n                  code += '            \"üó∫Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —É–¥–æ–±–Ω–æ–º –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º —Å–µ—Ä–≤–∏—Å–µ –∏–ª–∏ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç:\",\\n';\n                } else {\n                  code += '            \"üó∫Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —É–¥–æ–±–Ω–æ–º –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º —Å–µ—Ä–≤–∏—Å–µ:\",\\n';\n                }\n                code += '            reply_markup=map_keyboard\\n';\n                code += '        )\\n';\n              }\n              \n              // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å\n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += '        \\n';\n                code += '        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏\\n';\n                code += '        builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  }\n                });\n                code += '        keyboard = builder.as_markup()\\n';\n                code += '        await bot.send_message(callback_query.from_user.id, \"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\", reply_markup=keyboard)\\n';\n              }\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è: {e}\")\\n';\n              code += '        await bot.send_message(callback_query.from_user.id, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ\")\\n';\n              \n            } else if (targetNode.type === 'contact') {\n              const phoneNumber = targetNode.data.phoneNumber || \"+7 999 123 45 67\";\n              const firstName = targetNode.data.firstName || \"–ö–æ–Ω—Ç–∞–∫—Ç\";\n              const lastName = targetNode.data.lastName || \"\";\n              const userId = targetNode.data.userId || null;\n              const vcard = targetNode.data.vcard || \"\";\n              \n              code += `    phone_number = \"${phoneNumber}\"\\n`;\n              code += `    first_name = \"${firstName}\"\\n`;\n              if (lastName) code += `    last_name = \"${lastName}\"\\n`;\n              if (userId) code += `    user_id = ${userId}\\n`;\n              if (vcard) code += `    vcard = \"\"\"${vcard}\"\"\"\\n`;\n              \n              code += '    try:\\n';\n              \n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                code += '        builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  }\n                });\n                code += '        keyboard = builder.as_markup()\\n';\n                code += '        await callback_query.message.delete()\\n';\n                if (lastName && userId && vcard) {\n                  code += '        await bot.send_contact(callback_query.from_user.id, phone_number=phone_number, first_name=first_name, last_name=last_name, user_id=user_id, vcard=vcard, reply_markup=keyboard)\\n';\n                } else if (lastName) {\n                  code += '        await bot.send_contact(callback_query.from_user.id, phone_number=phone_number, first_name=first_name, last_name=last_name, reply_markup=keyboard)\\n';\n                } else {\n                  code += '        await bot.send_contact(callback_query.from_user.id, phone_number=phone_number, first_name=first_name, reply_markup=keyboard)\\n';\n                }\n              } else {\n                code += '        await callback_query.message.delete()\\n';\n                if (lastName && userId && vcard) {\n                  code += '        await bot.send_contact(callback_query.from_user.id, phone_number=phone_number, first_name=first_name, last_name=last_name, user_id=user_id, vcard=vcard)\\n';\n                } else if (lastName) {\n                  code += '        await bot.send_contact(callback_query.from_user.id, phone_number=phone_number, first_name=first_name, last_name=last_name)\\n';\n                } else {\n                  code += '        await bot.send_contact(callback_query.from_user.id, phone_number=phone_number, first_name=first_name)\\n';\n                }\n              }\n              \n              code += '    except Exception as e:\\n';\n              code += '        logging.error(f\"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞: {e}\")\\n';\n              code += '        await safe_edit_or_send(callback_query, f\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç\")\\n';\n              \n            } else if (targetNode.type === 'user-input') {\n              // Handle user-input nodes\n              const inputPrompt = targetNode.data.messageText || targetNode.data.inputPrompt || \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç:\";\n              const responseType = targetNode.data.responseType || 'text';\n              const inputType = targetNode.data.inputType || 'text';\n              const inputVariable = targetNode.data.inputVariable || `response_${targetNode.id}`;\n              const responseOptions = targetNode.data.responseOptions || [];\n              const allowMultipleSelection = targetNode.data.allowMultipleSelection || false;\n              const inputValidation = targetNode.data.inputValidation || '';\n              const minLength = targetNode.data.minLength || 0;\n              const maxLength = targetNode.data.maxLength || 0;\n              const inputTimeout = targetNode.data.inputTimeout || 60;\n              const inputRequired = targetNode.data.inputRequired !== false;\n              const allowSkip = targetNode.data.allowSkip || false;\n              const saveToDatabase = targetNode.data.saveToDatabase || false;\n              const inputRetryMessage = targetNode.data.inputRetryMessage || \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\";\n              const inputSuccessMessage = targetNode.data.inputSuccessMessage || \"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!\";\n              const placeholder = targetNode.data.placeholder || \"\";\n              \n              code += '    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\\n';\n              code += '    await callback_query.message.delete()\\n';\n              code += '    \\n';\n              \n              // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n              const formattedPrompt = formatTextForPython(inputPrompt);\n              code += `    text = ${formattedPrompt}\\n`;\n              \n              if (responseType === 'buttons' && responseOptions.length > 0) {\n                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞\n                const buttonType = targetNode.data.buttonType || 'inline';\n                code += '    \\n';\n                code += '    # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞\\n';\n                \n                if (buttonType === 'reply') {\n                  code += '    builder = ReplyKeyboardBuilder()\\n';\n                  \n                  responseOptions.forEach((option, index) => {\n                    code += `    builder.add(KeyboardButton(text=\"${option.text}\"))\\n`;\n                  });\n                  \n                  if (allowSkip) {\n                    code += `    builder.add(KeyboardButton(text=\"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\"))\\n`;\n                  }\n                  \n                  code += '    keyboard = builder.as_markup(resize_keyboard=True, one_time_keyboard=True)\\n';\n                  code += '    await bot.send_message(callback_query.from_user.id, text, reply_markup=keyboard)\\n';\n                } else {\n                  code += '    builder = InlineKeyboardBuilder()\\n';\n                  \n                  responseOptions.forEach((option, index) => {\n                    const optionValue = option.value || option.text;\n                    code += `    builder.add(InlineKeyboardButton(text=\"${option.text}\", callback_data=\"response_${targetNode.id}_${index}\"))\\n`;\n                  });\n                  \n                  if (allowSkip) {\n                    code += `    builder.add(InlineKeyboardButton(text=\"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\", callback_data=\"skip_${targetNode.id}\"))\\n`;\n                  }\n                  \n                  code += '    keyboard = builder.as_markup()\\n';\n                  code += '    await bot.send_message(callback_query.from_user.id, text, reply_markup=keyboard)\\n';\n                }\n                code += '    \\n';\n                code += '    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç\\n';\n                code += '    if callback_query.from_user.id not in user_data:\\n';\n                code += '        user_data[callback_query.from_user.id] = {}\\n';\n                code += '    \\n';\n                // Find the next node to navigate to after successful input\n                const nextConnection = connections.find(conn => conn.source === targetNode.id);\n                const nextNodeId = nextConnection ? nextConnection.target : null;\n                \n                code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞\\n';\n                code += '    user_data[callback_query.from_user.id][\"button_response_config\"] = {\\n';\n                code += `        \"node_id\": \"${targetNode.id}\",\\n`;\n                code += `        \"variable\": \"${inputVariable}\",\\n`;\n                code += `        \"save_to_database\": ${toPythonBoolean(saveToDatabase)},\\n`;\n                code += `        \"success_message\": \"${escapeForJsonString(inputSuccessMessage)}\",\\n`;\n                code += `        \"allow_multiple\": ${toPythonBoolean(allowMultipleSelection)},\\n`;\n                code += `        \"next_node_id\": \"${nextNodeId || ''}\",\\n`;\n                code += '        \"options\": [\\n';\n                responseOptions.forEach((option, index) => {\n                  const optionValue = option.value || option.text;\n                  const optionAction = option.action || 'goto';\n                  const optionTarget = option.target || '';\n                  const optionUrl = option.url || '';\n                  code += `            {\"index\": ${index}, \"text\": \"${escapeForJsonString(option.text)}\", \"value\": \"${escapeForJsonString(optionValue)}\", \"action\": \"${optionAction}\", \"target\": \"${optionTarget}\", \"url\": \"${escapeForJsonString(optionUrl)}\"},\\n`;\n                });\n                code += '        ],\\n';\n                code += `        \"selected\": []\\n`;\n                code += '    }\\n';\n                \n              } else {\n                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞)\n                if (placeholder) {\n                  code += `    placeholder_text = \"${placeholder}\"\\n`;\n                  code += '    text += f\"\\\\n\\\\nüí° {placeholder_text}\"\\n';\n                }\n                \n                if (allowSkip) {\n                  code += '    text += \"\\\\n\\\\n‚è≠Ô∏è –ù–∞–∂–º–∏—Ç–µ /skip —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å\"\\n';\n                }\n                \n                code += '    await bot.send_message(callback_query.from_user.id, text)\\n';\n                code += '    \\n';\n                code += '    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç\\n';\n                code += '    if callback_query.from_user.id not in user_data:\\n';\n                code += '        user_data[callback_query.from_user.id] = {}\\n';\n                code += '    \\n';\n                // Find the next node to navigate to after successful input\n                const nextConnection = connections.find(conn => conn.source === targetNode.id);\n                const nextNodeId = nextConnection ? nextConnection.target : null;\n                \n                code += '    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\\n';\n                code += '    user_data[callback_query.from_user.id][\"waiting_for_input\"] = {\\n';\n                code += `        \"type\": \"${inputType}\",\\n`;\n                code += `        \"variable\": \"${inputVariable}\",\\n`;\n                code += `        \"validation\": \"${inputValidation}\",\\n`;\n                code += `        \"min_length\": ${minLength},\\n`;\n                code += `        \"max_length\": ${maxLength},\\n`;\n                code += `        \"timeout\": ${inputTimeout},\\n`;\n                code += `        \"required\": ${toPythonBoolean(inputRequired)},\\n`;\n                code += `        \"allow_skip\": ${toPythonBoolean(allowSkip)},\\n`;\n                code += `        \"save_to_database\": ${toPythonBoolean(saveToDatabase)},\\n`;\n                code += `        \"retry_message\": \"${escapeForJsonString(inputRetryMessage)}\",\\n`;\n                code += `        \"success_message\": \"${escapeForJsonString(inputSuccessMessage)}\",\\n`;\n                code += `        \"prompt\": \"${escapeForJsonString(inputPrompt)}\",\\n`;\n                code += `        \"node_id\": \"${targetNode.id}\",\\n`;\n                code += `        \"next_node_id\": \"${nextNodeId || ''}\"\\n`;\n                code += '    }\\n';\n              }\n              \n            } else if (targetNode.type === 'start') {\n              // Handle start nodes in callback queries - show start message with buttons\n              const messageText = targetNode.data.messageText || \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\";\n              const cleanedMessageText = stripHtmlTags(messageText);\n              const formattedText = formatTextForPython(cleanedMessageText);\n              const parseMode = getParseMode(targetNode.data.formatMode);\n              \n              code += `    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–∑–µ–ª start: ${targetNode.id}\\n`;\n              code += `    text = ${formattedText}\\n`;\n              \n              // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n              code += '    \\n';\n              code += generateUniversalVariableReplacement('    ');\n              \n              // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è start —É–∑–ª–æ–≤\n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '    \\n';\n                code += '    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è start —É–∑–ª–∞\\n';\n                code += '    user_record = await get_user_from_db(user_id)\\n';\n                code += '    if not user_record:\\n';\n                code += '        user_record = user_data.get(user_id, {})\\n';\n                code += '    user_data_dict = user_record if user_record else user_data.get(user_id, {})\\n';\n                code += generateConditionalMessageLogic(targetNode.data.conditionalMessages, '    ');\n                code += '    \\n';\n                \n                // Use conditional message if available, otherwise use default\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —É—Å–ª–æ–≤–∏–µ\\n';\n                code += '    if \"text\" not in locals():\\n';\n                code += `        text = ${formattedText}\\n`;\n                code += '    \\n';\n                code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –µ—Å—Ç—å\\n';\n                code += '    if conditional_keyboard is not None:\\n';\n                code += '        keyboard = conditional_keyboard\\n';\n                code += '    else:\\n';\n                code += '        keyboard = None\\n';\n              } else {\n                code += '    \\n';\n                code += '    # –ë–µ–∑ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\\n';\n                code += '    keyboard = None\\n';\n              }\n              \n              // –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è start —É–∑–ª–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —É—Å–ª–æ–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã)\n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n                code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É—Å–ª–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞\\n';\n                code += '    if keyboard is None:\\n';\n                code += '        # –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è start —É–∑–ª–∞\\n';\n                code += '        builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π callback_data –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏\n                    const baseCallbackData = btn.target || btn.id || 'no_action';\n                    const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command') {\n                    // –î–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é callback_data\n                    const commandCallback = `cmd_${btn.target ? btn.target.replace('/', '') : 'unknown'}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏\n                const columns = calculateOptimalColumns(targetNode.data.buttons, targetNode.data);\n                code += `        builder.adjust(${columns})\\n`;\n                code += '        keyboard = builder.as_markup()\\n';\n              }\n              \n              // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ start —É–∑–ª–∞\n              code += '    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ start —É–∑–ª–∞\\n';\n              code += '    try:\\n';\n              code += '        if keyboard is not None:\\n';\n              code += `            await safe_edit_or_send(callback_query, text, reply_markup=keyboard${parseMode})\\n`;\n              code += '        else:\\n';\n              code += `            await safe_edit_or_send(callback_query, text${parseMode})\\n`;\n              code += '    except Exception:\\n';\n              code += '        if keyboard is not None:\\n';\n              code += `            await callback_query.message.answer(text, reply_markup=keyboard${parseMode})\\n`;\n              code += '        else:\\n';\n              code += `            await callback_query.message.answer(text${parseMode})\\n`;\n              \n            } else if (targetNode.type === 'command') {\n              // Handle command nodes in callback queries\n              const command = targetNode.data.command || '/start';\n              const commandMessage = targetNode.data.messageText || `–í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É ${command}`;\n              const cleanedCommandMessage = stripHtmlTags(commandMessage);\n              const formattedCommandText = formatTextForPython(cleanedCommandMessage);\n              const parseMode = getParseMode(targetNode.data.formatMode);\n              \n              code += `    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–∑–µ–ª command: ${targetNode.id}\\n`;\n              code += `    text = ${formattedCommandText}\\n`;\n              \n              // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n              code += '    \\n';\n              code += generateUniversalVariableReplacement('    ');\n              \n              // –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è command —É–∑–ª–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏\n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n                code += '    # –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è command —É–∑–ª–∞\\n';\n                code += '    builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    const baseCallbackData = btn.target || btn.id || 'no_action';\n                    const callbackData = `${baseCallbackData}_btn_${index}`;\n                    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command') {\n                    const commandCallback = `cmd_${btn.target ? btn.target.replace('/', '') : 'unknown'}`;\n                    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                  }\n                });\n                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏\n                const columns = calculateOptimalColumns(targetNode.data.buttons, targetNode.data);\n                code += `    builder.adjust(${columns})\\n`;\n                code += '    keyboard = builder.as_markup()\\n';\n                code += '    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ command —É–∑–ª–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π\\n';\n                code += '    try:\\n';\n                code += `        await safe_edit_or_send(callback_query, text, reply_markup=keyboard${parseMode})\\n`;\n                code += '    except Exception:\\n';\n                code += `        await callback_query.message.answer(text, reply_markup=keyboard${parseMode})\\n`;\n              } else {\n                code += '    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ command —É–∑–ª–∞ –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\\n';\n                code += '    try:\\n';\n                code += `        await safe_edit_or_send(callback_query, text${parseMode})\\n`;\n                code += '    except Exception:\\n';\n                code += `        await callback_query.message.answer(text${parseMode})\\n`;\n              }\n              \n            } else {\n              // Universal handler for all other node types (message, photo, document, etc.)\n              code += `    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–∑–µ–ª —Ç–∏–ø–∞ ${targetNode.type}: ${targetNode.id}\\n`;\n              \n              if (targetNode.type === 'photo') {\n                // Handle photo nodes\n                const photoUrl = targetNode.data.photoUrl || targetNode.data.imageUrl || \"\";\n                const caption = targetNode.data.caption || targetNode.data.messageText || \"\";\n                const cleanedCaption = stripHtmlTags(caption);\n                const formattedCaption = formatTextForPython(cleanedCaption);\n                const parseMode = getParseMode(targetNode.data.formatMode);\n                \n                code += `    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ\\n`;\n                code += `    photo_url = \"${photoUrl}\"\\n`;\n                code += `    caption = ${formattedCaption}\\n`;\n                \n                // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –ø–æ–¥–ø–∏—Å–∏\n                code += generateUniversalVariableReplacement('    ');\n                \n                if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n                  code += '    # –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —Ñ–æ—Ç–æ\\n';\n                  code += '    builder = InlineKeyboardBuilder()\\n';\n                  targetNode.data.buttons.forEach((btn, index) => {\n                    if (btn.action === \"url\") {\n                      code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                    } else if (btn.action === 'goto') {\n                      const baseCallbackData = btn.target || btn.id || 'no_action';\n                      const callbackData = `${baseCallbackData}_btn_${index}`;\n                      code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                    }\n                  });\n                  code += '    keyboard = builder.as_markup()\\n';\n                  code += '    await callback_query.message.delete()\\n';\n                  code += `    await bot.send_photo(callback_query.from_user.id, photo=photo_url, caption=caption, reply_markup=keyboard${parseMode})\\n`;\n                } else {\n                  code += '    await callback_query.message.delete()\\n';\n                  code += `    await bot.send_photo(callback_query.from_user.id, photo=photo_url, caption=caption${parseMode})\\n`;\n                }\n                \n              } else {\n                // Handle message and other text-based nodes\n                const targetText = targetNode.data.messageText || \"–°–æ–æ–±—â–µ–Ω–∏–µ\";\n                const cleanedText = stripHtmlTags(targetText);\n                const formattedTargetText = formatTextForPython(cleanedText);\n                const parseMode = getParseMode(targetNode.data.formatMode);\n                \n                code += `    text = ${formattedTargetText}\\n`;\n                \n                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–µ\n                code += generateUniversalVariableReplacement('    ');\n                \n                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è keyboard —É–∑–ª–æ–≤ —Å collectUserInput\n                if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                  code += '    \\n';\n                  code += '    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è keyboard —É–∑–ª–∞\\n';\n                  code += '    user_record = await get_user_from_db(callback_query.from_user.id)\\n';\n                  code += '    if not user_record:\\n';\n                  code += '        user_record = user_data.get(callback_query.from_user.id, {})\\n';\n                  code += '    user_data_dict = user_record if user_record else user_data.get(callback_query.from_user.id, {})\\n';\n                  code += generateConditionalMessageLogic(targetNode.data.conditionalMessages, '    ');\n                  code += '    \\n';\n                  \n                  // Use conditional message if available, otherwise use default\n                  code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —É—Å–ª–æ–≤–∏–µ\\n';\n                  code += '    if \"text\" not in locals():\\n';\n                  code += `        text = ${formattedTargetText}\\n`;\n                  code += '    \\n';\n                  code += '    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –µ—Å—Ç—å\\n';\n                  code += '    if conditional_keyboard is not None:\\n';\n                  code += '        keyboard = conditional_keyboard\\n';\n                  code += '    else:\\n';\n                  code += '        keyboard = None\\n';\n                  code += '    \\n';\n                }\n              }\n            \n              // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª)\n              if (targetNode.data.collectUserInput === true) {\n                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞\n                const inputType = targetNode.data.inputType || 'text';\n                const inputVariable = targetNode.data.inputVariable || `response_${targetNode.id}`;\n                const saveToDatabase = targetNode.data.saveToDatabase !== false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é true –¥–ª—è collectUserInput\n                const inputTargetNodeId = targetNode.data.inputTargetNodeId;\n                \n                code += '    # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª)\\n';\n                code += '    if callback_query.from_user.id not in user_data:\\n';\n                code += '        user_data[callback_query.from_user.id] = {}\\n';\n                code += '    \\n';\n                code += '    user_data[callback_query.from_user.id][\"waiting_for_input\"] = {\\n';\n                code += `        \"type\": \"${inputType}\",\\n`;\n                code += `        \"variable\": \"${inputVariable}\",\\n`;\n                code += `        \"save_to_database\": ${toPythonBoolean(saveToDatabase)},\\n`;\n                code += `        \"node_id\": \"${targetNode.id}\",\\n`;\n                code += `        \"next_node_id\": \"${inputTargetNodeId || ''}\",\\n`;\n                code += `        \"min_length\": ${targetNode.data.minLength || 0},\\n`;\n                code += `        \"max_length\": ${targetNode.data.maxLength || 0},\\n`;\n                code += '        \"retry_message\": \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\",\\n';\n                code += '        \"success_message\": \"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!\"\\n';\n                code += '    }\\n';\n                code += '    \\n';\n                \n                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É—Å–ª–æ–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\n                if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n                  code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É—Å–ª–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—è –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞\\n';\n                  code += '    if \"keyboard\" not in locals() or keyboard is None:\\n';\n                  code += '        # –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ (+ —Å–±–æ—Ä –≤–≤–æ–¥–∞ –≤–∫–ª—é—á–µ–Ω)\\n';\n                  code += '        builder = InlineKeyboardBuilder()\\n';\n                  targetNode.data.buttons.forEach((btn, index) => {\n                    if (btn.action === \"url\") {\n                      code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                    } else if (btn.action === 'goto') {\n                      // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π callback_data –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏\n                      const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                      const uniqueCallbackData = `${callbackData}_btn_${targetNode.data.buttons.indexOf(btn)}`;\n                      code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${uniqueCallbackData}\"))\\n`;\n                    } else if (btn.action === 'command') {\n                      // –î–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é callback_data\n                      const commandCallback = `cmd_${btn.target ? btn.target.replace('/', '') : 'unknown'}`;\n                      code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                    }\n                  });\n                  // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏\n                  const columns = calculateOptimalColumns(targetNode.data.buttons, targetNode.data);\n                  code += `        builder.adjust(${columns})\\n`;\n                  code += '        keyboard = builder.as_markup()\\n';\n                  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n                  let parseModeTarget = '';\n                  if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                    parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n                  } else if (targetNode.data.formatMode === 'html') {\n                    parseModeTarget = ', parse_mode=ParseMode.HTML';\n                  }\n                  code += `    # –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\\n`;\n                  code += `    try:\\n`;\n                  code += `        await safe_edit_or_send(callback_query, text, reply_markup=keyboard${parseModeTarget})\\n`;\n                  code += `    except Exception as e:\\n`;\n                  code += `        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ.\")\\n`;\n                  code += `        await callback_query.message.answer(text, reply_markup=keyboard${parseModeTarget})\\n`;\n                } else {\n                  code += `    # –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\\n`;\n                  code += `    try:\\n`;\n                  code += `        await callback_query.message.edit_text(text)\\n`;\n                  code += `    except Exception as e:\\n`;\n                  code += `        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ.\")\\n`;\n                  code += `        await callback_query.message.answer(text)\\n`;\n                }\n                code += '    \\n';\n              } else {\n                // –û–±—ã—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞\n                \n                // Handle keyboard for target node\n                code += `    # DEBUG: –£–∑–µ–ª ${targetNode.id} - hasRegularButtons=${toPythonBoolean(targetNode.data.buttons && targetNode.data.buttons.length > 0)}, hasInputCollection=False\\n`;\n                code += `    logging.info(f\"DEBUG: –£–∑–µ–ª ${targetNode.id} –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ - keyboardType=${targetNode.data.keyboardType}, buttons=${targetNode.data.buttons ? targetNode.data.buttons.length : 0}\")\\n`;\n                if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n                  code += `    logging.info(f\"DEBUG: –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É–∑–ª–∞ ${targetNode.id} —Å ${targetNode.data.buttons.length} –∫–Ω–æ–ø–∫–∞–º–∏\")\\n`;\n                  code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∏–∑ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\\n';\n                  code += '    if \"keyboard\" not in locals() or keyboard is None:\\n';\n                  code += '        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\\n';\n                  // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é generateInlineKeyboardCode\n                  const keyboardCode = generateInlineKeyboardCode(targetNode.data.buttons, '        ', targetNode.id, targetNode.data, allNodeIds);\n                  code += keyboardCode;\n                  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n                  let parseModeTarget = '';\n                  if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                    parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n                  } else if (targetNode.data.formatMode === 'html') {\n                    parseModeTarget = ', parse_mode=ParseMode.HTML';\n                  }\n                  code += `    # –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\\n`;\n                  code += `    try:\\n`;\n                  code += `        await safe_edit_or_send(callback_query, text, reply_markup=keyboard${parseModeTarget})\\n`;\n                  code += `    except Exception as e:\\n`;\n                  code += `        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ.\")\\n`;\n                  code += `        await callback_query.message.answer(text, reply_markup=keyboard${parseModeTarget})\\n`;\n                } else if (targetNode.data.keyboardType === \"reply\" && targetNode.data.buttons.length > 0) {\n                  code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∏–∑ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\\n';\n                  code += '    if \"keyboard\" not in locals() or keyboard is None:\\n';\n                  code += '        # –°–æ–∑–¥–∞–µ–º reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\\n';\n                  code += '        builder = ReplyKeyboardBuilder()\\n';\n                  targetNode.data.buttons.forEach((btn, index) => {\n                    code += `        builder.add(KeyboardButton(text=\"${btn.text}\"))\\n`;\n                  });\n                  const resizeKeyboard = toPythonBoolean(targetNode.data.resizeKeyboard);\n                  const oneTimeKeyboard = toPythonBoolean(targetNode.data.oneTimeKeyboard);\n                  code += `        keyboard = builder.as_markup(resize_keyboard=${resizeKeyboard}, one_time_keyboard=${oneTimeKeyboard})\\n`;\n                  code += '    # –î–ª—è reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ\\n';\n                  code += '    try:\\n';\n                  code += '        await callback_query.message.delete()\\n';\n                  code += '    except:\\n';\n                  code += '        pass  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è\\n';\n                  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n                  let parseModeTarget = '';\n                  if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                    parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n                  } else if (targetNode.data.formatMode === 'html') {\n                    parseModeTarget = ', parse_mode=ParseMode.HTML';\n                  }\n                  code += `    await bot.send_message(callback_query.from_user.id, text, reply_markup=keyboard${parseModeTarget})\\n`;\n                } else {\n                  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n                  let parseModeTarget = '';\n                  if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                    parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n                  } else if (targetNode.data.formatMode === 'html') {\n                    parseModeTarget = ', parse_mode=ParseMode.HTML';\n                  }\n                  code += `    # –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\\n`;\n                  code += `    try:\\n`;\n                  code += `        await callback_query.message.edit_text(text${parseModeTarget})\\n`;\n                  code += `    except Exception as e:\\n`;\n                  code += `        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ.\")\\n`;\n                  code += `        await callback_query.message.answer(text${parseModeTarget})\\n`;\n                }\n              } // –ó–∞–∫—Ä—ã–≤–∞–µ–º else –±–ª–æ–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª)\n            } // –ó–∞–∫—Ä—ã–≤–∞–µ–º else –±–ª–æ–∫ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª)\n          } else {\n            // –ö–Ω–æ–ø–∫–∞ –±–µ–∑ —Ü–µ–ª–∏ - –ø—Ä–æ—Å—Ç–æ —É–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n            code += '    # –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞ –Ω–∏–∫—É–¥–∞ –Ω–µ –≤–µ–¥–µ—Ç\\n';\n            code += '    await callback_query.answer(\"‚ö†Ô∏è –≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞\", show_alert=True)\\n';\n          }\n        } else if (button.action === 'command' && button.id) {\n          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ —Å –¥–µ–π—Å—Ç–≤–∏–µ–º \"command\"\n          const callbackData = `cmd_${button.target ? button.target.replace('/', '') : 'unknown'}`;\n          \n          // Avoid duplicate handlers\n          if (processedCallbacks.has(callbackData)) return;\n          processedCallbacks.add(callbackData);\n          \n          code += `\\n@dp.callback_query(lambda c: c.data == \"${callbackData}\")\\n`;\n          const safeFunctionName = callbackData.replace(/[^a-zA-Z0-9_]/g, '_');\n          code += `async def handle_callback_${safeFunctionName}(callback_query: types.CallbackQuery):\\n`;\n          code += '    await callback_query.answer()\\n';\n          code += '    user_id = callback_query.from_user.id\\n';\n          code += `    button_text = \"${button.text}\"\\n`;\n          code += '    \\n';\n          code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n          code += '    timestamp = get_moscow_time()\\n';\n          code += '    response_data = button_text\\n';\n          code += '    await update_user_data_in_db(user_id, button_text, response_data)\\n';\n          code += `    logging.info(f\"–ö–æ–º–∞–Ω–¥–∞ ${button.target || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ callback –∫–Ω–æ–ø–∫—É (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n`;\n          code += '    \\n';\n          \n          // –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è callback –∫–Ω–æ–ø–æ–∫\n          if (button.target) {\n            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É - —É–±–∏—Ä–∞–µ–º –≤–µ–¥—É—â–∏–π —Å–ª–µ—à –µ—Å–ª–∏ –µ—Å—Ç—å\n            const command = button.target.startsWith('/') ? button.target.replace('/', '') : button.target;\n            const handlerName = `${command}_handler`;\n            \n            code += `    # –í—ã–∑—ã–≤–∞–µ–º ${handlerName} –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ edit_text\\n`;\n            code += '    # –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è\\n';\n            code += '    class FakeMessageEdit:\\n';\n            code += '        def __init__(self, callback_query):\\n';\n            code += '            self.from_user = callback_query.from_user\\n';\n            code += '            self.chat = callback_query.message.chat\\n';\n            code += '            self.date = callback_query.message.date\\n';\n            code += '            self.message_id = callback_query.message.message_id\\n';\n            code += '            self._callback_query = callback_query\\n';\n            code += '        \\n';\n            code += '        async def answer(self, text, parse_mode=None, reply_markup=None):\\n';\n            code += '            await self._callback_query.message.edit_text(text, parse_mode=parse_mode, reply_markup=reply_markup)\\n';\n            code += '        \\n';\n            code += '        async def edit_text(self, text, parse_mode=None, reply_markup=None):\\n';\n            code += '            await self._callback_query.message.edit_text(text, parse_mode=parse_mode, reply_markup=reply_markup)\\n';\n            code += '    \\n';\n            code += '    fake_edit_message = FakeMessageEdit(callback_query)\\n';\n            code += `    await ${handlerName}(fake_edit_message)\\n`;\n          } else {\n            code += '    await callback_query.message.edit_text(\"‚ùå –ö–æ–º–∞–Ω–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞\")\\n';\n          }\n        }\n      });\n    });\n    \n    // CRITICAL FIX: Ensure interests_result gets a handler BUT avoid duplicates\n    console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–† CRITICAL FIX: –ü—Ä–æ–≤–µ—Ä—è–µ–º interests_result –æ–±—Ä–∞–±–æ—Ç—á–∏–∫');\n    console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: processedCallbacks –ø–µ—Ä–µ–¥ check:', Array.from(processedCallbacks));\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ interests_result —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ\n    const wasInterestsResultProcessed = processedCallbacks.has('interests_result');\n    console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: interests_result —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ?', wasInterestsResultProcessed);\n    \n    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–ï —Å–æ–∑–¥–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å\n    if (wasInterestsResultProcessed) {\n      console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ü–†–û–ü–£–°–ö–ê–ï–ú —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è interests_result');\n      console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: interests_result —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ, –∏–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä');\n    } else {\n      console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è interests_result (–Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ)');\n      processedCallbacks.add('interests_result');\n      const interestsResultNode = nodes.find(n => n.id === 'interests_result');\n      if (interestsResultNode) {\n        processedCallbacks.add('interests_result');\n        code += `\\n@dp.callback_query(lambda c: c.data == \"interests_result\" or c.data.startswith(\"interests_result_btn_\"))\\n`;\n        code += `async def handle_callback_interests_result(callback_query: types.CallbackQuery):\\n`;\n        code += '    await callback_query.answer()\\n';\n        code += '    # Handle interests_result node\\n';\n        code += '    user_id = callback_query.from_user.id\\n';\n        \n        // Add the full message handling for interests_result node\n        const messageText = interestsResultNode.data.messageText || \"–†–µ–∑—É–ª—å—Ç–∞—Ç\";\n        const cleanedMessageText = stripHtmlTags(messageText);\n        const formattedText = formatTextForPython(cleanedMessageText);\n        \n        code += `    text = ${formattedText}\\n`;\n        code += '    \\n';\n        code += generateUniversalVariableReplacement('    ');\n        \n        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è interests_result - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ—Ç—Ä–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\n        console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º interests_result —É–∑–µ–ª - –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É');\n        code += '    # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –º–µ—Ç—Ä–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\\n';\n        code += '    logging.info(\"üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: –í–æ—à–ª–∏ –≤ —É–∑–µ–ª interests_result\")\\n';\n        code += '    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–ª–∞–≥ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–Ω —Ç–∞–º –µ—Å—Ç—å\\n';\n        code += '    user_vars = await get_user_from_db(user_id)\\n';\n        code += '    if not user_vars:\\n';\n        code += '        user_vars = user_data.get(user_id, {})\\n';\n        code += '        logging.info(\"üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: user_vars –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ user_data\")\\n';\n        code += '    else:\\n';\n        code += '        logging.info(\"üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: user_vars –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\")\\n';\n        code += '    \\n';\n        code += '    show_metro_keyboard = False\\n';\n        code += '    if isinstance(user_vars, dict):\\n';\n        code += '        if \"show_metro_keyboard\" in user_vars:\\n';\n        code += '            show_metro_keyboard = str(user_vars[\"show_metro_keyboard\"]).lower() == \"true\"\\n';\n        code += '            logging.info(f\"üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: –ù–∞—à–ª–∏ show_metro_keyboard –≤ user_vars: {show_metro_keyboard}\")\\n';\n        code += '    \\n';\n        code += '    # –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ\\n';\n        code += '    if not show_metro_keyboard:\\n';\n        code += '        show_metro_keyboard = user_data.get(user_id, {}).get(\"show_metro_keyboard\", False)\\n';\n        code += '        logging.info(f\"üîß –ì–ï–ù–ï–†–ê–¢–û–† DEBUG: –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: {show_metro_keyboard}\")\\n';\n        code += '    \\n';\n        code += '    saved_metro = user_data.get(user_id, {}).get(\"saved_metro_selection\", [])\\n';\n        code += '    logging.info(f\"üöá interests_result: show_metro_keyboard={show_metro_keyboard}, saved_metro={saved_metro}\")\\n';\n        code += '    \\n';\n        \n        // –ù–∞—Ö–æ–¥–∏–º —É–∑–µ–ª metro_selection –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –µ–≥–æ –∫–Ω–æ–ø–æ–∫\n        const metroNode = nodes.find(n => n.id.includes('metro_selection'));\n        console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ü–æ–∏—Å–∫ —É–∑–ª–∞ metro_selection - –Ω–∞–π–¥–µ–Ω: ${metroNode ? '–¥–∞' : '–Ω–µ—Ç'}`);\n        if (metroNode && metroNode.data.buttons) {\n          console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –£–∑–µ–ª metro_selection –Ω–∞–π–¥–µ–Ω: ${metroNode.id}, –∫–Ω–æ–ø–æ–∫: ${metroNode.data.buttons.length}`);\n          code += '    # –°–æ–∑–¥–∞–µ–º –º–µ—Ç—Ä–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\\n';\n          code += '    if show_metro_keyboard:\\n';\n          code += '        logging.info(\"üöá –ü–û–ö–ê–ó–´–í–ê–ï–ú –º–µ—Ç—Ä–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤ interests_result\")\\n';\n          code += '        builder = InlineKeyboardBuilder()\\n';\n          \n          // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –º–µ—Ç—Ä–æ\n          metroNode.data.buttons.forEach((btn, index) => {\n            const shortNodeId = metroNode.id.slice(-10).replace(/^_+/, '');\n            const callbackData = `ms_${shortNodeId}_${btn.target || `btn_${index}`}`;\n            code += `        # –ö–Ω–æ–ø–∫–∞ –º–µ—Ç—Ä–æ: ${btn.text}\\n`;\n            code += `        selected_metro = \"${btn.text}\" in saved_metro\\n`;\n            code += `        button_text = \"‚úÖ \" + \"${btn.text}\" if selected_metro else \"${btn.text}\"\\n`;\n            code += `        builder.add(InlineKeyboardButton(text=button_text, callback_data=\"${callbackData}\"))\\n`;\n          });\n          \n          // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º callback_data –¥–ª—è handle_multi_select_done\n          const metroCallbackData = `multi_select_done_${metroNode.id}`;\n          code += `        builder.add(InlineKeyboardButton(text=\"‚úÖ –ì–æ—Ç–æ–≤–æ\", callback_data=\"${metroCallbackData}\"))\\n`;\n          code += '        builder.adjust(2)  # 2 –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥\\n';\n          code += '        metro_keyboard = builder.as_markup()\\n';\n          code += '        \\n';\n          \n          // –û–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ interests_result\n          code += '        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ interests_result\\n';\n          if (interestsResultNode.data.buttons && interestsResultNode.data.buttons.length > 0) {\n            code += '        result_builder = InlineKeyboardBuilder()\\n';\n            interestsResultNode.data.buttons.forEach((btn, index) => {\n              if (btn.action === \"goto\" && btn.target) {\n                const btnCallbackData = `${btn.target}_btn_${index}`;\n                code += `        result_builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${btnCallbackData}\"))\\n`;\n              } else if (btn.action === \"command\" && btn.target) {\n                const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                code += `        result_builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n              } else if (btn.action === \"url\") {\n                code += `        result_builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n              }\n            });\n            code += '        result_keyboard = result_builder.as_markup()\\n';\n            code += '        \\n';\n            code += '        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\\n';\n            code += '        combined_keyboard = InlineKeyboardMarkup(inline_keyboard=metro_keyboard.inline_keyboard + result_keyboard.inline_keyboard)\\n';\n            code += '        await bot.send_message(user_id, text, reply_markup=combined_keyboard)\\n';\n          } else {\n            code += '        await bot.send_message(user_id, text, reply_markup=metro_keyboard)\\n';\n          }\n          \n          code += '        # –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ show_metro_keyboard, —á—Ç–æ–±—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –∞–∫—Ç–∏–≤–Ω–æ–π\\n';\n          code += '        logging.info(\"üöá –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–µ—Ç—Ä–æ –ø–æ–∫–∞–∑–∞–Ω–∞ –∏ –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π\")\\n';\n          code += '    else:\\n';\n          code += '        # –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –º–µ—Ç—Ä–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\\n';\n          \n          // Handle buttons if any (–±–µ–∑ –º–µ—Ç—Ä–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã)\n          if (interestsResultNode.data.buttons && interestsResultNode.data.buttons.length > 0) {\n            code += '        builder = InlineKeyboardBuilder()\\n';\n            interestsResultNode.data.buttons.forEach((btn, index) => {\n              if (btn.action === \"goto\" && btn.target) {\n                const btnCallbackData = `${btn.target}_btn_${index}`;\n                code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${btnCallbackData}\"))\\n`;\n              } else if (btn.action === \"command\" && btn.target) {\n                const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n              } else if (btn.action === \"url\") {\n                code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n              }\n            });\n            code += '        keyboard = builder.as_markup()\\n';\n            code += '        await bot.send_message(user_id, text, reply_markup=keyboard)\\n';\n          } else {\n            code += '        await bot.send_message(user_id, text)\\n';\n          }\n        } else {\n          console.log('üîß –ì–ï–ù–ï–†–ê–¢–û–†: –£–∑–µ–ª metro_selection –ù–ï –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —É –Ω–µ–≥–æ –Ω–µ—Ç –∫–Ω–æ–ø–æ–∫');\n          // –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –µ—Å–ª–∏ —É–∑–ª–∞ –º–µ—Ç—Ä–æ –Ω–µ—Ç\n          code += '    logging.info(\"üöá –£–∑–µ–ª metro_selection –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –ª–æ–≥–∏–∫—É\")\\n';\n          if (interestsResultNode.data.buttons && interestsResultNode.data.buttons.length > 0) {\n            code += '    builder = InlineKeyboardBuilder()\\n';\n            interestsResultNode.data.buttons.forEach((btn, index) => {\n              if (btn.action === \"goto\" && btn.target) {\n                const btnCallbackData = `${btn.target}_btn_${index}`;\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${btnCallbackData}\"))\\n`;\n              } else if (btn.action === \"command\" && btn.target) {\n                const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n              } else if (btn.action === \"url\") {\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n              }\n            });\n            code += '    keyboard = builder.as_markup()\\n';\n            code += '    await bot.send_message(user_id, text, reply_markup=keyboard)\\n';\n          } else {\n            code += '    await bot.send_message(user_id, text)\\n';\n          }\n        }\n        code += '\\n';\n      }\n    }\n\n    // Now generate callback handlers for all remaining referenced nodes that don't have inline buttons\n    console.log(`üîç –ì–ï–ù–ï–†–ê–¢–û–†: –û–±—Ä–∞–±–æ—Ç–∫–∞ allReferencedNodeIds: ${Array.from(allReferencedNodeIds).join(', ')}`);\n    console.log(`üîç –ì–ï–ù–ï–†–ê–¢–û–†: –£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ callbacks: ${Array.from(processedCallbacks).join(', ')}`);\n    \n    allReferencedNodeIds.forEach(nodeId => {\n      console.log(`üîé –ì–ï–ù–ï–†–ê–¢–û–†: –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–∑–µ–ª ${nodeId}`);\n      if (!processedCallbacks.has(nodeId)) {\n        console.log(`‚úÖ –ì–ï–ù–ï–†–ê–¢–û–†: –£–∑–µ–ª ${nodeId} –ù–ï –±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Ä–∞–Ω–µ–µ, —Å–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫`);\n        const targetNode = nodes.find(n => n.id === nodeId);\n        if (targetNode) {\n          console.log(`üìã –ì–ï–ù–ï–†–ê–¢–û–†: –ù–∞–π–¥–µ–Ω —É–∑–µ–ª ${nodeId}, —Ç–∏–ø: ${targetNode.type}`);\n          console.log(`üìã –ì–ï–ù–ï–†–ê–¢–û–†: allowMultipleSelection: ${targetNode.data.allowMultipleSelection}`);\n          console.log(`üìã –ì–ï–ù–ï–†–ê–¢–û–†: keyboardType: ${targetNode.data.keyboardType}`);\n          console.log(`üìã –ì–ï–ù–ï–†–ê–¢–û–†: –∫–Ω–æ–ø–æ–∫: ${targetNode.data.buttons?.length || 0}`);\n          console.log(`üìã –ì–ï–ù–ï–†–ê–¢–û–†: continueButtonTarget: ${targetNode.data.continueButtonTarget || '–Ω–µ—Ç'}`);\n          \n          if (nodeId === 'interests_result') {\n            console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–† ALL_REFERENCED: –°–û–ó–î–ê–ï–ú –¢–†–ï–¢–ò–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø interests_result!`);\n            console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–† ALL_REFERENCED: interests_result –¥–∞–Ω–Ω—ã–µ:`, JSON.stringify(targetNode.data, null, 2));\n            console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–† ALL_REFERENCED: –≠–¢–û –ú–û–ñ–ï–¢ –ë–´–¢–¨ –ò–°–¢–û–ß–ù–ò–ö–û–ú –ö–û–ù–§–õ–ò–ö–¢–ê –ö–õ–ê–í–ò–ê–¢–£–†!`);\n          }\n          \n          // –í–ê–ñ–ù–û: –ù–µ —Å–æ–∑–¥–∞–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è \"start\", –µ—Å–ª–∏ –æ–Ω —É–∂–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω —Ä–∞–Ω–µ–µ (–∏–∑–±–µ–≥–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)\n          if (nodeId === 'start') {\n            console.log(`–ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–∑–ª–∞ ${nodeId} - —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ —Ä–∞–Ω–µ–µ`);\n            return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏\n          }\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º interests_result –∏ metro_selection\n          if (nodeId === 'interests_result') {\n            console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: –ü–†–û–ü–£–°–ö–ê–ï–ú –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è interests_result - —É–∂–µ —Å–æ–∑–¥–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ`);\n            return; // –ò–∑–±–µ–≥–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ interests_result\n          }\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è metro_selection\n          if (nodeId === 'metro_selection') {\n            console.log(`üö® –ì–ï–ù–ï–†–ê–¢–û–†: –ü–†–û–ü–£–°–ö–ê–ï–ú –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è metro_selection - —É–∂–µ —Å–æ–∑–¥–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ`);\n            return; // –ò–∑–±–µ–≥–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ metro_selection\n          }\n          \n          processedCallbacks.add(nodeId);\n          \n          // Create callback handler for this node that can handle multiple buttons AND multi-select \"done\" button\n          const safeFunctionName = nodeId.replace(/[^a-zA-Z0-9_]/g, '_');\n          const shortNodeIdForDone = nodeId.slice(-10).replace(/^_+/, ''); // –¢–∞–∫–æ–π –∂–µ –∫–∞–∫ –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–∏\n          code += `\\n@dp.callback_query(lambda c: c.data == \"${nodeId}\" or c.data.startswith(\"${nodeId}_btn_\") or c.data == \"done_${shortNodeIdForDone}\")\\n`;\n          code += `async def handle_callback_${safeFunctionName}(callback_query: types.CallbackQuery):\\n`;\n          code += '    await callback_query.answer()\\n';\n          code += '    user_id = callback_query.from_user.id\\n';\n          code += '    callback_data = callback_query.data\\n';\n          code += '    \\n';\n          \n          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–Ω–æ–ø–∫–∏ \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n          if (targetNode.data.allowMultipleSelection) {\n            code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∫–Ω–æ–ø–∫–æ–π \"–ì–æ—Ç–æ–≤–æ\"\\n';\n            code += `    if callback_data == \"done_${shortNodeIdForDone}\":\\n`;\n            code += '        logging.info(f\"üèÅ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –ì–æ—Ç–æ–≤–æ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞: {callback_data}\")\\n';\n            code += '        \\n';\n            \n            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n            const multiSelectVariable = targetNode.data.multiSelectVariable || 'user_interests';\n            code += '        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n            code += `        selected_options = user_data.get(user_id, {}).get(\"multi_select_${nodeId}\", [])\\n`;\n            code += '        if selected_options:\\n';\n            code += '            selected_text = \", \".join(selected_options)\\n';\n            code += `            \\n`;\n            code += `            # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–∫–∫—É–º—É–ª—è—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤\\n`;\n            code += `            # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è\\n`;\n            code += `            existing_data = await get_user_data_from_db(user_id, \"${multiSelectVariable}\")\\n`;\n            code += `            existing_selections = []\\n`;\n            code += `            if existing_data and existing_data.strip():\\n`;\n            code += `                existing_selections = [s.strip() for s in existing_data.split(\",\") if s.strip()]\\n`;\n            code += `            \\n`;\n            code += `            # –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏ –Ω–æ–≤—ã–µ –≤—ã–±–æ—Ä—ã (—É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏)\\n`;\n            code += `            all_selections = list(set(existing_selections + selected_options))\\n`;\n            code += `            final_text = \", \".join(all_selections)\\n`;\n            code += `            await update_user_data_in_db(user_id, \"${multiSelectVariable}\", final_text)\\n`;\n            code += `            logging.info(f\"‚úÖ –ê–∫–∫—É–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ${multiSelectVariable}: {final_text}\")\\n`;\n            code += '        \\n';\n            \n            // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n            code += '        # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n            code += '        if user_id in user_data:\\n';\n            code += `            user_data[user_id].pop(\"multi_select_${nodeId}\", None)\\n`;\n            code += '            user_data[user_id].pop(\"multi_select_node\", None)\\n';\n            code += '            user_data[user_id].pop(\"multi_select_type\", None)\\n';\n            code += '            user_data[user_id].pop(\"multi_select_variable\", None)\\n';\n            code += '        \\n';\n            \n            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É\n            if (targetNode.data.continueButtonTarget) {\n              const nextNodeId = targetNode.data.continueButtonTarget;\n              code += '        # –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É\\n';\n              code += `        next_node_id = \"${nextNodeId}\"\\n`;\n              code += '        try:\\n';\n              code += `            await handle_callback_${nextNodeId.replace(/[^a-zA-Z0-9_]/g, '_')}(callback_query)\\n`;\n              code += '        except Exception as e:\\n';\n              code += '            logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É {next_node_id}: {e}\")\\n';\n              code += `            await callback_query.message.edit_text(\"–ü–µ—Ä–µ—Ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω\")\\n`;\n            } else {\n              code += '        # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n              code += `        await safe_edit_or_send(callback_query, \"‚úÖ –í—ã–±–æ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω!\")\\n`;\n            }\n            code += '        return\\n';\n            code += '    \\n';\n          }\n          \n          // –û–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–∑–ª–æ–≤ –±–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏\n          \n          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–∑–ª–∞  \n          if (targetNode && targetNode.data.inputVariable) {\n            const variableName = targetNode.data.inputVariable;\n            const variableValue = 'callback_query.data';\n            \n            code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n            code += `    await update_user_data_in_db(user_id, \"${variableName}\", ${variableValue})\\n`;\n            code += `    logging.info(f\"–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${variableName} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: \" + str(${variableValue}) + f\" (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n`;\n            code += '    \\n';\n          }\n          \n          code += `    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–∑–µ–ª ${nodeId}: ${nodeId}\\n`;\n          const messageText = targetNode.data.messageText || \"–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ\";\n          const formattedText = formatTextForPython(messageText);\n          code += `    text = ${formattedText}\\n`;\n          code += '    \\n';\n          code += generateUniversalVariableReplacement('    ');\n          \n          // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º\n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ —É–∑–ª—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ selection –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n          const hasSelectionButtons = targetNode.data.buttons && targetNode.data.buttons.some(btn => btn.action === 'selection');\n          if (targetNode.data.allowMultipleSelection || hasSelectionButtons) {\n            // –£–∑–µ–ª —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º - —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\n            console.log(`üéØ –ì–ï–ù–ï–†–ê–¢–û–†: ========================================`);\n            const reason = hasSelectionButtons ? '–ò–ú–ï–ï–¢ –ö–ù–û–ü–ö–ò SELECTION' : '–ò–ú–ï–ï–¢ allowMultipleSelection=true';\n            console.log(`üéØ –ì–ï–ù–ï–†–ê–¢–û–†: –£–ó–ï–õ ${nodeId} ${reason}`);\n            console.log(`üéØ –ì–ï–ù–ï–†–ê–¢–û–†: –≠–¢–û –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–£–¢–¨ –í–´–ü–û–õ–ù–ï–ù–ò–Ø!`);\n            console.log(`üîò –ì–ï–ù–ï–†–ê–¢–û–†: –ö–Ω–æ–ø–∫–∏ —É–∑–ª–∞ ${nodeId}:`, targetNode.data.buttons?.map(b => `${b.text} (action: ${b.action})`)?.join(', ') || '–ù–ï–¢ –ö–ù–û–ü–û–ö');\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: continueButtonTarget –¥–ª—è ${nodeId}: ${targetNode.data.continueButtonTarget}`);\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: multiSelectVariable –¥–ª—è ${nodeId}: ${targetNode.data.multiSelectVariable}`);\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: hasSelectionButtons: ${hasSelectionButtons}`);\n            console.log(`üéØ –ì–ï–ù–ï–†–ê–¢–û–†: ========================================`);\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n            const multiSelectVariable = targetNode.data.multiSelectVariable || 'user_interests';\n            \n            code += '    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n            code += '    if user_id not in user_data:\\n';\n            code += '        user_data[user_id] = {}\\n';\n            code += '    \\n';\n            code += '    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã\\n';\n            code += '    saved_selections = []\\n';\n            code += '    if user_vars:\\n';\n            code += `        for var_name, var_data in user_vars.items():\\n`;\n            code += `            if var_name == \"${multiSelectVariable}\":\\n`;\n            code += '                if isinstance(var_data, dict) and \"value\" in var_data:\\n';\n            code += '                    selections_str = var_data[\"value\"]\\n';\n            code += '                elif isinstance(var_data, str):\\n';\n            code += '                    selections_str = var_data\\n';\n            code += '                else:\\n';\n            code += '                    continue\\n';\n            code += '                if selections_str and selections_str.strip():\\n';\n            code += '                    saved_selections = [sel.strip() for sel in selections_str.split(\",\") if sel.strip()]\\n';\n            code += '                    break\\n';\n            code += '    \\n';\n            code += '    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç\\n';\n            code += `    if \"multi_select_${nodeId}\" not in user_data[user_id]:\\n`;\n            code += `        user_data[user_id][\"multi_select_${nodeId}\"] = saved_selections.copy()\\n`;\n            code += `    user_data[user_id][\"multi_select_node\"] = \"${nodeId}\"\\n`;\n            code += `    user_data[user_id][\"multi_select_type\"] = \"inline\"\\n`;\n            code += `    user_data[user_id][\"multi_select_variable\"] = \"${multiSelectVariable}\"\\n`;\n            code += '    logging.info(f\"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å {len(saved_selections)} —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏\")\\n';\n            code += '    \\n';\n            \n            // –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞\n            code += '    # –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n            code += '    builder = InlineKeyboardBuilder()\\n';\n            \n            // –†–∞–∑–¥–µ–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞ –æ–ø—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –∏ –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: targetNode.data.buttons:`, targetNode.data.buttons);\n            \n            let buttonsToUse = targetNode.data.buttons || [];\n            \n            const selectionButtons = buttonsToUse.filter(button => button.action === 'selection');\n            const regularButtons = buttonsToUse.filter(button => button.action !== 'selection');\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ù–∞–π–¥–µ–Ω–æ ${selectionButtons.length} –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –∏ ${regularButtons.length} –æ–±—ã—á–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫`);\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –°–æ–∑–¥–∞–µ–º ${selectionButtons.length} –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –¥–ª—è —É–∑–ª–∞ ${nodeId}`);\n            selectionButtons.forEach((button, index) => {\n              // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ callback_data\n              const shortNodeId = generateUniqueShortId(nodeId, allNodeIds || []); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é\n              const shortTarget = (button.target || button.id || 'btn').slice(-8);\n              const callbackData = `ms_${shortNodeId}_${shortTarget}`;\n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ò–°–ü–†–ê–í–õ–ï–ù–û! –ö–Ω–æ–ø–∫–∞ ${index + 1}: \"${button.text}\" -> ${callbackData} (shortNodeId: ${shortNodeId}) (–¥–ª–∏–Ω–∞: ${callbackData.length})`);\n              code += `    # –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ ${index + 1}: ${button.text}\\n`;\n              code += `    logging.info(f\"üîò –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É: ${button.text} -> ${callbackData}\")\\n`;\n              code += `    selected_mark = \"‚úÖ \" if \"${button.text}\" in user_data[user_id][\"multi_select_${nodeId}\"] else \"\"\\n`;\n              code += `    builder.add(InlineKeyboardButton(text=f\"{selected_mark}${button.text}\", callback_data=\"${callbackData}\"))\\n`;\n            });\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ù–ê–ß–ò–ù–ê–ï–ú —Å–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è —É–∑–ª–∞ ${nodeId}`);\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: allowMultipleSelection = ${targetNode.data.allowMultipleSelection}`);\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: continueButtonTarget = ${targetNode.data.continueButtonTarget}`);\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: selectionButtons.length = ${selectionButtons.length}`);\n            \n            // –í–°–ï–ì–î–ê –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" –µ—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞\n            if (selectionButtons.length > 0) {\n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –î–û–ë–ê–í–õ–Ø–ï–ú –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" (–µ—Å—Ç—å ${selectionButtons.length} –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞)`);\n              code += '    # –ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n              const shortNodeIdDone = nodeId.slice(-10).replace(/^_+/, ''); // –£–±–∏—Ä–∞–µ–º –≤–µ–¥—É—â–∏–µ underscores\n              const doneCallbackData = `done_${shortNodeIdDone}`;\n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ö–Ω–æ–ø–∫–∞ \"–ì–æ—Ç–æ–≤–æ\" -> ${doneCallbackData} (–¥–ª–∏–Ω–∞: ${doneCallbackData.length})`);\n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –ì–ï–ù–ï–†–ò–†–£–ï–ú –∫–æ–¥ –∫–Ω–æ–ø–∫–∏ \"–ì–æ—Ç–æ–≤–æ\"!`);\n              \n              code += `    logging.info(f\"üîò –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –ì–æ—Ç–æ–≤–æ -> ${doneCallbackData}\")\\n`;\n              code += `    builder.add(InlineKeyboardButton(text=\"–ì–æ—Ç–æ–≤–æ\", callback_data=\"${doneCallbackData}\"))\\n`;\n              \n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚úÖ –£–°–ü–ï–®–ù–û –¥–æ–±–∞–≤–∏–ª–∏ –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" –≤ –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏`);\n            } else {\n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: ‚ùå –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–ì–æ—Ç–æ–≤–æ\" - –Ω–µ—Ç –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞`);\n            }  \n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (navigation –∏ –¥—Ä—É–≥–∏–µ)\n            regularButtons.forEach((btn, index) => {\n              if (btn.action === \"goto\" && btn.target) {\n                const btnCallbackData = `${btn.target}_btn_${index}`;\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${btnCallbackData}\"))\\n`;\n              } else if (btn.action === \"url\") {\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n              } else if (btn.action === \"command\" && btn.target) {\n                const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n              }\n            });\n            \n            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n            const totalButtons = selectionButtons.length + (targetNode.data.continueButtonTarget ? 1 : 0) + regularButtons.length;\n            // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º nodeData —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º\n            const multiSelectNodeData = { ...targetNode.data, allowMultipleSelection: true };\n            const columns = calculateOptimalColumns(selectionButtons, multiSelectNodeData);\n            code += `    builder.adjust(${columns})\\n`;\n            code += '    keyboard = builder.as_markup()\\n';\n            \n          } else if (targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n            // –û–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –±–µ–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n            code += '    # Create inline keyboard\\n';\n            code += '    builder = InlineKeyboardBuilder()\\n';\n            targetNode.data.buttons.forEach((btn, index) => {\n              if (btn.action === \"goto\" && btn.target) {\n                const btnCallbackData = `${btn.target}_btn_${index}`;\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${btnCallbackData}\"))\\n`;\n              } else if (btn.action === \"url\") {\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n              } else if (btn.action === \"command\" && btn.target) {\n                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\n                const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                code += `    # –ö–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${btn.text} -> ${btn.target}\\n`;\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n              } else if (btn.action === \"selection\") {\n                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —É–∑–ª–æ–≤\n                const callbackData = `multi_select_${nodeId}_${btn.target || btn.id}`;\n                code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n              }\n            });\n            code += '    keyboard = builder.as_markup()\\n';\n          } else {\n            code += '    keyboard = None\\n';\n          }\n          \n          // Send message with keyboard\n          code += '    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ\\n';\n          code += '    try:\\n';\n          code += '        if keyboard:\\n';\n          code += '            await safe_edit_or_send(callback_query, text, reply_markup=keyboard)\\n';\n          code += '        else:\\n';\n          code += '            await callback_query.message.edit_text(text)\\n';\n          code += '    except Exception:\\n';\n          code += '        if keyboard:\\n';\n          code += '            await callback_query.message.answer(text, reply_markup=keyboard)\\n';\n          code += '        else:\\n';\n          code += '            await callback_query.message.answer(text)\\n';\n          \n          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n          code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n          code += '    user_id = callback_query.from_user.id\\n';\n          code += '    \\n';\n          code += '    # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ callback_data\\n';\n          // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏\n          const sourceNode = nodes.find(n => \n            n.data.buttons && n.data.buttons.some(btn => btn.target === nodeId)\n          );\n          \n          // –ï—Å–ª–∏ –∫ —É–∑–ª—É –≤–µ–¥—É—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–Ω–æ–ø–æ–∫, –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫—É—é –∏–º–µ–Ω–Ω–æ –Ω–∞–∂–∞–ª–∏\n          let buttonsToTargetNode = [];\n          if (sourceNode) {\n            buttonsToTargetNode = sourceNode.data.buttons.filter(btn => btn.target === nodeId);\n          }\n          \n          if (buttonsToTargetNode.length > 1) {\n            // –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–Ω–æ–ø–æ–∫ –≤–µ–¥—É—Ç –∫ –æ–¥–Ω–æ–º—É —É–∑–ª—É - —Å–æ–∑–¥–∞–µ–º –ª–æ–≥–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ callback_data\n            code += `    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ callback_data\\n`;\n            code += `    button_display_text = \"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞\"\\n`;\n            buttonsToTargetNode.forEach((button, index) => {\n              // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ —Å—É—Ñ—Ñ–∏–∫—Å—É _btn_index –≤ callback_data\n              code += `    if callback_query.data.endswith(\"_btn_${index}\"):\\n`;\n              code += `        button_display_text = \"${button.text}\"\\n`;\n            });\n            \n            // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –∏—â–µ–º –∫–Ω–æ–ø–∫—É –ø–æ —Ç–æ—á–Ω–æ–º—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é callback_data —Å nodeId\n            code += `    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ç–æ—á–Ω–æ–º—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é callback_data\\n`;\n            buttonsToTargetNode.forEach((button) => {\n              code += `    if callback_query.data == \"${nodeId}\":\\n`;\n              // –î–ª—è —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–Ω–æ–ø–æ–∫ –≤–µ–¥—É—Ç –∫ –æ–¥–Ω–æ–º—É —É–∑–ª—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é\n              code += `        button_display_text = \"${button.text}\"\\n`;\n            });\n          } else if (sourceNode) {\n            const button = sourceNode.data.buttons.find(btn => btn.target === nodeId);\n            if (button) {\n              code += `    button_display_text = \"${button.text}\"\\n`;\n            } else {\n              code += `    button_display_text = \"–ö–Ω–æ–ø–∫–∞ ${nodeId}\"\\n`;\n            }\n          } else {\n            code += `    button_display_text = \"–ö–Ω–æ–ø–∫–∞ ${nodeId}\"\\n`;\n          }\n          code += '    \\n';\n          code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n\n          code += '    timestamp = get_moscow_time()\\n';\n          code += '    \\n';\n          code += '    response_data = button_display_text  # –ü—Ä–æ—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\\n';\n          code += '    \\n';\n          code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\\n';\n          code += '    if user_id not in user_data:\\n';\n          code += '        user_data[user_id] = {}\\n';\n          code += '    user_data[user_id][\"button_click\"] = button_display_text\\n';\n          code += '    \\n';\n          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–Ω–æ–ø–∫–∏\n          const parentNode = nodes.find(n => \n            n.data.buttons && n.data.buttons.some(btn => btn.target === nodeId)\n          );\n          \n          let variableName = 'button_click';\n          let variableValue = 'button_display_text';\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —à–∞–±–ª–æ–Ω–∞ \"–§–µ–¥—è\"\n          if (nodeId === 'source_search') {\n            variableName = '–∏—Å—Ç–æ—á–Ω–∏–∫';\n            variableValue = '\"üîç –ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ\"';\n          } else if (nodeId === 'source_friends') {\n            variableName = '–∏—Å—Ç–æ—á–Ω–∏–∫';\n            variableValue = '\"üë• –î—Ä—É–∑—å—è\"';\n          } else if (nodeId === 'source_ads') {\n            variableName = '–∏—Å—Ç–æ—á–Ω–∏–∫';\n            variableValue = '\"üì± –†–µ–∫–ª–∞–º–∞\"';\n          } else if (parentNode && parentNode.data.inputVariable) {\n            variableName = parentNode.data.inputVariable;\n            \n            // –ò—â–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É –∏ –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ\n            const button = parentNode.data.buttons.find(btn => btn.target === nodeId);\n            if (button) {\n              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–Ω–æ–ø–∫–∏\n              if (button.id === 'btn_search' || nodeId === 'source_search') {\n                variableValue = '\"–∏–∑ –∏–Ω–µ—Ç–∞\"';\n              } else if (button.id === 'btn_friends' || nodeId === 'source_friends') {\n                variableValue = '\"friends\"';\n              } else if (button.id === 'btn_ads' || nodeId === 'source_ads') {\n                variableValue = '\"ads\"';\n              } else if (variableName === '–ø–æ–ª') {\n                // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π \"–ø–æ–ª\"\n                if (button.text === '–ú—É–∂—á–∏–Ω–∞' || button.text === 'üë® –ú—É–∂—á–∏–Ω–∞') {\n                  variableValue = '\"–ú—É–∂—á–∏–Ω–∞\"';\n                } else if (button.text === '–ñ–µ–Ω—â–∏–Ω–∞' || button.text === 'üë© –ñ–µ–Ω—â–∏–Ω–∞') {\n                  variableValue = '\"–ñ–µ–Ω—â–∏–Ω–∞\"';\n                } else {\n                  variableValue = `\"${button.text}\"`;\n                }\n              } else {\n                variableValue = 'button_display_text';\n              }\n            }\n          }\n          \n          code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π\\n';\n          code += `    await update_user_data_in_db(user_id, \"${variableName}\", ${variableValue})\\n`;\n          code += `    logging.info(f\"–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${variableName} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: \" + str(${variableValue}) + f\" (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n`;\n          code += '    \\n';\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è \"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç! –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...\" –¥–ª—è –∫–Ω–æ–ø–æ–∫\n          code += '    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±—Ä–∞–±–æ—Ç–∫–µ\\n';\n          code += '    await callback_query.answer(\"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç! –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...\")\\n';\n          code += '    \\n';\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–ª—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –ù–ï –¥–µ–ª–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏\n          const currentNode = nodes.find(n => n.id === nodeId);\n          \n          // –î–ª—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º - –ù–ï –¥–µ–ª–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–º –∑–∞—Ö–æ–¥–µ –≤ —É–∑–µ–ª\n          const shouldRedirect = !(currentNode && currentNode.data.allowMultipleSelection);\n          console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–† –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–∑–µ–ª ${nodeId} allowMultipleSelection: ${currentNode?.data.allowMultipleSelection}, shouldRedirect: ${shouldRedirect}`);\n          \n          let redirectTarget = nodeId; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Å—Ç–∞–µ–º—Å—è –≤ —Ç–æ–º –∂–µ —É–∑–ª–µ\n          \n          if (shouldRedirect) {\n            if (currentNode && currentNode.data.continueButtonTarget) {\n              // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —É–∑–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º continueButtonTarget –µ—Å–ª–∏ –µ—Å—Ç—å\n              redirectTarget = currentNode.data.continueButtonTarget;\n              console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–† REDIRECTTARGET: –£–∑–µ–ª ${nodeId} –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ continueButtonTarget ${redirectTarget}`);\n            } else {\n              // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —É–∑–ª–æ–≤ –∏—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª —á–µ—Ä–µ–∑ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n              const nodeConnections = connections.filter(conn => conn.source === nodeId);\n              if (nodeConnections.length > 0) {\n                redirectTarget = nodeConnections[0].target;\n                console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–† REDIRECTTARGET: –£–∑–µ–ª ${nodeId} –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ ${redirectTarget}`);\n              } else {\n                console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–† REDIRECTTARGET: –£–∑–µ–ª ${nodeId} –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ —É–∑–ª–µ (–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)`);\n              }\n            }\n          } else {\n            console.log(`üîß –ì–ï–ù–ï–†–ê–¢–û–†: –£–∑–µ–ª ${nodeId} —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º - –ù–ï –¥–µ–ª–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é`);\n          }\n          \n          if (shouldRedirect && redirectTarget) {\n            code += '    # –ü–ï–†–ï–ê–î–†–ï–°–ê–¶–ò–Ø: –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö\\n';\n            code += `    next_node_id = \"${redirectTarget}\"\\n`;\n            code += '    try:\\n';\n            code += '        logging.info(f\"üöÄ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∫–Ω–æ–ø–∫–∏: {next_node_id}\")\\n';\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞\n            if (nodes.length > 0) {\n              nodes.forEach((navTargetNode, index) => {\n                const condition = index === 0 ? 'if' : 'elif';\n                code += `        ${condition} next_node_id == \"${navTargetNode.id}\":\\n`;\n                \n                if (navTargetNode.type === 'message') {\n                  // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–º–µ–µ—Ç –ª–∏ —É–∑–µ–ª –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n                  if (navTargetNode.data.allowMultipleSelection === true) {\n                    // –î–ª—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –≤—ã–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫\n                    const safeFunctionName = navTargetNode.id.replace(/[^a-zA-Z0-9_]/g, '_');\n                    code += `            # –£–∑–µ–ª —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º - –≤—ã–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫\\n`;\n                    code += `            logging.info(f\"üîß Callback –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º: ${navTargetNode.id}\")\\n`;\n                    code += `            await handle_callback_${safeFunctionName}(callback_query)\\n`;\n                  } else {\n                    const messageText = navTargetNode.data.messageText || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n                    const formattedText = formatTextForPython(messageText);\n                    code += `            nav_text = ${formattedText}\\n`;\n                    code += '            await callback_query.message.edit_text(nav_text)\\n';\n                  }\n                  \n                  // –ï—Å–ª–∏ —É–∑–µ–ª message —Å–æ–±–∏—Ä–∞–µ—Ç –≤–≤–æ–¥, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ\n                  if (navTargetNode.data.collectUserInput === true) {\n                    const inputType = navTargetNode.data.inputType || 'text';\n                    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ë–µ—Ä–µ–º inputVariable –∏–º–µ–Ω–Ω–æ –∏–∑ —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞, –∞ –Ω–µ –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ\n                    const inputVariable = navTargetNode.data.inputVariable || `response_${navTargetNode.id}`;\n                    const inputTargetNodeId = navTargetNode.data.inputTargetNodeId;\n                    \n                    code += '            # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∞ –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ inline –∫–Ω–æ–ø–∫–æ–π\\n';\n                    code += '            user_id = callback_query.from_user.id\\n';\n                    code += '            if user_id not in user_data:\\n';\n                    code += '                user_data[user_id] = {}\\n';\n                    code += `            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∞ –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${inputVariable} —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞\\n`;\n                    code += `            if \"${inputVariable}\" not in user_data[user_id] or not user_data[user_id][\"${inputVariable}\"]:\\n`;\n                    code += '                # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\\n';\n                    code += '                user_data[user_id][\"waiting_for_input\"] = {\\n';\n                    code += `                    \"type\": \"${inputType}\",\\n`;\n                    code += `                    \"variable\": \"${inputVariable}\",\\n`;\n                    code += '                    \"save_to_database\": True,\\n';\n                    code += `                    \"node_id\": \"${navTargetNode.id}\",\\n`;\n                    code += `                    \"next_node_id\": \"${inputTargetNodeId || ''}\",\\n`;\n                    code += `                    \"min_length\": ${navTargetNode.data.minLength || 0},\\n`;\n                    code += `                    \"max_length\": ${navTargetNode.data.maxLength || 0},\\n`;\n                    code += '                    \"retry_message\": \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\",\\n';\n                    code += '                    \"success_message\": \"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!\"\\n';\n                    code += '                }\\n';\n                    code += `                logging.info(f\"üîß –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: ${inputVariable} (—É–∑–µ–ª ${navTargetNode.id})\")\\n`;\n                    code += '            else:\\n';\n                    code += `                logging.info(f\"‚è≠Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${inputVariable} —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\")\\n`;\n                  }\n                } else if (navTargetNode.type === 'command') {\n                  // –î–ª—è —É–∑–ª–æ–≤ –∫–æ–º–∞–Ω–¥ –≤—ã–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫\n                  const commandName = navTargetNode.data.command?.replace('/', '') || 'unknown';\n                  const handlerName = `${commandName}_handler`;\n                  code += `            # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É ${navTargetNode.data.command}\\n`;\n                  code += '            from types import SimpleNamespace\\n';\n                  code += '            fake_message = SimpleNamespace()\\n';\n                  code += '            fake_message.from_user = callback_query.from_user\\n';\n                  code += '            fake_message.chat = callback_query.message.chat\\n';\n                  code += '            fake_message.date = callback_query.message.date\\n';\n                  code += '            fake_message.answer = callback_query.message.answer\\n';\n                  code += `            await ${handlerName}(fake_message)\\n`;\n                } else if (navTargetNode.type === 'keyboard' && navTargetNode.data.enableTextInput) {\n                  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–∑–ª—ã –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n                  const messageText = navTargetNode.data.messageText || '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç:';\n                  const inputVariable = navTargetNode.data.inputVariable || `response_${navTargetNode.id}`;\n                  const inputTargetNodeId = navTargetNode.data.inputTargetNodeId || '';\n                  \n                  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞\n                  const hasConditionalMessages = navTargetNode.data.enableConditionalMessages && \n                                                navTargetNode.data.conditionalMessages && \n                                                navTargetNode.data.conditionalMessages.length > 0;\n                  \n                  if (hasConditionalMessages) {\n                    // –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫—É\n                    code += '            await callback_query.message.delete()\\n';\n                    code += '            # –£–∑–µ–ª —Å —É—Å–ª–æ–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ - –ø—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è\\n';\n                    code += '            user_id = callback_query.from_user.id\\n';\n                    code += '            user_data_dict = await get_user_from_db(user_id) or {}\\n';\n                    code += '            user_data_dict.update(user_data.get(user_id, {}))\\n\\n';\n                    \n                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ check_user_variable –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏\n                    code += '            # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n';\n                    code += '            def check_user_variable(var_name, user_data_dict):\\n';\n                    code += '                \"\"\"–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"\"\"\\n';\n                    code += '                # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤ –ø–æ–ª–µ user_data (–∏–∑ –ë–î)\\n';\n                    code += '                if \"user_data\" in user_data_dict and user_data_dict[\"user_data\"]:\\n';\n                    code += '                    try:\\n';\n                    code += '                        import json\\n';\n                    code += '                        parsed_data = json.loads(user_data_dict[\"user_data\"]) if isinstance(user_data_dict[\"user_data\"], str) else user_data_dict[\"user_data\"]\\n';\n                    code += '                        if var_name in parsed_data:\\n';\n                    code += '                            raw_value = parsed_data[var_name]\\n';\n                    code += '                            if isinstance(raw_value, dict) and \"value\" in raw_value:\\n';\n                    code += '                                var_value = raw_value[\"value\"]\\n';\n                    code += '                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–µ\\n';\n                    code += '                                if var_value is not None and str(var_value).strip() != \"\":\\n';\n                    code += '                                    return True, str(var_value)\\n';\n                    code += '                            else:\\n';\n                    code += '                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–µ\\n';\n                    code += '                                if raw_value is not None and str(raw_value).strip() != \"\":\\n';\n                    code += '                                    return True, str(raw_value)\\n';\n                    code += '                    except (json.JSONDecodeError, TypeError):\\n';\n                    code += '                        pass\\n';\n                    code += '                \\n';\n                    code += '                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ user_data)\\n';\n                    code += '                if var_name in user_data_dict:\\n';\n                    code += '                    variable_data = user_data_dict.get(var_name)\\n';\n                    code += '                    if isinstance(variable_data, dict) and \"value\" in variable_data:\\n';\n                    code += '                        var_value = variable_data[\"value\"]\\n';\n                    code += '                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–µ\\n';\n                    code += '                        if var_value is not None and str(var_value).strip() != \"\":\\n';\n                    code += '                            return True, str(var_value)\\n';\n                    code += '                    elif variable_data is not None and str(variable_data).strip() != \"\":\\n';\n                    code += '                        return True, str(variable_data)\\n';\n                    code += '                \\n';\n                    code += '                return False, None\\n\\n';\n                    \n                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞\n                    const conditionalMessages = navTargetNode.data.conditionalMessages.sort((a, b) => (b.priority || 0) - (a.priority || 0));\n                    \n                    // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—É—é if/elif/else —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤—Å–µ—Ö —É—Å–ª–æ–≤–∏–π\n                    for (let i = 0; i < conditionalMessages.length; i++) {\n                      const condition = conditionalMessages[i];\n                      const cleanedConditionText = stripHtmlTags(condition.messageText);\n                      const conditionText = formatTextForPython(cleanedConditionText);\n                      const conditionKeyword = i === 0 ? 'if' : 'elif';\n                      \n                      // Get variable names - support both new array format and legacy single variable\n                      const variableNames = condition.variableNames && condition.variableNames.length > 0 \n                        ? condition.variableNames \n                        : (condition.variableName ? [condition.variableName] : []);\n                      \n                      const logicOperator = condition.logicOperator || 'AND';\n                      \n                      code += `            # –£—Å–ª–æ–≤–∏–µ ${i + 1}: ${condition.condition} –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: ${variableNames.join(', ')}\\n`;\n                      \n                      if (condition.condition === 'user_data_exists' && variableNames.length > 0) {\n                        // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—ã–π –±–ª–æ–∫ —É—Å–ª–æ–≤–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –í–ù–£–¢–†–ò\n                        code += `            ${conditionKeyword} (\\n`;\n                        for (let j = 0; j < variableNames.length; j++) {\n                          const varName = variableNames[j];\n                          const operator = (j === variableNames.length - 1) ? '' : (logicOperator === 'AND' ? ' and' : ' or');\n                          code += `                check_user_variable(\"${varName}\", user_data_dict)[0]${operator}\\n`;\n                        }\n                        code += `            ):\\n`;\n                        \n                        // –í–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —É—Å–ª–æ–≤–∏—è —Å–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n                        code += `                # –°–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\\n`;\n                        code += `                variable_values = {}\\n`;\n                        for (const varName of variableNames) {\n                          code += `                _, variable_values[\"${varName}\"] = check_user_variable(\"${varName}\", user_data_dict)\\n`;\n                        }\n                        \n                        code += `                text = ${conditionText}\\n`;\n                        \n                        // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç–µ\n                        for (const varName of variableNames) {\n                          code += `                if \"{${varName}}\" in text and variable_values[\"${varName}\"] is not None:\\n`;\n                          code += `                    text = text.replace(\"{${varName}}\", variable_values[\"${varName}\"])\\n`;\n                        }\n                        \n                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å\n                        if (condition.keyboardType && condition.keyboardType !== 'none' && condition.buttons && condition.buttons.length > 0) {\n                          code += '                # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n';\n                          \n                          if (condition.keyboardType === 'inline') {\n                            code += '                builder = InlineKeyboardBuilder()\\n';\n                            condition.buttons.forEach((button: any) => {\n                              if (button.action === \"url\") {\n                                code += `                builder.add(InlineKeyboardButton(text=\"${button.text}\", url=\"${button.url || '#'}\"))\\n`;\n                              } else if (button.action === 'goto') {\n                                const callbackData = button.target || button.id || 'no_action';\n                                code += `                builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${callbackData}\"))\\n`;\n                              } else if (button.action === 'command') {\n                                // –î–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é callback_data\n                                const commandCallback = `cmd_${button.target ? button.target.replace('/', '') : 'unknown'}`;\n                                code += `                builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${commandCallback}\"))\\n`;\n                              } else {\n                                const callbackData = button.target || button.id || 'no_action';\n                                code += `                builder.add(InlineKeyboardButton(text=\"${button.text}\", callback_data=\"${callbackData}\"))\\n`;\n                              }\n                            });\n                            code += '                conditional_keyboard = builder.as_markup()\\n';\n                            code += '                await bot.send_message(user_id, text, reply_markup=conditional_keyboard)\\n';\n                          } else if (condition.keyboardType === 'reply') {\n                            code += '                builder = ReplyKeyboardBuilder()\\n';\n                            condition.buttons.forEach((button: any) => {\n                              if (button.action === \"contact\" && button.requestContact) {\n                                code += `                builder.add(KeyboardButton(text=\"${button.text}\", request_contact=True))\\n`;\n                              } else if (button.action === \"location\" && button.requestLocation) {\n                                code += `                builder.add(KeyboardButton(text=\"${button.text}\", request_location=True))\\n`;\n                              } else {\n                                code += `                builder.add(KeyboardButton(text=\"${button.text}\"))\\n`;\n                              }\n                            });\n                            code += '                conditional_keyboard = builder.as_markup(resize_keyboard=True, one_time_keyboard=False)\\n';\n                            code += '                await bot.send_message(user_id, text, reply_markup=conditional_keyboard)\\n';\n                          }\n                        } else {\n                          // –ù–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç\n                          code += '                await bot.send_message(user_id, text)\\n';\n                        }\n                        \n                        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)\n                        if (condition.waitForTextInput) {\n                          // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–∑ —É—Å–ª–æ–≤–∏—è –∏–ª–∏ –∏–∑ —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n                          const conditionalInputVariable = condition.textInputVariable || navTargetNode.data.inputVariable || `response_${navTargetNode.id}`;\n                          code += `                # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n`;\n                          code += `                user_data[user_id][\"waiting_for_input\"] = {\\n`;\n                          code += `                    \"type\": \"text\",\\n`;\n                          code += `                    \"variable\": \"${conditionalInputVariable}\",\\n`;\n                          code += `                    \"save_to_database\": True,\\n`;\n                          code += `                    \"node_id\": \"${navTargetNode.id}\",\\n`;\n                          code += `                    \"next_node_id\": \"${condition.nextNodeAfterInput || inputTargetNodeId}\"\\n`;\n                          code += `                }\\n`;\n                          code += `                logging.info(f\"üîß –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ —É—Å–ª–æ–≤–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: ${conditionalInputVariable} (—É–∑–µ–ª ${navTargetNode.id})\")\\n`;\n                        }\n                      }\n                    }\n                    \n                    // Fallback —Å–æ–æ–±—â–µ–Ω–∏–µ\n                    code += `            else:\\n`;\n                    // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–º–µ–µ—Ç –ª–∏ —É–∑–µ–ª –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n                    if (navTargetNode.data.allowMultipleSelection === true) {\n                      // –î–ª—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º —Å–æ–∑–¥–∞–µ–º –ø—Ä—è–º—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é\n                      const messageText = navTargetNode.data.messageText || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n                      const formattedText = formatTextForPython(messageText);\n                      code += `                # –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º ${navTargetNode.id}\\n`;\n                      code += `                logging.info(f\"üîß Fallback –ø–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º: ${navTargetNode.id}\")\\n`;\n                      code += `                nav_text = ${formattedText}\\n`;\n                      \n                      // –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n                      code += '                user_data[user_id] = user_data.get(user_id, {})\\n';\n                      code += generateUniversalVariableReplacement('                ');\n                      \n                      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n                      code += `                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n`;\n                      code += `                user_data[user_id][\"multi_select_${navTargetNode.id}\"] = []\\n`;\n                      code += `                user_data[user_id][\"multi_select_node\"] = \"${navTargetNode.id}\"\\n`;\n                      code += `                user_data[user_id][\"multi_select_type\"] = \"selection\"\\n`;\n                      if (navTargetNode.data.multiSelectVariable) {\n                        code += `                user_data[user_id][\"multi_select_variable\"] = \"${navTargetNode.data.multiSelectVariable}\"\\n`;\n                      }\n                      \n                      // –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞\n                      if (navTargetNode.data.buttons && navTargetNode.data.buttons.length > 0) {\n                        code += generateInlineKeyboardCode(navTargetNode.data.buttons, '                ', navTargetNode.id, navTargetNode.data, allNodeIds);\n                        code += `                await bot.send_message(user_id, nav_text, reply_markup=keyboard)\\n`;\n                      } else {\n                        code += `                await bot.send_message(user_id, nav_text)\\n`;\n                      }\n                      code += `                logging.info(f\"‚úÖ –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ ${navTargetNode.id} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞\")\\n`;\n                    } else {\n                      const formattedText = formatTextForPython(messageText);\n                      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–∑ —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n                      const fallbackInputVariable = navTargetNode.data.inputVariable || `response_${navTargetNode.id}`;\n                      code += `                # Fallback —Å–æ–æ–±—â–µ–Ω–∏–µ\\n`;\n                      code += `                nav_text = ${formattedText}\\n`;\n                      // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞\n                      if (navTargetNode.data.collectUserInput === true) {\n                      code += `                # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∞ –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ inline –∫–Ω–æ–ø–∫–æ–π\\n`;\n                      code += `                if \"${fallbackInputVariable}\" not in user_data[user_id] or not user_data[user_id][\"${fallbackInputVariable}\"]:\\n`;\n                      code += `                    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\\n`;\n                      code += `                    user_data[user_id][\"waiting_for_input\"] = {\\n`;\n                      code += `                        \"type\": \"text\",\\n`;\n                      code += `                        \"variable\": \"${fallbackInputVariable}\",\\n`;\n                      code += `                        \"save_to_database\": True,\\n`;\n                      code += `                        \"node_id\": \"${navTargetNode.id}\",\\n`;\n                      code += `                        \"next_node_id\": \"${inputTargetNodeId}\"\\n`;\n                      code += `                    }\\n`;\n                      code += `                    logging.info(f\"üîß –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ fallback –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: ${fallbackInputVariable} (—É–∑–µ–ª ${navTargetNode.id})\")\\n`;\n                      code += `                else:\\n`;\n                        code += `                    logging.info(f\"‚è≠Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${fallbackInputVariable} —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º fallback –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\")\\n`;\n                      } else {\n                        code += `                logging.info(f\"Fallback –ø–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É ${navTargetNode.id} –±–µ–∑ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞\")\\n`;\n                      }\n                      code += `                await bot.send_message(user_id, nav_text)\\n`;\n                    }\n                  } else {\n                    // –û–±—ã—á–Ω—ã–π —É–∑–µ–ª –±–µ–∑ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n                    // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–º–µ–µ—Ç –ª–∏ —É–∑–µ–ª –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n                    if (navTargetNode.data.allowMultipleSelection === true) {\n                      // –î–ª—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º —Å–æ–∑–¥–∞–µ–º –ø—Ä—è–º—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é\n                      const messageText = navTargetNode.data.messageText || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n                      const formattedText = formatTextForPython(messageText);\n                      code += `            # –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º ${navTargetNode.id}\\n`;\n                      code += `            logging.info(f\"üîß –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º: ${navTargetNode.id}\")\\n`;\n                      code += '            await callback_query.message.delete()\\n';\n                      code += `            text = ${formattedText}\\n`;\n                      \n                      // –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n                      code += '            user_data[callback_query.from_user.id] = user_data.get(callback_query.from_user.id, {})\\n';\n                      code += generateUniversalVariableReplacement('            ');\n                      \n                      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n                      code += `            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n`;\n                      code += `            user_data[callback_query.from_user.id][\"multi_select_${navTargetNode.id}\"] = []\\n`;\n                      code += `            user_data[callback_query.from_user.id][\"multi_select_node\"] = \"${navTargetNode.id}\"\\n`;\n                      code += `            user_data[callback_query.from_user.id][\"multi_select_type\"] = \"selection\"\\n`;\n                      if (navTargetNode.data.multiSelectVariable) {\n                        code += `            user_data[callback_query.from_user.id][\"multi_select_variable\"] = \"${navTargetNode.data.multiSelectVariable}\"\\n`;\n                      }\n                      \n                      // –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞\n                      if (navTargetNode.data.buttons && navTargetNode.data.buttons.length > 0) {\n                        code += generateInlineKeyboardCode(navTargetNode.data.buttons, '            ', navTargetNode.id, navTargetNode.data, allNodeIds);\n                        code += `            await bot.send_message(callback_query.from_user.id, text, reply_markup=keyboard)\\n`;\n                      } else {\n                        code += `            await bot.send_message(callback_query.from_user.id, text)\\n`;\n                      }\n                      code += `            logging.info(f\"‚úÖ –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ ${navTargetNode.id} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞\")\\n`;\n                    } else {\n                      const formattedText = formatTextForPython(messageText);\n                      code += '            await callback_query.message.delete()\\n';\n                      code += `            nav_text = ${formattedText}\\n`;\n                    \n                      // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞\n                      if (navTargetNode.data.collectUserInput === true) {\n                        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–∑ —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n                        const regularInputVariable = navTargetNode.data.inputVariable || `response_${navTargetNode.id}`;\n                        code += '            # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∞ –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ inline –∫–Ω–æ–ø–∫–æ–π\\n';\n                        code += '            user_data[callback_query.from_user.id] = user_data.get(callback_query.from_user.id, {})\\n';\n                        code += `            if \"${regularInputVariable}\" not in user_data[callback_query.from_user.id] or not user_data[callback_query.from_user.id][\"${regularInputVariable}\"]:\\n`;\n                        code += '                # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\\n';\n                        code += '                user_data[callback_query.from_user.id][\"waiting_for_input\"] = {\\n';\n                        code += '                    \"type\": \"text\",\\n';\n                        code += `                    \"variable\": \"${regularInputVariable}\",\\n`;\n                        code += '                    \"save_to_database\": True,\\n';\n                        code += `                    \"node_id\": \"${navTargetNode.id}\",\\n`;\n                        code += `                    \"next_node_id\": \"${inputTargetNodeId}\"\\n`;\n                        code += '                }\\n';\n                        code += `                logging.info(f\"üîß –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π: ${regularInputVariable} (—É–∑–µ–ª ${navTargetNode.id})\")\\n`;\n                        code += '            else:\\n';\n                        code += `                logging.info(f\"‚è≠Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${regularInputVariable} —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\")\\n`;\n                      } else {\n                        code += `            logging.info(f\"–ü–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É ${navTargetNode.id} –±–µ–∑ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞\")\\n`;\n                      }\n                      code += '            await bot.send_message(callback_query.from_user.id, nav_text)\\n';\n                    }\n                  }\n                } else {\n                  code += `            logging.info(\"–ü–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É ${navTargetNode.id}\")\\n`;\n                }\n              });\n              \n              code += '        else:\\n';\n              code += '            logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª: {next_node_id}\")\\n';\n            } else {\n              code += '        # No nodes available for navigation\\n';\n              code += '        logging.warning(f\"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–∑–ª–æ–≤ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∫ {next_node_id}\")\\n';\n            }\n            \n            code += '    except Exception as e:\\n';\n            code += '        logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É {next_node_id}: {e}\")\\n';\n            code += '    \\n';\n            code += '    return  # –ó–∞–≤–µ—Ä—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏\\n';\n          }\n          code += '    \\n';\n          \n          // Generate response based on node type\n          if (targetNode.type === 'message' && (targetNode.data.inputVariable || targetNode.data.responseType)) {\n            // Handle input collection nodes\n            const inputPrompt = targetNode.data.messageText || targetNode.data.inputPrompt || \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç:\";\n            const responseType = targetNode.data.responseType || 'text';\n            const inputType = targetNode.data.inputType || 'text';\n            const inputVariable = targetNode.data.inputVariable || `response_${targetNode.id}`;\n            const saveToDatabase = targetNode.data.saveToDatabase || false;\n            \n            code += '    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\\n';\n            code += '    await callback_query.message.delete()\\n';\n            code += '    \\n';\n            \n            const formattedPrompt = formatTextForPython(inputPrompt);\n            code += `    text = ${formattedPrompt}\\n`;\n            \n            if (responseType === 'text') {\n              // Find next node through connections\n              const nextConnection = connections.find(conn => conn.source === targetNode.id);\n              const nextNodeId = nextConnection ? nextConnection.target : null;\n              \n              code += '    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\\n';\n              code += '    user_data[callback_query.from_user.id][\"waiting_for_input\"] = {\\n';\n              code += `        \"type\": \"${inputType}\",\\n`;\n              code += `        \"variable\": \"${inputVariable}\",\\n`;\n              code += `        \"save_to_database\": ${toPythonBoolean(saveToDatabase)},\\n`;\n              code += `        \"node_id\": \"${targetNode.id}\",\\n`;\n              code += `        \"next_node_id\": \"${nextNodeId || ''}\"\\n`;\n              code += '    }\\n';\n              code += '    await bot.send_message(callback_query.from_user.id, text)\\n';\n            }\n          } else {\n            // Handle regular message nodes\n            const targetText = targetNode.data.messageText || \"–°–æ–æ–±—â–µ–Ω–∏–µ\";\n            const formattedTargetText = formatTextForPython(targetText);\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è callback handlers\n            if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n              code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\\n';\n              code += '    text = None\\n';\n              code += '    \\n';\n              code += '    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π\\n';\n              code += '    user_record = await get_user_from_db(user_id)\\n';\n              code += '    if not user_record:\\n';\n              code += '        user_record = user_data.get(user_id, {})\\n';\n              code += '    \\n';\n              code += '    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ–º user_data\\n';\n              code += '    if isinstance(user_record, dict):\\n';\n              code += '        if \"user_data\" in user_record:\\n';\n              code += '            if isinstance(user_record[\"user_data\"], str):\\n';\n              code += '                try:\\n';\n              code += '                    import json\\n';\n              code += '                    user_data_dict = json.loads(user_record[\"user_data\"])\\n';\n              code += '                except (json.JSONDecodeError, TypeError):\\n';\n              code += '                    user_data_dict = {}\\n';\n              code += '            elif isinstance(user_record[\"user_data\"], dict):\\n';\n              code += '                user_data_dict = user_record[\"user_data\"]\\n';\n              code += '            else:\\n';\n              code += '                user_data_dict = {}\\n';\n              code += '        else:\\n';\n              code += '            user_data_dict = user_record\\n';\n              code += '    else:\\n';\n              code += '        user_data_dict = {}\\n';\n              code += '    \\n';\n              code += '    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–º–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–µ\\n';\n              code += '    def replace_variables_in_text(text_content, variables_dict):\\n';\n              code += '        if not text_content or not variables_dict:\\n';\n              code += '            return text_content\\n';\n              code += '        \\n';\n              code += '        for var_name, var_data in variables_dict.items():\\n';\n              code += '            placeholder = \"{\" + var_name + \"}\"\\n';\n              code += '            if placeholder in text_content:\\n';\n              code += '                if isinstance(var_data, dict) and \"value\" in var_data:\\n';\n              code += '                    var_value = str(var_data[\"value\"]) if var_data[\"value\"] is not None else var_name\\n';\n              code += '                elif var_data is not None:\\n';\n              code += '                    var_value = str(var_data)\\n';\n              code += '                else:\\n';\n              code += '                    var_value = var_name  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ—Ç\\n';\n              code += '                text_content = text_content.replace(placeholder, var_value)\\n';\n              code += '        return text_content\\n';\n              code += '    \\n';\n              \n              // Generate conditional logic using helper function\n              code += generateConditionalMessageLogic(targetNode.data.conditionalMessages, '    ');\n              \n              // Add fallback\n              code += '    else:\\n';\n              \n              if (targetNode.data.fallbackMessage) {\n                const fallbackText = formatTextForPython(targetNode.data.fallbackMessage);\n                code += `        text = ${fallbackText}\\n`;\n                code += '        text = replace_variables_in_text(text, user_data_dict)\\n';\n                code += '        logging.info(\"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–ø–∞—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\")\\n';\n              } else {\n                code += `        text = ${formattedTargetText}\\n`;\n                code += '        text = replace_variables_in_text(text, user_data_dict)\\n';\n                code += '        logging.info(\"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∑–ª–∞\")\\n';\n              }\n              \n              code += '    \\n';\n            } else {\n              code += `    text = ${formattedTargetText}\\n`;\n              \n              // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n              code += generateUniversalVariableReplacement('    ');\n            }\n            \n            // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞\n            if (targetNode.data.collectUserInput === true) {\n              // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞\n              const inputType = targetNode.data.inputType || 'text';\n              const inputVariable = targetNode.data.inputVariable || `response_${targetNode.id}`;\n              const saveToDatabase = targetNode.data.saveToDatabase !== false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é true –¥–ª—è collectUserInput\n              const inputTargetNodeId = targetNode.data.inputTargetNodeId;\n              \n              code += '    # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞\\n';\n              code += '    if callback_query.from_user.id not in user_data:\\n';\n              code += '        user_data[callback_query.from_user.id] = {}\\n';\n              code += '    \\n';\n              code += `    user_data[callback_query.from_user.id][\"waiting_for_input\"] = \"${targetNode.id}\"\\n`;\n              code += `    user_data[callback_query.from_user.id][\"input_type\"] = \"${inputType}\"\\n`;\n              code += `    user_data[callback_query.from_user.id][\"input_variable\"] = \"${inputVariable}\"\\n`;\n              code += `    user_data[callback_query.from_user.id][\"save_to_database\"] = ${toPythonBoolean(saveToDatabase)}\\n`;\n              code += `    user_data[callback_query.from_user.id][\"input_target_node_id\"] = \"${inputTargetNodeId || ''}\"\\n`;\n              code += '    \\n';\n              \n              // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É inline –∫–Ω–æ–ø–æ–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É—Å–ª–æ–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n                code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É—Å–ª–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞\\n';\n                code += '    if \"keyboard\" not in locals() or keyboard is None:\\n';\n                code += '        # –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ (+ —Å–±–æ—Ä –≤–≤–æ–¥–∞ –≤–∫–ª—é—á–µ–Ω)\\n';\n                code += '        builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π callback_data, –≤–∫–ª—é—á–∞—é—â–∏–π ID –∫–Ω–æ–ø–∫–∏ –∏ —Ç–µ–∫—Å—Ç\n                    const callbackData = btn.id || 'no_action';\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command') {\n                    // –î–ª—è –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π callback_data —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º cmd_\n                    const commandName = btn.target ? btn.target.replace('/', '') : 'unknown';\n                    const callbackData = `cmd_${commandName}`;\n                    code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  }\n                });\n                code += '        keyboard = builder.as_markup()\\n';\n                let parseModeTarget = '';\n                if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                  parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n                } else if (targetNode.data.formatMode === 'html') {\n                  parseModeTarget = ', parse_mode=ParseMode.HTML';\n                }\n                code += '    # –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\\n';\n                code += '    try:\\n';\n                code += `        await safe_edit_or_send(callback_query, text, reply_markup=keyboard${parseModeTarget})\\n`;\n                code += '    except Exception as e:\\n';\n                code += '        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ.\")\\n';\n                code += `        await callback_query.message.answer(text, reply_markup=keyboard${parseModeTarget})\\n`;\n              } else {\n                code += '    # –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\\n';\n                code += '    try:\\n';\n                code += '        await callback_query.message.edit_text(text)\\n';\n                code += '    except Exception as e:\\n';\n                code += '        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ.\")\\n';\n                code += '        await callback_query.message.answer(text)\\n';\n              }\n              code += '    \\n';\n            } else {\n              // –û–±—ã—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞\n              \n              // Handle keyboard for target node\n              if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n                code += '    builder = InlineKeyboardBuilder()\\n';\n                targetNode.data.buttons.forEach((btn, index) => {\n                  if (btn.action === \"url\") {\n                    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                  } else if (btn.action === 'goto') {\n                    // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π callback_data, –≤–∫–ª—é—á–∞—é—â–∏–π ID –∫–Ω–æ–ø–∫–∏\n                    const callbackData = btn.id || 'no_action';\n                    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  } else if (btn.action === 'command') {\n                    // –î–ª—è –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π callback_data —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º cmd_\n                    const commandName = btn.target ? btn.target.replace('/', '') : 'unknown';\n                    const callbackData = `cmd_${commandName}`;\n                    code += `    builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                  }\n                });\n                code += '    keyboard = builder.as_markup()\\n';\n                let parseModeTarget = '';\n                if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                  parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n                } else if (targetNode.data.formatMode === 'html') {\n                  parseModeTarget = ', parse_mode=ParseMode.HTML';\n                }\n                code += `    # –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\\n`;\n                code += `    try:\\n`;\n                code += `        await safe_edit_or_send(callback_query, text, reply_markup=keyboard${parseModeTarget})\\n`;\n                code += `    except Exception as e:\\n`;\n                code += `        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ.\")\\n`;\n                code += `        await callback_query.message.answer(text, reply_markup=keyboard${parseModeTarget})\\n`;\n              } else {\n                let parseModeTarget = '';\n                if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                  parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n                } else if (targetNode.data.formatMode === 'html') {\n                  parseModeTarget = ', parse_mode=ParseMode.HTML';\n                }\n                code += `    # –ü—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ\\n`;\n                code += `    try:\\n`;\n                code += `        await callback_query.message.edit_text(text${parseModeTarget})\\n`;\n                code += `    except Exception as e:\\n`;\n                code += `        logging.warning(f\"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ.\")\\n`;\n                code += `        await callback_query.message.answer(text${parseModeTarget})\\n`;\n              }\n            } // –ó–∞–∫—Ä—ã–≤–∞–µ–º else –±–ª–æ–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n          } // –ó–∞–∫—Ä—ã–≤–∞–µ–º else –±–ª–æ–∫ –¥–ª—è regular message nodes\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π return –≤ –∫–æ–Ω–µ—Ü —Ñ—É–Ω–∫—Ü–∏–∏\n          code += '    return\\n';\n        }\n      }\n    });\n  }\n  \n  // Generate handlers for reply keyboard buttons\n  const replyNodes = (nodes || []).filter(node => \n    node.data.keyboardType === 'reply' && node.data.buttons && node.data.buttons.length > 0\n  );\n  \n  if (replyNodes.length > 0) {\n    code += '\\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ reply –∫–Ω–æ–ø–æ–∫\\n';\n    const processedReplyButtons = new Set<string>();\n    \n    replyNodes.forEach(node => {\n      node.data.buttons.forEach(button => {\n        if (button.action === 'goto' && button.target) {\n          const buttonText = button.text;\n          \n          // Avoid duplicate handlers\n          if (processedReplyButtons.has(buttonText)) return;\n          processedReplyButtons.add(buttonText);\n          \n          // Find target node\n          const targetNode = nodes.find(n => n.id === button.target);\n          if (targetNode) {\n            code += `\\n@dp.message(lambda message: message.text == \"${buttonText}\")\\n`;\n            // –°–æ–∑–¥–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ button ID\n            const safeFunctionName = button.id.replace(/[^a-zA-Z0-9_]/g, '_');\n            code += `async def handle_reply_${safeFunctionName}(message: types.Message):\\n`;\n            \n            // Generate response for target node\n            const targetText = targetNode.data.messageText || \"–°–æ–æ–±—â–µ–Ω–∏–µ\";\n            const formattedTargetText = formatTextForPython(targetText);\n            code += `    text = ${formattedTargetText}\\n`;\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è reply –∫–Ω–æ–ø–æ–∫\n            code += '    user_id = message.from_user.id\\n';\n            code += generateUniversalVariableReplacement('    ');\n            \n            // Handle keyboard for target node\n            if (targetNode.data.keyboardType === \"reply\" && targetNode.data.buttons.length > 0) {\n              code += '    builder = ReplyKeyboardBuilder()\\n';\n              targetNode.data.buttons.forEach((btn, index) => {\n                code += `    builder.add(KeyboardButton(text=\"${btn.text}\"))\\n`;\n              });\n              const resizeKeyboard = toPythonBoolean(targetNode.data.resizeKeyboard);\n              const oneTimeKeyboard = toPythonBoolean(targetNode.data.oneTimeKeyboard);\n              code += `    keyboard = builder.as_markup(resize_keyboard=${resizeKeyboard}, one_time_keyboard=${oneTimeKeyboard})\\n`;\n              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n              let parseModeTarget = '';\n              if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n              } else if (targetNode.data.formatMode === 'html') {\n                parseModeTarget = ', parse_mode=ParseMode.HTML';\n              }\n              code += `    await message.answer(text, reply_markup=keyboard${parseModeTarget})\\n`;\n            \n            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∂–∞—Ç–∏–µ reply –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤\n            code += '    \\n';\n            code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∂–∞—Ç–∏–µ reply –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤\\n';\n            code += '    user_id = message.from_user.id\\n';\n            code += '    if user_id in user_data and user_data[user_id].get(\"input_collection_enabled\"):\\n';\n            code += '        import datetime\\n';\n            code += '        timestamp = get_moscow_time()\\n';\n            code += '        input_node_id = user_data[user_id].get(\"input_node_id\")\\n';\n            code += '        input_variable = user_data[user_id].get(\"input_variable\", \"button_response\")\\n';\n            code += '        \\n';\n            code += '        response_data = {\\n';\n            code += `            \"value\": \"${buttonText}\",\\n`;\n            code += '            \"type\": \"reply_button\",\\n';\n            code += '            \"timestamp\": timestamp,\\n';\n            code += '            \"nodeId\": input_node_id,\\n';\n            code += '            \"variable\": input_variable,\\n';\n            code += '            \"source\": \"reply_button_click\"\\n';\n            code += '        }\\n';\n            code += '        \\n';\n            code += '        user_data[user_id][f\"{input_variable}_button\"] = response_data\\n';\n            code += '        logging.info(f\"Reply –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: {input_variable}_button = ${buttonText} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n';\n            \n            } else if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons.length > 0) {\n              // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n              if (targetNode.data.enableConditionalMessages && targetNode.data.conditionalMessages && targetNode.data.conditionalMessages.length > 0) {\n                code += '    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\\n';\n                code += '    user_record = await get_user_from_db(user_id)\\n';\n                code += '    if not user_record:\\n';\n                code += '        user_record = user_data.get(user_id, {})\\n';\n                code += '    user_data_dict = user_record if user_record else user_data.get(user_id, {})\\n';\n                code += generateConditionalMessageLogic(targetNode.data.conditionalMessages, '    ');\n                code += '    \\n';\n                code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\\n';\n                code += '    use_conditional_keyboard = conditional_keyboard is not None\\n';\n              } else {\n                code += '    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\\n';\n                code += '    use_conditional_keyboard = False\\n';\n                code += '    conditional_keyboard = None\\n';\n              }\n              \n              code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\\n';\n              code += '    if use_conditional_keyboard:\\n';\n              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n              let parseModeTarget = '';\n              if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n              } else if (targetNode.data.formatMode === 'html') {\n                parseModeTarget = ', parse_mode=ParseMode.HTML';\n              }\n              code += `        await message.answer(text, reply_markup=conditional_keyboard${parseModeTarget})\\n`;\n              code += '    else:\\n';\n              code += '        builder = InlineKeyboardBuilder()\\n';\n              targetNode.data.buttons.forEach((btn, index) => {\n                if (btn.action === \"url\") {\n                  code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url || '#'}\"))\\n`;\n                } else if (btn.action === 'goto') {\n                  // –ï—Å–ª–∏ –µ—Å—Ç—å target, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º ID –∫–Ω–æ–ø–∫–∏ –∫–∞–∫ callback_data\n                  const baseCallbackData = btn.target || btn.id || 'no_action'; const callbackData = `${baseCallbackData}_btn_${index}`;\n                  code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                } else if (btn.action === 'command') {\n                  // –î–ª—è –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π callback_data —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º cmd_\n                  const commandName = btn.target ? btn.target.replace('/', '') : 'unknown';\n                  const callbackData = `cmd_${commandName}`;\n                  code += `        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n                }\n              });\n              // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏\n              const columns = calculateOptimalColumns(targetNode.data.buttons, targetNode.data);\n              code += `        builder.adjust(${columns})\\n`;\n              code += '        keyboard = builder.as_markup()\\n';\n              code += `        await message.answer(text, reply_markup=keyboard${parseModeTarget})\\n`;\n            \n            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∂–∞—Ç–∏–µ reply –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤\n            code += '    \\n';\n            code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∂–∞—Ç–∏–µ reply –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤\\n';\n            code += '    user_id = message.from_user.id\\n';\n            code += '    if user_id in user_data and user_data[user_id].get(\"input_collection_enabled\"):\\n';\n            code += '        import datetime\\n';\n            code += '        timestamp = get_moscow_time()\\n';\n            code += '        input_node_id = user_data[user_id].get(\"input_node_id\")\\n';\n            code += '        input_variable = user_data[user_id].get(\"input_variable\", \"button_response\")\\n';\n            code += '        \\n';\n            code += '        response_data = {\\n';\n            code += `            \"value\": \"${buttonText}\",\\n`;\n            code += '            \"type\": \"reply_button\",\\n';\n            code += '            \"timestamp\": timestamp,\\n';\n            code += '            \"nodeId\": input_node_id,\\n';\n            code += '            \"variable\": input_variable,\\n';\n            code += '            \"source\": \"reply_button_click\"\\n';\n            code += '        }\\n';\n            code += '        \\n';\n            code += '        user_data[user_id][f\"{input_variable}_button\"] = response_data\\n';\n            code += '        logging.info(f\"Reply –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: {input_variable}_button = ${buttonText} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n';\n            \n            } else {\n              code += '    # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏\\n';\n              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\n              let parseModeTarget = '';\n              if (targetNode.data.formatMode === 'markdown' || targetNode.data.markdown === true) {\n                parseModeTarget = ', parse_mode=ParseMode.MARKDOWN';\n              } else if (targetNode.data.formatMode === 'html') {\n                parseModeTarget = ', parse_mode=ParseMode.HTML';\n              }\n              code += `    await message.answer(text, reply_markup=ReplyKeyboardRemove()${parseModeTarget})\\n`;\n            }\n          }\n        }\n      });\n    });\n  }\n\n  // Generate handlers for contact and location buttons\n  const contactButtons = replyNodes.flatMap(node => \n    node.data.buttons.filter(button => button.action === 'contact')\n  );\n  \n  const locationButtons = replyNodes.flatMap(node => \n    node.data.buttons.filter(button => button.action === 'location')\n  );\n  \n  if (contactButtons.length > 0 || locationButtons.length > 0) {\n    code += '\\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫\\n';\n    \n    if (contactButtons.length > 0) {\n      code += '\\n@dp.message(F.contact)\\n';\n      code += 'async def handle_contact(message: types.Message):\\n';\n      code += '    contact = message.contact\\n';\n      code += '    text = f\"–°–ø–∞—Å–∏–±–æ –∑–∞ –∫–æ–Ω—Ç–∞–∫—Ç!\\\\n\"\\n';\n      code += '    text += f\"–ò–º—è: {contact.first_name}\\\\n\"\\n';\n      code += '    text += f\"–¢–µ–ª–µ—Ñ–æ–Ω: {contact.phone_number}\"\\n';\n      code += '    await message.answer(text)\\n';\n    }\n    \n    if (locationButtons.length > 0) {\n      code += '\\n@dp.message(F.location)\\n';\n      code += 'async def handle_location(message: types.Message):\\n';\n      code += '    location = message.location\\n';\n      code += '    text = f\"–°–ø–∞—Å–∏–±–æ –∑–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é!\\\\n\"\\n';\n      code += '    text += f\"–®–∏—Ä–æ—Ç–∞: {location.latitude}\\\\n\"\\n';\n      code += '    text += f\"–î–æ–ª–≥–æ—Ç–∞: {location.longitude}\"\\n';\n      code += '    await message.answer(text)\\n';\n    }\n  }\n\n  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —É–∑–ª–æ–≤ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞\n  const userInputNodes = (nodes || []).filter(node => \n    node.type === 'message' && \n    node.data.responseType === 'buttons' && \n    Array.isArray(node.data.responseOptions) && \n    node.data.responseOptions.length > 0\n  );\n\n  if (userInputNodes.length > 0) {\n    code += '\\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Å–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞\\n';\n    \n    userInputNodes.forEach(node => {\n      const responseOptions = node.data.responseOptions || [];\n      \n      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞\n      responseOptions.forEach((option, index) => {\n        code += `\\n@dp.callback_query(F.data == \"response_${node.id}_${index}\")\\n`;\n        const safeFunctionName = `${node.id}_${index}`.replace(/[^a-zA-Z0-9_]/g, '_');\n        code += `async def handle_response_${safeFunctionName}(callback_query: types.CallbackQuery):\\n`;\n        code += '    user_id = callback_query.from_user.id\\n';\n        code += '    \\n';\n        code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–Ω–æ–ø–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞\\n';\n        code += '    if user_id not in user_data or \"button_response_config\" not in user_data[user_id]:\\n';\n        code += '        await callback_query.answer(\"‚ö†Ô∏è –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞\", show_alert=True)\\n';\n        code += '        return\\n';\n        code += '    \\n';\n        code += '    config = user_data[user_id][\"button_response_config\"]\\n';\n        code += `    selected_value = \"${option.value || option.text}\"\\n`;\n        code += `    selected_text = \"${option.text}\"\\n`;\n        code += '    \\n';\n        code += '    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n        code += '    if config.get(\"allow_multiple\"):\\n';\n        code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∫–Ω–æ–ø–∫–æ–π \"–ì–æ—Ç–æ–≤–æ\" –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞\\n';\n        code += '        if selected_value == \"done\":\\n';\n        code += '            # –ó–∞–≤–µ—Ä—à–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\\n';\n        code += '            if len(config[\"selected\"]) > 0:\\n';\n        code += '                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã\\n';\n        code += '                variable_name = config.get(\"variable\", \"user_response\")\\n';\n        code += '                import datetime\\n';\n        code += '                import pytz\\n';\n        code += '                timestamp = datetime.datetime.now(moscow_tz).isoformat()\\n';\n        code += '                node_id = config.get(\"node_id\", \"unknown\")\\n';\n        code += '                \\n';\n        code += '                # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n        code += '                response_data = {\\n';\n        code += '                    \"value\": [item[\"value\"] for item in config[\"selected\"]],\\n';\n        code += '                    \"text\": [item[\"text\"] for item in config[\"selected\"]],\\n';\n        code += '                    \"type\": \"multiple_choice\",\\n';\n        code += '                    \"timestamp\": timestamp,\\n';\n        code += '                    \"nodeId\": node_id,\\n';\n        code += '                    \"variable\": variable_name\\n';\n        code += '                }\\n';\n        code += '                \\n';\n        code += '                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\\n';\n        code += '                user_data[user_id][variable_name] = response_data\\n';\n        code += '                \\n';\n        code += '                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ\\n';\n        code += '                if config.get(\"save_to_database\"):\\n';\n        code += '                    saved_to_db = await update_user_data_in_db(user_id, variable_name, response_data)\\n';\n        code += '                    if saved_to_db:\\n';\n        code += '                        logging.info(f\"‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î: {variable_name} = {response_data[\\'text\\']} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n';\n        code += '                    else:\\n';\n        code += '                        logging.warning(f\"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ\")\\n';\n        code += '                \\n';\n        code += '                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ\\n';\n        code += '                success_message = config.get(\"success_message\", \"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≤—ã–±–æ—Ä!\")\\n';\n        code += '                selected_items = \", \".join([item[\"text\"] for item in config[\"selected\"]])\\n';\n        code += '                await callback_query.message.edit_text(f\"{success_message}\\\\n\\\\n‚úÖ –í–∞—à –≤—ã–±–æ—Ä: {selected_items}\")\\n';\n        code += '                \\n';\n        code += '                logging.info(f\"–ü–æ–ª—É—á–µ–Ω –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä: {variable_name} = {[item[\\'text\\'] for item in config[\\'selected\\']]}\")\\n';\n        code += '                \\n';\n        code += '                # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ\\n';\n        code += '                del user_data[user_id][\"button_response_config\"]\\n';\n        code += '                \\n';\n        code += '                # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É\\n';\n        code += '                next_node_id = config.get(\"next_node_id\")\\n';\n        code += '                if next_node_id:\\n';\n        code += '                    try:\\n';\n        code += '                        # –í—ã–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞\\n';\n        \n        // Add navigation for done button\n        if (nodes.length > 0) {\n          nodes.forEach((btnNode, btnIndex) => {\n            const safeFunctionName = btnNode.id.replace(/[^a-zA-Z0-9_]/g, '_');\n            const condition = btnIndex === 0 ? 'if' : 'elif';\n            code += `                        ${condition} next_node_id == \"${btnNode.id}\":\\n`;\n            code += `                            await handle_callback_${safeFunctionName}(callback_query)\\n`;\n          });\n          \n          code += '                        else:\\n';\n          code += '                            logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª: {next_node_id}\")\\n';\n        } else {\n          code += '                        # No nodes available for navigation\\n';\n          code += '                        logging.warning(f\"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–∑–ª–æ–≤ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∫ {next_node_id}\")\\n';\n        }\n        code += '                    except Exception as e:\\n';\n        code += '                        logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É {next_node_id}: {e}\")\\n';\n        code += '                return\\n';\n        code += '            else:\\n';\n        code += '                # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ\\n';\n        code += '                await callback_query.answer(\"‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º\", show_alert=True)\\n';\n        code += '                return\\n';\n        code += '        else:\\n';\n        code += '            # –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n';\n        code += '            if selected_value not in config[\"selected\"]:\\n';\n        code += '                config[\"selected\"].append({\"text\": selected_text, \"value\": selected_value})\\n';\n        code += '                await callback_query.answer(f\"‚úÖ –í—ã–±—Ä–∞–Ω–æ: {selected_text}\")\\n';\n        code += '            else:\\n';\n        code += '                config[\"selected\"] = [item for item in config[\"selected\"] if item[\"value\"] != selected_value]\\n';\n        code += '                await callback_query.answer(f\"‚ùå –£–±—Ä–∞–Ω–æ: {selected_text}\")\\n';\n        code += '            return  # –ù–µ –∑–∞–≤–µ—Ä—à–∞–µ–º —Å–±–æ—Ä, –ø–æ–∑–≤–æ–ª—è–µ–º –≤—ã–±—Ä–∞—Ç—å –µ—â–µ\\n';\n        code += '    \\n';\n        code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä\\n';\n        code += '    variable_name = config.get(\"variable\", \"user_response\")\\n';\n        code += '    import datetime\\n';\n        code += '    timestamp = get_moscow_time()\\n';\n        code += '    node_id = config.get(\"node_id\", \"unknown\")\\n';\n        code += '    \\n';\n        code += '    # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç\\n';\n        code += '    response_data = {\\n';\n        code += '        \"value\": selected_value,\\n';\n        code += '        \"text\": selected_text,\\n';\n        code += '        \"type\": \"button_choice\",\\n';\n        code += '        \"timestamp\": timestamp,\\n';\n        code += '        \"nodeId\": node_id,\\n';\n        code += '        \"variable\": variable_name\\n';\n        code += '    }\\n';\n        code += '    \\n';\n        code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\\n';\n        code += '    user_data[user_id][variable_name] = response_data\\n';\n        code += '    \\n';\n        code += '    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ\\n';\n        code += '    if config.get(\"save_to_database\"):\\n';\n        code += '        saved_to_db = await update_user_data_in_db(user_id, variable_name, response_data)\\n';\n        code += '        if saved_to_db:\\n';\n        code += '            logging.info(f\"‚úÖ –ö–Ω–æ–ø–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î: {variable_name} = {selected_text} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n';\n        code += '        else:\\n';\n        code += '            logging.warning(f\"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ\")\\n';\n        code += '    \\n';\n        code += '    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ\\n';\n        code += '    success_message = config.get(\"success_message\", \"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≤—ã–±–æ—Ä!\")\\n';\n        code += '    await callback_query.message.edit_text(f\"{success_message}\\\\n\\\\n‚úÖ –í–∞—à –≤—ã–±–æ—Ä: {selected_text}\")\\n';\n        code += '    \\n';\n        code += '    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ\\n';\n        code += '    del user_data[user_id][\"button_response_config\"]\\n';\n        code += '    \\n';\n        code += '    logging.info(f\"–ü–æ–ª—É—á–µ–Ω –∫–Ω–æ–ø–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç: {variable_name} = {selected_text}\")\\n';\n        code += '    \\n';\n        code += '    # –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–Ω–æ–ø–∫–∏\\n';\n        code += '    # –ù–∞—Ö–æ–¥–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞\\n';\n        code += '    options = config.get(\"options\", [])\\n';\n        code += `    current_option = None\\n`;\n        code += `    for option in options:\\n`;\n        code += `        if option.get(\"callback_data\") == \"response_${node.id}_${index}\":\\n`;\n        code += `            current_option = option\\n`;\n        code += `            break\\n`;\n        code += '    \\n';\n        code += '    if current_option:\\n';\n        code += '        option_action = current_option.get(\"action\", \"goto\")\\n';\n        code += '        option_target = current_option.get(\"target\", \"\")\\n';\n        code += '        option_url = current_option.get(\"url\", \"\")\\n';\n        code += '        \\n';\n        code += '        if option_action == \"url\" and option_url:\\n';\n        code += '            # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É\\n';\n        code += '            from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup\\n';\n        code += '            keyboard = InlineKeyboardMarkup(inline_keyboard=[\\n';\n        code += '                [InlineKeyboardButton(text=\"üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É\", url=option_url)]\\n';\n        code += '            ])\\n';\n        code += '            await callback_query.message.edit_text(f\"{success_message}\\\\n\\\\n‚úÖ –í–∞—à –≤—ã–±–æ—Ä: {selected_text}\", reply_markup=keyboard)\\n';\n        code += '        elif option_action == \"command\" and option_target:\\n';\n        code += '            # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É\\n';\n        code += '            command = option_target\\n';\n        code += '            if not command.startswith(\"/\"):\\n';\n        code += '                command = \"/\" + command\\n';\n        code += '            \\n';\n        code += '            # –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã\\n';\n        code += '            import aiogram.types as aiogram_types\\n';\n        code += '            fake_message = aiogram_types.SimpleNamespace(\\n';\n        code += '                from_user=callback_query.from_user,\\n';\n        code += '                chat=callback_query.message.chat,\\n';\n        code += '                text=command,\\n';\n        code += '                message_id=callback_query.message.message_id\\n';\n        code += '            )\\n';\n        code += '            \\n';\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –¥–ª—è button responses\n        const commandNodes = (nodes || []).filter(n => (n.type === 'start' || n.type === 'command') && n.data.command);\n        commandNodes.forEach((cmdNode, cmdIndex) => {\n          const condition = cmdIndex === 0 ? 'if' : 'elif';\n          code += `            ${condition} command == \"${cmdNode.data.command}\":\\n`;\n          code += `                try:\\n`;\n          code += `                    await ${cmdNode.type === 'start' ? 'start_handler' : `${cmdNode.data.command?.replace(/[^a-zA-Z0-9_]/g, '_')}_handler`}(fake_message)\\n`;\n          code += `                except Exception as e:\\n`;\n          code += `                    logging.error(f\"–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã ${cmdNode.data.command}: {e}\")\\n`;\n        });\n        if (commandNodes.length > 0) {\n          code += `            else:\\n`;\n          code += `                logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: {command}\")\\n`;\n        }\n        code += '        elif option_action == \"goto\" and option_target:\\n';\n        code += '            # –ü–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É\\n';\n        code += '            target_node_id = option_target\\n';\n        code += '            try:\\n';\n        code += '                # –í—ã–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\\n';\n        \n        // Generate navigation logic for button responses  \n        if (nodes.length > 0) {\n          nodes.forEach((btnNode, btnIndex) => {\n            const safeFunctionName = btnNode.id.replace(/[^a-zA-Z0-9_]/g, '_');\n            const condition = btnIndex === 0 ? 'if' : 'elif';\n            code += `                ${condition} target_node_id == \"${btnNode.id}\":\\n`;\n            code += `                    await handle_callback_${safeFunctionName}(callback_query)\\n`;\n          });\n          code += '                else:\\n';\n          code += '                    logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª: {target_node_id}\")\\n';\n        } else {\n          code += '                pass  # No nodes to handle\\n';\n        }\n        code += '            except Exception as e:\\n';\n        code += '                logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —É–∑–ª—É {target_node_id}: {e}\")\\n';\n        code += '    else:\\n';\n        code += '        # Fallback –∫ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ next_node_id –µ—Å–ª–∏ –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–Ω–æ–ø–∫–∏\\n';\n        code += '        next_node_id = config.get(\"next_node_id\")\\n';\n        code += '        if next_node_id:\\n';\n        code += '            try:\\n';\n        code += '                # –í—ã–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞\\n';\n          \n          if (nodes.length > 0) {\n            nodes.forEach((btnNode, btnIndex) => {\n              const safeFunctionName = btnNode.id.replace(/[^a-zA-Z0-9_]/g, '_');\n              const condition = btnIndex === 0 ? 'if' : 'elif';\n              code += `                ${condition} next_node_id == \"${btnNode.id}\":\\n`;\n              code += `                    await handle_callback_${safeFunctionName}(callback_query)\\n`;\n            });\n            code += '                else:\\n';\n            code += '                    logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª: {next_node_id}\")\\n';\n          } else {\n            code += '                pass  # No nodes to handle\\n';\n          }\n          code += '            except Exception as e:\\n';\n          code += '                logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É {next_node_id}: {e}\")\\n';\n      });\n      \n      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ \"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å\"\n      if (node.data.allowSkip) {\n        code += `\\n@dp.callback_query(F.data == \"skip_${node.id}\")\\n`;\n        code += `async def handle_skip_${node.id}(callback_query: types.CallbackQuery):\\n`;\n        code += '    user_id = callback_query.from_user.id\\n';\n        code += '    \\n';\n        code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\\n';\n        code += '    if user_id not in user_data or \"button_response_config\" not in user_data[user_id]:\\n';\n        code += '        await callback_query.answer(\"‚ö†Ô∏è –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞\", show_alert=True)\\n';\n        code += '        return\\n';\n        code += '    \\n';\n        code += '    await callback_query.message.edit_text(\"‚è≠Ô∏è –û—Ç–≤–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω\")\\n';\n        code += '    del user_data[user_id][\"button_response_config\"]\\n';\n        code += '    \\n';\n        code += '    logging.info(f\"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –ø—Ä–æ–ø—É—Å—Ç–∏–ª –∫–Ω–æ–ø–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç\")\\n';\n      }\n    });\n  }\n\n  // –î–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞\n  code += '\\n\\n# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞\\n';\n  code += '@dp.message(F.text)\\n';\n  code += 'async def handle_user_input(message: types.Message):\\n';\n  code += '    user_id = message.from_user.id\\n';\n  code += '    \\n';\n  code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–∂–∏–¥–∞–µ–º –ª–∏ –º—ã –≤–≤–æ–¥ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n';\n  code += '    if user_id in user_data and \"waiting_for_conditional_input\" in user_data[user_id]:\\n';\n  code += '        config = user_data[user_id][\"waiting_for_conditional_input\"]\\n';\n  code += '        user_text = message.text\\n';\n  code += '        \\n';\n  code += '        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n';\n  code += '        condition_id = config.get(\"condition_id\", \"unknown\")\\n';\n  code += '        next_node_id = config.get(\"next_node_id\")\\n';\n  code += '        \\n';\n  code += '        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n';\n  code += '        timestamp = get_moscow_time()\\n';\n  code += '        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é\\n';\n  code += '        input_variable = config.get(\"input_variable\", \"\")\\n';\n  code += '        if input_variable:\\n';\n  code += '            variable_name = input_variable\\n';\n  code += '        else:\\n';\n  code += '            variable_name = f\"conditional_response_{condition_id}\"\\n';\n  code += '        \\n';\n  code += '        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\\n';\n  code += '        user_data[user_id][variable_name] = user_text\\n';\n  code += '        \\n';\n  code += '        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\\n';\n  code += '        saved_to_db = await update_user_data_in_db(user_id, variable_name, user_text)\\n';\n  code += '        if saved_to_db:\\n';\n  code += '            logging.info(f\"‚úÖ –£—Å–ª–æ–≤–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î: {variable_name} = {user_text} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n';\n  code += '        else:\\n';\n  code += '            logging.warning(f\"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ\")\\n';\n  code += '        \\n';\n  code += '        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ\\n';\n  code += '        await message.answer(\"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç! –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...\")\\n';\n  code += '        \\n';\n  code += '        # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è\\n';\n  code += '        del user_data[user_id][\"waiting_for_conditional_input\"]\\n';\n  code += '        \\n';\n  code += '        logging.info(f\"–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –Ω–∞ —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {variable_name} = {user_text}\")\\n';\n  code += '        \\n';\n  code += '        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω\\n';\n  code += '        if next_node_id:\\n';\n  code += '            try:\\n';\n  code += '                logging.info(f\"üöÄ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É: {next_node_id}\")\\n';\n  code += '                \\n';\n  code += '                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∫–æ–º–∞–Ω–¥–æ–π\\n';\n  code += '                if next_node_id == \"profile_command\":\\n';\n  code += '                    logging.info(\"–ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–æ–º–∞–Ω–¥–µ /profile\")\\n';\n  code += '                    await profile_handler(message)\\n';\n  code += '                else:\\n';\n  code += '                    # –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π callback –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∫ –æ–±—ã—á–Ω–æ–º—É —É–∑–ª—É\\n';\n  code += '                    import types as aiogram_types\\n';\n  code += '                    fake_callback = aiogram_types.SimpleNamespace(\\n';\n  code += '                        id=\"conditional_nav\",\\n';\n  code += '                        from_user=message.from_user,\\n';\n  code += '                        chat_instance=\"\",\\n';\n  code += '                        data=next_node_id,\\n';\n  code += '                        message=message,\\n';\n  code += '                        answer=lambda text=\"\", show_alert=False: asyncio.sleep(0)\\n';\n  code += '                    )\\n';\n  code += '                    \\n';\n  \n  if (nodes.length > 0) {\n    nodes.forEach((targetNode, index) => {\n      const condition = index === 0 ? 'if' : 'elif';\n      const safeFunctionName = targetNode.id.replace(/[^a-zA-Z0-9_]/g, '_');\n      code += `                    ${condition} next_node_id == \"${targetNode.id}\":\\n`;\n      \n      // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–º–µ–µ—Ç –ª–∏ —É–∑–µ–ª –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n      if (targetNode.data.allowMultipleSelection === true) {\n        // –î–ª—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º —Å–æ–∑–¥–∞–µ–º –ø—Ä—è–º—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é\n        const messageText = targetNode.data.messageText || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n        const formattedText = formatTextForPython(messageText);\n        code += `                        # –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º ${targetNode.id}\\n`;\n        code += `                        logging.info(f\"üîß –£—Å–ª–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º: ${targetNode.id}\")\\n`;\n        code += `                        text = ${formattedText}\\n`;\n        \n        // –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n        code += '                        user_data[user_id] = user_data.get(user_id, {})\\n';\n        code += generateUniversalVariableReplacement('                        ');\n        \n        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n        code += `                        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n`;\n        code += `                        user_data[user_id][\"multi_select_${targetNode.id}\"] = []\\n`;\n        code += `                        user_data[user_id][\"multi_select_node\"] = \"${targetNode.id}\"\\n`;\n        code += `                        user_data[user_id][\"multi_select_type\"] = \"selection\"\\n`;\n        if (targetNode.data.multiSelectVariable) {\n          code += `                        user_data[user_id][\"multi_select_variable\"] = \"${targetNode.data.multiSelectVariable}\"\\n`;\n        }\n        \n        // –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞\n        if (targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n          code += generateInlineKeyboardCode(targetNode.data.buttons, '                        ', targetNode.id, targetNode.data, allNodeIds);\n          code += `                        await message.answer(text, reply_markup=keyboard)\\n`;\n        } else {\n          code += `                        await message.answer(text)\\n`;\n        }\n        code += `                        logging.info(f\"‚úÖ –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ ${targetNode.id} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞\")\\n`;\n      } else {\n        // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —É–∑–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–∞—á–∞–ª–∞, —Å–æ–±–∏—Ä–∞—é—Ç –ª–∏ –æ–Ω–∏ –≤–≤–æ–¥\n        if (targetNode.data.collectUserInput === true) {\n          const messageText = targetNode.data.messageText || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n          const formattedText = formatTextForPython(messageText);\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£ —É–∑–ª–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞\n          if (targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n            code += `                        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£ —É–∑–ª–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö, –∞ –Ω–µ –æ–∂–∏–¥–∞–µ–º –≤–≤–æ–¥\\n`;\n            code += `                        logging.info(f\"‚úÖ –ü–æ–∫–∞–∑–∞–Ω—ã –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–∑–ª–∞ ${targetNode.id} —Å collectUserInput=true\")\\n`;\n            code += `                        text = ${formattedText}\\n`;\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n            code += '                        user_data[user_id] = user_data.get(user_id, {})\\n';\n            code += generateUniversalVariableReplacement('                        ');\n            \n            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\n            code += generateInlineKeyboardCode(targetNode.data.buttons, '                        ', targetNode.id, targetNode.data, allNodeIds);\n            code += `                        await message.answer(text, reply_markup=keyboard)\\n`;\n          } else {\n            // –û–±—ã—á–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –µ—Å–ª–∏ –∫–Ω–æ–ø–æ–∫ –Ω–µ—Ç\n            code += `                        # –£–∑–µ–ª —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥\\n`;\n            code += `                        logging.info(f\"üîß –£—Å–ª–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É —Å –≤–≤–æ–¥–æ–º: ${targetNode.id}\")\\n`;\n            code += `                        text = ${formattedText}\\n`;\n            \n            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\n            const inputVariable = targetNode.data.inputVariable || `response_${targetNode.id}`;\n            const inputTargetNodeId = targetNode.data.inputTargetNodeId;\n            code += `                        await message.answer(text)\\n`;\n            code += `                        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\\n`;\n            code += `                        user_data[user_id][\"waiting_for_input\"] = {\\n`;\n            code += `                            \"type\": \"text\",\\n`;\n            code += `                            \"variable\": \"${inputVariable}\",\\n`;\n            code += `                            \"save_to_database\": True,\\n`;\n            code += `                            \"node_id\": \"${targetNode.id}\",\\n`;\n            code += `                            \"next_node_id\": \"${inputTargetNodeId || ''}\"\\n`;\n            code += `                        }\\n`;\n          }\n        } else {\n          // –û–±—ã—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å –ø—Ä–æ—Å—Ç—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º\n          const messageText = targetNode.data.messageText || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n          const formattedText = formatTextForPython(messageText);\n          code += `                        # –û–±—ã—á–Ω—ã–π —É–∑–µ–ª - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ\\n`;\n          code += `                        nav_text = ${formattedText}\\n`;\n          \n          // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n          code += '                        user_data[user_id] = user_data.get(user_id, {})\\n';\n          code += generateUniversalVariableReplacement('                        ');\n          code += `                        logging.info(f\"–£—Å–ª–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ –æ–±—ã—á–Ω–æ–º—É —É–∑–ª—É: ${targetNode.id}\")\\n`;\n          code += '                        await message.answer(nav_text)\\n';\n        }\n      }\n    });\n    code += '                    else:\\n';\n    code += '                        logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª: {next_node_id}\")\\n';\n  } else {\n    code += '                    # No nodes available for navigation\\n';\n    code += '                    logging.warning(f\"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–∑–ª–æ–≤ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∫ {next_node_id}\")\\n';\n  }\n  \n  code += '            except Exception as e:\\n';\n  code += '                logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É {next_node_id}: {e}\")\\n';\n  code += '        \\n';\n  code += '        return  # –ó–∞–≤–µ—Ä—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\\n';\n  code += '    \\n';\n  code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–∂–∏–¥–∞–µ–º –ª–∏ –º—ã –∫–Ω–æ–ø–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\\n';\n  code += '    if user_id in user_data and \"button_response_config\" in user_data[user_id]:\\n';\n  code += '        config = user_data[user_id][\"button_response_config\"]\\n';\n  code += '        user_text = message.text\\n';\n  code += '        \\n';\n  code += '        # –ò—â–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å—Ä–µ–¥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø—Ü–∏–π\\n';\n  code += '        selected_option = None\\n';\n  code += '        for option in config.get(\"options\", []):\\n';\n  code += '            if option[\"text\"] == user_text:\\n';\n  code += '                selected_option = option\\n';\n  code += '                break\\n';\n  code += '        \\n';\n  code += '        if selected_option:\\n';\n  code += '            selected_value = selected_option[\"value\"]\\n';\n  code += '            selected_text = selected_option[\"text\"]\\n';\n  code += '            \\n';\n  code += '            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n';\n  code += '            variable_name = config.get(\"variable\", \"button_response\")\\n';\n  code += '            timestamp = get_moscow_time()\\n';\n  code += '            node_id = config.get(\"node_id\", \"unknown\")\\n';\n  code += '            \\n';\n  code += '            # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç\\n';\n  code += '            response_data = {\\n';\n  code += '                \"value\": selected_value,\\n';\n  code += '                \"text\": selected_text,\\n';\n  code += '                \"type\": \"button_choice\",\\n';\n  code += '                \"timestamp\": timestamp,\\n';\n  code += '                \"nodeId\": node_id,\\n';\n  code += '                \"variable\": variable_name\\n';\n  code += '            }\\n';\n  code += '            \\n';\n  code += '            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\\n';\n  code += '            user_data[user_id][variable_name] = response_data\\n';\n  code += '            \\n';\n  code += '            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ\\n';\n  code += '            if config.get(\"save_to_database\"):\\n';\n  code += '                saved_to_db = await update_user_data_in_db(user_id, variable_name, response_data)\\n';\n  code += '                if saved_to_db:\\n';\n  code += '                    logging.info(f\"‚úÖ –ö–Ω–æ–ø–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î: {variable_name} = {selected_text} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n';\n  code += '                else:\\n';\n  code += '                    logging.warning(f\"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ\")\\n';\n  code += '            \\n';\n  code += '            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ\\n';\n  code += '            success_message = config.get(\"success_message\", \"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≤—ã–±–æ—Ä!\")\\n';\n  code += '            await message.answer(f\"{success_message}\\\\n\\\\n‚úÖ –í–∞—à –≤—ã–±–æ—Ä: {selected_text}\", reply_markup=ReplyKeyboardRemove())\\n';\n  code += '            \\n';\n  code += '            # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ\\n';\n  code += '            del user_data[user_id][\"button_response_config\"]\\n';\n  code += '            \\n';\n  code += '            logging.info(f\"–ü–æ–ª—É—á–µ–Ω –∫–Ω–æ–ø–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É: {variable_name} = {selected_text}\")\\n';\n  code += '            \\n';\n  code += '            # –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ–π—Å—Ç–≤–∏—è –∫–Ω–æ–ø–∫–∏\\n';\n  code += '            option_action = selected_option.get(\"action\", \"goto\")\\n';\n  code += '            option_target = selected_option.get(\"target\", \"\")\\n';\n  code += '            option_url = selected_option.get(\"url\", \"\")\\n';\n  code += '            \\n';\n  code += '            if option_action == \"url\" and option_url:\\n';\n  code += '                # –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Å—ã–ª–∫–∏\\n';\n  code += '                url = option_url\\n';\n  code += '                keyboard = InlineKeyboardMarkup(inline_keyboard=[\\n';\n  code += '                    [InlineKeyboardButton(text=\"üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É\", url=url)]\\n';\n  code += '                ])\\n';\n  code += '                await message.answer(\"–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É:\", reply_markup=keyboard)\\n';\n  code += '            elif option_action == \"command\" and option_target:\\n';\n  code += '                # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã\\n';\n  code += '                command = option_target\\n';\n  code += '                # –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã\\n';\n  code += '                import types as aiogram_types\\n';\n  code += '                fake_message = aiogram_types.SimpleNamespace(\\n';\n  code += '                    from_user=message.from_user,\\n';\n  code += '                    chat=message.chat,\\n';\n  code += '                    text=command,\\n';\n  code += '                    message_id=message.message_id\\n';\n  code += '                )\\n';\n  code += '                \\n';\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –¥–ª—è reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä\n  const commandNodes = (nodes || []).filter(n => (n.type === 'start' || n.type === 'command') && n.data.command);\n  commandNodes.forEach((cmdNode, cmdIndex) => {\n    const condition = cmdIndex === 0 ? 'if' : 'elif';\n    code += `                ${condition} command == \"${cmdNode.data.command}\":\\n`;\n    code += `                    try:\\n`;\n    code += `                        await ${cmdNode.type === 'start' ? 'start_handler' : `${cmdNode.data.command?.replace(/[^a-zA-Z0-9_]/g, '_')}_handler`}(fake_message)\\n`;\n    code += `                    except Exception as e:\\n`;\n    code += `                        logging.error(f\"–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã ${cmdNode.data.command}: {e}\")\\n`;\n  });\n  if (commandNodes.length > 0) {\n    code += `                else:\\n`;\n    code += `                    logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: {command}\")\\n`;\n  }\n  \n  code += '            elif option_action == \"goto\" and option_target:\\n';\n  code += '                # –ü–µ—Ä–µ—Ö–æ–¥ –∫ —É–∑–ª—É\\n';\n  code += '                target_node_id = option_target\\n';\n  code += '                try:\\n';\n  code += '                    # –í—ã–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\\n';\n\n  // Generate navigation logic for reply button responses  \n  if (nodes.length > 0) {\n    nodes.forEach((btnNode, btnIndex) => {\n      const safeFunctionName = btnNode.id.replace(/[^a-zA-Z0-9_]/g, '_');\n      const condition = btnIndex === 0 ? 'if' : 'elif';\n      code += `                    ${condition} target_node_id == \"${btnNode.id}\":\\n`;\n      code += `                        await handle_callback_${safeFunctionName}(types.CallbackQuery(id=\"reply_nav\", from_user=message.from_user, chat_instance=\"\", data=target_node_id, message=message))\\n`;\n    });\n    code += '                    else:\\n';\n    code += '                        logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª: {target_node_id}\")\\n';\n  } else {\n    code += '                    pass  # No nodes to handle\\n';\n  }\n  code += '                except Exception as e:\\n';\n  code += '                    logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —É–∑–ª—É {target_node_id}: {e}\")\\n';\n  code += '            else:\\n';\n  code += '                # Fallback –∫ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ next_node_id –µ—Å–ª–∏ –Ω–µ—Ç action\\n';\n  code += '                next_node_id = config.get(\"next_node_id\")\\n';\n  code += '                if next_node_id:\\n';\n  code += '                    try:\\n';\n  code += '                        # –í—ã–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞\\n';\n  \n  if (nodes.length > 0) {\n    nodes.forEach((btnNode, btnIndex) => {\n      const safeFunctionName = btnNode.id.replace(/[^a-zA-Z0-9_]/g, '_');\n      const condition = btnIndex === 0 ? 'if' : 'elif';\n      code += `                        ${condition} next_node_id == \"${btnNode.id}\":\\n`;\n      code += `                            await handle_callback_${safeFunctionName}(types.CallbackQuery(id=\"reply_nav\", from_user=message.from_user, chat_instance=\"\", data=next_node_id, message=message))\\n`;\n    });\n    code += '                        else:\\n';\n    code += '                            logging.warning(f\"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª: {next_node_id}\")\\n';\n  } else {\n    code += '                        pass  # No nodes to handle\\n';\n  }\n  code += '                    except Exception as e:\\n';\n  code += '                        logging.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É {next_node_id}: {e}\")\\n';\n  code += '            return\\n';\n  code += '        else:\\n';\n  code += '            # –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã\\n';\n  code += '            available_options = [option[\"text\"] for option in config.get(\"options\", [])]\\n';\n  code += '            options_text = \"\\\\n\".join([f\"‚Ä¢ {opt}\" for opt in available_options])\\n';\n  code += '            await message.answer(f\"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:\\\\n\\\\n{options_text}\")\\n';\n  code += '            return\\n';\n  code += '    \\n';\n  code += '    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–∂–∏–¥–∞–µ–º –ª–∏ –º—ã —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)\\n';\n  code += '    has_waiting_state = user_id in user_data and \"waiting_for_input\" in user_data[user_id]\\n';\n  code += '    logging.info(f\"DEBUG: –ü–æ–ª—É—á–µ–Ω —Ç–µ–∫—Å—Ç {message.text}, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è: {has_waiting_state}\")\\n';\n  code += '    if user_id in user_data and \"waiting_for_input\" in user_data[user_id]:\\n';\n  code += '        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–≤–æ–¥ —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É\\n';\n  code += '        waiting_config = user_data[user_id][\"waiting_for_input\"]\\n';\n  code += '        \\n';\n  code += '        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ –µ—â–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞\\n';\n  code += '        # –∏ —á—Ç–æ –≤–≤–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —É–∑–ª–∞\\n';\n  code += '        if not waiting_config:\\n';\n  code += '            return  # –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –ø—É—Å—Ç–æ–µ, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º\\n';\n  code += '        \\n';\n  code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤–≤–æ–¥ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞\\n';\n  code += '        current_node_id = waiting_config.get(\"node_id\") if isinstance(waiting_config, dict) else waiting_config\\n';\n  code += '        processed_inputs = user_data[user_id].get(\"processed_inputs\", set())\\n';\n  code += '        if current_node_id in processed_inputs and current_node_id != \"name_input\":\\n';\n  code += '            logging.info(f\"–í–≤–æ–¥ –¥–ª—è —É–∑–ª–∞ {current_node_id} —É–∂–µ –±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º\")\\n';\n  code += '            return  # –í–≤–æ–¥ –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞ —É–∂–µ –±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω\\n';\n  code += '        \\n';\n  code += '        # –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ inline –∫–Ω–æ–ø–∫–æ–π, –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º\\n';\n  code += '        variable_name_preview = waiting_config.get(\"variable\") if isinstance(waiting_config, dict) else user_data[user_id].get(\"input_variable\", \"user_response\")\\n';\n  code += '        if variable_name_preview in user_data[user_id] and user_data[user_id][variable_name_preview]:\\n';\n  code += '            logging.info(f\"–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è {variable_name_preview} —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥\")\\n';\n  code += '            # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –¥–∞–ª—å—à–µ\\n';\n  code += '            del user_data[user_id][\"waiting_for_input\"]\\n';\n  code += '            return\\n';\n  code += '        \\n';\n  code += '        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - –Ω–æ–≤—ã–π (—Å–ª–æ–≤–∞—Ä—å) –∏–ª–∏ —Å—Ç–∞—Ä—ã–π (—Å—Ç—Ä–æ–∫–∞)\\n';\n  code += '        if isinstance(waiting_config, dict):\\n';\n  code += '            # –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç - –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–ª–æ–≤–∞—Ä—è\\n';\n  code += '            waiting_node_id = waiting_config.get(\"node_id\")\\n';\n  code += '            input_type = waiting_config.get(\"type\", \"text\")\\n';\n  code += '            variable_name = waiting_config.get(\"variable\", \"user_response\")\\n';\n  code += '            save_to_database = waiting_config.get(\"save_to_database\", False)\\n';\n  code += '            min_length = waiting_config.get(\"min_length\", 0)\\n';\n  code += '            max_length = waiting_config.get(\"max_length\", 0)\\n';\n  code += '            next_node_id = waiting_config.get(\"next_node_id\")\\n';\n  code += '        else:\\n';\n  code += '            # –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç - waiting_config —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ —Å node_id\\n';\n  code += '            waiting_node_id = waiting_config\\n';\n  code += '            input_type = user_data[user_id].get(\"input_type\", \"text\")\\n';\n  code += '            variable_name = user_data[user_id].get(\"input_variable\", \"user_response\")\\n';\n  code += '            save_to_database = user_data[user_id].get(\"save_to_database\", False)\\n';\n  code += '            min_length = 0\\n';\n  code += '            max_length = 0\\n';\n  code += '            next_node_id = user_data[user_id].get(\"waiting_input_target_node_id\") or user_data[user_id].get(\"input_target_node_id\")\\n';\n  code += '        \\n';\n  code += '        user_text = message.text\\n';\n  code += '        \\n';\n  code += '        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\\n';\n  code += '        if isinstance(waiting_config, dict):\\n';\n  code += '            # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã\\n';\n  code += '            if min_length > 0 and len(user_text) < min_length:\\n';\n  code += '                retry_message = waiting_config.get(\"retry_message\", \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\")\\n';\n  code += '                await message.answer(f\"‚ùå –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç (–º–∏–Ω–∏–º—É–º {min_length} —Å–∏–º–≤–æ–ª–æ–≤). {retry_message}\")\\n';\n  code += '                return\\n';\n  code += '            \\n';\n  code += '            if max_length > 0 and len(user_text) > max_length:\\n';\n  code += '                retry_message = waiting_config.get(\"retry_message\", \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\")\\n';\n  code += '                await message.answer(f\"‚ùå –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–º–∞–∫—Å–∏–º—É–º {max_length} —Å–∏–º–≤–æ–ª–æ–≤). {retry_message}\")\\n';\n  code += '                return\\n';\n  code += '            \\n';\n  code += '            # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ –≤–≤–æ–¥–∞\\n';\n  code += '            if input_type == \"email\":\\n';\n  code += '                import re\\n';\n  code += '                email_pattern = r\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\"\\n';\n  code += '                if not re.match(email_pattern, user_text):\\n';\n  code += '                    retry_message = waiting_config.get(\"retry_message\", \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\")\\n';\n  code += '                    await message.answer(f\"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email. {retry_message}\")\\n';\n  code += '                    return\\n';\n  code += '            elif input_type == \"number\":\\n';\n  code += '                try:\\n';\n  code += '                    float(user_text)\\n';\n  code += '                except ValueError:\\n';\n  code += '                    retry_message = waiting_config.get(\"retry_message\", \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\")\\n';\n  code += '                    await message.answer(f\"‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ. {retry_message}\")\\n';\n  code += '                    return\\n';\n  code += '            elif input_type == \"phone\":\\n';\n  code += '                import re\\n';\n  code += '                phone_pattern = r\"^[+]?[0-9\\\\s\\\\-\\\\(\\\\)]{10,}$\"\\n';\n  code += '                if not re.match(phone_pattern, user_text):\\n';\n  code += '                    retry_message = waiting_config.get(\"retry_message\", \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\")\\n';\n  code += '                    await message.answer(f\"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞. {retry_message}\")\\n';\n  code += '                    return\\n';\n  code += '            \\n';\n  code += '            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\\n';\n  code += '            timestamp = get_moscow_time()\\n';\n  code += '            response_data = user_text\\n';\n  code += '            \\n';\n  code += '            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\\n';\n  code += '            user_data[user_id][variable_name] = response_data\\n';\n  code += '            \\n';\n  code += '            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ\\n';\n  code += '            if save_to_database:\\n';\n  code += '                saved_to_db = await update_user_data_in_db(user_id, variable_name, response_data)\\n';\n  code += '                if saved_to_db:\\n';\n  code += '                    logging.info(f\"‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î: {variable_name} = {user_text} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id})\")\\n';\n  code += '                else:\\n';\n  code += '                    logging.warning(f\"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ\")\\n';\n  code += '            \\n';\n  code += '            # –ò–°–ü–†–ê–í–õ–ï–ù–û: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\\n';\n  code += '            success_message = waiting_config.get(\"success_message\", \"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!\")\\n';\n  code += '            logging.info(f\"DEBUG: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º: {success_message}\")\\n';\n  code += '            await message.answer(success_message)\\n';\n  code += '            logging.info(f\"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: {success_message}\")\\n';\n  code += '            \\n';\n  code += '            # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä, —á—Ç–æ –≤–≤–æ–¥ –±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞\\n';\n  code += '            if \"processed_inputs\" not in user_data[user_id]:\\n';\n  code += '                user_data[user_id][\"processed_inputs\"] = set()\\n';\n  code += '            user_data[user_id][\"processed_inputs\"].add(waiting_node_id)\\n';\n  code += '            \\n';\n  code += '            logging.info(f\"‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ\")\\n';\n  code += '            logging.info(f\"–ü–æ–ª—É—á–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥: {variable_name} = {user_text}\")\\n';\n  code += '            \\n';\n  code += '            # –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\\n';\n  code += '            if next_node_id:\\n';\n  code += '                try:\\n';\n  code += '                    logging.info(f\"üöÄ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É: {next_node_id}\")\\n';\n  code += '                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∫ —É–∑–ª–∞–º\\n';\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞\n  if (nodes.length > 0) {\n    nodes.forEach((targetNode, index) => {\n      const condition = index === 0 ? 'if' : 'elif';\n      code += `                    ${condition} next_node_id == \"${targetNode.id}\":\\n`;\n      \n      if (targetNode.type === 'message') {\n        // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–º–µ–µ—Ç –ª–∏ —É–∑–µ–ª –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n        if (targetNode.data.allowMultipleSelection === true) {\n          // –î–ª—è —É–∑–ª–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º —Å–æ–∑–¥–∞–µ–º –ø—Ä—è–º—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é\n          const messageText = targetNode.data.messageText || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n          const formattedText = formatTextForPython(messageText);\n          code += `                        # –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º ${targetNode.id}\\n`;\n          code += `                        logging.info(f\"üîß –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —É–∑–ª—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º: ${targetNode.id}\")\\n`;\n          code += `                        text = ${formattedText}\\n`;\n          \n          // –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n          code += '                        user_data[user_id] = user_data.get(user_id, {})\\n';\n          code += generateUniversalVariableReplacement('                        ');\n          \n          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n          code += `                        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\\n`;\n          code += `                        user_data[user_id][\"multi_select_${targetNode.id}\"] = []\\n`;\n          code += `                        user_data[user_id][\"multi_select_node\"] = \"${targetNode.id}\"\\n`;\n          code += `                        user_data[user_id][\"multi_select_type\"] = \"selection\"\\n`;\n          if (targetNode.data.multiSelectVariable) {\n            code += `                        user_data[user_id][\"multi_select_variable\"] = \"${targetNode.data.multiSelectVariable}\"\\n`;\n          }\n          \n          // –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞\n          if (targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n            code += generateInlineKeyboardCode(targetNode.data.buttons, '                        ', targetNode.id, targetNode.data, allNodeIds);\n            code += `                        await message.answer(text, reply_markup=keyboard)\\n`;\n          } else {\n            code += `                        await message.answer(text)\\n`;\n          }\n          code += `                        logging.info(f\"‚úÖ –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É–∑–ª—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ ${targetNode.id} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞\")\\n`;\n        } else {\n          const messageText = targetNode.data.messageText || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n          const cleanedMessageText = stripHtmlTags(messageText);\n          const formattedText = formatTextForPython(cleanedMessageText);\n          code += `                        text = ${formattedText}\\n`;\n          \n          // –ü—Ä–∏–º–µ–Ω—è–µ–º –∑–∞–º–µ–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n          code += '                        # –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–µ\\n';\n          code += generateUniversalVariableReplacement('                        ');\n          \n          // –ï—Å–ª–∏ —É–∑–µ–ª message —Å–æ–±–∏—Ä–∞–µ—Ç –≤–≤–æ–¥, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ\n          if (targetNode.data.collectUserInput === true) {\n          const inputType = targetNode.data.inputType || 'text';\n          const inputVariable = targetNode.data.inputVariable || `response_${targetNode.id}`;\n          const inputTargetNodeId = targetNode.data.inputTargetNodeId;\n          \n          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ —É —É–∑–ª–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –í–ú–ï–°–¢–û –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞\n          if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n            code += '                        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£ —É–∑–ª–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞\\n';\n            code += '                        builder = InlineKeyboardBuilder()\\n';\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–∑–ª–∞ —Å collectUserInput + buttons\n            targetNode.data.buttons.forEach((btn, btnIndex) => {\n              if (btn.action === \"goto\" && btn.target) {\n                const callbackData = `${btn.target}`;\n                code += `                        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n              } else if (btn.action === \"url\" && btn.url) {\n                code += `                        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url}\"))\\n`;\n              } else if (btn.action === \"command\" && btn.target) {\n                const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                code += `                        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n              }\n            });\n            \n            const columns = calculateOptimalColumns(targetNode.data.buttons, targetNode.data, allNodeIds);\n            code += `                        builder.adjust(${columns})\\n`;\n            code += '                        keyboard = builder.as_markup()\\n';\n            code += '                        await message.answer(text, reply_markup=keyboard)\\n';\n            code += `                        logging.info(f\"‚úÖ –ü–æ–∫–∞–∑–∞–Ω—ã –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–∑–ª–∞ ${targetNode.id} —Å collectUserInput\")\\n`;\n          } else {\n            code += '                        await message.answer(text)\\n';\n            \n            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –Ω–µ—Ç –∫–Ω–æ–ø–æ–∫\n            code += `                        logging.info(f\"DEBUG: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è —É–∑–ª–∞ ${targetNode.id}, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è ${inputVariable}\")\\n`;\n            code += '                        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–ª—è message —É–∑–ª–∞\\n';\n            code += '                        user_data[user_id][\"waiting_for_input\"] = {\\n';\n            code += `                            \"type\": \"${inputType}\",\\n`;\n            code += `                            \"variable\": \"${inputVariable}\",\\n`;\n            code += '                            \"save_to_database\": True,\\n';\n            code += `                            \"node_id\": \"${targetNode.id}\",\\n`;\n            code += `                            \"next_node_id\": \"${inputTargetNodeId || ''}\",\\n`;\n            code += `                            \"min_length\": ${targetNode.data.minLength || 0},\\n`;\n            code += `                            \"max_length\": ${targetNode.data.maxLength || 0},\\n`;\n            code += '                            \"retry_message\": \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\",\\n';\n            code += '                            \"success_message\": \"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–≤–µ—Ç!\"\\n';\n            code += '                        }\\n';\n          }\n        } else {\n          // –ï—Å–ª–∏ —É–∑–µ–ª –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç –≤–≤–æ–¥, –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ inline –∫–Ω–æ–ø–∫–∏\n          if (targetNode.data.keyboardType === \"inline\" && targetNode.data.buttons && targetNode.data.buttons.length > 0) {\n            code += '                        # –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É\\n';\n            code += '                        builder = InlineKeyboardBuilder()\\n';\n            \n            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏\n            targetNode.data.buttons.forEach((btn, btnIndex) => {\n              if (btn.action === \"goto\" && btn.target) {\n                const callbackData = `${btn.target}`;\n                code += `                        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${callbackData}\"))\\n`;\n              } else if (btn.action === \"url\" && btn.url) {\n                code += `                        builder.add(InlineKeyboardButton(text=\"${btn.text}\", url=\"${btn.url}\"))\\n`;\n              } else if (btn.action === \"command\" && btn.target) {\n                // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥\n                const commandCallback = `cmd_${btn.target.replace('/', '')}`;\n                code += `                        logging.info(f\"–°–æ–∑–¥–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∫–æ–º–∞–Ω–¥—ã: ${btn.text} -> ${commandCallback}\")\\n`;\n                code += `                        builder.add(InlineKeyboardButton(text=\"${btn.text}\", callback_data=\"${commandCallback}\"))\\n`;\n              }\n            });\n            \n            // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º —É–º–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º\n            const columns = calculateOptimalColumns(targetNode.data.buttons, targetNode.data, allNodeIds);\n            code += `                        builder.adjust(${columns})\\n`;\n            code += '                        keyboard = builder.as_markup()\\n';\n            code += '                        await message.answer(text, reply_markup=keyboard)\\n';\n          } else {\n            code += '                        await message.answer(text)\\n';\n          }\n          \n          // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–ª—è message —É–∑–ª–æ–≤ –±–µ–∑ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞\n          if (!targetNode.data.collectUserInput) {\n            code += '                        # –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∑–¥–µ—Å—å - —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ\\n';\n            code += '                        # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞\\n';\n            code += '                        if \"waiting_for_input\" in user_data[user_id]:\\n';\n            code += '                            del user_data[user_id][\"waiting_for_input\"]\\n';\n            code += '                        \\n';\n            code += '                        logging.info(\"‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ\")\\n';\n          }\n        }\n        } // –ó–∞–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ else –¥–ª—è allowMultipleSelection\n      } else if (targetNode.type === 'message' && (targetNode.data.inputVariable || targetNode.data.responseType)) {\n        const inputPrompt = formatTextForPython(targetNode.data.messageText || \"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç:\");\n        code += `                        prompt_text = ${inputPrompt}\\n`;\n        code += '                        await message.answer(prompt_text)\\n';\n        code += '                        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞\\n';\n        code += '                        user_data[user_id][\"waiting_for_input\"] = {\\n';\n        code += `            ","size_bytes":360000},"client/src/lib/commands.ts":{"content":"// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Telegram –∏ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏—è\nexport const STANDARD_COMMANDS = [\n  {\n    command: '/start',\n    description: '–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º',\n    category: 'system',\n    showInMenu: true\n  },\n  {\n    command: '/help',\n    description: '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É',\n    category: 'system',\n    showInMenu: true\n  },\n  {\n    command: '/settings',\n    description: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞',\n    category: 'system',\n    showInMenu: true\n  },\n  {\n    command: '/menu',\n    description: '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',\n    category: 'navigation',\n    showInMenu: true\n  },\n  {\n    command: '/profile',\n    description: '–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    category: 'user',\n    showInMenu: true\n  },\n  {\n    command: '/info',\n    description: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ',\n    category: 'system',\n    showInMenu: true\n  },\n  {\n    command: '/cancel',\n    description: '–û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ',\n    category: 'system',\n    showInMenu: false\n  },\n  {\n    command: '/back',\n    description: '–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥',\n    category: 'navigation',\n    showInMenu: false\n  },\n  {\n    command: '/support',\n    description: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞',\n    category: 'system',\n    showInMenu: true\n  },\n  {\n    command: '/about',\n    description: '–û –±–æ—Ç–µ',\n    category: 'system',\n    showInMenu: true\n  },\n  {\n    command: '/subscribe',\n    description: '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',\n    category: 'user',\n    showInMenu: true\n  },\n  {\n    command: '/unsubscribe',\n    description: '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π',\n    category: 'user',\n    showInMenu: false\n  },\n  {\n    command: '/feedback',\n    description: '–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',\n    category: 'user',\n    showInMenu: true\n  },\n  {\n    command: '/language',\n    description: '–í—ã–±—Ä–∞—Ç—å —è–∑—ã–∫',\n    category: 'system',\n    showInMenu: true\n  },\n  {\n    command: '/notifications',\n    description: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π',\n    category: 'user',\n    showInMenu: true\n  }\n];\n\nexport const COMMAND_CATEGORIES = {\n  system: '–°–∏—Å—Ç–µ–º–Ω—ã–µ',\n  user: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ',\n  navigation: '–ù–∞–≤–∏–≥–∞—Ü–∏—è',\n  admin: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ'\n};\n\n// –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã\nexport function validateCommand(command: string): { isValid: boolean; errors: string[] } {\n  const errors: string[] = [];\n  \n  if (!command) {\n    errors.push('–ö–æ–º–∞–Ω–¥–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π');\n    return { isValid: false, errors };\n  }\n  \n  if (!command.startsWith('/')) {\n    errors.push('–ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —Å–∏–º–≤–æ–ª–∞ \"/\"');\n  }\n  \n  if (command.length < 2) {\n    errors.push('–ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª –ø–æ—Å–ª–µ \"/\"');\n  }\n  \n  if (command.length > 32) {\n    errors.push('–ö–æ–º–∞–Ω–¥–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 32 —Å–∏–º–≤–æ–ª–æ–≤');\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã\n  const validPattern = /^\\/[a-zA-Z][a-zA-Z0-9_]*$/;\n  if (!validPattern.test(command)) {\n    errors.push('–ö–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è');\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Telegram\n  const reservedCommands = ['/newbot', '/mybots', '/setname', '/setdescription', '/setabouttext', '/setuserpic', '/setinline', '/setjoingroups', '/setprivacy'];\n  if (reservedCommands.includes(command.toLowerCase())) {\n    errors.push('–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–æ–π Telegram');\n  }\n  \n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\n// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥\nexport function getCommandSuggestions(input: string): typeof STANDARD_COMMANDS {\n  if (!input.startsWith('/')) {\n    return [];\n  }\n  \n  const query = input.toLowerCase();\n  return STANDARD_COMMANDS.filter(cmd => \n    cmd.command.toLowerCase().includes(query) ||\n    cmd.description.toLowerCase().includes(query.slice(1))\n  ).slice(0, 10);\n}\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ —Ç–µ–∫—Å—Ç—É\nexport function parseCommandFromText(text: string): string | null {\n  if (!text || !text.startsWith('/')) {\n    return null;\n  }\n  \n  const match = text.match(/^\\/([a-zA-Z][a-zA-Z0-9_]*)/);\n  return match ? `/${match[1]}` : null;\n}\n\n// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è BotFather –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–Ω—é\nexport function generateBotFatherCommands(nodes: any[]): string {\n  if (!nodes || !Array.isArray(nodes)) {\n    return '';\n  }\n  \n  const commandNodes = nodes.filter(node => \n    (node.type === 'start' || node.type === 'command') && \n    node.data?.command &&\n    (node.data?.showInMenu !== false) // –í–∫–ª—é—á–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –≥–¥–µ showInMenu = true, undefined –∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\n  );\n  \n  if (commandNodes.length === 0) {\n    return '';\n  }\n  \n  let botFatherCommands = '';\n  \n  commandNodes.forEach(node => {\n    const command = node.data.command.replace('/', '');\n    const description = node.data.description || '–ö–æ–º–∞–Ω–¥–∞ –±–æ—Ç–∞';\n    botFatherCommands += `${command} - ${description}\\n`;\n  });\n  \n  return botFatherCommands.trim();\n}","size_bytes":5362},"client/src/lib/map-utils.ts":{"content":"/**\n * –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏\n */\n\nexport interface Coordinates {\n  latitude: number;\n  longitude: number;\n}\n\n/**\n * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å—Å—ã–ª–∫–∏ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç\n */\nexport function extractCoordinatesFromYandex(url: string): Coordinates | null {\n  try {\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ ll=longitude,latitude\n    let match = url.match(/ll=([+-]?\\d+\\.?\\d*),([+-]?\\d+\\.?\\d*)/);\n    if (match) {\n      return {\n        latitude: parseFloat(match[2]),\n        longitude: parseFloat(match[1])\n      };\n    }\n\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ /longitude,latitude/\n    match = url.match(/\\/([+-]?\\d+\\.?\\d*),([+-]?\\d+\\.?\\d*)\\//);\n    if (match) {\n      return {\n        latitude: parseFloat(match[2]),\n        longitude: parseFloat(match[1])\n      };\n    }\n\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ —Ñ–æ—Ä–º–∞—Ç–∞ /-/CHwa7LZ0\n    if (url.includes('yandex.ru/maps/-/')) {\n      // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –ø–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –µ—Å–ª–∏ –µ—Å—Ç—å\n      const urlParams = new URLSearchParams(url.split('?')[1] || '');\n      const ll = urlParams.get('ll');\n      if (ll) {\n        const [lon, lat] = ll.split(',').map(coord => parseFloat(coord));\n        if (!isNaN(lat) && !isNaN(lon)) {\n          return {\n            latitude: lat,\n            longitude: lon\n          };\n        }\n      }\n      \n      // –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –±–∞–∑–æ–≤–æ–π —á–∞—Å—Ç–∏ URL\n      const fullUrl = url.includes('?') ? url : url + '?ll=37.6176,55.7558'; // Fallback –¥–ª—è –ú–æ—Å–∫–≤—ã\n      if (fullUrl.includes('ll=')) {\n        const llMatch = fullUrl.match(/ll=([0-9.-]+),([0-9.-]+)/);\n        if (llMatch) {\n          const lon = parseFloat(llMatch[1]);\n          const lat = parseFloat(llMatch[2]);\n          if (!isNaN(lat) && !isNaN(lon)) {\n            return {\n              latitude: lat,\n              longitude: lon\n            };\n          }\n        }\n      }\n      \n      // –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ú–æ—Å–∫–≤—ã\n      console.log('–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ú–æ—Å–∫–≤—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');\n      return {\n        latitude: 55.7558,\n        longitude: 37.6176\n      };\n    }\n\n    return null;\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç:', error);\n    return null;\n  }\n}\n\n/**\n * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å—Å—ã–ª–∫–∏ Google Maps\n */\nexport function extractCoordinatesFromGoogle(url: string): Coordinates | null {\n  try {\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ @latitude,longitude\n    let match = url.match(/@([+-]?\\d+\\.?\\d*),([+-]?\\d+\\.?\\d*)/);\n    if (match) {\n      return {\n        latitude: parseFloat(match[1]),\n        longitude: parseFloat(match[2])\n      };\n    }\n\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ q=latitude,longitude\n    match = url.match(/[?&]q=([+-]?\\d+\\.?\\d*),([+-]?\\d+\\.?\\d*)/);\n    if (match) {\n      return {\n        latitude: parseFloat(match[1]),\n        longitude: parseFloat(match[2])\n      };\n    }\n\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ /latitude,longitude/\n    match = url.match(/\\/([+-]?\\d+\\.?\\d*),([+-]?\\d+\\.?\\d*)\\//);\n    if (match) {\n      return {\n        latitude: parseFloat(match[1]),\n        longitude: parseFloat(match[2])\n      };\n    }\n\n    return null;\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–∑ Google Maps:', error);\n    return null;\n  }\n}\n\n/**\n * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å—Å—ã–ª–∫–∏ 2–ì–ò–°\n */\nexport function extractCoordinatesFrom2GIS(url: string): Coordinates | null {\n  try {\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ center/longitude,latitude\n    let match = url.match(/center\\/([+-]?\\d+\\.?\\d*),([+-]?\\d+\\.?\\d*)/);\n    if (match) {\n      return {\n        latitude: parseFloat(match[2]),\n        longitude: parseFloat(match[1])\n      };\n    }\n\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ /longitude,latitude/\n    match = url.match(/\\/([+-]?\\d+\\.?\\d*),([+-]?\\d+\\.?\\d*)\\//);\n    if (match) {\n      return {\n        latitude: parseFloat(match[2]),\n        longitude: parseFloat(match[1])\n      };\n    }\n\n    // –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö URL\n    match = url.match(/[?&]lat=([+-]?\\d+\\.?\\d*).*[?&]lon=([+-]?\\d+\\.?\\d*)/);\n    if (match) {\n      return {\n        latitude: parseFloat(match[1]),\n        longitude: parseFloat(match[2])\n      };\n    }\n\n    return null;\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–∑ 2–ì–ò–°:', error);\n    return null;\n  }\n}\n\n/**\n * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ URL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ä–≤–∏—Å–∞\n */\nexport function extractCoordinatesFromUrl(url: string): {coordinates: Coordinates | null, service: string | null} {\n  if (!url) {\n    return { coordinates: null, service: null };\n  }\n\n  const urlLower = url.toLowerCase();\n\n  if (urlLower.includes('yandex.ru/maps') || urlLower.includes('ya.ru')) {\n    return {\n      coordinates: extractCoordinatesFromYandex(url),\n      service: 'yandex'\n    };\n  }\n\n  if (urlLower.includes('maps.google.com') || urlLower.includes('goo.gl/maps')) {\n    return {\n      coordinates: extractCoordinatesFromGoogle(url),\n      service: 'google'\n    };\n  }\n\n  if (urlLower.includes('2gis.ru') || urlLower.includes('2gis.com')) {\n    return {\n      coordinates: extractCoordinatesFrom2GIS(url),\n      service: '2gis'\n    };\n  }\n\n  return { coordinates: null, service: null };\n}\n\n/**\n * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã\n */\nexport function generateMapUrls(latitude: number, longitude: number, title: string = ''): Record<string, string> {\n  const encodedTitle = encodeURIComponent(title);\n  \n  return {\n    yandex: `https://yandex.ru/maps/?ll=${longitude},${latitude}&z=15&l=map&pt=${longitude},${latitude}`,\n    google: `https://maps.google.com/?q=${latitude},${longitude}`,\n    '2gis': `https://2gis.ru/geo/${longitude},${latitude}`,\n    openstreetmap: `https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=15`\n  };\n}\n\n/**\n * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n */\nexport function formatCoordinates(latitude: number, longitude: number): string {\n  return `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;\n}\n\n/**\n * –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º —á–µ—Ä–µ–∑ –æ–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ\n */\nexport async function getLocationInfo(latitude: number, longitude: number): Promise<{\n  title?: string;\n  address?: string;\n  city?: string;\n  country?: string;\n} | null> {\n  try {\n    // –ò—Å–ø–æ–ª—å–∑—É–µ–º OpenStreetMap Nominatim API –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è\n    const response = await fetch(\n      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=18&addressdetails=1`,\n      {\n        headers: {\n          'User-Agent': 'TelegramBotBuilder/1.0'\n        }\n      }\n    );\n    \n    if (!response.ok) {\n      throw new Error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –≥–µ–æ–∫–æ–¥–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å—É');\n    }\n    \n    const data = await response.json();\n    \n    if (data && data.address) {\n      const address = data.address;\n      \n      // –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ\n      let title = '';\n      if (address.name) {\n        title = address.name;\n      } else if (address.house_number && address.road) {\n        title = `${address.road}, ${address.house_number}`;\n      } else if (address.road) {\n        title = address.road;\n      } else if (address.neighbourhood) {\n        title = address.neighbourhood;\n      } else if (address.suburb) {\n        title = address.suburb;\n      } else if (address.city || address.town || address.village) {\n        title = address.city || address.town || address.village;\n      }\n      \n      // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å\n      let fullAddress = '';\n      const addressParts = [];\n      \n      if (address.house_number && address.road) {\n        addressParts.push(`${address.road}, ${address.house_number}`);\n      } else if (address.road) {\n        addressParts.push(address.road);\n      }\n      \n      if (address.neighbourhood && !addressParts.some(part => part.includes(address.neighbourhood))) {\n        addressParts.push(address.neighbourhood);\n      }\n      \n      if (address.city || address.town || address.village) {\n        addressParts.push(address.city || address.town || address.village);\n      }\n      \n      if (address.country) {\n        addressParts.push(address.country);\n      }\n      \n      fullAddress = addressParts.join(', ');\n      \n      return {\n        title: title || '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n        address: fullAddress || data.display_name,\n        city: address.city || address.town || address.village || '',\n        country: address.country || ''\n      };\n    }\n    \n    return null;\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏:', error);\n    return null;\n  }\n}","size_bytes":9533},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    let errorData;\n    try {\n      // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–æ–π\n      errorData = await res.json();\n    } catch (parseError) {\n      // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º statusText\n      throw new Error(`${res.status}: ${res.statusText}`);\n    }\n    \n    // –°–æ–∑–¥–∞–µ–º –æ—à–∏–±–∫—É —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤ (–≤–∫–ª—é—á–∞—è requiresClientApi)\n    const error = new Error(errorData.message || `${res.status}: ${res.statusText}`);\n    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –∫ –æ—à–∏–±–∫–µ\n    Object.assign(error, errorData);\n    throw error;\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<any> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return await res.json();\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: 10 * 60 * 1000, // 10 –º–∏–Ω—É—Ç –∫–µ—à –¥–ª—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)\n      gcTime: 30 * 60 * 1000, // 30 –º–∏–Ω—É—Ç –≤ garbage collection\n      retry: 1, // –û–¥–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2234},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/DatabaseManager.tsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Progress } from '@/components/ui/progress';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useLocation } from 'wouter';\nimport { \n  Download, \n  Upload, \n  Database, \n  Shield, \n  Trash2, \n  RefreshCw, \n  FileText, \n  Calendar, \n  HardDrive, \n  BarChart3,\n  AlertTriangle,\n  CheckCircle,\n  Clock,\n  Settings,\n  Archive,\n  CloudDownload,\n  Plus,\n  ArrowLeft,\n  Home\n} from 'lucide-react';\n\ninterface BackupFile {\n  filename: string;\n  filepath: string;\n  size: number;\n  created: Date;\n  metadata?: {\n    version: string;\n    timestamp: string;\n    description?: string;\n    tables: string[];\n  };\n}\n\ninterface DatabaseStats {\n  tables: Array<{\n    name: string;\n    count: number;\n    size: string;\n  }>;\n  totalRecords: number;\n  estimatedSize: string;\n}\n\nexport default function DatabaseManager() {\n  const [, navigate] = useLocation();\n  const [newBackupDescription, setNewBackupDescription] = useState('');\n  const [uploadFile, setUploadFile] = useState<File | null>(null);\n  const [restoreImmediately, setRestoreImmediately] = useState(false);\n  const [clearExisting, setClearExisting] = useState(false);\n  const [selectedBackup, setSelectedBackup] = useState<string | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π\n  const { data: backupsData, isLoading: backupsLoading } = useQuery({\n    queryKey: ['database/backups'],\n    queryFn: () => apiRequest('GET', '/api/database/backups'),\n    staleTime: 30000\n  });\n\n  // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n  const { data: statsData, isLoading: statsLoading } = useQuery({\n    queryKey: ['database/stats'],\n    queryFn: () => apiRequest('GET', '/api/database/stats/detailed'),\n    staleTime: 60000\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\n  const createBackupMutation = useMutation({\n    mutationFn: (description: string) => \n      apiRequest('POST', '/api/database/backup', { description }),\n    onSuccess: () => {\n      toast({\n        title: \"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞\",\n        description: \"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ\"\n      });\n      queryClient.invalidateQueries({ queryKey: ['database/backups'] });\n      setNewBackupDescription('');\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\n  const restoreBackupMutation = useMutation({\n    mutationFn: ({ filename, options }: { filename: string; options: any }) => \n      apiRequest('POST', '/api/database/restore', { filename, options }),\n    onSuccess: () => {\n      toast({\n        title: \"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞\",\n        description: \"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\"\n      });\n      queryClient.invalidateQueries({ queryKey: ['database/stats'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\n  const deleteBackupMutation = useMutation({\n    mutationFn: (filename: string) => \n      apiRequest('DELETE', `/api/database/backup/${filename}`),\n    onSuccess: () => {\n      toast({\n        title: \"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É–¥–∞–ª–µ–Ω–∞\",\n        description: \"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞\"\n      });\n      queryClient.invalidateQueries({ queryKey: ['database/backups'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞\n  const handleFileUpload = async () => {\n    if (!uploadFile) return;\n\n    setIsUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append('backup', uploadFile);\n      formData.append('restoreImmediately', restoreImmediately.toString());\n      formData.append('clearExisting', clearExisting.toString());\n\n      const response = await fetch('/api/database/backup/upload', {\n        method: 'POST',\n        body: formData\n      });\n\n      const result = await response.json();\n      \n      if (result.success) {\n        toast({\n          title: \"–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω\",\n          description: result.message\n        });\n        queryClient.invalidateQueries({ queryKey: ['database/backups'] });\n        if (result.restored) {\n          queryClient.invalidateQueries({ queryKey: ['database/stats'] });\n        }\n      } else {\n        throw new Error(result.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª');\n      }\n    } catch (error: any) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsUploading(false);\n      setUploadFile(null);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\n  const handleDownloadBackup = (filename: string) => {\n    const downloadUrl = `/api/database/backup/${filename}`;\n    const link = document.createElement('a');\n    link.href = downloadUrl;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const backups: BackupFile[] = backupsData?.backups || [];\n  const stats: DatabaseStats = statsData?.stats || { tables: [], totalRecords: 0, estimatedSize: 'N/A' };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto p-6 space-y-6\">\n        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigate('/')}\n              className=\"flex items-center gap-2\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              –ù–∞–∑–∞–¥ –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É\n            </Button>\n            <Separator orientation=\"vertical\" className=\"h-6\" />\n            <div>\n              <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n                <Database className=\"w-8 h-8\" />\n                –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö\n              </h1>\n              <p className=\"text-muted-foreground mt-1\">\n                –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => queryClient.invalidateQueries()}\n              disabled={backupsLoading || statsLoading}\n            >\n              <RefreshCw className={`w-4 h-4 mr-2 ${backupsLoading || statsLoading ? 'animate-spin' : ''}`} />\n              –û–±–Ω–æ–≤–∏—Ç—å\n            </Button>\n            <Badge variant=\"secondary\" className=\"text-sm\">\n              <Shield className=\"w-4 h-4 mr-1\" />\n              –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö\n            </Badge>\n          </div>\n        </div>\n\n        {/* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö */}\n        <Card className=\"border-blue-200 bg-blue-50/50 dark:border-blue-800 dark:bg-blue-950/50\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-blue-700 dark:text-blue-300\">\n              <Database className=\"w-5 h-5\" />\n              –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è\n            </CardTitle>\n            <CardDescription>\n              –≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç –≤—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–∏–º —Ñ–∞–π–ª–æ–º\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-col sm:flex-row gap-4\">\n              {/* –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö */}\n              <Button\n                onClick={() => createBackupMutation.mutate('–ë—ã—Å—Ç—Ä—ã–π —ç–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö')}\n                disabled={createBackupMutation.isPending}\n                className=\"flex-1\"\n                variant=\"default\"\n              >\n                {createBackupMutation.isPending ? (\n                  <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n                ) : (\n                  <Download className=\"w-4 h-4 mr-2\" />\n                )}\n                –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n              </Button>\n              \n              {/* –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö */}\n              <div className=\"flex-1\">\n                <Input\n                  type=\"file\"\n                  accept=\".json\"\n                  ref={fileInputRef}\n                  onChange={(e) => setUploadFile(e.target.files?.[0] || null)}\n                  className=\"hidden\"\n                />\n                <Button\n                  onClick={() => fileInputRef.current?.click()}\n                  variant=\"outline\"\n                  className=\"w-full\"\n                >\n                  <Upload className=\"w-4 h-4 mr-2\" />\n                  –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n                </Button>\n              </div>\n            </div>\n            \n            {/* –î–∏–∞–ª–æ–≥ –∏–º–ø–æ—Ä—Ç–∞ */}\n            {uploadFile && (\n              <div className=\"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800\">\n                <div className=\"flex items-center gap-2 mb-3\">\n                  <AlertTriangle className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" />\n                  <span className=\"font-medium text-yellow-800 dark:text-yellow-200\">\n                    –§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ –∏–º–ø–æ—Ä—Ç—É\n                  </span>\n                </div>\n                <p className=\"text-sm text-yellow-700 dark:text-yellow-300 mb-3\">\n                  –í—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª: <strong>{uploadFile.name}</strong>\n                </p>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Switch\n                      id=\"restore-immediately-quick\"\n                      checked={restoreImmediately}\n                      onCheckedChange={setRestoreImmediately}\n                    />\n                    <Label htmlFor=\"restore-immediately-quick\" className=\"text-sm\">\n                      –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É\n                    </Label>\n                  </div>\n                  \n                  {restoreImmediately && (\n                    <div className=\"flex items-center space-x-2\">\n                      <Switch\n                        id=\"clear-existing-quick\"\n                        checked={clearExisting}\n                        onCheckedChange={setClearExisting}\n                      />\n                      <Label htmlFor=\"clear-existing-quick\" className=\"text-sm\">\n                        –û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ\n                      </Label>\n                    </div>\n                  )}\n                  \n                  <div className=\"flex gap-2\">\n                    <Button\n                      onClick={handleFileUpload}\n                      disabled={isUploading}\n                      size=\"sm\"\n                      className=\"flex-1\"\n                    >\n                      {isUploading ? (\n                        <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n                      ) : (\n                        <CheckCircle className=\"w-4 h-4 mr-2\" />\n                      )}\n                      –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å\n                    </Button>\n                    <Button\n                      onClick={() => {\n                        setUploadFile(null);\n                        if (fileInputRef.current) {\n                          fileInputRef.current.value = '';\n                        }\n                      }}\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"flex-1\"\n                    >\n                      –û—Ç–º–µ–Ω–∞\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <BarChart3 className=\"w-5 h-5\" />\n              –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n            </CardTitle>\n            <CardDescription>\n              –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {statsLoading ? (\n              <div className=\"flex items-center gap-2\">\n                <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div className=\"p-4 bg-muted rounded-lg\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <HardDrive className=\"w-4 h-4\" />\n                      <span className=\"font-medium\">–û–±—â–∏–µ –∑–∞–ø–∏—Å–∏</span>\n                    </div>\n                    <div className=\"text-2xl font-bold\">{stats.totalRecords.toLocaleString()}</div>\n                  </div>\n                  <div className=\"p-4 bg-muted rounded-lg\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Archive className=\"w-4 h-4\" />\n                      <span className=\"font-medium\">–¢–∞–±–ª–∏—Ü—ã</span>\n                    </div>\n                    <div className=\"text-2xl font-bold\">{stats.tables.length}</div>\n                  </div>\n                  <div className=\"p-4 bg-muted rounded-lg\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Database className=\"w-4 h-4\" />\n                      <span className=\"font-medium\">–†–∞–∑–º–µ—Ä</span>\n                    </div>\n                    <div className=\"text-2xl font-bold\">{stats.estimatedSize}</div>\n                  </div>\n                </div>\n                \n                <Separator />\n                \n                <div className=\"space-y-2\">\n                  <h4 className=\"font-medium\">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º:</h4>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {stats.tables.map((table, index) => (\n                      <div key={index} className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                        <div className=\"flex items-center gap-2\">\n                          <FileText className=\"w-4 h-4\" />\n                          <span className=\"font-medium\">{table.name}</span>\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {table.count.toLocaleString()} –∑–∞–ø–∏—Å–µ–π\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Plus className=\"w-5 h-5\" />\n              –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\n            </CardTitle>\n            <CardDescription>\n              –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"backup-description\">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</Label>\n              <Textarea\n                id=\"backup-description\"\n                placeholder=\"–û–ø–∏—à–∏—Ç–µ —Ü–µ–ª—å —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...\"\n                value={newBackupDescription}\n                onChange={(e) => setNewBackupDescription(e.target.value)}\n                rows={3}\n              />\n            </div>\n            <Button \n              onClick={() => createBackupMutation.mutate(newBackupDescription)}\n              disabled={createBackupMutation.isPending}\n              className=\"w-full\"\n            >\n              {createBackupMutation.isPending ? (\n                <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n              ) : (\n                <Archive className=\"w-4 h-4 mr-2\" />\n              )}\n              –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Upload className=\"w-5 h-5\" />\n              –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\n            </CardTitle>\n            <CardDescription>\n              –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"backup-file\">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</Label>\n              <Input\n                id=\"backup-file\"\n                type=\"file\"\n                accept=\".json\"\n                onChange={(e) => setUploadFile(e.target.files?.[0] || null)}\n              />\n            </div>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"restore-immediately\"\n                  checked={restoreImmediately}\n                  onCheckedChange={setRestoreImmediately}\n                />\n                <Label htmlFor=\"restore-immediately\">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ</Label>\n              </div>\n              \n              {restoreImmediately && (\n                <div className=\"flex items-center space-x-2 ml-6\">\n                  <Switch\n                    id=\"clear-existing\"\n                    checked={clearExisting}\n                    onCheckedChange={setClearExisting}\n                  />\n                  <Label htmlFor=\"clear-existing\">–û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ</Label>\n                </div>\n              )}\n            </div>\n\n            <Button \n              onClick={handleFileUpload}\n              disabled={!uploadFile || isUploading}\n              className=\"w-full\"\n            >\n              {isUploading ? (\n                <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n              ) : (\n                <CloudDownload className=\"w-4 h-4 mr-2\" />\n              )}\n              –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* –°–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Archive className=\"w-5 h-5\" />\n              –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏\n            </CardTitle>\n            <CardDescription>\n              –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {backupsLoading ? (\n              <div className=\"flex items-center gap-2\">\n                <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π...\n              </div>\n            ) : backups.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Archive className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                <p>–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>\n                <p className=\"text-sm\">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {backups.map((backup, index) => (\n                  <div key={index} className=\"p-4 border rounded-lg\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <FileText className=\"w-4 h-4\" />\n                          <span className=\"font-medium\">{backup.filename}</span>\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            {backup.metadata?.version || 'v1.0.0'}\n                          </Badge>\n                        </div>\n                        <div className=\"text-sm text-muted-foreground space-y-1\">\n                          <div className=\"flex items-center gap-4\">\n                            <div className=\"flex items-center gap-1\">\n                              <Calendar className=\"w-3 h-3\" />\n                              {new Date(backup.created).toLocaleString()}\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                              <HardDrive className=\"w-3 h-3\" />\n                              {formatFileSize(backup.size)}\n                            </div>\n                          </div>\n                          {backup.metadata?.description && (\n                            <p className=\"text-xs\">{backup.metadata.description}</p>\n                          )}\n                          {backup.metadata?.tables && (\n                            <div className=\"flex items-center gap-1\">\n                              <Database className=\"w-3 h-3\" />\n                              <span className=\"text-xs\">\n                                –¢–∞–±–ª–∏—Ü—ã: {backup.metadata.tables.join(', ')}\n                              </span>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleDownloadBackup(backup.filename)}\n                        >\n                          <Download className=\"w-4 h-4\" />\n                        </Button>\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button size=\"sm\" variant=\"outline\">\n                              <RefreshCw className=\"w-4 h-4\" />\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent>\n                            <DialogHeader>\n                              <DialogTitle>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</DialogTitle>\n                              <DialogDescription>\n                                –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ {backup.filename}\n                              </DialogDescription>\n                            </DialogHeader>\n                            <div className=\"space-y-4\">\n                              <div className=\"flex items-center space-x-2\">\n                                <Switch\n                                  id=\"restore-clear\"\n                                  checked={clearExisting}\n                                  onCheckedChange={setClearExisting}\n                                />\n                                <Label htmlFor=\"restore-clear\">–û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ</Label>\n                              </div>\n                              <div className=\"flex items-center gap-2 p-3 bg-muted rounded-lg\">\n                                <AlertTriangle className=\"w-4 h-4 text-orange-500\" />\n                                <span className=\"text-sm\">\n                                  –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–∏—Ç —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ\n                                </span>\n                              </div>\n                              <div className=\"flex gap-2\">\n                                <Button\n                                  onClick={() => restoreBackupMutation.mutate({ \n                                    filename: backup.filename, \n                                    options: { clearExisting } \n                                  })}\n                                  disabled={restoreBackupMutation.isPending}\n                                  className=\"flex-1\"\n                                >\n                                  {restoreBackupMutation.isPending ? (\n                                    <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n                                  ) : (\n                                    <CheckCircle className=\"w-4 h-4 mr-2\" />\n                                  )}\n                                  –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å\n                                </Button>\n                              </div>\n                            </div>\n                          </DialogContent>\n                        </Dialog>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => deleteBackupMutation.mutate(backup.filename)}\n                          disabled={deleteBackupMutation.isPending}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":28013},"client/src/pages/editor-simple.tsx":{"content":"import { useState, useCallback, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useLocation, useParams } from 'wouter';\nimport { AdaptiveHeader } from '@/components/layout/adaptive-header';\nimport { ComponentsSidebar } from '@/components/editor/components-sidebar';\nimport { Canvas } from '@/components/editor/canvas';\nimport { PropertiesPanel } from '@/components/editor/properties-panel';\nimport { PreviewModal } from '@/components/editor/preview-modal';\nimport { ExportModal } from '@/components/editor/export-modal';\nimport { BotControl } from '@/components/editor/bot-control';\nimport { SaveTemplateModal } from '@/components/editor/save-template-modal';\n\nimport { ConnectionManagerPanel } from '@/components/editor/connection-manager-panel';\nimport { EnhancedConnectionControls } from '@/components/editor/enhanced-connection-controls';\nimport { ConnectionVisualization } from '@/components/editor/connection-visualization';\nimport { SmartConnectionCreator } from '@/components/editor/smart-connection-creator';\nimport { UserDatabasePanel } from '@/components/editor/user-database-panel';\nimport { ResponsesPanel } from '@/components/editor/responses-panel';\nimport { SimpleLayoutCustomizer, SimpleLayoutConfig } from '@/components/layout/simple-layout-customizer';\nimport { FlexibleLayout } from '@/components/layout/flexible-layout';\nimport { useBotEditor } from '@/hooks/use-bot-editor';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { BotProject, Connection, ComponentDefinition, BotData } from '@shared/schema';\n\nexport default function EditorSimple() {\n  const [, setLocation] = useLocation();\n  const [currentTab, setCurrentTab] = useState<'editor' | 'preview' | 'export' | 'bot' | 'connections' | 'database' | 'responses'>('editor');\n  const [showPreview, setShowPreview] = useState(false);\n  const [showExport, setShowExport] = useState(false);\n  const [showSaveTemplate, setShowSaveTemplate] = useState(false);\n\n  const [selectedConnectionId, setSelectedConnectionId] = useState<string | null>(null);\n  const [autoButtonCreation, setAutoButtonCreation] = useState(true);\n  const [selectedConnection, setSelectedConnection] = useState<Connection | null>(null);\n  \n  // –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞–∫–µ—Ç–∞\n  const baseLayoutConfig: SimpleLayoutConfig = {\n    elements: [\n      {\n        id: 'header',\n        type: 'header',\n        name: '–®–∞–ø–∫–∞',\n        position: 'top',\n        size: 64,\n        visible: true\n      },\n      {\n        id: 'sidebar',\n        type: 'sidebar',\n        name: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n        position: 'left',\n        size: 20,\n        visible: true\n      },\n      {\n        id: 'canvas',\n        type: 'canvas',\n        name: '–•–æ–ª—Å—Ç',\n        position: 'center',\n        size: 55,\n        visible: true\n      },\n      {\n        id: 'properties',\n        type: 'properties',\n        name: '–°–≤–æ–π—Å—Ç–≤–∞',\n        position: 'right',\n        size: 25,\n        visible: true\n      }\n    ],\n    compactMode: false,\n    showGrid: true\n  };\n\n  const [flexibleLayoutConfig, setFlexibleLayoutConfig] = useState<SimpleLayoutConfig>(baseLayoutConfig);\n\n  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ö—É–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞\n  const isMobile = useMediaQuery('(max-width: 1200px)');\n\n  // –°–æ–∑–¥–∞–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏\n  const adaptiveLayoutConfig = useMemo(() => {\n    console.log('Adaptive Layout Config Update:', {\n      currentTab,\n      isMobile,\n      shouldHidePanels: currentTab === 'bot' && isMobile\n    });\n    \n    if (currentTab === 'bot' && isMobile) {\n      // –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–æ—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏\n      const newConfig = {\n        ...flexibleLayoutConfig,\n        elements: flexibleLayoutConfig.elements.map(el => ({\n          ...el,\n          visible: el.type === 'sidebar' || el.type === 'properties' ? false : el.visible\n        }))\n      };\n      console.log('Hiding panels for mobile bot page', newConfig);\n      return newConfig;\n    }\n    \n    console.log('Using default layout', flexibleLayoutConfig);\n    return flexibleLayoutConfig;\n  }, [flexibleLayoutConfig, currentTab, isMobile]);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Load the first project for demo\n  const { data: projects } = useQuery<BotProject[]>({\n    queryKey: ['/api/projects'],\n  });\n\n  const currentProject = projects?.[0];\n\n  const {\n    nodes,\n    connections,\n    selectedNode,\n    selectedNodeId,\n    setSelectedNodeId,\n    addNode,\n    updateNode,\n    deleteNode,\n    addConnection,\n    deleteConnection,\n    updateConnection,\n    updateNodeData,\n    addButton,\n    updateButton,\n    deleteButton,\n    updateNodes,\n    setBotData,\n    getBotData\n  } = useBotEditor(currentProject?.data as BotData);\n\n  const updateProjectMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (!currentProject) return;\n      return apiRequest('PUT', `/api/projects/${currentProject.id}`, {\n        data: getBotData()\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/projects'] });\n      toast({\n        title: \"–ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω\",\n        description: \"–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSave = useCallback(() => {\n    updateProjectMutation.mutate({});\n  }, [updateProjectMutation]);\n\n  const handleTabChange = useCallback((tab: 'editor' | 'preview' | 'export' | 'bot' | 'connections' | 'database' | 'responses') => {\n    setCurrentTab(tab);\n    if (tab === 'preview') {\n      updateProjectMutation.mutate({});\n      setShowPreview(true);\n    } else if (tab === 'export') {\n      setShowExport(true);\n    } else if (tab === 'bot') {\n      updateProjectMutation.mutate({});\n    } else if (tab === 'connections') {\n      updateProjectMutation.mutate({});\n    } else if (tab === 'database') {\n      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n      setLocation('/database');\n    } else if (tab === 'responses') {\n      updateProjectMutation.mutate({});\n    }\n  }, [updateProjectMutation, setLocation]);\n\n  const handleNodeMove = useCallback((nodeId: string, position: { x: number; y: number }) => {\n    updateNode(nodeId, { position });\n  }, [updateNode]);\n\n  const handleComponentDrag = useCallback((component: ComponentDefinition) => {\n    // Handle component drag start if needed\n  }, []);\n\n  const handleSaveAsTemplate = useCallback(() => {\n    setShowSaveTemplate(true);\n  }, []);\n\n  const handleLoadTemplate = useCallback(() => {\n    setLocation('/templates');\n  }, [setLocation]);\n\n  const handleSelectTemplate = useCallback((template: any) => {\n    try {\n      const templateData = template.data;\n      if (!templateData || !templateData.nodes) {\n        throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞');\n      }\n      \n      setBotData(templateData);\n      updateProjectMutation.mutate({\n        data: templateData\n      });\n      \n      toast({\n        title: '–®–∞–±–ª–æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω',\n        description: `–®–∞–±–ª–æ–Ω \"${template.name}\" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Ö–æ–ª—Å—Ç`,\n      });\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞:', error);\n      toast({\n        title: '–û—à–∏–±–∫–∞',\n        description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω',\n        variant: 'destructive',\n      });\n    }\n  }, [setBotData, updateProjectMutation, toast]);\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ –≤ localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ\n  useEffect(() => {\n    const selectedTemplateData = localStorage.getItem('selectedTemplate');\n    if (selectedTemplateData && currentProject) {\n      try {\n        const template = JSON.parse(selectedTemplateData);\n        handleSelectTemplate(template);\n        localStorage.removeItem('selectedTemplate'); // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n      } catch (error) {\n        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –∏–∑ localStorage:', error);\n        localStorage.removeItem('selectedTemplate');\n      }\n    }\n  }, [currentProject, handleSelectTemplate]);\n\n  const handleConnectionSelect = useCallback((connection: Connection | null) => {\n    setSelectedConnection(connection);\n    setSelectedConnectionId(connection?.id || null);\n  }, []);\n\n  const handleConnectionEdit = useCallback((connection: Connection) => {\n    setSelectedConnection(connection);\n    setSelectedConnectionId(connection.id);\n  }, []);\n\n  const handleConnectionDelete = useCallback((connectionId: string) => {\n    deleteConnection(connectionId);\n    if (selectedConnectionId === connectionId) {\n      setSelectedConnectionId(null);\n      setSelectedConnection(null);\n    }\n  }, [deleteConnection, selectedConnectionId]);\n\n  if (!currentProject) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4\">\n            <i className=\"fas fa-spinner fa-spin text-gray-400 text-xl\"></i>\n          </div>\n          <p className=\"text-gray-600\">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞–∫–µ—Ç–∞\n  const headerContent = (\n    <AdaptiveHeader\n      config={{\n        headerPosition: 'top',\n        sidebarPosition: 'left',\n        propertiesPosition: 'right',\n        canvasFullscreen: false,\n        compactMode: false,\n        showGrid: true,\n        panelSizes: {\n          sidebar: 20,\n          properties: 25,\n          canvas: 55\n        }\n      }}\n      projectName={currentProject.name}\n      currentTab={currentTab}\n      onTabChange={handleTabChange}\n      onSave={handleSave}\n      onExport={() => setShowExport(true)}\n      onSaveAsTemplate={handleSaveAsTemplate}\n      onLoadTemplate={handleLoadTemplate}\n      onLayoutSettings={() => {}}\n      isSaving={updateProjectMutation.isPending}\n    />\n  );\n\n  const sidebarContent = (\n    <ComponentsSidebar \n      onComponentDrag={handleComponentDrag} \n      onLoadTemplate={handleLoadTemplate}\n    />\n  );\n\n  const canvasContent = (\n    <div className=\"h-full\">\n      {currentTab === 'editor' ? (\n        <Canvas\n          nodes={nodes}\n          connections={connections}\n          selectedNodeId={selectedNodeId}\n          selectedConnectionId={selectedConnectionId || undefined}\n          onNodeSelect={setSelectedNodeId}\n          onNodeAdd={addNode}\n          onNodeDelete={deleteNode}\n          onNodeMove={handleNodeMove}\n          onConnectionSelect={setSelectedConnectionId}\n          onConnectionDelete={deleteConnection}\n          onConnectionAdd={addConnection}\n          onNodesUpdate={updateNodes}\n        />\n      ) : currentTab === 'bot' ? (\n        <div className=\"h-full p-6 bg-gray-50 overflow-auto\">\n          <div className=\"max-w-2xl mx-auto\">\n            <BotControl\n              projectId={currentProject.id}\n              projectName={currentProject.name}\n            />\n          </div>\n        </div>\n      ) : currentTab === 'connections' ? (\n        <div className=\"h-full bg-background\">\n          <div className=\"h-full flex\">\n            <div className=\"w-1/2 p-4 space-y-4 overflow-auto\">\n              <SmartConnectionCreator\n                nodes={nodes}\n                connections={connections}\n                onConnectionAdd={addConnection}\n                onNodesChange={updateNodes}\n                autoButtonCreation={autoButtonCreation}\n                selectedNodeId={selectedNodeId || undefined}\n              />\n              \n              <EnhancedConnectionControls\n                nodes={nodes}\n                connections={connections}\n                onConnectionAdd={addConnection}\n                onConnectionDelete={deleteConnection}\n                onConnectionUpdate={updateConnection}\n                onNodesChange={updateNodes}\n                autoButtonCreation={autoButtonCreation}\n                onAutoButtonCreationChange={setAutoButtonCreation}\n                selectedConnection={selectedConnection}\n                onConnectionSelect={setSelectedConnection}\n              />\n            </div>\n            \n            <div className=\"w-1/2 p-4 overflow-auto border-l\">\n              <ConnectionVisualization\n                nodes={nodes}\n                connections={connections}\n                onConnectionSelect={handleConnectionSelect}\n                onConnectionDelete={handleConnectionDelete}\n                onConnectionEdit={handleConnectionEdit}\n                selectedConnectionId={selectedConnectionId || undefined}\n                showLabels={true}\n                showMetrics={true}\n                interactive={true}\n              />\n            </div>\n          </div>\n        </div>\n      ) : currentTab === 'database' ? (\n        <div className=\"h-full\">\n          <UserDatabasePanel\n            projectId={currentProject.id}\n            projectName={currentProject.name}\n          />\n        </div>\n      ) : currentTab === 'responses' ? (\n        <div className=\"h-full\">\n          <ResponsesPanel\n            projectId={currentProject.id}\n            projectName={currentProject.name}\n          />\n        </div>\n      ) : null}\n    </div>\n  );\n\n  const propertiesContent = (\n    <PropertiesPanel\n      projectId={currentProject.id}\n      selectedNode={selectedNode}\n      allNodes={nodes}\n      onNodeUpdate={updateNodeData}\n      onButtonAdd={addButton}\n      onButtonUpdate={updateButton}\n      onButtonDelete={deleteButton}\n    />\n  );\n\n  return (\n    <>\n      <SimpleLayoutCustomizer\n        config={flexibleLayoutConfig}\n        onConfigChange={setFlexibleLayoutConfig}\n      >\n        <FlexibleLayout\n          config={adaptiveLayoutConfig}\n          headerContent={headerContent}\n          sidebarContent={sidebarContent}\n          canvasContent={canvasContent}\n          propertiesContent={propertiesContent}\n          onConfigChange={setFlexibleLayoutConfig}\n        />\n      </SimpleLayoutCustomizer>\n\n      <PreviewModal\n        isOpen={showPreview}\n        onClose={() => {\n          setShowPreview(false);\n          setCurrentTab('editor');\n        }}\n        nodes={nodes}\n        connections={connections}\n        projectName={currentProject.name}\n      />\n\n      <ExportModal\n        isOpen={showExport}\n        onClose={() => {\n          setShowExport(false);\n          setCurrentTab('editor');\n        }}\n        botData={currentProject?.data as any}\n        projectName={currentProject.name}\n      />\n\n      <SaveTemplateModal\n        isOpen={showSaveTemplate}\n        onClose={() => setShowSaveTemplate(false)}\n        botData={currentProject?.data as any}\n        projectName={currentProject.name}\n      />\n\n\n    </>\n  );\n}","size_bytes":15363},"client/src/pages/editor.tsx":{"content":"import { useState, useCallback, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useLocation, useParams, useRoute } from 'wouter';\nimport { Header } from '@/components/editor/header';\nimport { ComponentsSidebar } from '@/components/editor/components-sidebar';\nimport { Canvas } from '@/components/editor/canvas';\nimport { PropertiesPanel } from '@/components/editor/properties-panel';\nimport { PreviewModal } from '@/components/editor/preview-modal';\nimport { ExportModal } from '@/components/editor/export-modal';\nimport { BotControl } from '@/components/editor/bot-control';\nimport { SaveTemplateModal } from '@/components/editor/save-template-modal';\nimport { VisibilityControls } from '@/components/editor/visibility-controls';\n\nimport { ConnectionManagerPanel } from '@/components/editor/connection-manager-panel';\nimport { EnhancedConnectionControls } from '@/components/editor/enhanced-connection-controls';\nimport { ConnectionVisualization } from '@/components/editor/connection-visualization';\nimport { SmartConnectionCreator } from '@/components/editor/smart-connection-creator';\nimport { UserDatabasePanel } from '@/components/editor/user-database-panel';\nimport { GroupsPanel } from '@/components/editor/groups-panel';\nimport { AdaptiveLayout } from '@/components/layout/adaptive-layout';\nimport { AdaptiveHeader } from '@/components/layout/adaptive-header';\nimport { LayoutManager, useLayoutManager } from '@/components/layout/layout-manager';\nimport { LayoutCustomizer } from '@/components/layout/layout-customizer';\nimport { SimpleLayoutCustomizer, SimpleLayoutConfig } from '@/components/layout/simple-layout-customizer';\nimport { FlexibleLayout } from '@/components/layout/flexible-layout';\nimport { ResizablePanelGroup, ResizablePanel, ResizableHandle } from '@/components/ui/resizable';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet';\nimport { useBotEditor } from '@/hooks/use-bot-editor';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { apiRequest } from '@/lib/queryClient';\nimport { BotProject, Connection, ComponentDefinition, BotData, BotDataWithSheets, Node } from '@shared/schema';\nimport { SheetsManager } from '@/utils/sheets-manager';\nimport { nanoid } from 'nanoid';\n\nexport default function Editor() {\n  const [, setLocation] = useLocation();\n  const [match, params] = useRoute('/editor/:id');\n  const projectId = params?.id ? parseInt(params.id) : null;\n  const [currentTab, setCurrentTab] = useState<'editor' | 'preview' | 'export' | 'bot' | 'users' | 'groups'>('editor');\n  const [showPreview, setShowPreview] = useState(false);\n  const [showExport, setShowExport] = useState(false);\n  const [showSaveTemplate, setShowSaveTemplate] = useState(false);\n  const [showMobileSidebar, setShowMobileSidebar] = useState(false);\n  const [showMobileProperties, setShowMobileProperties] = useState(false);\n  \n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ\n  const isMobile = useIsMobile();\n\n  // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n  useEffect(() => {\n    if (isMobile) {\n      // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–±–∏–ª—å–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É\n      setShowMobileSidebar(false);\n      setShowMobileProperties(false);\n      \n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é layout –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤\n      setFlexibleLayoutConfig(prev => ({\n        ...prev,\n        elements: prev.elements.map(element => {\n          // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã–≤–∞–µ–º sidebar –∏ properties –ø–∞–Ω–µ–ª–∏,\n          // –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º –∏—Ö –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–±–æ—Ç–∞–ª–∏\n          if (element.type === 'sidebar' || element.type === 'properties') {\n            return { ...element, visible: false };\n          }\n          return element;\n        })\n      }));\n    } else {\n      // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏\n      setFlexibleLayoutConfig(prev => ({\n        ...prev,\n        elements: prev.elements.map(element => ({\n          ...element,\n          visible: true\n        }))\n      }));\n    }\n  }, [isMobile]); // –£–±–∏—Ä–∞–µ–º match –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —á—Ç–æ–±—ã —ç—Ñ—Ñ–µ–∫—Ç –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –ø—Ä–∏ –∫–∞–∂–¥–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n\n  const [selectedConnectionId, setSelectedConnectionId] = useState<string | null>(null);\n  const [autoButtonCreation, setAutoButtonCreation] = useState(true);\n  const [selectedConnection, setSelectedConnection] = useState<Connection | null>(null);\n  const [showLayoutManager, setShowLayoutManager] = useState(false);\n  const [showLayoutCustomizer, setShowLayoutCustomizer] = useState(false);\n  const [useFlexibleLayout, setUseFlexibleLayout] = useState(true);\n  \n  // –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∏—Å—Ç–æ–≤\n  const [botDataWithSheets, setBotDataWithSheets] = useState<BotDataWithSheets | null>(null);\n  \n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —É–∑–ª–æ–≤ (–¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–≥–æ layout)\n  const [currentNodeSizes, setCurrentNodeSizes] = useState<Map<string, { width: number; height: number }>>(new Map());\n  \n  // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞  \n  const [isLoadingTemplate, setIsLoadingTemplate] = useState(false);\n  \n  // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö\n  const [hasLocalChanges, setHasLocalChanges] = useState(false);\n  \n  // Track the last loaded project ID to prevent unnecessary reloads\n  const [lastLoadedProjectId, setLastLoadedProjectId] = useState<number | null>(null);\n  \n  // Callback –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ —É–∑–ª–æ–≤ –∏–∑ Canvas\n  const handleNodeSizesChange = useCallback((nodeSizes: Map<string, { width: number; height: number }>) => {\n    setCurrentNodeSizes(nodeSizes);\n  }, []);\n  \n  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é –ø–∞–Ω–µ–ª–µ–π\n  const handleToggleHeader = useCallback(() => {\n    setFlexibleLayoutConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(element =>\n        element.id === 'header'\n          ? { ...element, visible: !element.visible }\n          : element\n      )\n    }));\n  }, []);\n\n  const handleToggleSidebar = useCallback(() => {\n    setFlexibleLayoutConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(element =>\n        element.id === 'sidebar'\n          ? { ...element, visible: !element.visible }\n          : element\n      )\n    }));\n  }, []);\n\n  const handleToggleProperties = useCallback(() => {\n    setFlexibleLayoutConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(element =>\n        element.id === 'properties'\n          ? { ...element, visible: !element.visible }\n          : element\n      )\n    }));\n  }, []);\n\n  const handleToggleCanvas = useCallback(() => {\n    setFlexibleLayoutConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(element =>\n        element.id === 'canvas'\n          ? { ...element, visible: !element.visible }\n          : element\n      )\n    }));\n  }, []);\n\n  const handleOpenMobileSidebar = useCallback(() => {\n    setShowMobileSidebar(true);\n  }, []);\n\n  const handleOpenMobileProperties = useCallback(() => {\n    setShowMobileProperties(true);\n  }, []);\n\n  // –°–æ–∑–¥–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–∞–∫–µ—Ç–∞\n  const getFlexibleLayoutConfig = useCallback((): SimpleLayoutConfig => {\n    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤\n    const headerSize = isMobile ? 2.5 : 3;\n    \n    return {\n      elements: [\n        {\n          id: 'header',\n          type: 'header',\n          name: '–®–∞–ø–∫–∞',\n          position: 'top',\n          size: headerSize,\n          visible: true\n        },\n        {\n          id: 'sidebar',\n          type: 'sidebar',\n          name: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n          position: 'left',\n          size: 20,\n          visible: true\n        },\n        {\n          id: 'canvas',\n          type: 'canvas',\n          name: '–•–æ–ª—Å—Ç',\n          position: 'center',\n          size: 55,\n          visible: true\n        },\n        {\n          id: 'properties',\n          type: 'properties',\n          name: '–°–≤–æ–π—Å—Ç–≤–∞',\n          position: 'right',\n          size: 25,\n          visible: true\n        }\n      ],\n      compactMode: false,\n      showGrid: true\n    };\n  }, [currentTab, isMobile]);\n\n  const [flexibleLayoutConfig, setFlexibleLayoutConfig] = useState<SimpleLayoutConfig>(getFlexibleLayoutConfig());\n  \n  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–∞–∫–µ—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–∫–∏ –∏–ª–∏ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞\n  useEffect(() => {\n    setFlexibleLayoutConfig(getFlexibleLayoutConfig());\n  }, [getFlexibleLayoutConfig]);\n  \n  const { config: layoutConfig, updateConfig: updateLayoutConfig, resetConfig: resetLayoutConfig, applyConfig: applyLayoutConfig } = useLayoutManager();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Load all projects\n  const { data: projects } = useQuery<BotProject[]>({\n    queryKey: ['/api/projects'],\n  });\n\n  // Find current project by ID from URL\n  const currentProject = projects?.find(p => p.id === projectId) || projects?.[0];\n\n  const {\n    nodes,\n    connections,\n    selectedNode,\n    selectedNodeId,\n    setSelectedNodeId,\n    addNode,\n    updateNode,\n    deleteNode,\n    duplicateNode,\n    duplicateNodes,\n    addConnection,\n    deleteConnection,\n    updateConnection,\n    updateNodeData,\n    addButton,\n    updateButton,\n    deleteButton,\n    updateNodes,\n    setBotData,\n    getBotData,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    copyToClipboard,\n    pasteFromClipboard,\n    hasClipboardData,\n    isNodeBeingDragged,\n    setIsNodeBeingDragged\n  } = useBotEditor(currentProject?.data as BotData);\n\n  // Reset hasLocalChanges when project changes\n  useEffect(() => {\n    if (currentProject?.id !== lastLoadedProjectId && lastLoadedProjectId !== null) {\n      setHasLocalChanges(false);\n    }\n  }, [currentProject?.id, lastLoadedProjectId]);\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤\n  const handleBotDataUpdate = useCallback((updatedData: BotDataWithSheets) => {\n    setBotDataWithSheets(updatedData);\n    \n    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç —Å —Å–∏—Å—Ç–µ–º–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞\n    const activeSheet = SheetsManager.getActiveSheet(updatedData);\n    if (activeSheet) {\n      // –í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º –∞–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—é –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n      const shouldSkipLayout = false; // –ê–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —É–∑–ª–æ–≤\n      setBotData({ nodes: activeSheet.nodes, connections: activeSheet.connections }, undefined, shouldSkipLayout ? undefined : currentNodeSizes, shouldSkipLayout);\n    }\n  }, [setBotData, currentNodeSizes, isMobile, nodes.length]);\n\n  // –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–∑–ª–æ–≤, –∫–æ—Ç–æ—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –ª–∏—Å—Ç–æ–≤\n  const handleNodeUpdateWithSheets = useCallback((nodeId: string, updates: any) => {\n    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ\n    updateNodeData(nodeId, updates);\n    \n    // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –≤ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –ª–∏—Å—Ç–æ–≤\n    if (botDataWithSheets && botDataWithSheets.activeSheetId) {\n      const updatedSheets = botDataWithSheets.sheets.map(sheet => {\n        if (sheet.id === botDataWithSheets.activeSheetId) {\n          return {\n            ...sheet,\n            nodes: sheet.nodes.map(node => \n              node.id === nodeId \n                ? { ...node, data: { ...node.data, ...updates } }\n                : node\n            )\n          };\n        }\n        return sheet;\n      });\n      \n      setBotDataWithSheets({\n        ...botDataWithSheets,\n        sheets: updatedSheets\n      });\n    }\n  }, [updateNodeData, botDataWithSheets]);\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã —Ç–∏–ø–∞ —É–∑–ª–∞\n  const handleNodeTypeChange = useCallback((nodeId: string, newType: any, newData: any) => {\n    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ\n    updateNode(nodeId, { type: newType, data: newData });\n    \n    // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –≤ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –ª–∏—Å—Ç–æ–≤\n    if (botDataWithSheets && botDataWithSheets.activeSheetId) {\n      const updatedSheets = botDataWithSheets.sheets.map(sheet => {\n        if (sheet.id === botDataWithSheets.activeSheetId) {\n          return {\n            ...sheet,\n            nodes: sheet.nodes.map(node => \n              node.id === nodeId \n                ? { ...node, type: newType, data: newData }\n                : node\n            )\n          };\n        }\n        return sheet;\n      });\n      \n      setBotDataWithSheets({\n        ...botDataWithSheets,\n        sheets: updatedSheets\n      });\n    }\n  }, [updateNode, botDataWithSheets]);\n\n  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ - only when truly switching projects\n  useEffect(() => {\n    \n    // Only load project data when:\n    // 1. We have a project with data\n    // 2. We're not loading a template  \n    // 3. We don't have local changes in progress\n    // 4. This is truly a new project (ID changed) OR initial load (lastLoadedProjectId is null)\n    if (currentProject?.data && !isLoadingTemplate && !hasLocalChanges && \n        (lastLoadedProjectId !== currentProject?.id)) {\n      \n      console.log('üìÇ Loading project data for project ID:', currentProject.id);\n      const projectData = currentProject.data as any;\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–æ–≤—ã–π –ª–∏ —ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç —Å –ª–∏—Å—Ç–∞–º–∏\n      if (SheetsManager.isNewFormat(projectData)) {\n        setBotDataWithSheets(projectData);\n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–æ–π\n        const activeSheet = SheetsManager.getActiveSheet(projectData);\n        if (activeSheet) {\n          // –í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º layout –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö\n          const shouldSkipLayout = isMobile && nodes.length > 0 && !isLoadingTemplate && lastLoadedProjectId !== null;\n          setBotData({ nodes: activeSheet.nodes, connections: activeSheet.connections }, undefined, shouldSkipLayout ? undefined : currentNodeSizes, shouldSkipLayout);\n        }\n      } else {\n        // –ú–∏–≥—Ä–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ –Ω–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É\n        const migratedData = SheetsManager.migrateLegacyData(projectData as BotData);\n        setBotDataWithSheets(migratedData);\n        // –í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º layout –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö\n        const shouldSkipLayout = isMobile && nodes.length > 0 && !isLoadingTemplate && lastLoadedProjectId !== null;\n        setBotData(projectData as BotData, undefined, shouldSkipLayout ? undefined : currentNodeSizes, shouldSkipLayout);\n      }\n      \n      // Update the last loaded project ID\n      setLastLoadedProjectId(currentProject.id);\n      \n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —à–∞–±–ª–æ–Ω–æ–≤\n      localStorage.setItem('lastProjectId', currentProject.id.toString());\n    }\n  }, [currentProject?.id, currentProject?.data, setBotData, currentNodeSizes, isLoadingTemplate, hasLocalChanges, lastLoadedProjectId, isMobile, nodes.length]);\n\n  const updateProjectMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (!currentProject) return;\n      \n      // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å —Ö–æ–ª—Å—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n      let projectData;\n      \n      if (botDataWithSheets) {\n        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Ö–æ–ª—Å—Ç–∞\n        const currentCanvasData = getBotData();\n        const activeSheetId = botDataWithSheets.activeSheetId;\n        const updatedSheets = botDataWithSheets.sheets.map(sheet => \n          sheet.id === activeSheetId \n            ? { ...sheet, nodes: currentCanvasData.nodes, connections: currentCanvasData.connections, updatedAt: new Date() }\n            : sheet\n        );\n        \n        projectData = {\n          ...botDataWithSheets,\n          sheets: updatedSheets\n        };\n      } else {\n        // –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ —Å –ª–∏—Å—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Ö–æ–ª—Å—Ç–∞\n        projectData = getBotData();\n      }\n      \n      return apiRequest('PUT', `/api/projects/${currentProject.id}`, {\n        data: projectData\n      });\n    },\n    onSuccess: (updatedProject) => {\n      console.log('–ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à –ø—Ä–æ–µ–∫—Ç–æ–≤');\n      \n      // Reset local changes flag only after successful save\n      setHasLocalChanges(false);\n      \n      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à –ø—Ä–æ–µ–∫—Ç–æ–≤\n      queryClient.invalidateQueries({ queryKey: ['/api/projects'] });\n      \n      toast({\n        title: \"–ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω\",\n        description: \"–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSave = useCallback(() => {\n    updateProjectMutation.mutate({});\n  }, [updateProjectMutation]);\n\n  const handleTabChange = useCallback((tab: 'editor' | 'preview' | 'export' | 'bot' | 'users' | 'groups') => {\n    setCurrentTab(tab);\n    if (tab === 'preview') {\n      // Auto-save before showing preview\n      updateProjectMutation.mutate({});\n      setShowPreview(true);\n    } else if (tab === 'export') {\n      // Auto-save before showing export modal\n      updateProjectMutation.mutate({});\n      setShowExport(true);\n    } else if (tab === 'bot') {\n      // Auto-save before showing bot controls\n      updateProjectMutation.mutate({});\n    } else if (tab === 'users') {\n      // Auto-save before showing users panel\n      updateProjectMutation.mutate({});\n    }\n  }, [updateProjectMutation]);\n\n  // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞–º–∏\n  const handleSheetAdd = useCallback((name: string) => {\n    if (!botDataWithSheets) return;\n    \n    try {\n      const updatedData = SheetsManager.addSheet(botDataWithSheets, name);\n      setBotDataWithSheets(updatedData);\n      \n      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—ã–π –ª–∏—Å—Ç\n      const newSheet = SheetsManager.getActiveSheet(updatedData);\n      if (newSheet) {\n        // –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º –∞–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—é\n        const shouldSkipLayout = false; // –ê–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –Ω—É–∂–Ω–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ª–∏—Å—Ç–æ–≤\n        setBotData({ nodes: newSheet.nodes, connections: newSheet.connections }, undefined, shouldSkipLayout ? undefined : currentNodeSizes, shouldSkipLayout);\n      }\n      \n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è\n      updateProjectMutation.mutate({});\n      \n      toast({\n        title: \"–õ–∏—Å—Ç —Å–æ–∑–¥–∞–Ω\",\n        description: `–õ–∏—Å—Ç \"${name}\" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,\n      });\n    } catch (error) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  }, [botDataWithSheets, setBotData, updateProjectMutation, toast, isMobile, nodes.length, currentNodeSizes]);\n\n  const handleSheetDelete = useCallback((sheetId: string) => {\n    if (!botDataWithSheets) return;\n    \n    try {\n      const updatedData = SheetsManager.deleteSheet(botDataWithSheets, sheetId);\n      setBotDataWithSheets(updatedData);\n      \n      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç\n      const activeSheet = SheetsManager.getActiveSheet(updatedData);\n      if (activeSheet) {\n        setBotData({ nodes: activeSheet.nodes, connections: activeSheet.connections }); // –∞–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –ª–∏—Å—Ç–æ–≤\n      }\n      \n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è\n      updateProjectMutation.mutate({});\n      \n      toast({\n        title: \"–õ–∏—Å—Ç —É–¥–∞–ª–µ–Ω\",\n        description: \"–õ–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω\",\n      });\n    } catch (error) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ª–∏—Å—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  }, [botDataWithSheets, setBotData, updateProjectMutation, toast]);\n\n  const handleSheetRename = useCallback((sheetId: string, newName: string) => {\n    if (!botDataWithSheets) return;\n    \n    try {\n      const updatedData = SheetsManager.renameSheet(botDataWithSheets, sheetId, newName);\n      setBotDataWithSheets(updatedData);\n      \n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è\n      updateProjectMutation.mutate({});\n      \n      toast({\n        title: \"–õ–∏—Å—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω\",\n        description: `–õ–∏—Å—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ \"${newName}\"`,\n      });\n    } catch (error) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ª–∏—Å—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  }, [botDataWithSheets, updateProjectMutation, toast]);\n\n  const handleSheetDuplicate = useCallback((sheetId: string) => {\n    if (!botDataWithSheets) return;\n    \n    try {\n      const updatedData = SheetsManager.duplicateSheetInProject(botDataWithSheets, sheetId);\n      setBotDataWithSheets(updatedData);\n      \n      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–∏—Å—Ç\n      const newSheet = SheetsManager.getActiveSheet(updatedData);\n      if (newSheet) {\n        // –ü—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –ª–∏—Å—Ç–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º –∞–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—é\n        const shouldSkipLayout = false; // –ê–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –Ω—É–∂–Ω–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤\n        setBotData({ nodes: newSheet.nodes, connections: newSheet.connections }, undefined, shouldSkipLayout ? undefined : currentNodeSizes, shouldSkipLayout);\n      }\n      \n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è\n      updateProjectMutation.mutate({});\n      \n      toast({\n        title: \"–õ–∏—Å—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω\",\n        description: \"–õ–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω\",\n      });\n    } catch (error) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  }, [botDataWithSheets, setBotData, updateProjectMutation, toast]);\n\n  const handleSheetSelect = useCallback((sheetId: string) => {\n    if (!botDataWithSheets) return;\n    \n    try {\n      // –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Ö–æ–ª—Å—Ç–∞ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –ª–∏—Å—Ç–µ\n      const currentCanvasData = getBotData();\n      const activeSheetId = botDataWithSheets.activeSheetId;\n      const updatedSheets = botDataWithSheets.sheets.map(sheet => \n        sheet.id === activeSheetId \n          ? { ...sheet, nodes: currentCanvasData.nodes, connections: currentCanvasData.connections, updatedAt: new Date() }\n          : sheet\n      );\n      \n      // –ó–∞—Ç–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—ã–π –ª–∏—Å—Ç\n      const updatedData = SheetsManager.setActiveSheet(\n        { ...botDataWithSheets, sheets: updatedSheets }, \n        sheetId\n      );\n      setBotDataWithSheets(updatedData);\n      \n      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ –Ω–∞ —Ö–æ–ª—Å—Ç\n      const newActiveSheet = SheetsManager.getActiveSheet(updatedData);\n      if (newActiveSheet) {\n        // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –ª–∏—Å—Ç–æ–≤ –ø—Ä–∏–º–µ–Ω—è–µ–º –∞–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—é –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n        const shouldSkipLayout = false; // –ê–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –Ω—É–∂–Ω–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n        setBotData({ nodes: newActiveSheet.nodes, connections: newActiveSheet.connections }, undefined, shouldSkipLayout ? undefined : currentNodeSizes, shouldSkipLayout);\n      }\n      \n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è\n      updateProjectMutation.mutate({});\n    } catch (error) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ª–∏—Å—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  }, [botDataWithSheets, getBotData, setBotData, updateProjectMutation, toast, isMobile, nodes.length, currentNodeSizes]);\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\n  useEffect(() => {\n    const selectedTemplateData = localStorage.getItem('selectedTemplate');\n    if (selectedTemplateData && currentProject) {\n      try {\n        setIsLoadingTemplate(true); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞\n        const template = JSON.parse(selectedTemplateData);\n        console.log('–ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω:', template.name);\n        \n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —à–∞–±–ª–æ–Ω–µ –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞\n        if (template.data.sheets && Array.isArray(template.data.sheets)) {\n          console.log('–ü—Ä–∏–º–µ–Ω—è–µ–º –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω —Å –ª–∏—Å—Ç–∞–º–∏:', template.data.sheets.length);\n          \n          // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ ID –¥–ª—è –ª–∏—Å—Ç–æ–≤ —à–∞–±–ª–æ–Ω–∞\n          const updatedSheets = template.data.sheets.map((sheet: any) => {\n            // –û—á–∏—â–∞–µ–º —É–∑–ª—ã –æ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫\n            const cleanNodes = sheet.nodes?.map((node: any) => {\n              const cleanNode = {\n                id: node.id,\n                type: node.type,\n                position: node.position || { x: 0, y: 0 },\n                data: {\n                  ...node.data,\n                  // –£–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏\n                  parent: undefined,\n                  children: undefined\n                }\n              };\n              return cleanNode;\n            }) || [];\n\n            // –û—á–∏—â–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n            const cleanConnections = sheet.connections?.map((conn: any) => ({\n              id: conn.id,\n              source: conn.source,\n              target: conn.target,\n              sourceHandle: conn.sourceHandle,\n              targetHandle: conn.targetHandle\n            })) || [];\n\n            return {\n              id: nanoid(), // –ù–æ–≤—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –ª–∏—Å—Ç–∞\n              name: sheet.name,\n              nodes: cleanNodes,\n              connections: cleanConnections,\n              viewState: sheet.viewState || { position: { x: 0, y: 0 }, zoom: 1 },\n              createdAt: new Date(),\n              updatedAt: new Date()\n            };\n          });\n          \n          const templateDataWithSheets = {\n            sheets: updatedSheets,\n            activeSheetId: updatedSheets[0]?.id,\n            version: 2,\n            interSheetConnections: template.data.interSheetConnections || []\n          };\n          \n          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n          setBotDataWithSheets(templateDataWithSheets);\n          \n          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π –Ω–∞ —Ö–æ–ª—Å—Ç–µ\n          const firstSheet = updatedSheets[0];\n          if (firstSheet) {\n            // –í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º –∞–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è\n            const shouldSkipLayout = false; // –ê–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤\n            setBotData({ nodes: firstSheet.nodes, connections: firstSheet.connections }, template.name, currentNodeSizes, shouldSkipLayout);\n          }\n          \n          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø—Ä–æ–µ–∫—Ç\n          updateProjectMutation.mutate({\n            data: templateDataWithSheets\n          });\n        } else {\n          // –û–±—ã—á–Ω—ã–π —à–∞–±–ª–æ–Ω –±–µ–∑ –ª–∏—Å—Ç–æ–≤ - –º–∏–≥—Ä–∏—Ä—É–µ–º –∫ —Ñ–æ—Ä–º–∞—Ç—É —Å –ª–∏—Å—Ç–∞–º–∏\n          console.log('–ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—ã—á–Ω—ã–π —à–∞–±–ª–æ–Ω –∏ –º–∏–≥—Ä–∏—Ä—É–µ–º –∫ —Ñ–æ—Ä–º–∞—Ç—É —Å –ª–∏—Å—Ç–∞–º–∏');\n          const migratedData = SheetsManager.migrateLegacyData(template.data);\n          setBotDataWithSheets(migratedData);\n          // –í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º –∞–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è\n          const shouldSkipLayout = false; // –ê–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–±—ã—á–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤\n          setBotData(template.data, template.name, currentNodeSizes, shouldSkipLayout); // –∞–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —à–∞–±–ª–æ–Ω–æ–≤\n          \n          updateProjectMutation.mutate({\n            data: migratedData\n          });\n        }\n        \n        toast({\n          title: '–®–∞–±–ª–æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω',\n          description: `–®–∞–±–ª–æ–Ω \"${template.name}\" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`,\n        });\n        \n        // –£–¥–∞–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω\n        localStorage.removeItem('selectedTemplate');\n        \n        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –¥–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∑–∞—Ç–µ–º —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥\n        setTimeout(() => {\n          setIsLoadingTemplate(false);\n        }, 1000);\n      } catch (error) {\n        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞:', error);\n        localStorage.removeItem('selectedTemplate');\n        setIsLoadingTemplate(false); // –£–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –æ—à–∏–±–∫–µ\n      }\n    }\n  }, [currentProject?.id, setBotData, setBotDataWithSheets, updateProjectMutation, toast]);\n\n  // Enhanced onNodeUpdate that auto-saves changes\n  const handleNodeUpdate = useCallback((nodeId: string, updates: any) => {\n    // First update local state\n    updateNodeData(nodeId, updates);\n    // Set local changes flag - don't reset it immediately\n    setHasLocalChanges(true);\n    // Then auto-save to database with a small delay\n    setTimeout(() => {\n      updateProjectMutation.mutate({});\n    }, 500); // 500ms delay to allow for rapid typing\n  }, [updateNodeData, updateProjectMutation]);\n\n  const handleNodeMove = useCallback((nodeId: string, position: { x: number; y: number }) => {\n    updateNode(nodeId, { position });\n  }, [updateNode]);\n\n  const handleComponentDrag = useCallback((component: ComponentDefinition) => {\n    // Handle component drag start if needed\n  }, []);\n\n  const handleComponentAdd = useCallback((component: ComponentDefinition) => {\n    // Prevent adding nodes during template loading\n    if (isLoadingTemplate) {\n      return;\n    }\n    \n    // Set local changes flag first to prevent useEffect from running\n    setHasLocalChanges(true);\n    \n    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —É–∑–µ–ª –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞\n    const newNode: Node = {\n      id: nanoid(),\n      type: component.type,\n      position: { x: 200 + Math.random() * 100, y: 200 + Math.random() * 100 }, // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —Å –Ω–µ–±–æ–ª—å—à–∏–º —Å–º–µ—â–µ–Ω–∏–µ–º\n      data: component.defaultData || {}\n    };\n    \n    // –î–æ–±–∞–≤–ª—è–µ–º —É–∑–µ–ª –Ω–∞ —Ö–æ–ª—Å—Ç\n    addNode(newNode);\n    \n    \n    // Auto-save after a short delay to persist the new node\n    setTimeout(() => {\n      updateProjectMutation.mutate({});\n    }, 1000);\n  }, [addNode, isLoadingTemplate, updateProjectMutation]);\n\n  const handleSaveAsTemplate = useCallback(() => {\n    setShowSaveTemplate(true);\n  }, []);\n\n  const handleLoadTemplate = useCallback(() => {\n    console.log('Template button clicked, navigating to templates page...');\n    setLocation('/templates');\n  }, [setLocation]);\n\n  const handleGoToProjects = useCallback(() => {\n    setLocation('/projects');\n  }, [setLocation]);\n\n  const handleProjectSelect = useCallback((newProjectId: number) => {\n    setLocation(`/editor/${newProjectId}`);\n  }, [setLocation]);\n\n  const handleSelectTemplate = useCallback((template: any) => {\n    // –ü—Ä–∏–º–µ–Ω—è–µ–º —à–∞–±–ª–æ–Ω –∫ —Ç–µ–∫—É—â–µ–º—É –ø—Ä–æ–µ–∫—Ç—É\n    try {\n      setIsLoadingTemplate(true); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞\n      console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —à–∞–±–ª–æ–Ω–∞:', template.name);\n      console.log('–î–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞:', template.data);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —à–∞–±–ª–æ–Ω–µ –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞\n      if (template.data.sheets && Array.isArray(template.data.sheets)) {\n        console.log('–ü—Ä–∏–º–µ–Ω—è–µ–º –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω —Å –ª–∏—Å—Ç–∞–º–∏:', template.data.sheets.length);\n        \n        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ ID –¥–ª—è –ª–∏—Å—Ç–æ–≤ —à–∞–±–ª–æ–Ω–∞\n        const updatedSheets = template.data.sheets.map((sheet: any) => {\n          // –û—á–∏—â–∞–µ–º —É–∑–ª—ã –æ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫\n          const cleanNodes = sheet.nodes?.map((node: any) => {\n            const cleanNode = {\n              id: node.id,\n              type: node.type,\n              position: node.position || { x: 0, y: 0 },\n              data: {\n                ...node.data,\n                // –£–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏\n                parent: undefined,\n                children: undefined\n              }\n            };\n            return cleanNode;\n          }) || [];\n\n          // –û—á–∏—â–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n          const cleanConnections = sheet.connections?.map((conn: any) => ({\n            id: conn.id,\n            source: conn.source,\n            target: conn.target,\n            sourceHandle: conn.sourceHandle,\n            targetHandle: conn.targetHandle\n          })) || [];\n\n          return {\n            id: nanoid(), // –ù–æ–≤—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –ª–∏—Å—Ç–∞\n            name: sheet.name,\n            nodes: cleanNodes,\n            connections: cleanConnections,\n            viewState: sheet.viewState || { position: { x: 0, y: 0 }, zoom: 1 },\n            createdAt: new Date(),\n            updatedAt: new Date()\n          };\n        });\n        \n        const templateDataWithSheets = {\n          sheets: updatedSheets,\n          activeSheetId: updatedSheets[0]?.id,\n          version: 2,\n          interSheetConnections: template.data.interSheetConnections || []\n        };\n        \n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n        setBotDataWithSheets(templateDataWithSheets);\n        \n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π –Ω–∞ —Ö–æ–ª—Å—Ç–µ\n        const firstSheet = updatedSheets[0];\n        if (firstSheet) {\n          // –ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞ layout –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\n          setBotData({ nodes: firstSheet.nodes, connections: firstSheet.connections }, template.name, currentNodeSizes, false);\n          console.log('–ü—Ä–∏–º–µ–Ω–∏–ª–∏ –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç, —É–∑–ª–æ–≤:', firstSheet.nodes.length);\n          console.log('–ü—Ä–∏–º–µ–Ω–∏–ª–∏ –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç, —Å–≤—è–∑–µ–π:', firstSheet.connections.length);\n        }\n        \n        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø—Ä–æ–µ–∫—Ç\n        updateProjectMutation.mutate({\n          data: templateDataWithSheets\n        });\n      } else {\n        // –û–±—ã—á–Ω—ã–π —à–∞–±–ª–æ–Ω –±–µ–∑ –ª–∏—Å—Ç–æ–≤\n        console.log('–ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—ã—á–Ω—ã–π —à–∞–±–ª–æ–Ω');\n        const templateData = template.data;\n        \n        if (!templateData || !templateData.nodes) {\n          throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞');\n        }\n        \n        // –ú–∏–≥—Ä–∏—Ä—É–µ–º –∫ —Ñ–æ—Ä–º–∞—Ç—É —Å –ª–∏—Å—Ç–∞–º–∏\n        const migratedData = SheetsManager.migrateLegacyData(templateData);\n        setBotDataWithSheets(migratedData);\n        // –ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞ layout –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\n        setBotData(templateData, template.name, currentNodeSizes, false);\n        \n        console.log('–ü—Ä–∏–º–µ–Ω–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞, —É–∑–ª–æ–≤:', templateData.nodes.length);\n        console.log('–ü—Ä–∏–º–µ–Ω–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞, —Å–≤—è–∑–µ–π:', templateData.connections?.length || 0);\n        \n        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\n        console.log('–°–æ—Ö—Ä–∞–Ω—è–µ–º —à–∞–±–ª–æ–Ω –≤ –ë–î, —É–∑–ª–æ–≤:', migratedData.sheets?.[0]?.nodes?.length || templateData.nodes?.length);\n        updateProjectMutation.mutate({\n          data: migratedData\n        });\n      }\n      \n      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–∞–Ω–µ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤  \n      console.log('–®–∞–±–ª–æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à –ø—Ä–æ–µ–∫—Ç–æ–≤');\n      // –î–∞–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º—É—Ç–∞—Ü–∏–∏, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à\n      setTimeout(() => {\n        queryClient.invalidateQueries({ queryKey: ['/api/projects'] });\n      }, 500);\n      \n      toast({\n        title: '–®–∞–±–ª–æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω',\n        description: `–®–∞–±–ª–æ–Ω \"${template.name}\" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`,\n      });\n      \n      // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –¥–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∑–∞—Ç–µ–º —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥\n      setTimeout(() => {\n        setIsLoadingTemplate(false);\n      }, 1000);\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞:', error);\n      toast({\n        title: '–û—à–∏–±–∫–∞',\n        description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω',\n        variant: 'destructive',\n      });\n      setIsLoadingTemplate(false); // –£–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –æ—à–∏–±–∫–µ\n    }\n  }, [setBotData, setBotDataWithSheets, updateProjectMutation, toast, queryClient]);\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏\n  const handleConnectionsChange = useCallback((newConnections: Connection[]) => {\n    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤—è–∑–∏ —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º\n    const currentData = getBotData();\n    updateProjectMutation.mutate({\n      data: {\n        ...currentData,\n        connections: newConnections\n      }\n    });\n  }, [getBotData, updateProjectMutation]);\n\n  const handleConnectionSelect = useCallback((connection: Connection | null) => {\n    setSelectedConnection(connection);\n    setSelectedConnectionId(connection?.id || null);\n  }, []);\n\n  const handleConnectionEdit = useCallback((connection: Connection) => {\n    setSelectedConnection(connection);\n    setSelectedConnectionId(connection.id);\n    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n  }, []);\n\n  const handleConnectionDelete = useCallback((connectionId: string) => {\n    deleteConnection(connectionId);\n    if (selectedConnectionId === connectionId) {\n      setSelectedConnectionId(null);\n      setSelectedConnection(null);\n    }\n  }, [deleteConnection, selectedConnectionId]);\n\n\n\n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–Ω–µ–ª–∏ —Å–≤–æ–π—Å—Ç–≤ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n  const propertiesContent = currentProject ? (\n    <PropertiesPanel\n      projectId={currentProject.id}\n      selectedNode={selectedNode}\n      allNodes={nodes}\n      allSheets={botDataWithSheets?.sheets || []}\n      currentSheetId={botDataWithSheets?.activeSheetId || undefined}\n      onNodeUpdate={handleNodeUpdateWithSheets}\n      onNodeTypeChange={handleNodeTypeChange}\n      onButtonAdd={addButton}\n      onButtonUpdate={updateButton}\n      onButtonDelete={deleteButton}\n    />\n  ) : null;\n\n  if (!currentProject) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4\">\n            <i className=\"fas fa-spinner fa-spin text-gray-400 text-xl\"></i>\n          </div>\n          <p className=\"text-gray-600\">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–ª—è –≥–∏–±–∫–æ–≥–æ –º–∞–∫–µ—Ç–∞\n  const renderFlexibleLayoutContent = () => {\n    const headerContent = (\n      <AdaptiveHeader\n        config={layoutConfig}\n        projectName={currentProject.name}\n        currentTab={currentTab}\n        onTabChange={handleTabChange}\n        onExport={() => setShowExport(true)}\n        onSaveAsTemplate={handleSaveAsTemplate}\n        onLoadTemplate={handleLoadTemplate}\n        onLayoutSettings={() => setShowLayoutManager(true)}\n        onToggleHeader={handleToggleHeader}\n        onToggleSidebar={handleToggleSidebar}\n        onToggleProperties={handleToggleProperties}\n        onToggleCanvas={handleToggleCanvas}\n        headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n        sidebarVisible={flexibleLayoutConfig.elements.find(el => el.id === 'sidebar')?.visible ?? true}\n        propertiesVisible={flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true}\n        onOpenMobileSidebar={() => setShowMobileSidebar(true)}\n        onOpenMobileProperties={() => setShowMobileProperties(true)}\n        canvasVisible={flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible ?? true}\n      />\n    );\n\n    const canvasContent = (\n      <div className=\"h-full\">\n        {currentTab === 'groups' ? (\n          <GroupsPanel\n            projectId={currentProject.id}\n            projectName={currentProject.name}\n          />\n        ) : currentTab === 'editor' ? (\n          <Canvas\n            // –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∏—Å—Ç–æ–≤\n            botData={botDataWithSheets || undefined}\n            onBotDataUpdate={handleBotDataUpdate}\n            // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–ø—Å—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n            nodes={nodes}\n            connections={connections}\n            selectedNodeId={selectedNodeId}\n            selectedConnectionId={selectedConnectionId ?? undefined}\n            onNodeSelect={setSelectedNodeId}\n            onNodeAdd={addNode}\n            onNodeDelete={deleteNode}\n            onNodeDuplicate={duplicateNode}\n            onNodeMove={handleNodeMove}\n            onConnectionSelect={setSelectedConnectionId}\n            onConnectionDelete={deleteConnection}\n            onConnectionAdd={addConnection}\n            onNodesUpdate={updateNodes}\n            onUndo={undo}\n            onRedo={redo}\n            canUndo={canUndo}\n            canRedo={canRedo}\n            onSave={() => updateProjectMutation.mutate({})}\n            isSaving={updateProjectMutation.isPending}\n            onCopyToClipboard={copyToClipboard}\n            onPasteFromClipboard={pasteFromClipboard}\n            hasClipboardData={hasClipboardData()}\n            isNodeBeingDragged={isNodeBeingDragged}\n            setIsNodeBeingDragged={setIsNodeBeingDragged}\n            onToggleHeader={handleToggleHeader}\n            onToggleSidebar={handleToggleSidebar}\n            onToggleProperties={handleToggleProperties}\n            onToggleCanvas={handleToggleCanvas}\n            headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n            sidebarVisible={flexibleLayoutConfig.elements.find(el => el.id === 'sidebar')?.visible ?? true}\n            propertiesVisible={flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true}\n            canvasVisible={flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible ?? true}\n            onOpenMobileSidebar={handleOpenMobileSidebar}\n            onOpenMobileProperties={handleOpenMobileProperties}\n            onNodeSizesChange={handleNodeSizesChange}\n          />\n        ) : currentTab === 'bot' ? (\n          <div className=\"h-full p-6 bg-background overflow-auto\">\n            <div className=\"max-w-2xl mx-auto\">\n              <BotControl\n                projectId={currentProject.id}\n                projectName={currentProject.name}\n              />\n            </div>\n          </div>\n        ) : currentTab === 'users' ? (\n          <div className=\"h-full\">\n            <UserDatabasePanel\n              projectId={currentProject.id}\n              projectName={currentProject.name}\n            />\n          </div>\n        ) : null}\n      </div>\n    );\n\n    const sidebarContent = (\n      <ComponentsSidebar \n        onComponentDrag={handleComponentDrag}\n        onComponentAdd={handleComponentAdd}\n        onLoadTemplate={handleLoadTemplate}\n        onOpenLayoutCustomizer={() => setShowLayoutCustomizer(true)}\n        onLayoutChange={updateLayoutConfig}\n        onGoToProjects={handleGoToProjects}\n        onProjectSelect={handleProjectSelect}\n        currentProjectId={currentProject?.id}\n        headerContent={headerContent}\n        sidebarContent={<div>Sidebar</div>}\n        canvasContent={canvasContent}\n        propertiesContent={propertiesContent}\n        onToggleCanvas={handleToggleCanvas}\n        onToggleHeader={handleToggleHeader}\n        onToggleProperties={handleToggleProperties}\n        onShowFullLayout={() => {\n          setFlexibleLayoutConfig(prev => ({\n            ...prev,\n            elements: prev.elements.map(element => ({ ...element, visible: true }))\n          }))\n        }}\n        canvasVisible={flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible ?? true}\n        headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n        propertiesVisible={flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true}\n        showLayoutButtons={!flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible && !flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible}\n        onSheetAdd={handleSheetAdd}\n        onSheetDelete={handleSheetDelete}\n        onSheetRename={handleSheetRename}\n        onSheetDuplicate={handleSheetDuplicate}\n        onSheetSelect={handleSheetSelect}\n        isMobile={isMobile}\n      />\n    );\n\n    if (useFlexibleLayout) {\n      return (\n        <SimpleLayoutCustomizer\n          config={flexibleLayoutConfig}\n          onConfigChange={setFlexibleLayoutConfig}\n        >\n          <FlexibleLayout\n            config={flexibleLayoutConfig}\n            headerContent={headerContent}\n            sidebarContent={sidebarContent}\n            canvasContent={canvasContent}\n            propertiesContent={propertiesContent}\n            onConfigChange={setFlexibleLayoutConfig}\n            hideOnMobile={isMobile}\n            currentTab={currentTab}\n          />\n        </SimpleLayoutCustomizer>\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <>\n      {useFlexibleLayout ? (\n        renderFlexibleLayoutContent()\n      ) : (\n        <AdaptiveLayout\n          config={layoutConfig}\n          header={\n            <AdaptiveHeader\n              config={layoutConfig}\n              projectName={currentProject.name}\n              currentTab={currentTab}\n              onTabChange={handleTabChange}\n              onExport={() => setShowExport(true)}\n              onSaveAsTemplate={handleSaveAsTemplate}\n              onLoadTemplate={handleLoadTemplate}\n              onLayoutSettings={() => setShowLayoutManager(true)}\n              onToggleHeader={handleToggleHeader}\n              onToggleSidebar={handleToggleSidebar}\n              onToggleProperties={handleToggleProperties}\n              onToggleCanvas={handleToggleCanvas}\n              headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n              sidebarVisible={flexibleLayoutConfig.elements.find(el => el.id === 'sidebar')?.visible ?? true}\n              propertiesVisible={flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true}\n              onOpenMobileSidebar={() => setShowMobileSidebar(true)}\n              onOpenMobileProperties={() => setShowMobileProperties(true)}\n              canvasVisible={flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible ?? true}\n            />\n          }\n          sidebar={\n            <ComponentsSidebar \n              onComponentDrag={handleComponentDrag}\n              onComponentAdd={handleComponentAdd}\n              onLoadTemplate={handleLoadTemplate}\n              onOpenLayoutCustomizer={() => setShowLayoutCustomizer(true)}\n              onLayoutChange={updateLayoutConfig}\n              onGoToProjects={handleGoToProjects}\n              onProjectSelect={handleProjectSelect}\n              currentProjectId={currentProject?.id}\n              onToggleCanvas={handleToggleCanvas}\n              onToggleHeader={handleToggleHeader}\n              onToggleProperties={handleToggleProperties}\n              onShowFullLayout={() => {\n                setFlexibleLayoutConfig(prev => ({\n                  ...prev,\n                  elements: prev.elements.map(element => ({ ...element, visible: true }))\n                }))\n              }}\n              canvasVisible={flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible ?? true}\n              headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n              propertiesVisible={flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true}\n              showLayoutButtons={!flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible && !flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible}\n              onSheetAdd={handleSheetAdd}\n              onSheetDelete={handleSheetDelete}\n              onSheetRename={handleSheetRename}\n              onSheetDuplicate={handleSheetDuplicate}\n              onSheetSelect={handleSheetSelect}\n              isMobile={isMobile}\n            />\n          }\n          canvas={\n            <div className=\"h-full\">\n              {currentTab === 'editor' ? (\n                <Canvas\n                  botData={botDataWithSheets || undefined}\n                  onBotDataUpdate={handleBotDataUpdate}\n                  nodes={nodes}\n                  connections={connections}\n                  selectedNodeId={selectedNodeId}\n                  selectedConnectionId={selectedConnectionId || undefined}\n                  onNodeSelect={setSelectedNodeId}\n                  onNodeAdd={addNode}\n                  onNodeDelete={deleteNode}\n                  onNodeDuplicate={duplicateNode}\n                  onNodeMove={handleNodeMove}\n                  onConnectionSelect={setSelectedConnectionId}\n                  onConnectionDelete={deleteConnection}\n                  onConnectionAdd={addConnection}\n                  onNodesUpdate={updateNodes}\n                  onUndo={undo}\n                  onRedo={redo}\n                  canUndo={canUndo}\n                  canRedo={canRedo}\n                  onSave={() => updateProjectMutation.mutate({})}\n                  isSaving={updateProjectMutation.isPending}\n                  onCopyToClipboard={copyToClipboard}\n                  onPasteFromClipboard={pasteFromClipboard}\n                  hasClipboardData={hasClipboardData()}\n                  onToggleHeader={handleToggleHeader}\n                  onToggleSidebar={handleToggleSidebar}\n                  onToggleProperties={handleToggleProperties}\n                  onToggleCanvas={handleToggleCanvas}\n                  headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n                  sidebarVisible={flexibleLayoutConfig.elements.find(el => el.id === 'sidebar')?.visible ?? true}\n                  propertiesVisible={flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true}\n                  canvasVisible={flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible ?? true}\n                  onOpenMobileSidebar={handleOpenMobileSidebar}\n                />\n              ) : currentTab === 'bot' ? (\n                <div className=\"h-full p-6 bg-background overflow-auto\">\n                  <div className=\"max-w-2xl mx-auto\">\n                    <BotControl\n                      projectId={currentProject.id}\n                      projectName={currentProject.name}\n                    />\n                  </div>\n                </div>\n              ) : currentTab === 'users' ? (\n                <div className=\"h-full\">\n                  <UserDatabasePanel\n                    projectId={currentProject.id}\n                    projectName={currentProject.name}\n                  />\n                </div>\n              ) : currentTab === 'groups' ? (\n                <div className=\"h-full\">\n                  <GroupsPanel\n                    projectId={currentProject.id}\n                    projectName={currentProject.name}\n                  />\n                </div>\n              ) : null}\n            </div>\n          }\n          properties={\n            <PropertiesPanel\n              projectId={currentProject.id}\n              selectedNode={selectedNode}\n              allNodes={nodes}\n              allSheets={botDataWithSheets?.sheets || []}\n              currentSheetId={botDataWithSheets?.activeSheetId || undefined}\n              onNodeUpdate={handleNodeUpdateWithSheets}\n              onButtonAdd={addButton}\n              onButtonUpdate={updateButton}\n              onButtonDelete={deleteButton}\n            />\n          }\n        />\n      )}\n\n      {showLayoutManager && (\n        <LayoutManager\n          config={layoutConfig}\n          onConfigChange={updateLayoutConfig}\n          onApply={applyLayoutConfig}\n          onReset={resetLayoutConfig}\n        />\n      )}\n\n      {showLayoutCustomizer && (\n        <LayoutCustomizer\n          headerContent={\n            <AdaptiveHeader\n              config={layoutConfig}\n              projectName={currentProject.name}\n              currentTab={currentTab}\n              onTabChange={handleTabChange}\n              onExport={() => setShowExport(true)}\n              onSaveAsTemplate={handleSaveAsTemplate}\n              onLoadTemplate={handleLoadTemplate}\n              onLayoutSettings={() => setShowLayoutManager(true)}\n              onOpenMobileSidebar={() => setShowMobileSidebar(true)}\n              onOpenMobileProperties={() => setShowMobileProperties(true)}\n            />\n          }\n          sidebarContent={\n            <ComponentsSidebar \n              onComponentDrag={handleComponentDrag}\n              onComponentAdd={handleComponentAdd}\n              onLoadTemplate={handleLoadTemplate}\n              onOpenLayoutCustomizer={() => setShowLayoutCustomizer(true)}\n              onLayoutChange={updateLayoutConfig}\n              headerContent={\n                <AdaptiveHeader\n                  config={layoutConfig}\n                  projectName={currentProject.name}\n                  currentTab={currentTab}\n                  onTabChange={handleTabChange}\n                  onExport={() => setShowExport(true)}\n                  onSaveAsTemplate={handleSaveAsTemplate}\n                  onLoadTemplate={handleLoadTemplate}\n                  onLayoutSettings={() => setShowLayoutManager(true)}\n                  onOpenMobileSidebar={() => setShowMobileSidebar(true)}\n                  onOpenMobileProperties={() => setShowMobileProperties(true)}\n                />\n              }\n              sidebarContent={<div>Sidebar</div>}\n              canvasContent={\n                <div className=\"h-full\">\n                  {currentTab === 'editor' ? (\n                    <Canvas\n                      // –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∏—Å—Ç–æ–≤\n                      botData={botDataWithSheets || undefined}\n                      onBotDataUpdate={handleBotDataUpdate}\n                      // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–ø—Å—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n                      nodes={nodes}\n                      connections={connections}\n                      selectedNodeId={selectedNodeId}\n                      selectedConnectionId={selectedConnectionId || undefined}\n                      onNodeSelect={setSelectedNodeId}\n                      onNodeAdd={addNode}\n                      onNodeDelete={deleteNode}\n                      onNodeDuplicate={duplicateNode}\n                      onNodeMove={handleNodeMove}\n                      onConnectionSelect={setSelectedConnectionId}\n                      onConnectionDelete={deleteConnection}\n                      onConnectionAdd={addConnection}\n                      onNodesUpdate={updateNodes}\n                      onUndo={undo}\n                      onRedo={redo}\n                      canUndo={canUndo}\n                      canRedo={canRedo}\n                      onSave={() => updateProjectMutation.mutate({})}\n                      isSaving={updateProjectMutation.isPending}\n                      onCopyToClipboard={copyToClipboard}\n                      onPasteFromClipboard={pasteFromClipboard}\n                      hasClipboardData={hasClipboardData()}\n                      onToggleHeader={handleToggleHeader}\n                      onToggleSidebar={handleToggleSidebar}\n                      onToggleProperties={handleToggleProperties}\n                      headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n                      sidebarVisible={flexibleLayoutConfig.elements.find(el => el.id === 'sidebar')?.visible ?? true}\n                      propertiesVisible={flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true}\n                    />\n                  ) : null}\n                </div>\n              }\n              propertiesContent={\n                <PropertiesPanel\n                  projectId={currentProject.id}\n                  selectedNode={selectedNode}\n                  allNodes={nodes}\n                  allSheets={botDataWithSheets?.sheets || []}\n                  currentSheetId={botDataWithSheets?.activeSheetId || undefined}\n                  onNodeUpdate={handleNodeUpdateWithSheets}\n                  onButtonAdd={addButton}\n                  onButtonUpdate={updateButton}\n                  onButtonDelete={deleteButton}\n                />\n              }\n              onSheetAdd={handleSheetAdd}\n              onSheetDelete={handleSheetDelete}\n              onSheetRename={handleSheetRename}\n              onSheetDuplicate={handleSheetDuplicate}\n              onSheetSelect={handleSheetSelect}\n              isMobile={isMobile}\n            />\n          }\n          canvasContent={\n            <div className=\"h-full\">\n              {currentTab === 'editor' ? (\n                <Canvas\n                  botData={botDataWithSheets || undefined}\n                  onBotDataUpdate={handleBotDataUpdate}\n                  nodes={nodes}\n                  connections={connections}\n                  selectedNodeId={selectedNodeId}\n                  selectedConnectionId={selectedConnectionId || undefined}\n                  onNodeSelect={setSelectedNodeId}\n                  onNodeAdd={addNode}\n                  onNodeDelete={deleteNode}\n                  onNodeDuplicate={duplicateNode}\n                  onNodeMove={handleNodeMove}\n                  onConnectionSelect={setSelectedConnectionId}\n                  onConnectionDelete={deleteConnection}\n                  onConnectionAdd={addConnection}\n                  onNodesUpdate={updateNodes}\n                  onUndo={undo}\n                  onRedo={redo}\n                  canUndo={canUndo}\n                  canRedo={canRedo}\n                  onSave={() => updateProjectMutation.mutate({})}\n                  isSaving={updateProjectMutation.isPending}\n                  isNodeBeingDragged={isNodeBeingDragged}\n                  setIsNodeBeingDragged={setIsNodeBeingDragged}\n                  onToggleHeader={handleToggleHeader}\n                  onToggleSidebar={handleToggleSidebar}\n                  onToggleProperties={handleToggleProperties}\n                  headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n                  sidebarVisible={(() => { \n                    const calculated = !isMobile && (flexibleLayoutConfig.elements.find(el => el.id === 'sidebar')?.visible ?? true);\n                    console.log('üîß SIDEBAR VISIBLE CALC:', { isMobile, flexSidebarVisible: flexibleLayoutConfig.elements.find(el => el.id === 'sidebar')?.visible, calculated });\n                    return calculated;\n                  })()}\n                  propertiesVisible={(() => { \n                    const calculated = !isMobile && (flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true);\n                    console.log('üîß PROPERTIES VISIBLE CALC:', { isMobile, flexPropertiesVisible: flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible, calculated });\n                    return calculated;\n                  })()}\n                  onOpenMobileSidebar={handleOpenMobileSidebar}\n                  onOpenMobileProperties={handleOpenMobileProperties}\n                />\n              ) : null}\n            </div>\n          }\n          propertiesContent={\n            <PropertiesPanel\n              projectId={currentProject.id}\n              selectedNode={selectedNode}\n              allNodes={nodes}\n              allSheets={botDataWithSheets?.sheets || []}\n              currentSheetId={botDataWithSheets?.activeSheetId || undefined}\n              onNodeUpdate={handleNodeUpdateWithSheets}\n              onButtonAdd={addButton}\n              onButtonUpdate={updateButton}\n              onButtonDelete={deleteButton}\n            />\n          }\n          onLayoutChange={(elements) => {\n            // Layout changed\n            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–∞–∫–µ—Ç–∞\n          }}\n        />\n      )}\n\n      <PreviewModal\n        isOpen={showPreview}\n        onClose={() => {\n          setShowPreview(false);\n          setCurrentTab('editor');\n        }}\n        nodes={nodes}\n        connections={connections}\n        projectName={currentProject.name}\n      />\n\n      <ExportModal\n        isOpen={showExport}\n        onClose={() => {\n          setShowExport(false);\n          setCurrentTab('editor');\n        }}\n        botData={(botDataWithSheets || getBotData()) as any}\n        projectName={currentProject.name}\n      />\n\n      <SaveTemplateModal\n        isOpen={showSaveTemplate}\n        onClose={() => setShowSaveTemplate(false)}\n        botData={(botDataWithSheets || getBotData()) as any}\n        projectName={currentProject.name}\n      />\n\n\n      {/* –ú–æ–±–∏–ª—å–Ω—ã–π sidebar */}\n      <Sheet open={showMobileSidebar} onOpenChange={setShowMobileSidebar}>\n        <SheetContent side=\"left\" className=\"p-0 w-80\">\n          <SheetHeader className=\"px-4 py-3 border-b\">\n            <SheetTitle>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</SheetTitle>\n          </SheetHeader>\n          <div className=\"h-full overflow-auto\">\n            <ComponentsSidebar \n              onComponentDrag={handleComponentDrag}\n              onComponentAdd={handleComponentAdd}\n              onLoadTemplate={handleLoadTemplate}\n              onOpenLayoutCustomizer={() => setShowLayoutCustomizer(true)}\n              onLayoutChange={updateLayoutConfig}\n              onGoToProjects={handleGoToProjects}\n              onProjectSelect={handleProjectSelect}\n              currentProjectId={currentProject?.id}\n              onToggleCanvas={handleToggleCanvas}\n              onToggleHeader={handleToggleHeader}\n              onToggleProperties={handleToggleProperties}\n              onShowFullLayout={() => {\n                setFlexibleLayoutConfig(prev => ({\n                  ...prev,\n                  elements: prev.elements.map(element => ({ ...element, visible: true }))\n                }))\n              }}\n              canvasVisible={flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible ?? true}\n              headerVisible={flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible ?? true}\n              propertiesVisible={flexibleLayoutConfig.elements.find(el => el.id === 'properties')?.visible ?? true}\n              showLayoutButtons={!flexibleLayoutConfig.elements.find(el => el.id === 'canvas')?.visible && !flexibleLayoutConfig.elements.find(el => el.id === 'header')?.visible}\n              onSheetAdd={handleSheetAdd}\n              onSheetDelete={handleSheetDelete}\n              onSheetRename={handleSheetRename}\n              onSheetDuplicate={handleSheetDuplicate}\n              onSheetSelect={handleSheetSelect}\n              isMobile={isMobile}\n            />\n          </div>\n        </SheetContent>\n      </Sheet>\n\n      {/* –ú–æ–±–∏–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤ */}\n      <Sheet open={showMobileProperties} onOpenChange={setShowMobileProperties}>\n        <SheetContent side=\"right\" className=\"p-0 w-80\">\n          <SheetHeader className=\"px-4 py-3 border-b\">\n            <SheetTitle>–°–≤–æ–π—Å—Ç–≤–∞</SheetTitle>\n          </SheetHeader>\n          <div className=\"h-full overflow-auto\">\n            {propertiesContent}\n          </div>\n        </SheetContent>\n      </Sheet>\n\n    </>\n  );\n}\n","size_bytes":66804},"client/src/pages/home.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Link, useLocation } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Plus, Bot, Edit, Trash2, Calendar, User, Download } from 'lucide-react';\nimport { ThemeToggle } from '@/components/theme-toggle';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport type { BotProject } from '@shared/schema';\nimport { SheetsManager } from '@/utils/sheets-manager';\n\nconst createProjectSchema = z.object({\n  name: z.string().min(1, '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ'),\n  description: z.string().optional(),\n});\n\ntype CreateProjectForm = z.infer<typeof createProjectSchema>;\n\nexport default function Home() {\n  const [, setLocation] = useLocation();\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const form = useForm<CreateProjectForm>({\n    resolver: zodResolver(createProjectSchema),\n    defaultValues: {\n      name: '',\n      description: '',\n    },\n  });\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤\n  const { data: projects = [], isLoading } = useQuery({\n    queryKey: ['/api/projects'],\n  });\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞\n  const createProjectMutation = useMutation({\n    mutationFn: (data: CreateProjectForm) => apiRequest('POST', '/api/projects', {\n      ...data,\n      data: {\n        nodes: [{\n          id: 'start',\n          type: 'start',\n          position: { x: 100, y: 100 },\n          data: {\n            messageText: '–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –Ω–æ–≤—ã–π –±–æ—Ç.',\n            keyboardType: 'none',\n            buttons: [],\n          }\n        }],\n        connections: []\n      }\n    }),\n    onSuccess: (newProject: BotProject) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/projects'] });\n      toast({\n        title: \"–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω\",\n        description: `–ü—Ä–æ–µ–∫—Ç \"${newProject.name}\" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,\n      });\n      setIsCreateDialogOpen(false);\n      form.reset();\n      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞\n      setLocation(`/editor/${newProject.id}`);\n    },\n    onError: () => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞\n  const deleteProjectMutation = useMutation({\n    mutationFn: (projectId: number) => apiRequest('DELETE', `/api/projects/${projectId}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/projects'] });\n      toast({\n        title: \"–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª–µ–Ω\",\n        description: \"–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleCreateProject = (data: CreateProjectForm) => {\n    createProjectMutation.mutate(data);\n  };\n\n  const handleDeleteProject = (project: BotProject) => {\n    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç \"${project.name}\"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {\n      deleteProjectMutation.mutate(project.id);\n    }\n  };\n\n  const formatDate = (dateString: string | Date | null) => {\n    if (!dateString) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('ru-RU', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getNodeCount = (project: BotProject) => {\n    if (!project.data || typeof project.data !== 'object') return 0;\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ª–∏—Å—Ç–∞–º–∏ –∏–ª–∏ —Å—Ç–∞—Ä—ã–π\n    if (SheetsManager.isNewFormat(project.data)) {\n      const sheets = (project.data as any).sheets || [];\n      return sheets.reduce((total: number, sheet: any) => total + (sheet.nodes?.length || 0), 0);\n    } else {\n      const data = project.data as { nodes?: any[] };\n      return data.nodes?.length || 0;\n    }\n  };\n\n  const getSheetsInfo = (project: BotProject) => {\n    if (!project.data || typeof project.data !== 'object') return { count: 0, names: [] };\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ª–∏—Å—Ç–∞–º–∏ –∏–ª–∏ —Å—Ç–∞—Ä—ã–π\n    if (SheetsManager.isNewFormat(project.data)) {\n      const sheets = (project.data as any).sheets || [];\n      return {\n        count: sheets.length,\n        names: sheets.map((sheet: any) => sheet.name || '–õ–∏—Å—Ç')\n      };\n    } else {\n      // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç - –æ–¥–∏–Ω –ª–∏—Å—Ç\n      return {\n        count: 1,\n        names: ['–ì–ª–∞–≤–Ω—ã–π –ª–∏—Å—Ç']\n      };\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4\">\n            <i className=\"fas fa-spinner fa-spin text-gray-400 text-xl\"></i>\n          </div>\n          <p className=\"text-gray-600\">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}\n      <header className=\"border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"container flex h-16 items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 bg-primary rounded-lg flex items-center justify-center\">\n              <i className=\"fab fa-telegram-plane text-primary-foreground text-lg\"></i>\n            </div>\n            <div>\n              <h1 className=\"text-lg font-semibold text-foreground\">BotCraft Studio</h1>\n              <p className=\"text-xs text-muted-foreground\">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä Telegram –±–æ—Ç–æ–≤</p>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center space-x-4\">\n            <Link href=\"/templates\">\n              <Button variant=\"outline\" size=\"sm\">\n                <Bot className=\"h-4 w-4 mr-2\" />\n                –®–∞–±–ª–æ–Ω—ã\n              </Button>\n            </Link>\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}\n      <main className=\"container py-8\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h2>\n            <p className=\"text-muted-foreground\">\n              –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ Telegram –±–æ—Ç–∞–º–∏\n            </p>\n          </div>\n          \n          <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(handleCreateProject)} className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"–ú–æ–π –Ω–æ–≤—ã–π –±–æ—Ç\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</FormLabel>\n                        <FormControl>\n                          <Textarea {...field} placeholder=\"–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞\" rows={3} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"flex justify-end space-x-2\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setIsCreateDialogOpen(false)}>\n                      –û—Ç–º–µ–Ω–∞\n                    </Button>\n                    <Button type=\"submit\" disabled={createProjectMutation.isPending}>\n                      {createProjectMutation.isPending ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : '–°–æ–∑–¥–∞—Ç—å'}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        {/* –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ */}\n        {projects.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <Bot className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã\n            </p>\n            <Button onClick={() => setIsCreateDialogOpen(true)}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç\n            </Button>\n          </div>\n        ) : (\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n            {projects.map((project) => (\n              <Card key={project.id} className=\"group hover:shadow-lg transition-shadow\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <CardTitle className=\"text-lg\">{project.name}</CardTitle>\n                      <CardDescription className=\"mt-1\">\n                        {project.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}\n                      </CardDescription>\n                    </div>\n                    <div className=\"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\"\n                        onClick={() => handleDeleteProject(project)}\n                        className=\"h-8 w-8 p-0 text-destructive hover:text-destructive\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"pt-0\">\n                  <div className=\"space-y-3\">\n                    {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center space-x-4 text-sm text-muted-foreground\">\n                        <div className=\"flex items-center\">\n                          <User className=\"h-4 w-4 mr-1\" />\n                          {getNodeCount(project)} —É–∑–ª–æ–≤\n                        </div>\n                        <div className=\"flex items-center\">\n                          <Calendar className=\"h-4 w-4 mr-1\" />\n                          {formatDate(project.updatedAt)}\n                        </div>\n                      </div>\n                      \n                      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏—Å—Ç–∞—Ö */}\n                      {(() => {\n                        const sheetsInfo = getSheetsInfo(project);\n                        return (\n                          <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n                            <div className=\"flex items-center\">\n                              <Bot className=\"h-4 w-4 mr-1\" />\n                              {sheetsInfo.count} {sheetsInfo.count === 1 ? '–ª–∏—Å—Ç' : sheetsInfo.count < 5 ? '–ª–∏—Å—Ç–∞' : '–ª–∏—Å—Ç–æ–≤'}:\n                            </div>\n                            <div className=\"flex flex-wrap gap-1\">\n                              {sheetsInfo.names.slice(0, 3).map((name, index) => (\n                                <Badge key={index} variant=\"secondary\" className=\"text-xs px-2 py-0.5\">\n                                  {name}\n                                </Badge>\n                              ))}\n                              {sheetsInfo.names.length > 3 && (\n                                <Badge variant=\"outline\" className=\"text-xs px-2 py-0.5\">\n                                  +{sheetsInfo.names.length - 3}\n                                </Badge>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      })()}\n                    </div>\n\n\n\n                    {/* –î–µ–π—Å—Ç–≤–∏—è */}\n                    <div className=\"flex space-x-2\">\n                      <Link href={`/editor/${project.id}`} className=\"flex-1\">\n                        <Button className=\"w-full\">\n                          <Edit className=\"h-4 w-4 mr-2\" />\n                          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å\n                        </Button>\n                      </Link>\n                      <Link href={`/editor/${project.id}?tab=export`}>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Download className=\"h-4 w-4\" />\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}","size_bytes":14849},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/templates.tsx":{"content":"import { useState, useMemo } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Loader2, Search, Download, Eye, Calendar, User, Filter, Star, TrendingUp, Crown, Sparkles, Trash2, Heart, Bookmark, Clock, Globe, Shield, ArrowLeft, Layout } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { format } from 'date-fns';\nimport { ru } from 'date-fns/locale';\nimport type { BotTemplate } from '@shared/schema';\nimport type { BotData } from '@/types/bot';\nimport { AdaptiveHeader } from '@/components/layout/adaptive-header';\nimport { SimpleLayoutCustomizer, SimpleLayoutConfig } from '@/components/layout/simple-layout-customizer';\nimport { FlexibleLayout } from '@/components/layout/flexible-layout';\n\ninterface TemplatesPageProps {\n  onSelectTemplate?: (template: BotTemplate) => void;\n}\n\nexport function TemplatesPage({ onSelectTemplate }: TemplatesPageProps) {\n  const [, setLocation] = useLocation();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [selectedTemplate, setSelectedTemplate] = useState<BotTemplate | null>(null);\n  const [showPreview, setShowPreview] = useState(false);\n  const [currentTab, setCurrentTab] = useState('all');\n  const [sortBy, setSortBy] = useState<'popular' | 'rating' | 'recent' | 'name'>('popular');\n  \n  const [flexibleLayoutConfig, setFlexibleLayoutConfig] = useState<SimpleLayoutConfig>({\n    elements: [\n      {\n        id: 'header',\n        type: 'header',\n        name: '–®–∞–ø–∫–∞',\n        position: 'top',\n        size: 64,\n        visible: true\n      },\n      {\n        id: 'sidebar',\n        type: 'sidebar',\n        name: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n        position: 'left',\n        size: 20,\n        visible: true\n      },\n      {\n        id: 'canvas',\n        type: 'canvas',\n        name: '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ',\n        position: 'center',\n        size: 60,\n        visible: true\n      },\n      {\n        id: 'properties',\n        type: 'properties',\n        name: '–§–∏–ª—å—Ç—Ä—ã',\n        position: 'right',\n        size: 20,\n        visible: true\n      }\n    ],\n    compactMode: false,\n    showGrid: false\n  });\n\n  const { toast } = useToast();\n\n  const { data: templates = [], isLoading } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates'],\n  });\n\n  const { data: featuredTemplates = [], isLoading: isLoadingFeatured } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates/featured'],\n    enabled: currentTab === 'featured',\n  });\n\n  const { data: myTemplates = [], isLoading: isLoadingMy } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates/category/custom'],\n    staleTime: 0, // Always refetch when needed\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n  const useTemplateMutation = useMutation({\n    mutationFn: async (templateId: number) => {\n      const response = await fetch(`/api/templates/${templateId}/use`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to increment use count');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —à–∞–±–ª–æ–Ω–∞\n  const rateTemplateMutation = useMutation({\n    mutationFn: async ({ templateId, rating }: { templateId: number; rating: number }) => {\n      const response = await fetch(`/api/templates/${templateId}/rate`, {\n        method: 'POST',\n        body: JSON.stringify({ rating }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) throw new Error('Failed to rate template');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      toast({\n        title: '–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!',\n        description: '–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ –ø–æ–º–æ–∂–µ—Ç –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º',\n      });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞\n  const deleteTemplateMutation = useMutation({\n    mutationFn: async (templateId: number) => {\n      const response = await fetch(`/api/templates/${templateId}`, {\n        method: 'DELETE',\n      });\n      if (!response.ok) throw new Error('Failed to delete template');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/templates/category/custom'] });\n      toast({\n        title: '–®–∞–±–ª–æ–Ω —É–¥–∞–ª–µ–Ω',\n        description: '–®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω –∏–∑ –≤–∞—à–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏',\n      });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –ª–∞–π–∫–∞ —à–∞–±–ª–æ–Ω–∞\n  const likeTemplateMutation = useMutation({\n    mutationFn: async ({ templateId, liked }: { templateId: number; liked: boolean }) => {\n      const response = await fetch(`/api/templates/${templateId}/like`, {\n        method: 'POST',\n        body: JSON.stringify({ liked }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) throw new Error('Failed to like template');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      toast({\n        title: '–û—Ç–ª–∏—á–Ω–æ!',\n        description: '–í–∞—à –≥–æ–ª–æ—Å —É—á—Ç–µ–Ω',\n      });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∑–∞–∫–ª–∞–¥–∫–∏\n  const bookmarkTemplateMutation = useMutation({\n    mutationFn: async ({ templateId, bookmarked }: { templateId: number; bookmarked: boolean }) => {\n      const response = await fetch(`/api/templates/${templateId}/bookmark`, {\n        method: 'POST',\n        body: JSON.stringify({ bookmarked }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) throw new Error('Failed to bookmark template');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      toast({\n        title: '–ì–æ—Ç–æ–≤–æ!',\n        description: '–ó–∞–∫–ª–∞–¥–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞',\n      });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞\n  const downloadTemplateMutation = useMutation({\n    mutationFn: async (templateId: number) => {\n      const response = await fetch(`/api/templates/${templateId}/download`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to increment download count');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n    },\n  });\n\n  const categories = [\n    { value: 'all', label: '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' },\n    { value: 'official', label: '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ' },\n    { value: 'business', label: '–ë–∏–∑–Ω–µ—Å' },\n    { value: 'education', label: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ' },\n    { value: 'entertainment', label: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è' },\n    { value: 'utility', label: '–£—Ç–∏–ª–∏—Ç—ã' },\n    { value: 'health', label: '–ó–¥–æ—Ä–æ–≤—å–µ' },\n    { value: 'finance', label: '–§–∏–Ω–∞–Ω—Å—ã' },\n    { value: 'social', label: '–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ' },\n    { value: 'custom', label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ' },\n  ];\n\n  const getTemplateStats = (data: BotData | any) => {\n    let allNodes: any[] = [];\n    let allConnections: any[] = [];\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω –∏–ª–∏ –æ–±—ã—á–Ω—ã–π\n    if (data.sheets && Array.isArray(data.sheets)) {\n      // –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω - —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–∑–ª—ã –∏ —Å–≤—è–∑–∏ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤\n      data.sheets.forEach((sheet: any) => {\n        if (sheet.nodes) allNodes.push(...sheet.nodes);\n        if (sheet.connections) allConnections.push(...sheet.connections);\n      });\n      // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã–µ —Å–≤—è–∑–∏\n      if (data.interSheetConnections) {\n        allConnections.push(...data.interSheetConnections);\n      }\n    } else {\n      // –û–±—ã—á–Ω—ã–π —à–∞–±–ª–æ–Ω\n      allNodes = data.nodes || [];\n      allConnections = data.connections || [];\n    }\n    \n    const nodes = allNodes.length;\n    const connections = allConnections.length;\n    const commands = allNodes.filter(node => node.type === 'command').length;\n    const buttons = allNodes.reduce((total, node) => {\n      return total + (node.data?.buttons?.length || 0);\n    }, 0);\n\n    return { nodes, connections, commands, buttons };\n  };\n\n  const filteredAndSortedTemplates = useMemo(() => {\n    let currentTemplates = templates;\n    \n    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º\n    if (currentTab === 'featured') {\n      currentTemplates = featuredTemplates;\n    } else if (currentTab === 'popular') {\n      currentTemplates = templates.filter(t => (t.useCount || 0) > 5);\n    } else if (currentTab === 'my') {\n      currentTemplates = myTemplates;\n    }\n\n    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É\n    if (searchTerm) {\n      currentTemplates = currentTemplates.filter(template =>\n        template.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        template.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        template.tags?.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))\n      );\n    }\n\n    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏\n    if (selectedCategory !== 'all') {\n      currentTemplates = currentTemplates.filter(template => template.category === selectedCategory);\n    }\n\n    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞\n    const sorted = [...currentTemplates].sort((a, b) => {\n      switch (sortBy) {\n        case 'popular':\n          return (b.useCount || 0) - (a.useCount || 0);\n        case 'rating':\n          return (b.rating || 0) - (a.rating || 0);\n        case 'recent':\n          return new Date(b.createdAt || 0).getTime() - new Date(a.createdAt || 0).getTime();\n        case 'name':\n          return a.name.localeCompare(b.name, 'ru');\n        default:\n          return 0;\n      }\n    });\n\n    return sorted;\n  }, [templates, featuredTemplates, myTemplates, currentTab, searchTerm, selectedCategory, sortBy]);\n\n  const handleUseTemplate = (template: BotTemplate) => {\n    useTemplateMutation.mutate(template.id);\n    downloadTemplateMutation.mutate(template.id);\n    \n    if (onSelectTemplate) {\n      onSelectTemplate(template);\n    } else {\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –≤ localStorage –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ\n      localStorage.setItem('selectedTemplate', JSON.stringify(template));\n      \n      // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å ID —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ localStorage\n      const lastProjectId = localStorage.getItem('lastProjectId');\n      const referrer = document.referrer;\n      \n      // –ï—Å–ª–∏ –ø—Ä–∏—à–ª–∏ –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è —Ç—É–¥–∞\n      if (referrer && referrer.includes('/editor/') && lastProjectId) {\n        setLocation(`/editor/${lastProjectId}`);\n      } else {\n        // –ò–Ω–∞—á–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É\n        setLocation('/');\n      }\n    }\n    \n    toast({\n      title: '–®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω!',\n      description: `–®–∞–±–ª–æ–Ω \"${template.name}\" –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ –≤–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É`,\n    });\n  };\n\n  const handlePreview = (template: BotTemplate) => {\n    setSelectedTemplate(template);\n    setShowPreview(true);\n  };\n\n  const handleRateTemplate = (template: BotTemplate, rating: number) => {\n    rateTemplateMutation.mutate({ templateId: template.id, rating });\n  };\n\n  const handleDeleteTemplate = (template: BotTemplate) => {\n    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω \"${template.name}\"?`)) {\n      deleteTemplateMutation.mutate(template.id);\n    }\n  };\n\n  const TemplateGrid = ({ \n    templates, \n    isLoading, \n    onPreview, \n    onUse, \n    onRate, \n    onDelete, \n    searchTerm, \n    selectedCategory,\n    showDeleteButton = false \n  }: {\n    templates: BotTemplate[];\n    isLoading: boolean;\n    onPreview: (template: BotTemplate) => void;\n    onUse: (template: BotTemplate) => void;\n    onRate: (template: BotTemplate, rating: number) => void;\n    onDelete?: (template: BotTemplate) => void;\n    searchTerm: string;\n    selectedCategory: string;\n    showDeleteButton?: boolean;\n  }) => {\n    if (isLoading) {\n      return (\n        <div className=\"flex items-center justify-center py-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin\" />\n        </div>\n      );\n    }\n\n    if (templates.length === 0) {\n      return (\n        <div className=\"text-center py-12\">\n          <Sparkles className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n          <h3 className=\"text-lg font-medium mb-2\">\n            {searchTerm || selectedCategory !== 'all' \n              ? '–®–∞–±–ª–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' \n              : '–®–∞–±–ª–æ–Ω—ã –ø–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã'\n            }\n          </h3>\n          <p className=\"text-muted-foreground\">\n            {searchTerm || selectedCategory !== 'all'\n              ? '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞'\n              : '–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —à–∞–±–ª–æ–Ω –±–æ—Ç–∞'\n            }\n          </p>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 py-4\">\n        {templates.map((template: BotTemplate) => {\n          const stats = getTemplateStats(template.data as BotData);\n          \n          return (\n            <Card key={template.id} className=\"hover:shadow-lg dark:hover:shadow-xl transition-all duration-200 border-muted/50 dark:border-muted/20 bg-card/50 dark:bg-card/30 backdrop-blur-sm\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1 min-w-0\">\n                    <CardTitle className=\"text-base leading-tight mb-1 flex items-center gap-2\">\n                      {template.featured === 1 && (\n                        <Crown className=\"h-4 w-4 text-yellow-500 dark:text-yellow-400 flex-shrink-0\" />\n                      )}\n                      <span className=\"truncate\">{template.name}</span>\n                    </CardTitle>\n                    {template.description && (\n                      <CardDescription className=\"text-sm line-clamp-2 leading-relaxed\">\n                        {template.description}\n                      </CardDescription>\n                    )}\n                  </div>\n                  \n                  <div className=\"flex items-center gap-1 ml-2 flex-shrink-0\">\n                    {template.rating && template.rating > 0 && (\n                      <div className=\"flex items-center gap-1 bg-yellow-50 dark:bg-yellow-950/30 px-2 py-1 rounded-full\">\n                        <Star className=\"h-3 w-3 fill-yellow-500 text-yellow-500\" />\n                        <span className=\"text-xs font-medium text-yellow-700 dark:text-yellow-300\">\n                          {template.rating.toFixed(1)}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {/* –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}\n                <div className=\"grid grid-cols-4 gap-2 text-xs\">\n                  <div className=\"text-center p-2 bg-muted dark:bg-muted/30 rounded\">\n                    <div className=\"font-medium\">{stats.nodes}</div>\n                    <div className=\"text-muted-foreground\">—É–∑–ª–æ–≤</div>\n                  </div>\n                  <div className=\"text-center p-2 bg-muted dark:bg-muted/30 rounded\">\n                    <div className=\"font-medium\">{stats.connections}</div>\n                    <div className=\"text-muted-foreground\">—Å–≤—è–∑–µ–π</div>\n                  </div>\n                  <div className=\"text-center p-2 bg-muted dark:bg-muted/30 rounded\">\n                    <div className=\"font-medium\">{stats.commands}</div>\n                    <div className=\"text-muted-foreground\">–∫–æ–º–∞–Ω–¥</div>\n                  </div>\n                  <div className=\"text-center p-2 bg-muted dark:bg-muted/30 rounded\">\n                    <div className=\"font-medium\">{stats.buttons}</div>\n                    <div className=\"text-muted-foreground\">–∫–Ω–æ–ø–æ–∫</div>\n                  </div>\n                </div>\n\n                {/* –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}\n                <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                  <div className=\"flex items-center gap-2 p-2 bg-muted/50 dark:bg-muted/20 rounded\">\n                    <Eye className=\"h-3 w-3 text-muted-foreground\" />\n                    <span className=\"font-medium\">{template.viewCount || 0}</span>\n                    <span className=\"text-muted-foreground\">–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 p-2 bg-muted/50 dark:bg-muted/20 rounded\">\n                    <Download className=\"h-3 w-3 text-muted-foreground\" />\n                    <span className=\"font-medium\">{template.downloadCount || 0}</span>\n                    <span className=\"text-muted-foreground\">—Å–∫–∞—á–∏–≤–∞–Ω–∏–π</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 p-2 bg-muted/50 dark:bg-muted/20 rounded\">\n                    <Heart className=\"h-3 w-3 text-muted-foreground\" />\n                    <span className=\"font-medium\">{template.likeCount || 0}</span>\n                    <span className=\"text-muted-foreground\">–ª–∞–π–∫–æ–≤</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 p-2 bg-muted/50 dark:bg-muted/20 rounded\">\n                    <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                    <span className=\"font-medium\">{template.estimatedTime || 5}</span>\n                    <span className=\"text-muted-foreground\">–º–∏–Ω.</span>\n                  </div>\n                </div>\n\n                {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */}\n                <div className=\"flex items-center gap-2 text-xs\">\n                  {template.requiresToken === 1 && (\n                    <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                      <Shield className=\"h-3 w-3\" />\n                      –¢–æ–∫–µ–Ω\n                    </Badge>\n                  )}\n                  {template.language && template.language !== 'ru' && (\n                    <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                      <Globe className=\"h-3 w-3\" />\n                      {template.language.toUpperCase()}\n                    </Badge>\n                  )}\n                  <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                    <TrendingUp className=\"h-3 w-3\" />\n                    {template.complexity || 1}/10\n                  </Badge>\n                </div>\n                \n                {template.tags && template.tags.length > 0 && (\n                  <div className=\"flex flex-wrap gap-1\">\n                    {template.tags.slice(0, 3).map((tag) => (\n                      <Badge key={tag} variant=\"outline\" className=\"text-xs\">\n                        {tag}\n                      </Badge>\n                    ))}\n                    {template.tags.length > 3 && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        +{template.tags.length - 3}\n                      </Badge>\n                    )}\n                  </div>\n                )}\n                \n                <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                  <div className=\"flex items-center gap-1\">\n                    <Calendar className=\"h-3 w-3\" />\n                    {template.createdAt && format(new Date(template.createdAt), 'dd.MM.yyyy', { locale: ru })}\n                  </div>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {categories.find(c => c.value === template.category)?.label || template.category}\n                  </Badge>\n                </div>\n                \n                <div className=\"flex gap-2\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => onPreview(template)}\n                    className=\"flex-1\"\n                  >\n                    <Eye className=\"h-4 w-4 mr-1\" />\n                    –ü—Ä–æ—Å–º–æ—Ç—Ä\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    onClick={() => onUse(template)}\n                    className=\"flex-1\"\n                  >\n                    <Download className=\"h-4 w-4 mr-1\" />\n                    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å\n                  </Button>\n                  {showDeleteButton && onDelete && template.category === 'custom' && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"destructive\"\n                      onClick={() => onDelete(template)}\n                      className=\"px-2\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n\n                {/* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n                <div className=\"flex items-center justify-between pt-2 border-t\">\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => likeTemplateMutation.mutate({ \n                        templateId: template.id, \n                        liked: true \n                      })}\n                      className=\"h-7 px-2\"\n                    >\n                      <Heart className=\"h-3 w-3 mr-1\" />\n                      <span className=\"text-xs\">{template.likeCount || 0}</span>\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => bookmarkTemplateMutation.mutate({ \n                        templateId: template.id, \n                        bookmarked: true \n                      })}\n                      className=\"h-7 px-2\"\n                    >\n                      <Bookmark className=\"h-3 w-3 mr-1\" />\n                      <span className=\"text-xs\">{template.bookmarkCount || 0}</span>\n                    </Button>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-1\">\n                    <span className=\"text-xs text-muted-foreground mr-1\">–û—Ü–µ–Ω–∏—Ç—å:</span>\n                    {[1, 2, 3, 4, 5].map((rating) => (\n                      <button\n                        key={rating}\n                        onClick={() => onRate(template, rating)}\n                        className=\"text-muted-foreground hover:text-yellow-500 transition-colors\"\n                      >\n                        <Star className=\"h-3 w-3\" />\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    );\n  };\n\n  const TemplatePreview = ({ template }: { template: BotTemplate }) => {\n    const stats = getTemplateStats(template.data as BotData);\n    \n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold\">{template.name}</h3>\n          <Button size=\"sm\" onClick={() => setShowPreview(false)}>\n            –ó–∞–∫—Ä—ã—Ç—å\n          </Button>\n        </div>\n        \n        {template.description && (\n          <p className=\"text-muted-foreground\">{template.description}</p>\n        )}\n        \n        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n          <div className=\"p-3 bg-muted dark:bg-muted/50 rounded-lg\">\n            <div className=\"font-medium\">–£–∑–ª–æ–≤</div>\n            <div className=\"text-2xl font-bold text-primary\">{stats.nodes}</div>\n          </div>\n          <div className=\"p-3 bg-muted dark:bg-muted/50 rounded-lg\">\n            <div className=\"font-medium\">–°–≤—è–∑–µ–π</div>\n            <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{stats.connections}</div>\n          </div>\n          <div className=\"p-3 bg-muted dark:bg-muted/50 rounded-lg\">\n            <div className=\"font-medium\">–ö–æ–º–∞–Ω–¥</div>\n            <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{stats.commands}</div>\n          </div>\n          <div className=\"p-3 bg-muted dark:bg-muted/50 rounded-lg\">\n            <div className=\"font-medium\">–ö–Ω–æ–ø–æ–∫</div>\n            <div className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">{stats.buttons}</div>\n          </div>\n        </div>\n        \n        {template.tags && template.tags.length > 0 && (\n          <div>\n            <h4 className=\"font-medium mb-2\">–¢–µ–≥–∏:</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {template.tags.map((tag) => (\n                <Badge key={tag} variant=\"secondary\">{tag}</Badge>\n              ))}\n            </div>\n          </div>\n        )}\n        \n        <div className=\"flex gap-2 pt-4\">\n          <Button onClick={() => handleUseTemplate(template)} className=\"flex-1\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω\n          </Button>\n        </div>\n      </div>\n    );\n  };\n\n  // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è layout\n  const headerContent = (\n    <div className=\"h-16 bg-background border-b border-border px-6 flex items-center justify-between relative\">\n      {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - –ª–æ–≥–æ—Ç–∏–ø –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ */}\n      <div className=\"flex items-center space-x-6\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"bg-primary rounded-lg w-8 h-8 flex items-center justify-center\">\n            <Sparkles className=\"h-5 w-5 text-primary-foreground\" />\n          </div>\n          <div>\n            <h1 className=\"text-lg font-semibold text-foreground\">TelegramBot Builder</h1>\n            <p className=\"text-xs text-muted-foreground\">–®–∞–±–ª–æ–Ω—ã –±–æ—Ç–æ–≤</p>\n          </div>\n        </div>\n\n        {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Ä–∞–∑–¥–µ–ª–∞–º */}\n        <nav className=\"flex items-center space-x-1\">\n          {[\n            { key: 'editor', label: '–†–µ–¥–∞–∫—Ç–æ—Ä', onClick: () => setLocation('/') },\n            { key: 'templates', label: '–®–∞–±–ª–æ–Ω—ã', onClick: () => {}, isActive: true },\n            { key: 'export', label: '–≠–∫—Å–ø–æ—Ä—Ç', onClick: () => setLocation('/') },\n            { key: 'bot', label: '–ë–æ—Ç', onClick: () => setLocation('/') }\n          ].map((tab) => {\n            const isActive = tab.isActive;\n            return (\n              <button\n                key={tab.key}\n                onClick={tab.onClick}\n                className={`\n                  relative px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200 \n                  flex items-center gap-2 group\n                  ${isActive \n                    ? 'text-primary bg-primary/10 shadow-sm' \n                    : 'text-muted-foreground hover:text-foreground hover:bg-muted/50'\n                  }\n                `}\n              >\n                {tab.label}\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n\n      {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –¥–µ–π—Å—Ç–≤–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */}\n      <div className=\"flex items-center space-x-3\">\n        {/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–∫–µ—Ç–∞ */}\n        <SimpleLayoutCustomizer\n          config={flexibleLayoutConfig}\n          onConfigChange={setFlexibleLayoutConfig}\n        >\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            className=\"transition-all hover:scale-105\"\n          >\n            <Layout className=\"h-4 w-4 mr-2\" />\n            –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–∫–µ—Ç–∞\n          </Button>\n        </SimpleLayoutCustomizer>\n        \n        <Button \n          variant=\"outline\" \n          size=\"sm\"\n          onClick={() => {\n            const lastProjectId = localStorage.getItem('lastProjectId');\n            if (lastProjectId) {\n              setLocation(`/editor/${lastProjectId}`);\n            } else {\n              setLocation('/');\n            }\n          }}\n          className=\"transition-all hover:scale-105\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          –ù–∞–∑–∞–¥ –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É\n        </Button>\n      </div>\n    </div>\n  );\n\n  const sidebarContent = (\n    <div className=\"p-4 space-y-4\">\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Sparkles className=\"h-5 w-5 text-primary\" />\n        <h2 className=\"font-semibold\">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>\n      </div>\n      \n      <Tabs value={currentTab} onValueChange={setCurrentTab} orientation=\"vertical\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-1 h-auto\">\n          <TabsTrigger value=\"all\" className=\"justify-start gap-2\">\n            <Filter className=\"h-4 w-4\" />\n            –í—Å–µ —à–∞–±–ª–æ–Ω—ã\n          </TabsTrigger>\n          <TabsTrigger value=\"featured\" className=\"justify-start gap-2\">\n            <Crown className=\"h-4 w-4\" />\n            –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ\n          </TabsTrigger>\n          <TabsTrigger value=\"popular\" className=\"justify-start gap-2\">\n            <TrendingUp className=\"h-4 w-4\" />\n            –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ\n          </TabsTrigger>\n          <TabsTrigger value=\"my\" className=\"justify-start gap-2\">\n            <User className=\"h-4 w-4\" />\n            –ú–æ–∏ —à–∞–±–ª–æ–Ω—ã\n          </TabsTrigger>\n        </TabsList>\n      </Tabs>\n\n      <div className=\"space-y-3\">\n        <div>\n          <label className=\"text-sm font-medium mb-2 block\">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>\n          <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n            <SelectTrigger className=\"w-full\">\n              <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é\" />\n            </SelectTrigger>\n            <SelectContent>\n              {categories.map((category) => (\n                <SelectItem key={category.value} value={category.value}>\n                  {category.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n        \n        <div>\n          <label className=\"text-sm font-medium mb-2 block\">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>\n          <Select value={sortBy} onValueChange={(value: any) => setSortBy(value)}>\n            <SelectTrigger className=\"w-full\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"popular\">–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</SelectItem>\n              <SelectItem value=\"rating\">–†–µ–π—Ç–∏–Ω–≥</SelectItem>\n              <SelectItem value=\"recent\">–ù–æ–≤—ã–µ</SelectItem>\n              <SelectItem value=\"name\">–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n    </div>\n  );\n\n  const canvasContent = (\n    <div className=\"p-4 h-full\">\n      {showPreview && selectedTemplate ? (\n        <TemplatePreview template={selectedTemplate} />\n      ) : (\n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n            <Input\n              placeholder=\"–ü–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–æ–≤...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n\n          <div className=\"h-full overflow-y-auto\">\n            <TabsContent value=\"all\" className=\"mt-0\">\n              <TemplateGrid \n                templates={filteredAndSortedTemplates} \n                isLoading={isLoading}\n                onPreview={handlePreview}\n                onUse={handleUseTemplate}\n                onRate={handleRateTemplate}\n                searchTerm={searchTerm}\n                selectedCategory={selectedCategory}\n              />\n            </TabsContent>\n            \n            <TabsContent value=\"featured\" className=\"mt-0\">\n              <TemplateGrid \n                templates={filteredAndSortedTemplates} \n                isLoading={isLoadingFeatured}\n                onPreview={handlePreview}\n                onUse={handleUseTemplate}\n                onRate={handleRateTemplate}\n                searchTerm={searchTerm}\n                selectedCategory={selectedCategory}\n              />\n            </TabsContent>\n            \n            <TabsContent value=\"popular\" className=\"mt-0\">\n              <TemplateGrid \n                templates={filteredAndSortedTemplates} \n                isLoading={isLoading}\n                onPreview={handlePreview}\n                onUse={handleUseTemplate}\n                onRate={handleRateTemplate}\n                searchTerm={searchTerm}\n                selectedCategory={selectedCategory}\n              />\n            </TabsContent>\n            \n            <TabsContent value=\"my\" className=\"mt-0\">\n              <TemplateGrid \n                templates={filteredAndSortedTemplates} \n                isLoading={isLoadingMy}\n                onPreview={handlePreview}\n                onUse={handleUseTemplate}\n                onRate={handleRateTemplate}\n                onDelete={handleDeleteTemplate}\n                searchTerm={searchTerm}\n                selectedCategory={selectedCategory}\n                showDeleteButton={true}\n              />\n            </TabsContent>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n\n  const propertiesContent = (\n    <div className=\"p-4 space-y-4\">\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Filter className=\"h-5 w-5 text-primary\" />\n        <h2 className=\"font-semibold\">–§–∏–ª—å—Ç—Ä—ã</h2>\n      </div>\n      \n      {selectedTemplate && showPreview ? (\n        <div className=\"space-y-4\">\n          <h3 className=\"font-medium\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∞–±–ª–æ–Ω–µ</h3>\n          <div className=\"space-y-2 text-sm\">\n            <div>\n              <span className=\"font-medium\">–ù–∞–∑–≤–∞–Ω–∏–µ:</span>\n              <p className=\"text-muted-foreground\">{selectedTemplate.name}</p>\n            </div>\n            {selectedTemplate.description && (\n              <div>\n                <span className=\"font-medium\">–û–ø–∏—Å–∞–Ω–∏–µ:</span>\n                <p className=\"text-muted-foreground\">{selectedTemplate.description}</p>\n              </div>\n            )}\n            <div>\n              <span className=\"font-medium\">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>\n              <p className=\"text-muted-foreground\">\n                {categories.find(c => c.value === selectedTemplate.category)?.label || selectedTemplate.category}\n              </p>\n            </div>\n            {selectedTemplate.tags && selectedTemplate.tags.length > 0 && (\n              <div>\n                <span className=\"font-medium\">–¢–µ–≥–∏:</span>\n                <div className=\"flex flex-wrap gap-1 mt-1\">\n                  {selectedTemplate.tags.map((tag) => (\n                    <Badge key={tag} variant=\"outline\" className=\"text-xs\">\n                      {tag}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      ) : (\n        <div className=\"space-y-4 text-sm\">\n          <div>\n            <span className=\"font-medium\">–í—Å–µ–≥–æ —à–∞–±–ª–æ–Ω–æ–≤:</span>\n            <p className=\"text-muted-foreground\">{templates.length}</p>\n          </div>\n          <div>\n            <span className=\"font-medium\">–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ:</span>\n            <p className=\"text-muted-foreground\">{filteredAndSortedTemplates.length}</p>\n          </div>\n          {searchTerm && (\n            <div>\n              <span className=\"font-medium\">–ü–æ–∏—Å–∫:</span>\n              <p className=\"text-muted-foreground\">\"{searchTerm}\"</p>\n            </div>\n          )}\n          <div>\n            <span className=\"font-medium\">–¢–µ–∫—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞:</span>\n            <p className=\"text-muted-foreground\">\n              {currentTab === 'all' && '–í—Å–µ —à–∞–±–ª–æ–Ω—ã'}\n              {currentTab === 'featured' && '–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ'}\n              {currentTab === 'popular' && '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ'}\n              {currentTab === 'my' && '–ú–æ–∏ —à–∞–±–ª–æ–Ω—ã'}\n            </p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n\n  return (\n    <Tabs value={currentTab} onValueChange={setCurrentTab}>\n      <SimpleLayoutCustomizer\n        config={flexibleLayoutConfig}\n        onConfigChange={setFlexibleLayoutConfig}\n      >\n        <FlexibleLayout\n          config={flexibleLayoutConfig}\n          headerContent={headerContent}\n          sidebarContent={sidebarContent}\n          canvasContent={canvasContent}\n          propertiesContent={propertiesContent}\n        />\n      </SimpleLayoutCustomizer>\n    </Tabs>\n  );\n}\n\nexport default TemplatesPage;","size_bytes":37999},"client/src/types/bot.ts":{"content":"// Re-export all types from shared schema for compatibility\nexport * from '@shared/schema';","size_bytes":91},"client/src/utils/auto-connection.ts":{"content":"import { Node, Connection } from '@shared/schema';\n\nexport interface ConnectionSuggestion {\n  source: string;\n  target: string;\n  confidence: number;\n  reason: string;\n}\n\n// –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤\nexport function generateAutoConnections(nodes: Node[], existingConnections: Connection[]): ConnectionSuggestion[] {\n  const suggestions: ConnectionSuggestion[] = [];\n  const existingPairs = new Set(existingConnections.map(c => `${c.source}-${c.target}`));\n\n  // –¢–∏–ø—ã —É–∑–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω—ã –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ\n  const flowPatterns = [\n    { from: 'start', to: 'message', confidence: 0.9, reason: '–°—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª –æ–±—ã—á–Ω–æ –≤–µ–¥–µ—Ç –∫ —Å–æ–æ–±—â–µ–Ω–∏—é' },\n    { from: 'start', to: 'keyboard', confidence: 0.8, reason: '–°—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É' },\n    { from: 'command', to: 'message', confidence: 0.9, reason: '–ö–æ–º–∞–Ω–¥–∞ –æ–±—ã—á–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ' },\n    { from: 'command', to: 'keyboard', confidence: 0.8, reason: '–ö–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É' },\n    { from: 'message', to: 'keyboard', confidence: 0.7, reason: '–°–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É' },\n    { from: 'keyboard', to: 'message', confidence: 0.6, reason: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é' },\n    { from: 'input', to: 'message', confidence: 0.8, reason: '–í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –æ–±—ã—á–Ω–æ –≤–µ–¥–µ—Ç –∫ —Å–æ–æ–±—â–µ–Ω–∏—é' },\n    { from: 'condition', to: 'message', confidence: 0.7, reason: '–£—Å–ª–æ–≤–∏–µ –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é' },\n    { from: 'photo', to: 'keyboard', confidence: 0.6, reason: '–§–æ—Ç–æ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É' },\n  ];\n\n  // –ù–∞–π—Ç–∏ —É–∑–ª—ã –ø–æ —Ç–∏–ø–∞–º\n  const nodesByType = nodes.reduce((acc, node) => {\n    if (!acc[node.type]) acc[node.type] = [];\n    acc[node.type].push(node);\n    return acc;\n  }, {} as Record<string, Node[]>);\n\n  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–æ–≤\n  for (const pattern of flowPatterns) {\n    const sourceNodes = nodesByType[pattern.from] || [];\n    const targetNodes = nodesByType[pattern.to] || [];\n\n    for (const sourceNode of sourceNodes) {\n      for (const targetNode of targetNodes) {\n        const pairKey = `${sourceNode.id}-${targetNode.id}`;\n        if (!existingPairs.has(pairKey) && sourceNode.id !== targetNode.id) {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏\n          const distance = Math.sqrt(\n            Math.pow(targetNode.position.x - sourceNode.position.x, 2) +\n            Math.pow(targetNode.position.y - sourceNode.position.y, 2)\n          );\n          \n          // –£–º–µ–Ω—å—à–∞–µ–º confidence –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤\n          const distanceModifier = Math.max(0.5, 1 - distance / 1000);\n          \n          suggestions.push({\n            source: sourceNode.id,\n            target: targetNode.id,\n            confidence: pattern.confidence * distanceModifier,\n            reason: pattern.reason\n          });\n        }\n      }\n    }\n  }\n\n  // –ü–æ–∏—Å–∫ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤\n  const connectedNodes = new Set([\n    ...existingConnections.map(c => c.source),\n    ...existingConnections.map(c => c.target)\n  ]);\n\n  const isolatedNodes = nodes.filter(node => !connectedNodes.has(node.id));\n\n  // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤\n  for (const isolated of isolatedNodes) {\n    const nearbyNodes = nodes\n      .filter(node => node.id !== isolated.id && !existingPairs.has(`${isolated.id}-${node.id}`))\n      .map(node => ({\n        node,\n        distance: Math.sqrt(\n          Math.pow(node.position.x - isolated.position.x, 2) +\n          Math.pow(node.position.y - isolated.position.y, 2)\n        )\n      }))\n      .sort((a, b) => a.distance - b.distance)\n      .slice(0, 3); // –ë–µ—Ä–µ–º 3 –±–ª–∏–∂–∞–π—à–∏—Ö\n\n    for (const { node: nearbyNode, distance } of nearbyNodes) {\n      const confidence = Math.max(0.3, 0.8 - distance / 500);\n      suggestions.push({\n        source: isolated.id,\n        target: nearbyNode.id,\n        confidence,\n        reason: '–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–∑–µ–ª —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏'\n      });\n    }\n  }\n\n  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏\n  return suggestions.sort((a, b) => b.confidence - a.confidence);\n}\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\nexport function isValidConnection(\n  sourceNode: Node,\n  targetNode: Node,\n  existingConnections: Connection[]\n): { valid: boolean; reason?: string } {\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ —Å–æ–µ–¥–∏–Ω—è–µ–º —É–∑–µ–ª —Å–∞–º —Å —Å–æ–±–æ–π\n  if (sourceNode.id === targetNode.id) {\n    return { valid: false, reason: '–ù–µ–ª—å–∑—è —Å–æ–µ–¥–∏–Ω–∏—Ç—å —É–∑–µ–ª —Å–∞–º —Å —Å–æ–±–æ–π' };\n  }\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n  const existingConnection = existingConnections.find(\n    c => c.source === sourceNode.id && c.target === targetNode.id\n  );\n  if (existingConnection) {\n    return { valid: false, reason: '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };\n  }\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ü–∏–∫–ª–æ–≤)\n  const reverseConnection = existingConnections.find(\n    c => c.source === targetNode.id && c.target === sourceNode.id\n  );\n  if (reverseConnection) {\n    return { valid: false, reason: '–û–±—Ä–∞—Ç–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };\n  }\n\n  return { valid: true };\n}\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞\nexport function getNodeConnectionSuggestions(\n  node: Node,\n  allNodes: Node[],\n  existingConnections: Connection[]\n): ConnectionSuggestion[] {\n  const allSuggestions = generateAutoConnections(allNodes, existingConnections);\n  return allSuggestions.filter(s => s.source === node.id || s.target === node.id);\n}","size_bytes":6177},"client/src/utils/button-connection-manager.ts":{"content":"import { Node, Connection, Button } from '@shared/schema';\nimport { nanoid } from 'nanoid';\n\nexport interface –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–ö–Ω–æ–ø–∫–∏ {\n  id: string;\n  —Ç–µ–∫—Å—Ç: string;\n  –∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª: string;\n  —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª: string;\n  —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è: 'goto' | 'command';\n  —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: number;\n  –ø—Ä–∏—á–∏–Ω–∞: string;\n}\n\n// –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏\nexport function —Å–æ–∑–¥–∞—Ç—å–ö–Ω–æ–ø–∫—É–î–ª—è–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è(\n  –∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª: Node,\n  —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª: Node,\n  —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è: 'goto' | 'command' = 'goto'\n): Button {\n  const —Ç–µ–∫—Å—Ç–ö–Ω–æ–ø–∫–∏ = –ø–æ–ª—É—á–∏—Ç—å–¢–µ–∫—Å—Ç–ö–Ω–æ–ø–∫–∏(—Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª, —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è);\n  \n  return {\n    id: nanoid(),\n    text: —Ç–µ–∫—Å—Ç–ö–Ω–æ–ø–∫–∏,\n    action: —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è,\n    target: —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è === 'goto' ? —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.id : undefined,\n    url: —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è === 'command' ? —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.data.command : undefined\n  };\n}\n\n// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏\nfunction –ø–æ–ª—É—á–∏—Ç—å–¢–µ–∫—Å—Ç–ö–Ω–æ–ø–∫–∏(—É–∑–µ–ª: Node, —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è: 'goto' | 'command'): string {\n  if (—Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è === 'command' && —É–∑–µ–ª.data.command) {\n    return —É–∑–µ–ª.data.command;\n  }\n\n  switch (—É–∑–µ–ª.type) {\n    case 'start':\n      return 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é';\n    case 'message':\n      return —É–∑–µ–ª.data.messageText \n        ? —É–∑–µ–ª.data.messageText.slice(0, 20) + (—É–∑–µ–ª.data.messageText.length > 20 ? '...' : '')\n        : 'üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ';\n    case 'photo':\n      return 'üñºÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–æ—Ç–æ';\n    case 'keyboard':\n      return '‚å®Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é';\n    case 'input':\n      return '‚úèÔ∏è –í–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ';\n    case 'condition':\n      return 'üîÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ';\n    case 'command':\n      return —É–∑–µ–ª.data.command || '‚ö° –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É';\n    default:\n      return '‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';\n  }\n}\n\n// –ê–Ω–∞–ª–∏–∑ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∫–Ω–æ–ø–æ–∫\nexport function –Ω–∞–π—Ç–∏–ù—É–∂–Ω—ã–µ–ö–Ω–æ–ø–∫–∏(\n  —É–∑–ª—ã: Node[],\n  —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: Connection[]\n): –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–ö–Ω–æ–ø–∫–∏[] {\n  const —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–ö–Ω–æ–ø–∫–∏[] = [];\n\n  for (const —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ of —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è) {\n    const –∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª = —É–∑–ª—ã.find(—É–∑–µ–ª => —É–∑–µ–ª.id === —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.source);\n    const —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª = —É–∑–ª—ã.find(—É–∑–µ–ª => —É–∑–µ–ª.id === —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.target);\n\n    if (!–∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª || !—Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª) continue;\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ —É–∑–µ–ª –∏–º–µ—Ç—å –∫–Ω–æ–ø–∫–∏\n    if (!–º–æ–∂–µ—Ç–ò–º–µ—Ç—å–ö–Ω–æ–ø–∫–∏(–∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª)) continue;\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–Ω–æ–ø–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n    const —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è–ö–Ω–æ–ø–∫–∞ = –∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª.data.buttons.find(–∫–Ω–æ–ø–∫–∞ => \n      (–∫–Ω–æ–ø–∫–∞.action === 'goto' && –∫–Ω–æ–ø–∫–∞.target === —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.id) ||\n      (–∫–Ω–æ–ø–∫–∞.action === 'command' && –∫–Ω–æ–ø–∫–∞.url === —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.data.command)\n    );\n\n    if (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è–ö–Ω–æ–ø–∫–∞) continue;\n\n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è\n    const —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è = —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.type === 'command' ? 'command' : 'goto';\n    \n    —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.push({\n      id: nanoid(),\n      —Ç–µ–∫—Å—Ç: –ø–æ–ª—É—á–∏—Ç—å–¢–µ–∫—Å—Ç–ö–Ω–æ–ø–∫–∏(—Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª, —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è),\n      –∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª: –∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª.id,\n      —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª: —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.id,\n      —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è,\n      —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å(–∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª, —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª),\n      –ø—Ä–∏—á–∏–Ω–∞: `–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É \"${–ø–æ–ª—É—á–∏—Ç—å–¢–µ–∫—Å—Ç–ö–Ω–æ–ø–∫–∏(—Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª, —Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è)}\" –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ ${–ø–æ–ª—É—á–∏—Ç—å–ù–∞–∑–≤–∞–Ω–∏–µ–¢–∏–ø–∞(—Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª)}`\n    });\n  }\n\n  return —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.sort((–∞, –±) => –±.—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å - –∞.—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å);\n}\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–µ—Ç –ª–∏ —É–∑–µ–ª –∏–º–µ—Ç—å –∫–Ω–æ–ø–∫–∏\nfunction –º–æ–∂–µ—Ç–ò–º–µ—Ç—å–ö–Ω–æ–ø–∫–∏(—É–∑–µ–ª: Node): boolean {\n  return ['message', 'photo', 'keyboard', 'start', 'input'].includes(—É–∑–µ–ª.type);\n}\n\n// –†–∞—Å—á–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏\nfunction —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å(–∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª: Node, —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª: Node): number {\n  let —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å = 0.7;\n\n  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –ª–æ–≥–∏—á–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤\n  if (–∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª.type === 'message' && —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.type === 'keyboard') —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å += 0.2;\n  if (–∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª.type === 'start' && —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.type === 'message') —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å += 0.2;\n  if (–∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª.type === 'keyboard' && —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.type === 'message') —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å += 0.1;\n  if (—Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª.type === 'command') —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å += 0.15;\n\n  // –£–º–µ–Ω—å—à–∞–µ–º –¥–ª—è —É–∑–ª–æ–≤ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–Ω–æ–ø–æ–∫\n  const –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–ö–Ω–æ–ø–æ–∫ = –∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª.data.buttons.length;\n  if (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–ö–Ω–æ–ø–æ–∫ > 3) —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å -= 0.1;\n  if (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–ö–Ω–æ–ø–æ–∫ > 6) —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å -= 0.2;\n\n  return Math.min(0.95, Math.max(0.3, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å));\n}\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–∞ —É–∑–ª–∞\nfunction –ø–æ–ª—É—á–∏—Ç—å–ù–∞–∑–≤–∞–Ω–∏–µ–¢–∏–ø–∞(—É–∑–µ–ª: Node): string {\n  const –Ω–∞–∑–≤–∞–Ω–∏—è–¢–∏–ø–æ–≤ = {\n    start: '–≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é',\n    message: '—Å–æ–æ–±—â–µ–Ω–∏—é',\n    photo: '—Ñ–æ—Ç–æ',\n    keyboard: '–∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ',\n    input: '–≤–≤–æ–¥—É –¥–∞–Ω–Ω—ã—Ö',\n    condition: '—É—Å–ª–æ–≤–∏—é',\n    command: '–∫–æ–º–∞–Ω–¥–µ'\n  };\n  return –Ω–∞–∑–≤–∞–Ω–∏—è–¢–∏–ø–æ–≤[—É–∑–µ–ª.type] || '—É–∑–ª—É';\n}\n\n// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫\nexport function –∞–≤—Ç–æ–°–æ–∑–¥–∞–Ω–∏–µ–ö–Ω–æ–ø–æ–∫(\n  —É–∑–ª—ã: Node[],\n  —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: Connection[]\n): { –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã: Node[]; —Å–æ–∑–¥–∞–Ω–æ–ö–Ω–æ–ø–æ–∫: number } {\n  const —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ = –Ω–∞–π—Ç–∏–ù—É–∂–Ω—ã–µ–ö–Ω–æ–ø–∫–∏(—É–∑–ª—ã, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è);\n  let —Å–æ–∑–¥–∞–Ω–æ–ö–Ω–æ–ø–æ–∫ = 0;\n  \n  const –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã = —É–∑–ª—ã.map(—É–∑–µ–ª => {\n    const —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏–î–ª—è–£–∑–ª–∞ = —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.filter(—Ä => —Ä.–∏—Å—Ö–æ–¥–Ω—ã–π–£–∑–µ–ª === —É–∑–µ–ª.id);\n    \n    if (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏–î–ª—è–£–∑–ª–∞.length === 0) return —É–∑–µ–ª;\n\n    const –Ω–æ–≤—ã–µ–ö–Ω–æ–ø–∫–∏ = —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏–î–ª—è–£–∑–ª–∞.map(—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è => {\n      const —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª = —É–∑–ª—ã.find(—É => —É.id === —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è.—Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª)!;\n      return —Å–æ–∑–¥–∞—Ç—å–ö–Ω–æ–ø–∫—É–î–ª—è–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è(—É–∑–µ–ª, —Ü–µ–ª–µ–≤–æ–π–£–∑–µ–ª, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è.—Ç–∏–ø–î–µ–π—Å—Ç–≤–∏—è);\n    });\n\n    —Å–æ–∑–¥–∞–Ω–æ–ö–Ω–æ–ø–æ–∫ += –Ω–æ–≤—ã–µ–ö–Ω–æ–ø–∫–∏.length;\n\n    return {\n      ...—É–∑–µ–ª,\n      data: {\n        ...—É–∑–µ–ª.data,\n        buttons: [...—É–∑–µ–ª.data.buttons, ...–Ω–æ–≤—ã–µ–ö–Ω–æ–ø–∫–∏]\n      }\n    };\n  });\n\n  return { –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã, —Å–æ–∑–¥–∞–Ω–æ–ö–Ω–æ–ø–æ–∫ };\n}\n\n// –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫\nexport function –æ—á–∏—Å—Ç–∏—Ç—å–õ–∏—à–Ω–∏–µ–ö–Ω–æ–ø–∫–∏(\n  —É–∑–ª—ã: Node[],\n  —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: Connection[]\n): { –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã: Node[]; —É–¥–∞–ª–µ–Ω–æ–ö–Ω–æ–ø–æ–∫: number } {\n  let —É–¥–∞–ª–µ–Ω–æ–ö–Ω–æ–ø–æ–∫ = 0;\n  \n  const –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã = —É–∑–ª—ã.map(—É–∑–µ–ª => {\n    const –≤–∞–ª–∏–¥–Ω—ã–µ–ö–Ω–æ–ø–∫–∏ = —É–∑–µ–ª.data.buttons.filter(–∫–Ω–æ–ø–∫–∞ => {\n      if (–∫–Ω–æ–ø–∫–∞.action === 'goto' && –∫–Ω–æ–ø–∫–∞.target) {\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–π –∫–Ω–æ–ø–∫–∏\n        const –µ—Å—Ç—å–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ = —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.some(—Å–æ–µ–¥ => \n          —Å–æ–µ–¥.source === —É–∑–µ–ª.id && —Å–æ–µ–¥.target === –∫–Ω–æ–ø–∫–∞.target\n        );\n        if (!–µ—Å—Ç—å–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ) {\n          —É–¥–∞–ª–µ–Ω–æ–ö–Ω–æ–ø–æ–∫++;\n          return false;\n        }\n      }\n      return true;\n    });\n\n    return {\n      ...—É–∑–µ–ª,\n      data: {\n        ...—É–∑–µ–ª.data,\n        buttons: –≤–∞–ª–∏–¥–Ω—ã–µ–ö–Ω–æ–ø–∫–∏\n      }\n    };\n  });\n\n  return { –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã, —É–¥–∞–ª–µ–Ω–æ–ö–Ω–æ–ø–æ–∫ };\n}\n\n// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏\nexport function —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å–ö–Ω–æ–ø–∫–∏–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è(\n  —É–∑–ª—ã: Node[],\n  —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: Connection[]\n): { –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã: Node[]; –∏–∑–º–µ–Ω–µ–Ω–∏—è: { —Å–æ–∑–¥–∞–Ω–æ: number; —É–¥–∞–ª–µ–Ω–æ: number } } {\n  // –°–Ω–∞—á–∞–ª–∞ —É–±–∏—Ä–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ –∫–Ω–æ–ø–∫–∏\n  const { –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã: –æ—á–∏—â–µ–Ω–Ω—ã–µ–£–∑–ª—ã, —É–¥–∞–ª–µ–Ω–æ–ö–Ω–æ–ø–æ–∫ } = –æ—á–∏—Å—Ç–∏—Ç—å–õ–∏—à–Ω–∏–µ–ö–Ω–æ–ø–∫–∏(—É–∑–ª—ã, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è);\n  \n  // –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–Ω–æ–ø–∫–∏\n  const { –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã: —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ–£–∑–ª—ã, —Å–æ–∑–¥–∞–Ω–æ–ö–Ω–æ–ø–æ–∫ } = –∞–≤—Ç–æ–°–æ–∑–¥–∞–Ω–∏–µ–ö–Ω–æ–ø–æ–∫(–æ—á–∏—â–µ–Ω–Ω—ã–µ–£–∑–ª—ã, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è);\n\n  return {\n    –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ–£–∑–ª—ã: —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ–£–∑–ª—ã,\n    –∏–∑–º–µ–Ω–µ–Ω–∏—è: {\n      —Å–æ–∑–¥–∞–Ω–æ: —Å–æ–∑–¥–∞–Ω–æ–ö–Ω–æ–ø–æ–∫,\n      —É–¥–∞–ª–µ–Ω–æ: —É–¥–∞–ª–µ–Ω–æ–ö–Ω–æ–ø–æ–∫\n    }\n  };\n}","size_bytes":9881},"client/src/utils/connection-manager.ts":{"content":"import { Node, Connection, Button } from '@shared/schema';\nimport { nanoid } from 'nanoid';\n\nexport interface ConnectionWithButton {\n  connection: Connection;\n  button: Button;\n  sourceNode: Node;\n  targetNode: Node;\n}\n\nexport interface ConnectionSuggestion {\n  id: string;\n  connection: Connection;\n  suggestedButton: Button;\n  confidence: number;\n  reason: string;\n  autoCreate: boolean;\n}\n\nexport interface ConnectionManagerState {\n  connections: Connection[];\n  nodes: Node[];\n  pendingConnections: ConnectionSuggestion[];\n  autoButtonCreation: boolean;\n  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –ª–∏—Å—Ç–æ–≤\n  sheets?: any[]; // –ú–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ –¥–ª—è –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n  currentSheetId?: string; // ID —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞\n}\n\nexport class ConnectionManager {\n  private state: ConnectionManagerState;\n  \n  constructor(initialState: Partial<ConnectionManagerState> = {}) {\n    this.state = {\n      connections: [],\n      nodes: [],\n      pendingConnections: [],\n      autoButtonCreation: true,\n      ...initialState\n    };\n  }\n\n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n  updateState(newState: Partial<ConnectionManagerState>) {\n    this.state = { ...this.state, ...newState };\n  }\n\n  // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)\n  createConnection(sourceId: string, targetId: string, options: {\n    autoCreateButton?: boolean;\n    buttonText?: string;\n    buttonAction?: 'goto' | 'command' | 'url';\n    targetSheetId?: string; // ID —Ü–µ–ª–µ–≤–æ–≥–æ –ª–∏—Å—Ç–∞ –¥–ª—è –º–µ–∂–ª–∏—Å—Ç–æ–≤–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n  } = {}): { connection: Connection; updatedNodes: Node[] } {\n    const sourceNode = this.state.nodes.find(n => n.id === sourceId);\n    let targetNode = this.state.nodes.find(n => n.id === targetId);\n    \n    // –ï—Å–ª–∏ —É–∑–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–º –ª–∏—Å—Ç–µ, –∏—â–µ–º –≤ –¥—Ä—É–≥–∏—Ö –ª–∏—Å—Ç–∞—Ö\n    if (!targetNode && options.targetSheetId && this.state.sheets) {\n      const targetSheet = this.state.sheets.find((sheet: any) => sheet.id === options.targetSheetId);\n      if (targetSheet) {\n        targetNode = targetSheet.nodes?.find((n: any) => n.id === targetId);\n      }\n    }\n\n    if (!sourceNode) {\n      throw new Error('–ò—Å—Ö–æ–¥–Ω—ã–π —É–∑–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');\n    }\n    \n    if (!targetNode) {\n      throw new Error('–¶–µ–ª–µ–≤–æ–π —É–∑–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');\n    }\n\n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã–º\n    const isInterSheet = options.targetSheetId && options.targetSheetId !== this.state.currentSheetId;\n\n    // –°–æ–∑–¥–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n    const connection: Connection = {\n      id: nanoid(),\n      source: sourceId,\n      target: targetId,\n      sourceSheetId: this.state.currentSheetId,\n      targetSheetId: options.targetSheetId || this.state.currentSheetId,\n      isInterSheet: isInterSheet || false\n    };\n\n    // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫\n    const shouldCreateButton = options.autoCreateButton ?? this.state.autoButtonCreation;\n    let updatedNodes = [...this.state.nodes];\n\n    if (shouldCreateButton && this.canNodeHaveButtons(sourceNode)) {\n      const button = this.createButtonForConnection(sourceNode, targetNode, options);\n      updatedNodes = this.addButtonToNode(updatedNodes, sourceId, button);\n    }\n\n    return { connection, updatedNodes };\n  }\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —É–∑–ª–æ–≤ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ –¥–ª—è –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n  getAllNodesFromAllSheets(): { node: Node; sheetId: string; sheetName: string }[] {\n    const allNodes: { node: Node; sheetId: string; sheetName: string }[] = [];\n    \n    if (this.state.sheets) {\n      this.state.sheets.forEach((sheet: any) => {\n        if (sheet.nodes) {\n          sheet.nodes.forEach((node: Node) => {\n            allNodes.push({\n              node,\n              sheetId: sheet.id,\n              sheetName: sheet.name\n            });\n          });\n        }\n      });\n    }\n    \n    return allNodes;\n  }\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)\n  private createButtonForConnection(\n    sourceNode: Node,\n    targetNode: Node,\n    options: {\n      buttonText?: string;\n      buttonAction?: 'goto' | 'command' | 'url';\n      targetSheetId?: string;\n    } = {}\n  ): Button {\n    const action = options.buttonAction || this.determineButtonAction(targetNode);\n    let text = options.buttonText || this.generateButtonText(targetNode, action);\n    \n    // –ï—Å–ª–∏ —ç—Ç–æ –º–µ–∂–ª–∏—Å—Ç–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ª–∏—Å—Ç–∞\n    if (options.targetSheetId && options.targetSheetId !== this.state.currentSheetId) {\n      const targetSheet = this.state.sheets?.find((sheet: any) => sheet.id === options.targetSheetId);\n      if (targetSheet) {\n        text += ` üìã (${targetSheet.name})`;\n      }\n    }\n\n    return {\n      id: nanoid(),\n      text,\n      action,\n      target: action === 'goto' ? targetNode.id : undefined,\n      url: action === 'url' ? targetNode.data.imageUrl : undefined\n    };\n  }\n\n  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è –∫–Ω–æ–ø–∫–∏\n  private determineButtonAction(targetNode: Node): 'goto' | 'command' | 'url' {\n    switch (targetNode.type) {\n      case 'command':\n        return 'command';\n      case 'photo':\n        return targetNode.data.imageUrl ? 'url' : 'goto';\n      default:\n        return 'goto';\n    }\n  }\n\n  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏\n  private generateButtonText(targetNode: Node, action: 'goto' | 'command' | 'url'): string {\n    if (action === 'command' && targetNode.data.command) {\n      return targetNode.data.command;\n    }\n\n    const textMap: Record<Node['type'], string> = {\n      start: 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',\n      message: targetNode.data.messageText?.slice(0, 25) + '...' || 'üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ',\n      photo: 'üñºÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–æ—Ç–æ',\n      keyboard: '‚å®Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é',\n      input: '‚úèÔ∏è –í–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ',\n      condition: 'üîÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ',\n      command: targetNode.data.command || '‚ö° –ö–æ–º–∞–Ω–¥–∞'\n    };\n\n    return textMap[targetNode.type] || '‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';\n  }\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–µ—Ç –ª–∏ —É–∑–µ–ª –∏–º–µ—Ç—å –∫–Ω–æ–ø–∫–∏\n  private canNodeHaveButtons(node: Node): boolean {\n    return ['message', 'photo', 'keyboard', 'start', 'input'].includes(node.type);\n  }\n\n  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∫ —É–∑–ª—É\n  private addButtonToNode(nodes: Node[], nodeId: string, button: Button): Node[] {\n    return nodes.map(node => {\n      if (node.id === nodeId) {\n        const existingButtons = node.data.buttons || [];\n        return {\n          ...node,\n          data: {\n            ...node.data,\n            buttons: [...existingButtons, button]\n          }\n        };\n      }\n      return node;\n    });\n  }\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n  generateConnectionSuggestions(): ConnectionSuggestion[] {\n    const suggestions: ConnectionSuggestion[] = [];\n    const existingConnections = new Set(\n      this.state.connections.map(c => `${c.source}-${c.target}`)\n    );\n\n    // –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π\n    for (const sourceNode of this.state.nodes) {\n      if (!this.canNodeHaveButtons(sourceNode)) continue;\n\n      for (const targetNode of this.state.nodes) {\n        if (sourceNode.id === targetNode.id) continue;\n        \n        const connectionKey = `${sourceNode.id}-${targetNode.id}`;\n        if (existingConnections.has(connectionKey)) continue;\n\n        const confidence = this.calculateConnectionConfidence(sourceNode, targetNode);\n        if (confidence < 0.5) continue;\n\n        const connection: Connection = {\n          id: nanoid(),\n          source: sourceNode.id,\n          target: targetNode.id\n        };\n\n        const suggestedButton = this.createButtonForConnection(sourceNode, targetNode);\n\n        suggestions.push({\n          id: nanoid(),\n          connection,\n          suggestedButton,\n          confidence,\n          reason: this.getConnectionReason(sourceNode, targetNode),\n          autoCreate: confidence > 0.8\n        });\n      }\n    }\n\n    return suggestions.sort((a, b) => b.confidence - a.confidence);\n  }\n\n  // –†–∞—Å—á–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n  private calculateConnectionConfidence(sourceNode: Node, targetNode: Node): number {\n    let confidence = 0.3;\n\n    // –õ–æ–≥–∏—á–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã\n    const flowPatterns = [\n      { from: 'start', to: 'message', bonus: 0.4 },\n      { from: 'start', to: 'keyboard', bonus: 0.3 },\n      { from: 'command', to: 'message', bonus: 0.4 },\n      { from: 'message', to: 'keyboard', bonus: 0.3 },\n      { from: 'keyboard', to: 'message', bonus: 0.2 },\n      { from: 'input', to: 'message', bonus: 0.3 },\n      { from: 'condition', to: 'message', bonus: 0.3 }\n    ];\n\n    const pattern = flowPatterns.find(p => p.from === sourceNode.type && p.to === targetNode.type);\n    if (pattern) {\n      confidence += pattern.bonus;\n    }\n\n    // –®—Ç—Ä–∞—Ñ –∑–∞ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–Ω–æ–ø–æ–∫\n    const buttons = sourceNode.data.buttons || [];\n    const buttonCount = buttons.length;\n    if (buttonCount > 4) confidence -= 0.1;\n    if (buttonCount > 8) confidence -= 0.2;\n\n    // –ë–æ–Ω—É—Å –∑–∞ –±–ª–∏–∑–æ—Å—Ç—å —É–∑–ª–æ–≤\n    const distance = Math.sqrt(\n      Math.pow(sourceNode.position.x - targetNode.position.x, 2) +\n      Math.pow(sourceNode.position.y - targetNode.position.y, 2)\n    );\n    if (distance < 400) confidence += 0.1;\n\n    return Math.min(0.95, Math.max(0.1, confidence));\n  }\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n  private getConnectionReason(sourceNode: Node, targetNode: Node): string {\n    if (sourceNode.type === 'start' && targetNode.type === 'message') {\n      return '–°—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª –æ–±—ã—á–Ω–æ –≤–µ–¥–µ—Ç –∫ –ø–µ—Ä–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é';\n    }\n    if (sourceNode.type === 'command' && targetNode.type === 'message') {\n      return '–ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ';\n    }\n    if (sourceNode.type === 'message' && targetNode.type === 'keyboard') {\n      return '–°–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É';\n    }\n    if (sourceNode.type === 'input' && targetNode.type === 'message') {\n      return '–ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ –¥–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å';\n    }\n    \n    return `–°–≤—è–∑—å –º–µ–∂–¥—É ${this.getNodeTypeName(sourceNode.type)} –∏ ${this.getNodeTypeName(targetNode.type)}`;\n  }\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–∞ —É–∑–ª–∞\n  private getNodeTypeName(type: Node['type']): string {\n    const names: Record<Node['type'], string> = {\n      start: '—Å—Ç–∞—Ä—Ç–æ–º',\n      message: '—Å–æ–æ–±—â–µ–Ω–∏–µ–º',\n      photo: '—Ñ–æ—Ç–æ',\n      keyboard: '–∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π',\n      input: '–≤–≤–æ–¥–æ–º',\n      condition: '—É—Å–ª–æ–≤–∏–µ–º',\n      command: '–∫–æ–º–∞–Ω–¥–æ–π'\n    };\n    return names[type] || type;\n  }\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n  removeConnection(connectionId: string): { removedConnection: Connection | null; updatedNodes: Node[] } {\n    const removedConnection = this.state.connections.find(c => c.id === connectionId);\n    if (!removedConnection) {\n      return { removedConnection: null, updatedNodes: this.state.nodes };\n    }\n\n    // –ù–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É\n    const updatedNodes = this.state.nodes.map(node => {\n      if (node.id === removedConnection.source) {\n        return {\n          ...node,\n          data: {\n            ...node.data,\n            buttons: node.data.buttons.filter(button => \n              button.action !== 'goto' || button.target !== removedConnection.target\n            )\n          }\n        };\n      }\n      return node;\n    });\n\n    return { removedConnection, updatedNodes };\n  }\n\n  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏\n  syncButtonsWithConnections(): Node[] {\n    const updatedNodes = [...this.state.nodes];\n\n    for (const connection of this.state.connections) {\n      const sourceNode = updatedNodes.find(n => n.id === connection.source);\n      const targetNode = updatedNodes.find(n => n.id === connection.target);\n\n      if (!sourceNode || !targetNode || !this.canNodeHaveButtons(sourceNode)) continue;\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–Ω–æ–ø–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n      const hasButton = sourceNode.data.buttons.some(button => \n        button.action === 'goto' && button.target === connection.target\n      );\n\n      if (!hasButton) {\n        // –°–æ–∑–¥–∞–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é –∫–Ω–æ–ø–∫—É\n        const button = this.createButtonForConnection(sourceNode, targetNode);\n        const nodeIndex = updatedNodes.findIndex(n => n.id === connection.source);\n        updatedNodes[nodeIndex] = {\n          ...updatedNodes[nodeIndex],\n          data: {\n            ...updatedNodes[nodeIndex].data,\n            buttons: [...updatedNodes[nodeIndex].data.buttons, button]\n          }\n        };\n      }\n    }\n\n    return updatedNodes;\n  }\n\n  // –û—á–∏—Å—Ç–∫–∞ –ª–∏—à–Ω–∏—Ö –∫–Ω–æ–ø–æ–∫\n  cleanupOrphanedButtons(): Node[] {\n    const connectionTargets = new Set(this.state.connections.map(c => c.target));\n\n    return this.state.nodes.map(node => ({\n      ...node,\n      data: {\n        ...node.data,\n        buttons: node.data.buttons.filter(button => \n          button.action !== 'goto' || \n          !button.target || \n          connectionTargets.has(button.target)\n        )\n      }\n    }));\n  }\n}\n\n// –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\nexport function createConnectionManager(\n  nodes: Node[], \n  connections: Connection[], \n  options: { autoButtonCreation?: boolean } = {}\n): ConnectionManager {\n  return new ConnectionManager({\n    nodes,\n    connections,\n    autoButtonCreation: options.autoButtonCreation ?? true\n  });\n}","size_bytes":14331},"client/src/utils/hierarchical-layout.ts":{"content":"import { Node, Connection } from '@/types/bot';\nimport { getIsMobile } from '@/hooks/use-mobile';\n\ninterface LayoutNode extends Node {\n  level?: number;\n  children?: LayoutNode[];\n  visited?: boolean;\n}\n\ninterface HierarchicalLayoutOptions {\n  levelHeight: number;\n  nodeWidth: number;\n  nodeHeight: number; // –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ —É–∑–ª–∞\n  horizontalSpacing: number;\n  verticalSpacing: number;\n  startX: number;\n  startY: number;\n  nodeSizes?: Map<string, { width: number; height: number }>; // –ö–∞—Ä—Ç–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —É–∑–ª–æ–≤\n}\n\nconst DEFAULT_OPTIONS: HierarchicalLayoutOptions = {\n  levelHeight: 150,\n  nodeWidth: 320,\n  nodeHeight: 120, // –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∏–ø–∏—á–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —É–∑–ª–∞\n  horizontalSpacing: 150, // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 150 –¥–ª—è –ª—É—á—à–µ–≥–æ –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π\n  verticalSpacing: 120, // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 120 –¥–ª—è –ª—É—á—à–µ–≥–æ –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π\n  startX: 50,\n  startY: 50\n};\n\n/**\n * –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —É–∑–ª–∞ —Å —É—á–µ—Ç–æ–º —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π\n */\nfunction getNodeSize(nodeId: string, options: HierarchicalLayoutOptions): { width: number; height: number } {\n  const realSize = options.nodeSizes?.get(nodeId);\n  return realSize || { width: options.nodeWidth, height: options.nodeHeight };\n}\n\n/**\n * –°–æ–∑–¥–∞–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —É–∑–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n * @param nodes - –º–∞—Å—Å–∏–≤ —É–∑–ª–æ–≤ –¥–ª—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è\n * @param connections - –º–∞—Å—Å–∏–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–µ–∂–¥—É —É–∑–ª–∞–º–∏\n * @param options - –æ–ø—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏\n * @returns –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —É–∑–ª—ã —Å –Ω–æ–≤—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏\n */\nexport function createHierarchicalLayout(\n  nodes: Node[], \n  connections: Connection[], \n  options: Partial<HierarchicalLayoutOptions> = {}\n): Node[] {\n  console.log('üîÑ Hierarchical layout called with', nodes.length, 'nodes, nodeSizes:', !!options.nodeSizes);\n  const opts = { ...DEFAULT_OPTIONS, ...options };\n  \n  if (nodes.length === 0) return nodes;\n\n  // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é —É–∑–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏\n  const layoutNodes: LayoutNode[] = nodes.map(node => ({ \n    ...node, \n    level: 0, \n    children: [], \n    visited: false \n  }));\n\n  // –ù–∞—Ö–æ–¥–∏–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª (–æ–±—ã—á–Ω–æ —Å —Ç–∏–ø–æ–º 'start' –∏–ª–∏ –±–µ–∑ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)\n  const startNode = findStartNode(layoutNodes, connections);\n  if (!startNode) {\n    // –ï—Å–ª–∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π\n    return arrangeNodesLinear(layoutNodes, opts);\n  }\n\n  // –°—Ç—Ä–æ–∏–º –¥–µ—Ä–µ–≤–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π\n  buildDependencyTree(layoutNodes, connections, startNode);\n  \n  // –í—ã—á–∏—Å–ª—è–µ–º —É—Ä–æ–≤–Ω–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞\n  assignLevels(startNode);\n\n  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —É–∑–ª—ã –ø–æ —É—Ä–æ–≤–Ω—è–º\n  const levels = groupNodesByLevel(layoutNodes);\n  \n  // –†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º —É–∑–ª—ã –ø–æ —É—Ä–æ–≤–Ω—è–º\n  return arrangeNodesByLevel(levels, opts);\n}\n\n/**\n * –ù–∞—Ö–æ–¥–∏—Ç —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª (—É–∑–µ–ª —Ç–∏–ø–∞ 'start' –∏–ª–∏ —É–∑–µ–ª –±–µ–∑ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)\n */\nfunction findStartNode(nodes: LayoutNode[], connections: Connection[]): LayoutNode | null {\n  // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —É–∑–µ–ª —Ç–∏–ø–∞ 'start'\n  const startNode = nodes.find(node => node.type === 'start');\n  if (startNode) return startNode;\n\n  // –ï—Å–ª–∏ –Ω–µ—Ç —É–∑–ª–∞ 'start', –∏—â–µ–º —É–∑–µ–ª –±–µ–∑ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n  const nodeIds = nodes.map(n => n.id);\n  const targetIds = new Set(connections.map(c => c.target));\n  \n  const rootNodes = nodes.filter(node => !targetIds.has(node.id));\n  return rootNodes.length > 0 ? rootNodes[0] : nodes[0];\n}\n\n/**\n * –°—Ç—Ä–æ–∏—Ç –¥–µ—Ä–µ–≤–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n */\nfunction buildDependencyTree(nodes: LayoutNode[], connections: Connection[], startNode: LayoutNode) {\n  const nodeMap = new Map(nodes.map(node => [node.id, node]));\n  \n  // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n  const graph = new Map<string, string[]>();\n  connections.forEach(connection => {\n    if (!graph.has(connection.source)) {\n      graph.set(connection.source, []);\n    }\n    graph.get(connection.source)!.push(connection.target);\n  });\n\n  // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å—Ç—Ä–æ–∏–º –¥–µ—Ä–µ–≤–æ\n  function buildTree(node: LayoutNode, visited = new Set<string>()) {\n    if (visited.has(node.id)) return; // –ò–∑–±–µ–≥–∞–µ–º —Ü–∏–∫–ª–æ–≤\n    visited.add(node.id);\n    \n    const children = graph.get(node.id) || [];\n    node.children = children\n      .map(childId => nodeMap.get(childId))\n      .filter(Boolean) as LayoutNode[];\n    \n    node.children.forEach(child => buildTree(child, visited));\n  }\n\n  buildTree(startNode);\n}\n\n/**\n * –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç —É—Ä–æ–≤–Ω–∏ —É–∑–ª–∞–º –≤ –¥–µ—Ä–µ–≤–µ\n */\nfunction assignLevels(startNode: LayoutNode, level = 0) {\n  startNode.level = level;\n  startNode.visited = true;\n  \n  if (startNode.children) {\n    startNode.children.forEach(child => {\n      if (!child.visited) {\n        assignLevels(child, level + 1);\n      }\n    });\n  }\n}\n\n/**\n * –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç —É–∑–ª—ã –ø–æ —É—Ä–æ–≤–Ω—è–º\n */\nfunction groupNodesByLevel(nodes: LayoutNode[]): LayoutNode[][] {\n  const levels: LayoutNode[][] = [];\n  \n  nodes.forEach(node => {\n    const level = node.level || 0;\n    if (!levels[level]) {\n      levels[level] = [];\n    }\n    levels[level].push(node);\n  });\n  \n  return levels;\n}\n\n/**\n * –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–ª–ª–∏–∑–∏–∏ —É–∑–ª–æ–≤ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ\n */\nfunction fixCollisions(nodes: Node[], options: HierarchicalLayoutOptions): Node[] {\n  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —É–∑–ª—ã –ø–æ —É—Ä–æ–≤–Ω—è–º (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –ø–æ X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º)\n  const levelGroups = new Map<number, Node[]>();\n  const levelWidth = options.nodeWidth + options.horizontalSpacing;\n  \n  nodes.forEach(node => {\n    // –û–∫—Ä—É–≥–ª—è–µ–º X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —É—Ä–æ–≤–Ω—è\n    const level = Math.round((node.position.x - options.startX) / levelWidth);\n    if (!levelGroups.has(level)) {\n      levelGroups.set(level, []);\n    }\n    levelGroups.get(level)!.push(node);\n  });\n  \n  // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏–∏\n  levelGroups.forEach((levelNodes) => {\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º —É–∑–ª—ã –ø–æ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–µ\n    levelNodes.sort((a, b) => a.position.y - b.position.y);\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è\n    for (let i = 1; i < levelNodes.length; i++) {\n      const currentNode = levelNodes[i];\n      const prevNode = levelNodes[i - 1];\n      \n      const currentSize = getNodeSize(currentNode.id, options);\n      const prevSize = getNodeSize(prevNode.id, options);\n      \n      const prevBottom = prevNode.position.y + prevSize.height;\n      const currentTop = currentNode.position.y;\n      \n      // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ\n      const minSpacing = options.verticalSpacing;\n      if (currentTop < prevBottom + minSpacing) {\n        // –°–¥–≤–∏–≥–∞–µ–º —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª –≤–Ω–∏–∑\n        currentNode.position.y = prevBottom + minSpacing;\n      }\n    }\n  });\n  \n  return nodes;\n}\n\n/**\n * –†–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç —É–∑–ª—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏\n */\nfunction arrangeNodesByLevel(levels: LayoutNode[][], options: HierarchicalLayoutOptions): Node[] {\n  const result: Node[] = [];\n  \n  // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —É–∑–ª–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞\n  const nodeMap = new Map<string, LayoutNode>();\n  levels.flat().forEach(node => nodeMap.set(node.id, node));\n  \n  // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –ø–æ–¥–¥–µ—Ä–µ–≤–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç—å–µ–≤) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞\n  function computeLeafCount(node: LayoutNode): number {\n    if (!node.children || node.children.length === 0) {\n      return 1;\n    }\n    return node.children.reduce((sum, child) => sum + computeLeafCount(child), 0);\n  }\n  \n  // –ù–∞–∑–Ω–∞—á–∞–µ–º y –ø–æ–∑–∏—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ–¥–¥–µ—Ä–µ–≤—å–µ–≤\n  function assignYPositions(node: LayoutNode, startY: number): number {\n    const nodeSize = getNodeSize(node.id, options);\n    \n    if (!node.children || node.children.length === 0) {\n      // –õ–∏—Å—Ç–æ–≤–æ–π —É–∑–µ–ª - –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é\n      (node as any)._y = startY;\n      return startY + nodeSize.height + options.verticalSpacing;\n    }\n    \n    // –°–Ω–∞—á–∞–ª–∞ –Ω–∞–∑–Ω–∞—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –¥–µ—Ç—è–º\n    let childY = startY;\n    const childCenters: number[] = [];\n    \n    for (const child of node.children) {\n      childY = assignYPositions(child, childY);\n      const childSize = getNodeSize(child.id, options);\n      const childCenterY = (child as any)._y + childSize.height / 2;\n      childCenters.push(childCenterY);\n    }\n    \n    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–æ–≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤\n    const avgChildCenterY = childCenters.reduce((sum, y) => sum + y, 0) / childCenters.length;\n    const parentSize = getNodeSize(node.id, options);\n    (node as any)._y = avgChildCenterY - parentSize.height / 2;\n    \n    return childY;\n  }\n  \n  // –ù–∞—Ö–æ–¥–∏–º –∫–æ—Ä–Ω–µ–≤—ã–µ —É–∑–ª—ã (—É—Ä–æ–≤–µ–Ω—å 0)\n  const rootNodes = levels[0] || [];\n  let currentY = options.startY;\n  \n  // –ù–∞–∑–Ω–∞—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞\n  rootNodes.forEach(rootNode => {\n    currentY = assignYPositions(rootNode, currentY);\n    currentY += options.verticalSpacing; // –ü–æ–ª–Ω—ã–π –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–æ—Ä–Ω–µ–≤—ã–º–∏ –¥–µ—Ä–µ–≤—å—è–º–∏\n  });\n  \n  // –°–æ–∑–¥–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏\n  levels.forEach((levelNodes, levelIndex) => {\n    // –í—ã—á–∏—Å–ª—è–µ–º X –ø–æ–∑–∏—Ü–∏—é —Å —É—á–µ—Ç–æ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω—ã —É–∑–ª–æ–≤ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É—Ä–æ–≤–Ω—è—Ö\n    let x = options.startX;\n    for (let i = 0; i < levelIndex; i++) {\n      const prevLevel = levels[i] || [];\n      const prevLevelMaxWidth = prevLevel.length > 0 \n        ? Math.max(...prevLevel.map(n => getNodeSize(n.id, options).width))\n        : 0; // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º—É —Å –ø—É—Å—Ç—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏\n      x += prevLevelMaxWidth + options.horizontalSpacing;\n    }\n    \n    levelNodes.forEach((node) => {\n      const y = (node as any)._y || (options.startY + result.length * options.verticalSpacing);\n      \n      // –£–±–∏—Ä–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n      const { children, visited, level, ...cleanNode } = node;\n      result.push({\n        ...cleanNode,\n        position: { x, y }\n      });\n    });\n  });\n  \n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–π\n  const resultWithCollisionFix = fixCollisions(result, options);\n  \n  return resultWithCollisionFix;\n}\n\n/**\n * –õ–∏–Ω–µ–π–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —É–∑–ª–æ–≤ (fallback)\n */\nfunction arrangeNodesLinear(nodes: LayoutNode[], options: HierarchicalLayoutOptions): Node[] {\n  return nodes.map((node, index) => {\n    // –£–±–∏—Ä–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º\n    const { children, visited, level, ...cleanNode } = node;\n    return {\n      ...cleanNode,\n      position: {\n        x: options.startX + (index % 3) * (options.nodeWidth + options.horizontalSpacing),\n        y: options.startY + Math.floor(index / 3) * options.verticalSpacing\n      }\n    };\n  });\n}\n\n/**\n * –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ VProgulke\n */\nexport function createVProgulkeHierarchicalLayout(nodes: Node[], connections: Connection[]): Node[] {\n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–∑–ª–æ–≤ –¥–ª—è VProgulke –±–æ—Ç–∞\n  const nodeSequence = [\n    'start',\n    'join_request', \n    'decline_response',\n    'gender_selection',\n    'name_input',\n    'age_input', \n    'metro_selection',\n    'interests_categories',\n    'hobby_interests',\n    'relationship_status',\n    'sexual_orientation',\n    'telegram_channel_ask',\n    'telegram_channel_input',\n    'additional_info',\n    'profile_complete',\n    'chat_link',\n    'show_profile'\n  ];\n\n  // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —É–∑–ª–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞\n  const nodeMap = new Map(nodes.map(node => [node.id, node]));\n  \n  // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —É–∑–ª–æ–≤ VProgulke\n  const specialPositions: Record<string, {x: number, y: number}> = {\n    // –£—Ä–æ–≤–µ–Ω—å 1: –°—Ç–∞—Ä—Ç\n    'start': { x: 100, y: 50 },\n    \n    // –£—Ä–æ–≤–µ–Ω—å 2: –í—ã–±–æ—Ä —É—á–∞—Å—Ç–∏—è\n    'join_request': { x: 100, y: 250 },\n    'decline_response': { x: 450, y: 250 },\n    \n    // –£—Ä–æ–≤–µ–Ω—å 3: –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n    'gender_selection': { x: 100, y: 450 },\n    'name_input': { x: 450, y: 450 },\n    'age_input': { x: 800, y: 450 },\n    \n    // –£—Ä–æ–≤–µ–Ω—å 4: –õ–æ–∫–∞—Ü–∏—è –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã\n    'metro_selection': { x: 100, y: 650 },\n    'interests_categories': { x: 450, y: 650 },\n    'hobby_interests': { x: 800, y: 650 },\n    \n    // –£—Ä–æ–≤–µ–Ω—å 5: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n    'relationship_status': { x: 100, y: 850 },\n    'sexual_orientation': { x: 450, y: 850 },\n    'telegram_channel_ask': { x: 800, y: 850 },\n    \n    // –£—Ä–æ–≤–µ–Ω—å 6: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n    'telegram_channel_input': { x: 100, y: 1050 },\n    'additional_info': { x: 450, y: 1050 },\n    \n    // –£—Ä–æ–≤–µ–Ω—å 7: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ\n    'profile_complete': { x: 100, y: 1250 },\n    'chat_link': { x: 450, y: 1250 },\n    'show_profile': { x: 800, y: 1250 }\n  };\n\n  // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∫ —É–∑–ª–∞–º\n  const layoutNodes = nodes.map(node => {\n    const position = specialPositions[node.id] || { \n      x: Math.random() * 800 + 100, \n      y: Math.random() * 600 + 100 \n    };\n    \n    return {\n      ...node,\n      position\n    };\n  });\n\n  return layoutNodes;\n}\n\n/**\n * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —à–∞–±–ª–æ–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–æ–º–ø–æ–Ω–æ–≤–∫—É\n */\nexport function applyTemplateLayout(\n  nodes: Node[], \n  connections: Connection[], \n  templateName?: string, \n  nodeSizes?: Map<string, { width: number; height: number }>\n): Node[] {\n  console.log('üéØ ApplyTemplateLayout called:', templateName, 'nodes:', nodes.length, 'nodeSizes:', !!nodeSizes);\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ —à–∞–±–ª–æ–Ω VProgulke\n  if (templateName?.toLowerCase().includes('vprogulke') || templateName?.toLowerCase().includes('–∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞')) {\n    console.log('üåü Using VProgulke layout');\n    return createVProgulkeHierarchicalLayout(nodes, connections);\n  }\n  \n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –º–æ–±–∏–ª—å–Ω–æ–µ –ª–∏ —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ\n  const isMobile = getIsMobile();\n  \n  // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é –∫–æ–º–ø–æ–Ω–æ–≤–∫—É\n  console.log(isMobile ? 'üì± Using mobile-optimized hierarchical layout' : 'üìè Using desktop hierarchical layout with real sizes');\n  \n  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ\n  const mobileOptions = {\n    levelHeight: 120,\n    nodeWidth: 280,\n    nodeHeight: 100,\n    horizontalSpacing: 60, // –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤\n    verticalSpacing: 50, // –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤\n    startX: 50,\n    startY: 50,\n    nodeSizes\n  };\n  \n  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤\n  const desktopOptions = {\n    levelHeight: 150,\n    nodeWidth: 320,\n    nodeHeight: 120,\n    horizontalSpacing: 100,\n    verticalSpacing: 80,\n    startX: 100,\n    startY: 100,\n    nodeSizes\n  };\n  \n  return createHierarchicalLayout(nodes, connections, isMobile ? mobileOptions : desktopOptions);\n}","size_bytes":16348},"client/src/components/editor/bot-control.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from '@/components/ui/dialog';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { DropdownMenu, DropdownMenuTrigger, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator } from '@/components/ui/dropdown-menu';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { BotToken } from '@shared/schema';\nimport { Play, Square, AlertCircle, CheckCircle, Clock, Trash2, Edit2, Settings, Bot, RefreshCw, Check, X, Plus, MoreHorizontal, Camera, Upload, ExternalLink } from 'lucide-react';\n\ninterface BotControlProps {\n  projectId: number;\n  projectName: string;\n}\n\ninterface BotInstance {\n  id: number;\n  projectId: number;\n  tokenId: number;\n  status: 'running' | 'stopped' | 'error';\n  token: string;\n  processId?: string;\n  startedAt: Date;\n  stoppedAt?: Date;\n  errorMessage?: string;\n}\n\ninterface BotStatusResponse {\n  status: 'running' | 'stopped' | 'error';\n  instance: BotInstance | null;\n}\n\n// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∏–ø BotToken –∏–∑ shared/schema.ts\n\ninterface DefaultTokenResponse {\n  hasDefault: boolean;\n  token: BotToken | null;\n}\n\ninterface BotInfo {\n  id: number;\n  is_bot: boolean;\n  first_name: string;\n  username: string;\n  can_join_groups: boolean;\n  can_read_all_group_messages: boolean;\n  supports_inline_queries: boolean;\n  description?: string;\n  short_description?: string;\n  photoUrl?: string;\n  photo?: {\n    small_file_id: string;\n    small_file_unique_id: string;\n    big_file_id: string;\n    big_file_unique_id: string;\n  };\n}\n\n// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–≤–∞—Ç–∞—Ä–∫–∏ –±–æ—Ç–∞ —Å fallback\nfunction BotAvatar({ \n  photoUrl, \n  botName, \n  size = 40, \n  className = \"\" \n}: { \n  photoUrl?: string | null; \n  botName: string; \n  size?: number; \n  className?: string; \n}) {\n  const [imageError, setImageError] = useState(false);\n  \n  // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –Ω–∞–∑–≤–∞–Ω–∏—è –±–æ—Ç–∞ –¥–ª—è fallback\n  const initials = botName\n    .split(' ')\n    .map(word => word.charAt(0))\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n  \n  const handleImageError = () => {\n    setImageError(true);\n  };\n  \n  // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë\n  const showImage = photoUrl && !imageError;\n  \n  if (showImage) {\n    return (\n      <div \n        className={`relative rounded-lg overflow-hidden flex-shrink-0 ${className}`}\n        style={{ width: size, height: size }}\n      >\n        <img \n          src={photoUrl}\n          alt={`${botName} avatar`}\n          className=\"w-full h-full object-cover\"\n          onError={handleImageError}\n        />\n      </div>\n    );\n  }\n  \n  // Fallback: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã –∏–ª–∏ –∏–∫–æ–Ω–∫—É –±–æ—Ç–∞\n  return (\n    <div \n      className={`bg-gradient-to-br from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 rounded-lg flex items-center justify-center flex-shrink-0 ${className}`}\n      style={{ width: size, height: size }}\n    >\n      {initials ? (\n        <span \n          className=\"text-white font-semibold\"\n          style={{ fontSize: size * 0.4 }}\n        >\n          {initials}\n        </span>\n      ) : (\n        <Bot \n          className=\"text-white\" \n          size={size * 0.5} \n        />\n      )}\n    </div>\n  );\n}\n\n// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –±–æ—Ç–∞\nfunction BotAvatarUploader({\n  botInfo,\n  onAvatarSelected\n}: {\n  botInfo: BotInfo;\n  onAvatarSelected: (file: File) => void;\n}) {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [showInstructions, setShowInstructions] = useState(false);\n  const fileInputRef = useState<HTMLInputElement | null>(null);\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞\n    if (!file.type.startsWith('image/')) {\n      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');\n      return;\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å 5MB)\n    if (file.size > 5 * 1024 * 1024) {\n      alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB');\n      return;\n    }\n\n    setSelectedFile(file);\n    \n    // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      setPreviewUrl(e.target?.result as string);\n    };\n    reader.readAsDataURL(file);\n    \n    onAvatarSelected(file);\n    setShowInstructions(true);\n  };\n\n  const handleDrop = (event: React.DragEvent) => {\n    event.preventDefault();\n    const file = event.dataTransfer.files[0];\n    if (file && file.type.startsWith('image/')) {\n      const fakeEvent = {\n        target: { files: [file] }\n      } as any;\n      handleFileSelect(fakeEvent);\n    }\n  };\n\n  const handleDragOver = (event: React.DragEvent) => {\n    event.preventDefault();\n  };\n\n  return (\n    <>\n      <div className=\"space-y-3\">\n        <Label>–ê–≤–∞—Ç–∞—Ä –±–æ—Ç–∞</Label>\n        <div className=\"flex items-center gap-4\">\n          {/* –¢–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä */}\n          <BotAvatar\n            photoUrl={botInfo.photoUrl}\n            botName={botInfo.first_name}\n            size={64}\n          />\n          \n          {/* –ü—Ä–µ–≤—å—é –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ */}\n          {previewUrl && (\n            <div className=\"relative\">\n              <img\n                src={previewUrl}\n                alt=\"–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä\"\n                className=\"w-16 h-16 rounded-lg object-cover border-2 border-green-500\"\n              />\n              <div className=\"absolute -top-2 -right-2 bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs\">\n                ‚úì\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */}\n        <div\n          className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center hover:border-muted-foreground/50 transition-colors cursor-pointer\"\n          onDrop={handleDrop}\n          onDragOver={handleDragOver}\n          onClick={() => fileInputRef[0]?.click()}\n          data-testid=\"avatar-upload-zone\"\n        >\n          <input\n            type=\"file\"\n            ref={(el) => (fileInputRef[0] = el)}\n            onChange={handleFileSelect}\n            accept=\"image/*\"\n            className=\"hidden\"\n            data-testid=\"avatar-file-input\"\n          />\n          <div className=\"flex flex-col items-center gap-2\">\n            <Camera className=\"h-8 w-8 text-muted-foreground\" />\n            <p className=\"text-sm font-medium\">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä</p>\n            <p className=\"text-xs text-muted-foreground\">\n              –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞\n            </p>\n            <p className=\"text-xs text-muted-foreground\">\n              –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è JPG, PNG (–¥–æ 5MB)\n            </p>\n          </div>\n        </div>\n\n        {selectedFile && (\n          <div className=\"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg p-3\">\n            <div className=\"flex items-center gap-2 text-blue-700 dark:text-blue-300\">\n              <Upload className=\"h-4 w-4\" />\n              <p className=\"text-sm font-medium\">\n                –§–∞–π–ª –≤—ã–±—Ä–∞–Ω: {selectedFile.name}\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* –î–∏–∞–ª–æ–≥ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ */}\n      <Dialog open={showInstructions} onOpenChange={setShowInstructions}>\n        <DialogContent className=\"sm:max-w-lg\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Camera className=\"h-5 w-5\" />\n              –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –±–æ—Ç–∞\n            </DialogTitle>\n            <DialogDescription>\n              –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BotFather –≤ Telegram\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            {previewUrl && (\n              <div className=\"flex justify-center\">\n                <img\n                  src={previewUrl}\n                  alt=\"–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∞\"\n                  className=\"w-24 h-24 rounded-full object-cover border-4 border-blue-500\"\n                />\n              </div>\n            )}\n            \n            <div className=\"space-y-3\">\n              <h4 className=\"font-medium text-sm\">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:</h4>\n              <ol className=\"space-y-2 text-sm text-muted-foreground\">\n                <li className=\"flex gap-2\">\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-medium\">1</span>\n                  <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</span>\n                </li>\n                <li className=\"flex gap-2\">\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-medium\">2</span>\n                  <span>–û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –≤ Telegram</span>\n                </li>\n                <li className=\"flex gap-2\">\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-medium\">3</span>\n                  <span>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code className=\"bg-muted px-1 rounded\">/setuserpic</code></span>\n                </li>\n                <li className=\"flex gap-2\">\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-medium\">4</span>\n                  <span>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞: <strong>@{botInfo.username}</strong></span>\n                </li>\n                <li className=\"flex gap-2\">\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-medium\">5</span>\n                  <span>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ <strong>—Ñ–æ—Ç–æ</strong> (–Ω–µ —Ñ–∞–π–ª)</span>\n                </li>\n              </ol>\n            </div>\n\n            <div className=\"bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3\">\n              <p className=\"text-xs text-yellow-700 dark:text-yellow-300\">\n                <strong>–í–∞–∂–Ω–æ:</strong> –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ —Ñ–æ—Ç–æ, –∞ –Ω–µ –∫–∞–∫ —Ñ–∞–π–ª. \n                –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ.\n              </p>\n            </div>\n            \n            <div className=\"flex gap-2 justify-end\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowInstructions(false)}\n                data-testid=\"button-close-instructions\"\n              >\n                –ü–æ–Ω—è—Ç–Ω–æ\n              </Button>\n              <Button\n                onClick={() => {\n                  window.open('https://t.me/botfather', '_blank');\n                }}\n                className=\"flex items-center gap-2\"\n                data-testid=\"button-open-botfather\"\n              >\n                <ExternalLink className=\"h-4 w-4\" />\n                –û—Ç–∫—Ä—ã—Ç—å BotFather\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n\n// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –±–æ—Ç–∞\nfunction BotProfileEditor({ \n  projectId, \n  botInfo, \n  onProfileUpdated \n}: { \n  projectId: number; \n  botInfo?: BotInfo | null; \n  onProfileUpdated: () => void; \n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [name, setName] = useState('');\n  const [description, setDescription] = useState('');\n  const [shortDescription, setShortDescription] = useState('');\n  const [selectedAvatarFile, setSelectedAvatarFile] = useState<File | null>(null);\n\n  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–≥–¥–∞ botInfo –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è\n  useEffect(() => {\n    if (botInfo) {\n      setName(botInfo.first_name || '');\n      setDescription(botInfo.description || '');\n      setShortDescription(botInfo.short_description || '');\n    }\n  }, [botInfo]);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–º–µ–Ω–∏ –±–æ—Ç–∞\n  const updateNameMutation = useMutation({\n    mutationFn: async (newName: string) => {\n      const response = await apiRequest('PUT', `/api/projects/${projectId}/bot/name`, { name: newName });\n      return response;\n    },\n    onSuccess: async () => {\n      toast({\n        title: \"–£—Å–ø–µ—à–Ω–æ\",\n        description: \"–ò–º—è –±–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π...\",\n      });\n      \n      try {\n        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏\n        await apiRequest('POST', `/api/projects/${projectId}/bot/restart`);\n        \n        toast({\n          title: \"–ì–æ—Ç–æ–≤–æ!\",\n          description: \"–ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º\",\n        });\n      } catch (error) {\n        // –ï—Å–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ\n        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:', error);\n      }\n      \n      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n      \n      // –ñ–¥–µ–º, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –≤ Telegram API –∏ –±–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è\n      setTimeout(async () => {\n        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ, –æ–±—Ö–æ–¥—è –∫—ç—à\n        try {\n          const freshBotInfo = await apiRequest('GET', `/api/projects/${projectId}/bot/info?_t=${Date.now()}`);\n          // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à –≤—Ä—É—á–Ω—É—é —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\n          queryClient.setQueryData([`/api/projects/${projectId}/bot/info`], freshBotInfo);\n        } catch (error) {\n          console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞:', error);\n        }\n        \n        queryClient.refetchQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n        onProfileUpdated();\n      }, 3000);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∏–º—è –±–æ—Ç–∞\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –±–æ—Ç–∞\n  const updateDescriptionMutation = useMutation({\n    mutationFn: async (newDescription: string) => {\n      const response = await apiRequest('PUT', `/api/projects/${projectId}/bot/description`, { description: newDescription });\n      return response;\n    },\n    onSuccess: () => {\n      toast({\n        title: \"–£—Å–ø–µ—à–Ω–æ\",\n        description: \"–û–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ\",\n      });\n      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n      queryClient.refetchQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n      onProfileUpdated();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—Ä–∞—Ç–∫–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –±–æ—Ç–∞\n  const updateShortDescriptionMutation = useMutation({\n    mutationFn: async (newShortDescription: string) => {\n      const response = await apiRequest('PUT', `/api/projects/${projectId}/bot/short-description`, { short_description: newShortDescription });\n      return response;\n    },\n    onSuccess: () => {\n      toast({\n        title: \"–£—Å–ø–µ—à–Ω–æ\",\n        description: \"–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ\",\n      });\n      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n      queryClient.refetchQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n      onProfileUpdated();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSave = async () => {\n    if (!botInfo) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å\n      if (name !== botInfo.first_name) {\n        await updateNameMutation.mutateAsync(name);\n      }\n      if (description !== (botInfo.description || '')) {\n        await updateDescriptionMutation.mutateAsync(description);\n      }\n      if (shortDescription !== (botInfo.short_description || '')) {\n        await updateShortDescriptionMutation.mutateAsync(shortDescription);\n      }\n      \n      setIsOpen(false);\n      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n      queryClient.refetchQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n    } catch (error) {\n      // –û—à–∏–±–∫–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –≤ –º—É—Ç–∞—Ü–∏—è—Ö\n    }\n  };\n\n  const handleCancel = () => {\n    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫ –∏—Å—Ö–æ–¥–Ω—ã–º\n    setName(botInfo?.first_name || '');\n    setDescription(botInfo?.description || '');\n    setShortDescription(botInfo?.short_description || '');\n    setIsOpen(false);\n  };\n\n  const isLoading = updateNameMutation.isPending || updateDescriptionMutation.isPending || updateShortDescriptionMutation.isPending;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          className=\"h-8 w-8 p-0\" \n          data-testid=\"button-edit-bot-profile\"\n          disabled={!botInfo}\n          title={!botInfo ? \"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ...\" : \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –±–æ—Ç–∞\"}\n        >\n          <Edit2 className=\"h-4 w-4\" />\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –±–æ—Ç–∞</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4\">\n          {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞ */}\n          {botInfo && (\n            <BotAvatarUploader\n              botInfo={botInfo}\n              onAvatarSelected={setSelectedAvatarFile}\n            />\n          )}\n          \n          <Separator />\n          \n          <div className=\"space-y-2\">\n            <Label htmlFor=\"bot-name\">–ò–º—è –±–æ—Ç–∞</Label>\n            <Input\n              id=\"bot-name\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              placeholder=\"–í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–æ—Ç–∞\"\n              maxLength={64}\n            />\n            <p className=\"text-sm text-muted-foreground\">\n              –ú–∞–∫—Å–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞. –≠—Ç–æ –∏–º—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ Telegram.\n            </p>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"bot-short-description\">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</Label>\n            <Input\n              id=\"bot-short-description\"\n              value={shortDescription}\n              onChange={(e) => setShortDescription(e.target.value)}\n              placeholder=\"–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞\"\n              maxLength={120}\n            />\n            <p className=\"text-sm text-muted-foreground\">\n              –ú–∞–∫—Å–∏–º—É–º 120 —Å–∏–º–≤–æ–ª–æ–≤. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞—Ö —Å—Å—ã–ª–æ–∫.\n            </p>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"bot-description\">–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</Label>\n            <Textarea\n              id=\"bot-description\"\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              placeholder=\"–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞\"\n              maxLength={512}\n              rows={4}\n            />\n            <p className=\"text-sm text-muted-foreground\">\n              –ú–∞–∫—Å–∏–º—É–º 512 —Å–∏–º–≤–æ–ª–æ–≤. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—É—Å—Ç—ã—Ö —á–∞—Ç–∞—Ö —Å –±–æ—Ç–æ–º.\n            </p>\n          </div>\n\n          <div className=\"flex gap-2 justify-end\">\n            <Button \n              variant=\"outline\" \n              onClick={handleCancel}\n              disabled={isLoading}\n            >\n              <X className=\"h-4 w-4 mr-2\" />\n              –û—Ç–º–µ–Ω–∞\n            </Button>\n            <Button \n              onClick={handleSave}\n              disabled={isLoading}\n            >\n              <Check className=\"h-4 w-4 mr-2\" />\n              {isLoading ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è –±–æ—Ç–∞\nfunction BotProfile({ \n  projectId,\n  botInfo, \n  onRefresh, \n  isRefreshing,\n  fallbackName = '–ë–æ—Ç'\n}: { \n  projectId: number;\n  botInfo?: BotInfo | null; \n  onRefresh: () => void; \n  isRefreshing: boolean; \n  fallbackName?: string;\n}) {\n  if (!botInfo) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <BotAvatar \n                botName={fallbackName} \n                size={48}\n              />\n              <div>\n                <p className=\"text-sm text-muted-foreground\">\n                  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞\n                </p>\n                <p className=\"text-xs text-muted-foreground\">\n                  –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö\n                </p>\n              </div>\n            </div>\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              onClick={onRefresh}\n              disabled={isRefreshing}\n              className=\"flex items-center gap-2\"\n            >\n              <RefreshCw className={`w-4 h-4 ${isRefreshing ? 'animate-spin' : ''}`} />\n              –û–±–Ω–æ–≤–∏—Ç—å\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between mb-4\">\n          <div className=\"flex items-center gap-4\">\n            <BotAvatar \n              photoUrl={botInfo.photoUrl} \n              botName={botInfo.first_name} \n              size={56}\n            />\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-lg leading-tight mb-1\">{botInfo.first_name}</h3>\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"default\" className=\"text-xs\">\n                  @{botInfo.username}\n                </Badge>\n                {botInfo.is_bot && (\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    –ë–æ—Ç\n                  </Badge>\n                )}\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <BotProfileEditor \n              projectId={projectId} \n              botInfo={botInfo} \n              onProfileUpdated={onRefresh} \n            />\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              onClick={onRefresh}\n              disabled={isRefreshing}\n              title=\"–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ\"\n            >\n              <RefreshCw className={`w-4 h-4 ${isRefreshing ? 'animate-spin' : ''}`} />\n            </Button>\n          </div>\n        </div>\n        \n        <div className=\"space-y-3\">\n          {/* –û–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞ */}\n          {(botInfo.description || botInfo.short_description) && (\n            <div className=\"space-y-1\">\n              <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                {botInfo.description || botInfo.short_description}\n              </p>\n            </div>\n          )}\n          \n          {/* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞ */}\n          <div className=\"flex flex-wrap gap-2\">\n            {botInfo.can_join_groups && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                –ú–æ–∂–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–∞–º\n              </Badge>\n            )}\n            {botInfo.can_read_all_group_messages && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                –ß–∏—Ç–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n              </Badge>\n            )}\n            {botInfo.supports_inline_queries && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç inline –∑–∞–ø—Ä–æ—Å—ã\n              </Badge>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport function BotControl({ projectId, projectName }: BotControlProps) {\n  const [showAddBot, setShowAddBot] = useState(false);\n  const [newBotToken, setNewBotToken] = useState('');\n  const [isParsingBot, setIsParsingBot] = useState(false);\n  const [editingToken, setEditingToken] = useState<BotToken | null>(null);\n  const [editName, setEditName] = useState('');\n  const [editDescription, setEditDescription] = useState('');\n  \n  // Inline editing states\n  const [editingField, setEditingField] = useState<{tokenId: number, field: string} | null>(null);\n  const [editValue, setEditValue] = useState('');\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Mutation for updating bot information via Telegram API\n  const updateBotInfoMutation = useMutation({\n    mutationFn: async ({ tokenId, field, value }: { tokenId: number, field: string, value: string }) => {\n      const response = await apiRequest('PUT', `/api/projects/${projectId}/tokens/${tokenId}/bot-info`, { field, value });\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/tokens`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/info`] });\n      setEditingField(null);\n      toast({ title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', variant: 'default' });\n    },\n    onError: (error: any) => {\n      toast({ title: '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', description: error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ', variant: 'destructive' });\n    }\n  });\n\n  // Handle inline editing\n  const handleStartEdit = (tokenId: number, field: string, currentValue: string) => {\n    setEditingField({ tokenId, field });\n    setEditValue(currentValue || '');\n  };\n\n  const handleSaveEdit = () => {\n    if (!editingField) return;\n    \n    const trimmedValue = editValue.trim();\n    if (trimmedValue) {\n      updateBotInfoMutation.mutate({\n        tokenId: editingField.tokenId,\n        field: editingField.field,\n        value: trimmedValue\n      });\n    } else {\n      setEditingField(null);\n    }\n  };\n\n  const handleCancelEdit = () => {\n    setEditingField(null);\n    setEditValue('');\n  };\n\n  // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞\n  const { data: botStatus, isLoading: isLoadingStatus } = useQuery<BotStatusResponse>({\n    queryKey: [`/api/projects/${projectId}/bot`],\n    refetchInterval: 10000, // –£–º–µ–Ω—å—à–∏–ª–∏ —Å 1 —Å–µ–∫—É–Ω–¥—ã –¥–æ 10 —Å–µ–∫—É–Ω–¥\n    refetchIntervalInBackground: false, // –ù–µ –æ–ø—Ä–∞—à–∏–≤–∞–µ–º –≤ —Ñ–æ–Ω–µ\n    staleTime: 5000, // –°—á–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–∏–º–∏ 5 —Å–µ–∫—É–Ω–¥\n  });\n\n  // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞ (–±–æ—Ç—ã)\n  const { data: tokens = [], isLoading, refetch } = useQuery<BotToken[]>({\n    queryKey: [`/api/projects/${projectId}/tokens`],\n  });\n\n  // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n  const { data: defaultTokenData } = useQuery<DefaultTokenResponse>({\n    queryKey: [`/api/projects/${projectId}/tokens/default`],\n  });\n\n  // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ (getMe)\n  const { data: botInfo, refetch: refetchBotInfo } = useQuery<BotInfo>({\n    queryKey: [`/api/projects/${projectId}/bot/info`],\n    enabled: defaultTokenData?.hasDefault || tokens.length > 0,\n    refetchInterval: botStatus?.status === 'running' ? 60000 : false, // –£–≤–µ–ª–∏—á–∏–ª–∏ —Å 30 —Å–µ–∫—É–Ω–¥ –¥–æ 1 –º–∏–Ω—É—Ç—ã\n    refetchIntervalInBackground: false, // –ù–µ –æ–ø—Ä–∞—à–∏–≤–∞–µ–º –≤ —Ñ–æ–Ω–µ\n    staleTime: 30000, // –°—á–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–∏–º–∏ 30 —Å–µ–∫—É–Ω–¥\n  });\n\n  const isRunning = botStatus?.status === 'running';\n  const isError = botStatus?.status === 'error';\n  const isStopped = botStatus?.status === 'stopped' || !botStatus?.instance;\n\n  // –ü–∞—Ä—Å–∏–Ω–≥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ –ø–æ —Ç–æ–∫–µ–Ω—É\n  const parseBotInfoMutation = useMutation({\n    mutationFn: async (token: string) => {\n      setIsParsingBot(true);\n      try {\n        return await apiRequest('POST', `/api/projects/${projectId}/tokens/parse`, { token });\n      } finally {\n        setIsParsingBot(false);\n      }\n    },\n    onSuccess: (botInfo) => {\n      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º —Ç–æ–∫–µ–Ω —Å –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π\n      createBotMutation.mutate({\n        name: botInfo.botFirstName ? `${botInfo.botFirstName}${botInfo.botUsername ? ` (@${botInfo.botUsername})` : ''}` : `@${botInfo.botUsername}`,\n        token: newBotToken.trim(),\n        description: botInfo.botShortDescription,\n        isDefault: tokens.length === 0 ? 1 : 0, // –ü–µ—Ä–≤—ã–π —Ç–æ–∫–µ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n        isActive: 1,\n        // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å—é —Å–ø–∞—Ä—Å–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ\n        ...botInfo\n      });\n    },\n    onError: (error: any) => {\n      setIsParsingBot(false);\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ', \n        description: error.message || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞/—Ç–æ–∫–µ–Ω–∞\n  const createBotMutation = useMutation({\n    mutationFn: async (botData: { \n      name: string; \n      token: string; \n      description?: string;\n      isDefault: number; \n      isActive: number;\n      botFirstName?: string;\n      botUsername?: string;\n      botDescription?: string;\n      botShortDescription?: string;\n      botPhotoUrl?: string;\n      botCanJoinGroups?: number;\n      botCanReadAllGroupMessages?: number;\n      botSupportsInlineQueries?: number;\n      botHasMainWebApp?: number;\n    }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/tokens`, { \n        ...botData, \n        projectId \n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/tokens`] });\n      toast({ \n        title: '–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω',\n        description: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–µ–Ω–∞ –∏–∑ Telegram'\n      });\n      setShowAddBot(false);\n      setNewBotToken('');\n    },\n    onError: (error: any) => {\n      toast({ title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–æ—Ç–∞', description: error.message, variant: 'destructive' });\n    }\n  });\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ –±–æ—Ç–∞/—Ç–æ–∫–µ–Ω–∞\n  const deleteBotMutation = useMutation({\n    mutationFn: async (tokenId: number) => {\n      return apiRequest('DELETE', `/api/projects/${projectId}/tokens/${tokenId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/tokens`] });\n      toast({ title: '–ë–æ—Ç —É–¥–∞–ª–µ–Ω' });\n    },\n    onError: (error: any) => {\n      toast({ title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–æ—Ç–∞', description: error.message, variant: 'destructive' });\n    }\n  });\n\n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–∫–µ–Ω–µ\n  const updateTokenMutation = useMutation({\n    mutationFn: async ({ tokenId, data }: { tokenId: number; data: { name?: string; description?: string } }) => {\n      return apiRequest('PUT', `/api/projects/${projectId}/tokens/${tokenId}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/tokens`] });\n      toast({ title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞' });\n      setEditingToken(null);\n    },\n    onError: (error: any) => {\n      toast({ title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', description: error.message, variant: 'destructive' });\n    }\n  });\n\n  // –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞\n  const startBotMutation = useMutation({\n    mutationFn: async (tokenId: number) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/start`, { tokenId });\n    },\n    onSuccess: () => {\n      toast({ title: \"–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω\", description: \"–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.\" });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot`] });\n    },\n    onError: (error: any) => {\n      toast({ title: \"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞\", description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞.\", variant: \"destructive\" });\n    },\n  });\n\n  // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞\n  const stopBotMutation = useMutation({\n    mutationFn: async (tokenId: number) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/stop`, { tokenId });\n    },\n    onSuccess: () => {\n      toast({ title: \"–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω\", description: \"–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.\" });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot`] });\n    },\n    onError: (error: any) => {\n      toast({ title: \"–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏\", description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞.\", variant: \"destructive\" });\n    },\n  });\n\n  const handleAddBot = () => {\n    if (!newBotToken.trim()) {\n      toast({\n        title: \"–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω\",\n        description: \"–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ, –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ–º —Ç–æ–∫–µ–Ω\n    parseBotInfoMutation.mutate(newBotToken.trim());\n  };\n\n  const getStatusBadge = (token: BotToken) => {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –∑–∞–ø—É—â–µ–Ω\n    const isActiveBot = botStatus?.instance && \n                       isRunning && \n                       botStatus.instance.tokenId === token.id;\n    \n    if (isActiveBot) {\n      return (\n        <Badge variant=\"default\" className=\"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border-green-200 dark:border-green-800\">\n          <div className=\"flex items-center gap-1\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n            –ê–∫—Ç–∏–≤–Ω—ã–π\n          </div>\n        </Badge>\n      );\n    }\n    \n    if (token.isDefault) {\n      return (\n        <Badge variant=\"secondary\">\n          –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n        </Badge>\n      );\n    }\n    \n    return (\n      <Badge variant=\"outline\">\n        –ì–æ—Ç–æ–≤\n      </Badge>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n            <Bot className=\"w-6 h-6\" />\n            –ë–æ—Ç—ã\n          </h2>\n          <p className=\"text-muted-foreground\">\n            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞ {projectName}\n          </p>\n        </div>\n        <Button onClick={() => setShowAddBot(true)} className=\"flex items-center gap-2\">\n          <Plus className=\"w-4 h-4\" />\n          –ü–æ–¥–∫–ª—é—á–∏—Ç—å –±–æ—Ç\n        </Button>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid gap-4\">\n          {[1, 2].map((i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"w-12 h-12 bg-muted rounded-lg\" />\n                  <div className=\"space-y-2 flex-1\">\n                    <div className=\"h-4 bg-muted rounded w-1/4\" />\n                    <div className=\"h-3 bg-muted rounded w-1/2\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : tokens.length === 0 ? (\n        <Card className=\"border-dashed\">\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Bot className=\"w-12 h-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤</h3>\n            <p className=\"text-muted-foreground text-center mb-4\">\n              –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –±–æ—Ç–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ Telegram-–±–æ—Ç–æ–≤\n            </p>\n            <Button onClick={() => setShowAddBot(true)} className=\"flex items-center gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              –ü–æ–¥–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4\">\n          {tokens.map((token) => (\n            <Card key={token.id} className=\"transition-all hover:shadow-md\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-4\">\n                    <BotAvatar \n                      botName={token.botFirstName || token.name} \n                      photoUrl={token.botPhotoUrl}\n                      size={48}\n                    />\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        {editingField?.tokenId === token.id && editingField?.field === 'name' ? (\n                          <Input\n                            value={editValue}\n                            onChange={(e) => setEditValue(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === 'Enter') {\n                                handleSaveEdit();\n                              } else if (e.key === 'Escape') {\n                                handleCancelEdit();\n                              }\n                            }}\n                            onBlur={handleSaveEdit}\n                            autoFocus\n                            className=\"font-semibold text-lg leading-tight h-auto px-2 py-1\"\n                            data-testid=\"input-bot-name-edit\"\n                          />\n                        ) : (\n                          <h3 \n                            className=\"font-semibold text-lg leading-tight cursor-pointer hover:bg-muted/50 px-2 py-1 rounded transition-colors\"\n                            onDoubleClick={() => handleStartEdit(token.id, 'name', token.botFirstName || token.name)}\n                            title=\"–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\"\n                            data-testid=\"text-bot-name\"\n                          >\n                            {token.botFirstName || token.name}\n                          </h3>\n                        )}\n                        {token.botUsername && (\n                          <span className=\"text-sm text-muted-foreground\">@{token.botUsername}</span>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        {getStatusBadge(token)}\n                      </div>\n                      {(token.botDescription || token.description) && (\n                        editingField?.tokenId === token.id && editingField?.field === 'description' ? (\n                          <Textarea\n                            value={editValue}\n                            onChange={(e) => setEditValue(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === 'Enter' && !e.shiftKey) {\n                                e.preventDefault();\n                                handleSaveEdit();\n                              } else if (e.key === 'Escape') {\n                                handleCancelEdit();\n                              }\n                            }}\n                            onBlur={handleSaveEdit}\n                            autoFocus\n                            className=\"text-sm resize-none min-h-[40px]\"\n                            rows={2}\n                            data-testid=\"textarea-bot-description-edit\"\n                          />\n                        ) : (\n                          <p \n                            className=\"text-sm text-muted-foreground mb-1 cursor-pointer hover:bg-muted/50 px-2 py-1 rounded transition-colors\"\n                            onDoubleClick={() => handleStartEdit(token.id, 'description', token.botDescription || token.description || '')}\n                            title=\"–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\"\n                            data-testid=\"text-bot-description\"\n                          >\n                            {token.botDescription || token.description}\n                          </p>\n                        )\n                      )}\n                      {token.botShortDescription && token.botShortDescription !== token.botDescription && (\n                        editingField?.tokenId === token.id && editingField?.field === 'shortDescription' ? (\n                          <Input\n                            value={editValue}\n                            onChange={(e) => setEditValue(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === 'Enter') {\n                                handleSaveEdit();\n                              } else if (e.key === 'Escape') {\n                                handleCancelEdit();\n                              }\n                            }}\n                            onBlur={handleSaveEdit}\n                            autoFocus\n                            className=\"text-xs h-auto px-2 py-1 mb-1\"\n                            data-testid=\"input-bot-short-description-edit\"\n                          />\n                        ) : (\n                          <p \n                            className=\"text-xs text-muted-foreground mb-1 cursor-pointer hover:bg-muted/50 px-2 py-1 rounded transition-colors\"\n                            onDoubleClick={() => handleStartEdit(token.id, 'shortDescription', token.botShortDescription || '')}\n                            title=\"–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\"\n                            data-testid=\"text-bot-short-description\"\n                          >\n                            {token.botShortDescription}\n                          </p>\n                        )\n                      )}\n                      <p className=\"text-xs text-muted-foreground\">\n                        –î–æ–±–∞–≤–ª–µ–Ω: {new Date(token.createdAt!).toLocaleDateString('ru-RU')}\n                        {token.lastUsedAt && (\n                          <> ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫: {new Date(token.lastUsedAt).toLocaleDateString('ru-RU')}</>\n                        )}\n                      </p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-2\">\n                    {/* –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –±–æ—Ç–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞ */}\n                    <BotProfileEditor \n                      projectId={projectId} \n                      botInfo={botInfo} \n                      onProfileUpdated={refetchBotInfo} \n                    />\n                    \n                    {/* –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ */}\n                    {(() => {\n                      const isThisTokenRunning = botStatus?.instance && \n                                                isRunning && \n                                                botStatus.instance.tokenId === token.id;\n                      \n                      if (!isThisTokenRunning) {\n                        return (\n                          <Button\n                            size=\"sm\"\n                            onClick={() => startBotMutation.mutate(token.id)}\n                            disabled={startBotMutation.isPending}\n                            className=\"flex items-center gap-2\"\n                          >\n                            <Play className=\"w-4 h-4\" />\n                            {startBotMutation.isPending ? '–ó–∞–ø—É—Å–∫...' : '–ó–∞–ø—É—Å—Ç–∏—Ç—å'}\n                          </Button>\n                        );\n                      } else {\n                        return (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => stopBotMutation.mutate(token.id)}\n                            disabled={stopBotMutation.isPending}\n                            className=\"flex items-center gap-2\"\n                          >\n                            <Square className=\"w-4 h-4\" />\n                            {stopBotMutation.isPending ? '–û—Å—Ç–∞–Ω–æ–≤–∫–∞...' : '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å'}\n                          </Button>\n                        );\n                      }\n                    })()}\n                    \n                    <DropdownMenu>\n                      <DropdownMenuTrigger asChild>\n                        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\" data-testid=\"button-bot-menu\">\n                          <MoreHorizontal className=\"h-4 w-4\" />\n                        </Button>\n                      </DropdownMenuTrigger>\n                      <DropdownMenuContent align=\"end\">\n                        <DropdownMenuItem \n                          onClick={() => deleteBotMutation.mutate(token.id)}\n                          className=\"text-red-600\"\n                        >\n                          <Trash2 className=\"mr-2 h-4 w-4\" />\n                          –£–¥–∞–ª–∏—Ç—å\n                        </DropdownMenuItem>\n                      </DropdownMenuContent>\n                    </DropdownMenu>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* Add Bot Dialog */}\n      <Dialog open={showAddBot} onOpenChange={setShowAddBot}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>–ü–æ–¥–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞</DialogTitle>\n            <DialogDescription>\n              –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–∫–µ–Ω –æ—Ç @BotFather\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"bot-token\">–¢–æ–∫–µ–Ω –±–æ—Ç–∞</Label>\n              <Input\n                id=\"bot-token\"\n                type=\"password\"\n                placeholder=\"–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather\"\n                value={newBotToken}\n                onChange={(e) => setNewBotToken(e.target.value)}\n                disabled={isParsingBot || createBotMutation.isPending}\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather –≤ Telegram: /newbot\n              </p>\n              {isParsingBot && (\n                <p className=\"text-xs text-blue-600 dark:text-blue-400\">\n                  –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ...\n                </p>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"flex gap-2 justify-end\">\n            <Button variant=\"outline\" onClick={() => setShowAddBot(false)}>\n              –û—Ç–º–µ–Ω–∞\n            </Button>\n            <Button \n              onClick={handleAddBot}\n              disabled={isParsingBot || createBotMutation.isPending || !newBotToken.trim()}\n            >\n              {isParsingBot ? '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞...' : createBotMutation.isPending ? '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...' : '–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞'}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Bot Token Dialog */}\n      <Dialog open={!!editingToken} onOpenChange={() => setEditingToken(null)}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω</DialogTitle>\n            <DialogDescription>\n              –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-bot-name\">–ò–º—è —Ç–æ–∫–µ–Ω–∞</Label>\n              <Input\n                id=\"edit-bot-name\"\n                placeholder=\"–ò–º—è –¥–ª—è —Ç–æ–∫–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç)\"\n                value={editName}\n                onChange={(e) => setEditName(e.target.value)}\n                disabled={updateTokenMutation.isPending}\n                data-testid=\"input-edit-bot-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-bot-description\">–û–ø–∏—Å–∞–Ω–∏–µ</Label>\n              <Textarea\n                id=\"edit-bot-description\"\n                placeholder=\"–û–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)\"\n                value={editDescription}\n                onChange={(e) => setEditDescription(e.target.value)}\n                disabled={updateTokenMutation.isPending}\n                rows={3}\n                data-testid=\"textarea-edit-bot-description\"\n              />\n            </div>\n          </div>\n          \n          <div className=\"flex gap-2 justify-end\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setEditingToken(null)}\n              disabled={updateTokenMutation.isPending}\n              data-testid=\"button-cancel-edit\"\n            >\n              –û—Ç–º–µ–Ω–∞\n            </Button>\n            <Button \n              onClick={() => {\n                if (editingToken) {\n                  updateTokenMutation.mutate({\n                    tokenId: editingToken.id,\n                    data: {\n                      name: editName.trim() || editingToken.name,\n                      description: editDescription.trim() || undefined\n                    }\n                  });\n                }\n              }}\n              disabled={updateTokenMutation.isPending || !editName.trim()}\n              data-testid=\"button-save-edit\"\n            >\n              {updateTokenMutation.isPending ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":53042},"client/src/components/editor/canvas.tsx":{"content":"import { useRef, useCallback, useState, useEffect } from 'react';\nimport { CanvasNode } from '@/components/ui/canvas-node';\nimport { ConnectionsLayer } from '@/components/ui/connections-layer';\nimport { TemporaryConnection } from '@/components/ui/temporary-connection';\nimport { ConnectionSuggestions } from '@/components/ui/connection-suggestions';\nimport { AutoConnectionPanel } from '@/components/ui/auto-connection-panel';\nimport { CanvasSheets } from '@/components/ui/canvas-sheets';\nimport { Button } from '@/components/ui/button';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Navigation, Sidebar, Sliders, Monitor, Menu } from 'lucide-react';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\nimport { Node, ComponentDefinition, Connection } from '@/types/bot';\nimport { BotDataWithSheets, CanvasSheet } from '@shared/schema';\nimport { generateAutoConnections } from '@/utils/auto-connection';\nimport { ConnectionManager } from '@/utils/connection-manager';\nimport { SheetsManager } from '@/utils/sheets-manager';\nimport { nanoid } from 'nanoid';\n\ninterface CanvasProps {\n  // –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∏—Å—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)\n  botData?: BotDataWithSheets;\n  onBotDataUpdate?: (data: BotDataWithSheets) => void;\n  \n  // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–ø—Å—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n  nodes: Node[];\n  connections: Connection[];\n  selectedNodeId: string | null;\n  selectedConnectionId?: string;\n  onNodeSelect: (nodeId: string) => void;\n  onNodeAdd: (node: Node) => void;\n  onNodeDelete: (nodeId: string) => void;\n  onNodeDuplicate?: (nodeId: string) => void;\n  onNodeMove: (nodeId: string, position: { x: number; y: number }) => void;\n  onConnectionSelect?: (connectionId: string) => void;\n  onConnectionDelete?: (connectionId: string) => void;\n  onConnectionAdd?: (connection: Connection) => void;\n  onNodesUpdate?: (nodes: Node[]) => void;\n  onUndo?: () => void;\n  onRedo?: () => void;\n  canUndo?: boolean;\n  canRedo?: boolean;\n  onSave?: () => void;\n  isSaving?: boolean;\n  onCopyToClipboard?: (nodeIds: string[]) => void;\n  onPasteFromClipboard?: () => void;\n  hasClipboardData?: boolean;\n  \n  // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —É–∑–ª–æ–≤\n  isNodeBeingDragged?: boolean;\n  setIsNodeBeingDragged?: (isDragging: boolean) => void;\n  \n  // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º\n  onToggleHeader?: () => void;\n  onToggleSidebar?: () => void;\n  onToggleProperties?: () => void;\n  onToggleCanvas?: () => void;\n  headerVisible?: boolean;\n  sidebarVisible?: boolean;\n  propertiesVisible?: boolean;\n  canvasVisible?: boolean;\n  \n  // –ú–æ–±–∏–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\n  onOpenMobileSidebar?: () => void;\n  onOpenMobileProperties?: () => void;\n  \n  // –ü–µ—Ä–µ–¥–∞—á–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —É–∑–ª–æ–≤ –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–≥–æ –º–∞–∫–µ—Ç–∞\n  onNodeSizesChange?: (nodeSizes: Map<string, { width: number; height: number }>) => void;\n}\n\nexport function Canvas({ \n  botData,\n  onBotDataUpdate,\n  nodes, \n  connections,\n  selectedNodeId,\n  selectedConnectionId,\n  onNodeSelect, \n  onNodeAdd, \n  onNodeDelete,\n  onNodeDuplicate,\n  onNodeMove,\n  onConnectionSelect,\n  onConnectionDelete,\n  onConnectionAdd,\n  onNodesUpdate,\n  onUndo,\n  onRedo,\n  canUndo,\n  canRedo,\n  onSave,\n  isSaving,\n  onCopyToClipboard,\n  onPasteFromClipboard,\n  hasClipboardData,\n  isNodeBeingDragged,\n  setIsNodeBeingDragged,\n  onToggleHeader,\n  onToggleSidebar,\n  onToggleProperties,\n  onToggleCanvas,\n  headerVisible,\n  sidebarVisible,\n  propertiesVisible,\n  canvasVisible,\n  onOpenMobileSidebar,\n  onOpenMobileProperties,\n  onNodeSizesChange\n}: CanvasProps) {\n  const canvasRef = useRef<HTMLDivElement>(null);\n  const isMobile = useIsMobile();\n  const [isDragOver, setIsDragOver] = useState(false);\n  const [connectionStart, setConnectionStart] = useState<{\n    nodeId: string;\n    handle: 'source' | 'target';\n  } | null>(null);\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const [autoButtonCreation, setAutoButtonCreation] = useState(true);\n  const [showAutoPanel, setShowAutoPanel] = useState(false);\n  const [zoom, setZoom] = useState(100);\n  const [pan, setPan] = useState({ x: 0, y: 0 });\n  const [isPanning, setIsPanning] = useState(false);\n  const [panStart, setPanStart] = useState({ x: 0, y: 0 });\n  const [lastPanPosition, setLastPanPosition] = useState({ x: 0, y: 0 });\n  \n  // Touch —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n  const [isTouchPanning, setIsTouchPanning] = useState(false);\n  const [touchStart, setTouchStart] = useState({ x: 0, y: 0 });\n  const [lastTouchPosition, setLastTouchPosition] = useState({ x: 0, y: 0 });\n  const [lastPinchDistance, setLastPinchDistance] = useState(0);\n  const [initialPinchZoom, setInitialPinchZoom] = useState(100);\n  \n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —É–∑–ª–æ–≤\n  const [nodeSizes, setNodeSizes] = useState<Map<string, { width: number; height: number }>>(new Map());\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ —É–∑–ª–æ–≤\n  const handleNodeSizeChange = useCallback((nodeId: string, size: { width: number; height: number }) => {\n    setNodeSizes(prev => {\n      const newMap = new Map(prev);\n      newMap.set(nodeId, size);\n      return newMap;\n    });\n  }, []);\n\n  // –û—Ç–¥–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç\n  useEffect(() => {\n    if (onNodeSizesChange && nodeSizes.size > 0) {\n      onNodeSizesChange(nodeSizes);\n    }\n  }, [nodeSizes, onNodeSizesChange]);\n\n  // –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π layout –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ nodeSizes - –æ–Ω –±—ã–ª —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º\n  // –ê–≤—Ç–æ–∏–µ—Ä–∞—Ä—Ö–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —à–∞–±–ª–æ–Ω–æ–≤, –∞ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ (—Å fallback'–æ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)\n  const activeSheet = botData ? SheetsManager.getActiveSheet(botData) : null;\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–∏—Å—Ç–∞–º–∏\n  const handleSheetSelect = useCallback((sheetId: string) => {\n    if (!botData || !onBotDataUpdate) return;\n    \n    // –í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –≤ –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç\n    let dataWithCurrentSheetSaved = botData;\n    if (botData.activeSheetId) {\n      dataWithCurrentSheetSaved = SheetsManager.updateSheetData(\n        botData, \n        botData.activeSheetId, \n        nodes, \n        connections\n      );\n    }\n    \n    // –ó–∞—Ç–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—ã–π –ª–∏—Å—Ç\n    const updatedData = SheetsManager.setActiveSheet(dataWithCurrentSheetSaved, sheetId);\n    onBotDataUpdate(updatedData);\n  }, [botData, onBotDataUpdate, nodes, connections]);\n\n  const handleSheetAdd = useCallback((name: string) => {\n    if (!botData || !onBotDataUpdate) return;\n    \n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞\n    let dataWithCurrentSheetSaved = botData;\n    if (botData.activeSheetId) {\n      dataWithCurrentSheetSaved = SheetsManager.updateSheetData(\n        botData, \n        botData.activeSheetId, \n        nodes, \n        connections\n      );\n    }\n    \n    const updatedData = SheetsManager.addSheet(dataWithCurrentSheetSaved, name);\n    onBotDataUpdate(updatedData);\n  }, [botData, onBotDataUpdate, nodes, connections]);\n\n  const handleSheetDelete = useCallback((sheetId: string) => {\n    if (!botData || !onBotDataUpdate) return;\n    try {\n      const updatedData = SheetsManager.deleteSheet(botData, sheetId);\n      onBotDataUpdate(updatedData);\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞:', error);\n    }\n  }, [botData, onBotDataUpdate]);\n\n  const handleSheetRename = useCallback((sheetId: string, newName: string) => {\n    if (!botData || !onBotDataUpdate) return;\n    const updatedData = SheetsManager.renameSheet(botData, sheetId, newName);\n    onBotDataUpdate(updatedData);\n  }, [botData, onBotDataUpdate]);\n\n  const handleSheetDuplicate = useCallback((sheetId: string) => {\n    if (!botData || !onBotDataUpdate) return;\n    try {\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º\n      let dataWithCurrentSheetSaved = botData;\n      if (botData.activeSheetId) {\n        dataWithCurrentSheetSaved = SheetsManager.updateSheetData(\n          botData, \n          botData.activeSheetId, \n          nodes, \n          connections\n        );\n      }\n      \n      const updatedData = SheetsManager.duplicateSheetInProject(dataWithCurrentSheetSaved, sheetId);\n      onBotDataUpdate(updatedData);\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞:', error);\n    }\n  }, [botData, onBotDataUpdate, nodes, connections]);\n\n  // Zoom utility functions\n  const zoomIn = useCallback(() => {\n    setZoom(prev => Math.min(prev + 25, 200));\n  }, []);\n\n  const zoomOut = useCallback(() => {\n    setZoom(prev => Math.max(prev - 25, 1));\n  }, []);\n\n  const resetZoom = useCallback(() => {\n    setZoom(100);\n    setPan({ x: 0, y: 0 });\n  }, []);\n\n  const setZoomLevel = useCallback((level: number) => {\n    setZoom(Math.max(Math.min(level, 200), 1));\n  }, []);\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ canvas\n  const getCenterPosition = useCallback(() => {\n    if (canvasRef.current) {\n      const scrollContainer = canvasRef.current.parentElement;\n      const containerWidth = scrollContainer ? scrollContainer.clientWidth - 64 : window.innerWidth - 64;\n      const containerHeight = scrollContainer ? scrollContainer.clientHeight - 64 : window.innerHeight - 64;\n      \n      // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö canvas (—Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ pan –∏ zoom)\n      const centerX = (containerWidth / 2 - pan.x) / (zoom / 100);\n      const centerY = (containerHeight / 2 - pan.y) / (zoom / 100);\n      \n      const position = { \n        x: Math.max(50, centerX - 160), // -160 —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —É–∑–µ–ª (–ø–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω—ã —É–∑–ª–∞)\n        y: Math.max(50, centerY - 50)   // -50 —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —É–∑–µ–ª (–ø–æ–ª–æ–≤–∏–Ω–∞ –≤—ã—Å–æ—Ç—ã —É–∑–ª–∞)\n      };\n      \n      console.log('getCenterPosition:', { containerWidth, containerHeight, pan, zoom, centerX, centerY, position });\n      return position;\n    }\n    console.log('getCenterPosition: using fallback');\n    return { x: 400, y: 300 }; // fallback –µ—Å–ª–∏ canvas –Ω–µ –Ω–∞–π–¥–µ–Ω\n  }, [pan, zoom]);\n\n  const fitToContent = useCallback(() => {\n    if (nodes.length === 0) return;\n    \n    // –í—ã—á–∏—Å–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –≤—Å–µ—Ö —É–∑–ª–æ–≤\n    const nodeBounds = nodes.reduce((bounds, node) => {\n      const left = node.position.x;\n      const right = node.position.x + 320; // Approximate node width\n      const top = node.position.y;\n      const bottom = node.position.y + 100; // Approximate node height\n      \n      return {\n        left: Math.min(bounds.left, left),\n        right: Math.max(bounds.right, right),\n        top: Math.min(bounds.top, top),\n        bottom: Math.max(bounds.bottom, bottom)\n      };\n    }, { left: Infinity, right: -Infinity, top: Infinity, bottom: -Infinity });\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü\n    if (!isFinite(nodeBounds.left) || !isFinite(nodeBounds.right) || \n        !isFinite(nodeBounds.top) || !isFinite(nodeBounds.bottom)) {\n      return;\n    }\n    \n    const contentWidth = nodeBounds.right - nodeBounds.left;\n    const contentHeight = nodeBounds.bottom - nodeBounds.top;\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞\n    if (contentWidth <= 0 || contentHeight <= 0) {\n      return;\n    }\n    \n    if (canvasRef.current) {\n      // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å overflow)\n      const scrollContainer = canvasRef.current.parentElement;\n      const containerWidth = scrollContainer ? scrollContainer.clientWidth - 64 : window.innerWidth - 64; // -64 –¥–ª—è padding\n      const containerHeight = scrollContainer ? scrollContainer.clientHeight - 64 : window.innerHeight - 64;\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞\n      if (containerWidth <= 0 || containerHeight <= 0) {\n        return;\n      }\n      \n      // –í—ã—á–∏—Å–ª—è–µ–º –º–∞—Å—à—Ç–∞–± —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏\n      const scaleX = (containerWidth * 0.8) / contentWidth;\n      const scaleY = (containerHeight * 0.8) / contentHeight;\n      const scale = Math.min(scaleX, scaleY, 1.5); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º max zoom –¥–æ 150%\n      \n      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º zoom —Ä–∞–∑—É–º–Ω—ã–º–∏ –ø—Ä–µ–¥–µ–ª–∞–º–∏\n      const newZoom = Math.max(Math.min(scale * 100, 150), 50); // min 50%, max 150%\n      \n      // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞\n      const centerX = (nodeBounds.left + nodeBounds.right) / 2;\n      const centerY = (nodeBounds.top + nodeBounds.bottom) / 2;\n      const containerCenterX = containerWidth / 2;\n      const containerCenterY = containerHeight / 2;\n      \n      // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è pan\n      const newPanX = containerCenterX - centerX * (newZoom / 100);\n      const newPanY = containerCenterY - centerY * (newZoom / 100);\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å pan –∑–Ω–∞—á–µ–Ω–∏–π\n      if (!isFinite(newPanX) || !isFinite(newPanY)) {\n        return;\n      }\n      \n      // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è\n      setZoom(newZoom);\n      setPan({\n        x: newPanX,\n        y: newPanY\n      });\n    }\n  }, [nodes]);\n\n  // Handle wheel zoom\n  const handleWheel = useCallback((e: React.WheelEvent) => {\n    if (e.ctrlKey || e.metaKey) {\n      e.preventDefault();\n      const delta = e.deltaY;\n      const zoomFactor = delta > 0 ? 0.9 : 1.1;\n      \n      const rect = canvasRef.current?.getBoundingClientRect();\n      if (rect) {\n        const mouseX = e.clientX - rect.left;\n        const mouseY = e.clientY - rect.top;\n        \n        const newZoom = Math.max(Math.min(zoom * zoomFactor, 200), 1);\n        const zoomRatio = newZoom / zoom;\n        \n        setPan(prev => ({\n          x: mouseX - (mouseX - prev.x) * zoomRatio,\n          y: mouseY - (mouseY - prev.y) * zoomRatio\n        }));\n        \n        setZoom(newZoom);\n      }\n    }\n  }, [zoom]);\n\n  // Handle panning\n  const handleMouseDown = useCallback((e: React.MouseEvent) => {\n    // Check if click is on empty canvas (not on a node)\n    const target = e.target as HTMLElement;\n    const isEmptyCanvas = target.classList.contains('canvas-grid-modern') || \n                          target.closest('.canvas-grid-modern') === target;\n    \n    if (e.button === 1 || e.button === 2 || (e.button === 0 && e.altKey) || \n        (e.button === 0 && isEmptyCanvas)) { // Middle mouse, right mouse, Alt+click, or left-click on empty canvas\n      e.preventDefault();\n      setIsPanning(true);\n      setPanStart({ x: e.clientX, y: e.clientY });\n      setLastPanPosition(pan);\n    }\n  }, [pan]);\n\n  const handleMouseMove = useCallback((e: React.MouseEvent) => {\n    if (isPanning) {\n      const deltaX = e.clientX - panStart.x;\n      const deltaY = e.clientY - panStart.y;\n      \n      setPan({\n        x: lastPanPosition.x + deltaX,\n        y: lastPanPosition.y + deltaY\n      });\n    }\n  }, [isPanning, panStart, lastPanPosition]);\n\n  const handleMouseUp = useCallback(() => {\n    setIsPanning(false);\n  }, []);\n\n  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ touch\n  const getTouchDistance = (touches: React.TouchList) => {\n    if (touches.length < 2) return 0;\n    const touch1 = touches[0];\n    const touch2 = touches[1];\n    const dx = touch2.clientX - touch1.clientX;\n    const dy = touch2.clientY - touch1.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –º–µ–∂–¥—É –¥–≤—É–º—è –∫–∞—Å–∞–Ω–∏—è–º–∏\n  const getTouchCenter = (touches: React.TouchList) => {\n    if (touches.length < 2) return { x: touches[0].clientX, y: touches[0].clientY };\n    return {\n      x: (touches[0].clientX + touches[1].clientX) / 2,\n      y: (touches[0].clientY + touches[1].clientY) / 2\n    };\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç–∫–∞ touch —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n  const handleTouchStart = useCallback((e: React.TouchEvent) => {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–∏ –∫–∞—Å–∞–Ω–∏–µ –Ω–∞ —É–∑–ª–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç—Å—è –ª–∏ —É–∂–µ —É–∑–µ–ª\n    const target = e.target as HTMLElement;\n    const isOnNode = target.closest('[data-canvas-node]');\n    \n    // –ï—Å–ª–∏ –∫–∞—Å–∞–Ω–∏–µ –Ω–∞ —É–∑–ª–µ –∏–ª–∏ —É–∂–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç—Å—è —É–∑–µ–ª, –Ω–µ –Ω–∞—á–∏–Ω–∞–µ–º –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞\n    if (isOnNode || isNodeBeingDragged) {\n      return;\n    }\n    \n    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º default –¥–µ–π—Å—Ç–≤–∏—è –±—Ä–∞—É–∑–µ—Ä–∞\n    e.preventDefault();\n    \n    const touches = e.touches;\n    \n    if (touches.length === 1) {\n      // –û–¥–Ω–æ –∫–∞—Å–∞–Ω–∏–µ - –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ\n      const touch = touches[0];\n      setIsTouchPanning(true);\n      setTouchStart({ x: touch.clientX, y: touch.clientY });\n      setLastTouchPosition(pan);\n    } else if (touches.length === 2) {\n      // –î–≤–∞ –∫–∞—Å–∞–Ω–∏—è - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ\n      const distance = getTouchDistance(touches);\n      setLastPinchDistance(distance);\n      setInitialPinchZoom(zoom);\n      setIsTouchPanning(false); // –û—Ç–∫–ª—é—á–∞–µ–º –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ pinch\n    }\n  }, [pan, zoom, isNodeBeingDragged]);\n\n  const handleTouchMove = useCallback((e: React.TouchEvent) => {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–∏ –∫–∞—Å–∞–Ω–∏–µ –Ω–∞ —É–∑–ª–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç—Å—è –ª–∏ —É–∑–µ–ª\n    const target = e.target as HTMLElement;\n    const isOnNode = target.closest('[data-canvas-node]');\n    \n    // –ï—Å–ª–∏ –∫–∞—Å–∞–Ω–∏–µ –Ω–∞ —É–∑–ª–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç—Å—è —É–∑–µ–ª, –Ω–µ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä—É–µ–º —Ö–æ–ª—Å—Ç\n    if (isOnNode || isNodeBeingDragged) {\n      return;\n    }\n    \n    e.preventDefault();\n    \n    const touches = e.touches;\n    \n    if (touches.length === 1 && isTouchPanning) {\n      // –ü–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–∏–º –ø–∞–ª—å—Ü–µ–º\n      const touch = touches[0];\n      const deltaX = touch.clientX - touchStart.x;\n      const deltaY = touch.clientY - touchStart.y;\n      \n      setPan({\n        x: lastTouchPosition.x + deltaX,\n        y: lastTouchPosition.y + deltaY\n      });\n    } else if (touches.length === 2) {\n      // Pinch zoom –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏\n      const currentDistance = getTouchDistance(touches);\n      const center = getTouchCenter(touches);\n      \n      if (lastPinchDistance > 0) {\n        const scaleFactor = currentDistance / lastPinchDistance;\n        const newZoom = Math.max(Math.min(initialPinchZoom * scaleFactor, 200), 10);\n        \n        // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ –∫–∞—Å–∞–Ω–∏—è\n        const rect = canvasRef.current?.getBoundingClientRect();\n        if (rect) {\n          const centerX = center.x - rect.left;\n          const centerY = center.y - rect.top;\n          \n          const zoomRatio = newZoom / zoom;\n          \n          setPan(prev => ({\n            x: centerX - (centerX - prev.x) * zoomRatio,\n            y: centerY - (centerY - prev.y) * zoomRatio\n          }));\n          \n          setZoom(newZoom);\n        }\n      }\n    }\n  }, [isTouchPanning, touchStart, lastTouchPosition, lastPinchDistance, initialPinchZoom, zoom, isNodeBeingDragged]);\n\n  const handleTouchEnd = useCallback((e: React.TouchEvent) => {\n    e.preventDefault();\n    \n    if (e.touches.length === 0) {\n      // –í—Å–µ –∫–∞—Å–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã\n      setIsTouchPanning(false);\n      setLastPinchDistance(0);\n    } else if (e.touches.length === 1) {\n      // –û—Å—Ç–∞–ª–æ—Å—å –æ–¥–Ω–æ –∫–∞—Å–∞–Ω–∏–µ - –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏—è\n      const touch = e.touches[0];\n      setTouchStart({ x: touch.clientX, y: touch.clientY });\n      setLastTouchPosition(pan);\n      setIsTouchPanning(true);\n      setLastPinchDistance(0);\n    }\n  }, [pan]);\n\n  // Prevent context menu on right-click when using for panning\n  const handleContextMenu = useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n  }, []);\n\n  // Handle keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–æ–∫—É—Å –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ input –∏–ª–∏ textarea\n      const target = e.target as HTMLElement;\n      const isInputField = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.contentEditable === 'true';\n      \n      if (!isInputField) {\n        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à–∏ Delete –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞\n        if (e.key === 'Delete' && selectedNodeId && onNodeDelete) {\n          e.preventDefault();\n          onNodeDelete(selectedNodeId);\n          return;\n        }\n      }\n\n      if (e.ctrlKey || e.metaKey) {\n        switch (e.key) {\n          case '=':\n          case '+':\n            e.preventDefault();\n            zoomIn();\n            break;\n          case '-':\n            e.preventDefault();\n            zoomOut();\n            break;\n          case '0':\n            e.preventDefault();\n            resetZoom();\n            break;\n          case '1':\n            e.preventDefault();\n            fitToContent();\n            break;\n          case 'z':\n            e.preventDefault();\n            if (e.shiftKey && onRedo && canRedo) {\n              onRedo();\n            } else if (onUndo && canUndo) {\n              onUndo();\n            }\n            break;\n          case 'y':\n            e.preventDefault();\n            if (onRedo && canRedo) {\n              onRedo();\n            }\n            break;\n          case 's':\n            e.preventDefault();\n            if (onSave && !isSaving) {\n              onSave();\n            }\n            break;\n          case 'c':\n            e.preventDefault();\n            if (e.shiftKey && selectedNodeId && onCopyToClipboard) {\n              // Shift+Ctrl+C - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –º–µ–∂–ø—Ä–æ–µ–∫—Ç–Ω—ã–π –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞\n              onCopyToClipboard([selectedNodeId]);\n            } else if (selectedNodeId && onNodeDuplicate) {\n              // Ctrl+C - –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ\n              onNodeDuplicate(selectedNodeId);\n            }\n            break;\n          case 'd':\n            e.preventDefault();\n            if (selectedNodeId && onNodeDuplicate) {\n              onNodeDuplicate(selectedNodeId);\n            }\n            break;\n          case 'v':\n            e.preventDefault();\n            if (e.shiftKey && onPasteFromClipboard) {\n              // Shift+Ctrl+V - –≤—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –º–µ–∂–ø—Ä–æ–µ–∫—Ç–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞\n              onPasteFromClipboard();\n            }\n            break;\n        }\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [zoomIn, zoomOut, resetZoom, fitToContent, onUndo, onRedo, canUndo, canRedo, onSave, isSaving, selectedNodeId, onNodeDelete, onNodeDuplicate]);\n\n\n\n  // Handle mouse events for panning\n  useEffect(() => {\n    const handleGlobalMouseMove = (e: MouseEvent) => {\n      if (isPanning) {\n        const deltaX = e.clientX - panStart.x;\n        const deltaY = e.clientY - panStart.y;\n        \n        setPan({\n          x: lastPanPosition.x + deltaX,\n          y: lastPanPosition.y + deltaY\n        });\n      }\n    };\n\n    const handleGlobalMouseUp = () => {\n      setIsPanning(false);\n    };\n\n    if (isPanning) {\n      document.addEventListener('mousemove', handleGlobalMouseMove);\n      document.addEventListener('mouseup', handleGlobalMouseUp);\n    }\n\n    return () => {\n      document.removeEventListener('mousemove', handleGlobalMouseMove);\n      document.removeEventListener('mouseup', handleGlobalMouseUp);\n    };\n  }, [isPanning, panStart, lastPanPosition]);\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(false);\n    \n    const componentData = e.dataTransfer.getData('application/json');\n    if (!componentData) return;\n    \n    const component: ComponentDefinition = JSON.parse(componentData);\n    const rect = canvasRef.current?.getBoundingClientRect();\n    \n    let nodePosition;\n    \n    if (rect) {\n      // Transform screen coordinates to canvas coordinates\n      const screenX = e.clientX - rect.left - 160; // Adjust for node width  \n      const screenY = e.clientY - rect.top - 50;   // Adjust for node height\n      \n      // Apply inverse transformation to get canvas coordinates\n      const canvasX = (screenX - pan.x) / (zoom / 100);\n      const canvasY = (screenY - pan.y) / (zoom / 100);\n      \n      // –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ä–∞–∑—É–º–Ω—ã–µ (–Ω–µ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –∫—Ä–∞—é), –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö\n      if (canvasX > 20 && canvasY > 20 && canvasX < 10000 && canvasY < 10000) {\n        nodePosition = { x: Math.max(50, canvasX), y: Math.max(50, canvasY) };\n      } else {\n        // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—Ç—Ä –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏\n        nodePosition = getCenterPosition();\n      }\n    } else {\n      // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å rect, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—Ç—Ä\n      nodePosition = getCenterPosition();\n    }\n    \n    const newNode: Node = {\n      id: nanoid(),\n      type: component.type,\n      position: nodePosition,\n      data: {\n        keyboardType: 'none',\n        buttons: [],\n        oneTimeKeyboard: false,\n        resizeKeyboard: true,\n        markdown: false,\n        ...component.defaultData\n      }\n    };\n    \n    onNodeAdd(newNode);\n  }, [onNodeAdd, pan, zoom, getCenterPosition]);\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ canvas-drop —Å–æ–±—ã—Ç–∏—è –¥–ª—è touch —É—Å—Ç—Ä–æ–π—Å—Ç–≤  \n  const handleCanvasDrop = useCallback((e: CustomEvent) => {\n    console.log('Canvas drop event received:', e.detail);\n    const { component, position } = e.detail;\n    \n    if (!component) {\n      console.error('Invalid drop data: no component');\n      return;\n    }\n    \n    let nodePosition;\n    \n    if (position) {\n      // Transform screen coordinates to canvas coordinates\n      const canvasX = (position.x - pan.x) / (zoom / 100);\n      const canvasY = (position.y - pan.y) / (zoom / 100);\n      \n      console.log('Drop position calculation:', {\n        screenPos: position,\n        pan,\n        zoom,\n        canvasPos: { x: canvasX, y: canvasY }\n      });\n      \n      nodePosition = { x: Math.max(0, canvasX - 80), y: Math.max(0, canvasY - 25) };\n    } else {\n      // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ drop, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—Ç—Ä –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏\n      nodePosition = getCenterPosition();\n      console.log('Using center position:', nodePosition);\n    }\n    \n    const newNode: Node = {\n      id: nanoid(),\n      type: component.type,\n      position: nodePosition,\n      data: {\n        keyboardType: 'none',\n        buttons: [],\n        oneTimeKeyboard: false,\n        resizeKeyboard: true,\n        markdown: false,\n        ...component.defaultData\n      }\n    };\n    \n    console.log('Creating new node:', newNode);\n    onNodeAdd(newNode);\n  }, [onNodeAdd, pan, zoom, getCenterPosition]);\n\n  // Handle canvas-drop —Å–æ–±—ã—Ç–∏–µ –¥–ª—è touch —É—Å—Ç—Ä–æ–π—Å—Ç–≤\n  useEffect(() => {\n    const canvasElement = canvasRef.current;\n    if (canvasElement) {\n      canvasElement.addEventListener('canvas-drop', handleCanvasDrop as EventListener);\n      return () => canvasElement.removeEventListener('canvas-drop', handleCanvasDrop as EventListener);\n    }\n  }, [handleCanvasDrop]);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(false);\n  }, []);\n\n  const handleCanvasClick = useCallback((e: React.MouseEvent) => {\n    if (e.target === e.currentTarget) {\n      onNodeSelect('');\n      onConnectionSelect?.('');\n      setConnectionStart(null);\n    }\n  }, [onNodeSelect, onConnectionSelect]);\n\n  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n  useEffect(() => {\n    if (!connectionStart) return;\n\n    const handleMouseMove = (e: MouseEvent) => {\n      if (canvasRef.current) {\n        const rect = canvasRef.current.getBoundingClientRect();\n        setMousePosition({\n          x: e.clientX - rect.left,\n          y: e.clientY - rect.top\n        });\n      }\n    };\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        setConnectionStart(null);\n      }\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [connectionStart]);\n\n  const handleConnectionStart = useCallback((nodeId: string, handle: 'source' | 'target') => {\n    if (connectionStart) {\n      // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –Ω–∞—á–∞–ª–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≤–µ—Ä—à–∏—Ç—å –µ–≥–æ\n      if (connectionStart.nodeId !== nodeId) {\n        const sourceId = connectionStart.handle === 'source' ? connectionStart.nodeId : nodeId;\n        const targetId = connectionStart.handle === 'source' ? nodeId : connectionStart.nodeId;\n        \n        // –ò—Å–ø–æ–ª—å–∑—É–µ–º ConnectionManager –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n        const connectionManager = new ConnectionManager({\n          nodes,\n          connections,\n          autoButtonCreation\n        });\n        \n        try {\n          const { connection, updatedNodes } = connectionManager.createConnection(sourceId, targetId, {\n            autoCreateButton: autoButtonCreation\n          });\n          \n          onConnectionAdd?.(connection);\n          if (onNodesUpdate) {\n            onNodesUpdate(updatedNodes);\n          }\n        } catch (error) {\n          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', error);\n        }\n      }\n      setConnectionStart(null);\n    } else {\n      // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n      setConnectionStart({ nodeId, handle });\n    }\n  }, [connectionStart, onConnectionAdd, onNodesUpdate, nodes, connections, autoButtonCreation]);\n\n  const handleCreateSuggestedConnection = useCallback((source: string, target: string) => {\n    const newConnection: Connection = {\n      id: nanoid(),\n      source,\n      target,\n      isInterSheet: false,\n    };\n    onConnectionAdd?.(newConnection);\n    setShowSuggestions(false);\n  }, [onConnectionAdd]);\n\n  const handleAutoConnect = useCallback(() => {\n    const suggestions = generateAutoConnections(nodes, connections);\n    const bestSuggestion = suggestions.find(s => s.confidence > 0.8);\n    \n    if (bestSuggestion) {\n      handleCreateSuggestedConnection(bestSuggestion.source, bestSuggestion.target);\n    } else {\n      setShowSuggestions(true);\n    }\n  }, [nodes, connections, handleCreateSuggestedConnection]);\n\n  return (\n    <main className=\"w-full h-full relative overflow-hidden bg-gradient-to-br from-slate-50 via-gray-50 to-slate-100 dark:from-slate-950 dark:via-gray-950 dark:to-slate-900\">\n      <div className=\"absolute inset-0 overflow-auto p-8\">\n        \n        {/* Enhanced Canvas Grid */}\n        <div \n          ref={canvasRef}\n          className=\"min-h-full relative canvas-grid-modern\"\n          style={{\n            backgroundImage: `\n              radial-gradient(circle at 1px 1px, rgba(99, 102, 241, 0.15) 1px, transparent 0)\n            `,\n            backgroundSize: `${24 * zoom / 100}px ${24 * zoom / 100}px`,\n            backgroundPosition: `${pan.x}px ${pan.y}px`,\n            minHeight: '2000vh',\n            minWidth: '2000vw',\n            cursor: isPanning ? 'grabbing' : 'grab'\n          }}\n          data-drag-over={isDragOver}\n          data-canvas-drop-zone\n          onDrop={handleDrop}\n          onDragOver={handleDragOver}\n          onDragLeave={handleDragLeave}\n          onClick={handleCanvasClick}\n          onWheel={handleWheel}\n          onMouseDown={handleMouseDown}\n          onMouseMove={handleMouseMove}\n          onMouseUp={handleMouseUp}\n          onContextMenu={handleContextMenu}\n          onTouchStart={handleTouchStart}\n          onTouchMove={handleTouchMove}\n          onTouchEnd={handleTouchEnd}\n        >\n          {/* Transformable Canvas Content */}\n          <div \n            className=\"relative origin-top-left transition-transform duration-200 ease-out\"\n            style={{\n              transform: `translate(${pan.x}px, ${pan.y}px) scale(${zoom / 100})`,\n              transformOrigin: '0 0'\n            }}\n          >\n            {/* Connections Layer */}\n            <ConnectionsLayer\n              connections={connections}\n              nodes={nodes}\n              selectedConnectionId={selectedConnectionId}\n              onConnectionSelect={onConnectionSelect}\n              onConnectionDelete={onConnectionDelete}\n            />\n\n            {/* Temporary connection preview */}\n            {connectionStart && (\n              <TemporaryConnection\n                startNode={nodes.find(n => n.id === connectionStart.nodeId)!}\n                endPosition={{\n                  x: (mousePosition.x - pan.x) / (zoom / 100),\n                  y: (mousePosition.y - pan.y) / (zoom / 100)\n                }}\n                handle={connectionStart.handle}\n              />\n            )}\n            \n            {/* Nodes */}\n            {nodes.map((node) => (\n              <CanvasNode\n                key={node.id}\n                node={node}\n                isSelected={selectedNodeId === node.id}\n                onClick={() => onNodeSelect(node.id)}\n                onDelete={() => onNodeDelete(node.id)}\n                onDuplicate={onNodeDuplicate ? () => onNodeDuplicate(node.id) : undefined}\n                onMove={(position) => onNodeMove(node.id, position)}\n                onConnectionStart={handleConnectionStart}\n                connectionStart={connectionStart}\n                zoom={zoom}\n                pan={pan}\n                setIsNodeBeingDragged={setIsNodeBeingDragged}\n                onSizeChange={handleNodeSizeChange}\n              />\n            ))}\n          </div>\n          \n          {/* Drop Zone Hint */}\n          {nodes.length === 0 && (\n            <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-gray-200/50 dark:border-slate-600/50 p-12 w-96 text-center transition-all duration-500 hover:scale-105\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-blue-500/10 via-purple-500/10 to-pink-500/10 dark:from-blue-400/20 dark:via-purple-400/20 dark:to-pink-400/20 rounded-3xl flex items-center justify-center mx-auto mb-8 border border-blue-200/50 dark:border-blue-600/30 transition-all duration-300 hover:scale-110 hover:shadow-lg hover:shadow-blue-500/20\">\n                <i className=\"fas fa-plus text-blue-600 dark:text-blue-400 text-3xl drop-shadow-sm\"></i>\n              </div>\n              <h3 className=\"text-gray-800 dark:text-gray-200 mb-4 font-bold text-xl bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç —Å—é–¥–∞</h3>\n              <p className=\"text-gray-600 dark:text-gray-400 text-base leading-relaxed\">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –Ω–∞ —Ö–æ–ª—Å—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞</p>\n            </div>\n          )}\n\n          {/* Smart Connection Tools */}\n          {nodes.length > 1 && (\n            <div className=\"absolute bottom-24 right-4 flex flex-col space-y-2 z-20\">\n              {/* Auto Connection Panel */}\n              <Popover open={showAutoPanel} onOpenChange={setShowAutoPanel}>\n                <PopoverTrigger asChild>\n                  <Button\n                    className=\"rounded-full w-10 h-10 shadow-md hover:shadow-lg transition-all duration-300 bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700\"\n                    title=\"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏\"\n                  >\n                    <i className=\"fas fa-magic text-white text-sm\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent side=\"left\" className=\"w-auto p-0\">\n                  <AutoConnectionPanel\n                    nodes={nodes}\n                    connections={connections}\n                    onConnectionAdd={(connection) => onConnectionAdd?.(connection)}\n                    onNodesUpdate={(updatedNodes) => onNodesUpdate?.(updatedNodes)}\n                    autoButtonCreation={autoButtonCreation}\n                    onAutoButtonCreationChange={setAutoButtonCreation}\n                  />\n                </PopoverContent>\n              </Popover>\n\n              {/* Auto-connect button */}\n              <Button\n                onClick={handleAutoConnect}\n                className=\"rounded-full w-10 h-10 shadow-md hover:shadow-lg transition-all duration-300 bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700\"\n                title=\"–ë—ã—Å—Ç—Ä–æ–µ –∞–≤—Ç–æ—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\"\n              >\n                <i className=\"fas fa-bolt text-white text-sm\" />\n              </Button>\n\n              {/* Connection suggestions */}\n              <Popover open={showSuggestions} onOpenChange={setShowSuggestions}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className=\"rounded-full w-10 h-10 shadow-md hover:shadow-lg transition-all duration-300 bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm\"\n                    title=\"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\"\n                  >\n                    <i className=\"fas fa-lightbulb text-yellow-500 text-sm\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent side=\"left\" className=\"w-80 p-0\">\n                  <ConnectionSuggestions\n                    nodes={nodes}\n                    connections={connections}\n                    onCreateConnection={handleCreateSuggestedConnection}\n                  />\n                </PopoverContent>\n              </Popover>\n\n              {/* Clear connections button */}\n              {connections.length > 0 && (\n                <Button\n                  onClick={() => {\n                    connections.forEach(conn => onConnectionDelete?.(conn.id));\n                  }}\n                  variant=\"outline\"\n                  className=\"rounded-full w-10 h-10 shadow-md hover:shadow-lg transition-all duration-300 bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm hover:bg-red-50 dark:hover:bg-red-900/20\"\n                  title=\"–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\"\n                >\n                  <i className=\"fas fa-eraser text-red-500 text-sm\" />\n                </Button>\n              )}\n            </div>\n          )}\n        </div>\n\n      </div>\n      \n      {/* –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –≤–≤–µ—Ä—Ö—É */}\n      <div className=\"absolute top-0 z-40 pointer-events-none transition-all duration-300\" style={{\n        left: isMobile ? '10px' : (sidebarVisible ? '100px' : '20px'),\n        right: isMobile ? '10px' : (propertiesVisible ? '150px' : '20px')\n      }}>\n        <div className=\"pt-0\">\n          <div className={`pointer-events-auto flex items-center canvas-controls overflow-x-auto ${\n            isMobile ? 'space-x-1 text-sm' : 'space-x-2'\n          }`}>\n            \n            <div className={`flex items-center flex-shrink-0 ${isMobile ? 'space-x-0.5' : 'space-x-1'}`}>\n              {/* –ö–Ω–æ–ø–∫–∏ –º–∞—Å—à—Ç–∞–±–∞ */}\n              <button \n                onClick={zoomOut}\n                disabled={zoom <= 1}\n                className={`${isMobile ? 'p-2' : 'p-2.5'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed`}\n                title=\"–£–º–µ–Ω—å—à–∏—Ç—å –º–∞—Å—à—Ç–∞–± (Ctrl + -)\"\n              >\n                <i className=\"fas fa-search-minus text-gray-600 dark:text-gray-400 text-sm group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\"></i>\n              </button>\n              \n              <Popover>\n                <PopoverTrigger asChild>\n                  <button\n                    className={`${isMobile ? 'px-2 py-2 text-xs min-w-[3rem]' : 'px-3 py-2.5 text-sm min-w-[4rem]'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 text-gray-700 dark:text-gray-300 font-mono text-center group`}\n                    title=\"–í—ã–±—Ä–∞—Ç—å –º–∞—Å—à—Ç–∞–±\"\n                  >\n                    <span className=\"flex items-center justify-center space-x-1\">\n                      <span>{Math.round(zoom)}%</span>\n                      <i className=\"fas fa-chevron-down text-xs opacity-50 group-hover:opacity-100 transition-opacity\"></i>\n                    </span>\n                  </button>\n                </PopoverTrigger>\n                <PopoverContent side=\"bottom\" className=\"w-40 p-2\">\n                  <div className=\"space-y-1\">\n                    <div className=\"text-xs font-medium text-gray-600 dark:text-gray-400 px-2 py-1\">–ë—ã—Å—Ç—Ä—ã–π –º–∞—Å—à—Ç–∞–±</div>\n                    {[1, 5, 10, 25, 50, 75, 100, 125, 150, 200].map((level) => (\n                      <button\n                        key={level}\n                        onClick={() => setZoomLevel(level)}\n                        className={`w-full text-left px-2 py-1.5 text-sm rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors ${\n                          Math.abs(zoom - level) < 1 ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400' : ''\n                        }`}\n                      >\n                        <div className=\"flex items-center justify-between\">\n                          <span>{level}%</span>\n                          {level === 100 && <span className=\"text-xs opacity-60\">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</span>}\n                          {level === 200 && <span className=\"text-xs opacity-60\">–ú–∞–∫—Å–∏–º—É–º</span>}\n                          {level === 1 && <span className=\"text-xs opacity-60\">–ú–∏–Ω–∏–º—É–º</span>}\n                        </div>\n                      </button>\n                    ))}\n                    <div className=\"border-t border-gray-200 dark:border-slate-600 my-1\"></div>\n                    <button\n                      onClick={resetZoom}\n                      className=\"w-full text-left px-2 py-1.5 text-sm rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors text-blue-600 dark:text-blue-400\"\n                    >\n                      <div className=\"flex items-center space-x-2\">\n                        <i className=\"fas fa-home text-xs\"></i>\n                        <span>–°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥</span>\n                      </div>\n                    </button>\n                    <button\n                      onClick={fitToContent}\n                      disabled={nodes.length === 0}\n                      className=\"w-full text-left px-2 py-1.5 text-sm rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors text-green-600 dark:text-green-400 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                      <div className=\"flex items-center space-x-2\">\n                        <i className=\"fas fa-expand-arrows-alt text-xs\"></i>\n                        <span>–£–º–µ—Å—Ç–∏—Ç—å –≤—Å—ë</span>\n                      </div>\n                    </button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n              \n              <button \n                onClick={zoomIn}\n                disabled={zoom >= 200}\n                className={`${isMobile ? 'p-2' : 'p-2.5'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed`}\n                title=\"–£–≤–µ–ª–∏—á–∏—Ç—å –º–∞—Å—à—Ç–∞–± (Ctrl + +)\"\n              >\n                <i className=\"fas fa-search-plus text-gray-600 dark:text-gray-400 text-sm group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\"></i>\n              </button>\n              <button \n                onClick={fitToContent}\n                disabled={nodes.length === 0}\n                className={`${isMobile ? 'p-2' : 'p-2.5'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed`}\n                title=\"–£–º–µ—Å—Ç–∏—Ç—å –≤ —ç–∫—Ä–∞–Ω (Ctrl + 1)\"\n              >\n                <i className=\"fas fa-expand-arrows-alt text-gray-600 dark:text-gray-400 text-sm group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\"></i>\n              </button>\n\n\n              <button \n                onClick={onUndo}\n                disabled={!canUndo}\n                className={`${isMobile ? 'p-2' : 'p-2.5'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed`}\n                title=\"–û—Ç–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ (Ctrl + Z)\"\n              >\n                <i className=\"fas fa-undo text-gray-600 dark:text-gray-400 text-sm group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\"></i>\n              </button>\n\n              <button \n                onClick={onRedo}\n                disabled={!canRedo}\n                className={`${isMobile ? 'p-2' : 'p-2.5'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed`}\n                title=\"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ (Ctrl + Y)\"\n              >\n                <i className=\"fas fa-redo text-gray-600 dark:text-gray-400 text-sm group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\"></i>\n              </button>\n\n              {onSave && (\n                <button \n                  onClick={onSave}\n                  disabled={isSaving}\n                  className={`${isMobile ? 'p-2' : 'p-2.5'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed`}\n                  title=\"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç (Ctrl + S)\"\n                >\n                  {isSaving ? (\n                    <i className=\"fas fa-spinner fa-spin text-gray-600 dark:text-gray-400 text-sm\"></i>\n                  ) : (\n                    <i className=\"fas fa-save text-gray-600 dark:text-gray-400 text-sm group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors\"></i>\n                  )}\n                </button>\n              )}\n\n              {/* –ú–µ–∂–ø—Ä–æ–µ–∫—Ç–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ/–≤—Å—Ç–∞–≤–∫–∞ */}\n              {onCopyToClipboard && selectedNodeId && (\n                <button \n                  onClick={() => onCopyToClipboard([selectedNodeId])}\n                  className={`${isMobile ? 'p-2' : 'p-2.5'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group`}\n                  title=\"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä (Shift + Ctrl + C)\"\n                >\n                  <i className=\"fas fa-clipboard text-gray-600 dark:text-gray-400 text-sm group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\"></i>\n                </button>\n              )}\n\n              {onPasteFromClipboard && hasClipboardData && (\n                <button \n                  onClick={onPasteFromClipboard}\n                  className={`${isMobile ? 'p-2' : 'p-2.5'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group`}\n                  title=\"–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞ (Shift + Ctrl + V)\"\n                >\n                  <i className=\"fas fa-paste text-gray-600 dark:text-gray-400 text-sm group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors\"></i>\n                </button>\n              )}\n\n              {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —à–∞–ø–∫–∞ —Å–∫—Ä—ã—Ç–∞ */}\n              {headerVisible === false && (onToggleHeader || onToggleSidebar || onToggleProperties || onToggleCanvas) && (\n                <div className=\"flex items-center space-x-1 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 p-1\">\n                  {onToggleHeader && (\n                    <button\n                      onClick={onToggleHeader}\n                      className={`p-2 rounded-md transition-all duration-200 ${\n                        headerVisible \n                          ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400' \n                          : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700'\n                      }`}\n                      title={`${headerVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} —à–∞–ø–∫—É`}\n                    >\n                      <Navigation className=\"w-4 h-4\" />\n                    </button>\n                  )}\n                  \n                  {onToggleSidebar && (\n                    <button\n                      onClick={onToggleSidebar}\n                      className={`p-2 rounded-md transition-all duration-200 ${\n                        sidebarVisible \n                          ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400' \n                          : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700'\n                      }`}\n                      title={`${sidebarVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å`}\n                    >\n                      <Sidebar className=\"w-4 h-4\" />\n                    </button>\n                  )}\n                  \n                  {onToggleCanvas && (\n                    <button\n                      onClick={onToggleCanvas}\n                      className={`p-2 rounded-md transition-all duration-200 ${\n                        canvasVisible \n                          ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400' \n                          : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700'\n                      }`}\n                      title={`${canvasVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} —Ö–æ–ª—Å—Ç`}\n                    >\n                      <Monitor className=\"w-4 h-4\" />\n                    </button>\n                  )}\n                  \n                  {onToggleProperties && (\n                    <button\n                      onClick={onToggleProperties}\n                      className={`p-2 rounded-md transition-all duration-200 ${\n                        propertiesVisible \n                          ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400' \n                          : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700'\n                      }`}\n                      title={`${propertiesVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤`}\n                    >\n                      <Sliders className=\"w-4 h-4\" />\n                    </button>\n                  )}\n                </div>\n              )}\n\n            </div>\n            \n            {/* Zoom Info and Help */}\n            <div className=\"flex items-center space-x-2\">\n              {zoom !== 100 && (\n                <div className=\"bg-white/90 dark:bg-slate-900/90 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 px-3 py-2 text-xs text-gray-600 dark:text-gray-400\">\n                  <div className=\"flex items-center space-x-2\">\n                    <i className=\"fas fa-info-circle text-blue-500\"></i>\n                    <span>\n                      {zoom > 100 ? '–£–≤–µ–ª–∏—á–µ–Ω–æ' : '–£–º–µ–Ω—å—à–µ–Ω–æ'} –¥–æ {Math.round(zoom)}%\n                    </span>\n                    <span className=\"text-gray-400 dark:text-gray-500\">‚Ä¢</span>\n                    <span>Ctrl+0 –¥–ª—è —Å–±—Ä–æ—Å–∞</span>\n                  </div>\n                </div>\n              )}\n              \n              {/* Zoom Help */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <button className={`${isMobile ? 'p-1.5' : 'p-2'} bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800 transition-all duration-200 group`}>\n                    <i className=\"fas fa-question-circle text-gray-500 dark:text-gray-400 text-sm group-hover:text-blue-500 transition-colors\"></i>\n                  </button>\n                </PopoverTrigger>\n                <PopoverContent side=\"bottom\" className=\"w-64 p-3\">\n                  <div className=\"space-y-3\">\n                    <h4 className=\"font-medium text-sm\">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–æ–º</h4>\n                    <div className=\"space-y-2 text-xs\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600 dark:text-gray-400\">–£–≤–µ–ª–∏—á–∏—Ç—å:</span>\n                        <code className=\"bg-gray-100 dark:bg-slate-800 px-1.5 py-0.5 rounded\">Ctrl + +</code>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600 dark:text-gray-400\">–£–º–µ–Ω—å—à–∏—Ç—å:</span>\n                        <code className=\"bg-gray-100 dark:bg-slate-800 px-1.5 py-0.5 rounded\">Ctrl + -</code>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600 dark:text-gray-400\">–°–±—Ä–æ—Å–∏—Ç—å:</span>\n                        <code className=\"bg-gray-100 dark:bg-slate-800 px-1.5 py-0.5 rounded\">Ctrl + 0</code>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600 dark:text-gray-400\">–£–º–µ—Å—Ç–∏—Ç—å –≤—Å—ë:</span>\n                        <code className=\"bg-gray-100 dark:bg-slate-800 px-1.5 py-0.5 rounded\">Ctrl + 1</code>\n                      </div>\n                      <div className=\"border-t border-gray-200 dark:border-slate-600 pt-2 mt-2\">\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-600 dark:text-gray-400\">–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:</span>\n                          <code className=\"bg-gray-100 dark:bg-slate-800 px-1.5 py-0.5 rounded\">Ctrl + –∫–æ–ª–µ—Å–æ</code>\n                        </div>\n                        <div className=\"flex justify-between mt-1\">\n                          <span className=\"text-gray-600 dark:text-gray-400\">–ü–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ:</span>\n                          <code className=\"bg-gray-100 dark:bg-slate-800 px-1.5 py-0.5 rounded\">Alt + –õ–ö–ú</code>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ª–∏—Å—Ç–æ–≤ —Ö–æ–ª—Å—Ç–∞ - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –≤–Ω–∏–∑—É */}\n      {botData && onBotDataUpdate && (\n        <div className=\"absolute bottom-0 z-40 pointer-events-none transition-all duration-300\" style={{\n          left: isMobile ? '10px' : (sidebarVisible ? '260px' : '20px'),\n          right: isMobile ? '10px' : (propertiesVisible ? '320px' : '20px')\n        }}>\n          <div className=\"flex justify-center pb-4\">\n            <div className=\"pointer-events-auto w-full\" style={{\n              minWidth: isMobile ? '300px' : '600px',\n              maxWidth: isMobile ? '100%' : '1000px'\n            }}>\n              <CanvasSheets\n                sheets={botData.sheets}\n                activeSheetId={botData.activeSheetId || null}\n                onSheetSelect={handleSheetSelect}\n                onSheetAdd={handleSheetAdd}\n                onSheetDelete={handleSheetDelete}\n                onSheetRename={handleSheetRename}\n                onSheetDuplicate={handleSheetDuplicate}\n                maxVisibleTabs={5}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n    </main>\n  );\n}\n","size_bytes":58479},"client/src/components/editor/components-sidebar.tsx":{"content":"import { ComponentDefinition, BotProject } from '@shared/schema';\nimport { cn } from '@/lib/utils';\nimport { useState, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { SheetsManager } from '@/utils/sheets-manager';\n\nimport QuickLayoutSwitcher from '@/components/layout/quick-layout-switcher';\nimport DragLayoutManager from '@/components/layout/drag-layout-manager';\nimport { Button } from '@/components/ui/button';\nimport { Separator } from '@/components/ui/separator';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\n\nimport { Layout, Settings, Grid, Home, Plus, Edit, Trash2, Calendar, User, GripVertical, FileText, Copy, MoreHorizontal, ChevronDown, ChevronRight, Menu, X } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { LayoutButtons } from '@/components/layout/layout-buttons';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n\n\ninterface ComponentsSidebarProps {\n  onComponentDrag: (component: ComponentDefinition) => void;\n  onComponentAdd?: (component: ComponentDefinition) => void;\n  onLoadTemplate?: () => void;\n  onOpenLayoutCustomizer?: () => void;\n  onLayoutChange?: (config: any) => void;\n  onGoToProjects?: () => void;\n  onProjectSelect?: (projectId: number) => void;\n  currentProjectId?: number;\n  headerContent?: React.ReactNode;\n  sidebarContent?: React.ReactNode;\n  canvasContent?: React.ReactNode;\n  propertiesContent?: React.ReactNode;\n  // –ù–æ–≤—ã–µ –ø—Ä–æ–ø—Å—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–∫–µ—Ç–æ–º\n  onToggleCanvas?: () => void;\n  onToggleHeader?: () => void;\n  onToggleProperties?: () => void;\n  onShowFullLayout?: () => void;\n  canvasVisible?: boolean;\n  headerVisible?: boolean;\n  propertiesVisible?: boolean;\n  showLayoutButtons?: boolean;\n  // –ü—Ä–æ–ø—Å—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞–º–∏\n  onSheetAdd?: (name: string) => void;\n  onSheetDelete?: (sheetId: string) => void;\n  onSheetRename?: (sheetId: string, name: string) => void;\n  onSheetDuplicate?: (sheetId: string) => void;\n  onSheetSelect?: (sheetId: string) => void;\n  // –ú–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º\n  isMobile?: boolean;\n}\n\nconst components: ComponentDefinition[] = [\n  {\n    id: 'text-message',\n    name: '–¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    description: '–û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ Markdown',\n    icon: 'fas fa-comment',\n    color: 'bg-blue-100 text-blue-600',\n    type: 'message',\n    defaultData: {\n      messageText: '–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'photo-message',\n    name: '–§–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º',\n    description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + –æ–ø–∏—Å–∞–Ω–∏–µ',\n    icon: 'fas fa-image',\n    color: 'bg-green-100 text-green-600',\n    type: 'photo',\n    defaultData: {\n      messageText: '–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',\n      imageUrl: '',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'video-message',\n    name: '–í–∏–¥–µ–æ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    description: '–í–∏–¥–µ–æ —Ñ–∞–π–ª —Å –ø–æ–¥–ø–∏—Å—å—é',\n    icon: 'fas fa-video',\n    color: 'bg-red-100 text-red-600',\n    type: 'video',\n    defaultData: {\n      messageText: '–û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–µ–æ',\n      videoUrl: '',\n      mediaCaption: '',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'audio-message',\n    name: '–ê—É–¥–∏–æ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    description: '–ê—É–¥–∏–æ —Ñ–∞–π–ª —Å –ø–æ–¥–ø–∏—Å—å—é',\n    icon: 'fas fa-music',\n    color: 'bg-yellow-100 text-yellow-600',\n    type: 'audio',\n    defaultData: {\n      messageText: '–û–ø–∏—Å–∞–Ω–∏–µ –∞—É–¥–∏–æ',\n      audioUrl: '',\n      mediaCaption: '',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'document-message',\n    name: '–î–æ–∫—É–º–µ–Ω—Ç',\n    description: '–§–∞–π–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞',\n    icon: 'fas fa-file',\n    color: 'bg-gray-100 text-gray-600',\n    type: 'document',\n    defaultData: {\n      messageText: '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞',\n      documentUrl: '',\n      documentName: 'document.pdf',\n      mediaCaption: '',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'sticker-message',\n    name: '–°—Ç–∏–∫–µ—Ä',\n    description: '–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∏–∫–µ—Ä',\n    icon: 'fas fa-laugh',\n    color: 'bg-pink-100 text-pink-600',\n    type: 'sticker',\n    defaultData: {\n      messageText: '–°—Ç–∏–∫–µ—Ä',\n      stickerUrl: '',\n      stickerFileId: '',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'voice-message',\n    name: '–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    description: '–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    icon: 'fas fa-microphone',\n    color: 'bg-teal-100 text-teal-600',\n    type: 'voice',\n    defaultData: {\n      messageText: '–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n      voiceUrl: '',\n      duration: 0,\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'animation-message',\n    name: 'GIF –∞–Ω–∏–º–∞—Ü–∏—è',\n    description: '–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',\n    icon: 'fas fa-film',\n    color: 'bg-orange-100 text-orange-600',\n    type: 'animation',\n    defaultData: {\n      messageText: 'GIF –∞–Ω–∏–º–∞—Ü–∏—è',\n      animationUrl: '',\n      duration: 0,\n      width: 0,\n      height: 0,\n      mediaCaption: '',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'location-message',\n    name: '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è',\n    description: '–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç',\n    icon: 'fas fa-map-marker',\n    color: 'bg-green-100 text-green-600',\n    type: 'location',\n    defaultData: {\n      messageText: '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n      latitude: 55.7558,\n      longitude: 37.6176,\n      title: '–ú–æ—Å–∫–≤–∞',\n      address: '–ú–æ—Å–∫–≤–∞, –†–æ—Å—Å–∏—è',\n      foursquareId: '',\n      foursquareType: '',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'contact-message',\n    name: '–ö–æ–Ω—Ç–∞–∫—Ç',\n    description: '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º',\n    icon: 'fas fa-address-book',\n    color: 'bg-blue-100 text-blue-600',\n    type: 'contact',\n    defaultData: {\n      messageText: '–ö–æ–Ω—Ç–∞–∫—Ç',\n      phoneNumber: '+7 (999) 123-45-67',\n      firstName: '–ò–º—è',\n      lastName: '–§–∞–º–∏–ª–∏—è',\n      userId: 0,\n      vcard: '',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n\n  {\n    id: 'reply-keyboard',\n    name: 'Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞',\n    description: '–ö–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞',\n    icon: 'fas fa-keyboard',\n    color: 'bg-purple-100 text-purple-600',\n    type: 'keyboard',\n    defaultData: {\n      messageText: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:',\n      keyboardType: 'reply',\n      buttons: [\n        { id: 'btn-1', text: '–ö–Ω–æ–ø–∫–∞ 1', action: 'goto', target: '' },\n        { id: 'btn-2', text: '–ö–Ω–æ–ø–∫–∞ 2', action: 'goto', target: '' }\n      ],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n  {\n    id: 'inline-keyboard',\n    name: 'Inline –∫–Ω–æ–ø–∫–∏',\n    description: '–ö–Ω–æ–ø–∫–∏ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º',\n    icon: 'fas fa-mouse',\n    color: 'bg-amber-100 text-amber-600',\n    type: 'keyboard',\n    defaultData: {\n      messageText: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:',\n      keyboardType: 'inline',\n      buttons: [\n        { id: 'btn-1', text: '–ö–Ω–æ–ø–∫–∞ 1', action: 'goto', target: '' },\n        { id: 'btn-2', text: '–ö–Ω–æ–ø–∫–∞ 2', action: 'goto', target: '' }\n      ],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true\n    }\n  },\n\n  {\n    id: 'start-command',\n    name: '/start –∫–æ–º–∞–Ω–¥–∞',\n    description: '–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –±–æ—Ç–∞',\n    icon: 'fas fa-play',\n    color: 'bg-green-100 text-green-600',\n    type: 'start',\n    defaultData: {\n      command: '/start',\n      description: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞',\n      messageText: '–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true,\n      showInMenu: true,\n      isPrivateOnly: false,\n      requiresAuth: false,\n      adminOnly: false\n    }\n  },\n  {\n    id: 'help-command',\n    name: '/help –∫–æ–º–∞–Ω–¥–∞',\n    description: '–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É',\n    icon: 'fas fa-question-circle',\n    color: 'bg-blue-100 text-blue-600',\n    type: 'command',\n    defaultData: {\n      command: '/help',\n      description: '–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É',\n      messageText: 'ü§ñ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\\n\\n/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É\\n/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\\n/settings - –ù–∞—Å—Ç—Ä–æ–π–∫–∏',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: true,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true,\n      showInMenu: true,\n      isPrivateOnly: false,\n      requiresAuth: false,\n      adminOnly: false\n    }\n  },\n  {\n    id: 'settings-command',\n    name: '/settings –∫–æ–º–∞–Ω–¥–∞',\n    description: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞',\n    icon: 'fas fa-cog',\n    color: 'bg-gray-100 text-gray-600',\n    type: 'command',\n    defaultData: {\n      command: '/settings',\n      description: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞',\n      messageText: '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞:',\n      keyboardType: 'inline',\n      buttons: [\n        { id: 'btn-1', text: 'üìã –Ø–∑—ã–∫', action: 'command', target: '/language' },\n        { id: 'btn-2', text: 'üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', action: 'command', target: '/notifications' }\n      ],\n      markdown: true,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true,\n      showInMenu: true,\n      isPrivateOnly: false,\n      requiresAuth: false,\n      adminOnly: false\n    }\n  },\n  {\n    id: 'menu-command',\n    name: '/menu –∫–æ–º–∞–Ω–¥–∞',\n    description: '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',\n    icon: 'fas fa-bars',\n    color: 'bg-purple-100 text-purple-600',\n    type: 'command',\n    defaultData: {\n      command: '/menu',\n      description: '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',\n      messageText: 'üìã –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:',\n      keyboardType: 'reply',\n      buttons: [\n        { id: 'btn-1', text: 'üìñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', action: 'command', target: '/info' },\n        { id: 'btn-2', text: '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏', action: 'command', target: '/settings' },\n        { id: 'btn-3', text: '‚ùì –ü–æ–º–æ—â—å', action: 'command', target: '/help' },\n        { id: 'btn-4', text: 'üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞', action: 'command', target: '/support' }\n      ],\n      markdown: true,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true,\n      showInMenu: true,\n      isPrivateOnly: false,\n      requiresAuth: false,\n      adminOnly: false\n    }\n  },\n  {\n    id: 'custom-command',\n    name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞',\n    description: '–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –∫–æ–º–∞–Ω–¥–∞',\n    icon: 'fas fa-terminal',\n    color: 'bg-indigo-100 text-indigo-600',\n    type: 'command',\n    defaultData: {\n      command: '/custom',\n      description: '–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞',\n      messageText: '–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞',\n      keyboardType: 'none',\n      buttons: [],\n      markdown: false,\n      oneTimeKeyboard: false,\n      resizeKeyboard: true,\n      showInMenu: true,\n      isPrivateOnly: false,\n      requiresAuth: false,\n      adminOnly: false\n    }\n  },\n  {\n    id: 'pin-message',\n    name: '–ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    description: '–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ',\n    icon: 'fas fa-thumbtack',\n    color: 'bg-cyan-100 text-cyan-600',\n    type: 'pin_message',\n    defaultData: {\n      command: '/pin_message',\n      targetMessageId: '',\n      messageIdSource: 'last_message',\n      variableName: '',\n      disableNotification: false\n    }\n  },\n  {\n    id: 'unpin-message',\n    name: '–û—Ç–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    description: '–°–Ω—è—Ç–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è',\n    icon: 'fas fa-times',\n    color: 'bg-slate-100 text-slate-600',\n    type: 'unpin_message',\n    defaultData: {\n      command: '/unpin_message',\n      targetMessageId: '',\n      messageIdSource: 'last_message',\n      variableName: ''\n    }\n  },\n  {\n    id: 'delete-message',\n    name: '–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    description: '–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ',\n    icon: 'fas fa-trash',\n    color: 'bg-red-100 text-red-600',\n    type: 'delete_message',\n    defaultData: {\n      command: '/delete_message',\n      targetMessageId: '',\n      messageIdSource: 'last_message',\n      variableName: ''\n    }\n  },\n  {\n    id: 'ban-user',\n    name: '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    description: '–ó–∞–±–∞–Ω–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≥—Ä—É–ø–ø—ã',\n    icon: 'fas fa-ban',\n    color: 'bg-red-100 text-red-600',\n    type: 'ban_user',\n    defaultData: {\n      command: '/ban_user',\n      targetUserId: '',\n      userIdSource: 'last_message',\n      userVariableName: '',\n      reason: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã',\n      untilDate: 0\n    }\n  },\n  {\n    id: 'unban-user',\n    name: '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    description: '–°–Ω—è—Ç—å –±–∞–Ω —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≥—Ä—É–ø–ø—ã',\n    icon: 'fas fa-user-check',\n    color: 'bg-green-100 text-green-600',\n    type: 'unban_user',\n    defaultData: {\n      command: '/unban_user',\n      targetUserId: '',\n      userIdSource: 'last_message',\n      userVariableName: ''\n    }\n  },\n  {\n    id: 'mute-user',\n    name: '–ó–∞–≥–ª—É—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    description: '–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–∞–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞',\n    icon: 'fas fa-volume-mute',\n    color: 'bg-orange-100 text-orange-600',\n    type: 'mute_user',\n    defaultData: {\n      command: '/mute_user',\n      targetUserId: '',\n      userIdSource: 'last_message',\n      userVariableName: '',\n      duration: 3600,\n      reason: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã',\n      canSendMessages: false,\n      canSendMediaMessages: false,\n      canSendPolls: false,\n      canSendOtherMessages: false,\n      canAddWebPagePreviews: false,\n      canChangeGroupInfo: false,\n      canInviteUsers2: false,\n      canPinMessages2: false\n    }\n  },\n  {\n    id: 'unmute-user',\n    name: '–°–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è',\n    description: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞',\n    icon: 'fas fa-volume-up',\n    color: 'bg-green-100 text-green-600',\n    type: 'unmute_user',\n    defaultData: {\n      command: '/unmute_user',\n      targetUserId: '',\n      userIdSource: 'last_message',\n      userVariableName: ''\n    }\n  },\n  {\n    id: 'kick-user',\n    name: '–ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    description: '–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –≥—Ä—É–ø–ø—ã',\n    icon: 'fas fa-user-times',\n    color: 'bg-red-100 text-red-600',\n    type: 'kick_user',\n    defaultData: {\n      targetUserId: '',\n      userIdSource: 'last_message',\n      userVariableName: '',\n      reason: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã'\n    }\n  },\n  {\n    id: 'promote-user',\n    name: '–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º',\n    description: '–î–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n    icon: 'fas fa-crown',\n    color: 'bg-yellow-100 text-yellow-600',\n    type: 'promote_user',\n    defaultData: {\n      targetUserId: '',\n      userIdSource: 'last_message',\n      userVariableName: '',\n      canChangeInfo: false,\n      canDeleteMessages: true,\n      canBanUsers: false,\n      canInviteUsers: true,\n      canPinMessages: true,\n      canAddAdmins: false,\n      canRestrictMembers: false,\n      canPromoteMembers: false,\n      canManageVideoChats: false,\n      canManageTopics: false,\n      isAnonymous: false\n    }\n  },\n  {\n    id: 'demote-user',\n    name: '–°–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n    description: '–£–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n    icon: 'fas fa-user-minus',\n    color: 'bg-gray-100 text-gray-600',\n    type: 'demote_user',\n    defaultData: {\n      targetUserId: '',\n      userIdSource: 'last_message',\n      userVariableName: ''\n    }\n  },\n  {\n    id: 'admin-rights',\n    name: '–¢–≥ –ø—Ä–∞–≤–∞',\n    description: '–ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n    icon: 'fas fa-user-cog',\n    color: 'bg-purple-100 text-purple-600',\n    type: 'admin_rights',\n    defaultData: {\n      command: '/admin_rights',\n      description: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n      synonyms: ['–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞', '–∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞', '–∞–¥–º–∏–Ω –ø—Ä–∞–≤–∞', '—Ç–≥ –ø—Ä–∞–≤–∞', '–ø—Ä–∞–≤–∞'],\n      adminUserIdSource: 'last_message',\n      adminChatIdSource: 'current_chat',\n      // –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ Telegram Bot API\n      can_manage_chat: false,\n      can_post_messages: false,\n      can_edit_messages: false,\n      can_delete_messages: true,\n      can_post_stories: false,\n      can_edit_stories: false,\n      can_delete_stories: false,\n      can_manage_video_chats: false,\n      can_restrict_members: false,\n      can_promote_members: false,\n      can_change_info: false,\n      can_invite_users: true,\n      can_pin_messages: true,\n      can_manage_topics: false,\n      is_anonymous: false\n    }\n  }\n];\n\nconst componentCategories = [\n  {\n    title: '–°–æ–æ–±—â–µ–Ω–∏—è',\n    components: components.filter(c => ['message', 'photo', 'video', 'audio', 'document', 'sticker', 'voice', 'animation', 'location', 'contact'].includes(c.type))\n  },\n  {\n    title: '–ö–Ω–æ–ø–∫–∏',\n    components: components.filter(c => c.type === 'keyboard')\n  },\n  {\n    title: '–ö–æ–º–∞–Ω–¥—ã',\n    components: components.filter(c => ['start', 'command'].includes(c.type))\n  },\n  {\n    title: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º',\n    components: components.filter(c => ['pin_message', 'unpin_message', 'delete_message'].includes(c.type))\n  },\n  {\n    title: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏',\n    components: components.filter(c => ['ban_user', 'unban_user', 'mute_user', 'unmute_user', 'kick_user', 'promote_user', 'demote_user', 'admin_rights'].includes(c.type))\n  }\n];\n\nexport function ComponentsSidebar({ \n  onComponentDrag, \n  onComponentAdd,\n  onLoadTemplate, \n  onOpenLayoutCustomizer, \n  onLayoutChange,\n  onGoToProjects,\n  onProjectSelect,\n  currentProjectId,\n  headerContent,\n  sidebarContent,\n  canvasContent,\n  propertiesContent,\n  onToggleCanvas,\n  onToggleHeader,\n  onToggleProperties,\n  onShowFullLayout,\n  canvasVisible = false,\n  headerVisible = false,\n  propertiesVisible = false,\n  showLayoutButtons = false,\n  onSheetAdd,\n  onSheetDelete,\n  onSheetRename,\n  onSheetDuplicate,\n  onSheetSelect,\n  isMobile = false\n}: ComponentsSidebarProps) {\n  const [currentTab, setCurrentTab] = useState<'elements' | 'projects'>('elements');\n  const [draggedProject, setDraggedProject] = useState<BotProject | null>(null);\n  const [dragOverProject, setDragOverProject] = useState<number | null>(null);\n  const [selectedSheetId, setSelectedSheetId] = useState<string | null>(null);\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è inline —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—Å—Ç–æ–≤\n  const [editingSheetId, setEditingSheetId] = useState<string | null>(null);\n  const [editingSheetName, setEditingSheetName] = useState('');\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞—Å–∫—Ä—ã—Ç–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π\n  const [collapsedCategories, setCollapsedCategories] = useState<Set<string>>(new Set());\n  // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n  const isActuallyMobile = useIsMobile();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  \n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏\n  const toggleCategory = (categoryTitle: string) => {\n    setCollapsedCategories(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(categoryTitle)) {\n        newSet.delete(categoryTitle);\n      } else {\n        newSet.add(categoryTitle);\n      }\n      return newSet;\n    });\n  };\n  \n  const handleDragStart = (e: React.DragEvent, component: ComponentDefinition) => {\n    e.dataTransfer.setData('application/json', JSON.stringify(component));\n    onComponentDrag(component);\n  };\n\n  // Touch —Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤\n  const [touchedComponent, setTouchedComponent] = useState<ComponentDefinition | null>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const [touchStartElement, setTouchStartElement] = useState<HTMLElement | null>(null);\n\n  const handleTouchStart = (e: React.TouchEvent, component: ComponentDefinition) => {\n    console.log('Touch start on component:', component.name);\n    e.preventDefault();\n    e.stopPropagation();\n    \n    const touch = e.touches[0];\n    const element = e.currentTarget as HTMLElement;\n    \n    setTouchedComponent(component);\n    setIsDragging(true);\n    setTouchStartElement(element);\n    \n    const rect = element.getBoundingClientRect();\n    setDragOffset({\n      x: touch.clientX - rect.left,\n      y: touch.clientY - rect.top\n    });\n    onComponentDrag(component);\n    \n    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å\n    element.style.opacity = '0.7';\n    element.style.transform = 'scale(0.95)';\n    element.style.transition = 'all 0.2s ease';\n    \n    console.log('Touch drag started for:', component.name, {\n      touchPos: { x: touch.clientX, y: touch.clientY },\n      elementRect: rect\n    });\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    if (!isDragging || !touchedComponent) return;\n    e.preventDefault();\n    e.stopPropagation();\n    console.log('Touch move:', { x: e.touches[0].clientX, y: e.touches[0].clientY });\n  };\n\n  const handleTouchEnd = (e: React.TouchEvent) => {\n    if (!isDragging || !touchedComponent) {\n      console.log('Touch end ignored - not dragging or no component');\n      return;\n    }\n    \n    console.log('Touch end for component:', touchedComponent.name);\n    const touch = e.changedTouches[0];\n    const element = document.elementFromPoint(touch.clientX, touch.clientY);\n    \n    console.log('Touch end position:', { x: touch.clientX, y: touch.clientY });\n    console.log('Element at touch point:', element);\n    \n    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞\n    const currentTarget = e.currentTarget as HTMLElement;\n    currentTarget.style.opacity = '';\n    currentTarget.style.transform = '';\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–ª–∏ –ª–∏ –º—ã –Ω–∞ —Ö–æ–ª—Å—Ç –∏–ª–∏ –≤ –æ–±–ª–∞—Å—Ç—å —Ö–æ–ª—Å—Ç–∞\n    const canvas = document.querySelector('[data-canvas-drop-zone]');\n    console.log('Canvas element found:', canvas);\n    \n    if (canvas && element) {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ canvas –∏–ª–∏ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–∏–º canvas\n      const isInCanvas = canvas.contains(element) || element === canvas || \n                        element.closest('[data-canvas-drop-zone]') === canvas;\n      \n      console.log('Is in canvas:', isInCanvas);\n      \n      if (isInCanvas) {\n        const canvasRect = canvas.getBoundingClientRect();\n        const dropPosition = {\n          x: touch.clientX - canvasRect.left,\n          y: touch.clientY - canvasRect.top\n        };\n        \n        // Dispatching canvas-drop event\n        \n        // –°–æ–∑–¥–∞–µ–º —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ drop\n        const dropEvent = new CustomEvent('canvas-drop', {\n          detail: {\n            component: touchedComponent,\n            position: dropPosition\n          }\n        });\n        canvas.dispatchEvent(dropEvent);\n      } else {\n        // Touch ended outside canvas\n      }\n    } else {\n      // Canvas not found\n    }\n    \n    setTouchedComponent(null);\n    setIsDragging(false);\n    setDragOffset({ x: 0, y: 0 });\n    setTouchStartElement(null);\n  };\n\n  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ touch –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ª—É—á—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤\n  useEffect(() => {\n    const handleGlobalTouchMove = (e: TouchEvent) => {\n      if (isDragging && touchedComponent) {\n        e.preventDefault();\n        // Global touch move\n      }\n    };\n\n    const handleGlobalTouchEnd = (e: TouchEvent) => {\n      if (!isDragging || !touchedComponent) return;\n      \n      // Global touch end\n      const touch = e.changedTouches[0];\n      const element = document.elementFromPoint(touch.clientX, touch.clientY);\n      \n      // Global touch end position\n      \n      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞\n      if (touchStartElement) {\n        touchStartElement.style.opacity = '';\n        touchStartElement.style.transform = '';\n        touchStartElement.style.transition = '';\n      }\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–ª–∏ –ª–∏ –º—ã –Ω–∞ —Ö–æ–ª—Å—Ç\n      const canvas = document.querySelector('[data-canvas-drop-zone]');\n      // Canvas element check\n      \n      if (canvas && element) {\n        const isInCanvas = canvas.contains(element) || element === canvas || \n                          element.closest('[data-canvas-drop-zone]') === canvas;\n        \n        // Is in canvas check\n        \n        if (isInCanvas) {\n          const canvasRect = canvas.getBoundingClientRect();\n          const dropPosition = {\n            x: touch.clientX - canvasRect.left,\n            y: touch.clientY - canvasRect.top\n          };\n          \n          // Dispatching global canvas-drop event\n          \n          const dropEvent = new CustomEvent('canvas-drop', {\n            detail: {\n              component: touchedComponent,\n              position: dropPosition\n            }\n          });\n          canvas.dispatchEvent(dropEvent);\n        }\n      }\n      \n      setTouchedComponent(null);\n      setIsDragging(false);\n      setDragOffset({ x: 0, y: 0 });\n      setTouchStartElement(null);\n    };\n\n    if (isDragging) {\n      document.addEventListener('touchmove', handleGlobalTouchMove, { passive: false });\n      document.addEventListener('touchend', handleGlobalTouchEnd, { passive: false });\n    }\n\n    return () => {\n      document.removeEventListener('touchmove', handleGlobalTouchMove);\n      document.removeEventListener('touchend', handleGlobalTouchEnd);\n    };\n  }, [isDragging, touchedComponent, touchStartElement]);\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤\n  const { data: projects = [], isLoading } = useQuery<BotProject[]>({\n    queryKey: ['/api/projects'],\n  });\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞\n  const createProjectMutation = useMutation({\n    mutationFn: () => {\n      const projectCount = projects.length;\n      return apiRequest('POST', '/api/projects', {\n        name: `–ù–æ–≤—ã–π –±–æ—Ç ${projectCount + 1}`,\n        description: '',\n        data: {\n          nodes: [{\n            id: 'start',\n            type: 'start',\n            position: { x: 400, y: 300 }, // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞\n            data: {\n              messageText: '–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –Ω–æ–≤—ã–π –±–æ—Ç. –ù–∞–∂–º–∏—Ç–µ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏.',\n              keyboardType: 'none',\n              buttons: [],\n              command: '/start',\n              description: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞',\n              showInMenu: true,\n              isPrivateOnly: false,\n              requiresAuth: false,\n              adminOnly: false\n            }\n          }],\n          connections: []\n        }\n      });\n    },\n    onSuccess: (newProject: BotProject) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/projects'] });\n      toast({\n        title: \"–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω\",\n        description: `–ü—Ä–æ–µ–∫—Ç \"${newProject.name}\" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,\n      });\n      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç\n      if (onProjectSelect) {\n        onProjectSelect(newProject.id);\n      }\n    },\n    onError: () => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞\n  const deleteProjectMutation = useMutation({\n    mutationFn: (projectId: number) => apiRequest('DELETE', `/api/projects/${projectId}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/projects'] });\n      toast({\n        title: \"–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª–µ–Ω\",\n        description: \"–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n\n\n  const handleCreateProject = () => {\n    createProjectMutation.mutate();\n  };\n\n  const handleDeleteProject = (projectId: number) => {\n    const project = projects.find(p => p.id === projectId);\n    if (project && confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç \"${project.name}\"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {\n      deleteProjectMutation.mutate(project.id);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ inline —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—Å—Ç–æ–≤\n  const handleStartEditingSheet = (sheetId: string, currentName: string) => {\n    setEditingSheetId(sheetId);\n    setEditingSheetName(currentName);\n  };\n\n  const handleSaveSheetName = () => {\n    if (editingSheetId && editingSheetName.trim() && onSheetRename) {\n      onSheetRename(editingSheetId, editingSheetName.trim());\n    }\n    setEditingSheetId(null);\n    setEditingSheetName('');\n  };\n\n  const handleCancelEditingSheet = () => {\n    setEditingSheetId(null);\n    setEditingSheetName('');\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag-and-drop –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤\n  const handleProjectDragStart = (e: React.DragEvent, project: BotProject) => {\n    e.stopPropagation();\n    setDraggedProject(project);\n    e.dataTransfer.effectAllowed = 'move';\n    e.dataTransfer.setData('text/plain', project.id.toString());\n  };\n\n  const handleProjectDragOver = (e: React.DragEvent, projectId: number) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n    setDragOverProject(projectId);\n  };\n\n  const handleProjectDragLeave = () => {\n    setDragOverProject(null);\n  };\n\n  const handleProjectDrop = (e: React.DragEvent, targetProject: BotProject) => {\n    e.preventDefault();\n    setDragOverProject(null);\n    \n    if (!draggedProject || draggedProject.id === targetProject.id) {\n      setDraggedProject(null);\n      return;\n    }\n\n    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤\n    // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n    toast({\n      title: \"–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤\",\n      description: `–ü—Ä–æ–µ–∫—Ç \"${draggedProject.name}\" –ø–µ—Ä–µ–º–µ—â–µ–Ω`,\n    });\n    \n    setDraggedProject(null);\n  };\n\n  const handleProjectDragEnd = () => {\n    setDraggedProject(null);\n    setDragOverProject(null);\n  };\n\n  const formatDate = (dateString: string | Date | null) => {\n    if (!dateString) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('ru-RU', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getNodeCount = (project: BotProject) => {\n    if (!project.data || typeof project.data !== 'object') return 0;\n    \n    try {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ª–∏—Å—Ç–∞–º–∏ –∏–ª–∏ —Å—Ç–∞—Ä—ã–π\n      if (SheetsManager.isNewFormat(project.data)) {\n        const sheets = (project.data as any).sheets || [];\n        const nodeCount = sheets.reduce((total: number, sheet: any) => total + (sheet.nodes?.length || 0), 0);\n        console.log(`[${project.name}] –§–æ—Ä–º–∞—Ç —Å –ª–∏—Å—Ç–∞–º–∏. –õ–∏—Å—Ç–æ–≤: ${sheets.length}, –£–∑–ª–æ–≤: ${nodeCount}`);\n        return nodeCount;\n      } else {\n        const data = project.data as { nodes?: any[] };\n        const nodeCount = data.nodes?.length || 0;\n        console.log(`[${project.name}] –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç. –£–∑–ª–æ–≤: ${nodeCount}`);\n        return nodeCount;\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ —É–∑–ª–æ–≤:', error);\n      // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —É–∑–ª—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –¥–∞–Ω–Ω—ã—Ö\n      const fallbackData = project.data as any;\n      if (fallbackData.nodes && Array.isArray(fallbackData.nodes)) {\n        return fallbackData.nodes.length;\n      }\n      if (fallbackData.sheets && Array.isArray(fallbackData.sheets)) {\n        return fallbackData.sheets.reduce((total: number, sheet: any) => \n          total + (sheet.nodes ? sheet.nodes.length : 0), 0);\n      }\n      return 0;\n    }\n  };\n\n  const getSheetsInfo = (project: BotProject) => {\n    if (!project.data || typeof project.data !== 'object') return { count: 0, names: [] };\n    \n    try {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ª–∏—Å—Ç–∞–º–∏ –∏–ª–∏ —Å—Ç–∞—Ä—ã–π\n      if (SheetsManager.isNewFormat(project.data)) {\n        const sheets = (project.data as any).sheets || [];\n        const sheetsInfo = {\n          count: sheets.length,\n          names: sheets.map((sheet: any) => sheet.name || '–õ–∏—Å—Ç –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')\n        };\n        console.log(`[${project.name}] –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏—Å—Ç–∞—Ö:`, sheetsInfo);\n        return sheetsInfo;\n      } else {\n        // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç - –æ–¥–∏–Ω –ª–∏—Å—Ç\n        console.log(`[${project.name}] –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç - –æ–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –ª–∏—Å—Ç`);\n        return {\n          count: 1,\n          names: ['–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫']\n        };\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏—Å—Ç–∞—Ö:', error);\n      return {\n        count: 1,\n        names: ['–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫']\n      };\n    }\n  };\n\n  // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø–∞–Ω–µ–ª–∏\n  const SidebarContent = () => (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      {/* Sidebar Header */}\n      <div className=\"p-4 border-b border-border\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h2 className=\"text-sm font-semibold text-foreground\">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</h2>\n          {/* –ö–Ω–æ–ø–∫–∏ –º–∞–∫–µ—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ–≥–¥–∞ —Ç–æ–ª—å–∫–æ –ø–∞–Ω–µ–ª—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤–∏–¥–Ω–∞ */}\n          {showLayoutButtons && (\n            <LayoutButtons\n              onToggleCanvas={onToggleCanvas}\n              onToggleHeader={onToggleHeader}\n              onToggleProperties={onToggleProperties}\n              onShowFullLayout={onShowFullLayout}\n              canvasVisible={canvasVisible}\n              headerVisible={headerVisible}\n              propertiesVisible={propertiesVisible}\n              className=\"scale-75 -mr-2\"\n            />\n          )}\n        </div>\n        <div className=\"flex space-x-1 bg-muted rounded-lg p-1\">\n          <button \n            onClick={() => setCurrentTab('elements')}\n            className={`flex-1 px-1 py-1.5 text-xs font-medium rounded-md transition-colors ${\n              currentTab === 'elements' \n                ? 'bg-background text-foreground shadow-sm' \n                : 'text-muted-foreground hover:text-foreground'\n            }`}\n          >\n            –≠–ª–µ–º–µ–Ω—Ç—ã\n          </button>\n          <button \n            onClick={() => setCurrentTab('projects')}\n            className={`flex-1 px-1 py-1.5 text-xs font-medium rounded-md transition-colors ${\n              currentTab === 'projects' \n                ? 'bg-background text-foreground shadow-sm' \n                : 'text-muted-foreground hover:text-foreground'\n            }`}\n          >\n            –ü—Ä–æ–µ–∫—Ç—ã\n          </button>\n        </div>\n      </div>\n      \n      {/* Components List */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {currentTab === 'projects' && (\n          <div className=\"space-y-4\">\n            {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}\n            <div className=\"space-y-3 mb-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-sm font-semibold text-foreground\">\n                  –ü—Ä–æ–µ–∫—Ç—ã ({projects.length})\n                </h3>\n                <Button \n                  size=\"default\" \n                  variant=\"outline\" \n                  className=\"h-8 px-3 flex items-center gap-1\"\n                  onClick={handleCreateProject}\n                  disabled={createProjectMutation.isPending}\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  <span className=\"text-sm\">–ù–æ–≤—ã–π</span>\n                </Button>\n              </div>\n              \n            </div>\n\n            {/* –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ */}\n            {isLoading ? (\n              <div className=\"text-center py-4\">\n                <div className=\"w-6 h-6 bg-muted rounded-lg flex items-center justify-center mx-auto mb-2\">\n                  <i className=\"fas fa-spinner fa-spin text-muted-foreground text-xs\"></i>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">–ó–∞–≥—Ä—É–∑–∫–∞...</p>\n              </div>\n            ) : projects.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <div className=\"bg-muted/30 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                  <Home className=\"h-8 w-8 text-muted-foreground\" />\n                </div>\n                <h4 className=\"text-sm font-medium text-foreground mb-2\">–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤</h4>\n                <p className=\"text-xs text-muted-foreground mb-4\">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>\n                <Button size=\"default\" onClick={handleCreateProject} disabled={createProjectMutation.isPending} className=\"h-10 px-6\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  {createProjectMutation.isPending ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : '–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç'}\n                </Button>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {projects.map((project: BotProject) => (\n                  <div\n                    key={project.id}\n                    draggable\n                    onDragStart={(e) => handleProjectDragStart(e, project)}\n                    onDragOver={(e) => handleProjectDragOver(e, project.id)}\n                    onDragLeave={handleProjectDragLeave}\n                    onDrop={(e) => handleProjectDrop(e, project)}\n                    onDragEnd={handleProjectDragEnd}\n                    className={`group p-4 rounded-xl cursor-pointer transition-all duration-200 border-2 hover:shadow-lg ${\n                      currentProjectId === project.id \n                        ? 'bg-primary/10 border-primary/30 shadow-md' \n                        : 'bg-background border-border/50 hover:bg-muted/30 hover:border-border'\n                    } ${\n                      dragOverProject === project.id ? 'border-primary border-2 scale-105 shadow-lg' : ''\n                    } ${\n                      draggedProject?.id === project.id ? 'opacity-50 scale-95' : ''\n                    }`}\n                    onClick={() => onProjectSelect && onProjectSelect(project.id)}\n                  >\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div className=\"flex items-center flex-1 min-w-0\">\n                        <div className=\"cursor-grab active:cursor-grabbing mr-3 opacity-0 group-hover:opacity-100 transition-opacity\">\n                          <GripVertical className=\"h-5 w-5 text-muted-foreground\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <h4 className=\"text-base font-semibold text-foreground truncate mb-1\">\n                            {project.name}\n                          </h4>\n                          {project.description && (\n                            <p className=\"text-sm text-muted-foreground truncate\">\n                              {project.description}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          handleDeleteProject(project.id);\n                        }}\n                        className=\"h-8 w-8 p-0 text-muted-foreground hover:text-destructive opacity-0 group-hover:opacity-100 transition-opacity hover:bg-destructive/10\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                    \n                    <div className=\"space-y-3 text-sm text-muted-foreground\">\n                      <div className=\"flex items-center justify-between gap-3\">\n                        <span className=\"flex items-center bg-muted/50 px-2 py-1 rounded-md\">\n                          <User className=\"h-4 w-4 mr-2\" />\n                          <span className=\"font-medium\">{getNodeCount(project)}</span>\n                          <span className=\"ml-1\">—É–∑–ª–æ–≤</span>\n                        </span>\n                        <span className=\"flex items-center text-xs\">\n                          <Calendar className=\"h-3 w-3 mr-1\" />\n                          {formatDate(project.updatedAt)}\n                        </span>\n                      </div>\n                      \n                      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏—Å—Ç–∞—Ö */}\n                      {(() => {\n                        const sheetsInfo = getSheetsInfo(project);\n                        return (\n                          <div className=\"space-y-1\">\n                            <div className=\"flex items-center justify-between\">\n                              <div className=\"flex items-center text-sm text-muted-foreground\">\n                                <FileText className=\"h-4 w-4 mr-2\" />\n                                <span className=\"font-medium\">{sheetsInfo.count}</span>\n                                <span className=\"ml-1\">{sheetsInfo.count === 1 ? '–ª–∏—Å—Ç' : sheetsInfo.count < 5 ? '–ª–∏—Å—Ç–∞' : '–ª–∏—Å—Ç–æ–≤'}</span>\n                              </div>\n                              <Button \n                                variant=\"ghost\" \n                                size=\"sm\" \n                                className=\"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-muted\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  if (currentProjectId === project.id && onSheetAdd) {\n                                    const sheetsInfo = getSheetsInfo(project);\n                                    const newSheetName = `–õ–∏—Å—Ç ${sheetsInfo.count + 1}`;\n                                    onSheetAdd(newSheetName);\n                                  }\n                                }}\n                                title=\"–î–æ–±–∞–≤–∏—Ç—å –ª–∏—Å—Ç\"\n                              >\n                                <Plus className=\"h-3 w-3\" />\n                              </Button>\n                            </div>\n                            <div className=\"space-y-1\">\n                              {sheetsInfo.names.slice(0, 3).map((name: string, index: number) => {\n                                const projectData = project.data as any;\n                                const isActive = SheetsManager.isNewFormat(projectData) && \n                                  projectData.sheets && \n                                  projectData.sheets[index]?.id === projectData.activeSheetId;\n                                \n                                const sheetId = SheetsManager.isNewFormat(projectData) ? projectData.sheets[index]?.id : null;\n                                const isEditing = editingSheetId === sheetId;\n                                \n                                return (\n                                  <div key={index} className=\"flex items-center gap-2 group/sheet\">\n                                    {isEditing ? (\n                                      <Input\n                                        value={editingSheetName}\n                                        onChange={(e) => setEditingSheetName(e.target.value)}\n                                        onKeyDown={(e) => {\n                                          if (e.key === 'Enter') {\n                                            handleSaveSheetName();\n                                          } else if (e.key === 'Escape') {\n                                            handleCancelEditingSheet();\n                                          }\n                                        }}\n                                        onBlur={handleSaveSheetName}\n                                        autoFocus\n                                        className=\"text-xs px-3 py-1.5 h-7 flex-1 font-medium\"\n                                      />\n                                    ) : (\n                                      <Badge \n                                        variant={isActive ? \"default\" : \"secondary\"} \n                                        className={`text-xs px-3 py-1.5 h-7 cursor-pointer hover:opacity-80 transition-all flex-1 font-medium ${\n                                          isActive ? 'bg-primary text-primary-foreground shadow-sm' : ''\n                                        }`}\n                                        onClick={() => {\n                                          if (currentProjectId === project.id && onSheetSelect && SheetsManager.isNewFormat(projectData)) {\n                                            const sheetId = projectData.sheets[index]?.id;\n                                            if (sheetId) {\n                                              onSheetSelect(sheetId);\n                                            }\n                                          }\n                                        }}\n                                        onDoubleClick={() => {\n                                          // –í–∫–ª—é—á–∞–µ–º inline —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n                                          if (currentProjectId === project.id && SheetsManager.isNewFormat(projectData)) {\n                                            const sheetId = projectData.sheets[index]?.id;\n                                            if (sheetId) {\n                                              handleStartEditingSheet(sheetId, name);\n                                            }\n                                          }\n                                        }}\n                                        title={name}\n                                      >\n                                        <span className=\"block text-center w-full truncate\">{name}</span>\n                                      </Badge>\n                                    )}\n                                    \n                                    {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–æ–º */}\n                                    {currentProjectId === project.id && (\n                                      <div className=\"flex gap-1 opacity-0 group-hover/sheet:opacity-100 transition-opacity\">\n                                        <Button\n                                          variant=\"ghost\"\n                                          size=\"sm\"\n                                          className=\"h-6 w-6 p-0 hover:bg-muted\"\n                                          onClick={(e) => {\n                                            e.stopPropagation();\n                                            if (SheetsManager.isNewFormat(projectData)) {\n                                              const sheetId = projectData.sheets[index]?.id;\n                                              if (sheetId && onSheetDuplicate) {\n                                                onSheetDuplicate(sheetId);\n                                              }\n                                            }\n                                          }}\n                                          title=\"–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç\"\n                                        >\n                                          <Copy className=\"h-3 w-3\" />\n                                        </Button>\n                                        {sheetsInfo.count > 1 && (\n                                          <Button\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            className=\"h-6 w-6 p-0 text-destructive hover:text-destructive hover:bg-muted\"\n                                            onClick={(e) => {\n                                              e.stopPropagation();\n                                              if (SheetsManager.isNewFormat(projectData)) {\n                                                const sheetId = projectData.sheets[index]?.id;\n                                                if (sheetId && onSheetDelete) {\n                                                  onSheetDelete(sheetId);\n                                                }\n                                              }\n                                            }}\n                                            title=\"–£–¥–∞–ª–∏—Ç—å –ª–∏—Å—Ç\"\n                                          >\n                                            <Trash2 className=\"h-3 w-3\" />\n                                          </Button>\n                                        )}\n                                      </div>\n                                    )}\n                                  </div>\n                                );\n                              })}\n                              {sheetsInfo.names.length > 3 && (\n                                <div className=\"flex items-center gap-2\">\n                                  <Badge variant=\"secondary\" className=\"text-xs px-2 py-1 h-6\">\n                                    +{sheetsInfo.names.length - 3}\n                                  </Badge>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      })()}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n        \n        {currentTab === 'elements' && componentCategories.map((category) => {\n          const isCollapsed = collapsedCategories.has(category.title);\n          \n          return (\n            <div key={category.title}>\n              <button\n                onClick={() => toggleCategory(category.title)}\n                className=\"w-full flex items-center justify-between text-xs font-medium text-muted-foreground uppercase tracking-wider mb-2 hover:text-foreground transition-colors group\"\n              >\n                <span>{category.title}</span>\n                <div className=\"flex items-center gap-1\">\n                  <span className=\"text-xs normal-case bg-muted/50 px-2 py-0.5 rounded-full\">\n                    {category.components.length}\n                  </span>\n                  {isCollapsed ? (\n                    <ChevronRight className=\"h-3 w-3 group-hover:text-foreground transition-colors\" />\n                  ) : (\n                    <ChevronDown className=\"h-3 w-3 group-hover:text-foreground transition-colors\" />\n                  )}\n                </div>\n              </button>\n              \n              {!isCollapsed && (\n                <div className=\"space-y-2 transition-all duration-200 ease-in-out\">\n                  {category.components.map((component) => (\n                    <div\n                      key={component.id}\n                      draggable\n                      onDragStart={(e) => handleDragStart(e, component)}\n                      onTouchStart={(e) => handleTouchStart(e, component)}\n                      onTouchMove={handleTouchMove}\n                      onTouchEnd={handleTouchEnd}\n                      className={`component-item group flex items-center p-3 bg-muted/50 hover:bg-muted rounded-lg cursor-move transition-colors touch-action-none no-select ${\n                        touchedComponent?.id === component.id && isDragging ? 'opacity-50 scale-95' : ''\n                      }`}\n                    >\n                      <div className={cn(\"w-8 h-8 rounded-lg flex items-center justify-center mr-3\", component.color)}>\n                        <i className={`${component.icon} text-sm`}></i>\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium text-foreground\">{component.name}</p>\n                        <p className=\"text-xs text-muted-foreground\">{component.description}</p>\n                      </div>\n                      {onComponentAdd && (\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onComponentAdd(component);\n                          }}\n                          className=\"ml-2 w-6 h-6 rounded-full bg-primary/10 hover:bg-primary/20 text-primary flex items-center justify-center transition-colors opacity-0 group-hover:opacity-100 focus:opacity-100\"\n                          title={`–î–æ–±–∞–≤–∏—Ç—å ${component.name} –Ω–∞ —Ö–æ–ª—Å—Ç`}\n                        >\n                          <Plus className=\"h-3 w-3\" />\n                        </button>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n\n  // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Sheet –∏–∑ editor.tsx\n  if (isActuallyMobile || isMobile) {\n    return <SidebarContent />;\n  }\n\n  // –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è\n  return (\n    <aside className=\"w-full bg-background h-full flex flex-col overflow-hidden\">\n      <SidebarContent />\n    </aside>\n  );\n}\n","size_bytes":55856},"client/src/components/editor/connection-manager-panel.tsx":{"content":"import React, { useState, useCallback, useMemo } from 'react';\nimport { Node, Connection, Button } from '@shared/schema';\nimport { Badge } from '@/components/ui/badge';\nimport { Button as UIButton } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Switch } from '@/components/ui/switch';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Separator } from '@/components/ui/separator';\nimport { \n  ArrowRight, \n  Plus, \n  Trash2, \n  Edit3, \n  Zap, \n  Target, \n  Link, \n  AlertTriangle,\n  CheckCircle,\n  XCircle,\n  Network,\n  Settings,\n  Lightbulb,\n  Eye,\n  EyeOff,\n  RefreshCw,\n  Filter,\n  Search\n} from 'lucide-react';\nimport { ConnectionManager, ConnectionSuggestion } from '@/utils/connection-manager';\nimport { cn } from '@/lib/utils';\n\ninterface ConnectionManagerPanelProps {\n  nodes: Node[];\n  connections: Connection[];\n  onConnectionsChange: (connections: Connection[]) => void;\n  onNodesChange: (nodes: Node[]) => void;\n  autoButtonCreation: boolean;\n  onAutoButtonCreationChange: (enabled: boolean) => void;\n  selectedConnectionId?: string;\n  onConnectionSelect?: (connectionId: string | null) => void;\n}\n\nexport function ConnectionManagerPanel({\n  nodes,\n  connections,\n  onConnectionsChange,\n  onNodesChange,\n  autoButtonCreation,\n  onAutoButtonCreationChange,\n  selectedConnectionId,\n  onConnectionSelect\n}: ConnectionManagerPanelProps) {\n  const [suggestions, setSuggestions] = useState<ConnectionSuggestion[]>([]);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [showAdvanced, setShowAdvanced] = useState(false);\n  const [filterType, setFilterType] = useState<'all' | 'button' | 'direct'>('all');\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const connectionManager = useMemo(() => \n    new ConnectionManager({\n      nodes,\n      connections,\n      autoButtonCreation\n    }),\n    [nodes, connections, autoButtonCreation]\n  );\n\n  const connectionStats = useMemo(() => {\n    const total = connections.length;\n    const withButtons = connections.filter(conn => {\n      const sourceNode = nodes.find(n => n.id === conn.source);\n      return sourceNode?.data.buttons.some(b => b.action === 'goto' && b.target === conn.target);\n    }).length;\n    const orphaned = connections.filter(conn => {\n      const sourceNode = nodes.find(n => n.id === conn.source);\n      const targetNode = nodes.find(n => n.id === conn.target);\n      return !sourceNode || !targetNode;\n    }).length;\n\n    return { total, withButtons, direct: total - withButtons, orphaned };\n  }, [connections, nodes]);\n\n  const filteredConnections = useMemo(() => {\n    return connections.filter(conn => {\n      const sourceNode = nodes.find(n => n.id === conn.source);\n      const targetNode = nodes.find(n => n.id === conn.target);\n      \n      if (!sourceNode || !targetNode) return false;\n      \n      const hasButton = sourceNode.data.buttons.some(b => \n        b.action === 'goto' && b.target === conn.target\n      );\n      \n      if (filterType === 'button' && !hasButton) return false;\n      if (filterType === 'direct' && hasButton) return false;\n      \n      if (searchTerm) {\n        const sourceType = sourceNode.type;\n        const targetType = targetNode.type;\n        const searchLower = searchTerm.toLowerCase();\n        return sourceType.includes(searchLower) || targetType.includes(searchLower);\n      }\n      \n      return true;\n    });\n  }, [connections, nodes, filterType, searchTerm]);\n\n  const generateSuggestions = useCallback(async () => {\n    setIsGenerating(true);\n    try {\n      connectionManager.updateState({ nodes, connections });\n      const newSuggestions = connectionManager.generateConnectionSuggestions();\n      setSuggestions(newSuggestions);\n    } finally {\n      setIsGenerating(false);\n    }\n  }, [connectionManager, nodes, connections]);\n\n  const applySuggestion = useCallback((suggestion: ConnectionSuggestion) => {\n    try {\n      const { connection, updatedNodes } = connectionManager.createConnection(\n        suggestion.connection.source,\n        suggestion.connection.target,\n        {\n          autoCreateButton: autoButtonCreation,\n          buttonText: suggestion.suggestedButton.text,\n          buttonAction: suggestion.suggestedButton.action\n        }\n      );\n\n      onConnectionsChange([...connections, connection]);\n      onNodesChange(updatedNodes);\n      \n      // –£–¥–∞–ª—è–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ\n      setSuggestions(prev => prev.filter(s => s.id !== suggestion.id));\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:', error);\n    }\n  }, [connectionManager, connections, onConnectionsChange, onNodesChange, autoButtonCreation]);\n\n  const deleteConnection = useCallback((connectionId: string) => {\n    connectionManager.updateState({ nodes, connections });\n    const { removedConnection, updatedNodes } = connectionManager.removeConnection(connectionId);\n    \n    if (removedConnection) {\n      onConnectionsChange(connections.filter(c => c.id !== connectionId));\n      onNodesChange(updatedNodes);\n      \n      if (selectedConnectionId === connectionId) {\n        onConnectionSelect?.(null);\n      }\n    }\n  }, [connectionManager, nodes, connections, onConnectionsChange, onNodesChange, selectedConnectionId, onConnectionSelect]);\n\n  const syncButtonsWithConnections = useCallback(() => {\n    connectionManager.updateState({ nodes, connections });\n    const updatedNodes = connectionManager.syncButtonsWithConnections();\n    onNodesChange(updatedNodes);\n  }, [connectionManager, nodes, connections, onNodesChange]);\n\n  const cleanupOrphanedButtons = useCallback(() => {\n    connectionManager.updateState({ nodes, connections });\n    const updatedNodes = connectionManager.cleanupOrphanedButtons();\n    onNodesChange(updatedNodes);\n  }, [connectionManager, nodes, connections, onNodesChange]);\n\n  const getNodeName = useCallback((nodeId: string) => {\n    const node = nodes.find(n => n.id === nodeId);\n    if (!node) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª';\n    \n    const typeNames = {\n      start: '–°—Ç–∞—Ä—Ç',\n      command: node.data.command || '–ö–æ–º–∞–Ω–¥–∞',\n      message: '–°–æ–æ–±—â–µ–Ω–∏–µ',\n      keyboard: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞',\n      photo: '–§–æ—Ç–æ',\n      condition: '–£—Å–ª–æ–≤–∏–µ',\n      input: '–í–≤–æ–¥'\n    };\n    \n    return typeNames[node.type] || node.type;\n  }, [nodes]);\n\n  const getConnectionTypeIcon = useCallback((connection: Connection) => {\n    const sourceNode = nodes.find(n => n.id === connection.source);\n    const hasButton = sourceNode?.data.buttons.some(b => \n      b.action === 'goto' && b.target === connection.target\n    );\n    \n    return hasButton ? <Link className=\"h-4 w-4 text-green-500\" /> : <ArrowRight className=\"h-4 w-4 text-blue-500\" />;\n  }, [nodes]);\n\n  const getConfidenceColor = useCallback((confidence: number) => {\n    if (confidence >= 0.8) return 'text-green-600 bg-green-50 border-green-200';\n    if (confidence >= 0.6) return 'text-yellow-600 bg-yellow-50 border-yellow-200';\n    return 'text-red-600 bg-red-50 border-red-200';\n  }, []);\n\n  return (\n    <div className=\"w-full h-full bg-background\">\n      <Tabs defaultValue=\"connections\" className=\"w-full h-full\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"connections\">–°–≤—è–∑–∏</TabsTrigger>\n          <TabsTrigger value=\"suggestions\">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</TabsTrigger>\n          <TabsTrigger value=\"settings\">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"connections\" className=\"flex-1 mt-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Network className=\"h-5 w-5\" />\n                –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏\n              </CardTitle>\n              <CardDescription>\n                –í—Å–µ–≥–æ —Å–≤—è–∑–µ–π: {connectionStats.total} | –° –∫–Ω–æ–ø–∫–∞–º–∏: {connectionStats.withButtons} | –ü—Ä—è–º—ã–µ: {connectionStats.direct}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {/* –§–∏–ª—å—Ç—Ä—ã */}\n                <div className=\"flex flex-wrap gap-2\">\n                  <Select value={filterType} onValueChange={(value: typeof filterType) => setFilterType(value)}>\n                    <SelectTrigger className=\"w-32\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">–í—Å–µ</SelectItem>\n                      <SelectItem value=\"button\">–° –∫–Ω–æ–ø–∫–∞–º–∏</SelectItem>\n                      <SelectItem value=\"direct\">–ü—Ä—è–º—ã–µ</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  \n                  <Input\n                    placeholder=\"–ü–æ–∏—Å–∫...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"flex-1 min-w-0\"\n                  />\n                </div>\n\n                {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div className=\"flex items-center gap-2 p-2 bg-green-50 dark:bg-green-900/20 rounded\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                    <span className=\"text-sm\">–° –∫–Ω–æ–ø–∫–∞–º–∏: {connectionStats.withButtons}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded\">\n                    <ArrowRight className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                    <span className=\"text-sm\">–ü—Ä—è–º—ã–µ: {connectionStats.direct}</span>\n                  </div>\n                </div>\n\n                {/* –°–ø–∏—Å–æ–∫ —Å–≤—è–∑–µ–π */}\n                <ScrollArea className=\"h-64\">\n                  <div className=\"space-y-2\">\n                    {filteredConnections.map((connection) => (\n                      <div\n                        key={connection.id}\n                        className={cn(\n                          \"flex items-center justify-between p-3 border rounded-lg cursor-pointer transition-all hover:bg-accent\",\n                          selectedConnectionId === connection.id && \"bg-accent border-primary\"\n                        )}\n                        onClick={() => onConnectionSelect?.(connection.id)}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          {getConnectionTypeIcon(connection)}\n                          <div className=\"flex flex-col\">\n                            <span className=\"text-sm font-medium\">\n                              {getNodeName(connection.source)} ‚Üí {getNodeName(connection.target)}\n                            </span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              {connection.id}\n                            </span>\n                          </div>\n                        </div>\n                        \n                        <UIButton\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            deleteConnection(connection.id);\n                          }}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </UIButton>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n\n                {/* –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã */}\n                <div className=\"flex flex-wrap gap-2\">\n                  <UIButton\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={syncButtonsWithConnections}\n                  >\n                    <Zap className=\"h-4 w-4 mr-2\" />\n                    –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏\n                  </UIButton>\n                  <UIButton\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={cleanupOrphanedButtons}\n                  >\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    –û—á–∏—Å—Ç–∏—Ç—å –ª–∏—à–Ω–∏–µ –∫–Ω–æ–ø–∫–∏\n                  </UIButton>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"suggestions\" className=\"flex-1 mt-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Lightbulb className=\"h-5 w-5\" />\n                –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å–≤—è–∑–µ–π\n              </CardTitle>\n              <CardDescription>\n                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–æ—Ç–∞\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <UIButton\n                  onClick={generateSuggestions}\n                  disabled={isGenerating}\n                  className=\"w-full\"\n                >\n                  {isGenerating ? '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...' : '–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è'}\n                </UIButton>\n\n                <ScrollArea className=\"h-64\">\n                  <div className=\"space-y-3\">\n                    {suggestions.map((suggestion) => (\n                      <div\n                        key={suggestion.id}\n                        className=\"p-3 border rounded-lg space-y-2\"\n                      >\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-2\">\n                            <Target className=\"h-4 w-4\" />\n                            <span className=\"font-medium text-sm\">\n                              {getNodeName(suggestion.connection.source)} ‚Üí {getNodeName(suggestion.connection.target)}\n                            </span>\n                          </div>\n                          <Badge className={cn(\"text-xs\", getConfidenceColor(suggestion.confidence))}>\n                            {Math.round(suggestion.confidence * 100)}%\n                          </Badge>\n                        </div>\n                        \n                        <p className=\"text-xs text-muted-foreground\">\n                          {suggestion.reason}\n                        </p>\n                        \n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-2\">\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {suggestion.suggestedButton.text}\n                            </Badge>\n                            <Badge variant=\"secondary\" className=\"text-xs\">\n                              {suggestion.suggestedButton.action}\n                            </Badge>\n                          </div>\n                          \n                          <UIButton\n                            size=\"sm\"\n                            onClick={() => applySuggestion(suggestion)}\n                            disabled={suggestion.confidence < 0.5}\n                          >\n                            <Plus className=\"h-3 w-3 mr-1\" />\n                            –ü—Ä–∏–º–µ–Ω–∏—Ç—å\n                          </UIButton>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"settings\" className=\"flex-1 mt-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Settings className=\"h-5 w-5\" />\n                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤—è–∑–µ–π\n              </CardTitle>\n              <CardDescription>\n                –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–≤—è–∑–µ–π\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"auto-button-creation\">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–≤—è–∑–µ–π\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"auto-button-creation\"\n                    checked={autoButtonCreation}\n                    onCheckedChange={onAutoButtonCreationChange}\n                  />\n                </div>\n\n                <Separator />\n\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"show-advanced\">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"show-advanced\"\n                    checked={showAdvanced}\n                    onCheckedChange={setShowAdvanced}\n                  />\n                </div>\n\n                {showAdvanced && (\n                  <div className=\"space-y-4 p-4 bg-muted/50 rounded-lg\">\n                    <h4 className=\"font-medium\">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>\n                    \n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <Label htmlFor=\"validate-connections\">–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–µ–π</Label>\n                        <Switch id=\"validate-connections\" />\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between\">\n                        <Label htmlFor=\"auto-cleanup\">–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞</Label>\n                        <Switch id=\"auto-cleanup\" />\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between\">\n                        <Label htmlFor=\"smart-suggestions\">–£–º–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</Label>\n                        <Switch id=\"smart-suggestions\" defaultChecked />\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                <Separator />\n\n                {/* –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ */}\n                <div className=\"space-y-4\">\n                  <h4 className=\"font-medium\">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h4>\n                  \n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"p-3 bg-card border rounded-lg\">\n                      <div className=\"flex items-center gap-2\">\n                        <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                        <span className=\"text-sm\">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–≤—è–∑–∏</span>\n                      </div>\n                      <p className=\"text-2xl font-bold text-green-600\">\n                        {connectionStats.total - connectionStats.orphaned}\n                      </p>\n                    </div>\n                    \n                    <div className=\"p-3 bg-card border rounded-lg\">\n                      <div className=\"flex items-center gap-2\">\n                        <XCircle className=\"h-4 w-4 text-red-500\" />\n                        <span className=\"text-sm\">–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ</span>\n                      </div>\n                      <p className=\"text-2xl font-bold text-red-600\">\n                        {connectionStats.orphaned}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":20700},"client/src/components/editor/connection-visualization.tsx":{"content":"import React, { useState, useCallback, useMemo } from 'react';\nimport { Node, Connection, Button } from '@/types/bot';\nimport { Badge } from '@/components/ui/badge';\nimport { Button as UIButton } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { \n  ArrowRight, \n  Link, \n  AlertTriangle, \n  CheckCircle, \n  XCircle, \n  Zap,\n  Eye,\n  Edit3,\n  Trash2,\n  MousePointer,\n  Network,\n  Target\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface ConnectionVisualizationProps {\n  nodes: Node[];\n  connections: Connection[];\n  onConnectionSelect?: (connection: Connection) => void;\n  onConnectionDelete?: (connectionId: string) => void;\n  onConnectionEdit?: (connection: Connection) => void;\n  selectedConnectionId?: string;\n  showLabels?: boolean;\n  showMetrics?: boolean;\n  interactive?: boolean;\n}\n\ninterface ConnectionMetrics {\n  id: string;\n  strength: number;\n  usage: number;\n  importance: number;\n  hasButton: boolean;\n  buttonType?: 'goto' | 'command' | 'url';\n  isValid: boolean;\n  errors: string[];\n  suggestions: string[];\n}\n\nexport function ConnectionVisualization({\n  nodes,\n  connections,\n  onConnectionSelect,\n  onConnectionDelete,\n  onConnectionEdit,\n  selectedConnectionId,\n  showLabels = true,\n  showMetrics = true,\n  interactive = true\n}: ConnectionVisualizationProps) {\n  const [hoveredConnectionId, setHoveredConnectionId] = useState<string | null>(null);\n  const [viewMode, setViewMode] = useState<'all' | 'strong' | 'weak' | 'problematic'>('all');\n\n  // –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∏\n  const connectionMetrics = useMemo(() => {\n    return connections.map(connection => {\n      const sourceNode = nodes.find(n => n.id === connection.source);\n      const targetNode = nodes.find(n => n.id === connection.target);\n      \n      if (!sourceNode || !targetNode) {\n        return {\n          id: connection.id,\n          strength: 0,\n          usage: 0,\n          importance: 0,\n          hasButton: false,\n          isValid: false,\n          errors: ['–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∏–ª–∏ —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª'],\n          suggestions: ['–£–¥–∞–ª–∏—Ç—å –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â—É—é —Å–≤—è–∑—å']\n        } as ConnectionMetrics;\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–Ω–æ–ø–∫–∏\n      const relatedButton = sourceNode.data.buttons?.find(b => \n        b.action === 'goto' && b.target === connection.target\n      );\n\n      // –†–∞—Å—á–µ—Ç —Å–∏–ª—ã —Å–≤—è–∑–∏\n      let strength = 0.5;\n      if (relatedButton) strength += 0.3;\n      if (sourceNode.type === 'start') strength += 0.2;\n      if (targetNode.type === 'message') strength += 0.1;\n\n      // –†–∞—Å—á–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç–∏\n      let importance = 0.5;\n      if (sourceNode.type === 'start') importance += 0.3;\n      if (relatedButton) importance += 0.2;\n      const connectionsFromSource = connections.filter(c => c.source === connection.source).length;\n      importance += Math.min(0.2, connectionsFromSource * 0.05);\n\n      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏\n      const errors: string[] = [];\n      const suggestions: string[] = [];\n\n      if (!relatedButton && ['message', 'photo', 'keyboard'].includes(sourceNode.type)) {\n        errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞');\n        suggestions.push('–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞');\n      }\n\n      if (connectionsFromSource > 10) {\n        errors.push('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–≤—è–∑–µ–π –æ—Ç –æ–¥–Ω–æ–≥–æ —É–∑–ª–∞');\n        suggestions.push('–†–∞–∑–±–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤');\n      }\n\n      const isValid = errors.length === 0;\n\n      return {\n        id: connection.id,\n        strength,\n        usage: Math.random() * 100, // –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —ç—Ç–æ –±—É–¥–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n        importance,\n        hasButton: !!relatedButton,\n        buttonType: relatedButton?.action,\n        isValid,\n        errors,\n        suggestions\n      } as ConnectionMetrics;\n    });\n  }, [connections, nodes]);\n\n  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–∂–∏–º—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞\n  const filteredConnections = useMemo(() => {\n    const filtered = connectionMetrics.filter(metrics => {\n      switch (viewMode) {\n        case 'strong':\n          return metrics.strength >= 0.7;\n        case 'weak':\n          return metrics.strength < 0.5;\n        case 'problematic':\n          return !metrics.isValid;\n        default:\n          return true;\n      }\n    });\n\n    return filtered.map(metrics => ({\n      connection: connections.find(c => c.id === metrics.id)!,\n      metrics\n    }));\n  }, [connectionMetrics, connections, viewMode]);\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Å–≤—è–∑–∏\n  const getConnectionColor = useCallback((metrics: ConnectionMetrics) => {\n    if (!metrics.isValid) return 'rgb(239, 68, 68)'; // red-500\n    if (metrics.strength >= 0.8) return 'rgb(34, 197, 94)'; // green-500\n    if (metrics.strength >= 0.6) return 'rgb(59, 130, 246)'; // blue-500\n    if (metrics.strength >= 0.4) return 'rgb(245, 158, 11)'; // yellow-500\n    return 'rgb(156, 163, 175)'; // gray-400\n  }, []);\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ª—â–∏–Ω—ã –ª–∏–Ω–∏–∏\n  const getConnectionWidth = useCallback((metrics: ConnectionMetrics) => {\n    return Math.max(1, Math.floor(metrics.strength * 5));\n  }, []);\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —É–∑–ª–∞\n  const getNodeName = useCallback((nodeId: string) => {\n    const node = nodes.find(n => n.id === nodeId);\n    if (!node) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª';\n    \n    const typeNames = {\n      start: '–°—Ç–∞—Ä—Ç',\n      command: node.data.command || '–ö–æ–º–∞–Ω–¥–∞',\n      message: '–°–æ–æ–±—â–µ–Ω–∏–µ',\n      keyboard: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞',\n      photo: '–§–æ—Ç–æ',\n      video: '–í–∏–¥–µ–æ',\n      audio: '–ê—É–¥–∏–æ',\n      document: '–î–æ–∫—É–º–µ–Ω—Ç',\n      condition: '–£—Å–ª–æ–≤–∏–µ',\n      input: '–í–≤–æ–¥',\n      'user-input': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥',\n      sticker: '–°—Ç–∏–∫–µ—Ä',\n      voice: '–ì–æ–ª–æ—Å–æ–≤–æ–µ',\n      animation: '–ê–Ω–∏–º–∞—Ü–∏—è',\n      location: '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è',\n      contact: '–ö–æ–Ω—Ç–∞–∫—Ç',\n      poll: '–û–ø—Ä–æ—Å',\n      dice: '–ö—É–±–∏–∫'\n    };\n    \n    return typeNames[node.type] || node.type;\n  }, [nodes]);\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ —Ç–∏–ø–∞ —Å–≤—è–∑–∏\n  const getConnectionIcon = useCallback((metrics: ConnectionMetrics) => {\n    if (!metrics.hasButton) return <ArrowRight className=\"h-4 w-4\" />;\n    \n    switch (metrics.buttonType) {\n      case 'command':\n        return <Zap className=\"h-4 w-4\" />;\n      case 'url':\n        return <Link className=\"h-4 w-4\" />;\n      default:\n        return <MousePointer className=\"h-4 w-4\" />;\n    }\n  }, []);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Network className=\"h-5 w-5\" />\n            –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–µ–π\n          </CardTitle>\n          <CardDescription>\n            –ê–Ω–∞–ª–∏–∑ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –±–æ—Ç–∞\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {/* –§–∏–ª—å—Ç—Ä—ã */}\n          <div className=\"flex gap-2 mb-4\">\n            <UIButton\n              variant={viewMode === 'all' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setViewMode('all')}\n            >\n              –í—Å–µ —Å–≤—è–∑–∏\n            </UIButton>\n            <UIButton\n              variant={viewMode === 'strong' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setViewMode('strong')}\n            >\n              –°–∏–ª—å–Ω—ã–µ\n            </UIButton>\n            <UIButton\n              variant={viewMode === 'weak' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setViewMode('weak')}\n            >\n              –°–ª–∞–±—ã–µ\n            </UIButton>\n            <UIButton\n              variant={viewMode === 'problematic' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setViewMode('problematic')}\n            >\n              –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ\n            </UIButton>\n          </div>\n\n          {/* –õ–µ–≥–µ–Ω–¥–∞ */}\n          <div className=\"flex flex-wrap gap-4 mb-4 p-3 bg-muted/50 rounded-lg\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-1 bg-green-500 rounded\"></div>\n              <span className=\"text-sm\">–°–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-1 bg-blue-500 rounded\"></div>\n              <span className=\"text-sm\">–°—Ä–µ–¥–Ω—è—è —Å–≤—è–∑—å</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-1 bg-yellow-500 rounded\"></div>\n              <span className=\"text-sm\">–°–ª–∞–±–∞—è —Å–≤—è–∑—å</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-1 bg-red-500 rounded\"></div>\n              <span className=\"text-sm\">–ü—Ä–æ–±–ª–µ–º–Ω–∞—è —Å–≤—è–∑—å</span>\n            </div>\n          </div>\n\n          {/* –ú–µ—Ç—Ä–∏–∫–∏ */}\n          {showMetrics && (\n            <div className=\"grid grid-cols-4 gap-4 mb-4\">\n              <div className=\"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                  {filteredConnections.length}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">–ü–æ–∫–∞–∑–∞–Ω–æ —Å–≤—è–∑–µ–π</div>\n              </div>\n              <div className=\"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                  {filteredConnections.filter(({ metrics }) => metrics.isValid).length}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">–í–∞–ª–∏–¥–Ω—ã—Ö</div>\n              </div>\n              <div className=\"text-center p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg\">\n                <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">\n                  {filteredConnections.filter(({ metrics }) => metrics.hasButton).length}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">–° –∫–Ω–æ–ø–∫–∞–º–∏</div>\n              </div>\n              <div className=\"text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\n                <div className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">\n                  {Math.round(filteredConnections.reduce((sum, { metrics }) => sum + metrics.strength, 0) / filteredConnections.length * 100) || 0}%\n                </div>\n                <div className=\"text-sm text-muted-foreground\">–°—Ä–µ–¥–Ω—è—è —Å–∏–ª–∞</div>\n              </div>\n            </div>\n          )}\n\n          {/* –°–ø–∏—Å–æ–∫ —Å–≤—è–∑–µ–π */}\n          <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n            <TooltipProvider>\n              {filteredConnections.map(({ connection, metrics }) => (\n                <Tooltip key={connection.id}>\n                  <TooltipTrigger asChild>\n                    <div\n                      className={cn(\n                        \"p-3 border rounded-lg transition-all duration-200\",\n                        interactive && \"cursor-pointer hover:bg-accent\",\n                        selectedConnectionId === connection.id && \"bg-accent border-primary\",\n                        hoveredConnectionId === connection.id && \"shadow-md\",\n                        !metrics.isValid && \"border-red-200 bg-red-50 dark:bg-red-900/10\"\n                      )}\n                      onClick={() => interactive && onConnectionSelect?.(connection)}\n                      onMouseEnter={() => setHoveredConnectionId(connection.id)}\n                      onMouseLeave={() => setHoveredConnectionId(null)}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          {/* –ò–∫–æ–Ω–∫–∞ —Ç–∏–ø–∞ —Å–≤—è–∑–∏ */}\n                          <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-muted\">\n                            {getConnectionIcon(metrics)}\n                          </div>\n                          \n                          {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–≤—è–∑–∏ */}\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <span className=\"font-medium text-sm\">\n                                {getNodeName(connection.source)} ‚Üí {getNodeName(connection.target)}\n                              </span>\n                              \n                              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ */}\n                              {metrics.isValid ? (\n                                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                              ) : (\n                                <XCircle className=\"h-4 w-4 text-red-500\" />\n                              )}\n                            </div>\n                            \n                            {/* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å–∏–ª—ã —Å–≤—è–∑–∏ */}\n                            <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n                              <div\n                                className=\"h-2 rounded-full transition-all duration-300\"\n                                style={{\n                                  width: `${metrics.strength * 100}%`,\n                                  backgroundColor: getConnectionColor(metrics)\n                                }}\n                              />\n                            </div>\n                            \n                            {/* –ú–µ—Ç—Ä–∏–∫–∏ */}\n                            <div className=\"flex gap-2 mt-1\">\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                –°–∏–ª–∞: {Math.round(metrics.strength * 100)}%\n                              </Badge>\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                –í–∞–∂–Ω–æ—Å—Ç—å: {Math.round(metrics.importance * 100)}%\n                              </Badge>\n                              {metrics.hasButton && (\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  {metrics.buttonType === 'goto' ? '–ü–µ—Ä–µ—Ö–æ–¥' : \n                                   metrics.buttonType === 'command' ? '–ö–æ–º–∞–Ω–¥–∞' : '–°—Å—ã–ª–∫–∞'}\n                                </Badge>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                        \n                        {/* –î–µ–π—Å—Ç–≤–∏—è */}\n                        {interactive && (\n                          <div className=\"flex gap-1\">\n                            <UIButton\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                onConnectionEdit?.(connection);\n                              }}\n                            >\n                              <Edit3 className=\"h-4 w-4\" />\n                            </UIButton>\n                            <UIButton\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                onConnectionDelete?.(connection.id);\n                              }}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </UIButton>\n                          </div>\n                        )}\n                      </div>\n                      \n                      {/* –û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è */}\n                      {(!metrics.isValid && metrics.errors.length > 0) && (\n                        <div className=\"mt-2 space-y-1\">\n                          {metrics.errors.map((error, idx) => (\n                            <div key={idx} className=\"flex items-center gap-2 text-xs text-red-600\">\n                              <AlertTriangle className=\"h-3 w-3\" />\n                              {error}\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                      \n                      {metrics.suggestions.length > 0 && (\n                        <div className=\"mt-2 flex flex-wrap gap-1\">\n                          {metrics.suggestions.map((suggestion, idx) => (\n                            <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                              üí° {suggestion}\n                            </Badge>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  </TooltipTrigger>\n                  <TooltipContent>\n                    <div className=\"space-y-1\">\n                      <p className=\"font-medium\">–°–≤—è–∑—å {connection.id}</p>\n                      <p className=\"text-sm\">–°–∏–ª–∞: {Math.round(metrics.strength * 100)}%</p>\n                      <p className=\"text-sm\">–í–∞–∂–Ω–æ—Å—Ç—å: {Math.round(metrics.importance * 100)}%</p>\n                      {metrics.hasButton && (\n                        <p className=\"text-sm\">–¢–∏–ø –∫–Ω–æ–ø–∫–∏: {metrics.buttonType}</p>\n                      )}\n                    </div>\n                  </TooltipContent>\n                </Tooltip>\n              ))}\n            </TooltipProvider>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":18208},"client/src/components/editor/database-backup-panel.tsx":{"content":"import { useState } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { \n  Download, \n  Upload, \n  Database, \n  Shield, \n  Trash2, \n  RefreshCw, \n  FileText, \n  Calendar, \n  HardDrive, \n  BarChart3,\n  AlertTriangle,\n  CheckCircle,\n  Archive,\n  CloudDownload,\n  Plus\n} from 'lucide-react';\n\ninterface BackupFile {\n  filename: string;\n  filepath: string;\n  size: number;\n  created: Date;\n  metadata?: {\n    version: string;\n    timestamp: string;\n    description?: string;\n    tables: string[];\n  };\n}\n\ninterface DatabaseStats {\n  tables: Array<{\n    name: string;\n    count: number;\n    size: string;\n  }>;\n  totalRecords: number;\n  estimatedSize: string;\n}\n\nexport function DatabaseBackupPanel() {\n  const [newBackupDescription, setNewBackupDescription] = useState('');\n  const [uploadFile, setUploadFile] = useState<File | null>(null);\n  const [restoreImmediately, setRestoreImmediately] = useState(false);\n  const [clearExisting, setClearExisting] = useState(false);\n  const [isUploading, setIsUploading] = useState(false);\n  const [showBackupDialog, setShowBackupDialog] = useState(false);\n  const [showUploadDialog, setShowUploadDialog] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π\n  const { data: backupsData, isLoading: backupsLoading } = useQuery({\n    queryKey: ['database/backups'],\n    queryFn: () => apiRequest('GET', '/api/database/backups'),\n    staleTime: 30000\n  });\n\n  // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n  const { data: statsData, isLoading: statsLoading } = useQuery({\n    queryKey: ['database/stats'],\n    queryFn: () => apiRequest('GET', '/api/database/stats/detailed'),\n    staleTime: 60000\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\n  const createBackupMutation = useMutation({\n    mutationFn: (description: string) => \n      apiRequest('POST', '/api/database/backup', { description }),\n    onSuccess: () => {\n      toast({\n        title: \"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞\",\n        description: \"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ\"\n      });\n      queryClient.invalidateQueries({ queryKey: ['database/backups'] });\n      setNewBackupDescription('');\n      setShowBackupDialog(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\n  const restoreBackupMutation = useMutation({\n    mutationFn: ({ filename, options }: { filename: string; options: any }) => \n      apiRequest('POST', '/api/database/restore', { filename, options }),\n    onSuccess: () => {\n      toast({\n        title: \"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞\",\n        description: \"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\"\n      });\n      queryClient.invalidateQueries({ queryKey: ['database/stats'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\n  const deleteBackupMutation = useMutation({\n    mutationFn: (filename: string) => \n      apiRequest('DELETE', `/api/database/backup/${filename}`),\n    onSuccess: () => {\n      toast({\n        title: \"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É–¥–∞–ª–µ–Ω–∞\",\n        description: \"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞\"\n      });\n      queryClient.invalidateQueries({ queryKey: ['database/backups'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞\n  const handleFileUpload = async () => {\n    if (!uploadFile) return;\n\n    setIsUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append('backup', uploadFile);\n      formData.append('restoreImmediately', restoreImmediately.toString());\n      formData.append('clearExisting', clearExisting.toString());\n\n      const response = await fetch('/api/database/backup/upload', {\n        method: 'POST',\n        body: formData\n      });\n\n      const result = await response.json();\n      \n      if (result.success) {\n        toast({\n          title: \"–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω\",\n          description: result.message\n        });\n        queryClient.invalidateQueries({ queryKey: ['database/backups'] });\n        if (result.restored) {\n          queryClient.invalidateQueries({ queryKey: ['database/stats'] });\n        }\n        setShowUploadDialog(false);\n      } else {\n        throw new Error(result.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª');\n      }\n    } catch (error: any) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsUploading(false);\n      setUploadFile(null);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏\n  const handleDownloadBackup = (filename: string) => {\n    const downloadUrl = `/api/database/backup/${filename}`;\n    const link = document.createElement('a');\n    link.href = downloadUrl;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const backups: BackupFile[] = backupsData?.backups || [];\n  const stats: DatabaseStats = statsData?.stats || { tables: [], totalRecords: 0, estimatedSize: 'N/A' };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Archive className=\"w-5 h-5\" />\n            –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏\n          </h3>\n          <p className=\"text-sm text-muted-foreground\">\n            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Dialog open={showBackupDialog} onOpenChange={setShowBackupDialog}>\n            <DialogTrigger asChild>\n              <Button size=\"sm\" variant=\"outline\">\n                <Plus className=\"w-4 h-4 mr-1\" />\n                –°–æ–∑–¥–∞—Ç—å\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</DialogTitle>\n                <DialogDescription>\n                  –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"backup-description\">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</Label>\n                  <Textarea\n                    id=\"backup-description\"\n                    placeholder=\"–û–ø–∏—à–∏—Ç–µ —Ü–µ–ª—å —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...\"\n                    value={newBackupDescription}\n                    onChange={(e) => setNewBackupDescription(e.target.value)}\n                    rows={3}\n                  />\n                </div>\n                <Button \n                  onClick={() => createBackupMutation.mutate(newBackupDescription)}\n                  disabled={createBackupMutation.isPending}\n                  className=\"w-full\"\n                >\n                  {createBackupMutation.isPending ? (\n                    <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n                  ) : (\n                    <Archive className=\"w-4 h-4 mr-2\" />\n                  )}\n                  –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n\n          <Dialog open={showUploadDialog} onOpenChange={setShowUploadDialog}>\n            <DialogTrigger asChild>\n              <Button size=\"sm\" variant=\"outline\">\n                <Upload className=\"w-4 h-4 mr-1\" />\n                –ó–∞–≥—Ä—É–∑–∏—Ç—å\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</DialogTitle>\n                <DialogDescription>\n                  –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"backup-file\">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</Label>\n                  <Input\n                    id=\"backup-file\"\n                    type=\"file\"\n                    accept=\".json\"\n                    onChange={(e) => setUploadFile(e.target.files?.[0] || null)}\n                  />\n                </div>\n                \n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Switch\n                      id=\"restore-immediately\"\n                      checked={restoreImmediately}\n                      onCheckedChange={setRestoreImmediately}\n                    />\n                    <Label htmlFor=\"restore-immediately\">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ</Label>\n                  </div>\n                  \n                  {restoreImmediately && (\n                    <div className=\"flex items-center space-x-2 ml-6\">\n                      <Switch\n                        id=\"clear-existing\"\n                        checked={clearExisting}\n                        onCheckedChange={setClearExisting}\n                      />\n                      <Label htmlFor=\"clear-existing\">–û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ</Label>\n                    </div>\n                  )}\n                </div>\n\n                <Button \n                  onClick={handleFileUpload}\n                  disabled={!uploadFile || isUploading}\n                  className=\"w-full\"\n                >\n                  {isUploading ? (\n                    <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n                  ) : (\n                    <CloudDownload className=\"w-4 h-4 mr-2\" />\n                  )}\n                  –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2 text-sm\">\n            <BarChart3 className=\"w-4 h-4\" />\n            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {statsLoading ? (\n            <div className=\"flex items-center gap-2 text-sm\">\n              <RefreshCw className=\"w-4 h-4 animate-spin\" />\n              –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              <div className=\"grid grid-cols-3 gap-3\">\n                <div className=\"text-center\">\n                  <div className=\"text-lg font-bold\">{stats.totalRecords.toLocaleString()}</div>\n                  <div className=\"text-xs text-muted-foreground\">–ó–∞–ø–∏—Å–∏</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-lg font-bold\">{stats.tables.length}</div>\n                  <div className=\"text-xs text-muted-foreground\">–¢–∞–±–ª–∏—Ü—ã</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-lg font-bold\">{stats.estimatedSize}</div>\n                  <div className=\"text-xs text-muted-foreground\">–†–∞–∑–º–µ—Ä</div>\n                </div>\n              </div>\n              \n              <Separator />\n              \n              <div className=\"space-y-2\">\n                <div className=\"text-sm font-medium\">–¢–∞–±–ª–∏—Ü—ã:</div>\n                <div className=\"space-y-1\">\n                  {stats.tables.map((table, index) => (\n                    <div key={index} className=\"flex items-center justify-between text-xs\">\n                      <div className=\"flex items-center gap-1\">\n                        <FileText className=\"w-3 h-3\" />\n                        <span>{table.name}</span>\n                      </div>\n                      <span className=\"text-muted-foreground\">{table.count.toLocaleString()}</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* –°–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2 text-sm\">\n            <Archive className=\"w-4 h-4\" />\n            –°–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π ({backups.length})\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {backupsLoading ? (\n            <div className=\"flex items-center gap-2 text-sm\">\n              <RefreshCw className=\"w-4 h-4 animate-spin\" />\n              –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π...\n            </div>\n          ) : backups.length === 0 ? (\n            <div className=\"text-center py-6 text-muted-foreground\">\n              <Archive className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n              <p className=\"text-sm\">–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>\n              <p className=\"text-xs\">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</p>\n            </div>\n          ) : (\n            <div className=\"space-y-2\">\n              {backups.map((backup, index) => (\n                <div key={index} className=\"p-3 border rounded-lg\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <FileText className=\"w-3 h-3 flex-shrink-0\" />\n                        <span className=\"text-sm font-medium truncate\">{backup.filename}</span>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {backup.metadata?.version || 'v1.0.0'}\n                        </Badge>\n                      </div>\n                      <div className=\"text-xs text-muted-foreground space-y-1\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"flex items-center gap-1\">\n                            <Calendar className=\"w-3 h-3\" />\n                            {new Date(backup.created).toLocaleDateString()}\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            <HardDrive className=\"w-3 h-3\" />\n                            {formatFileSize(backup.size)}\n                          </div>\n                        </div>\n                        {backup.metadata?.description && (\n                          <p className=\"text-xs truncate\">{backup.metadata.description}</p>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => handleDownloadBackup(backup.filename)}\n                      >\n                        <Download className=\"w-3 h-3\" />\n                      </Button>\n                      <Dialog>\n                        <DialogTrigger asChild>\n                          <Button size=\"sm\" variant=\"ghost\">\n                            <RefreshCw className=\"w-3 h-3\" />\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                          <DialogHeader>\n                            <DialogTitle>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</DialogTitle>\n                            <DialogDescription>\n                              –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ {backup.filename}\n                            </DialogDescription>\n                          </DialogHeader>\n                          <div className=\"space-y-4\">\n                            <div className=\"flex items-center space-x-2\">\n                              <Switch\n                                id=\"restore-clear\"\n                                checked={clearExisting}\n                                onCheckedChange={setClearExisting}\n                              />\n                              <Label htmlFor=\"restore-clear\">–û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ</Label>\n                            </div>\n                            <div className=\"flex items-center gap-2 p-3 bg-muted rounded-lg\">\n                              <AlertTriangle className=\"w-4 h-4 text-orange-500\" />\n                              <span className=\"text-sm\">\n                                –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–∏—Ç —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ\n                              </span>\n                            </div>\n                            <Button\n                              onClick={() => restoreBackupMutation.mutate({ \n                                filename: backup.filename, \n                                options: { clearExisting } \n                              })}\n                              disabled={restoreBackupMutation.isPending}\n                              className=\"w-full\"\n                            >\n                              {restoreBackupMutation.isPending ? (\n                                <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n                              ) : (\n                                <CheckCircle className=\"w-4 h-4 mr-2\" />\n                              )}\n                              –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å\n                            </Button>\n                          </div>\n                        </DialogContent>\n                      </Dialog>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => deleteBackupMutation.mutate(backup.filename)}\n                        disabled={deleteBackupMutation.isPending}\n                      >\n                        <Trash2 className=\"w-3 h-3\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":20591},"client/src/components/editor/emoji-picker.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Smile, \n  Heart, \n  Star, \n  Zap, \n  Search,\n  Copy,\n  Sparkles\n} from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface EmojiPickerProps {\n  onEmojiSelect: (emoji: string) => void;\n  onSymbolSelect: (symbol: string) => void;\n}\n\ninterface EmojiCategory {\n  name: string;\n  icon: React.ComponentType<{ className?: string }>;\n  emojis: string[];\n}\n\ninterface SymbolCategory {\n  name: string;\n  symbols: Array<{\n    symbol: string;\n    name: string;\n    description: string;\n  }>;\n}\n\nexport function EmojiPicker({ onEmojiSelect, onSymbolSelect }: EmojiPickerProps) {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [activeTab, setActiveTab] = useState<'emojis' | 'symbols' | 'templates'>('emojis');\n  const { toast } = useToast();\n\n  const emojiCategories: EmojiCategory[] = [\n    {\n      name: '–≠–º–æ—Ü–∏–∏',\n      icon: Smile,\n      emojis: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü§©', 'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', '‚òπÔ∏è', 'üò£', 'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨', 'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó', 'ü§î', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü§ê', 'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï']\n    },\n    {\n      name: '–ñ–µ—Å—Ç—ã',\n      icon: Heart,\n      emojis: ['üëç', 'üëé', 'üëå', 'ü§å', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï', 'üëá', '‚òùÔ∏è', 'üëã', 'ü§ö', 'üñêÔ∏è', '‚úã', 'üññ', 'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè', '‚úçÔ∏è', 'üí™', 'ü¶æ', 'ü¶ø', 'ü¶µ', 'ü¶∂', 'üëÇ', 'ü¶ª', 'üëÉ', 'üß†', 'ü´Ä', 'ü´Å', 'ü¶∑', 'ü¶¥', 'üëÄ', 'üëÅÔ∏è', 'üëÖ', 'üëÑ', 'üíã', 'ü©∏']\n    },\n    {\n      name: '–û–±—ä–µ–∫—Ç—ã',\n      icon: Star,\n      emojis: ['‚≠ê', 'üåü', 'üí´', '‚ú®', 'üî•', 'üí•', 'üí¢', 'üí¶', 'üí®', 'üå™Ô∏è', '‚ö°', 'üîî', 'üîï', 'üí°', 'üî¶', 'üïØÔ∏è', 'ü™î', 'üßø', 'üì±', 'üíª', 'üñ•Ô∏è', '‚å®Ô∏è', 'üñ±Ô∏è', 'üñ®Ô∏è', 'üíæ', 'üíø', 'üìÄ', 'üé•', 'üì∑', 'üìπ', 'üìº', 'üîç', 'üîé', 'üïØÔ∏è', 'üí∞', 'üíé', '‚öñÔ∏è', 'üîß', 'üî®', '‚öíÔ∏è', 'üõ†Ô∏è', '‚õèÔ∏è', 'üî©', '‚öôÔ∏è', 'üß∞', 'üß≤', 'üî´', 'üí£', 'üß®', 'üî™', '‚öîÔ∏è', 'üõ°Ô∏è', 'üö¨', '‚ö∞Ô∏è', '‚ö±Ô∏è', 'üè∫', 'üîÆ', 'üìø', 'üßø', 'üíà', '‚öóÔ∏è', 'üî≠', 'üî¨', 'üï≥Ô∏è', 'ü©π', 'ü©∫', 'üíä', 'üíâ', 'üß¨', 'ü¶†', 'üß´', 'üß™', 'üå°Ô∏è', 'üßπ', 'üßΩ', 'üöΩ', 'üö∞', 'üöø', 'üõÅ', 'üõÄ', 'üß¥', 'üß∑', 'üßπ', 'üß∫', 'üßª', 'üßº', 'üßΩ', 'üßØ', 'üõí']\n    },\n    {\n      name: '–ü—Ä–∏—Ä–æ–¥–∞',\n      icon: Zap,\n      emojis: ['üå±', 'üåø', 'üçÄ', 'üåæ', 'üåµ', 'üå¥', 'üå≥', 'üå≤', 'üå∞', 'üåØ', 'üåª', 'üå∫', 'üå∏', 'üåº', 'üå∑', 'ü•Ä', 'üåπ', 'üåö', 'üåõ', 'üåú', 'üåù', 'üåû', 'üåü', '‚≠ê', 'üå†', '‚ö°', '‚õÖ', '‚õàÔ∏è', 'üå§Ô∏è', 'üå¶Ô∏è', 'üåßÔ∏è', 'üå®Ô∏è', 'üå©Ô∏è', 'üå™Ô∏è', 'üå´Ô∏è', 'üå¨Ô∏è', 'üåÄ', 'üåà', '‚òÄÔ∏è', 'üå§Ô∏è', '‚õÖ', 'üå•Ô∏è', '‚òÅÔ∏è', 'üå¶Ô∏è', 'üåßÔ∏è', '‚õàÔ∏è', 'üå©Ô∏è', 'üå®Ô∏è', '‚ùÑÔ∏è', '‚òÉÔ∏è', '‚õÑ', 'üå¨Ô∏è', 'üí®', 'üíß', 'üí¶', '‚òî', '‚òÇÔ∏è', 'üåä', 'üåç', 'üåé', 'üåè', 'ü™ê', 'üí´', '‚≠ê', 'üåü', '‚ú®', '‚ö°', '‚òÑÔ∏è', 'üí•', 'üî•', 'üå™Ô∏è', 'üåà', '‚òÄÔ∏è', 'üå§Ô∏è', '‚õÖ', 'üå¶Ô∏è', 'üåßÔ∏è', '‚õàÔ∏è', 'üå©Ô∏è', 'üå®Ô∏è', '‚ùÑÔ∏è', '‚òÉÔ∏è', '‚õÑ', 'üå¨Ô∏è', 'üí®', 'üíß', 'üí¶', '‚òî']\n    }\n  ];\n\n  const symbolCategories: SymbolCategory[] = [\n    {\n      name: '–°—Ç—Ä–µ–ª–∫–∏',\n      symbols: [\n        { symbol: '‚Üí', name: '–°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ', description: '–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è' },\n        { symbol: '‚Üê', name: '–°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ', description: '–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è' },\n        { symbol: '‚Üë', name: '–°—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö', description: '–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è' },\n        { symbol: '‚Üì', name: '–°—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑', description: '–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è' },\n        { symbol: '‚Üó', name: '–°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ-–≤–≤–µ—Ä—Ö', description: '–î–∏–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞' },\n        { symbol: '‚Üò', name: '–°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ-–≤–Ω–∏–∑', description: '–î–∏–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞' },\n        { symbol: '‚Üô', name: '–°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ-–≤–Ω–∏–∑', description: '–î–∏–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞' },\n        { symbol: '‚Üñ', name: '–°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ-–≤–≤–µ—Ä—Ö', description: '–î–∏–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞' },\n        { symbol: '‚áí', name: '–î–≤–æ–π–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ', description: '–ñ–∏—Ä–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞' },\n        { symbol: '‚áê', name: '–î–≤–æ–π–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ', description: '–ñ–∏—Ä–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞' },\n        { symbol: '‚áë', name: '–î–≤–æ–π–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö', description: '–ñ–∏—Ä–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞' },\n        { symbol: '‚áì', name: '–î–≤–æ–π–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑', description: '–ñ–∏—Ä–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞' }\n      ]\n    },\n    {\n      name: '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ',\n      symbols: [\n        { symbol: '¬±', name: '–ü–ª—é—Å-–º–∏–Ω—É—Å', description: '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∏–º–≤–æ–ª' },\n        { symbol: '√ó', name: '–£–º–Ω–æ–∂–µ–Ω–∏–µ', description: '–ó–Ω–∞–∫ —É–º–Ω–æ–∂–µ–Ω–∏—è' },\n        { symbol: '√∑', name: '–î–µ–ª–µ–Ω–∏–µ', description: '–ó–Ω–∞–∫ –¥–µ–ª–µ–Ω–∏—è' },\n        { symbol: '=', name: '–†–∞–≤–Ω–æ', description: '–ó–Ω–∞–∫ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞' },\n        { symbol: '‚â†', name: '–ù–µ —Ä–∞–≤–Ω–æ', description: '–ó–Ω–∞–∫ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞' },\n        { symbol: '‚â§', name: '–ú–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ', description: '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ' },\n        { symbol: '‚â•', name: '–ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ', description: '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ' },\n        { symbol: '‚àû', name: '–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å', description: '–°–∏–º–≤–æ–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏' },\n        { symbol: '‚àö', name: '–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å', description: '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–µ–Ω—å' },\n        { symbol: '¬≤', name: '–°—Ç–µ–ø–µ–Ω—å 2', description: '–ù–∞–¥—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å' },\n        { symbol: '¬≥', name: '–°—Ç–µ–ø–µ–Ω—å 3', description: '–ù–∞–¥—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å' },\n        { symbol: '%', name: '–ü—Ä–æ—Ü–µ–Ω—Ç', description: '–ó–Ω–∞–∫ –ø—Ä–æ—Ü–µ–Ω—Ç–∞' }\n      ]\n    },\n    {\n      name: '–ü—É–Ω–∫—Ç—É–∞—Ü–∏—è',\n      symbols: [\n        { symbol: '‚Ä¢', name: '–ú–∞—Ä–∫–µ—Ä —Å–ø–∏—Å–∫–∞', description: '–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤' },\n        { symbol: '‚ó¶', name: '–ë–µ–ª—ã–π –º–∞—Ä–∫–µ—Ä', description: '–î–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤' },\n        { symbol: '‚ñ™', name: '–ß–µ—Ä–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç–∏–∫', description: '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–∞—Ä–∫–µ—Ä' },\n        { symbol: '‚ñ´', name: '–ë–µ–ª—ã–π –∫–≤–∞–¥—Ä–∞—Ç–∏–∫', description: '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–∞—Ä–∫–µ—Ä' },\n        { symbol: '‚Äî', name: '–î–ª–∏–Ω–Ω–æ–µ —Ç–∏—Ä–µ', description: '–ü—É–Ω–∫—Ç—É–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–Ω–∞–∫' },\n        { symbol: '‚Äì', name: '–ö–æ—Ä–æ—Ç–∫–æ–µ —Ç–∏—Ä–µ', description: '–ü—É–Ω–∫—Ç—É–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–Ω–∞–∫' },\n        { symbol: '‚Ä¶', name: '–ú–Ω–æ–≥–æ—Ç–æ—á–∏–µ', description: '–¢—Ä–∏ —Ç–æ—á–∫–∏' },\n        { symbol: '¬´', name: '–õ–µ–≤–∞—è –∫–∞–≤—ã—á–∫–∞', description: '–û—Ç–∫—Ä—ã–≤–∞—é—â–∞—è –∫–∞–≤—ã—á–∫–∞' },\n        { symbol: '¬ª', name: '–ü—Ä–∞–≤–∞—è –∫–∞–≤—ã—á–∫–∞', description: '–ó–∞–∫—Ä—ã–≤–∞—é—â–∞—è –∫–∞–≤—ã—á–∫–∞' },\n        { symbol: '\"', name: '–õ–µ–≤–∞—è –¥–≤–æ–π–Ω–∞—è –∫–∞–≤—ã—á–∫–∞', description: '–û—Ç–∫—Ä—ã–≤–∞—é—â–∞—è –∫–∞–≤—ã—á–∫–∞' },\n        { symbol: '\"', name: '–ü—Ä–∞–≤–∞—è –¥–≤–æ–π–Ω–∞—è –∫–∞–≤—ã—á–∫–∞', description: '–ó–∞–∫—Ä—ã–≤–∞—é—â–∞—è –∫–∞–≤—ã—á–∫–∞' },\n        { symbol: '¬ß', name: '–ü–∞—Ä–∞–≥—Ä–∞—Ñ', description: '–ó–Ω–∞–∫ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞' }\n      ]\n    },\n    {\n      name: '–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ',\n      symbols: [\n        { symbol: '‚òë', name: '–ì–∞–ª–æ—á–∫–∞ –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ', description: '–í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞' },\n        { symbol: '‚òê', name: '–ü—É—Å—Ç–æ–π –∫–≤–∞–¥—Ä–∞—Ç', description: '–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞' },\n        { symbol: '‚úì', name: '–ì–∞–ª–æ—á–∫–∞', description: '–ó–Ω–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è' },\n        { symbol: '‚úó', name: '–ö—Ä–µ—Å—Ç–∏–∫', description: '–ó–Ω–∞–∫ –æ—Ç–º–µ–Ω—ã' },\n        { symbol: '‚ö†', name: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ', description: '–ó–Ω–∞–∫ –≤–Ω–∏–º–∞–Ω–∏—è' },\n        { symbol: '‚ö°', name: '–ú–æ–ª–Ω–∏—è', description: '–ë—ã—Å—Ç—Ä–æ—Ç–∞, —ç–Ω–µ—Ä–≥–∏—è' },\n        { symbol: '‚ô®', name: '–ì–æ—Ä—è—á–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏', description: '–°–∏–º–≤–æ–ª —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã' },\n        { symbol: '‚ôª', name: '–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', description: '–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–∏–º–≤–æ–ª' },\n        { symbol: '¬©', name: '–ö–æ–ø–∏—Ä–∞–π—Ç', description: '–ê–≤—Ç–æ—Ä—Å–∫–æ–µ –ø—Ä–∞–≤–æ' },\n        { symbol: '¬Æ', name: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä–Ω—ã–π –∑–Ω–∞–∫', description: '–¢–æ—Ä–≥–æ–≤–∞—è –º–∞—Ä–∫–∞' },\n        { symbol: '‚Ñ¢', name: '–¢–æ–≤–∞—Ä–Ω—ã–π –∑–Ω–∞–∫', description: '–¢–æ—Ä–≥–æ–≤–∞—è –º–∞—Ä–∫–∞' },\n        { symbol: '‚Ññ', name: '–ù–æ–º–µ—Ä', description: '–ó–Ω–∞–∫ –Ω–æ–º–µ—Ä–∞' }\n      ]\n    }\n  ];\n\n  const textTemplates = [\n    {\n      name: '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',\n      template: 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\\n\\nüéâ –ú—ã —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –∑–¥–µ—Å—å!'\n    },\n    {\n      name: '–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á',\n      template: 'üìã **–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á:**\\n\\n‚òê –ó–∞–¥–∞—á–∞ 1\\n‚òê –ó–∞–¥–∞—á–∞ 2\\n‚òë –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞'\n    },\n    {\n      name: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',\n      template: '‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ!**\\n\\nüö® –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'\n    },\n    {\n      name: '–£—Å–ø–µ—Ö',\n      template: '‚úÖ **–£—Å–ø–µ—à–Ω–æ!**\\n\\nüéä –û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ'\n    },\n    {\n      name: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',\n      template: 'üìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã:**\\n\\nüìß Email: example@email.com\\nüì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67'\n    },\n    {\n      name: '–ú–µ–Ω—é',\n      template: 'üçΩÔ∏è **–ú–µ–Ω—é:**\\n\\n‚Ä¢ –ü—É–Ω–∫—Ç 1\\n‚Ä¢ –ü—É–Ω–∫—Ç 2\\n‚Ä¢ –ü—É–Ω–∫—Ç 3'\n    }\n  ];\n\n  const handleEmojiClick = (emoji: string) => {\n    onEmojiSelect(emoji);\n    toast({\n      title: \"–≠–º–æ–¥–∑–∏ –¥–æ–±–∞–≤–ª–µ–Ω\",\n      description: `${emoji} –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ç–µ–∫—Å—Ç`\n    });\n  };\n\n  const handleSymbolClick = (symbol: string) => {\n    onSymbolSelect(symbol);\n    toast({\n      title: \"–°–∏–º–≤–æ–ª –¥–æ–±–∞–≤–ª–µ–Ω\",\n      description: `${symbol} –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ç–µ–∫—Å—Ç`\n    });\n  };\n\n  const copyTemplate = async (template: string) => {\n    try {\n      await navigator.clipboard.writeText(template);\n      toast({\n        title: \"–®–∞–±–ª–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω\",\n        description: \"–®–∞–±–ª–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞\"\n      });\n    } catch (err) {\n      console.error('Failed to copy template: ', err);\n    }\n  };\n\n  const filteredEmojis = emojiCategories.map(category => ({\n    ...category,\n    emojis: category.emojis.filter(emoji => \n      !searchTerm || emoji.includes(searchTerm)\n    )\n  }));\n\n  const filteredSymbols = symbolCategories.map(category => ({\n    ...category,\n    symbols: category.symbols.filter(item => \n      !searchTerm || \n      item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      item.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      item.symbol.includes(searchTerm)\n    )\n  }));\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-sm flex items-center gap-2\">\n          <Sparkles className=\"w-4 h-4\" />\n          –≠–º–æ–¥–∑–∏ –∏ —Å–∏–º–≤–æ–ª—ã\n        </CardTitle>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-2 top-2.5 w-4 h-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"–ü–æ–∏—Å–∫ —ç–º–æ–¥–∑–∏ –∏–ª–∏ —Å–∏–º–≤–æ–ª–æ–≤...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-8 h-8 text-xs\"\n            />\n          </div>\n        </div>\n      </CardHeader>\n      \n      <CardContent>\n        <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as any)}>\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"emojis\">–≠–º–æ–¥–∑–∏</TabsTrigger>\n            <TabsTrigger value=\"symbols\">–°–∏–º–≤–æ–ª—ã</TabsTrigger>\n            <TabsTrigger value=\"templates\">–®–∞–±–ª–æ–Ω—ã</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"emojis\" className=\"space-y-4\">\n            <ScrollArea className=\"h-64 pr-4\">\n              {filteredEmojis.map((category) => (\n                <div key={category.name} className=\"mb-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <category.icon className=\"w-4 h-4\" />\n                    <Label className=\"text-xs font-medium\">{category.name}</Label>\n                  </div>\n                  <div className=\"grid grid-cols-8 gap-1\">\n                    {category.emojis.map((emoji, index) => (\n                      <Button\n                        key={index}\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleEmojiClick(emoji)}\n                        className=\"h-8 w-8 p-0 hover:bg-muted\"\n                      >\n                        {emoji}\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </ScrollArea>\n          </TabsContent>\n\n          <TabsContent value=\"symbols\" className=\"space-y-4\">\n            <ScrollArea className=\"h-64 pr-4\">\n              {filteredSymbols.map((category) => (\n                <div key={category.name} className=\"mb-4\">\n                  <Label className=\"text-xs font-medium mb-2 block\">{category.name}</Label>\n                  <div className=\"grid grid-cols-1 gap-1\">\n                    {category.symbols.map((item, index) => (\n                      <Button\n                        key={index}\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSymbolClick(item.symbol)}\n                        className=\"justify-start h-8 px-2 gap-3\"\n                      >\n                        <span className=\"text-base\">{item.symbol}</span>\n                        <span className=\"text-xs text-muted-foreground\">{item.name}</span>\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </ScrollArea>\n          </TabsContent>\n\n          <TabsContent value=\"templates\" className=\"space-y-4\">\n            <ScrollArea className=\"h-64 pr-4\">\n              <div className=\"space-y-2\">\n                {textTemplates.map((template, index) => (\n                  <div key={index} className=\"p-3 bg-muted/50 rounded-lg\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {template.name}\n                      </Badge>\n                      <div className=\"flex gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => onEmojiSelect(template.template)}\n                          className=\"h-6 px-2 text-xs\"\n                        >\n                          –í—Å—Ç–∞–≤–∏—Ç—å\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => copyTemplate(template.template)}\n                          className=\"h-6 px-2\"\n                        >\n                          <Copy className=\"w-3 h-3\" />\n                        </Button>\n                      </div>\n                    </div>\n                    <pre className=\"text-xs text-muted-foreground whitespace-pre-wrap\">\n                      {template.template}\n                    </pre>\n                  </div>\n                ))}\n              </div>\n            </ScrollArea>\n          </TabsContent>\n        </Tabs>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":17235},"client/src/components/editor/enhanced-connection-controls.tsx":{"content":"import React, { useState, useCallback, useMemo } from 'react';\nimport { Node, Connection, Button } from '@/types/bot';\nimport { Badge } from '@/components/ui/badge';\nimport { Button as UIButton } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Separator } from '@/components/ui/separator';\nimport { \n  Link, \n  Plus, \n  Settings, \n  Trash2, \n  Edit3, \n  Target, \n  ArrowRight,\n  Zap,\n  CheckCircle,\n  XCircle,\n  AlertTriangle,\n  Search,\n  Filter\n} from 'lucide-react';\nimport { ConnectionManager } from '@/utils/connection-manager';\nimport { cn } from '@/lib/utils';\n\ninterface EnhancedConnectionControlsProps {\n  nodes: Node[];\n  connections: Connection[];\n  onConnectionsChange: (connections: Connection[]) => void;\n  onNodesChange: (nodes: Node[]) => void;\n  selectedConnection?: Connection;\n  onConnectionSelect?: (connection: Connection | null) => void;\n  autoButtonCreation: boolean;\n  onAutoButtonCreationChange: (enabled: boolean) => void;\n}\n\ninterface ConnectionRule {\n  id: string;\n  name: string;\n  description: string;\n  sourceTypes: Node['type'][];\n  targetTypes: Node['type'][];\n  maxConnections: number;\n  requiresButton: boolean;\n  autoApply: boolean;\n  priority: number;\n}\n\nconst defaultRules: ConnectionRule[] = [\n  {\n    id: 'start-to-content',\n    name: '–°—Ç–∞—Ä—Ç–æ–≤—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã',\n    description: '–£–∑–µ–ª \"–°—Ç–∞—Ä—Ç\" –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É',\n    sourceTypes: ['start'],\n    targetTypes: ['message', 'keyboard', 'photo'],\n    maxConnections: 3,\n    requiresButton: true,\n    autoApply: true,\n    priority: 1\n  },\n  {\n    id: 'command-response',\n    name: '–û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–º–∞–Ω–¥—ã',\n    description: '–ö–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ—Ç–≤–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è',\n    sourceTypes: ['command'],\n    targetTypes: ['message', 'keyboard', 'photo'],\n    maxConnections: 5,\n    requiresButton: false,\n    autoApply: true,\n    priority: 2\n  },\n  {\n    id: 'interactive-flow',\n    name: '–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ—Ç–æ–∫',\n    description: '–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏',\n    sourceTypes: ['keyboard', 'input'],\n    targetTypes: ['message', 'condition'],\n    maxConnections: 10,\n    requiresButton: true,\n    autoApply: false,\n    priority: 3\n  }\n];\n\nexport function EnhancedConnectionControls({\n  nodes,\n  connections,\n  onConnectionsChange,\n  onNodesChange,\n  selectedConnection,\n  onConnectionSelect,\n  autoButtonCreation,\n  onAutoButtonCreationChange\n}: EnhancedConnectionControlsProps) {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [rules, setRules] = useState<ConnectionRule[]>(defaultRules);\n  const [activeRule, setActiveRule] = useState<ConnectionRule | null>(null);\n  const [filterType, setFilterType] = useState<'all' | 'valid' | 'invalid'>('all');\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const connectionManager = useMemo(() => \n    new ConnectionManager({\n      nodes,\n      connections,\n      autoButtonCreation\n    }),\n    [nodes, connections, autoButtonCreation]\n  );\n\n  // –ê–Ω–∞–ª–∏–∑ —Å–≤—è–∑–µ–π –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º\n  const connectionAnalysis = useMemo(() => {\n    const analysis = connections.map(connection => {\n      const sourceNode = nodes.find(n => n.id === connection.source);\n      const targetNode = nodes.find(n => n.id === connection.target);\n      \n      if (!sourceNode || !targetNode) {\n        return {\n          connection,\n          isValid: false,\n          violations: ['–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∏–ª–∏ —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª'],\n          suggestions: []\n        };\n      }\n\n      const violations: string[] = [];\n      const suggestions: string[] = [];\n      \n      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º\n      const applicableRules = rules.filter(rule => \n        rule.sourceTypes.includes(sourceNode.type) && \n        rule.targetTypes.includes(targetNode.type)\n      );\n\n      if (applicableRules.length === 0) {\n        violations.push('–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø—Ä–∞–≤–∏–ª –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Å–≤—è–∑–∏');\n      }\n\n      applicableRules.forEach(rule => {\n        const connectionsFromSource = connections.filter(c => c.source === connection.source);\n        \n        if (connectionsFromSource.length > rule.maxConnections) {\n          violations.push(`–ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤—è–∑–µ–π (${rule.maxConnections})`);\n        }\n\n        if (rule.requiresButton) {\n          const buttons = sourceNode.data.buttons || [];\n          const hasButton = buttons.some(b => \n            b.action === 'goto' && b.target === connection.target\n          );\n          if (!hasButton) {\n            violations.push('–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è —ç—Ç–æ–π —Å–≤—è–∑–∏');\n            suggestions.push('–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞');\n          }\n        }\n      });\n\n      return {\n        connection,\n        isValid: violations.length === 0,\n        violations,\n        suggestions\n      };\n    });\n\n    return analysis;\n  }, [connections, nodes, rules]);\n\n  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–≤—è–∑–µ–π\n  const filteredConnections = useMemo(() => {\n    return connectionAnalysis.filter(analysis => {\n      if (filterType === 'valid' && !analysis.isValid) return false;\n      if (filterType === 'invalid' && analysis.isValid) return false;\n      \n      if (searchTerm) {\n        const sourceNode = nodes.find(n => n.id === analysis.connection.source);\n        const targetNode = nodes.find(n => n.id === analysis.connection.target);\n        const searchLower = searchTerm.toLowerCase();\n        \n        return (\n          sourceNode?.type.toLowerCase().includes(searchLower) ||\n          targetNode?.type.toLowerCase().includes(searchLower) ||\n          analysis.violations.some(v => v.toLowerCase().includes(searchLower))\n        );\n      }\n      \n      return true;\n    });\n  }, [connectionAnalysis, filterType, searchTerm, nodes]);\n\n  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n  const stats = useMemo(() => {\n    const total = connections.length;\n    const valid = connectionAnalysis.filter(a => a.isValid).length;\n    const invalid = total - valid;\n    const withButtons = connectionAnalysis.filter(a => {\n      const sourceNode = nodes.find(n => n.id === a.connection.source);\n      const buttons = sourceNode?.data.buttons || [];\n      return buttons.some(b => \n        b.action === 'goto' && b.target === a.connection.target\n      );\n    }).length;\n\n    return { total, valid, invalid, withButtons };\n  }, [connectionAnalysis, nodes]);\n\n  const getNodeName = useCallback((nodeId: string) => {\n    const node = nodes.find(n => n.id === nodeId);\n    if (!node) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª';\n    \n    const typeNames = {\n      start: '–°—Ç–∞—Ä—Ç',\n      command: node.data.command || '–ö–æ–º–∞–Ω–¥–∞',\n      message: '–°–æ–æ–±—â–µ–Ω–∏–µ',\n      keyboard: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞',\n      photo: '–§–æ—Ç–æ',\n      video: '–í–∏–¥–µ–æ',\n      audio: '–ê—É–¥–∏–æ',\n      document: '–î–æ–∫—É–º–µ–Ω—Ç',\n      condition: '–£—Å–ª–æ–≤–∏–µ',\n      input: '–í–≤–æ–¥',\n      'user-input': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥',\n      sticker: '–°—Ç–∏–∫–µ—Ä',\n      voice: '–ì–æ–ª–æ—Å–æ–≤–æ–µ',\n      animation: '–ê–Ω–∏–º–∞—Ü–∏—è',\n      location: '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è',\n      contact: '–ö–æ–Ω—Ç–∞–∫—Ç',\n      poll: '–û–ø—Ä–æ—Å',\n      dice: '–ö—É–±–∏–∫'\n    };\n    \n    return typeNames[node.type] || node.type;\n  }, [nodes]);\n\n  const fixConnection = useCallback((connection: Connection) => {\n    const sourceNode = nodes.find(n => n.id === connection.source);\n    const targetNode = nodes.find(n => n.id === connection.target);\n    \n    if (!sourceNode || !targetNode) return;\n\n    connectionManager.updateState({ nodes, connections });\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞\n    const needsButton = rules.some(rule => \n      rule.sourceTypes.includes(sourceNode.type) && \n      rule.targetTypes.includes(targetNode.type) &&\n      rule.requiresButton\n    );\n\n    if (needsButton) {\n      const buttons = sourceNode.data.buttons || [];\n      const hasButton = buttons.some(b => \n        b.action === 'goto' && b.target === connection.target\n      );\n\n      if (!hasButton) {\n        const { updatedNodes } = connectionManager.createConnection(\n          connection.source,\n          connection.target,\n          { autoCreateButton: true }\n        );\n        onNodesChange(updatedNodes);\n      }\n    }\n  }, [connectionManager, nodes, connections, rules, onNodesChange]);\n\n  const deleteConnection = useCallback((connectionId: string) => {\n    connectionManager.updateState({ nodes, connections });\n    const { removedConnection, updatedNodes } = connectionManager.removeConnection(connectionId);\n    \n    if (removedConnection) {\n      onConnectionsChange(connections.filter(c => c.id !== connectionId));\n      onNodesChange(updatedNodes);\n      \n      if (selectedConnection?.id === connectionId) {\n        onConnectionSelect?.(null);\n      }\n    }\n  }, [connectionManager, nodes, connections, onConnectionsChange, onNodesChange, selectedConnection, onConnectionSelect]);\n\n  const applyRule = useCallback((rule: ConnectionRule) => {\n    connectionManager.updateState({ nodes, connections });\n    \n    const sourceNodes = nodes.filter(n => rule.sourceTypes.includes(n.type));\n    const targetNodes = nodes.filter(n => rule.targetTypes.includes(n.type));\n    \n    const newConnections: Connection[] = [];\n    let updatedNodes = [...nodes];\n\n    sourceNodes.forEach(sourceNode => {\n      const existingConnections = connections.filter(c => c.source === sourceNode.id);\n      const availableSlots = rule.maxConnections - existingConnections.length;\n      \n      if (availableSlots > 0) {\n        const suitableTargets = targetNodes.filter(targetNode => \n          targetNode.id !== sourceNode.id &&\n          !existingConnections.some(c => c.target === targetNode.id)\n        ).slice(0, availableSlots);\n\n        suitableTargets.forEach(targetNode => {\n          const { connection, updatedNodes: newUpdatedNodes } = connectionManager.createConnection(\n            sourceNode.id,\n            targetNode.id,\n            { autoCreateButton: rule.requiresButton }\n          );\n          \n          newConnections.push(connection);\n          updatedNodes = newUpdatedNodes;\n        });\n      }\n    });\n\n    if (newConnections.length > 0) {\n      onConnectionsChange([...connections, ...newConnections]);\n      onNodesChange(updatedNodes);\n    }\n  }, [connectionManager, nodes, connections, onConnectionsChange, onNodesChange]);\n\n  const validateAllConnections = useCallback(() => {\n    connectionManager.updateState({ nodes, connections });\n    const updatedNodes = connectionManager.syncButtonsWithConnections();\n    onNodesChange(updatedNodes);\n  }, [connectionManager, nodes, connections, onNodesChange]);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Link className=\"h-5 w-5\" />\n            –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏\n          </CardTitle>\n          <CardDescription>\n            –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —É–∑–ª–∞–º–∏\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}\n          <div className=\"grid grid-cols-4 gap-4 mb-4\">\n            <div className=\"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n              <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{stats.total}</div>\n              <div className=\"text-sm text-muted-foreground\">–í—Å–µ–≥–æ —Å–≤—è–∑–µ–π</div>\n            </div>\n            <div className=\"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n              <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{stats.valid}</div>\n              <div className=\"text-sm text-muted-foreground\">–í–∞–ª–∏–¥–Ω—ã—Ö</div>\n            </div>\n            <div className=\"text-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg\">\n              <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">{stats.invalid}</div>\n              <div className=\"text-sm text-muted-foreground\">–¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</div>\n            </div>\n            <div className=\"text-center p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg\">\n              <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">{stats.withButtons}</div>\n              <div className=\"text-sm text-muted-foreground\">–° –∫–Ω–æ–ø–∫–∞–º–∏</div>\n            </div>\n          </div>\n\n          {/* –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ */}\n          <div className=\"flex gap-2 mb-4\">\n            <Select value={filterType} onValueChange={(value: typeof filterType) => setFilterType(value)}>\n              <SelectTrigger className=\"w-40\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">–í—Å–µ —Å–≤—è–∑–∏</SelectItem>\n                <SelectItem value=\"valid\">–í–∞–ª–∏–¥–Ω—ã–µ</SelectItem>\n                <SelectItem value=\"invalid\">–¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</SelectItem>\n              </SelectContent>\n            </Select>\n            \n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"–ü–æ–∏—Å–∫ –ø–æ —Ç–∏–ø–∞–º —É–∑–ª–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞–º...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            \n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n              <DialogTrigger asChild>\n                <UIButton variant=\"outline\">\n                  <Settings className=\"h-4 w-4 mr-2\" />\n                  –ù–∞—Å—Ç—Ä–æ–π–∫–∏\n                </UIButton>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª —Å–≤—è–∑–µ–π</DialogTitle>\n                  <DialogDescription>\n                    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–µ–π\n                  </DialogDescription>\n                </DialogHeader>\n                \n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"auto-button-creation\">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫</Label>\n                    <Switch\n                      id=\"auto-button-creation\"\n                      checked={autoButtonCreation}\n                      onCheckedChange={onAutoButtonCreationChange}\n                    />\n                  </div>\n                  \n                  <Separator />\n                  \n                  <div className=\"space-y-3\">\n                    <h4 className=\"font-medium\">–ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏</h4>\n                    {rules.map((rule) => (\n                      <div key={rule.id} className=\"p-3 border rounded-lg\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <h5 className=\"font-medium\">{rule.name}</h5>\n                          <div className=\"flex gap-2\">\n                            <UIButton\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => applyRule(rule)}\n                              disabled={!rule.autoApply}\n                            >\n                              <Zap className=\"h-4 w-4 mr-1\" />\n                              –ü—Ä–∏–º–µ–Ω–∏—Ç—å\n                            </UIButton>\n                            <Switch\n                              checked={rule.autoApply}\n                              onCheckedChange={(checked) => {\n                                setRules(prev => prev.map(r => \n                                  r.id === rule.id ? { ...r, autoApply: checked } : r\n                                ));\n                              }}\n                            />\n                          </div>\n                        </div>\n                        <p className=\"text-sm text-muted-foreground mb-2\">{rule.description}</p>\n                        <div className=\"flex gap-2\">\n                          <Badge variant=\"outline\">\n                            –ú–∞–∫—Å. —Å–≤—è–∑–µ–π: {rule.maxConnections}\n                          </Badge>\n                          {rule.requiresButton && (\n                            <Badge variant=\"secondary\">–¢—Ä–µ–±—É–µ—Ç –∫–Ω–æ–ø–∫–∏</Badge>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          {/* –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã */}\n          <div className=\"flex gap-2 mb-4\">\n            <UIButton onClick={validateAllConnections} variant=\"outline\">\n              <CheckCircle className=\"h-4 w-4 mr-2\" />\n              –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ\n            </UIButton>\n            <UIButton \n              onClick={() => {\n                rules.filter(r => r.autoApply).forEach(applyRule);\n              }}\n              variant=\"outline\"\n            >\n              <Zap className=\"h-4 w-4 mr-2\" />\n              –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–∞–≤–∏–ª–∞\n            </UIButton>\n          </div>\n\n          {/* –°–ø–∏—Å–æ–∫ —Å–≤—è–∑–µ–π */}\n          <div className=\"space-y-2 max-h-80 overflow-y-auto\">\n            {filteredConnections.map(({ connection, isValid, violations, suggestions }) => (\n              <div\n                key={connection.id}\n                className={cn(\n                  \"p-3 border rounded-lg cursor-pointer transition-all hover:bg-accent\",\n                  selectedConnection?.id === connection.id && \"bg-accent border-primary\",\n                  !isValid && \"border-red-200 bg-red-50 dark:bg-red-900/10\"\n                )}\n                onClick={() => onConnectionSelect?.(connection)}\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      {isValid ? (\n                        <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                      ) : (\n                        <XCircle className=\"h-4 w-4 text-red-500\" />\n                      )}\n                      <span className=\"font-medium\">\n                        {getNodeName(connection.source)} ‚Üí {getNodeName(connection.target)}\n                      </span>\n                    </div>\n                    \n                    {violations.length > 0 && (\n                      <div className=\"space-y-1\">\n                        {violations.map((violation, idx) => (\n                          <div key={idx} className=\"flex items-center gap-1\">\n                            <AlertTriangle className=\"h-3 w-3 text-red-500\" />\n                            <span className=\"text-xs text-red-600\">{violation}</span>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                    \n                    {suggestions.length > 0 && (\n                      <div className=\"flex gap-1 mt-1\">\n                        {suggestions.map((suggestion, idx) => (\n                          <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                            {suggestion}\n                          </Badge>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                  \n                  <div className=\"flex gap-1 ml-2\">\n                    {!isValid && (\n                      <UIButton\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          fixConnection(connection);\n                        }}\n                      >\n                        <Edit3 className=\"h-4 w-4\" />\n                      </UIButton>\n                    )}\n                    <UIButton\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        deleteConnection(connection.id);\n                      }}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </UIButton>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":21544},"client/src/components/editor/export-modal.tsx":{"content":"import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ç—è–∂–µ–ª—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\nconst loadBotGenerator = () => import('@/lib/bot-generator');\nconst loadCommands = () => import('@/lib/commands');\nimport { BotData, BotGroup } from '@shared/schema';\nimport { useState, useEffect, useMemo } from 'react';\nimport { useQuery } from '@tanstack/react-query';\n\ninterface ExportModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  botData: BotData;\n  projectName: string;\n}\n\ntype ExportFormat = 'python' | 'json' | 'requirements' | 'readme' | 'dockerfile' | 'config';\n\nexport function ExportModal({ isOpen, onClose, botData, projectName }: ExportModalProps) {\n  const [generatedCode, setGeneratedCode] = useState('');\n  const [selectedFormat, setSelectedFormat] = useState<ExportFormat>('python');\n  const [exportContent, setExportContent] = useState<Record<ExportFormat, string>>({\n    python: '',\n    json: '',\n    requirements: '',\n    readme: '',\n    dockerfile: '',\n    config: ''\n  });\n  const [validationResult, setValidationResult] = useState<{ isValid: boolean; errors: string[] }>({ isValid: true, errors: [] });\n  const [botFatherCommands, setBotFatherCommands] = useState('');\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø\n  const { data: groups = [] } = useQuery<BotGroup[]>({\n    queryKey: ['/api/groups'],\n    enabled: isOpen\n  });\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö —É–∑–ª–æ–≤ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞\n  const getAllNodes = (data: BotData) => {\n    if (!data) return [];\n    \n    if ((data as any).sheets && Array.isArray((data as any).sheets)) {\n      // –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π –ø—Ä–æ–µ–∫—Ç - —Å–æ–±–∏—Ä–∞–µ–º —É–∑–ª—ã –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤\n      let allNodes: any[] = [];\n      (data as any).sheets.forEach((sheet: any) => {\n        if (sheet.nodes && Array.isArray(sheet.nodes)) {\n          allNodes = allNodes.concat(sheet.nodes);\n        }\n      });\n      return allNodes;\n    } else {\n      // –û–±—ã—á–Ω—ã–π –ø—Ä–æ–µ–∫—Ç\n      return data.nodes || [];\n    }\n  };\n\n  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞\n  const allNodes = getAllNodes(botData);\n  const botStats = {\n    totalNodes: allNodes.length,\n    commandNodes: allNodes.filter(node => node.type === 'start' || node.type === 'command').length,\n    messageNodes: allNodes.filter(node => node.type === 'message').length,\n    photoNodes: allNodes.filter(node => node.type === 'photo').length,\n    keyboardNodes: allNodes.filter(node => node.data?.keyboardType !== 'none').length,\n    totalButtons: allNodes.reduce((sum, node) => sum + (node.data?.buttons?.length || 0), 0),\n    commandsInMenu: allNodes.filter(node => \n      (node.type === 'start' || node.type === 'command') && node.data?.showInMenu\n    ).length,\n    adminOnlyCommands: allNodes.filter(node => \n      (node.type === 'start' || node.type === 'command') && node.data?.adminOnly\n    ).length,\n    privateOnlyCommands: allNodes.filter(node => \n      (node.type === 'start' || node.type === 'command') && node.data?.isPrivateOnly\n    ).length\n  };\n\n  // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ª–µ–Ω–∏–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ - —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç\n  const generateExportContent = useMemo(() => {\n    if (!isOpen || !botData) return {};\n    \n    return {\n      python: async () => {\n        const botGenerator = await loadBotGenerator();\n        const validation = botGenerator.validateBotStructure(botData);\n        setValidationResult(validation || { isValid: false, errors: [] });\n        \n        if (!validation?.isValid) return '';\n        return botGenerator.generatePythonCode(botData, projectName, groups);\n      },\n      json: async () => JSON.stringify(botData, null, 2),\n      requirements: async () => {\n        const botGenerator = await loadBotGenerator();\n        return botGenerator.generateRequirementsTxt();\n      },\n      readme: async () => {\n        const botGenerator = await loadBotGenerator();\n        return botGenerator.generateReadme(botData, projectName);\n      },\n      dockerfile: async () => {\n        const botGenerator = await loadBotGenerator();\n        return botGenerator.generateDockerfile();\n      },\n      config: async () => {\n        const botGenerator = await loadBotGenerator();\n        return botGenerator.generateConfigYaml(projectName);\n      }\n    };\n  }, [isOpen, botData, projectName, groups]);\n\n  // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n  useEffect(() => {\n    async function loadContent() {\n      if (!generateExportContent[selectedFormat] || exportContent[selectedFormat]) return;\n      \n      try {\n        const content = await generateExportContent[selectedFormat]();\n        setExportContent(prev => ({ ...prev, [selectedFormat]: content }));\n        \n        // –î–ª—è Python —Ç–∞–∫–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥\n        if (selectedFormat === 'python') {\n          setGeneratedCode(content);\n        }\n      } catch (error) {\n        console.error('Error loading export content:', error);\n        toast({\n          title: \"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏\",\n          description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞\",\n          variant: \"destructive\",\n        });\n      }\n    }\n    \n    loadContent();\n  }, [generateExportContent, selectedFormat, exportContent, toast]);\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞\n  const getCurrentContent = () => {\n    return exportContent[selectedFormat] || '';\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞ —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏\n  const [freshBotData, setFreshBotData] = useState<BotData | null>(null);\n  \n  useEffect(() => {\n    async function loadFreshProjectData() {\n      if (isOpen) {\n        try {\n          // –ü–æ–ª—É—á–∞–µ–º ID –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ URL\n          const projectId = window.location.pathname.split('/').pop();\n          if (projectId && !isNaN(Number(projectId))) {\n            console.log('üîÑ ExportModal: –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ API...');\n            const response = await fetch(`/api/projects/${projectId}`);\n            if (response.ok) {\n              const project = await response.json();\n              console.log('üì° ExportModal: –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª—É—á–µ–Ω—ã:', project);\n              // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π\n              if (project.data) {\n                console.log('‚úÖ ExportModal: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ:', project.data);\n                setFreshBotData(project.data);\n              }\n            } else {\n              console.error('‚ùå ExportModal: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞:', response.status);\n            }\n          }\n        } catch (error) {\n          console.error('Error loading fresh project data:', error);\n        }\n      }\n    }\n    \n    loadFreshProjectData();\n  }, [isOpen]);\n\n  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ BotFather —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n  useEffect(() => {\n    async function loadBotFatherCommands() {\n      const dataToUse = freshBotData || botData;\n      if (isOpen && dataToUse) {\n        try {\n          const commands = await loadCommands();\n          console.log('üîç ExportModal: –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥:', dataToUse);\n          \n          // –°–æ–±–∏—Ä–∞–µ–º —É–∑–ª—ã –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞\n          let nodes: any[] = [];\n          if ((dataToUse as any).sheets && Array.isArray((dataToUse as any).sheets)) {\n            // –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π –ø—Ä–æ–µ–∫—Ç - —Å–æ–±–∏—Ä–∞–µ–º —É–∑–ª—ã –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤\n            console.log('üìä ExportModal: –ù–∞–π–¥–µ–Ω–æ –ª–∏—Å—Ç–æ–≤:', (dataToUse as any).sheets.length);\n            (dataToUse as any).sheets.forEach((sheet: any, index: number) => {\n              console.log(`üìã ExportModal: –õ–∏—Å—Ç ${index + 1} (${sheet.name || sheet.id}):`, sheet.nodes?.length || 0, '—É–∑–ª–æ–≤');\n              if (sheet.nodes && Array.isArray(sheet.nodes)) {\n                nodes = nodes.concat(sheet.nodes);\n              }\n            });\n          } else {\n            console.log('üìã ExportModal: –û–±—ã—á–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, —É–∑–ª–æ–≤:', dataToUse.nodes?.length || 0);\n            // –û–±—ã—á–Ω—ã–π –ø—Ä–æ–µ–∫—Ç\n            nodes = dataToUse.nodes || [];\n          }\n          \n          console.log('üéØ ExportModal: –ò–¢–û–ì–û —É–∑–ª–æ–≤ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤:', nodes.length);\n\n          const commandNodes = nodes.filter((node: any) => \n            (node.type === 'start' || node.type === 'command') && \n            node.data?.command &&\n            (node.data?.showInMenu !== false) // –í–∫–ª—é—á–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –≥–¥–µ showInMenu = true, undefined –∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\n          );\n          console.log('üéØ ExportModal: –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–µ–Ω—é BotFather:', commandNodes.length, '–∫–æ–º–∞–Ω–¥');\n          \n          const botFatherCmds = commands.generateBotFatherCommands(commandNodes); // ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—ã!\n          setBotFatherCommands(botFatherCmds);\n        } catch (error) {\n          console.error('Error loading BotFather commands:', error);\n        }\n      }\n    }\n    \n    loadBotFatherCommands();\n  }, [isOpen, freshBotData, botData]);\n\n  const getFileExtension = (format: ExportFormat): string => {\n    const extensions = {\n      python: 'py',\n      json: 'json',\n      requirements: 'txt',\n      readme: 'md',\n      dockerfile: '',\n      config: 'yaml'\n    };\n    return extensions[format];\n  };\n\n  const getFileName = (format: ExportFormat): string => {\n    const baseFileName = projectName.replace(/\\s+/g, '_');\n    const names = {\n      python: `${baseFileName}_bot.py`,\n      json: `${baseFileName}_data.json`,\n      requirements: 'requirements.txt',\n      readme: 'README.md',\n      dockerfile: 'Dockerfile',\n      config: 'config.yaml'\n    };\n    return names[format];\n  };\n\n  const copyToClipboard = async (content?: string) => {\n    const textToCopy = content || getCurrentContent();\n    try {\n      await navigator.clipboard.writeText(textToCopy);\n      toast({\n        title: \"–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!\",\n        description: \"–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞\",\n      });\n    } catch (error) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const downloadFile = async (format?: ExportFormat) => {\n    const formatToDownload = format || selectedFormat;\n    const content = formatToDownload === selectedFormat ? getCurrentContent() : \n      (generateExportContent[formatToDownload] ? await generateExportContent[formatToDownload]() : '');\n    const fileName = getFileName(formatToDownload);\n    \n    const blob = new Blob([content], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = fileName;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n    \n    toast({\n      title: \"–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω!\",\n      description: `–§–∞–π–ª ${fileName} —Å–æ—Ö—Ä–∞–Ω–µ–Ω`,\n    });\n  };\n\n  const downloadAllFiles = () => {\n    const formats: ExportFormat[] = ['python', 'json', 'requirements', 'readme', 'dockerfile', 'config'];\n    formats.forEach(format => {\n      setTimeout(() => downloadFile(format), formats.indexOf(format) * 100);\n    });\n    \n    toast({\n      title: \"–í—Å–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\",\n      description: \"–ü–æ–ª–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –±–æ—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω\",\n    });\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className={`${isMobile ? 'max-w-[95vw] max-h-[95vh] w-full' : 'max-w-7xl max-h-[85vh] w-[95vw]'} flex flex-col overflow-hidden`}>\n        <DialogHeader className=\"pb-2\">\n          <DialogTitle className=\"flex items-center space-x-3\">\n            <i className=\"fas fa-download text-primary\"></i>\n            <span className={`${isMobile ? 'text-sm' : ''}`}>–≠–∫—Å–ø–æ—Ä—Ç –∫–æ–¥–∞ –±–æ—Ç–∞</span>\n          </DialogTitle>\n        </DialogHeader>\n\n        <Tabs defaultValue=\"stats\" className=\"flex flex-col flex-1 mt-2 min-h-0\">\n          {isMobile ? (\n            <div className=\"flex-shrink-0 space-y-2\">\n              <TabsList className=\"grid w-full grid-cols-3 h-auto gap-1\">\n                <TabsTrigger value=\"stats\" className=\"text-xs py-2 px-1\" data-testid=\"tab-stats\">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</TabsTrigger>\n                <TabsTrigger value=\"validation\" className=\"text-xs py-2 px-1\" data-testid=\"tab-validation\">–í–∞–ª–∏–¥–∞—Ü–∏—è</TabsTrigger>\n                <TabsTrigger value=\"files\" className=\"text-xs py-2 px-1\" data-testid=\"tab-files\">–§–∞–π–ª—ã</TabsTrigger>\n              </TabsList>\n              <TabsList className=\"grid w-full grid-cols-2 h-auto gap-1\">\n                <TabsTrigger value=\"setup\" className=\"text-xs py-2 px-1\" data-testid=\"tab-setup\">–ù–∞—Å—Ç—Ä–æ–π–∫–∞</TabsTrigger>\n                <TabsTrigger value=\"export\" className=\"text-xs py-2 px-1\" data-testid=\"tab-export\">–≠–∫—Å–ø–æ—Ä—Ç</TabsTrigger>\n              </TabsList>\n            </div>\n          ) : (\n            <TabsList className=\"grid w-full grid-cols-5 flex-shrink-0\">\n              <TabsTrigger value=\"stats\" data-testid=\"tab-stats\">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</TabsTrigger>\n              <TabsTrigger value=\"validation\" data-testid=\"tab-validation\">–í–∞–ª–∏–¥–∞—Ü–∏—è</TabsTrigger>\n              <TabsTrigger value=\"files\" data-testid=\"tab-files\">–§–∞–π–ª—ã</TabsTrigger>\n              <TabsTrigger value=\"export\" data-testid=\"tab-export\">–≠–∫—Å–ø–æ—Ä—Ç</TabsTrigger>\n              <TabsTrigger value=\"setup\" data-testid=\"tab-setup\">–ù–∞—Å—Ç—Ä–æ–π–∫–∞</TabsTrigger>\n            </TabsList>\n          )}\n\n          <TabsContent value=\"stats\" className=\"space-y-4 overflow-y-auto flex-1 min-h-0\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <i className=\"fas fa-chart-bar text-blue-500\"></i>\n                  <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞</span>\n                </CardTitle>\n                <CardDescription>–û–±–∑–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className={`grid ${isMobile ? 'grid-cols-1 gap-4' : 'grid-cols-2 md:grid-cols-3 gap-4'}`}>\n                  <div className={`bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg ${isMobile ? 'p-4 flex items-center space-x-3' : 'p-3'}`}>\n                    <div className={`${isMobile ? 'text-2xl' : 'text-2xl'} font-bold text-blue-600 dark:text-blue-400`}>{botStats.totalNodes}</div>\n                    <div className={`${isMobile ? 'text-base font-medium' : 'text-sm'} text-blue-700 dark:text-blue-300`}>–í—Å–µ–≥–æ —É–∑–ª–æ–≤</div>\n                  </div>\n                  <div className={`bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg ${isMobile ? 'p-4 flex items-center space-x-3' : 'p-3'}`}>\n                    <div className={`${isMobile ? 'text-2xl' : 'text-2xl'} font-bold text-green-600 dark:text-green-400`}>{botStats.commandNodes}</div>\n                    <div className={`${isMobile ? 'text-base font-medium' : 'text-sm'} text-green-700 dark:text-green-300`}>–ö–æ–º–∞–Ω–¥</div>\n                  </div>\n                  <div className={`bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg ${isMobile ? 'p-4 flex items-center space-x-3' : 'p-3'}`}>\n                    <div className={`${isMobile ? 'text-2xl' : 'text-2xl'} font-bold text-purple-600 dark:text-purple-400`}>{botStats.totalButtons}</div>\n                    <div className={`${isMobile ? 'text-base font-medium' : 'text-sm'} text-purple-700 dark:text-purple-300`}>–ö–Ω–æ–ø–æ–∫</div>\n                  </div>\n                  <div className={`bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg ${isMobile ? 'p-4 flex items-center space-x-3' : 'p-3'}`}>\n                    <div className={`${isMobile ? 'text-2xl' : 'text-2xl'} font-bold text-amber-600 dark:text-amber-400`}>{botStats.keyboardNodes}</div>\n                    <div className={`${isMobile ? 'text-base font-medium' : 'text-sm'} text-amber-700 dark:text-amber-300`}>–° –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π</div>\n                  </div>\n                  <div className={`bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-lg ${isMobile ? 'p-4 flex items-center space-x-3' : 'p-3'}`}>\n                    <div className={`${isMobile ? 'text-2xl' : 'text-2xl'} font-bold text-indigo-600 dark:text-indigo-400`}>{botStats.commandsInMenu}</div>\n                    <div className={`${isMobile ? 'text-base font-medium' : 'text-sm'} text-indigo-700 dark:text-indigo-300`}>–í –º–µ–Ω—é</div>\n                  </div>\n                  <div className={`bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg ${isMobile ? 'p-4 flex items-center space-x-3' : 'p-3'}`}>\n                    <div className={`${isMobile ? 'text-2xl' : 'text-2xl'} font-bold text-red-600 dark:text-red-400`}>{botStats.adminOnlyCommands}</div>\n                    <div className={`${isMobile ? 'text-base font-medium' : 'text-sm'} text-red-700 dark:text-red-300`}>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω</div>\n                  </div>\n                </div>\n                \n                <Separator className=\"my-4\" />\n                \n                <div className={`space-y-${isMobile ? '4' : '3'}`}>\n                  <h4 className={`${isMobile ? 'font-semibold text-lg' : 'font-medium'}`}>–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h4>\n                  <div className={`space-y-${isMobile ? '3' : '2'} ${isMobile ? 'text-base' : 'text-sm'}`}>\n                    <div className={`flex justify-between items-center ${isMobile ? 'py-2' : ''}`}>\n                      <span className={`${isMobile ? 'font-medium' : ''}`}>–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:</span>\n                      <Badge variant=\"secondary\" className={`${isMobile ? 'text-base px-3 py-1' : ''}`}>{botStats.messageNodes}</Badge>\n                    </div>\n                    <div className={`flex justify-between items-center ${isMobile ? 'py-2' : ''}`}>\n                      <span className={`${isMobile ? 'font-medium' : ''}`}>–§–æ—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è:</span>\n                      <Badge variant=\"secondary\" className={`${isMobile ? 'text-base px-3 py-1' : ''}`}>{botStats.photoNodes}</Badge>\n                    </div>\n                    <div className={`flex justify-between items-center ${isMobile ? 'py-2' : ''}`}>\n                      <span className={`${isMobile ? 'font-medium' : ''}`}>–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</span>\n                      <Badge variant=\"outline\" className={`${isMobile ? 'text-base px-3 py-1' : ''}`}>{botStats.privateOnlyCommands}</Badge>\n                    </div>\n                    <div className={`flex justify-between items-center ${isMobile ? 'py-2' : ''}`}>\n                      <span className={`${isMobile ? 'font-medium' : ''}`}>–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏:</span>\n                      <Badge variant=\"outline\" className={`${isMobile ? 'text-base px-3 py-1' : ''}`}>{botData?.connections?.length || 0}</Badge>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"validation\" className=\"space-y-4 overflow-y-auto flex-1 min-h-0\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  {validationResult.isValid ? (\n                    <i className=\"fas fa-check-circle text-green-500\"></i>\n                  ) : (\n                    <i className=\"fas fa-exclamation-triangle text-red-500\"></i>\n                  )}\n                  <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–æ—Ç–∞</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {validationResult.isValid ? (\n                  <div className=\"flex items-center space-x-2 text-green-600 dark:text-green-400 p-4 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-800/40\">\n                    <i className=\"fas fa-check-circle\"></i>\n                    <span className=\"font-medium\">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–æ—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É!</span>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center space-x-2 text-red-600 dark:text-red-400 p-3 bg-red-50 dark:bg-red-950/30 rounded-lg border border-red-200 dark:border-red-800/40\">\n                      <i className=\"fas fa-exclamation-triangle\"></i>\n                      <span className=\"font-medium\">–ù–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –±–æ—Ç–∞:</span>\n                    </div>\n                    <div className=\"space-y-2\">\n                      {(validationResult.errors || []).map((error, index) => (\n                        <div key={index} className=\"flex items-start space-x-2 p-3 bg-red-50 dark:bg-red-950/20 rounded border-l-4 border-red-200 dark:border-red-800/60\">\n                          <i className=\"fas fa-times-circle text-red-500 dark:text-red-400 mt-0.5\"></i>\n                          <span className=\"text-sm text-red-700 dark:text-red-300\">{error}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"files\" className=\"space-y-4 overflow-y-auto flex-1 min-h-0\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <i className=\"fas fa-file-archive text-blue-500\"></i>\n                  <span>–≠–∫—Å–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞</span>\n                </CardTitle>\n                <CardDescription>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className={`${isMobile ? 'flex flex-col space-y-4' : 'flex items-center justify-between'}`}>\n                  <div className={`${isMobile ? 'w-full' : 'flex items-center space-x-4'}`}>\n                    <Select value={selectedFormat} onValueChange={(value: ExportFormat) => setSelectedFormat(value)}>\n                      <SelectTrigger className={`${isMobile ? 'w-full h-12 text-base' : 'w-[200px]'}`} data-testid=\"select-format-files\">\n                        <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"python\">Python –∫–æ–¥ (.py)</SelectItem>\n                        <SelectItem value=\"json\">JSON –¥–∞–Ω–Ω—ã–µ (.json)</SelectItem>\n                        <SelectItem value=\"requirements\">–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (.txt)</SelectItem>\n                        <SelectItem value=\"readme\">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (.md)</SelectItem>\n                        <SelectItem value=\"dockerfile\">Dockerfile</SelectItem>\n                        <SelectItem value=\"config\">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.yaml)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className={`flex ${isMobile ? 'flex-col space-y-2' : 'space-x-2'}`}>\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => copyToClipboard()} className={`${isMobile ? 'w-full' : ''}`}>\n                      <i className=\"fas fa-copy mr-2\"></i>\n                      –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å\n                    </Button>\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => downloadFile()} className={`${isMobile ? 'w-full' : ''}`}>\n                      <i className=\"fas fa-download mr-2\"></i>\n                      –°–∫–∞—á–∞—Ç—å\n                    </Button>\n                    <Button size=\"sm\" onClick={downloadAllFiles} className={`${isMobile ? 'w-full' : ''}`}>\n                      <i className=\"fas fa-archive mr-2\"></i>\n                      –°–∫–∞—á–∞—Ç—å –≤—Å–µ\n                    </Button>\n                  </div>\n                </div>\n                \n                <Separator />\n                \n                {validationResult.isValid ? (\n                  <Textarea\n                    value={getCurrentContent()}\n                    readOnly\n                    className={`${isMobile ? 'min-h-[200px]' : 'min-h-[350px]'} font-mono ${isMobile ? 'text-xs' : 'text-sm'} bg-muted/50 dark:bg-muted/20 border-muted dark:border-muted/40 resize-none`}\n                    placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞...\"\n                  />\n                ) : (\n                  <div className=\"p-4 bg-muted/50 dark:bg-muted/20 rounded-lg text-center text-muted-foreground border border-muted dark:border-muted/40\">\n                    <i className=\"fas fa-exclamation-triangle mb-2 text-yellow-500 dark:text-yellow-400\"></i>\n                    <p>–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–æ–≤</p>\n                  </div>\n                )}\n                \n                <div className={`grid ${isMobile ? 'grid-cols-1 gap-2' : 'grid-cols-2 md:grid-cols-3 gap-3'} mt-4`}>\n                  {(['python', 'json', 'requirements', 'readme', 'dockerfile', 'config'] as ExportFormat[]).map(format => (\n                    <div key={format} className={`${isMobile ? 'p-2' : 'p-3'} border border-muted dark:border-muted/40 rounded-lg hover:bg-muted/50 dark:hover:bg-muted/20 cursor-pointer transition-colors ${format === selectedFormat ? 'bg-primary/10 dark:bg-primary/20 border-primary/50 dark:border-primary/40' : ''}`} onClick={() => setSelectedFormat(format)}>\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className={`font-medium ${isMobile ? 'text-xs' : 'text-sm'} text-foreground`}>{getFileName(format)}</div>\n                          <div className={`${isMobile ? 'text-xs' : 'text-xs'} text-muted-foreground`}>{format === selectedFormat ? '–í—ã–±—Ä–∞–Ω–æ' : '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞'}</div>\n                        </div>\n                        <Button size=\"sm\" variant=\"ghost\" onClick={(e) => { e.stopPropagation(); downloadFile(format); }}>\n                          <i className=\"fas fa-download text-xs\"></i>\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"code\" className=\"space-y-4 overflow-y-auto flex-1 min-h-0\">\n            <Card>\n              <CardHeader className={`${isMobile ? 'flex flex-col space-y-4' : 'flex flex-row items-center justify-between'}`}>\n                <div>\n                  <CardTitle>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Python –∫–æ–¥</CardTitle>\n                  <CardDescription>–ì–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–æ–¥ –¥–ª—è aiogram 3.x</CardDescription>\n                </div>\n                <div className={`flex ${isMobile ? 'flex-col space-y-2' : 'space-x-2'}`}>\n                  <Button onClick={() => copyToClipboard(exportContent.python)} variant=\"outline\" size=\"sm\" className={`${isMobile ? 'w-full' : ''}`}>\n                    <i className=\"fas fa-copy mr-2\"></i>\n                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å\n                  </Button>\n                  <Button onClick={() => downloadFile('python')} size=\"sm\" className={`${isMobile ? 'w-full' : ''}`}>\n                    <i className=\"fas fa-download mr-2\"></i>\n                    –°–∫–∞—á–∞—Ç—å\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                {validationResult.isValid ? (\n                  <Textarea\n                    value={exportContent.python}\n                    readOnly\n                    className={`${isMobile ? 'min-h-[300px] max-h-[400px]' : 'min-h-[400px] max-h-[600px]'} font-mono ${isMobile ? 'text-xs' : 'text-sm'} bg-muted/50 dark:bg-muted/20 border-muted dark:border-muted/40 resize-none`}\n                    placeholder=\"–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞...\"\n                  />\n                ) : (\n                  <div className=\"p-4 bg-muted/50 dark:bg-muted/20 rounded-lg text-center text-muted-foreground border border-muted dark:border-muted/40\">\n                    <i className=\"fas fa-exclamation-triangle mb-2 text-yellow-500 dark:text-yellow-400\"></i>\n                    <p>–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"setup\" className=\"space-y-3 overflow-y-auto flex-1 min-h-0\">\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <i className=\"fas fa-cogs text-blue-500\"></i>\n                  <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞ –≤ @BotFather</span>\n                </CardTitle>\n                <CardDescription>–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–Ω—é –≤–∞—à–µ–≥–æ –±–æ—Ç–∞</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3 pt-0\">\n                {botFatherCommands ? (\n                  <div>\n                    <div className={`flex ${isMobile ? 'flex-col space-y-2' : 'justify-between items-center'} mb-2`}>\n                      <h4 className=\"font-medium\">–ö–æ–º–∞–Ω–¥—ã –¥–ª—è @BotFather:</h4>\n                      <Button \n                        onClick={() => navigator.clipboard.writeText(botFatherCommands)}\n                        variant=\"outline\" \n                        size=\"sm\"\n                        className={`${isMobile ? 'w-full' : ''}`}\n                      >\n                        <i className=\"fas fa-copy mr-2\"></i>\n                        –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å\n                      </Button>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground mb-2\">\n                      –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ @BotFather –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥:\n                    </p>\n                    <Textarea\n                      value={botFatherCommands}\n                      readOnly\n                      className={`${isMobile ? 'min-h-[120px] max-h-[200px]' : 'min-h-[150px] max-h-[300px]'} font-mono ${isMobile ? 'text-xs' : 'text-sm'} bg-muted/50 dark:bg-muted/20 border-muted dark:border-muted/40 resize-none`}\n                    />\n                  </div>\n                ) : (\n                  <div className=\"p-4 bg-muted/50 dark:bg-muted/20 rounded-lg text-center text-muted-foreground border border-muted dark:border-muted/40\">\n                    <p>–ù–µ—Ç –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –º–µ–Ω—é</p>\n                  </div>\n                )}\n                \n                <Separator />\n                \n                <div className=\"space-y-3\">\n                  <h4 className=\"font-medium\">–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É:</h4>\n                  \n                  <div className=\"bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800/40\">\n                    <h5 className=\"font-medium text-blue-800 dark:text-blue-200 mb-2\">–®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è</h5>\n                    <ol className=\"list-decimal list-inside space-y-1 text-sm text-blue-700 dark:text-blue-300\">\n                      <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Python 3.8 –∏–ª–∏ –≤—ã—à–µ</li>\n                      <li>–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–µ—ë</li>\n                      <li>–°–∫–∞—á–∞–π—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã (Python –∫–æ–¥, requirements.txt, README.md)</li>\n                      <li>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:\n                        <div className=\"mt-2 space-y-2\">\n                          <div className=\"bg-muted/30 dark:bg-muted/10 p-2 rounded border\">\n                            <div className=\"flex justify-between items-center mb-1\">\n                              <span className=\"text-xs text-muted-foreground\">–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:</span>\n                              <Button \n                                onClick={() => navigator.clipboard.writeText('python -m venv venv')}\n                                variant=\"ghost\" \n                                size=\"sm\" \n                                className=\"h-6 px-2\"\n                              >\n                                <i className=\"fas fa-copy text-xs\"></i>\n                              </Button>\n                            </div>\n                            <code className=\"text-sm font-mono\">python -m venv venv</code>\n                          </div>\n                          <div className=\"bg-muted/30 dark:bg-muted/10 p-2 rounded border\">\n                            <div className=\"flex justify-between items-center mb-1\">\n                              <span className=\"text-xs text-muted-foreground\">–ê–∫—Ç–∏–≤–∞—Ü–∏—è (Linux/Mac):</span>\n                              <Button \n                                onClick={() => navigator.clipboard.writeText('source venv/bin/activate')}\n                                variant=\"ghost\" \n                                size=\"sm\" \n                                className=\"h-6 px-2\"\n                              >\n                                <i className=\"fas fa-copy text-xs\"></i>\n                              </Button>\n                            </div>\n                            <code className=\"text-sm font-mono\">source venv/bin/activate</code>\n                          </div>\n                          <div className=\"bg-muted/30 dark:bg-muted/10 p-2 rounded border\">\n                            <div className=\"flex justify-between items-center mb-1\">\n                              <span className=\"text-xs text-muted-foreground\">–ê–∫—Ç–∏–≤–∞—Ü–∏—è (Windows):</span>\n                              <Button \n                                onClick={() => navigator.clipboard.writeText('venv\\\\Scripts\\\\activate')}\n                                variant=\"ghost\" \n                                size=\"sm\" \n                                className=\"h-6 px-2\"\n                              >\n                                <i className=\"fas fa-copy text-xs\"></i>\n                              </Button>\n                            </div>\n                            <code className=\"text-sm font-mono\">venv\\Scripts\\activate</code>\n                          </div>\n                        </div>\n                      </li>\n                    </ol>\n                  </div>\n\n                  <div className=\"bg-green-50 dark:bg-green-950/30 p-4 rounded-lg border border-green-200 dark:border-green-800/40\">\n                    <h5 className=\"font-medium text-green-800 dark:text-green-200 mb-2\">–®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π</h5>\n                    <div className=\"space-y-3 text-sm\">\n                      <div>\n                        <div className=\"font-medium text-green-800 dark:text-green-200 mb-2\">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('pip install \"aiogram>=3.21.0\" \"aiohttp>=3.12.13\" \"requests>=2.32.4\" python-dotenv aiofiles')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono break-all\">pip install \"aiogram&gt;=3.21.0\" \"aiohttp&gt;=3.12.13\" \"requests&gt;=2.32.4\" python-dotenv aiofiles</code>\n                        </div>\n                      </div>\n\n                      <div>\n                        <div className=\"font-medium text-green-800 dark:text-green-200 mb-2\">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± - —á–µ—Ä–µ–∑ requirements.txt:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('pip install -r requirements.txt')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">pip install -r requirements.txt</code>\n                        </div>\n                      </div>\n\n                      <div>\n                        <div className=\"font-medium text-green-800 dark:text-green-200 mb-2\">–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∏–Ω–∞—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('pip install --only-binary=all aiogram aiohttp requests python-dotenv aiofiles')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono break-all\">pip install --only-binary=all aiogram aiohttp requests python-dotenv aiofiles</code>\n                        </div>\n                      </div>\n\n                      <div>\n                        <div className=\"font-medium text-green-800 dark:text-green-200 mb-2\">–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('python -c \"import aiogram; print(aiogram.__version__)\"')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">python -c \"import aiogram; print(aiogram.__version__)\"</code>\n                        </div>\n                        <p className=\"text-xs text-green-700 dark:text-green-300 mt-2\">–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–µ—Ä—Å–∏—è aiogram 3.x (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3.21.0+)</p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"bg-amber-50 dark:bg-amber-950/30 p-4 rounded-lg border border-amber-200 dark:border-amber-800/40\">\n                    <h5 className=\"font-medium text-amber-800 dark:text-amber-200 mb-2\">–®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞</h5>\n                    <div className=\"space-y-3 text-sm\">\n                      <div className=\"text-amber-700 dark:text-amber-300\">\n                        <div className=\"font-medium mb-2\">1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –±–æ—Ç–∞:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ò–º—è —Ñ–∞–π–ª–∞:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText(`${projectName.replace(/\\s+/g, '_')}_bot.py`)}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">{projectName.replace(/\\s+/g, '_')}_bot.py</code>\n                        </div>\n                      </div>\n\n                      <div className=\"text-amber-700 dark:text-amber-300\">\n                        <div className=\"font-medium mb-2\">2. –ù–∞–π–¥–∏—Ç–µ –∏ –∑–∞–º–µ–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–°—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('BOT_TOKEN = \"YOUR_BOT_TOKEN_HERE\"')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">BOT_TOKEN = \"YOUR_BOT_TOKEN_HERE\"</code>\n                        </div>\n                      </div>\n\n                      <div className=\"text-amber-700 dark:text-amber-300\">\n                        <div className=\"font-medium mb-2\">3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–°—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('ADMIN_IDS = [123456789]')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">ADMIN_IDS = [123456789]</code>\n                        </div>\n                        <p className=\"text-xs mt-2\">–ó–∞–º–µ–Ω–∏—Ç–µ 123456789 –Ω–∞ –≤–∞—à Telegram ID (—É–∑–Ω–∞—Ç—å –º–æ–∂–Ω–æ —É @userinfobot)</p>\n                      </div>\n\n                      <div className=\"text-amber-700 dark:text-amber-300\">\n                        <div className=\"font-medium mb-2\">4. –£–∑–Ω–∞–π—Ç–µ –≤–∞—à Telegram ID:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ë–æ—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('@userinfobot')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">@userinfobot</code>\n                        </div>\n                        <p className=\"text-xs mt-2\">–ù–∞–ø–∏—à–∏—Ç–µ —ç—Ç–æ–º—É –±–æ—Ç—É /start –∏ –æ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤–∞—à ID</p>\n                      </div>\n\n                      <div className=\"text-amber-700 dark:text-amber-300 font-medium\">\n                        5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"bg-purple-50 dark:bg-purple-950/30 p-4 rounded-lg border border-purple-200 dark:border-purple-800/40\">\n                    <h5 className=\"font-medium text-purple-800 dark:text-purple-200 mb-2\">–®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h5>\n                    <div className=\"space-y-3 text-sm\">\n                      <div>\n                        <div className=\"font-medium text-purple-800 dark:text-purple-200 mb-2\">–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText(`python ${projectName.replace(/\\s+/g, '_')}_bot.py`)}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">python {projectName.replace(/\\s+/g, '_')}_bot.py</code>\n                        </div>\n                      </div>\n                      \n                      <div className=\"text-purple-700 dark:text-purple-300 space-y-1\">\n                        <div>‚Ä¢ –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è \"–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!\"</div>\n                        <div>‚Ä¢ –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start</div>\n                        <div>‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ –∏ –∫–Ω–æ–ø–æ–∫</div>\n                        <div>‚Ä¢ –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞ –Ω–∞–∂–º–∏—Ç–µ <code className=\"bg-muted/60 dark:bg-muted/40 px-1 rounded\">Ctrl+C</code> –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ</div>\n                      </div>\n                      \n                      <div className=\"mt-4 bg-amber-50 dark:bg-amber-950/30 p-3 rounded-lg border border-amber-200 dark:border-amber-800/40\">\n                        <div className=\"font-medium text-amber-800 dark:text-amber-200 mb-2\">üñ•Ô∏è –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Windows:</div>\n                        <div className=\"text-amber-700 dark:text-amber-300 text-sm space-y-2\">\n                          <div>–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É –∫–æ–¥–∏—Ä–æ–≤–∫–∏ (emoji –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:</div>\n                          <div className=\"bg-muted/30 dark:bg-muted/10 p-2 rounded border\">\n                            <div className=\"flex justify-between items-center\">\n                              <code className=\"text-sm font-mono\">chcp 65001</code>\n                              <Button \n                                onClick={() => navigator.clipboard.writeText('chcp 65001')}\n                                variant=\"ghost\" \n                                size=\"sm\" \n                                className=\"h-6 px-2\"\n                              >\n                                <i className=\"fas fa-copy text-xs\"></i>\n                              </Button>\n                            </div>\n                          </div>\n                          <div>–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º. –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É UTF-8.</div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <Separator className=\"my-4\" />\n\n                <div className=\"bg-cyan-50 dark:bg-cyan-950/30 p-4 rounded-lg border border-cyan-200 dark:border-cyan-800/40\">\n                  <h5 className=\"font-medium text-cyan-800 dark:text-cyan-200 mb-2\">–®–∞–≥ 5: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</h5>\n                  <div className=\"space-y-3 text-sm\">\n                    <div className=\"text-cyan-700 dark:text-cyan-300\">\n                      <div className=\"font-medium mb-2\">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite</div>\n                      <div className=\"space-y-2 text-sm\">\n                        <div>‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª <code className=\"bg-muted/60 dark:bg-muted/40 px-1 rounded\">bot_database.db</code></div>\n                        <div>‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</div>\n                        <div>‚Ä¢ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>\n                        <div>‚Ä¢ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –±–æ—Ç–æ–≤</div>\n                      </div>\n                    </div>\n\n                    <div className=\"text-cyan-700 dark:text-cyan-300\">\n                      <div className=\"font-medium mb-2\">–î–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL:</div>\n                      <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                        <div className=\"flex justify-between items-center mb-2\">\n                          <span className=\"text-xs text-muted-foreground\">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL:</span>\n                          <Button \n                            onClick={() => navigator.clipboard.writeText('pip install asyncpg')}\n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"h-6 px-2\"\n                          >\n                            <i className=\"fas fa-copy text-xs mr-1\"></i>\n                            <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                          </Button>\n                        </div>\n                        <code className=\"text-sm font-mono\">pip install asyncpg</code>\n                      </div>\n                    </div>\n\n                    <div className=\"text-cyan-700 dark:text-cyan-300\">\n                      <div className=\"font-medium mb-2\">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL:</div>\n                      <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border space-y-2\">\n                        <div className=\"text-xs text-muted-foreground mb-1\">–ù–∞–π–¥–∏—Ç–µ –≤ –∫–æ–¥–µ –±–æ—Ç–∞ —Å—Ç—Ä–æ–∫—É:</div>\n                        <code className=\"text-sm font-mono block\">DATABASE_URL = \"sqlite:///bot_database.db\"</code>\n                        <div className=\"text-xs text-muted-foreground mb-1\">–ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞:</div>\n                        <code className=\"text-sm font-mono block break-all\">DATABASE_URL = \"postgresql://user:password@localhost/dbname\"</code>\n                        <Button \n                          onClick={() => navigator.clipboard.writeText('DATABASE_URL = \"postgresql://user:password@localhost/dbname\"')}\n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"h-6 px-2 mt-2\"\n                        >\n                          <i className=\"fas fa-copy text-xs mr-1\"></i>\n                          <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                        </Button>\n                      </div>\n                    </div>\n\n                    <div className=\"text-cyan-700 dark:text-cyan-300 space-y-1\">\n                      <div className=\"font-medium\">–ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:</div>\n                      <div className=\"ml-4 space-y-1 text-sm\">\n                        <div>‚Ä¢ <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</strong> ID, –∏–º—è, –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>\n                        <div>‚Ä¢ <strong>–û—Ç–≤–µ—Ç—ã:</strong> –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏</div>\n                        <div>‚Ä¢ <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong> –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –∫–æ–º–∞–Ω–¥</div>\n                        <div>‚Ä¢ <strong>–ú–µ–¥–∏–∞:</strong> –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö</div>\n                        <div>‚Ä¢ <strong>–°–µ—Å—Å–∏–∏:</strong> —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤</div>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                      <div className=\"text-xs text-muted-foreground mb-1\">–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö (SQLite):</div>\n                      <div className=\"space-y-2\">\n                        <div>\n                          <code className=\"text-sm font-mono\">sqlite3 bot_database.db</code>\n                          <Button \n                            onClick={() => navigator.clipboard.writeText('sqlite3 bot_database.db')}\n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"h-6 px-2 ml-2\"\n                          >\n                            <i className=\"fas fa-copy text-xs\"></i>\n                          </Button>\n                        </div>\n                        <div>\n                          <code className=\"text-sm font-mono\">.tables</code>\n                          <Button \n                            onClick={() => navigator.clipboard.writeText('.tables')}\n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"h-6 px-2 ml-2\"\n                          >\n                            <i className=\"fas fa-copy text-xs\"></i>\n                          </Button>\n                        </div>\n                        <div>\n                          <code className=\"text-sm font-mono\">SELECT * FROM users LIMIT 10;</code>\n                          <Button \n                            onClick={() => navigator.clipboard.writeText('SELECT * FROM users LIMIT 10;')}\n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"h-6 px-2 ml-2\"\n                          >\n                            <i className=\"fas fa-copy text-xs\"></i>\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"text-cyan-700 dark:text-cyan-300\">\n                      <div className=\"font-medium mb-2\">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:</div>\n                      <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border space-y-2\">\n                        <div className=\"text-xs text-muted-foreground mb-1\">–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ (SQLite):</div>\n                        <div>\n                          <code className=\"text-sm font-mono\">cp bot_database.db bot_database_backup_$(date +%Y%m%d).db</code>\n                          <Button \n                            onClick={() => navigator.clipboard.writeText('cp bot_database.db bot_database_backup_$(date +%Y%m%d).db')}\n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"h-6 px-2 ml-2\"\n                          >\n                            <i className=\"fas fa-copy text-xs\"></i>\n                          </Button>\n                        </div>\n                        <div className=\"text-xs text-muted-foreground mt-2\">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV:</div>\n                        <div>\n                          <code className=\"text-sm font-mono\">sqlite3 -header -csv bot_database.db \"SELECT * FROM users;\" &gt; users.csv</code>\n                          <Button \n                            onClick={() => navigator.clipboard.writeText('sqlite3 -header -csv bot_database.db \"SELECT * FROM users;\" > users.csv')}\n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"h-6 px-2 ml-2\"\n                          >\n                            <i className=\"fas fa-copy text-xs\"></i>\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"text-cyan-700 dark:text-cyan-300 text-sm space-y-1\">\n                      <div className=\"font-medium\">–í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:</div>\n                      <div className=\"ml-4 space-y-1\">\n                        <div>‚Ä¢ <code className=\"bg-muted/60 dark:bg-muted/40 px-1 rounded\">bot_database.db</code> - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</div>\n                        <div>‚Ä¢ <code className=\"bg-muted/60 dark:bg-muted/40 px-1 rounded\">uploads/</code> - –ø–∞–ø–∫–∞ —Å –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>\n                        <div>‚Ä¢ <code className=\"bg-muted/60 dark:bg-muted/40 px-1 rounded\">*.py</code> - —Ñ–∞–π–ª—ã –∫–æ–¥–∞ –±–æ—Ç–∞</div>\n                        <div>‚Ä¢ <code className=\"bg-muted/60 dark:bg-muted/40 px-1 rounded\">config.yaml</code> - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <Separator className=\"my-4\" />\n\n                <div className=\"space-y-3\">\n                  <h4 className=\"font-medium\">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥ –≤ @BotFather:</h4>\n                  \n                  <div className=\"bg-indigo-50 dark:bg-indigo-950/30 p-4 rounded-lg border border-indigo-200 dark:border-indigo-800/40\">\n                    <h5 className=\"font-medium text-indigo-800 dark:text-indigo-200 mb-2\">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ–Ω—é</h5>\n                    <div className=\"space-y-3 text-sm\">\n                      <div className=\"text-indigo-700 dark:text-indigo-300 space-y-1\">\n                        <div>1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram</div>\n                        <div>2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–Ω—é:</div>\n                      </div>\n                      \n                      <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                        <div className=\"flex justify-between items-center mb-2\">\n                          <span className=\"text-xs text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–Ω—é:</span>\n                          <Button \n                            onClick={() => navigator.clipboard.writeText('/setcommands')}\n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"h-6 px-2\"\n                          >\n                            <i className=\"fas fa-copy text-xs mr-1\"></i>\n                            <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                          </Button>\n                        </div>\n                        <code className=\"text-sm font-mono\">/setcommands</code>\n                      </div>\n\n                      <div className=\"text-indigo-700 dark:text-indigo-300 space-y-1\">\n                        <div>3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞</div>\n                        <div>4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è @BotFather\" –≤—ã—à–µ</div>\n                        <div>5. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ —á–∞—Ç —Å @BotFather –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ</div>\n                        <div>6. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ \"Ok, command list updated\"</div>\n                        <div>7. –ö–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –º–µ–Ω—é –±–æ—Ç–∞ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏</div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"bg-muted/50 dark:bg-muted/20 p-3 rounded-lg border border-muted dark:border-muted/40\">\n                    <h6 className=\"font-medium text-foreground mb-3\">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ @BotFather:</h6>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between bg-muted/30 dark:bg-muted/10 p-2 rounded border\">\n                        <div className=\"flex items-center space-x-2\">\n                          <code className=\"text-sm font-mono\">/setdescription</code>\n                          <span className=\"text-sm text-muted-foreground\">- —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞</span>\n                        </div>\n                        <Button \n                          onClick={() => navigator.clipboard.writeText('/setdescription')}\n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"h-6 px-2\"\n                        >\n                          <i className=\"fas fa-copy text-xs\"></i>\n                        </Button>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between bg-muted/30 dark:bg-muted/10 p-2 rounded border\">\n                        <div className=\"flex items-center space-x-2\">\n                          <code className=\"text-sm font-mono\">/setuserpic</code>\n                          <span className=\"text-sm text-muted-foreground\">- —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è</span>\n                        </div>\n                        <Button \n                          onClick={() => navigator.clipboard.writeText('/setuserpic')}\n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"h-6 px-2\"\n                        >\n                          <i className=\"fas fa-copy text-xs\"></i>\n                        </Button>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between bg-muted/30 dark:bg-muted/10 p-2 rounded border\">\n                        <div className=\"flex items-center space-x-2\">\n                          <code className=\"text-sm font-mono\">/setname</code>\n                          <span className=\"text-sm text-muted-foreground\">- –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –±–æ—Ç–∞</span>\n                        </div>\n                        <Button \n                          onClick={() => navigator.clipboard.writeText('/setname')}\n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"h-6 px-2\"\n                        >\n                          <i className=\"fas fa-copy text-xs\"></i>\n                        </Button>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between bg-muted/30 dark:bg-muted/10 p-2 rounded border\">\n                        <div className=\"flex items-center space-x-2\">\n                          <code className=\"text-sm font-mono\">/setabouttext</code>\n                          <span className=\"text-sm text-muted-foreground\">- —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç \"–û –±–æ—Ç–µ\"</span>\n                        </div>\n                        <Button \n                          onClick={() => navigator.clipboard.writeText('/setabouttext')}\n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"h-6 px-2\"\n                        >\n                          <i className=\"fas fa-copy text-xs\"></i>\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <Separator className=\"my-4\" />\n\n                <div className=\"space-y-3\">\n                  <h4 className=\"font-medium\">–û–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤:</h4>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    <div className=\"bg-muted/50 dark:bg-muted/20 p-3 rounded-lg border border-muted dark:border-muted/40\">\n                      <h6 className=\"font-medium text-foreground mb-1\">Python –∫–æ–¥ (.py)</h6>\n                      <p className=\"text-sm text-muted-foreground\">–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞ —Å –ª–æ–≥–∏–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥, —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–Ω–æ–ø–æ–∫ –∏ –º–µ–¥–∏–∞–∫–æ–Ω—Ç–µ–Ω—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç aiogram 3.x —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.</p>\n                    </div>\n                    \n                    <div className=\"bg-muted/50 dark:bg-muted/20 p-3 rounded-lg border border-muted dark:border-muted/40\">\n                      <h6 className=\"font-medium text-foreground mb-1\">JSON –¥–∞–Ω–Ω—ã–µ (.json)</h6>\n                      <p className=\"text-sm text-muted-foreground\">–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.</p>\n                    </div>\n                    \n                    <div className=\"bg-muted/50 dark:bg-muted/20 p-3 rounded-lg border border-muted dark:border-muted/40\">\n                      <h6 className=\"font-medium text-foreground mb-1\">–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (.txt)</h6>\n                      <p className=\"text-sm text-muted-foreground\">–§–∞–π–ª requirements.txt —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞.</p>\n                    </div>\n                    \n                    <div className=\"bg-muted/50 dark:bg-muted/20 p-3 rounded-lg border border-muted dark:border-muted/40\">\n                      <h6 className=\"font-medium text-foreground mb-1\">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (.md)</h6>\n                      <p className=\"text-sm text-muted-foreground\">README —Ñ–∞–π–ª —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –±–æ—Ç–∞, –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ.</p>\n                    </div>\n                    \n                    <div className=\"bg-muted/50 dark:bg-muted/20 p-3 rounded-lg border border-muted dark:border-muted/40\">\n                      <h6 className=\"font-medium text-foreground mb-1\">Dockerfile</h6>\n                      <p className=\"text-sm text-muted-foreground\">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞ —Å –ø–æ–º–æ—â—å—é Docker –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.</p>\n                    </div>\n                    \n                    <div className=\"bg-muted/50 dark:bg-muted/20 p-3 rounded-lg border border-muted dark:border-muted/40\">\n                      <h6 className=\"font-medium text-foreground mb-1\">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.yaml)</h6>\n                      <p className=\"text-sm text-muted-foreground\">–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π.</p>\n                    </div>\n                  </div>\n                </div>\n\n                <Separator className=\"my-4\" />\n\n                <div className=\"space-y-3\">\n                  <h4 className=\"font-medium\">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞:</h4>\n                  \n                  <div className=\"bg-teal-50 dark:bg-teal-950/30 p-4 rounded-lg border border-teal-200 dark:border-teal-800/40\">\n                    <h5 className=\"font-medium text-teal-800 dark:text-teal-200 mb-2\">–®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–∞</h5>\n                    <ol className=\"list-decimal list-inside space-y-1 text-sm text-teal-700 dark:text-teal-300\">\n                      <li>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–Ω–∏ –æ—Ç–≤–µ—á–∞—é—Ç</li>\n                      <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ inline –∫–Ω–æ–ø–∫–∏ - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è</li>\n                      <li>–ï—Å–ª–∏ –µ—Å—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</li>\n                      <li>–î–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É \"uploads\" –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ —Ç—É–¥–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã</li>\n                      <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é - –∫–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç –¥–æ–ª–∂–Ω—ã –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</li>\n                      <li>–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫</li>\n                    </ol>\n                  </div>\n\n                  <div className=\"bg-orange-50 dark:bg-orange-950/30 p-4 rounded-lg border border-orange-200 dark:border-orange-800/40\">\n                    <h5 className=\"font-medium text-orange-800 dark:text-orange-200 mb-2\">–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:</h5>\n                    <div className=\"space-y-3 text-sm\">\n                      <div>\n                        <div className=\"font-medium text-orange-800 dark:text-orange-200 mb-2\">–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ (Rust required):</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞ —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('pip install --only-binary=all aiogram aiohttp requests python-dotenv aiofiles')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono break-all\">pip install --only-binary=all aiogram aiohttp requests python-dotenv aiofiles</code>\n                        </div>\n                      </div>\n\n                      <div>\n                        <div className=\"font-medium text-orange-800 dark:text-orange-200 mb-2\">–ü—Ä–æ–±–ª–µ–º—ã —Å pydantic-core:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('pip install --upgrade pip setuptools wheel')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">pip install --upgrade pip setuptools wheel</code>\n                        </div>\n                      </div>\n\n                      <div>\n                        <div className=\"font-medium text-orange-800 dark:text-orange-200 mb-2\">–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ aiogram –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:</div>\n                        <div className=\"bg-muted/30 dark:bg-muted/10 p-3 rounded border\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</span>\n                            <Button \n                              onClick={() => navigator.clipboard.writeText('pip install --upgrade aiogram')}\n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-6 px-2\"\n                            >\n                              <i className=\"fas fa-copy text-xs mr-1\"></i>\n                              <span className=\"text-xs\">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>\n                            </Button>\n                          </div>\n                          <code className=\"text-sm font-mono\">pip install --upgrade aiogram</code>\n                        </div>\n                      </div>\n\n                      <div className=\"text-orange-700 dark:text-orange-300 space-y-1\">\n                        <div>‚Ä¢ <strong>–ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:</strong> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ –≤–µ—Ä—Å–∏—é aiogram</div>\n                        <div>‚Ä¢ <strong>–ö–æ–º–∞–Ω–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:</strong> –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ @BotFather</div>\n                        <div>‚Ä¢ <strong>Inline –∫–Ω–æ–ø–∫–∏ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç:</strong> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ –∫–æ–¥–µ</div>\n                        <div>‚Ä¢ <strong>–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è:</strong> –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –ø–∞–ø–∫–µ uploads</div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <Separator className=\"my-4\" />\n\n                <div className=\"bg-cyan-50 dark:bg-cyan-950/30 p-4 rounded-lg border border-cyan-200 dark:border-cyan-800/40\">\n                  <h5 className=\"font-medium text-cyan-800 dark:text-cyan-200 mb-2\">üöÄ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞:</h5>\n                  <ul className=\"text-sm text-cyan-700 dark:text-cyan-300 space-y-1\">\n                    <li>‚Ä¢ <strong>–ú–µ–¥–∏–∞–∫–æ–Ω—Ç–µ–Ω—Ç:</strong> –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</li>\n                    <li>‚Ä¢ <strong>–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏</li>\n                    <li>‚Ä¢ <strong>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è:</strong> –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã, Google Maps, 2–ì–ò–°</li>\n                    <li>‚Ä¢ <strong>–£–º–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã:</strong> –ü–æ–¥–¥–µ—Ä–∂–∫–∞ inline –∏ reply –∫–Ω–æ–ø–æ–∫</li>\n                    <li>‚Ä¢ <strong>–°–∏–Ω–æ–Ω–∏–º—ã –∫–æ–º–∞–Ω–¥:</strong> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥</li>\n                    <li>‚Ä¢ <strong>–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:</strong> –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã</li>\n                    <li>‚Ä¢ <strong>–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</li>\n                  </ul>\n                </div>\n\n                <div className=\"bg-red-50 dark:bg-red-950/30 p-4 rounded-lg border border-red-200 dark:border-red-800/40\">\n                  <h5 className=\"font-medium text-red-800 dark:text-red-200 mb-2\">‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:</h5>\n                  <ul className=\"text-sm text-red-700 dark:text-red-300 space-y-1\">\n                    <li>‚Ä¢ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ</li>\n                    <li>‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—é</li>\n                    <li>‚Ä¢ –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞</li>\n                    <li>‚Ä¢ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —á–∞—Ç–µ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π</li>\n                    <li>‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –∫–æ–¥–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫</li>\n                    <li>‚Ä¢ –î–ª—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É \"uploads\" —Ä—è–¥–æ–º —Å –∫–æ–¥–æ–º –±–æ—Ç–∞</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"export\" className=\"space-y-4 overflow-y-auto flex-1 min-h-0\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <i className=\"fas fa-download text-blue-500\"></i>\n                  <span>–ú–æ–±–∏–ª—å–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç</span>\n                </CardTitle>\n                <CardDescription>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-6 px-4 py-5\">\n                <div className=\"grid grid-cols-1 gap-4\">\n                  <Button size=\"lg\" onClick={async () => { setSelectedFormat('python'); await downloadFile('python'); }} variant=\"outline\" className=\"h-16 flex-col space-y-1\" data-testid=\"button-download-python\">\n                    <i className=\"fas fa-code text-xl text-blue-500\"></i>\n                    <span className=\"font-medium\">–°–∫–∞—á–∞—Ç—å Python –∫–æ–¥</span>\n                  </Button>\n                  \n                  <Button size=\"lg\" onClick={async () => { setSelectedFormat('json'); await downloadFile('json'); }} variant=\"outline\" className=\"h-16 flex-col space-y-1\" data-testid=\"button-download-json\">\n                    <i className=\"fas fa-database text-xl text-green-500\"></i>\n                    <span className=\"font-medium\">–°–∫–∞—á–∞—Ç—å JSON –¥–∞–Ω–Ω—ã–µ</span>\n                  </Button>\n                  \n                  <Button size=\"lg\" onClick={downloadAllFiles} className=\"h-16 flex-col space-y-1\" data-testid=\"button-download-all\">\n                    <i className=\"fas fa-archive text-xl\"></i>\n                    <span className=\"font-medium\">–°–∫–∞—á–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã</span>\n                  </Button>\n                </div>\n                \n                <Separator />\n                \n                <div className=\"space-y-3\">\n                  <h4 className=\"font-semibold text-base\">–û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞:</h4>\n                  <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                    <Button size=\"sm\" variant=\"ghost\" onClick={() => downloadFile('requirements')} className=\"h-auto p-3 flex-col space-y-1 border border-muted\" data-testid=\"button-download-requirements\">\n                      <i className=\"fas fa-list text-lg text-orange-500\"></i>\n                      <span className=\"font-medium\">–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</span>\n                      <span className=\"text-xs text-muted-foreground\">.txt</span>\n                    </Button>\n                    <Button size=\"sm\" variant=\"ghost\" onClick={() => downloadFile('readme')} className=\"h-auto p-3 flex-col space-y-1 border border-muted\" data-testid=\"button-download-readme\">\n                      <i className=\"fas fa-file-alt text-lg text-purple-500\"></i>\n                      <span className=\"font-medium\">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</span>\n                      <span className=\"text-xs text-muted-foreground\">.md</span>\n                    </Button>\n                    <Button size=\"sm\" variant=\"ghost\" onClick={() => downloadFile('dockerfile')} className=\"h-auto p-3 flex-col space-y-1 border border-muted\" data-testid=\"button-download-dockerfile\">\n                      <i className=\"fab fa-docker text-lg text-cyan-500\"></i>\n                      <span className=\"font-medium\">Docker</span>\n                      <span className=\"text-xs text-muted-foreground\">–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä</span>\n                    </Button>\n                    <Button size=\"sm\" variant=\"ghost\" onClick={() => downloadFile('config')} className=\"h-auto p-3 flex-col space-y-1 border border-muted\" data-testid=\"button-download-config\">\n                      <i className=\"fas fa-cogs text-lg text-yellow-500\"></i>\n                      <span className=\"font-medium\">–ö–æ–Ω—Ñ–∏–≥</span>\n                      <span className=\"text-xs text-muted-foreground\">.yaml</span>\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n\n        </Tabs>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":84396},"client/src/components/editor/fullscreen-canvas.tsx":{"content":"import { useEffect, useCallback, useState } from 'react';\nimport { Canvas } from '@/components/editor/canvas';\nimport { ComponentsSidebar } from '@/components/editor/components-sidebar';\nimport { Button } from '@/components/ui/button';\nimport { Node, Connection, ComponentDefinition } from '@/types/bot';\n\ninterface FullscreenCanvasProps {\n  nodes: Node[];\n  connections: Connection[];\n  selectedNodeId: string | null;\n  selectedConnectionId?: string;\n  onNodeSelect: (nodeId: string) => void;\n  onNodeAdd: (node: Node) => void;\n  onNodeDelete: (nodeId: string) => void;\n  onNodeDuplicate?: (nodeId: string) => void;\n  onNodeMove: (nodeId: string, position: { x: number; y: number }) => void;\n  onConnectionSelect?: (connectionId: string) => void;\n  onConnectionDelete?: (connectionId: string) => void;\n  onConnectionAdd?: (connection: Connection) => void;\n  onNodesUpdate?: (nodes: Node[]) => void;\n  onUndo?: () => void;\n  onRedo?: () => void;\n  canUndo?: boolean;\n  canRedo?: boolean;\n  onSave?: () => void;\n  isSaving?: boolean;\n  onExitFullscreen: () => void;\n}\n\nexport function FullscreenCanvas({\n  nodes,\n  connections,\n  selectedNodeId,\n  selectedConnectionId,\n  onNodeSelect,\n  onNodeAdd,\n  onNodeDelete,\n  onNodeDuplicate,\n  onNodeMove,\n  onConnectionSelect,\n  onConnectionDelete,\n  onConnectionAdd,\n  onNodesUpdate,\n  onUndo,\n  onRedo,\n  canUndo,\n  canRedo,\n  onSave,\n  isSaving,\n  onExitFullscreen\n}: FullscreenCanvasProps) {\n  \n  const [showComponentsSidebar, setShowComponentsSidebar] = useState(false);\n  const [isNodeBeingDragged, setIsNodeBeingDragged] = useState(false);\n\n  const handleComponentDrag = useCallback((component: ComponentDefinition) => {\n    // Handle component drag if needed\n  }, []);\n\n  const handleComponentAdd = useCallback((component: ComponentDefinition) => {\n    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —É–∑–µ–ª –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞\n    const newNode: any = {\n      id: Date.now().toString(), // –ü—Ä–æ—Å—Ç–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID\n      type: component.type,\n      position: { x: 200 + Math.random() * 100, y: 200 + Math.random() * 100 },\n      data: component.defaultData || {}\n    };\n    \n    // –î–æ–±–∞–≤–ª—è–µ–º —É–∑–µ–ª –Ω–∞ —Ö–æ–ª—Å—Ç\n    onNodeAdd(newNode);\n  }, [onNodeAdd]);\n\n  const toggleComponentsSidebar = useCallback(() => {\n    setShowComponentsSidebar(prev => !prev);\n  }, []);\n  \n  // Handle ESC key to exit fullscreen\n  const handleKeyDown = useCallback((event: KeyboardEvent) => {\n    if (event.key === 'Escape') {\n      onExitFullscreen();\n    }\n  }, [onExitFullscreen]);\n\n  // Handle F11 key\n  const handleF11 = useCallback((event: KeyboardEvent) => {\n    if (event.key === 'F11') {\n      event.preventDefault();\n      onExitFullscreen();\n    }\n  }, [onExitFullscreen]);\n\n  useEffect(() => {\n    document.addEventListener('keydown', handleKeyDown);\n    document.addEventListener('keydown', handleF11);\n    \n    // Hide scrollbars on body when in fullscreen\n    document.body.style.overflow = 'hidden';\n    \n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n      document.removeEventListener('keydown', handleF11);\n      document.body.style.overflow = 'auto';\n    };\n  }, [handleKeyDown, handleF11]);\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-white dark:bg-slate-950 flex\">\n      {/* Components Sidebar */}\n      {showComponentsSidebar && (\n        <div className=\"w-80 h-full bg-white/95 dark:bg-slate-950/95 backdrop-blur-md border-r border-gray-200/50 dark:border-slate-700/50 shadow-2xl flex-shrink-0\">\n          <div className=\"h-full flex flex-col\">\n            <div className=\"p-4 border-b border-gray-200/50 dark:border-slate-700/50\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100\">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</h3>\n                <Button\n                  onClick={toggleComponentsSidebar}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-8 w-8 p-0\"\n                >\n                  <i className=\"fas fa-times text-gray-500\"></i>\n                </Button>\n              </div>\n            </div>\n            <div className=\"flex-1 overflow-hidden\">\n              <ComponentsSidebar\n                onComponentDrag={handleComponentDrag}\n                onComponentAdd={handleComponentAdd}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Main canvas area */}\n      <div className=\"flex-1 relative\">\n        {/* Top controls */}\n        <div className=\"absolute top-4 right-4 z-50 flex items-center space-x-2\">\n          <Button\n            onClick={toggleComponentsSidebar}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"bg-white/90 dark:bg-slate-900/90 backdrop-blur-md shadow-xl border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800\"\n          >\n            <i className=\"fas fa-th-large mr-2\"></i>\n            –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã\n          </Button>\n          <Button\n            onClick={onExitFullscreen}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"bg-white/90 dark:bg-slate-900/90 backdrop-blur-md shadow-xl border-gray-200/50 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-800\"\n          >\n            <i className=\"fas fa-times mr-2\"></i>\n            –í—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞\n          </Button>\n        </div>\n\n        {/* Help text */}\n        <div className=\"absolute bottom-4 left-4 z-50\">\n          <div className=\"bg-white/90 dark:bg-slate-900/90 backdrop-blur-md rounded-lg shadow-xl border border-gray-200/50 dark:border-slate-700/50 px-3 py-2 text-xs text-gray-600 dark:text-gray-400\">\n            <div className=\"flex items-center space-x-2\">\n              <i className=\"fas fa-keyboard text-blue-500\"></i>\n              <span>ESC –∏–ª–∏ F11 –¥–ª—è –≤—ã—Ö–æ–¥–∞</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Canvas taking full remaining space */}\n        <div className=\"w-full h-full\">\n          <Canvas\n            nodes={nodes}\n            connections={connections}\n            selectedNodeId={selectedNodeId}\n            selectedConnectionId={selectedConnectionId}\n            onNodeSelect={onNodeSelect}\n            onNodeAdd={onNodeAdd}\n            onNodeDelete={onNodeDelete}\n            onNodeDuplicate={onNodeDuplicate}\n            onNodeMove={onNodeMove}\n            onConnectionSelect={onConnectionSelect}\n            onConnectionDelete={onConnectionDelete}\n            onConnectionAdd={onConnectionAdd}\n            onNodesUpdate={onNodesUpdate}\n            onUndo={onUndo}\n            onRedo={onRedo}\n            canUndo={canUndo}\n            canRedo={canRedo}\n            onSave={onSave}\n            isSaving={isSaving}\n            isNodeBeingDragged={isNodeBeingDragged}\n            setIsNodeBeingDragged={setIsNodeBeingDragged}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":6979},"client/src/components/editor/header.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { ThemeToggle } from '@/components/theme-toggle';\nimport { FolderOpen, Bookmark, Save, Download, User, Send } from 'lucide-react';\nimport { useState } from 'react';\n\ninterface HeaderProps {\n  projectName: string;\n  currentTab: 'editor' | 'preview' | 'export' | 'bot';\n  onTabChange: (tab: 'editor' | 'preview' | 'export' | 'bot') => void;\n  onSave: () => void;\n  onExport: () => void;\n  onSaveAsTemplate?: () => void;\n  onLoadTemplate?: () => void;\n  isSaving?: boolean;\n}\n\nexport function Header({ projectName, currentTab, onTabChange, onSave, onExport, onSaveAsTemplate, onLoadTemplate, isSaving }: HeaderProps) {\n  return (\n    <header className=\"bg-background border-b border-border h-16 flex items-center justify-between px-6 relative z-50\">\n      <div className=\"flex items-center space-x-4\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"w-8 h-8 bg-primary rounded-lg flex items-center justify-center\">\n            <i className=\"fab fa-telegram-plane text-primary-foreground text-lg\"></i>\n          </div>\n          <div>\n            <h1 className=\"text-lg font-semibold text-foreground\">BotCraft Studio</h1>\n            <p className=\"text-xs text-muted-foreground\">{projectName}</p>\n          </div>\n        </div>\n        \n        <div className=\"h-6 w-px bg-border\"></div>\n        \n        <nav className=\"flex flex-wrap items-center gap-1 max-sm:grid max-sm:grid-cols-2 max-sm:gap-x-2 max-sm:gap-y-1\">\n          {[\n            { key: 'editor', label: '–†–µ–¥–∞–∫—Ç–æ—Ä' },\n            { key: 'preview', label: '–ü—Ä–µ–≤—å—é' },\n            { key: 'export', label: '–≠–∫—Å–ø–æ—Ä—Ç' },\n            { key: 'bot', label: '–ë–æ—Ç' }\n          ].map((tab) => (\n            <button \n              key={tab.key}\n              onClick={() => onTabChange(tab.key as any)}\n              className={`px-3 py-1.5 text-sm max-sm:text-xs max-sm:px-2 max-sm:py-1 font-medium rounded-md transition-colors whitespace-nowrap ${\n                currentTab === tab.key \n                  ? 'text-primary bg-primary/10' \n                  : 'text-muted-foreground hover:bg-muted'\n              }`}\n            >\n              {tab.label}\n            </button>\n          ))}\n        </nav>\n      </div>\n      \n      <div className=\"flex flex-wrap items-center gap-2 max-sm:grid max-sm:grid-cols-3 max-sm:gap-x-1 max-sm:gap-y-1 max-sm:text-xs\">\n        {onLoadTemplate && (\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            onClick={() => {\n              console.log('Templates button clicked in header');\n              onLoadTemplate();\n            }}\n            className=\"flex items-center justify-center px-1 py-0.5 text-xs max-sm:px-1 max-sm:py-0.5 max-sm:min-w-0 max-sm:w-full\"\n          >\n            <FolderOpen className=\"h-2.5 w-2.5 max-sm:mx-auto text-muted-foreground\" />\n            <span className=\"max-sm:hidden ml-1\">–®–∞–±–ª–æ–Ω</span>\n          </Button>\n        )}\n        \n        {onSaveAsTemplate && (\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            onClick={onSaveAsTemplate}\n            className=\"flex items-center justify-center px-1 py-0.5 text-xs max-sm:px-1 max-sm:py-0.5 max-sm:min-w-0 max-sm:w-full\"\n          >\n            <Bookmark className=\"h-2.5 w-2.5 max-sm:mx-auto text-muted-foreground\" />\n            <span className=\"max-sm:hidden ml-1\">–°–æ–∑–¥–∞—Ç—å</span>\n          </Button>\n        )}\n        \n        <Button \n          variant=\"outline\" \n          size=\"sm\"\n          onClick={onSave}\n          disabled={isSaving}\n          className=\"flex items-center justify-center px-1 py-0.5 text-xs max-sm:px-1 max-sm:py-0.5 max-sm:min-w-0 max-sm:w-full\"\n        >\n          <Save className={`h-2.5 w-2.5 max-sm:mx-auto text-muted-foreground ${isSaving ? 'animate-spin' : ''}`} />\n          <span className=\"max-sm:hidden ml-1\">{isSaving ? '–°–æ—Ö—Ä...' : '–°–æ—Ö—Ä'}</span>\n        </Button>\n        \n        <Button \n          size=\"sm\"\n          onClick={onExport}\n          className=\"flex items-center justify-center px-1 py-0.5 text-xs max-sm:px-1 max-sm:py-0.5 max-sm:min-w-0 max-sm:w-full max-sm:col-span-2\"\n        >\n          <i className=\"fas fa-download text-2xs max-sm:mx-auto\"></i>\n          <span className=\"max-sm:hidden ml-1\">–≠–∫—Å–ø–æ—Ä—Ç</span>\n        </Button>\n        \n        <div className=\"h-6 w-px bg-border max-sm:hidden\"></div>\n        \n        <div className=\"max-sm:col-span-1 max-sm:flex max-sm:justify-center\">\n          <ThemeToggle />\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":4605},"client/src/components/editor/inline-rich-editor.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { \n  Bold, \n  Italic, \n  Underline, \n  Strikethrough, \n  Code, \n  Type,\n  Quote,\n  Heading3,\n  Link,\n  List,\n  ListOrdered,\n  RotateCcw,\n  RotateCw,\n  Copy,\n  Sparkles,\n  Plus\n} from 'lucide-react';\nimport { \n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n  DropdownMenuLabel\n} from '@/components/ui/dropdown-menu';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface Variable {\n  name: string;\n  nodeId: string;\n  nodeType: string;\n  description?: string;\n}\n\ninterface InlineRichEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  enableMarkdown?: boolean;\n  onMarkdownToggle?: (enabled: boolean) => void;\n  onFormatModeChange?: (formatMode: 'html' | 'markdown' | 'none') => void;\n  availableVariables?: Variable[];\n}\n\nexport function InlineRichEditor({\n  value,\n  onChange,\n  placeholder = \"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è...\",\n  enableMarkdown = false,\n  onMarkdownToggle,\n  onFormatModeChange,\n  availableVariables = []\n}: InlineRichEditorProps) {\n  const [wordCount, setWordCount] = useState(0);\n  const [charCount, setCharCount] = useState(0);\n  const [undoStack, setUndoStack] = useState<string[]>([]);\n  const [redoStack, setRedoStack] = useState<string[]>([]);\n  const [isFormatting, setIsFormatting] = useState(false);\n  const editorRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n\n  // Save state to undo stack\n  const saveToUndoStack = useCallback(() => {\n    setUndoStack(prev => [...prev.slice(-19), value]);\n    setRedoStack([]);\n  }, [value]);\n\n  // Update word and character counts\n  useEffect(() => {\n    const plainText = value.replace(/<[^>]*>/g, '').replace(/\\*\\*|__|~~|`/g, '');\n    const words = plainText.trim().split(/\\s+/).filter(word => word.length > 0);\n    setWordCount(words.length);\n    setCharCount(plainText.length);\n  }, [value]);\n\n  // Convert value to display HTML\n  const valueToHtml = useCallback((text: string) => {\n    if (!text) return '';\n    \n    let html = text;\n    \n    if (enableMarkdown) {\n      // Convert markdown to HTML for contenteditable\n      html = html\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n        .replace(/(?<!\\*)\\*([^*]+)\\*(?!\\*)/g, '<em>$1</em>')\n        .replace(/__(.*?)__/g, '<u>$1</u>')\n        .replace(/~~(.*?)~~/g, '<s>$1</s>')\n        .replace(/`([^`]+)`/g, '<code>$1</code>')\n        .replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>')\n        .replace(/^# (.+)$/gm, '<h3>$1</h3>')\n        .replace(/^## (.+)$/gm, '<h4>$1</h4>')\n        .replace(/^### (.+)$/gm, '<h5>$1</h5>')\n        .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\">$1</a>')\n        .replace(/\\n/g, '<br>');\n    } else {\n      // For HTML mode, just convert newlines to br tags\n      html = html.replace(/\\n/g, '<br>');\n    }\n    \n    return html;\n  }, [enableMarkdown]);\n\n  // Convert display HTML back to value\n  const htmlToValue = useCallback((html: string) => {\n    if (!html) return '';\n    \n    let text = html;\n    \n    if (enableMarkdown) {\n      // Convert HTML back to markdown\n      text = text\n        .replace(/<strong[^>]*>(.*?)<\\/strong>/g, '**$1**')\n        .replace(/<em[^>]*>(.*?)<\\/em>/g, '*$1*')\n        .replace(/<u[^>]*>(.*?)<\\/u>/g, '__$1__')\n        .replace(/<s[^>]*>(.*?)<\\/s>/g, '~~$1~~')\n        .replace(/<code[^>]*>(.*?)<\\/code>/g, '`$1`')\n        .replace(/<blockquote[^>]*>(.*?)<\\/blockquote>/g, '> $1')\n        .replace(/<h3[^>]*>(.*?)<\\/h3>/g, '# $1')\n        .replace(/<h4[^>]*>(.*?)<\\/h4>/g, '## $1')\n        .replace(/<h5[^>]*>(.*?)<\\/h5>/g, '### $1')\n        .replace(/<a[^>]*href=\"([^\"]*)\"[^>]*>(.*?)<\\/a>/g, '[$2]($1)')\n        .replace(/<br\\s*\\/?>/g, '\\n')\n        .replace(/<div[^>]*>/g, '\\n')\n        .replace(/<\\/div>/g, '');\n    } else {\n      // For HTML mode, just convert br tags to newlines\n      text = text\n        .replace(/<br\\s*\\/?>/g, '\\n')\n        .replace(/<div[^>]*>/g, '\\n')\n        .replace(/<\\/div>/g, '');\n    }\n    \n    return text;\n  }, [enableMarkdown]);\n\n  // Update editor content when value changes\n  useEffect(() => {\n    if (editorRef.current && !isFormatting) {\n      const html = valueToHtml(value);\n      if (editorRef.current.innerHTML !== html) {\n        // Save current selection\n        const selection = window.getSelection();\n        let range = null;\n        let offset = 0;\n        \n        if (selection && selection.rangeCount > 0) {\n          try {\n            range = selection.getRangeAt(0);\n            offset = range.startOffset;\n          } catch (e) {\n            // Ignore selection errors\n          }\n        }\n        \n        editorRef.current.innerHTML = html;\n        \n        // Restore selection\n        if (range && selection) {\n          try {\n            const newRange = document.createRange();\n            const walker = document.createTreeWalker(\n              editorRef.current,\n              NodeFilter.SHOW_TEXT,\n              null,\n              false\n            );\n            \n            let currentOffset = 0;\n            let targetNode = null;\n            \n            while (walker.nextNode()) {\n              const node = walker.currentNode;\n              const nodeLength = node.textContent?.length || 0;\n              \n              if (currentOffset + nodeLength >= offset) {\n                targetNode = node;\n                break;\n              }\n              currentOffset += nodeLength;\n            }\n            \n            if (targetNode) {\n              newRange.setStart(targetNode, Math.min(offset - currentOffset, targetNode.textContent?.length || 0));\n              newRange.collapse(true);\n              selection.removeAllRanges();\n              selection.addRange(newRange);\n            }\n          } catch (e) {\n            // Ignore range errors\n          }\n        }\n      }\n    }\n  }, [value, valueToHtml, isFormatting]);\n\n  // Handle input in contenteditable\n  const handleInput = useCallback(() => {\n    if (editorRef.current) {\n      setIsFormatting(true);\n      const html = editorRef.current.innerHTML;\n      const text = htmlToValue(html);\n      onChange(text);\n      setTimeout(() => setIsFormatting(false), 0);\n    }\n  }, [onChange, htmlToValue]);\n\n  // Format options\n  const formatOptions = [\n    { \n      command: 'bold', \n      icon: Bold, \n      name: '–ñ–∏—Ä–Ω—ã–π', \n      shortcut: 'Ctrl+B',\n      markdown: '**—Ç–µ–∫—Å—Ç**',\n      html: '<strong>—Ç–µ–∫—Å—Ç</strong>'\n    },\n    { \n      command: 'italic', \n      icon: Italic, \n      name: '–ö—É—Ä—Å–∏–≤', \n      shortcut: 'Ctrl+I',\n      markdown: '*—Ç–µ–∫—Å—Ç*',\n      html: '<em>—Ç–µ–∫—Å—Ç</em>'\n    },\n    { \n      command: 'underline', \n      icon: Underline, \n      name: '–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π', \n      shortcut: 'Ctrl+U',\n      markdown: '__—Ç–µ–∫—Å—Ç__',\n      html: '<u>—Ç–µ–∫—Å—Ç</u>'\n    },\n    { \n      command: 'strikethrough', \n      icon: Strikethrough, \n      name: '–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π', \n      shortcut: 'Ctrl+Shift+X',\n      markdown: '~~—Ç–µ–∫—Å—Ç~~',\n      html: '<s>—Ç–µ–∫—Å—Ç</s>'\n    },\n    { \n      command: 'code', \n      icon: Code, \n      name: '–ö–æ–¥', \n      shortcut: 'Ctrl+E',\n      markdown: '`–∫–æ–¥`',\n      html: '<code>–∫–æ–¥</code>'\n    },\n    { \n      command: 'quote', \n      icon: Quote, \n      name: '–¶–∏—Ç–∞—Ç–∞', \n      shortcut: 'Ctrl+Q',\n      markdown: '> —Ü–∏—Ç–∞—Ç–∞',\n      html: '<blockquote>—Ü–∏—Ç–∞—Ç–∞</blockquote>'\n    },\n    { \n      command: 'heading', \n      icon: Heading3, \n      name: '–ó–∞–≥–æ–ª–æ–≤–æ–∫', \n      shortcut: 'Ctrl+H',\n      markdown: '# –∑–∞–≥–æ–ª–æ–≤–æ–∫',\n      html: '<h3>–∑–∞–≥–æ–ª–æ–≤–æ–∫</h3>'\n    }\n  ];\n\n  // Apply formatting\n  const applyFormatting = useCallback((format: typeof formatOptions[0]) => {\n    if (!editorRef.current) return;\n    \n    saveToUndoStack();\n    setIsFormatting(true);\n    \n    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ HTML —Ä–µ–∂–∏–º –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–Ω–æ–ø–æ–∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n    if (onFormatModeChange) {\n      onFormatModeChange('html');\n    }\n    \n    const selection = window.getSelection();\n    if (!selection || selection.rangeCount === 0) {\n      toast({\n        title: \"–ù–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è\",\n        description: \"–í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∫—É—Ä—Å–æ—Ä –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ\",\n        variant: \"default\"\n      });\n      setIsFormatting(false);\n      return;\n    }\n    \n    try {\n      const range = selection.getRangeAt(0);\n      const selectedText = range.toString();\n      \n      if (format.command === 'bold' || format.command === 'italic' || format.command === 'underline' || format.command === 'strikethrough') {\n        // Use document.execCommand for basic formatting\n        document.execCommand(format.command, false, undefined);\n      } else if (format.command === 'code') {\n        // Custom code formatting\n        if (selectedText) {\n          const codeElement = document.createElement('code');\n          codeElement.textContent = selectedText;\n          range.deleteContents();\n          range.insertNode(codeElement);\n          range.selectNode(codeElement);\n          selection.removeAllRanges();\n          selection.addRange(range);\n        }\n      } else if (format.command === 'quote') {\n        // Custom quote formatting\n        if (selectedText) {\n          const quoteElement = document.createElement('blockquote');\n          quoteElement.textContent = selectedText;\n          range.deleteContents();\n          range.insertNode(quoteElement);\n          range.selectNode(quoteElement);\n          selection.removeAllRanges();\n          selection.addRange(range);\n        }\n      } else if (format.command === 'heading') {\n        // Custom heading formatting\n        if (selectedText) {\n          const headingElement = document.createElement('h3');\n          headingElement.textContent = selectedText;\n          range.deleteContents();\n          range.insertNode(headingElement);\n          range.selectNode(headingElement);\n          selection.removeAllRanges();\n          selection.addRange(range);\n        }\n      }\n      \n      // Update the value\n      setTimeout(() => {\n        handleInput();\n        toast({\n          title: \"–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ\",\n          description: `${format.name} –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É`,\n          variant: \"default\"\n        });\n      }, 0);\n    } catch (e) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\",\n        variant: \"destructive\"\n      });\n    }\n    \n    setTimeout(() => setIsFormatting(false), 100);\n  }, [saveToUndoStack, handleInput, toast, onFormatModeChange]);\n\n  // Handle keyboard shortcuts\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (e.ctrlKey || e.metaKey) {\n      const key = e.key.toLowerCase();\n      \n      switch (key) {\n        case 'b':\n          e.preventDefault();\n          applyFormatting(formatOptions[0]);\n          break;\n        case 'i':\n          e.preventDefault();\n          applyFormatting(formatOptions[1]);\n          break;\n        case 'u':\n          e.preventDefault();\n          applyFormatting(formatOptions[2]);\n          break;\n        case 'e':\n          e.preventDefault();\n          applyFormatting(formatOptions[4]);\n          break;\n        case 'q':\n          e.preventDefault();\n          applyFormatting(formatOptions[5]);\n          break;\n        case 'h':\n          e.preventDefault();\n          applyFormatting(formatOptions[6]);\n          break;\n        case 'x':\n          if (e.shiftKey) {\n            e.preventDefault();\n            applyFormatting(formatOptions[3]);\n          }\n          break;\n        case 'z':\n          if (e.shiftKey) {\n            e.preventDefault();\n            redo();\n          } else {\n            e.preventDefault();\n            undo();\n          }\n          break;\n      }\n    }\n  }, [applyFormatting, formatOptions]);\n\n  // Undo functionality\n  const undo = useCallback(() => {\n    if (undoStack.length > 0) {\n      const previousValue = undoStack[undoStack.length - 1];\n      setRedoStack(prev => [...prev, value]);\n      setUndoStack(prev => prev.slice(0, -1));\n      onChange(previousValue);\n      toast({\n        title: \"–û—Ç–º–µ–Ω–µ–Ω–æ\",\n        description: \"–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ\",\n        variant: \"default\"\n      });\n    }\n  }, [undoStack, value, onChange, toast]);\n\n  // Redo functionality\n  const redo = useCallback(() => {\n    if (redoStack.length > 0) {\n      const nextValue = redoStack[redoStack.length - 1];\n      setUndoStack(prev => [...prev, value]);\n      setRedoStack(prev => prev.slice(0, -1));\n      onChange(nextValue);\n      toast({\n        title: \"–ü–æ–≤—Ç–æ—Ä–µ–Ω–æ\",\n        description: \"–î–µ–π—Å—Ç–≤–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–æ\",\n        variant: \"default\"\n      });\n    }\n  }, [redoStack, value, onChange, toast]);\n\n  // Copy formatted text\n  const copyFormatted = useCallback(() => {\n    if (editorRef.current) {\n      const html = editorRef.current.innerHTML;\n      navigator.clipboard.writeText(html).then(() => {\n        toast({\n          title: \"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ\",\n          description: \"–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞\",\n          variant: \"default\"\n        });\n      });\n    }\n  }, [toast]);\n\n  // Insert variable at cursor position\n  const insertVariable = useCallback((variableName: string) => {\n    if (!editorRef.current) return;\n    \n    saveToUndoStack();\n    setIsFormatting(true);\n    \n    const selection = window.getSelection();\n    if (!selection) {\n      setIsFormatting(false);\n      return;\n    }\n\n    try {\n      let range: Range;\n      \n      if (selection.rangeCount > 0) {\n        range = selection.getRangeAt(0);\n      } else {\n        // If no selection, create a range at the end of the content\n        range = document.createRange();\n        range.selectNodeContents(editorRef.current);\n        range.collapse(false);\n      }\n\n      // Create the variable placeholder text\n      const variableText = `{${variableName}}`;\n      const textNode = document.createTextNode(variableText);\n      \n      // Insert the variable\n      range.deleteContents();\n      range.insertNode(textNode);\n      \n      // Position cursor after the inserted variable\n      range.setStartAfter(textNode);\n      range.setEndAfter(textNode);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      \n      // Update the value\n      setTimeout(() => {\n        handleInput();\n        toast({\n          title: \"–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–±–∞–≤–ª–µ–Ω–∞\",\n          description: `–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è \"${variableName}\" –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ —Ç–µ–∫—Å—Ç`,\n          variant: \"default\"\n        });\n      }, 0);\n      \n    } catch (e) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –≤—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é\",\n        variant: \"destructive\"\n      });\n    }\n    \n    setTimeout(() => setIsFormatting(false), 100);\n  }, [saveToUndoStack, handleInput, toast]);\n\n  return (\n    <div className=\"space-y-3\">\n      {/* Toolbar */}\n      <div className=\"flex flex-wrap items-center gap-1 p-2 bg-muted/50 rounded-md\">\n        <div className=\"flex items-center gap-1\">\n          {formatOptions.map((format) => (\n            <Button\n              key={format.command}\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => applyFormatting(format)}\n              className=\"h-7 w-7 p-0\"\n              title={`${format.name} (${format.shortcut})`}\n            >\n              <format.icon className=\"h-3 w-3\" />\n            </Button>\n          ))}\n        </div>\n        \n        <div className=\"h-4 w-px bg-border mx-1\" />\n        \n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={undo}\n            disabled={undoStack.length === 0}\n            className=\"h-7 w-7 p-0\"\n            title=\"–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)\"\n          >\n            <RotateCcw className=\"h-3 w-3\" />\n          </Button>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={redo}\n            disabled={redoStack.length === 0}\n            className=\"h-7 w-7 p-0\"\n            title=\"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (Ctrl+Shift+Z)\"\n          >\n            <RotateCw className=\"h-3 w-3\" />\n          </Button>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={copyFormatted}\n            className=\"h-7 w-7 p-0\"\n            title=\"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç\"\n          >\n            <Copy className=\"h-3 w-3\" />\n          </Button>\n        </div>\n        \n        {/* Variables Insert Button */}\n        {availableVariables.length > 0 && (\n          <>\n            <div className=\"h-4 w-px bg-border mx-1\" />\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-7 px-2 gap-1\"\n                  title=\"–í—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                  <span className=\"text-xs\">–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è</span>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-56\">\n                <DropdownMenuLabel className=\"text-xs\">\n                  –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\n                </DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                {availableVariables.map((variable, index) => (\n                  <DropdownMenuItem\n                    key={`${variable.nodeId}-${variable.name}-${index}`}\n                    onClick={() => insertVariable(variable.name)}\n                    className=\"cursor-pointer\"\n                  >\n                    <div className=\"flex flex-col gap-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <code className=\"text-xs bg-muted px-1 py-0.5 rounded\">\n                          {`{${variable.name}}`}\n                        </code>\n                        <Badge variant=\"outline\" className=\"text-xs h-4\">\n                          {variable.nodeType === 'user-input' ? '–í–≤–æ–¥' : \n                           variable.nodeType === 'start' ? '–ö–æ–º–∞–Ω–¥–∞' :\n                           variable.nodeType === 'command' ? '–ö–æ–º–∞–Ω–¥–∞' : \n                           '–î—Ä—É–≥–æ–µ'}\n                        </Badge>\n                      </div>\n                      {variable.description && (\n                        <div className=\"text-xs text-muted-foreground\">\n                          {variable.description}\n                        </div>\n                      )}\n                    </div>\n                  </DropdownMenuItem>\n                ))}\n                {availableVariables.length === 0 && (\n                  <DropdownMenuItem disabled>\n                    <span className=\"text-xs text-muted-foreground\">\n                      –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n                    </span>\n                  </DropdownMenuItem>\n                )}\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </>\n        )}\n        \n        <div className=\"flex-1\" />\n        \n        <div className=\"flex items-center gap-2\">\n          <Switch\n            checked={enableMarkdown}\n            onCheckedChange={onMarkdownToggle}\n            className=\"scale-75\"\n          />\n        </div>\n      </div>\n\n      {/* Editor */}\n      <div className=\"relative\">\n        <div\n          ref={editorRef}\n          contentEditable\n          onInput={handleInput}\n          onKeyDown={handleKeyDown}\n          className=\"min-h-[120px] p-3 border rounded-md bg-background text-sm focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-pre-wrap\"\n          style={{ \n            lineHeight: '1.5',\n            overflowWrap: 'break-word',\n            wordBreak: 'break-word'\n          }}\n          data-placeholder={placeholder}\n        />\n        \n        {/* Placeholder */}\n        {!value && (\n          <div className=\"absolute top-3 left-3 text-muted-foreground text-sm pointer-events-none\">\n            {placeholder}\n          </div>\n        )}\n        \n        {/* Stats */}\n        <div className=\"absolute bottom-2 right-2 flex items-center gap-2\">\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {wordCount} —Å–ª–æ–≤\n          </Badge>\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {charCount} —Å–∏–º–≤–æ–ª–æ–≤\n          </Badge>\n        </div>\n      </div>\n\n\n    </div>\n  );\n}","size_bytes":21145},"client/src/components/editor/preview-modal.tsx":{"content":"import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Node, Connection } from '@shared/schema';\nimport { parseCommandFromText } from '@/lib/commands';\nimport { useState, useRef, useEffect } from 'react';\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ markdown –≤ HTML\nconst renderMarkdown = (text: string): string => {\n  return text\n    // –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç: **text** ‚Üí <strong>text</strong>\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    // –ö—É—Ä—Å–∏–≤: *text* ‚Üí <em>text</em>\n    .replace(/\\*((?:[^*]|\\*{2})*?)\\*/g, '<em>$1</em>')\n    // –ö–æ–¥: `text` ‚Üí <code>text</code>\n    .replace(/`([^`]+)`/g, '<code class=\"bg-gray-100 px-1 py-0.5 rounded text-xs\">$1</code>')\n    // –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫: \\n ‚Üí <br>\n    .replace(/\\n/g, '<br>')\n    // –°—Å—ã–ª–∫–∏: [text](url) ‚Üí <a href=\"url\">text</a>\n    .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"text-blue-600 hover:underline\">$1</a>');\n};\n\ninterface PreviewModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  nodes: Node[];\n  connections: Connection[];\n  projectName: string;\n}\n\nexport function PreviewModal({ isOpen, onClose, nodes, connections, projectName }: PreviewModalProps) {\n  const [currentNodeId, setCurrentNodeId] = useState<string>('');\n  const [messageHistory, setMessageHistory] = useState<Array<{\n    id: string;\n    type: 'bot' | 'user';\n    text: string;\n    time: string;\n    buttons?: Array<{ text: string; target?: string; action?: string; }>;\n    keyboardType?: 'reply' | 'inline' | 'none';\n    mediaType?: 'photo' | 'video' | 'audio' | 'document' | 'sticker' | 'voice' | 'animation' | 'location' | 'contact' | 'poll' | 'dice';\n    mediaUrl?: string;\n    mediaCaption?: string;\n    mediaData?: any; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞\n  }>>([]);\n  const [currentReplyKeyboard, setCurrentReplyKeyboard] = useState<Array<{ text: string; target?: string; action?: string; }> | null>(null);\n  const [textInput, setTextInput] = useState('');\n  const [waitingForInput, setWaitingForInput] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const chatAreaRef = useRef<HTMLDivElement>(null);\n\n  // Find start node or first node\n  const startNode = nodes.find(node => node.type === 'start') || nodes[0];\n\n  // Helper function to find next node based on connections\n  const findNextNode = (currentNodeId: string, isSuccess: boolean = true) => {\n    // Find all connections from current node\n    const fromConnections = connections.filter(conn => conn.source === currentNodeId);\n    \n    if (fromConnections.length === 0) {\n      return null;\n    }\n\n\n    // For other node types, return the first connection\n    const nextConnection = fromConnections[0];\n    return nextConnection ? nodes.find(node => node.id === nextConnection.target) : null;\n  };\n\n  // Helper function to get media information from a node\n  const getMediaInfo = (node: Node) => {\n    switch (node.type) {\n      case 'photo':\n        return {\n          mediaType: 'photo' as const,\n          mediaUrl: node.data.imageUrl || 'https://picsum.photos/800/600?random=1',\n          mediaCaption: node.data.mediaCaption\n        };\n      case 'video':\n        return {\n          mediaType: 'video' as const,\n          mediaUrl: node.data.videoUrl || 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4',\n          mediaCaption: node.data.mediaCaption\n        };\n      case 'audio':\n        return {\n          mediaType: 'audio' as const,\n          mediaUrl: node.data.audioUrl || 'https://www.soundjay.com/misc/beep-07a.wav',\n          mediaCaption: node.data.mediaCaption,\n          mediaData: {\n            performer: node.data.performer,\n            duration: node.data.duration\n          }\n        };\n      case 'document':\n        return {\n          mediaType: 'document' as const,\n          mediaUrl: node.data.documentUrl || 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',\n          mediaCaption: node.data.mediaCaption,\n          mediaData: {\n            filename: node.data.filename || node.data.documentName || 'document.pdf'\n          }\n        };\n      case 'sticker':\n        return {\n          mediaType: 'sticker' as const,\n          mediaUrl: node.data.stickerUrl || 'https://telegram.org/img/t_logo.png',\n          mediaCaption: node.data.mediaCaption\n        };\n      case 'voice':\n        return {\n          mediaType: 'voice' as const,\n          mediaUrl: node.data.voiceUrl || 'https://www.soundjay.com/misc/beep-07a.wav',\n          mediaCaption: node.data.mediaCaption,\n          mediaData: {\n            duration: node.data.duration\n          }\n        };\n      case 'animation':\n        return {\n          mediaType: 'animation' as const,\n          mediaUrl: node.data.animationUrl || 'https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif',\n          mediaCaption: node.data.mediaCaption\n        };\n      case 'location':\n        return {\n          mediaType: 'location' as const,\n          mediaData: {\n            latitude: node.data.latitude || 55.7558,\n            longitude: node.data.longitude || 37.6176,\n            title: node.data.title || '–õ–æ–∫–∞—Ü–∏—è',\n            address: node.data.address\n          }\n        };\n      case 'contact':\n        return {\n          mediaType: 'contact' as const,\n          mediaData: {\n            firstName: node.data.firstName || '–ò–º—è',\n            lastName: node.data.lastName,\n            phoneNumber: node.data.phoneNumber\n          }\n        };\n      case 'poll':\n        return {\n          mediaType: 'poll' as const,\n          mediaData: {\n            question: node.data.question || '–í–æ–ø—Ä–æ—Å',\n            options: node.data.options || ['–í–∞—Ä–∏–∞–Ω—Ç 1', '–í–∞—Ä–∏–∞–Ω—Ç 2'],\n            allowsMultipleAnswers: node.data.allowsMultipleAnswers,\n            anonymousVoting: node.data.anonymousVoting\n          }\n        };\n      case 'dice':\n        return {\n          mediaType: 'dice' as const,\n          mediaData: {\n            emoji: node.data.emoji || 'üé≤'\n          }\n        };\n      default:\n        return {};\n    }\n  };\n\n  // Auto-scroll to bottom when new messages are added\n  useEffect(() => {\n    if (chatAreaRef.current) {\n      chatAreaRef.current.scrollTop = chatAreaRef.current.scrollHeight;\n    }\n  }, [messageHistory]);\n\n  const handleStart = () => {\n    if (!startNode) return;\n    \n    const time = new Date().toLocaleTimeString('ru-RU', { \n      hour: '2-digit', \n      minute: '2-digit' \n    });\n\n    const buttons = startNode.data.keyboardType !== 'none' && startNode.data.buttons ? startNode.data.buttons.map(btn => ({\n      text: btn.text,\n      target: btn.target,\n      action: btn.action\n    })) : undefined;\n\n\n\n    const mediaInfo = getMediaInfo(startNode);\n\n    const botMessage = {\n      id: `msg-${Date.now()}`,\n      type: 'bot' as const,\n      text: startNode.data.messageText || (startNode.type === 'start' ? '–ü—Ä–∏–≤–µ—Ç!' : ''),\n      time,\n      buttons,\n      keyboardType: startNode.data.keyboardType,\n      ...mediaInfo\n    };\n\n    setMessageHistory([botMessage]);\n    setCurrentNodeId(startNode.id);\n    \n    // Set reply keyboard if applicable\n    if (startNode.data.keyboardType === 'reply' && buttons) {\n      setCurrentReplyKeyboard(buttons);\n    } else {\n      setCurrentReplyKeyboard(null);\n    }\n    \n    // Check if this node expects input\n    const inputNode = nodes.find(node => node.type === 'input');\n    setWaitingForInput(!!inputNode && startNode.data.keyboardType === 'none');\n  };\n\n  const handleButtonClick = (buttonText: string, target?: string, action?: string) => {\n    handleUserMessage(buttonText, target, action);\n  };\n\n  const handleUserMessage = (messageText: string, target?: string, action?: string) => {\n    const time = new Date().toLocaleTimeString('ru-RU', { \n      hour: '2-digit', \n      minute: '2-digit' \n    });\n\n    // Add user message\n    const userMessage = {\n      id: `msg-${Date.now()}-user`,\n      type: 'user' as const,\n      text: messageText,\n      time\n    };\n\n    setMessageHistory(prev => [...prev, userMessage]);\n    setWaitingForInput(false);\n\n    // Navigate to target node if exists\n    setTimeout(() => {\n      if (target) {\n        // Find the target node by ID or by command if action is 'command'\n        let targetNode;\n        if (action === 'command') {\n          // Special handling for /start command - restart the bot\n          if (target === '/start') {\n            // Clear message history and restart\n            setTimeout(() => {\n              handleStart();\n            }, 100);\n            return;\n          }\n          // Find node with matching command\n          targetNode = nodes.find(node => \n            (node.type === 'command' || node.type === 'start') && \n            node.data.command === target\n          );\n        } else {\n          // Find node by ID\n          targetNode = nodes.find(node => node.id === target);\n        }\n        \n        if (targetNode) {\n          // Update current node\n          setCurrentNodeId(targetNode.id);\n          \n          // Get appropriate text and media based on node type\n          let responseText = '';\n          if (targetNode.data.messageText) {\n            responseText = targetNode.data.messageText;\n          } else if (targetNode.type === 'command') {\n            responseText = `–ö–æ–º–∞–Ω–¥–∞: ${targetNode.data.command || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞'}`;\n          } else if (targetNode.type === 'start') {\n            responseText = `–°—Ç–∞—Ä—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞: ${targetNode.data.command || '/start'}`;\n          } else if (targetNode.type === 'input') {\n            responseText = '–û–∂–∏–¥–∞—é –≤–≤–æ–¥...';\n          } else if (['photo', 'video', 'audio', 'document', 'sticker', 'voice', 'animation'].includes(targetNode.type)) {\n            responseText = targetNode.data.mediaCaption || '';\n          } else if (targetNode.type === 'location') {\n            responseText = targetNode.data.title || '–õ–æ–∫–∞—Ü–∏—è';\n          } else if (targetNode.type === 'contact') {\n            responseText = `${targetNode.data.firstName || '–ò–º—è'} ${targetNode.data.lastName || ''}`.trim();\n          } else if (targetNode.type === 'poll') {\n            responseText = targetNode.data.question || '–û–ø—Ä–æ—Å';\n          } else if (targetNode.type === 'dice') {\n            responseText = `–ö—É–±–∏–∫ ${targetNode.data.emoji || 'üé≤'}`;\n          } else {\n            responseText = '–°–æ–æ–±—â–µ–Ω–∏–µ';\n          }\n\n          const targetMediaInfo = getMediaInfo(targetNode);\n          \n          // Handle buttons\n          let buttons;\n          if (targetNode.data.keyboardType !== 'none' && targetNode.data.buttons) {\n            // Regular buttons for other node types\n            buttons = targetNode.data.buttons.map(btn => ({\n              text: btn.text,\n              target: btn.target,\n              action: btn.action\n            }));\n          }\n\n          // Create bot response from target node\n          const keyboardType = targetNode.data.keyboardType;\n            \n          const botResponse = {\n            id: `msg-${Date.now()}-bot`,\n            type: 'bot' as const,\n            text: responseText,\n            time: new Date().toLocaleTimeString('ru-RU', { \n              hour: '2-digit', \n              minute: '2-digit' \n            }),\n            buttons,\n            keyboardType,\n            ...targetMediaInfo\n          };\n\n          setMessageHistory(prev => [...prev, botResponse]);\n          \n          // Update reply keyboard based on target node\n          if (targetNode.data.keyboardType === 'reply' && buttons) {\n            setCurrentReplyKeyboard(buttons);\n          } else if (targetNode.data.keyboardType === 'none') {\n            setCurrentReplyKeyboard(null);\n          }\n          \n          // Check if target node expects input\n          const expectsTextInput = targetNode.type === 'input' && \n                                  targetNode.data.keyboardType === 'none';\n          setWaitingForInput(expectsTextInput);\n        } else {\n          // Node not found - show error\n          let errorText = '';\n          if (action === 'command') {\n            errorText = `‚ùå –ö–æ–º–∞–Ω–¥–∞ \"${target}\" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–æ—Ç–µ`;\n          } else {\n            errorText = `‚ùå –≠–∫—Ä–∞–Ω —Å ID \"${target}\" –Ω–µ –Ω–∞–π–¥–µ–Ω`;\n          }\n          \n          const errorResponse = {\n            id: `msg-${Date.now()}-bot`,\n            type: 'bot' as const,\n            text: errorText,\n            time: new Date().toLocaleTimeString('ru-RU', { \n              hour: '2-digit', \n              minute: '2-digit' \n            })\n          };\n\n          setMessageHistory(prev => [...prev, errorResponse]);\n        }\n      } else {\n        // No target specified - handle free text input\n        const defaultResponse = {\n          id: `msg-${Date.now()}-bot`,\n          type: 'bot' as const,\n          text: `–í—ã –Ω–∞–ø–∏—Å–∞–ª–∏: \"${messageText}\"`,\n          time: new Date().toLocaleTimeString('ru-RU', { \n            hour: '2-digit', \n            minute: '2-digit' \n          })\n        };\n\n        setMessageHistory(prev => [...prev, defaultResponse]);\n      }\n    }, 500);\n  };\n\n  const handleSendText = () => {\n    if (!textInput.trim()) return;\n    \n    const userInput = textInput.trim();\n    \n    // Check if input is a command\n    const commandFromText = parseCommandFromText(userInput);\n    if (commandFromText) {\n      // Find the command node\n      const commandNode = nodes.find(node => \n        (node.type === 'command' || node.type === 'start') && \n        node.data.command === commandFromText\n      );\n      \n      if (commandNode) {\n        handleUserMessage(userInput, commandNode.id, 'goto');\n      } else {\n        handleUserMessage(userInput, commandFromText, 'command');\n      }\n    } else {\n      // Check if input matches any node's synonyms\n      const synonymNode = nodes.find(node => \n        node.data.synonyms && \n        Array.isArray(node.data.synonyms) &&\n        node.data.synonyms.includes(userInput.toLowerCase())\n      );\n      \n      if (synonymNode) {\n        handleUserMessage(userInput, synonymNode.id, 'goto');\n      } else {\n        // Regular text input - check if we're waiting for user input\n        if (waitingForInput && currentNodeId) {\n          handleUserMessage(userInput);\n        } else {\n          handleUserMessage(userInput);\n        }\n      }\n    }\n    \n    setTextInput('');\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendText();\n    }\n  };\n\n  const reset = () => {\n    setMessageHistory([]);\n    setCurrentNodeId('');\n    setCurrentReplyKeyboard(null);\n    setTextInput('');\n    setWaitingForInput(false);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-md max-h-[85vh] p-0 flex flex-col\">\n        <DialogHeader className=\"p-4 border-b border-border\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 bg-primary rounded-lg flex items-center justify-center\">\n              <i className=\"fab fa-telegram-plane text-primary-foreground text-sm\"></i>\n            </div>\n            <div>\n              <DialogTitle className=\"font-semibold text-foreground\">–ü—Ä–µ–≤—å—é –±–æ—Ç–∞</DialogTitle>\n              <p className=\"text-xs text-muted-foreground\">{projectName}</p>\n            </div>\n          </div>\n        </DialogHeader>\n\n        {/* Chat Area */}\n        <div ref={chatAreaRef} className=\"flex-1 bg-muted/30 overflow-y-auto p-4 space-y-3 min-h-[300px] max-h-[400px]\">\n          {messageHistory.length === 0 ? (\n            <div className=\"flex items-center justify-center h-full\">\n              <div className=\"text-center\">\n                <div className=\"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mx-auto mb-4\">\n                  <i className=\"fas fa-robot text-primary text-xl\"></i>\n                </div>\n                <p className=\"text-sm text-muted-foreground mb-4\">–ù–∞–∂–º–∏—Ç–µ \"–ó–∞–ø—É—Å—Ç–∏—Ç—å\", —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞</p>\n                <button\n                  onClick={handleStart}\n                  className=\"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors\"\n                  disabled={!startNode}\n                >\n                  {startNode ? '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞' : '–ù–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —É–∑–ª–∞'}\n                </button>\n              </div>\n            </div>\n          ) : (\n            messageHistory.map((message) => (\n              <div key={message.id}>\n                {message.type === 'bot' ? (\n                  <div className=\"flex items-start space-x-2\">\n                    <div className=\"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0\">\n                      <i className=\"fas fa-robot text-white text-xs\"></i>\n                    </div>\n                    <div className=\"max-w-xs\">\n                      {/* Media Content */}\n                      {message.mediaType === 'photo' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg overflow-hidden shadow-sm mb-1\">\n                          <img\n                            src={message.mediaUrl}\n                            alt=\"–§–æ—Ç–æ\"\n                            className=\"w-full h-48 object-cover\"\n                            onError={(e) => {\n                              e.currentTarget.src = 'https://picsum.photos/300/200?random=' + Math.random();\n                            }}\n                          />\n                          {message.mediaCaption && (\n                            <div className=\"px-4 py-2\">\n                              <div \n                                className=\"text-sm text-gray-900\"\n                                dangerouslySetInnerHTML={{ __html: renderMarkdown(message.mediaCaption) }}\n                              />\n                            </div>\n                          )}\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'video' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg overflow-hidden shadow-sm mb-1\">\n                          <video\n                            src={message.mediaUrl}\n                            controls\n                            className=\"w-full h-48 object-cover\"\n                            poster=\"https://picsum.photos/300/200?random=video\"\n                          />\n                          {message.mediaCaption && (\n                            <div className=\"px-4 py-2\">\n                              <div \n                                className=\"text-sm text-gray-900\"\n                                dangerouslySetInnerHTML={{ __html: renderMarkdown(message.mediaCaption) }}\n                              />\n                            </div>\n                          )}\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'audio' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg px-4 py-3 shadow-sm mb-1\">\n                          <div className=\"flex items-center space-x-3 mb-2\">\n                            <div className=\"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center\">\n                              <i className=\"fas fa-music text-orange-600 text-xs\"></i>\n                            </div>\n                            <div className=\"flex-1\">\n                              <p className=\"text-sm font-medium text-gray-900\">\n                                {message.mediaData?.performer || '–ê—É–¥–∏–æ—Ñ–∞–π–ª'}\n                              </p>\n                              {message.mediaData?.duration && (\n                                <p className=\"text-xs text-gray-500\">{message.mediaData.duration}—Å</p>\n                              )}\n                            </div>\n                          </div>\n                          <audio src={message.mediaUrl} controls className=\"w-full h-8\" />\n                          {message.mediaCaption && (\n                            <div \n                              className=\"text-sm text-gray-900 mt-2\"\n                              dangerouslySetInnerHTML={{ __html: renderMarkdown(message.mediaCaption) }}\n                            />\n                          )}\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'document' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg px-4 py-3 shadow-sm mb-1\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-8 h-8 bg-teal-100 rounded-full flex items-center justify-center\">\n                              <i className=\"fas fa-file-alt text-teal-600 text-xs\"></i>\n                            </div>\n                            <div className=\"flex-1\">\n                              <p className=\"text-sm font-medium text-gray-900\">\n                                {message.mediaData?.filename || '–î–æ–∫—É–º–µ–Ω—Ç'}\n                              </p>\n                              <a \n                                href={message.mediaUrl} \n                                target=\"_blank\" \n                                rel=\"noopener noreferrer\"\n                                className=\"text-xs text-blue-600 hover:underline\"\n                              >\n                                –û—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç\n                              </a>\n                            </div>\n                          </div>\n                          {message.mediaCaption && (\n                            <div \n                              className=\"text-sm text-gray-900 mt-2\"\n                              dangerouslySetInnerHTML={{ __html: renderMarkdown(message.mediaCaption) }}\n                            />\n                          )}\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'sticker' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg overflow-hidden shadow-sm mb-1\">\n                          <img\n                            src={message.mediaUrl}\n                            alt=\"–°—Ç–∏–∫–µ—Ä\"\n                            className=\"w-32 h-32 object-contain mx-auto\"\n                          />\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'voice' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg px-4 py-3 shadow-sm mb-1\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\n                              <i className=\"fas fa-microphone text-green-600 text-xs\"></i>\n                            </div>\n                            <div className=\"flex-1\">\n                              <p className=\"text-sm font-medium text-gray-900\">–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</p>\n                              {message.mediaData?.duration && (\n                                <p className=\"text-xs text-gray-500\">{message.mediaData.duration}—Å</p>\n                              )}\n                            </div>\n                          </div>\n                          <audio src={message.mediaUrl} controls className=\"w-full h-8 mt-2\" />\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'animation' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg overflow-hidden shadow-sm mb-1\">\n                          <img\n                            src={message.mediaUrl}\n                            alt=\"–ê–Ω–∏–º–∞—Ü–∏—è\"\n                            className=\"w-full h-48 object-cover\"\n                          />\n                          {message.mediaCaption && (\n                            <div className=\"px-4 py-2\">\n                              <div \n                                className=\"text-sm text-gray-900\"\n                                dangerouslySetInnerHTML={{ __html: renderMarkdown(message.mediaCaption) }}\n                              />\n                            </div>\n                          )}\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'location' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg px-4 py-3 shadow-sm mb-1\">\n                          <div className=\"flex items-center space-x-3 mb-2\">\n                            <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\n                              <i className=\"fas fa-map-marker-alt text-green-600 text-xs\"></i>\n                            </div>\n                            <div className=\"flex-1\">\n                              <p className=\"text-sm font-medium text-gray-900\">\n                                {message.mediaData?.title || '–õ–æ–∫–∞—Ü–∏—è'}\n                              </p>\n                              {message.mediaData?.address && (\n                                <p className=\"text-xs text-gray-500\">{message.mediaData.address}</p>\n                              )}\n                            </div>\n                          </div>\n                          <div className=\"bg-gray-100 rounded-lg p-3\">\n                            <p className=\"text-xs text-gray-600\">\n                              üìç {message.mediaData?.latitude?.toFixed(4)}, {message.mediaData?.longitude?.toFixed(4)}\n                            </p>\n                            <a \n                              href={`https://maps.google.com/?q=${message.mediaData?.latitude},${message.mediaData?.longitude}`}\n                              target=\"_blank\"\n                              rel=\"noopener noreferrer\"\n                              className=\"text-xs text-blue-600 hover:underline\"\n                            >\n                              –û—Ç–∫—Ä—ã—Ç—å –≤ –∫–∞—Ä—Ç–∞—Ö\n                            </a>\n                          </div>\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'contact' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg px-4 py-3 shadow-sm mb-1\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\n                              <i className=\"fas fa-user text-blue-600 text-xs\"></i>\n                            </div>\n                            <div className=\"flex-1\">\n                              <p className=\"text-sm font-medium text-gray-900\">\n                                {message.mediaData?.firstName} {message.mediaData?.lastName}\n                              </p>\n                              {message.mediaData?.phoneNumber && (\n                                <p className=\"text-xs text-gray-500\">{message.mediaData.phoneNumber}</p>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'poll' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg px-4 py-3 shadow-sm mb-1\">\n                          <div className=\"flex items-center space-x-2 mb-3\">\n                            <div className=\"w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center\">\n                              <i className=\"fas fa-poll text-purple-600 text-xs\"></i>\n                            </div>\n                            <p className=\"text-sm font-medium text-gray-900\">–û–ø—Ä–æ—Å</p>\n                          </div>\n                          <p className=\"text-sm text-gray-900 mb-3\">{message.mediaData?.question}</p>\n                          <div className=\"space-y-2\">\n                            {message.mediaData?.options?.map((option: string, index: number) => (\n                              <div key={index} className=\"flex items-center space-x-2\">\n                                <div className=\"w-4 h-4 border border-gray-300 rounded\"></div>\n                                <p className=\"text-sm text-gray-700\">{option}</p>\n                              </div>\n                            ))}\n                          </div>\n                          <div className=\"mt-2 flex items-center space-x-4 text-xs text-gray-500\">\n                            {message.mediaData?.allowsMultipleAnswers && (\n                              <span>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä</span>\n                            )}\n                            {message.mediaData?.anonymousVoting && (\n                              <span>–ê–Ω–æ–Ω–∏–º–Ω–æ</span>\n                            )}\n                          </div>\n                        </div>\n                      )}\n                      \n                      {message.mediaType === 'dice' && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg px-4 py-3 shadow-sm mb-1\">\n                          <div className=\"text-center\">\n                            <div className=\"text-4xl mb-2\">{message.mediaData?.emoji || 'üé≤'}</div>\n                            <p className=\"text-sm text-gray-600\">–ë—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–∞</p>\n                          </div>\n                        </div>\n                      )}\n                      \n                      {/* Text message (if any) */}\n                      {message.text && !['poll', 'dice'].includes(message.mediaType || '') && (\n                        <div className=\"bg-white rounded-2xl rounded-tl-lg px-4 py-3 shadow-sm\">\n                          <div \n                            className=\"text-sm text-gray-900\"\n                            dangerouslySetInnerHTML={{ __html: renderMarkdown(message.text) }}\n                          />\n                          <p className=\"text-xs text-gray-500 mt-1\">{message.time}</p>\n                        </div>\n                      )}\n                      \n                      {/* Show time for media messages */}\n                      {message.mediaType && ['poll', 'dice'].includes(message.mediaType) && (\n                        <p className=\"text-xs text-gray-500 mt-1 px-2\">{message.time}</p>\n                      )}\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"flex items-start space-x-2 justify-end\">\n                    <div className=\"bg-blue-500 text-white rounded-2xl rounded-tr-lg px-4 py-3 max-w-xs\">\n                      <p className=\"text-sm\">{message.text}</p>\n                      <p className=\"text-xs text-blue-200 mt-1\">{message.time}</p>\n                    </div>\n                    <div className=\"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <i className=\"fas fa-user text-gray-600 text-xs\"></i>\n                    </div>\n                  </div>\n                )}\n\n                {/* Inline Buttons */}\n                {message.type === 'bot' && message.buttons && message.keyboardType === 'inline' && (\n                  <div className=\"ml-10 mt-2\">\n                    {message.buttons.length <= 2 ? (\n                      <div className=\"space-y-1\">\n                        {message.buttons.map((button, index) => (\n                          <button\n                            key={index}\n                            onClick={() => handleButtonClick(button.text, button.target, button.action)}\n                            className=\"w-full bg-blue-500 text-white text-sm font-medium py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors\"\n                          >\n                            {button.text}\n                          </button>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"grid grid-cols-2 gap-1\">\n                        {message.buttons.map((button, index) => (\n                          <button\n                            key={index}\n                            onClick={() => handleButtonClick(button.text, button.target, button.action)}\n                            className=\"bg-blue-500 text-white text-xs font-medium py-2 px-3 rounded-lg hover:bg-blue-600 transition-colors\"\n                          >\n                            {button.text}\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            ))\n          )}\n        </div>\n\n        {/* Reply Keyboard */}\n        {currentReplyKeyboard && (\n          <div className=\"p-4 bg-gray-50 border-t border-gray-200\">\n            <div className=\"space-y-2\">\n              <p className=\"text-xs text-gray-600 mb-2\">Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞:</p>\n              <div className=\"grid grid-cols-2 gap-2\">\n                {currentReplyKeyboard.map((button, index) => (\n                  <button\n                    key={index}\n                    onClick={() => handleButtonClick(button.text, button.target, button.action)}\n                    className=\"bg-white border border-gray-300 text-gray-700 text-sm font-medium py-2 px-3 rounded-lg hover:bg-gray-100 transition-colors flex items-center justify-center\"\n                  >\n                    {button.text}\n                  </button>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Text Input Area */}\n        <div className=\"p-4 border-t border-gray-200 bg-white\">\n          <div className=\"flex items-center space-x-2 mb-3\">\n            <Input\n              ref={inputRef}\n              value={textInput}\n              onChange={(e) => setTextInput(e.target.value)}\n              onKeyPress={handleKeyPress}\n              placeholder={waitingForInput ? \"–ë–æ—Ç –æ–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥...\" : \"–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...\"}\n              className=\"flex-1\"\n              disabled={!messageHistory.length}\n            />\n            <Button\n              onClick={handleSendText}\n              disabled={!textInput.trim() || !messageHistory.length}\n              size=\"sm\"\n            >\n              <i className=\"fas fa-paper-plane\"></i>\n            </Button>\n          </div>\n          \n          {/* Controls */}\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={reset}\n              className=\"px-3 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors\"\n            >\n              –°–±—Ä–æ—Å–∏—Ç—å\n            </button>\n            <div className=\"flex-1\"></div>\n            <span className=\"text-xs text-gray-500\">\n              {messageHistory.length} —Å–æ–æ–±—â–µ–Ω–∏–π\n            </span>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":35594},"client/src/components/editor/properties-panel.tsx":{"content":"import { Node, Button } from '@shared/schema';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { Button as UIButton } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\nimport { MediaSelector } from '@/components/media/media-selector';\nimport { nanoid } from 'nanoid';\nimport { useToast } from '@/hooks/use-toast';\nimport { validateCommand, getCommandSuggestions, STANDARD_COMMANDS } from '@/lib/commands';\nimport { extractCoordinatesFromUrl, formatCoordinates, getLocationInfo } from '@/lib/map-utils';\nimport { useState, useMemo } from 'react';\n\nimport { InlineRichEditor } from './inline-rich-editor';\nimport { EmojiPicker } from './emoji-picker';\n\n// –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–Ω–æ–Ω–∏–º–æ–≤\ninterface SynonymEditorProps {\n  synonyms: string[];\n  onUpdate: (synonyms: string[]) => void;\n  placeholder?: string;\n  title?: string;\n  description?: string;\n}\n\nconst SynonymEditor = ({ synonyms, onUpdate, placeholder = \"–ù–∞–ø—Ä–∏–º–µ—Ä: —Å—Ç–∞—Ä—Ç, –ø—Ä–∏–≤–µ—Ç, –Ω–∞—á–∞—Ç—å\", title = \"–°–∏–Ω–æ–Ω–∏–º—ã\", description }: SynonymEditorProps) => {\n  return (\n    <div>\n      <Label className=\"text-xs font-medium text-muted-foreground\">{title}</Label>\n      {description && (\n        <div className=\"text-xs text-muted-foreground mt-1 mb-2\">\n          {description}\n        </div>\n      )}\n      <div className=\"mt-2 space-y-2\">\n        {synonyms.map((synonym, index) => (\n          <div key={index} className=\"flex items-center gap-2\">\n            <Input\n              value={synonym}\n              onChange={(e) => {\n                const newSynonyms = [...synonyms];\n                newSynonyms[index] = e.target.value;\n                onUpdate(newSynonyms);\n              }}\n              placeholder={placeholder}\n              className=\"flex-1 text-xs\"\n            />\n            <UIButton\n              onClick={() => {\n                const newSynonyms = [...synonyms];\n                newSynonyms.splice(index, 1);\n                onUpdate(newSynonyms);\n              }}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"px-2 py-1 h-8\"\n            >\n              <i className=\"fas fa-trash text-xs\"></i>\n            </UIButton>\n          </div>\n        ))}\n        <UIButton\n          onClick={() => {\n            const newSynonyms = [...synonyms, ''];\n            onUpdate(newSynonyms);\n          }}\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"w-full text-xs\"\n        >\n          <i className=\"fas fa-plus mr-2\"></i>\n          –î–æ–±–∞–≤–∏—Ç—å —Å–∏–Ω–æ–Ω–∏–º\n        </UIButton>\n      </div>\n    </div>\n  );\n};\n\ninterface PropertiesPanelProps {\n  projectId: number;\n  selectedNode: Node | null;\n  allNodes?: Node[];\n  onNodeUpdate: (nodeId: string, updates: Partial<Node['data']>) => void;\n  onNodeTypeChange?: (nodeId: string, newType: Node['type'], newData: Partial<Node['data']>) => void;\n  onButtonAdd: (nodeId: string, button: Button) => void;\n  onButtonUpdate: (nodeId: string, buttonId: string, updates: Partial<Button>) => void;\n  onButtonDelete: (nodeId: string, buttonId: string) => void;\n  // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n  allSheets?: any[];\n  currentSheetId?: string;\n}\n\nexport function PropertiesPanel({ \n  projectId,\n  selectedNode,\n  allNodes = [],\n  onNodeUpdate, \n  onNodeTypeChange,\n  onButtonAdd, \n  onButtonUpdate, \n  onButtonDelete,\n  allSheets = [],\n  currentSheetId\n}: PropertiesPanelProps) {\n  const { toast } = useToast();\n  const [commandInput, setCommandInput] = useState('');\n  const [showCommandSuggestions, setShowCommandSuggestions] = useState(false);\n  const [urlValidation, setUrlValidation] = useState<{[key: string]: { isValid: boolean; message?: string }}>({});\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É–∑–ª–∞\n  const getDefaultDataForType = (type: Node['type']) => {\n    const defaults: Record<Node['type'], any> = {\n      message: {},\n      photo: { imageUrl: '', mediaCaption: '' },\n      video: { videoUrl: '', mediaCaption: '', duration: 0 },\n      audio: { audioUrl: '', mediaCaption: '', duration: 0 },\n      document: { documentUrl: '', documentName: 'document.pdf', mediaCaption: '' },\n      sticker: { stickerUrl: '', stickerFileId: '' },\n      voice: { voiceUrl: '', duration: 0 },\n      animation: { animationUrl: '', duration: 0, width: 0, height: 0, mediaCaption: '' },\n      location: { latitude: 55.7558, longitude: 37.6176, title: '–ú–æ—Å–∫–≤–∞', address: '–ú–æ—Å–∫–≤–∞, –†–æ—Å—Å–∏—è', foursquareId: '', foursquareType: '' },\n      contact: { phoneNumber: '+7 (999) 123-45-67', firstName: '–ò–º—è', lastName: '–§–∞–º–∏–ª–∏—è', userId: 0, vcard: '' },\n      keyboard: { keyboardType: 'reply' },\n      start: { command: '/start', description: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞', showInMenu: true, isPrivateOnly: false, requiresAuth: false, adminOnly: false },\n      command: { command: '/custom', description: '–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞', showInMenu: true, isPrivateOnly: false, requiresAuth: false, adminOnly: false },\n      pin_message: { \n        command: '/pin_message',\n        synonyms: ['–∑–∞–∫—Ä–µ–ø–∏—Ç—å', '–ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å', '–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å'],\n        disableNotification: false\n      },\n      unpin_message: { \n        command: '/unpin_message',\n        synonyms: ['–æ—Ç–∫—Ä–µ–ø–∏—Ç—å', '–æ—Ç—Ü–µ–ø–∏—Ç—å', '—É–±—Ä–∞—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ']\n      },\n      delete_message: { \n        command: '/delete_message',\n        synonyms: ['—É–¥–∞–ª–∏—Ç—å', '—Å—Ç–µ—Ä–µ—Ç—å', '—É–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ']\n      },\n      ban_user: {\n        command: '/ban_user',\n        synonyms: ['–∑–∞–±–∞–Ω–∏—Ç—å', '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å', '–±–∞–Ω'],\n        reason: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã',\n        untilDate: 0\n      },\n      unban_user: {\n        command: '/unban_user',\n        synonyms: ['—Ä–∞–∑–±–∞–Ω–∏—Ç—å', '—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å', 'unb–∞–Ω']\n      },\n      mute_user: {\n        command: '/mute_user',\n        synonyms: ['–∑–∞–º—É—Ç–∏—Ç—å', '–∑–∞–≥–ª—É—à–∏—Ç—å', '–º—É—Ç'],\n        reason: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã',\n        duration: 3600,\n        canSendMessages: false,\n        canSendMediaMessages: false,\n        canSendPolls: false,\n        canSendOtherMessages: false,\n        canAddWebPagePreviews: false,\n        canChangeGroupInfo: false,\n        canInviteUsers2: false,\n        canPinMessages2: false\n      },\n      unmute_user: {\n        command: '/unmute_user',\n        synonyms: ['—Ä–∞–∑–º—É—Ç–∏—Ç—å', '—Ä–∞–∑–≥–ª—É—à–∏—Ç—å', '–∞–Ω–º—É—Ç']\n      },\n      kick_user: {\n        command: '/kick_user',\n        synonyms: ['–∫–∏–∫–Ω—É—Ç—å', '–∏—Å–∫–ª—é—á–∏—Ç—å', '–≤—ã–≥–Ω–∞—Ç—å'],\n        reason: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã'\n      },\n      promote_user: {\n        command: '/promote_user',\n        synonyms: ['–ø–æ–≤—ã—Å–∏—Ç—å', '–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º', '–ø—Ä–æ–º–æ—É—Ç'],\n        canChangeInfo: false,\n        canDeleteMessages: true,\n        canBanUsers: false,\n        canInviteUsers: true,\n        canPinMessages: true,\n        canAddAdmins: false,\n        canRestrictMembers: false,\n        canPromoteMembers: false,\n        canManageVideoChats: false,\n        canManageTopics: false,\n        isAnonymous: false\n      },\n      demote_user: {\n        command: '/demote_user',\n        synonyms: ['–ø–æ–Ω–∏–∑–∏—Ç—å', '—Å–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∫–∏', '–¥–µ–º–æ—É—Ç']\n      },\n      admin_rights: {\n        command: '/admin_rights',\n        description: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n        synonyms: ['–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞', '–∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞', '–∞–¥–º–∏–Ω –ø—Ä–∞–≤–∞', '—Ç–≥ –ø—Ä–∞–≤–∞', '–ø—Ä–∞–≤–∞'],\n        adminUserIdSource: 'last_message',\n        adminChatIdSource: 'current_chat',\n        keyboardType: 'inline',\n        buttons: [\n          {\n            id: 'perm_change_info',\n            text: 'üè∑Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è',\n            action: 'command',\n            target: 'toggle_change_info',\n            buttonType: 'option',\n            skipDataCollection: false\n          },\n          {\n            id: 'perm_delete_messages',\n            text: 'üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π',\n            action: 'command',\n            target: 'toggle_delete_messages',\n            buttonType: 'option',\n            skipDataCollection: false\n          },\n          {\n            id: 'perm_restrict_members',\n            text: 'üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤',\n            action: 'command',\n            target: 'toggle_restrict_members',\n            buttonType: 'option',\n            skipDataCollection: false\n          },\n          {\n            id: 'perm_invite_users',\n            text: 'üì® –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤',\n            action: 'command',\n            target: 'toggle_invite_users',\n            buttonType: 'option',\n            skipDataCollection: false\n          },\n          {\n            id: 'perm_pin_messages',\n            text: 'üìå –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π',\n            action: 'command',\n            target: 'toggle_pin_messages',\n            buttonType: 'option',\n            skipDataCollection: false\n          },\n          {\n            id: 'perm_manage_video_chats',\n            text: 'üé• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ—á–∞—Ç–∞–º–∏',\n            action: 'command',\n            target: 'toggle_manage_video_chats',\n            buttonType: 'option',\n            skipDataCollection: false\n          },\n          {\n            id: 'perm_anonymous',\n            text: 'üîí –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å',\n            action: 'command',\n            target: 'toggle_anonymous',\n            buttonType: 'option',\n            skipDataCollection: false\n          },\n          {\n            id: 'perm_promote_members',\n            text: 'üëë –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤',\n            action: 'command',\n            target: 'toggle_promote_members',\n            buttonType: 'option',\n            skipDataCollection: false\n          }\n        ],\n        // –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ Telegram Bot API\n        can_manage_chat: false,\n        can_post_messages: false,\n        can_edit_messages: false,\n        can_delete_messages: true,\n        can_post_stories: false,\n        can_edit_stories: false,\n        can_delete_stories: false,\n        can_manage_video_chats: false,\n        can_restrict_members: false,\n        can_promote_members: false,\n        can_change_info: false,\n        can_invite_users: true,\n        can_pin_messages: true,\n        can_manage_topics: false,\n        is_anonymous: false\n      }\n    };\n    \n    return defaults[type] || {};\n  };\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —É–∑–ª–æ–≤ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ –¥–ª—è –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n  const getAllNodesFromAllSheets = useMemo(() => {\n    const allNodesFromSheets: { node: Node; sheetId: string; sheetName: string }[] = [];\n    \n    if (allSheets && allSheets.length > 0) {\n      allSheets.forEach((sheet: any) => {\n        if (sheet.nodes) {\n          sheet.nodes.forEach((node: Node) => {\n            allNodesFromSheets.push({\n              node,\n              sheetId: sheet.id,\n              sheetName: sheet.name\n            });\n          });\n        }\n      });\n    } else {\n      // –ï—Å–ª–∏ –ª–∏—Å—Ç—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–∑–ª—ã —Ç–µ–∫—É—â–µ–≥–æ –ª–∏—Å—Ç–∞\n      allNodes.forEach((node: Node) => {\n        allNodesFromSheets.push({\n          node,\n          sheetId: currentSheetId || 'current',\n          sheetName: '–¢–µ–∫—É—â–∏–π –ª–∏—Å—Ç'\n        });\n      });\n    }\n    \n    return allNodesFromSheets;\n  }, [allSheets, allNodes, currentSheetId]);\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\n  \n  // URL validation function\n  const validateUrl = (url: string, type: string): { isValid: boolean; message?: string } => {\n    if (!url) return { isValid: true };\n    \n    try {\n      new URL(url);\n      \n      const validImageTypes = ['.jpg', '.jpeg', '.png', '.gif', '.webp'];\n      const validVideoTypes = ['.mp4', '.avi', '.mov', '.mkv', '.webm'];\n      const validAudioTypes = ['.mp3', '.wav', '.ogg', '.m4a', '.aac'];\n      \n      if (type === 'image' && !validImageTypes.some(ext => url.toLowerCase().includes(ext))) {\n        return { isValid: false, message: 'URL –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG, GIF, WebP)' };\n      }\n      if (type === 'video' && !validVideoTypes.some(ext => url.toLowerCase().includes(ext))) {\n        return { isValid: false, message: 'URL –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–∏–¥–µ–æ (MP4, AVI, MOV, MKV, WebM)' };\n      }\n      if (type === 'audio' && !validAudioTypes.some(ext => url.toLowerCase().includes(ext))) {\n        return { isValid: false, message: 'URL –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∞—É–¥–∏–æ (MP3, WAV, OGG, M4A, AAC)' };\n      }\n      \n      return { isValid: true };\n    } catch {\n      return { isValid: false, message: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL' };\n    }\n  };\n\n  // Extract all available questions from keyboard and user-input nodes\n  const availableQuestions = useMemo(() => {\n    const questions: Array<{name: string, nodeId: string, nodeType: string}> = [];\n    \n    allNodes.forEach(node => {\n      \n      // From any nodes with additional input collection that have inputVariable\n      if (node.data.collectUserInput && node.data.inputVariable) {\n        questions.push({\n          name: node.data.inputVariable,\n          nodeId: node.id,\n          nodeType: node.type\n        });\n      }\n    });\n    \n    // Remove duplicates by question name\n    const uniqueQuestions = questions.filter((question, index, self) => \n      index === self.findIndex(q => q.name === question.name)\n    );\n    \n    return uniqueQuestions;\n  }, [allNodes]);\n\n  // Extract all available variables for text insertion\n  const availableVariables = useMemo(() => {\n    const variables: Array<{name: string, nodeId: string, nodeType: string, description?: string}> = [];\n    \n    allNodes.forEach(node => {\n      \n      // From any nodes with additional input collection that have inputVariable\n      if (node.data.collectUserInput && node.data.inputVariable) {\n        variables.push({\n          name: node.data.inputVariable,\n          nodeId: node.id,\n          nodeType: node.type,\n          description: `–î–∞–Ω–Ω—ã–µ –∏–∑ —É–∑–ª–∞ —Ç–∏–ø–∞ ${node.type}`\n        });\n      }\n\n      // From conditional messages with textInputVariable\n      if (node.data.conditionalMessages) {\n        node.data.conditionalMessages.forEach((condition: any) => {\n          if (condition.textInputVariable) {\n            variables.push({\n              name: condition.textInputVariable,\n              nodeId: node.id,\n              nodeType: 'conditional',\n              description: `–£—Å–ª–æ–≤–Ω—ã–π –≤–≤–æ–¥: ${condition.messageText?.substring(0, 50) || '–£—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'}...`\n            });\n          }\n        });\n      }\n    });\n\n    // Add common bot variables\n    const commonVariables = [\n      { name: 'user_name', nodeId: 'system', nodeType: 'system', description: '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' },\n      { name: 'user_id', nodeId: 'system', nodeType: 'system', description: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram' },\n      { name: 'chat_id', nodeId: 'system', nodeType: 'system', description: 'ID —á–∞—Ç–∞' },\n      { name: 'bot_name', nodeId: 'system', nodeType: 'system', description: '–ò–º—è –±–æ—Ç–∞' }\n    ];\n\n    variables.push(...commonVariables);\n    \n    // Remove duplicates by variable name\n    const uniqueVariables = variables.filter((variable, index, self) => \n      index === self.findIndex(v => v.name === variable.name)\n    );\n    \n    return uniqueVariables;\n  }, [allNodes]);\n\n  // Function to detect conflicts between conditional message rules\n  const detectRuleConflicts = useMemo(() => {\n    if (!selectedNode?.data.conditionalMessages) return [];\n    \n    const rules = selectedNode.data.conditionalMessages || [];\n    const conflicts: Array<{\n      ruleIndex: number;\n      conflictType: string;\n      description: string;\n      severity: 'warning' | 'error';\n      suggestion: string;\n    }> = [];\n    \n    for (let i = 0; i < rules.length; i++) {\n      const rule = rules[i];\n      const ruleVariables = rule.variableNames || (rule.variableName ? [rule.variableName] : []);\n      \n      // Check for duplicate rules\n      for (let j = i + 1; j < rules.length; j++) {\n        const otherRule = rules[j];\n        const otherVariables = otherRule.variableNames || (otherRule.variableName ? [otherRule.variableName] : []);\n        \n        // Same condition type with same variables\n        if (rule.condition === otherRule.condition && \n            JSON.stringify(ruleVariables.sort()) === JSON.stringify(otherVariables.sort()) &&\n            rule.expectedValue === otherRule.expectedValue &&\n            rule.logicOperator === otherRule.logicOperator) {\n          conflicts.push({\n            ruleIndex: i,\n            conflictType: 'duplicate',\n            description: `–ü—Ä–∞–≤–∏–ª–æ ${i + 1} –¥—É–±–ª–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª–æ ${j + 1}`,\n            severity: 'error',\n            suggestion: '–£–¥–∞–ª–∏—Ç–µ –æ–¥–Ω–æ –∏–∑ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –ø—Ä–∞–≤–∏–ª –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —É—Å–ª–æ–≤–∏—è'\n          });\n        }\n        \n        // Contradictory rules\n        if ((rule.condition === 'user_data_exists' && otherRule.condition === 'user_data_not_exists') ||\n            (rule.condition === 'user_data_not_exists' && otherRule.condition === 'user_data_exists')) {\n          const hasCommonVariables = ruleVariables.some(v => otherVariables.includes(v));\n          if (hasCommonVariables) {\n            conflicts.push({\n              ruleIndex: i,\n              conflictType: 'contradiction',\n              description: `–ü—Ä–∞–≤–∏–ª–æ ${i + 1} –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –ø—Ä–∞–≤–∏–ª—É ${j + 1}`,\n              severity: 'warning',\n              suggestion: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–∫—É: –æ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –¥—Ä—É–≥–æ–µ - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ'\n            });\n          }\n        }\n      }\n      \n      // Check for unreachable rules due to priority\n      const higherPriorityRules = rules.filter((r, idx) => \n        idx < i && (r.priority || 0) >= (rule.priority || 0)\n      );\n      \n      for (const higherRule of higherPriorityRules) {\n        const higherVariables = higherRule.variableNames || (higherRule.variableName ? [higherRule.variableName] : []);\n        if (higherRule.condition === 'first_time' || higherRule.condition === 'returning_user') {\n          // These conditions might make subsequent rules unreachable\n          conflicts.push({\n            ruleIndex: i,\n            conflictType: 'unreachable',\n            description: `–ü—Ä–∞–≤–∏–ª–æ ${i + 1} –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º–æ –∏–∑-–∑–∞ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã—à–µ`,\n            severity: 'warning',\n            suggestion: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∞–≤–∏–ª –∏ –∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã'\n          });\n        }\n      }\n      \n      // Check for empty variable names\n      if ((rule.condition.includes('user_data') || rule.condition.includes('equals') || rule.condition.includes('contains')) && \n          ruleVariables.length === 0) {\n        conflicts.push({\n          ruleIndex: i,\n          conflictType: 'missing_variables',\n          description: `–ü—Ä–∞–≤–∏–ª–æ ${i + 1} –Ω–µ –∏–º–µ–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏`,\n          severity: 'error',\n          suggestion: '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏—è'\n        });\n      }\n      \n      // Check for missing expected values\n      if ((rule.condition === 'user_data_equals' || rule.condition === 'user_data_contains') && \n          !rule.expectedValue) {\n        conflicts.push({\n          ruleIndex: i,\n          conflictType: 'missing_value',\n          description: `–ü—Ä–∞–≤–∏–ª–æ ${i + 1} —Ç—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏—è –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è`,\n          severity: 'error',\n          suggestion: '–£–∫–∞–∂–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è'\n        });\n      }\n    }\n    \n    return conflicts;\n  }, [selectedNode?.data.conditionalMessages]);\n\n  // Function to auto-fix rule priorities\n  const autoFixPriorities = () => {\n    if (!selectedNode?.data.conditionalMessages) return;\n    \n    const rules = [...selectedNode.data.conditionalMessages];\n    \n    // Assign priorities based on logical order\n    rules.forEach((rule, index) => {\n      // Higher priority for more specific conditions\n      let priority = 0;\n      \n      if (rule.condition === 'first_time' || rule.condition === 'returning_user') {\n        priority = 100; // Highest priority for user type checks\n      } else if (rule.condition === 'user_data_equals') {\n        priority = 80; // High priority for exact matches\n      } else if (rule.condition === 'user_data_contains') {\n        priority = 60; // Medium priority for contains checks\n      } else if (rule.condition === 'user_data_exists') {\n        priority = 40; // Lower priority for existence checks\n      } else if (rule.condition === 'user_data_not_exists') {\n        priority = 20; // Lowest priority for non-existence checks\n      }\n      \n      // Add bonus for multiple variables (more specific)\n      const variableCount = rule.variableNames?.length || (rule.variableName ? 1 : 0);\n      priority += variableCount * 5;\n      \n      rule.priority = priority;\n    });\n    \n    // Sort by priority (highest first)\n    rules.sort((a, b) => (b.priority || 0) - (a.priority || 0));\n    \n    onNodeUpdate(selectedNode.id, { conditionalMessages: rules });\n  };\n\n  // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã\n  const commandValidation = useMemo(() => {\n    if (selectedNode && (\n      selectedNode.type === 'start' || \n      selectedNode.type === 'command' ||\n      selectedNode.type === 'pin_message' || \n      selectedNode.type === 'unpin_message' || \n      selectedNode.type === 'delete_message' ||\n      selectedNode.type === 'ban_user' || \n      selectedNode.type === 'unban_user' || \n      selectedNode.type === 'mute_user' || \n      selectedNode.type === 'unmute_user' || \n      selectedNode.type === 'kick_user' || \n      selectedNode.type === 'promote_user' || \n      selectedNode.type === 'demote_user'\n    )) {\n      const commandValue = selectedNode.data.command || getDefaultDataForType(selectedNode.type).command || '';\n      return validateCommand(commandValue);\n    }\n    return { isValid: true, errors: [] };\n  }, [selectedNode?.data.command, selectedNode?.type]);\n\n  // –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥\n  const commandSuggestions = useMemo(() => {\n    if (commandInput.length > 0) {\n      return getCommandSuggestions(commandInput);\n    }\n    return STANDARD_COMMANDS.slice(0, 5);\n  }, [commandInput]);\n  if (!selectedNode) {\n    return (\n      <aside className=\"w-full h-full bg-background border-l border-border flex flex-col\">\n        {/* Empty State Header */}\n        <div className=\"p-4 border-b border-border\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 bg-muted/50 rounded-lg flex items-center justify-center\">\n              <i className=\"fas fa-sliders-h text-muted-foreground text-sm\"></i>\n            </div>\n            <div>\n              <h2 className=\"text-sm font-semibold text-foreground\">–°–≤–æ–π—Å—Ç–≤–∞</h2>\n              <p className=\"text-xs text-muted-foreground\">–í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Empty State Content */}\n        <div className=\"flex-1 flex items-center justify-center p-8 empty-state-container\">\n          <div className=\"text-center max-w-xs\">\n            {/* Animated Icon */}\n            <div className=\"relative mx-auto mb-6 empty-state-icon\">\n              <div className=\"w-16 h-16 empty-state-icon-bg rounded-2xl flex items-center justify-center mx-auto\">\n                <i className=\"fas fa-mouse-pointer text-muted-foreground text-xl transition-all duration-300 hover:text-primary hover:scale-110\"></i>\n              </div>\n              {/* Enhanced pulse effect */}\n              <div className=\"absolute inset-0 w-16 h-16 bg-primary/10 rounded-2xl pulse-primary\"></div>\n            </div>\n\n            {/* Content */}\n            <div className=\"space-y-3 mb-6\">\n              <h3 className=\"text-sm font-medium text-foreground gradient-text\">–í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç</h3>\n              <p className=\"text-xs text-muted-foreground leading-relaxed\">\n                –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–¥–µ—Å—å\n              </p>\n            </div>\n\n            {/* Enhanced Help Tips */}\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center text-xs text-muted-foreground empty-state-tip floating-tip\">\n                <div className=\"w-5 h-5 bg-gradient-to-br from-primary/20 to-primary/30 rounded-md flex items-center justify-center mr-3 flex-shrink-0 shadow-sm\">\n                  <i className=\"fas fa-lightbulb text-primary text-xs\"></i>\n                </div>\n                <span>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏</span>\n              </div>\n              <div className=\"flex items-center text-xs text-muted-foreground empty-state-tip floating-tip\">\n                <div className=\"w-5 h-5 bg-gradient-to-br from-primary/20 to-primary/30 rounded-md flex items-center justify-center mr-3 flex-shrink-0 shadow-sm\">\n                  <i className=\"fas fa-hand-pointer text-primary text-xs\"></i>\n                </div>\n                <span>–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>\n              </div>\n              <div className=\"flex items-center text-xs text-muted-foreground empty-state-tip floating-tip\">\n                <div className=\"w-5 h-5 bg-gradient-to-br from-primary/20 to-primary/30 rounded-md flex items-center justify-center mr-3 flex-shrink-0 shadow-sm\">\n                  <i className=\"fas fa-magic text-primary text-xs\"></i>\n                </div>\n                <span>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </aside>\n    );\n  }\n\n  const nodeTypeNames = {\n    start: '/start –∫–æ–º–∞–Ω–¥–∞',\n    command: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞',\n    message: '–¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    photo: '–§–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º',\n    video: '–í–∏–¥–µ–æ —Å —Ç–µ–∫—Å—Ç–æ–º',\n    audio: '–ê—É–¥–∏–æ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    document: '–î–æ–∫—É–º–µ–Ω—Ç',\n    sticker: '–°—Ç–∏–∫–µ—Ä',\n    voice: '–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    animation: 'GIF –∞–Ω–∏–º–∞—Ü–∏—è',\n    location: '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n    contact: '–ö–æ–Ω—Ç–∞–∫—Ç',\n    keyboard: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞',\n    pin_message: '–ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    unpin_message: '–û—Ç–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    delete_message: '–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ',\n    ban_user: '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    unban_user: '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    mute_user: '–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    unmute_user: '–°–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è',\n    kick_user: '–ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    promote_user: '–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º',\n    demote_user: '–°–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n    admin_rights: '–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞'\n  };\n\n  const nodeIcons = {\n    start: 'fas fa-play',\n    command: 'fas fa-terminal',\n    message: 'fas fa-comment',\n    photo: 'fas fa-image',\n    video: 'fas fa-video',\n    audio: 'fas fa-music',\n    document: 'fas fa-file-alt',\n    sticker: 'fas fa-smile',\n    voice: 'fas fa-microphone',\n    animation: 'fas fa-film',\n    location: 'fas fa-map-marker-alt',\n    contact: 'fas fa-address-book',\n    keyboard: 'fas fa-keyboard',\n    pin_message: 'fas fa-thumbtack',\n    unpin_message: 'fas fa-times',\n    delete_message: 'fas fa-trash',\n    ban_user: 'fas fa-user-slash',\n    unban_user: 'fas fa-user-check',\n    mute_user: 'fas fa-volume-mute',\n    unmute_user: 'fas fa-volume-up',\n    kick_user: 'fas fa-door-open',\n    promote_user: 'fas fa-user-shield',\n    demote_user: 'fas fa-user-minus',\n    admin_rights: 'fas fa-crown'\n  };\n\n  const nodeColors = {\n    start: 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400',\n    command: 'bg-indigo-100 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400',\n    message: 'bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400',\n    photo: 'bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400',\n    video: 'bg-rose-100 text-rose-600 dark:bg-rose-900/30 dark:text-rose-400',\n    audio: 'bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400',\n    document: 'bg-teal-100 text-teal-600 dark:bg-teal-900/30 dark:text-teal-400',\n    sticker: 'bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400',\n    voice: 'bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400',\n    animation: 'bg-pink-100 text-pink-600 dark:bg-pink-900/30 dark:text-pink-400',\n    location: 'bg-sky-100 text-sky-600 dark:bg-sky-900/30 dark:text-sky-400',\n    contact: 'bg-violet-100 text-violet-600 dark:bg-violet-900/30 dark:text-violet-400',\n    keyboard: 'bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400',\n    pin_message: 'bg-cyan-100 text-cyan-600 dark:bg-cyan-900/30 dark:text-cyan-400',\n    unpin_message: 'bg-cyan-100 text-cyan-600 dark:bg-cyan-900/30 dark:text-cyan-400',\n    delete_message: 'bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400',\n    ban_user: 'bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400',\n    unban_user: 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400',\n    mute_user: 'bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400',\n    unmute_user: 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400',\n    kick_user: 'bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400',\n    promote_user: 'bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400',\n    demote_user: 'bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400',\n    admin_rights: 'bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400'\n  };\n\n  const handleAddButton = () => {\n    const newButton: Button = {\n      id: nanoid(),\n      text: '–ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞',\n      action: 'goto',\n      target: '',\n      buttonType: 'normal',\n      skipDataCollection: false\n    };\n    onButtonAdd(selectedNode.id, newButton);\n  };\n\n  return (\n    <aside className=\"w-full h-full bg-background border-l border-border flex flex-col\">\n      {/* Properties Header */}\n      <div className=\"p-4 border-b border-border\">\n        <div className=\"flex items-center mb-3\">\n          <div className={`w-8 h-8 rounded-lg flex items-center justify-center mr-3 ${nodeColors[selectedNode.type]}`}>\n            <i className={`${nodeIcons[selectedNode.type]} text-sm`}></i>\n          </div>\n          <div className=\"flex-1\">\n            <h2 className=\"text-sm font-semibold text-foreground\">{nodeTypeNames[selectedNode.type]}</h2>\n            <div className=\"flex items-center mt-1\">\n              <span className=\"text-xs text-muted-foreground\">ID:</span>\n              <code className=\"ml-1 px-2 py-0.5 bg-muted rounded text-xs font-mono text-muted-foreground cursor-pointer hover:bg-muted/80 transition-colors\"\n                    onClick={() => {\n                      navigator.clipboard.writeText(selectedNode.id);\n                      toast({\n                        title: \"ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!\",\n                        description: `ID \"${selectedNode.id}\" —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞`,\n                      });\n                    }}\n                    title=\"–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å\">\n                {selectedNode.id}\n              </code>\n            </div>\n          </div>\n        </div>\n        <p className=\"text-xs text-muted-foreground\">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞</p>\n      </div>\n\n      {/* Properties Content */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-6\">\n        \n        {/* Basic Settings */}\n        <div>\n          <h3 className=\"text-sm font-medium text-foreground mb-3\">–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>\n          <div className=\"space-y-4\">\n            {/* Node Type Selector */}\n            <div>\n              <Label className=\"text-xs font-medium text-muted-foreground\">–¢–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞</Label>\n              <Select\n                value={selectedNode.type}\n                onValueChange={(value) => {\n                  if (onNodeTypeChange) {\n                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–∑–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞\n                    const newData = getDefaultDataForType(value as Node['type']);\n                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–±—â–∏–µ –ø–æ–ª—è\n                    const preservedData = {\n                      messageText: selectedNode.data.messageText,\n                      keyboardType: selectedNode.data.keyboardType,\n                      buttons: selectedNode.data.buttons,\n                      markdown: selectedNode.data.markdown,\n                      oneTimeKeyboard: selectedNode.data.oneTimeKeyboard,\n                      resizeKeyboard: selectedNode.data.resizeKeyboard\n                    };\n                    \n                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ\n                    const finalData = { ...newData, ...preservedData };\n                    \n                    // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∏–ø–∞\n                    onNodeTypeChange(selectedNode.id, value as Node['type'], finalData);\n                  }\n                }}\n              >\n                <SelectTrigger className=\"mt-2\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"message\">üìù –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</SelectItem>\n                  <SelectItem value=\"photo\">üñºÔ∏è –§–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º</SelectItem>\n                  <SelectItem value=\"video\">üé¨ –í–∏–¥–µ–æ —Å–æ–æ–±—â–µ–Ω–∏–µ</SelectItem>\n                  <SelectItem value=\"audio\">üéµ –ê—É–¥–∏–æ —Å–æ–æ–±—â–µ–Ω–∏–µ</SelectItem>\n                  <SelectItem value=\"document\">üìÑ –î–æ–∫—É–º–µ–Ω—Ç</SelectItem>\n                  <SelectItem value=\"sticker\">üòÄ –°—Ç–∏–∫–µ—Ä</SelectItem>\n                  <SelectItem value=\"voice\">üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</SelectItem>\n                  <SelectItem value=\"animation\">üéûÔ∏è GIF –∞–Ω–∏–º–∞—Ü–∏—è</SelectItem>\n                  <SelectItem value=\"location\">üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</SelectItem>\n                  <SelectItem value=\"contact\">üìû –ö–æ–Ω—Ç–∞–∫—Ç</SelectItem>\n                  <SelectItem value=\"keyboard\">‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞</SelectItem>\n                  <SelectItem value=\"start\">‚ñ∂Ô∏è /start –∫–æ–º–∞–Ω–¥–∞</SelectItem>\n                  <SelectItem value=\"command\">üîß –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞</SelectItem>\n                  <SelectItem value=\"pin_message\">üìå –ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</SelectItem>\n                  <SelectItem value=\"unpin_message\">üìå‚ùå –û—Ç–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</SelectItem>\n                  <SelectItem value=\"delete_message\">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</SelectItem>\n                  <SelectItem value=\"ban_user\">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</SelectItem>\n                  <SelectItem value=\"unban_user\">‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</SelectItem>\n                  <SelectItem value=\"mute_user\">üîá –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</SelectItem>\n                  <SelectItem value=\"unmute_user\">üîä –°–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</SelectItem>\n                  <SelectItem value=\"kick_user\">üë¢ –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</SelectItem>\n                  <SelectItem value=\"promote_user\">üëë –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</SelectItem>\n                  <SelectItem value=\"demote_user\">üë§ –°–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</SelectItem>\n                  <SelectItem value=\"admin_rights\">‚ö° –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            \n            {(selectedNode.type === 'start' || selectedNode.type === 'command') && (\n              <>\n                <div className=\"relative\">\n                  <Label className=\"text-xs font-medium text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞</Label>\n                  <div className=\"relative\">\n                    <Input\n                      value={selectedNode.data.command || getDefaultDataForType(selectedNode.type).command || ''}\n                      onChange={(e) => {\n                        onNodeUpdate(selectedNode.id, { command: e.target.value });\n                        setCommandInput(e.target.value);\n                        setShowCommandSuggestions(e.target.value.length > 0);\n                      }}\n                      onFocus={() => setShowCommandSuggestions(true)}\n                      onBlur={() => setTimeout(() => setShowCommandSuggestions(false), 200)}\n                      className={`mt-2 ${!commandValidation.isValid ? 'border-red-500' : ''}`}\n                      placeholder=\"/start\"\n                    />\n                    \n                    {/* –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ */}\n                    {showCommandSuggestions && commandSuggestions.length > 0 && (\n                      <div className=\"absolute top-full left-0 right-0 bg-background border border-border rounded-md shadow-lg z-50 max-h-48 overflow-y-auto\">\n                        {commandSuggestions.map((suggestion, index) => (\n                          <button\n                            key={index}\n                            className=\"w-full text-left px-3 py-2 hover:bg-muted text-sm border-b border-border last:border-b-0\"\n                            onClick={() => {\n                              onNodeUpdate(selectedNode.id, { \n                                command: suggestion.command,\n                                description: suggestion.description \n                              });\n                              setShowCommandSuggestions(false);\n                            }}\n                          >\n                            <div className=\"font-medium text-foreground\">{suggestion.command}</div>\n                            <div className=\"text-xs text-muted-foreground\">{suggestion.description}</div>\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                  \n                  {/* –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ */}\n                  {!commandValidation.isValid && commandValidation.errors.length > 0 && (\n                    <div className=\"mt-1 space-y-1\">\n                      {commandValidation.errors.map((error, index) => (\n                        <div key={index} className=\"flex items-center text-xs text-red-600\">\n                          <i className=\"fas fa-exclamation-circle mr-1\"></i>\n                          {error}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n                \n                <div>\n                  <Label className=\"text-xs font-medium text-muted-foreground\">–û–ø–∏—Å–∞–Ω–∏–µ</Label>\n                  <Input\n                    value={selectedNode.data.description || getDefaultDataForType(selectedNode.type).description || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { description: e.target.value })}\n                    placeholder=\"–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã\"\n                    className=\"text-xs\"\n                  />\n                  <div className=\"text-xs text-muted-foreground mt-1\">\n                    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–µ–Ω—é –∫–æ–º–∞–Ω–¥ –≤ @BotFather\n                  </div>\n                </div>\n                \n                {/* –°–∏–Ω–æ–Ω–∏–º—ã –∫–æ–º–∞–Ω–¥ */}\n                <SynonymEditor\n                  synonyms={selectedNode.data.synonyms || []}\n                  onUpdate={(synonyms) => onNodeUpdate(selectedNode.id, { synonyms })}\n                  title=\"–°–∏–Ω–æ–Ω–∏–º—ã –∫–æ–º–∞–Ω–¥—ã\"\n                  description=\"–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å —ç—Ç—É –∫–æ–º–∞–Ω–¥—É. –ù–∞–ø—Ä–∏–º–µ—Ä: —Å—Ç–∞—Ä—Ç –≤–º–µ—Å—Ç–æ /start\"\n                  placeholder=\"–ù–∞–ø—Ä–∏–º–µ—Ä: —Å—Ç–∞—Ä—Ç, –ø—Ä–∏–≤–µ—Ç, –Ω–∞—á–∞—Ç—å\"\n                />\n              </>\n            )}\n\n            {/* Command for Content Management and User Management */}\n            {(selectedNode.type === 'pin_message' || selectedNode.type === 'unpin_message' || selectedNode.type === 'delete_message' ||\n              selectedNode.type === 'ban_user' || selectedNode.type === 'unban_user' || selectedNode.type === 'mute_user' || \n              selectedNode.type === 'unmute_user' || selectedNode.type === 'kick_user' || selectedNode.type === 'promote_user' || \n              selectedNode.type === 'demote_user' || selectedNode.type === 'admin_rights') && (\n              <div>\n                <Label className=\"text-xs font-medium text-muted-foreground\">–ö–æ–º–∞–Ω–¥–∞</Label>\n                <Input\n                  value={selectedNode.data.command || getDefaultDataForType(selectedNode.type).command || ''}\n                  onChange={(e) => onNodeUpdate(selectedNode.id, { command: e.target.value })}\n                  className=\"mt-2\"\n                  placeholder={\n                    selectedNode.type === 'pin_message' ? '/pin_message' :\n                    selectedNode.type === 'unpin_message' ? '/unpin_message' :\n                    selectedNode.type === 'delete_message' ? '/delete_message' :\n                    selectedNode.type === 'ban_user' ? '/ban_user' :\n                    selectedNode.type === 'unban_user' ? '/unban_user' :\n                    selectedNode.type === 'mute_user' ? '/mute_user' :\n                    selectedNode.type === 'unmute_user' ? '/unmute_user' :\n                    selectedNode.type === 'kick_user' ? '/kick_user' :\n                    selectedNode.type === 'promote_user' ? '/promote_user' :\n                    selectedNode.type === 'demote_user' ? '/demote_user' :\n                    selectedNode.type === 'admin_rights' ? '/admin_rights' : '/command'\n                  }\n                />\n                <div className=\"text-xs text-muted-foreground mt-1\">\n                  –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è\n                </div>\n              </div>\n            )}\n\n            {/* Enhanced Media Settings */}\n            {selectedNode.type === 'photo' && (\n              <div className=\"space-y-6\">\n                {/* Media URL Section */}\n                <div className=\"bg-gradient-to-br from-blue-50/50 to-indigo-50/30 dark:from-blue-950/20 dark:to-indigo-950/10 border border-blue-200/30 dark:border-blue-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-image text-blue-600 dark:text-blue-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-blue-900 dark:text-blue-100\">–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</Label>\n                  </div>\n                  \n                  <MediaSelector\n                    projectId={projectId}\n                    value={selectedNode.data.imageUrl || ''}\n                    onChange={(url) => onNodeUpdate(selectedNode.id, { imageUrl: url })}\n                    fileType=\"photo\"\n                    placeholder=\"https://example.com/beautiful-image.jpg\"\n                    label=\"–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\"\n                  />\n                  \n                  <div className=\"flex items-center space-x-2 text-xs text-blue-600 dark:text-blue-400 mt-3\">\n                    <i className=\"fas fa-check-circle\"></i>\n                    <span>JPG, PNG, GIF, WebP ‚Ä¢ –ú–∞–∫—Å. 20MB</span>\n                  </div>\n                </div>\n\n                {/* Caption Section */}\n                <div className=\"bg-gradient-to-br from-green-50/50 to-emerald-50/30 dark:from-green-950/20 dark:to-emerald-950/10 border border-green-200/30 dark:border-green-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-comment-alt text-green-600 dark:text-green-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-green-900 dark:text-green-100\">–ü–æ–¥–ø–∏—Å—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é</Label>\n                  </div>\n                  \n                  <Textarea\n                    value={selectedNode.data.mediaCaption || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { mediaCaption: e.target.value })}\n                    className=\"resize-none border-green-200 dark:border-green-700 focus:border-green-500 focus:ring-green-200 transition-all duration-200\"\n                    rows={3}\n                    placeholder=\"–û–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...\"\n                  />\n                  \n                  <div className=\"flex items-center space-x-2 text-xs text-green-600 dark:text-green-400 mt-2\">\n                    <i className=\"fas fa-info-circle\"></i>\n                    <span>–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</span>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {selectedNode.type === 'video' && (\n              <div className=\"space-y-6\">\n                {/* Video URL Section */}\n                <div className=\"bg-gradient-to-br from-purple-50/50 to-violet-50/30 dark:from-purple-950/20 dark:to-violet-950/10 border border-purple-200/30 dark:border-purple-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-video text-purple-600 dark:text-purple-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-purple-900 dark:text-purple-100\">–ò—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ</Label>\n                  </div>\n                  \n                  <div className=\"space-y-3\">\n                    <MediaSelector\n                      projectId={projectId}\n                      value={selectedNode.data.videoUrl || ''}\n                      onChange={(url) => onNodeUpdate(selectedNode.id, { videoUrl: url })}\n                      fileType=\"video\"\n                      placeholder=\"https://example.com/awesome-video.mp4\"\n                      label=\"–ò—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ\"\n                    />\n                    \n                    <div className=\"flex items-center space-x-2 text-xs text-purple-600 dark:text-purple-400 mt-3\">\n                      <i className=\"fas fa-check-circle\"></i>\n                      <span>MP4, AVI, MOV, WebM ‚Ä¢ –ú–∞–∫—Å. 50MB</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Caption Section */}\n                <div className=\"bg-gradient-to-br from-green-50/50 to-emerald-50/30 dark:from-green-950/20 dark:to-emerald-950/10 border border-green-200/30 dark:border-green-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-comment-alt text-green-600 dark:text-green-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-green-900 dark:text-green-100\">–ü–æ–¥–ø–∏—Å—å –∫ –≤–∏–¥–µ–æ</Label>\n                  </div>\n                  \n                  <Textarea\n                    value={selectedNode.data.mediaCaption || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { mediaCaption: e.target.value })}\n                    className=\"resize-none border-green-200 dark:border-green-700 focus:border-green-500 focus:ring-green-200 transition-all duration-200\"\n                    rows={3}\n                    placeholder=\"–û–ø–∏—à–∏—Ç–µ –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...\"\n                  />\n                </div>\n\n                {/* Metadata Section */}\n                <div className=\"bg-gradient-to-br from-orange-50/50 to-amber-50/30 dark:from-orange-950/20 dark:to-amber-950/10 border border-orange-200/30 dark:border-orange-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-orange-100 dark:bg-orange-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-info-circle text-orange-600 dark:text-orange-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-orange-900 dark:text-orange-100\">–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ</Label>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        <i className=\"fas fa-clock mr-1\"></i>\n                        –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫)\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        value={selectedNode.data.muteDuration || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { muteDuration: parseInt(e.target.value) || 0 })}\n                        className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                        placeholder=\"120\"\n                        min=\"0\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        <i className=\"fas fa-hdd mr-1\"></i>\n                        –†–∞–∑–º–µ—Ä (–ú–ë)\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        value={selectedNode.data.fileSize || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { fileSize: parseInt(e.target.value) || 0 })}\n                        className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                        placeholder=\"25\"\n                        min=\"0\"\n                        max=\"50\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {selectedNode.type === 'audio' && (\n              <div className=\"space-y-6\">\n                {/* Audio URL Section */}\n                <div className=\"bg-gradient-to-br from-rose-50/50 to-pink-50/30 dark:from-rose-950/20 dark:to-pink-950/10 border border-rose-200/30 dark:border-rose-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-rose-100 dark:bg-rose-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-music text-rose-600 dark:text-rose-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-rose-900 dark:text-rose-100\">–ò—Å—Ç–æ—á–Ω–∏–∫ –∞—É–¥–∏–æ</Label>\n                  </div>\n                  \n                  <div className=\"space-y-3\">\n                    <MediaSelector\n                      projectId={projectId}\n                      value={selectedNode.data.audioUrl || ''}\n                      onChange={(url) => onNodeUpdate(selectedNode.id, { audioUrl: url })}\n                      fileType=\"audio\"\n                      placeholder=\"https://example.com/beautiful-music.mp3\"\n                      label=\"–ò—Å—Ç–æ—á–Ω–∏–∫ –∞—É–¥–∏–æ\"\n                    />\n                    \n                    <div className=\"flex items-center space-x-2 text-xs text-rose-600 dark:text-rose-400 mt-3\">\n                      <i className=\"fas fa-check-circle\"></i>\n                      <span>MP3, WAV, OGG, AAC ‚Ä¢ –ú–∞–∫—Å. 50MB</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Caption Section */}\n                <div className=\"bg-gradient-to-br from-green-50/50 to-emerald-50/30 dark:from-green-950/20 dark:to-emerald-950/10 border border-green-200/30 dark:border-green-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-comment-alt text-green-600 dark:text-green-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-green-900 dark:text-green-100\">–ü–æ–¥–ø–∏—Å—å –∫ –∞—É–¥–∏–æ</Label>\n                  </div>\n                  \n                  <Textarea\n                    value={selectedNode.data.mediaCaption || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { mediaCaption: e.target.value })}\n                    className=\"resize-none border-green-200 dark:border-green-700 focus:border-green-500 focus:ring-green-200 transition-all duration-200\"\n                    rows={3}\n                    placeholder=\"–û–ø–∏—à–∏—Ç–µ –∞—É–¥–∏–æ–∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...\"\n                  />\n                </div>\n\n                {/* Audio Metadata Section */}\n                <div className=\"bg-gradient-to-br from-cyan-50/50 to-sky-50/30 dark:from-cyan-950/20 dark:to-sky-950/10 border border-cyan-200/30 dark:border-cyan-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-cyan-100 dark:bg-cyan-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-compact-disc text-cyan-600 dark:text-cyan-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-cyan-900 dark:text-cyan-100\">–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∞</Label>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-xs font-medium text-cyan-700 dark:text-cyan-300 mb-2 block\">\n                          <i className=\"fas fa-clock mr-1\"></i>\n                          –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫)\n                        </Label>\n                        <Input\n                          type=\"number\"\n                          value={selectedNode.data.muteDuration || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { muteDuration: parseInt(e.target.value) || 0 })}\n                          className=\"border-cyan-200 dark:border-cyan-700 focus:border-cyan-500 focus:ring-cyan-200\"\n                          placeholder=\"180\"\n                          min=\"0\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs font-medium text-cyan-700 dark:text-cyan-300 mb-2 block\">\n                          <i className=\"fas fa-user mr-1\"></i>\n                          –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\n                        </Label>\n                        <Input\n                          value={selectedNode.data.performer || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { performer: e.target.value })}\n                          className=\"border-cyan-200 dark:border-cyan-700 focus:border-cyan-500 focus:ring-cyan-200\"\n                          placeholder=\"–ò–º—è –∞—Ä—Ç–∏—Å—Ç–∞\"\n                        />\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <Label className=\"text-xs font-medium text-cyan-700 dark:text-cyan-300 mb-2 block\">\n                        <i className=\"fas fa-heading mr-1\"></i>\n                        –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞\n                      </Label>\n                      <Input\n                        value={selectedNode.data.title || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { title: e.target.value })}\n                        className=\"border-cyan-200 dark:border-cyan-700 focus:border-cyan-500 focus:ring-cyan-200\"\n                        placeholder=\"–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {selectedNode.type === 'document' && (\n              <div className=\"space-y-6\">\n                {/* Document URL Section */}\n                <div className=\"bg-gradient-to-br from-teal-50/50 to-cyan-50/30 dark:from-teal-950/20 dark:to-cyan-950/10 border border-teal-200/30 dark:border-teal-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-teal-100 dark:bg-teal-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-file-alt text-teal-600 dark:text-teal-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-teal-900 dark:text-teal-100\">–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞</Label>\n                  </div>\n                  \n                  <div className=\"space-y-3\">\n                    <MediaSelector\n                      projectId={projectId}\n                      value={selectedNode.data.documentUrl || ''}\n                      onChange={(url) => onNodeUpdate(selectedNode.id, { documentUrl: url })}\n                      fileType=\"document\"\n                      placeholder=\"https://example.com/important-document.pdf\"\n                      label=\"–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞\"\n                    />\n                    \n                    <div className=\"flex items-center space-x-2 text-xs text-teal-600 dark:text-teal-400 mt-3\">\n                      <i className=\"fas fa-check-circle\"></i>\n                      <span>–õ—é–±—ã–µ —Ñ–∞–π–ª—ã ‚Ä¢ –ú–∞–∫—Å. 50MB</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Caption Section */}\n                <div className=\"bg-gradient-to-br from-green-50/50 to-emerald-50/30 dark:from-green-950/20 dark:to-emerald-950/10 border border-green-200/30 dark:border-green-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-comment-alt text-green-600 dark:text-green-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-green-900 dark:text-green-100\">–ü–æ–¥–ø–∏—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É</Label>\n                  </div>\n                  \n                  <Textarea\n                    value={selectedNode.data.mediaCaption || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { mediaCaption: e.target.value })}\n                    className=\"resize-none border-green-200 dark:border-green-700 focus:border-green-500 focus:ring-green-200 transition-all duration-200\"\n                    rows={3}\n                    placeholder=\"–û–ø–∏—à–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...\"\n                  />\n                </div>\n\n                {/* Document Details Section */}\n                <div className=\"bg-gradient-to-br from-slate-50/50 to-gray-50/30 dark:from-slate-950/20 dark:to-gray-950/10 border border-slate-200/30 dark:border-slate-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-slate-100 dark:bg-slate-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-tags text-slate-600 dark:text-slate-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-slate-900 dark:text-slate-100\">–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</Label>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-slate-700 dark:text-slate-300 mb-2 block\">\n                        <i className=\"fas fa-file-signature mr-1\"></i>\n                        –ò–º—è —Ñ–∞–π–ª–∞\n                      </Label>\n                      <Input\n                        value={selectedNode.data.documentName || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { documentName: e.target.value })}\n                        className=\"border-slate-200 dark:border-slate-700 focus:border-slate-500 focus:ring-slate-200\"\n                        placeholder=\"important-document.pdf\"\n                      />\n                      <div className=\"text-xs text-slate-500 dark:text-slate-400 mt-1\">\n                        –ò–º—è —Ñ–∞–π–ª–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–æ–µ —É–≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\n                      </div>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-xs font-medium text-slate-700 dark:text-slate-300 mb-2 block\">\n                          <i className=\"fas fa-hdd mr-1\"></i>\n                          –†–∞–∑–º–µ—Ä (–ú–ë)\n                        </Label>\n                        <Input\n                          type=\"number\"\n                          value={selectedNode.data.fileSize || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { fileSize: parseInt(e.target.value) || 0 })}\n                          className=\"border-slate-200 dark:border-slate-700 focus:border-slate-500 focus:ring-slate-200\"\n                          placeholder=\"5\"\n                          min=\"0\"\n                          max=\"50\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs font-medium text-slate-700 dark:text-slate-300 mb-2 block\">\n                          <i className=\"fas fa-file-code mr-1\"></i>\n                          –¢–∏–ø —Ñ–∞–π–ª–∞\n                        </Label>\n                        <Input\n                          value={selectedNode.data.mimeType || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { mimeType: e.target.value })}\n                          className=\"border-slate-200 dark:border-slate-700 focus:border-slate-500 focus:ring-slate-200\"\n                          placeholder=\"application/pdf\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Sticker Configuration */}\n            {selectedNode.type === 'sticker' && (\n              <div className=\"space-y-6\">\n                {/* Sticker URL Section */}\n                <div className=\"bg-gradient-to-br from-yellow-50/50 to-orange-50/30 dark:from-yellow-950/20 dark:to-orange-950/10 border border-yellow-200/30 dark:border-yellow-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-yellow-100 dark:bg-yellow-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-smile text-yellow-600 dark:text-yellow-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-yellow-900 dark:text-yellow-100\">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∏–∫–µ—Ä–∞</Label>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-yellow-700 dark:text-yellow-300 mb-2 block\">\n                        <i className=\"fas fa-link mr-1\"></i>\n                        URL —Å—Ç–∏–∫–µ—Ä–∞ –∏–ª–∏ file_id\n                      </Label>\n                      <Input\n                        value={selectedNode.data.stickerUrl || selectedNode.data.stickerFileId || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { stickerUrl: e.target.value })}\n                        className=\"border-yellow-200 dark:border-yellow-700 focus:border-yellow-500 focus:ring-yellow-200\"\n                        placeholder=\"CAACAgIAAxkBAAICGGXm2KvQAAG2X8cxTmZHJkRnYwYlAAJGAANWnb0KmgiEKEZDKVQeBA\"\n                      />\n                      <div className=\"text-xs text-yellow-600 dark:text-yellow-400 mt-2\">\n                        –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å file_id —Å—Ç–∏–∫–µ—Ä–∞ –∏–∑ Telegram –∏–ª–∏ URL —Å –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–æ–π\n                      </div>\n                    </div>\n\n                    <div>\n                      <Label className=\"text-xs font-medium text-yellow-700 dark:text-yellow-300 mb-2 block\">\n                        <i className=\"fas fa-tag mr-1\"></i>\n                        –ù–∞–±–æ—Ä —Å—Ç–∏–∫–µ—Ä–æ–≤\n                      </Label>\n                      <Input\n                        value={selectedNode.data.stickerSetName || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { stickerSetName: e.target.value })}\n                        className=\"border-yellow-200 dark:border-yellow-700 focus:border-yellow-500 focus:ring-yellow-200\"\n                        placeholder=\"mystickerpack_by_mybot\"\n                      />\n                      <div className=\"text-xs text-yellow-600 dark:text-yellow-400 mt-2\">\n                        –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ —Å—Ç–∏–∫–µ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Voice Message Configuration */}\n            {selectedNode.type === 'voice' && (\n              <div className=\"space-y-6\">\n                {/* Voice URL Section */}\n                <div className=\"bg-gradient-to-br from-teal-50/50 to-cyan-50/30 dark:from-teal-950/20 dark:to-cyan-950/10 border border-teal-200/30 dark:border-teal-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-teal-100 dark:bg-teal-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-microphone text-teal-600 dark:text-teal-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-teal-900 dark:text-teal-100\">–ò—Å—Ç–æ—á–Ω–∏–∫ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</Label>\n                  </div>\n                  \n                  <MediaSelector\n                    projectId={projectId}\n                    value={selectedNode.data.voiceUrl || ''}\n                    onChange={(url) => onNodeUpdate(selectedNode.id, { voiceUrl: url })}\n                    fileType=\"audio\"\n                    placeholder=\"https://example.com/voice-message.ogg\"\n                    label=\"–ò—Å—Ç–æ—á–Ω–∏–∫ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\"\n                  />\n                  \n                  <div className=\"flex items-center space-x-2 text-xs text-teal-600 dark:text-teal-400 mt-3\">\n                    <i className=\"fas fa-check-circle\"></i>\n                    <span>OGG —Å OPUS –∫–æ–¥–µ–∫–æ–º ‚Ä¢ –ú–∞–∫—Å. 20MB</span>\n                  </div>\n                </div>\n\n                {/* Voice Metadata Section */}\n                <div className=\"bg-gradient-to-br from-purple-50/50 to-indigo-50/30 dark:from-purple-950/20 dark:to-indigo-950/10 border border-purple-200/30 dark:border-purple-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-info-circle text-purple-600 dark:text-purple-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-purple-900 dark:text-purple-100\">–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</Label>\n                  </div>\n                  \n                  <div>\n                    <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300 mb-2 block\">\n                      <i className=\"fas fa-clock mr-1\"></i>\n                      –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫—É–Ω–¥—ã)\n                    </Label>\n                    <Input\n                      type=\"number\"\n                      value={selectedNode.data.duration || ''}\n                      onChange={(e) => onNodeUpdate(selectedNode.id, { duration: parseInt(e.target.value) || 0 })}\n                      className=\"border-purple-200 dark:border-purple-700 focus:border-purple-500 focus:ring-purple-200\"\n                      placeholder=\"30\"\n                      min=\"0\"\n                      max=\"3600\"\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Animation (GIF) Configuration */}\n            {selectedNode.type === 'animation' && (\n              <div className=\"space-y-6\">\n                {/* Animation URL Section */}\n                <div className=\"bg-gradient-to-br from-pink-50/50 to-rose-50/30 dark:from-pink-950/20 dark:to-rose-950/10 border border-pink-200/30 dark:border-pink-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-pink-100 dark:bg-pink-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-film text-pink-600 dark:text-pink-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-pink-900 dark:text-pink-100\">–ò—Å—Ç–æ—á–Ω–∏–∫ GIF –∞–Ω–∏–º–∞—Ü–∏–∏</Label>\n                  </div>\n                  \n                  <MediaSelector\n                    projectId={projectId}\n                    value={selectedNode.data.animationUrl || ''}\n                    onChange={(url) => onNodeUpdate(selectedNode.id, { animationUrl: url })}\n                    fileType=\"video\"\n                    placeholder=\"https://example.com/awesome-animation.gif\"\n                    label=\"–ò—Å—Ç–æ—á–Ω–∏–∫ –∞–Ω–∏–º–∞—Ü–∏–∏\"\n                  />\n                  \n                  <div className=\"flex items-center space-x-2 text-xs text-pink-600 dark:text-pink-400 mt-3\">\n                    <i className=\"fas fa-check-circle\"></i>\n                    <span>GIF, MP4 (–∞–Ω–∏–º–∞—Ü–∏—è) ‚Ä¢ –ú–∞–∫—Å. 50MB</span>\n                  </div>\n                </div>\n\n                {/* Caption Section */}\n                <div className=\"bg-gradient-to-br from-green-50/50 to-emerald-50/30 dark:from-green-950/20 dark:to-emerald-950/10 border border-green-200/30 dark:border-green-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-comment-alt text-green-600 dark:text-green-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-green-900 dark:text-green-100\">–ü–æ–¥–ø–∏—Å—å –∫ –∞–Ω–∏–º–∞—Ü–∏–∏</Label>\n                  </div>\n                  \n                  <Textarea\n                    value={selectedNode.data.mediaCaption || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { mediaCaption: e.target.value })}\n                    className=\"resize-none border-green-200 dark:border-green-700 focus:border-green-500 focus:ring-green-200 transition-all duration-200\"\n                    rows={3}\n                    placeholder=\"–û–ø–∏—Å–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...\"\n                  />\n                </div>\n\n                {/* Animation Metadata Section */}\n                <div className=\"bg-gradient-to-br from-orange-50/50 to-amber-50/30 dark:from-orange-950/20 dark:to-amber-950/10 border border-orange-200/30 dark:border-orange-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-orange-100 dark:bg-orange-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-cog text-orange-600 dark:text-orange-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-orange-900 dark:text-orange-100\">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∏–º–∞—Ü–∏–∏</Label>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        <i className=\"fas fa-arrows-alt-h mr-1\"></i>\n                        –®–∏—Ä–∏–Ω–∞ (px)\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        value={selectedNode.data.width || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { width: parseInt(e.target.value) || 0 })}\n                        className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                        placeholder=\"480\"\n                        min=\"0\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        <i className=\"fas fa-arrows-alt-v mr-1\"></i>\n                        –í—ã—Å–æ—Ç–∞ (px)\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        value={selectedNode.data.height || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { height: parseInt(e.target.value) || 0 })}\n                        className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                        placeholder=\"320\"\n                        min=\"0\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        <i className=\"fas fa-clock mr-1\"></i>\n                        –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫)\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        value={selectedNode.data.muteDuration || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { muteDuration: parseInt(e.target.value) || 0 })}\n                        className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                        placeholder=\"5\"\n                        min=\"0\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        <i className=\"fas fa-file mr-1\"></i>\n                        –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞\n                      </Label>\n                      <Input\n                        value={selectedNode.data.fileName || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { fileName: e.target.value })}\n                        className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                        placeholder=\"animation.gif\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Location Configuration */}\n            {selectedNode.type === 'location' && (\n              <div className=\"space-y-6\">\n                {/* Coordinates Section */}\n                <div className=\"bg-gradient-to-br from-emerald-50/50 to-green-50/30 dark:from-emerald-950/20 dark:to-green-950/10 border border-emerald-200/30 dark:border-emerald-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-emerald-100 dark:bg-emerald-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-map-marker-alt text-emerald-600 dark:text-emerald-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-emerald-900 dark:text-emerald-100\">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</Label>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-emerald-700 dark:text-emerald-300 mb-2 block\">\n                        <i className=\"fas fa-globe mr-1\"></i>\n                        –®–∏—Ä–æ—Ç–∞\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        step=\"any\"\n                        value={selectedNode.data.latitude || ''}\n                        onChange={(e) => {\n                          const lat = parseFloat(e.target.value) || 0;\n                          onNodeUpdate(selectedNode.id, { latitude: lat });\n                          \n                          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –æ–±–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\n                          if (lat && selectedNode.data.longitude) {\n                            getLocationInfo(lat, selectedNode.data.longitude)\n                              .then(locationInfo => {\n                                if (locationInfo) {\n                                  onNodeUpdate(selectedNode.id, {\n                                    title: locationInfo.title || selectedNode.data.title || '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n                                    address: locationInfo.address || selectedNode.data.address,\n                                    city: locationInfo.city || selectedNode.data.city,\n                                    country: locationInfo.country || selectedNode.data.country\n                                  });\n                                  toast({\n                                    title: \"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞\",\n                                    description: `–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã: ${locationInfo.city || '–≥–æ—Ä–æ–¥'}, ${locationInfo.country || '—Å—Ç—Ä–∞–Ω–∞'}`\n                                  });\n                                }\n                              })\n                              .catch(console.error);\n                          }\n                        }}\n                        className=\"border-emerald-200 dark:border-emerald-700 focus:border-emerald-500 focus:ring-emerald-200\"\n                        placeholder=\"55.7558\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs font-medium text-emerald-700 dark:text-emerald-300 mb-2 block\">\n                        <i className=\"fas fa-globe mr-1\"></i>\n                        –î–æ–ª–≥–æ—Ç–∞\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        step=\"any\"\n                        value={selectedNode.data.longitude || ''}\n                        onChange={(e) => {\n                          const lng = parseFloat(e.target.value) || 0;\n                          onNodeUpdate(selectedNode.id, { longitude: lng });\n                          \n                          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –æ–±–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\n                          if (lng && selectedNode.data.latitude) {\n                            getLocationInfo(selectedNode.data.latitude, lng)\n                              .then(locationInfo => {\n                                if (locationInfo) {\n                                  onNodeUpdate(selectedNode.id, {\n                                    title: locationInfo.title || selectedNode.data.title || '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n                                    address: locationInfo.address || selectedNode.data.address,\n                                    city: locationInfo.city || selectedNode.data.city,\n                                    country: locationInfo.country || selectedNode.data.country\n                                  });\n                                  toast({\n                                    title: \"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞\",\n                                    description: `–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã: ${locationInfo.city || '–≥–æ—Ä–æ–¥'}, ${locationInfo.country || '—Å—Ç—Ä–∞–Ω–∞'}`\n                                  });\n                                }\n                              })\n                              .catch(console.error);\n                          }\n                        }}\n                        className=\"border-emerald-200 dark:border-emerald-700 focus:border-emerald-500 focus:ring-emerald-200\"\n                        placeholder=\"37.6176\"\n                      />\n                    </div>\n                  </div>\n                  \n                  <div className=\"text-xs text-emerald-600 dark:text-emerald-400 mt-2\">\n                    –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)\n                  </div>\n                </div>\n\n                {/* Location Details Section */}\n                <div className=\"bg-gradient-to-br from-blue-50/50 to-indigo-50/30 dark:from-blue-950/20 dark:to-indigo-950/10 border border-blue-200/30 dark:border-blue-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-info-circle text-blue-600 dark:text-blue-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-blue-900 dark:text-blue-100\">–û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</Label>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2 block\">\n                        <i className=\"fas fa-tag mr-1\"></i>\n                        –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞\n                      </Label>\n                      <Input\n                        value={selectedNode.data.title || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { title: e.target.value })}\n                        className=\"border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200\"\n                        placeholder=\"–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2 block\">\n                        <i className=\"fas fa-map-signs mr-1\"></i>\n                        –ê–¥—Ä–µ—Å\n                      </Label>\n                      <Input\n                        value={selectedNode.data.address || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { address: e.target.value })}\n                        className=\"border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200\"\n                        placeholder=\"–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, –¥–æ–º 1\"\n                      />\n                    </div>\n                    \n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2 block\">\n                          <i className=\"fas fa-city mr-1\"></i>\n                          –ì–æ—Ä–æ–¥\n                        </Label>\n                        <Input\n                          value={selectedNode.data.city || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { city: e.target.value })}\n                          className=\"border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200\"\n                          placeholder=\"–ú–æ—Å–∫–≤–∞\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2 block\">\n                          <i className=\"fas fa-flag mr-1\"></i>\n                          –°—Ç—Ä–∞–Ω–∞\n                        </Label>\n                        <Input\n                          value={selectedNode.data.country || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { country: e.target.value })}\n                          className=\"border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200\"\n                          placeholder=\"–†–æ—Å—Å–∏—è\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Foursquare Integration Section */}\n                <div className=\"bg-gradient-to-br from-purple-50/50 to-violet-50/30 dark:from-purple-950/20 dark:to-violet-950/10 border border-purple-200/30 dark:border-purple-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-map text-purple-600 dark:text-purple-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-purple-900 dark:text-purple-100\">Foursquare (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</Label>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300 mb-2 block\">\n                        <i className=\"fas fa-hashtag mr-1\"></i>\n                        Foursquare ID\n                      </Label>\n                      <Input\n                        value={selectedNode.data.foursquareId || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { foursquareId: e.target.value })}\n                        className=\"border-purple-200 dark:border-purple-700 focus:border-purple-500 focus:ring-purple-200\"\n                        placeholder=\"4b0588f1f964a52079c525e3\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300 mb-2 block\">\n                        <i className=\"fas fa-layer-group mr-1\"></i>\n                        –¢–∏–ø –º–µ—Å—Ç–∞\n                      </Label>\n                      <Input\n                        value={selectedNode.data.foursquareType || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { foursquareType: e.target.value })}\n                        className=\"border-purple-200 dark:border-purple-700 focus:border-purple-500 focus:ring-purple-200\"\n                        placeholder=\"arts_entertainment/default\"\n                      />\n                    </div>\n                  </div>\n                  \n                  <div className=\"text-xs text-purple-600 dark:text-purple-400 mt-2\">\n                    –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Foursquare –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Å—Ç–µ\n                  </div>\n                </div>\n\n                {/* Map Services Section */}\n                <div className=\"bg-gradient-to-br from-orange-50/50 to-red-50/30 dark:from-orange-950/20 dark:to-red-950/10 border border-orange-200/30 dark:border-orange-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-orange-100 dark:bg-orange-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-route text-orange-600 dark:text-orange-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-orange-900 dark:text-orange-100\">–ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã</Label>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        <i className=\"fas fa-layer-group mr-1\"></i>\n                        –°–µ—Ä–≤–∏—Å –∫–∞—Ä—Ç\n                      </Label>\n                      <select\n                        value={selectedNode.data.mapService || 'custom'}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { mapService: e.target.value as 'custom' | 'yandex' | 'google' | '2gis' })}\n                        className=\"w-full px-3 py-2 border border-orange-200 dark:border-orange-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-sm focus:border-orange-500 focus:ring-orange-200\"\n                      >\n                        <option value=\"custom\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</option>\n                        <option value=\"yandex\">–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã</option>\n                        <option value=\"google\">Google Maps</option>\n                        <option value=\"2gis\">2–ì–ò–°</option>\n                      </select>\n                    </div>\n\n                    {selectedNode.data.mapService === 'yandex' && (\n                      <div>\n                        <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                          <i className=\"fas fa-link mr-1\"></i>\n                          –°—Å—ã–ª–∫–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã\n                        </Label>\n                        <Input\n                          type=\"url\"\n                          value={selectedNode.data.yandexMapUrl || ''}\n                          onChange={(e) => {\n                            const url = e.target.value;\n                            onNodeUpdate(selectedNode.id, { yandexMapUrl: url });\n                            \n                            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ URL\n                            if (url) {\n                              const { coordinates, service } = extractCoordinatesFromUrl(url);\n                              if (coordinates) {\n                                const updates: any = {\n                                  latitude: coordinates.latitude,\n                                  longitude: coordinates.longitude,\n                                  mapService: service\n                                };\n                                \n                                onNodeUpdate(selectedNode.id, updates);\n                                \n                                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏\n                                getLocationInfo(coordinates.latitude, coordinates.longitude)\n                                  .then(locationInfo => {\n                                    if (locationInfo) {\n                                      onNodeUpdate(selectedNode.id, {\n                                        title: locationInfo.title || selectedNode.data.title || '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n                                        address: locationInfo.address || selectedNode.data.address,\n                                        city: locationInfo.city || selectedNode.data.city,\n                                        country: locationInfo.country || selectedNode.data.country\n                                      });\n                                      toast({\n                                        title: \"–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã\",\n                                        description: `–ò–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç: ${locationInfo.city || '–≥–æ—Ä–æ–¥'}, ${locationInfo.country || '—Å—Ç—Ä–∞–Ω–∞'}`\n                                      });\n                                    }\n                                  })\n                                  .catch(console.error);\n                              }\n                            }\n                          }}\n                          className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                          placeholder=\"https://yandex.ru/maps/...\"\n                        />\n                        <p className=\"text-xs text-orange-600 dark:text-orange-400 mt-1\">\n                          –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑–≤–ª–µ–∫—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\n                        </p>\n                        {selectedNode.data.yandexMapUrl && selectedNode.data.latitude && selectedNode.data.longitude && (\n                          <div className=\"mt-2 text-xs text-green-600 dark:text-green-400 flex items-center\">\n                            <i className=\"fas fa-check-circle mr-1\"></i>\n                            –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: {formatCoordinates(selectedNode.data.latitude, selectedNode.data.longitude)}\n                          </div>\n                        )}\n                      </div>\n                    )}\n\n                    {selectedNode.data.mapService === 'google' && (\n                      <div>\n                        <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                          <i className=\"fas fa-link mr-1\"></i>\n                          –°—Å—ã–ª–∫–∞ –Ω–∞ Google Maps\n                        </Label>\n                        <Input\n                          type=\"url\"\n                          value={selectedNode.data.googleMapUrl || ''}\n                          onChange={(e) => {\n                            const url = e.target.value;\n                            onNodeUpdate(selectedNode.id, { googleMapUrl: url });\n                            \n                            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ URL\n                            if (url) {\n                              const { coordinates, service } = extractCoordinatesFromUrl(url);\n                              if (coordinates) {\n                                const updates: any = {\n                                  latitude: coordinates.latitude,\n                                  longitude: coordinates.longitude,\n                                  mapService: service\n                                };\n                                \n                                onNodeUpdate(selectedNode.id, updates);\n                                \n                                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏\n                                getLocationInfo(coordinates.latitude, coordinates.longitude)\n                                  .then(locationInfo => {\n                                    if (locationInfo) {\n                                      onNodeUpdate(selectedNode.id, {\n                                        title: locationInfo.title || selectedNode.data.title || '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n                                        address: locationInfo.address || selectedNode.data.address,\n                                        city: locationInfo.city || selectedNode.data.city,\n                                        country: locationInfo.country || selectedNode.data.country\n                                      });\n                                      toast({\n                                        title: \"–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã\",\n                                        description: `–ò–∑ Google Maps: ${locationInfo.city || '–≥–æ—Ä–æ–¥'}, ${locationInfo.country || '—Å—Ç—Ä–∞–Ω–∞'}`\n                                      });\n                                    }\n                                  })\n                                  .catch(console.error);\n                              }\n                            }\n                          }}\n                          className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                          placeholder=\"https://maps.google.com/...\"\n                        />\n                        <p className=\"text-xs text-orange-600 dark:text-orange-400 mt-1\">\n                          –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ Google Maps - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑–≤–ª–µ–∫—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\n                        </p>\n                        {selectedNode.data.googleMapUrl && selectedNode.data.latitude && selectedNode.data.longitude && (\n                          <div className=\"mt-2 text-xs text-green-600 dark:text-green-400 flex items-center\">\n                            <i className=\"fas fa-check-circle mr-1\"></i>\n                            –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: {formatCoordinates(selectedNode.data.latitude, selectedNode.data.longitude)}\n                          </div>\n                        )}\n                      </div>\n                    )}\n\n                    {selectedNode.data.mapService === '2gis' && (\n                      <div>\n                        <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                          <i className=\"fas fa-link mr-1\"></i>\n                          –°—Å—ã–ª–∫–∞ –Ω–∞ 2–ì–ò–°\n                        </Label>\n                        <Input\n                          type=\"url\"\n                          value={selectedNode.data.gisMapUrl || ''}\n                          onChange={(e) => {\n                            const url = e.target.value;\n                            onNodeUpdate(selectedNode.id, { gisMapUrl: url });\n                            \n                            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ URL\n                            if (url) {\n                              const { coordinates, service } = extractCoordinatesFromUrl(url);\n                              if (coordinates) {\n                                const updates: any = {\n                                  latitude: coordinates.latitude,\n                                  longitude: coordinates.longitude,\n                                  mapService: service\n                                };\n                                \n                                onNodeUpdate(selectedNode.id, updates);\n                                \n                                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏\n                                getLocationInfo(coordinates.latitude, coordinates.longitude)\n                                  .then(locationInfo => {\n                                    if (locationInfo) {\n                                      onNodeUpdate(selectedNode.id, {\n                                        title: locationInfo.title || selectedNode.data.title || '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n                                        address: locationInfo.address || selectedNode.data.address,\n                                        city: locationInfo.city || selectedNode.data.city,\n                                        country: locationInfo.country || selectedNode.data.country\n                                      });\n                                      toast({\n                                        title: \"–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã\",\n                                        description: `–ò–∑ 2–ì–ò–°: ${locationInfo.city || '–≥–æ—Ä–æ–¥'}, ${locationInfo.country || '—Å—Ç—Ä–∞–Ω–∞'}`\n                                      });\n                                    }\n                                  })\n                                  .catch(console.error);\n                              }\n                            }\n                          }}\n                          className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                          placeholder=\"https://2gis.ru/...\"\n                        />\n                        <p className=\"text-xs text-orange-600 dark:text-orange-400 mt-1\">\n                          –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ 2–ì–ò–° - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑–≤–ª–µ–∫—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\n                        </p>\n                        {selectedNode.data.gisMapUrl && selectedNode.data.latitude && selectedNode.data.longitude && (\n                          <div className=\"mt-2 text-xs text-green-600 dark:text-green-400 flex items-center\">\n                            <i className=\"fas fa-check-circle mr-1\"></i>\n                            –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: {formatCoordinates(selectedNode.data.latitude, selectedNode.data.longitude)}\n                          </div>\n                        )}\n                      </div>\n                    )}\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                          <i className=\"fas fa-search-plus mr-1\"></i>\n                          –ú–∞—Å—à—Ç–∞–± –∫–∞—Ä—Ç—ã\n                        </Label>\n                        <Input\n                          type=\"number\"\n                          min=\"1\"\n                          max=\"20\"\n                          value={selectedNode.data.mapZoom || 15}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { mapZoom: parseInt(e.target.value) || 15 })}\n                          className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                          placeholder=\"15\"\n                        />\n                      </div>\n                      <div className=\"flex flex-col justify-end\">\n                        <div className=\"flex items-center space-x-2\">\n                          <input\n                            type=\"checkbox\"\n                            id=\"showDirections\"\n                            checked={selectedNode.data.showDirections || false}\n                            onChange={(e) => onNodeUpdate(selectedNode.id, { showDirections: e.target.checked })}\n                            className=\"w-4 h-4 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500 dark:focus:ring-orange-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\"\n                          />\n                          <Label htmlFor=\"showDirections\" className=\"text-xs font-medium text-orange-700 dark:text-orange-300\">\n                            –ü–æ–∫–∞–∑–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç\n                          </Label>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center space-x-2\">\n                      <input\n                        type=\"checkbox\"\n                        id=\"generateMapPreview\"\n                        checked={selectedNode.data.generateMapPreview !== false}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { generateMapPreview: e.target.checked })}\n                        className=\"w-4 h-4 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500 dark:focus:ring-orange-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\"\n                      />\n                      <Label htmlFor=\"generateMapPreview\" className=\"text-xs font-medium text-orange-700 dark:text-orange-300\">\n                        –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–≤—å—é –∫–∞—Ä—Ç—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Å–µ—Ä–≤–∏—Å–æ–≤\n                      </Label>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Contact Configuration */}\n            {selectedNode.type === 'contact' && (\n              <div className=\"space-y-6\">\n                {/* Contact Info Section */}\n                <div className=\"bg-gradient-to-br from-cyan-50/50 to-blue-50/30 dark:from-cyan-950/20 dark:to-blue-950/10 border border-cyan-200/30 dark:border-cyan-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-cyan-100 dark:bg-cyan-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-address-book text-cyan-600 dark:text-cyan-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-cyan-900 dark:text-cyan-100\">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</Label>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-cyan-700 dark:text-cyan-300 mb-2 block\">\n                        <i className=\"fas fa-phone mr-1\"></i>\n                        –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)\n                      </Label>\n                      <Input\n                        value={selectedNode.data.phoneNumber || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { phoneNumber: e.target.value })}\n                        className=\"border-cyan-200 dark:border-cyan-700 focus:border-cyan-500 focus:ring-cyan-200\"\n                        placeholder=\"+7 (999) 123-45-67\"\n                      />\n                    </div>\n                    \n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-xs font-medium text-cyan-700 dark:text-cyan-300 mb-2 block\">\n                          <i className=\"fas fa-user mr-1\"></i>\n                          –ò–º—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)\n                        </Label>\n                        <Input\n                          value={selectedNode.data.firstName || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { firstName: e.target.value })}\n                          className=\"border-cyan-200 dark:border-cyan-700 focus:border-cyan-500 focus:ring-cyan-200\"\n                          placeholder=\"–ò–≤–∞–Ω\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs font-medium text-cyan-700 dark:text-cyan-300 mb-2 block\">\n                          <i className=\"fas fa-user mr-1\"></i>\n                          –§–∞–º–∏–ª–∏—è\n                        </Label>\n                        <Input\n                          value={selectedNode.data.lastName || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { lastName: e.target.value })}\n                          className=\"border-cyan-200 dark:border-cyan-700 focus:border-cyan-500 focus:ring-cyan-200\"\n                          placeholder=\"–ü–µ—Ç—Ä–æ–≤\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Additional Contact Details Section */}\n                <div className=\"bg-gradient-to-br from-indigo-50/50 to-purple-50/30 dark:from-indigo-950/20 dark:to-purple-950/10 border border-indigo-200/30 dark:border-indigo-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-id-card text-indigo-600 dark:text-indigo-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-indigo-900 dark:text-indigo-100\">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</Label>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-xs font-medium text-indigo-700 dark:text-indigo-300 mb-2 block\">\n                        <i className=\"fas fa-at mr-1\"></i>\n                        User ID Telegram\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        value={selectedNode.data.userId || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { userId: parseInt(e.target.value) || 0 })}\n                        className=\"border-indigo-200 dark:border-indigo-700 focus:border-indigo-500 focus:ring-indigo-200\"\n                        placeholder=\"123456789\"\n                      />\n                      <div className=\"text-xs text-indigo-600 dark:text-indigo-400 mt-1\">\n                        ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–µ–Ω)\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <Label className=\"text-xs font-medium text-indigo-700 dark:text-indigo-300 mb-2 block\">\n                        <i className=\"fas fa-address-card mr-1\"></i>\n                        vCard –¥–∞–Ω–Ω—ã–µ\n                      </Label>\n                      <Textarea\n                        value={selectedNode.data.vcard || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { vcard: e.target.value })}\n                        className=\"resize-none border-indigo-200 dark:border-indigo-700 focus:border-indigo-500 focus:ring-indigo-200 transition-all duration-200\"\n                        rows={4}\n                        placeholder=\"BEGIN:VCARD&#10;VERSION:3.0&#10;FN:–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤&#10;TEL:+79991234567&#10;END:VCARD\"\n                      />\n                      <div className=\"text-xs text-indigo-600 dark:text-indigo-400 mt-1\">\n                        –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ vCard (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Content Management Configuration */}\n            {(selectedNode.type === 'pin_message' || selectedNode.type === 'unpin_message' || selectedNode.type === 'delete_message') && (\n              <div className=\"space-y-6\">\n                {/* Automatic Message Handling Info */}\n                <div className=\"bg-gradient-to-br from-blue-50/50 to-indigo-50/30 dark:from-blue-950/20 dark:to-indigo-950/10 border border-blue-200/30 dark:border-blue-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-reply text-blue-600 dark:text-blue-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-blue-900 dark:text-blue-100\">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</Label>\n                  </div>\n                  \n                  <div className=\"bg-blue-50/50 dark:bg-blue-950/20 rounded-lg p-3 border border-blue-200/30 dark:border-blue-800/30\">\n                    <div className=\"text-xs text-blue-700 dark:text-blue-300 leading-relaxed\">\n                      <i className=\"fas fa-info-circle mr-1\"></i>\n                      –ö–æ–º–∞–Ω–¥–∞ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. \n                      {selectedNode.type === 'pin_message' && ' –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ª–æ–≤–æ–º \"–∑–∞–∫—Ä–µ–ø–∏—Ç—å\" - —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è.'}\n                      {selectedNode.type === 'unpin_message' && ' –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ª–æ–≤–æ–º \"–æ—Ç–∫—Ä–µ–ø–∏—Ç—å\" - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è.'}\n                      {selectedNode.type === 'delete_message' && ' –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ª–æ–≤–æ–º \"—É–¥–∞–ª–∏—Ç—å\" - —Å–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç—Å—è.'}\n                    </div>\n                  </div>\n\n                  {selectedNode.type === 'pin_message' && (\n                    <div className=\"mt-4\">\n                      <div className=\"flex items-center justify-between p-3 rounded-lg bg-card/50 border border-blue-200/30 dark:border-blue-800/30 hover:border-blue-300 dark:hover:border-blue-700 transition-all duration-200\">\n                        <div className=\"flex-1\">\n                          <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300\">\n                            <i className=\"fas fa-bell-slash mr-1\"></i>\n                            –¢–∏—Ö–æ–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ\n                          </Label>\n                          <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\n                            –ó–∞–∫—Ä–µ–ø–∏—Ç—å –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n                          </div>\n                        </div>\n                        <div className=\"ml-4\">\n                          <Switch\n                            checked={selectedNode.data.disableNotification ?? false}\n                            onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { disableNotification: checked })}\n                          />\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Synonyms Section for Content Management */}\n                <div className=\"bg-gradient-to-br from-green-50/50 to-emerald-50/30 dark:from-green-950/20 dark:to-emerald-950/10 border border-green-200/30 dark:border-green-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-tags text-green-600 dark:text-green-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-green-900 dark:text-green-100\">–°–∏–Ω–æ–Ω–∏–º—ã –∫–æ–º–∞–Ω–¥—ã</Label>\n                  </div>\n                  \n                  <SynonymEditor\n                    synonyms={(() => {\n                      if (!selectedNode.data.synonyms || selectedNode.data.synonyms.length === 0) {\n                        const defaultSynonyms = selectedNode.type === 'pin_message' ? ['–∑–∞–∫—Ä–µ–ø–∏—Ç—å', '–ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å', '–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å'] :\n                                                selectedNode.type === 'unpin_message' ? ['–æ—Ç–∫—Ä–µ–ø–∏—Ç—å', '–æ—Ç—Ü–µ–ø–∏—Ç—å', '—É–±—Ä–∞—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ'] :\n                                                selectedNode.type === 'delete_message' ? ['—É–¥–∞–ª–∏—Ç—å', '—Å—Ç–µ—Ä–µ—Ç—å', '—É–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ'] : [];\n                        if (defaultSynonyms.length > 0) {\n                          setTimeout(() => onNodeUpdate(selectedNode.id, { synonyms: defaultSynonyms }), 0);\n                          return defaultSynonyms;\n                        }\n                      }\n                      return selectedNode.data.synonyms || [];\n                    })()} \n                    onUpdate={(synonyms) => onNodeUpdate(selectedNode.id, { synonyms })}\n                    title=\"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã\"\n                    description={\n                      selectedNode.type === 'pin_message' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è\" :\n                      selectedNode.type === 'unpin_message' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è\" :\n                      selectedNode.type === 'delete_message' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è\" : \n                      \"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è\"\n                    }\n                    placeholder={\n                      selectedNode.type === 'pin_message' ? \"–∑–∞–∫—Ä–µ–ø–∏—Ç—å, –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å\" :\n                      selectedNode.type === 'unpin_message' ? \"–æ—Ç–∫—Ä–µ–ø–∏—Ç—å, –æ—Ç—Ü–µ–ø–∏—Ç—å, —É–±—Ä–∞—Ç—å\" :\n                      selectedNode.type === 'delete_message' ? \"—É–¥–∞–ª–∏—Ç—å, —Å—Ç–µ—Ä–µ—Ç—å, —É–±—Ä–∞—Ç—å\" : \n                      \"–∫–æ–º–∞–Ω–¥–∞1, –∫–æ–º–∞–Ω–¥–∞2, –∫–æ–º–∞–Ω–¥–∞3\"\n                    }\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* User Management Configuration */}\n            {(selectedNode.type === 'ban_user' || selectedNode.type === 'unban_user' || selectedNode.type === 'mute_user' || \n              selectedNode.type === 'unmute_user' || selectedNode.type === 'kick_user' || selectedNode.type === 'promote_user' || \n              selectedNode.type === 'demote_user' || selectedNode.type === 'admin_rights') && (\n              <div className=\"space-y-6\">\n\n                {/* Reason Section (for ban, mute, kick) */}\n                {(selectedNode.type === 'ban_user' || selectedNode.type === 'mute_user' || selectedNode.type === 'kick_user') && (\n                  <div className=\"bg-gradient-to-br from-orange-50/50 to-yellow-50/30 dark:from-orange-950/20 dark:to-yellow-950/10 border border-orange-200/30 dark:border-orange-800/30 rounded-lg p-4\">\n                    <div className=\"flex items-center space-x-2 mb-3\">\n                      <div className=\"w-6 h-6 rounded-full bg-orange-100 dark:bg-orange-900/50 flex items-center justify-center\">\n                        <i className=\"fas fa-clipboard text-orange-600 dark:text-orange-400 text-xs\"></i>\n                      </div>\n                      <Label className=\"text-sm font-semibold text-orange-900 dark:text-orange-100\">–ü—Ä–∏—á–∏–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è</Label>\n                    </div>\n                    \n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        <i className=\"fas fa-comment mr-1\"></i>\n                        –ü—Ä–∏—á–∏–Ω–∞\n                      </Label>\n                      <Input\n                        value={selectedNode.data.reason || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { reason: e.target.value })}\n                        className=\"border-orange-200 dark:border-orange-700 focus:border-orange-500 focus:ring-orange-200\"\n                        placeholder=\"–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≥—Ä—É–ø–ø—ã\"\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {/* Ban Duration Section (for ban_user) */}\n                {selectedNode.type === 'ban_user' && (\n                  <div className=\"bg-gradient-to-br from-purple-50/50 to-indigo-50/30 dark:from-purple-950/20 dark:to-indigo-950/10 border border-purple-200/30 dark:border-purple-800/30 rounded-lg p-4\">\n                    <div className=\"flex items-center space-x-2 mb-3\">\n                      <div className=\"w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center\">\n                        <i className=\"fas fa-clock text-purple-600 dark:text-purple-400 text-xs\"></i>\n                      </div>\n                      <Label className=\"text-sm font-semibold text-purple-900 dark:text-purple-100\">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–Ω–∞</Label>\n                    </div>\n                    \n                    <div>\n                      <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300 mb-2 block\">\n                        <i className=\"fas fa-calendar mr-1\"></i>\n                        –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (Unix timestamp)\n                      </Label>\n                      <Input\n                        type=\"number\"\n                        value={selectedNode.data.untilDate || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { untilDate: parseInt(e.target.value) || 0 })}\n                        className=\"border-purple-200 dark:border-purple-700 focus:border-purple-500 focus:ring-purple-200\"\n                        placeholder=\"0 (–Ω–∞–≤—Å–µ–≥–¥–∞)\"\n                      />\n                      <div className=\"text-xs text-purple-600 dark:text-purple-400 mt-1\">\n                        0 = –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–∞–Ω, –∏–ª–∏ Unix timestamp –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Mute Settings Section (for mute_user) */}\n                {selectedNode.type === 'mute_user' && (\n                  <div className=\"space-y-6\">\n                    {/* Duration */}\n                    <div className=\"bg-gradient-to-br from-indigo-50/50 to-purple-50/30 dark:from-indigo-950/20 dark:to-purple-950/10 border border-indigo-200/30 dark:border-indigo-800/30 rounded-lg p-4\">\n                      <div className=\"flex items-center space-x-2 mb-3\">\n                        <div className=\"w-6 h-6 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center\">\n                          <i className=\"fas fa-hourglass text-indigo-600 dark:text-indigo-400 text-xs\"></i>\n                        </div>\n                        <Label className=\"text-sm font-semibold text-indigo-900 dark:text-indigo-100\">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</Label>\n                      </div>\n                      \n                      <div>\n                        <Label className=\"text-xs font-medium text-indigo-700 dark:text-indigo-300 mb-2 block\">\n                          <i className=\"fas fa-timer mr-1\"></i>\n                          –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫—É–Ω–¥—ã)\n                        </Label>\n                        <Input\n                          type=\"number\"\n                          value={selectedNode.data.muteDuration || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { muteDuration: parseInt(e.target.value) || 3600 })}\n                          className=\"border-indigo-200 dark:border-indigo-700 focus:border-indigo-500 focus:ring-indigo-200\"\n                          placeholder=\"3600\"\n                        />\n                        <div className=\"text-xs text-indigo-600 dark:text-indigo-400 mt-1\">\n                          –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥ (3600 = 1 —á–∞—Å)\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Permissions */}\n                    <div className=\"bg-gradient-to-br from-slate-50/50 to-gray-50/30 dark:from-slate-950/20 dark:to-gray-950/10 border border-slate-200/30 dark:border-slate-800/30 rounded-lg p-4\">\n                      <div className=\"flex items-center space-x-2 mb-3\">\n                        <div className=\"w-6 h-6 rounded-full bg-slate-100 dark:bg-slate-900/50 flex items-center justify-center\">\n                          <i className=\"fas fa-ban text-slate-600 dark:text-slate-400 text-xs\"></i>\n                        </div>\n                        <Label className=\"text-sm font-semibold text-slate-900 dark:text-slate-100\">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</Label>\n                      </div>\n                      \n                      <div className=\"grid grid-cols-1 gap-3\">\n                        {[\n                          { key: 'canSendMessages', label: '–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è', icon: 'fas fa-comment' },\n                          { key: 'canSendMediaMessages', label: '–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–µ–¥–∏–∞', icon: 'fas fa-image' },\n                          { key: 'canSendPolls', label: '–°–æ–∑–¥–∞–≤–∞—Ç—å –æ–ø—Ä–æ—Å—ã', icon: 'fas fa-poll' },\n                          { key: 'canSendOtherMessages', label: '–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∏–∫–µ—Ä—ã/GIF', icon: 'fas fa-laugh' },\n                          { key: 'canAddWebPagePreviews', label: '–î–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫', icon: 'fas fa-link' },\n                          { key: 'canChangeGroupInfo', label: '–ò–∑–º–µ–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≥—Ä—É–ø–ø—ã', icon: 'fas fa-edit' },\n                          { key: 'canInviteUsers2', label: '–ü—Ä–∏–≥–ª–∞—à–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', icon: 'fas fa-user-plus' },\n                          { key: 'canPinMessages2', label: '–ó–∞–∫—Ä–µ–ø–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è', icon: 'fas fa-thumbtack' }\n                        ].map(({ key, label, icon }) => (\n                          <div key={key} className=\"flex items-center justify-between p-2 rounded-lg bg-card/50 border border-slate-200/30 dark:border-slate-800/30\">\n                            <div className=\"flex items-center space-x-2\">\n                              <i className={`${icon} text-slate-600 dark:text-slate-400 text-xs`}></i>\n                              <Label className=\"text-xs text-slate-700 dark:text-slate-300\">{label}</Label>\n                            </div>\n                            <Switch\n                              checked={(selectedNode.data as any)[key] ?? false}\n                              onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { [key]: checked } as any)}\n                            />\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Promote Settings Section (for promote_user) */}\n                {selectedNode.type === 'promote_user' && (\n                  <div className=\"bg-gradient-to-br from-yellow-50/50 to-amber-50/30 dark:from-yellow-950/20 dark:to-amber-950/10 border border-yellow-200/30 dark:border-yellow-800/30 rounded-lg p-4\">\n                    <div className=\"flex items-center space-x-2 mb-3\">\n                      <div className=\"w-6 h-6 rounded-full bg-yellow-100 dark:bg-yellow-900/50 flex items-center justify-center\">\n                        <i className=\"fas fa-crown text-yellow-600 dark:text-yellow-400 text-xs\"></i>\n                      </div>\n                      <Label className=\"text-sm font-semibold text-yellow-900 dark:text-yellow-100\">–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</Label>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-1 gap-3\">\n                      {[\n                        { key: 'canChangeInfo', label: '–ò–∑–º–µ–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≥—Ä—É–ø–ø—ã', icon: 'fas fa-edit' },\n                        { key: 'canDeleteMessages', label: '–£–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è', icon: 'fas fa-trash' },\n                        { key: 'canBanUsers', label: '–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', icon: 'fas fa-ban' },\n                        { key: 'canInviteUsers', label: '–ü—Ä–∏–≥–ª–∞—à–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', icon: 'fas fa-user-plus' },\n                        { key: 'canPinMessages', label: '–ó–∞–∫—Ä–µ–ø–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è', icon: 'fas fa-thumbtack' },\n                        { key: 'canAddAdmins', label: '–î–æ–±–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤', icon: 'fas fa-user-shield' },\n                        { key: 'canRestrictMembers', label: '–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤', icon: 'fas fa-user-lock' },\n                        { key: 'canPromoteMembers', label: '–ü–æ–≤—ã—à–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤', icon: 'fas fa-arrow-up' },\n                        { key: 'canManageVideoChats', label: '–£–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∞–º–∏', icon: 'fas fa-video' },\n                        // { key: 'canManageTopics', label: '–£–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–º–∞–º–∏', icon: 'fas fa-tags' }, // –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ–±—ã—á–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö\n                        { key: 'isAnonymous', label: '–ê–Ω–æ–Ω–∏–º–Ω—ã–π –∞–¥–º–∏–Ω', icon: 'fas fa-user-secret' }\n                      ].map(({ key, label, icon }) => (\n                        <div key={key} className=\"flex items-center justify-between p-2 rounded-lg bg-card/50 border border-yellow-200/30 dark:border-yellow-800/30\">\n                          <div className=\"flex items-center space-x-2\">\n                            <i className={`${icon} text-yellow-600 dark:text-yellow-400 text-xs`}></i>\n                            <Label className=\"text-xs text-yellow-700 dark:text-yellow-300\">{label}</Label>\n                          </div>\n                          <Switch\n                            checked={(selectedNode.data as any)[key] ?? (key === 'canDeleteMessages' || key === 'canInviteUsers' || key === 'canPinMessages' ? true : false)}\n                            onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { [key]: checked } as any)}\n                          />\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Synonyms Section for User Management */}\n                <div className=\"bg-gradient-to-br from-green-50/50 to-emerald-50/30 dark:from-green-950/20 dark:to-emerald-950/10 border border-green-200/30 dark:border-green-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-tags text-green-600 dark:text-green-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-green-900 dark:text-green-100\">–°–∏–Ω–æ–Ω–∏–º—ã –∫–æ–º–∞–Ω–¥—ã</Label>\n                  </div>\n                  \n                  <SynonymEditor\n                    synonyms={(() => {\n                      if (!selectedNode.data.synonyms || selectedNode.data.synonyms.length === 0) {\n                        const defaultSynonyms = selectedNode.type === 'ban_user' ? ['–∑–∞–±–∞–Ω–∏—Ç—å', '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å', '–±–∞–Ω'] :\n                                                selectedNode.type === 'unban_user' ? ['—Ä–∞–∑–±–∞–Ω–∏—Ç—å', '—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å', 'unb–∞–Ω'] :\n                                                selectedNode.type === 'mute_user' ? ['–∑–∞–º—É—Ç–∏—Ç—å', '–∑–∞–≥–ª—É—à–∏—Ç—å', '–º—É—Ç'] :\n                                                selectedNode.type === 'unmute_user' ? ['—Ä–∞–∑–º—É—Ç–∏—Ç—å', '—Ä–∞–∑–≥–ª—É—à–∏—Ç—å', '–∞–Ω–º—É—Ç'] :\n                                                selectedNode.type === 'kick_user' ? ['–∫–∏–∫–Ω—É—Ç—å', '–∏—Å–∫–ª—é—á–∏—Ç—å', '–≤—ã–≥–Ω–∞—Ç—å'] :\n                                                selectedNode.type === 'promote_user' ? ['–ø–æ–≤—ã—Å–∏—Ç—å', '–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º', '–ø—Ä–æ–º–æ—É—Ç'] :\n                                                selectedNode.type === 'demote_user' ? ['–ø–æ–Ω–∏–∑–∏—Ç—å', '—Å–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∫–∏', '–¥–µ–º–æ—É—Ç'] :\n                                                selectedNode.type === 'admin_rights' ? ['–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞', '–∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞', '–∞–¥–º–∏–Ω –ø—Ä–∞–≤–∞', '—Ç–≥ –ø—Ä–∞–≤–∞', '–ø—Ä–∞–≤–∞'] : [];\n                        if (defaultSynonyms.length > 0) {\n                          setTimeout(() => onNodeUpdate(selectedNode.id, { synonyms: defaultSynonyms }), 0);\n                          return defaultSynonyms;\n                        }\n                      }\n                      return selectedNode.data.synonyms || [];\n                    })()} \n                    onUpdate={(synonyms) => onNodeUpdate(selectedNode.id, { synonyms })}\n                    title=\"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã\"\n                    description={\n                      selectedNode.type === 'ban_user' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\" :\n                      selectedNode.type === 'unban_user' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\" :\n                      selectedNode.type === 'mute_user' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\" :\n                      selectedNode.type === 'unmute_user' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–Ω—è—Ç–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π\" :\n                      selectedNode.type === 'kick_user' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\" :\n                      selectedNode.type === 'promote_user' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\" :\n                      selectedNode.type === 'demote_user' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–Ω—è—Ç–∏—è —Å –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\" :\n                      selectedNode.type === 'admin_rights' ? \"–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\" : \n                      \"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è\"\n                    }\n                    placeholder={\n                      selectedNode.type === 'ban_user' ? \"–∑–∞–±–∞–Ω–∏—Ç—å, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, –±–∞–Ω\" :\n                      selectedNode.type === 'unban_user' ? \"—Ä–∞–∑–±–∞–Ω–∏—Ç—å, —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, unb–∞–Ω\" :\n                      selectedNode.type === 'mute_user' ? \"–∑–∞–º—É—Ç–∏—Ç—å, –∑–∞–≥–ª—É—à–∏—Ç—å, –º—É—Ç\" :\n                      selectedNode.type === 'unmute_user' ? \"—Ä–∞–∑–º—É—Ç–∏—Ç—å, —Ä–∞–∑–≥–ª—É—à–∏—Ç—å, –∞–Ω–º—É—Ç\" :\n                      selectedNode.type === 'kick_user' ? \"–∫–∏–∫–Ω—É—Ç—å, –∏—Å–∫–ª—é—á–∏—Ç—å, –≤—ã–≥–Ω–∞—Ç—å\" :\n                      selectedNode.type === 'promote_user' ? \"–ø–æ–≤—ã—Å–∏—Ç—å, –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º, –ø—Ä–æ–º–æ—É—Ç\" :\n                      selectedNode.type === 'demote_user' ? \"–ø–æ–Ω–∏–∑–∏—Ç—å, —Å–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∫–∏, –¥–µ–º–æ—É—Ç\" :\n                      selectedNode.type === 'admin_rights' ? \"–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞, –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞, –∞–¥–º–∏–Ω –ø—Ä–∞–≤–∞, —Ç–≥ –ø—Ä–∞–≤–∞, –ø—Ä–∞–≤–∞\" : \n                      \"–∫–æ–º–∞–Ω–¥–∞1, –∫–æ–º–∞–Ω–¥–∞2, –∫–æ–º–∞–Ω–¥–∞3\"\n                    }\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* Admin Rights Configuration */}\n            {selectedNode.type === 'admin_rights' && (\n              <div className=\"space-y-6\">\n                {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ */}\n                <div className=\"bg-gradient-to-br from-violet-50/50 to-purple-50/30 dark:from-violet-950/20 dark:to-purple-950/10 border border-violet-200/30 dark:border-violet-800/30 rounded-lg p-4\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-violet-100 dark:bg-violet-900/50 flex items-center justify-center\">\n                      <i className=\"fas fa-user-shield text-violet-600 dark:text-violet-400 text-xs\"></i>\n                    </div>\n                    <Label className=\"text-sm font-semibold text-violet-900 dark:text-violet-100\">–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</Label>\n                  </div>\n                  \n                  <div className=\"space-y-3\">\n                    <div className=\"text-sm text-violet-800 dark:text-violet-200\">\n                      –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å 11 –∏–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞–º–∏, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–º–∏ —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:\n                    </div>\n                    \n                    <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üè∑Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üì® –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üìå –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üé• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ—á–∞—Ç–∞–º–∏</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üì∞ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–π</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–π</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–π</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üîí –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å</div>\n                      <div className=\"text-violet-600 dark:text-violet-400\">‚Ä¢ üëë –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</div>\n                    </div>\n                    \n                    <div className=\"mt-3 p-3 bg-violet-100/50 dark:bg-violet-900/20 rounded-lg border border-violet-200 dark:border-violet-700\">\n                      <div className=\"text-xs text-violet-700 dark:text-violet-300 font-medium mb-1\">\n                        üí° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞:\n                      </div>\n                      <div className=\"text-xs text-violet-600 dark:text-violet-400\">\n                        ‚Ä¢ –ü—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –ø—Ä–∞–≤–∞ —Ç–æ–≥–æ, –∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ<br/>\n                        ‚Ä¢ –ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ (@username) ‚Äî –ø—Ä–∞–≤–∞ —É–ø–æ–º—è–Ω—É—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br/>\n                        ‚Ä¢ –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ ID –≤ –∫–æ–º–∞–Ω–¥—É ‚Äî –ø—Ä–∞–≤–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                \n              </div>\n            )}\n\n          </div>\n        </div>\n\n        {/* Message Content */}\n        <div>\n          <div className=\"space-y-4\">\n            {/* Inline Rich Text Editor */}\n            <div className=\"space-y-3\">\n              <div>\n                <Label className=\"text-xs font-medium text-muted-foreground mb-2 block\">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</Label>\n                <InlineRichEditor\n                  value={selectedNode.data.messageText || ''}\n                  onChange={(value) => onNodeUpdate(selectedNode.id, { messageText: value })}\n                  placeholder=\"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è...\"\n                  enableMarkdown={selectedNode.data.markdown}\n                  onMarkdownToggle={(enabled) => onNodeUpdate(selectedNode.id, { markdown: enabled })}\n                  onFormatModeChange={(formatMode) => onNodeUpdate(selectedNode.id, { formatMode })}\n                  availableVariables={availableVariables}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Synonyms - —Ç–æ–ª—å–∫–æ –¥–ª—è —É–∑–ª–æ–≤ –∫—Ä–æ–º–µ –∫–æ–º–∞–Ω–¥, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ */}\n        {selectedNode.type !== 'start' && selectedNode.type !== 'command' && \n         selectedNode.type !== 'pin_message' && selectedNode.type !== 'unpin_message' && selectedNode.type !== 'delete_message' &&\n         selectedNode.type !== 'ban_user' && selectedNode.type !== 'unban_user' && selectedNode.type !== 'mute_user' && \n         selectedNode.type !== 'unmute_user' && selectedNode.type !== 'kick_user' && selectedNode.type !== 'promote_user' && \n         selectedNode.type !== 'demote_user' && selectedNode.type !== 'admin_rights' && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">–°–∏–Ω–æ–Ω–∏–º—ã</h3>\n            <div className=\"space-y-4\">\n              <SynonymEditor\n                synonyms={selectedNode.data.synonyms || []}\n                onUpdate={(synonyms) => onNodeUpdate(selectedNode.id, { synonyms })}\n                title=\"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã\"\n                description=\"–î–æ–±–∞–≤—å—Ç–µ —Å–ª–æ–≤–∞ –∏–ª–∏ —Ñ—Ä–∞–∑—ã, –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç—Ç–æ—Ç —É–∑–µ–ª\"\n                placeholder=\"–∏–º—è, –ø—Ä–æ—Ñ–∏–ª—å, –∞–Ω–∫–µ—Ç–∞...\"\n              />\n            </div>\n          </div>\n        )}\n\n        {/* Keyboard Settings */}\n        <div>\n          <h3 className=\"text-sm font-medium text-foreground mb-3\">–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞</h3>\n          <div className=\"space-y-4\">\n            <div>\n              <Label className=\"text-xs font-medium text-muted-foreground\">–¢–∏–ø –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</Label>\n              <Select\n                value={selectedNode.data.keyboardType}\n                onValueChange={(value: 'reply' | 'inline' | 'none') => \n                  onNodeUpdate(selectedNode.id, { keyboardType: value })\n                }\n              >\n                <SelectTrigger className=\"mt-2\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"reply\">Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞</SelectItem>\n                  <SelectItem value=\"inline\">Inline –∫–Ω–æ–ø–∫–∏</SelectItem>\n                  <SelectItem value=\"none\">–ë–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Multiple Selection Setting */}\n            {selectedNode.data.keyboardType !== 'none' && (\n              <div className=\"flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-primary/30 hover:bg-card/80 transition-all duration-200\">\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs font-medium text-foreground\">\n                    –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä\n                  </Label>\n                  <div className=\"text-xs text-muted-foreground mt-1\">\n                    {selectedNode.data.keyboardType === 'inline' \n                      ? '–ö–Ω–æ–ø–∫–∏ –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∫ –¥—Ä—É–≥–æ–º—É —É–∑–ª—É, –∞ –æ—Ç–º–µ—á–∞—é—Ç—Å—è –≥–∞–ª–æ—á–∫–æ–π'\n                      : '–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π'\n                    }\n                  </div>\n                </div>\n                <div className=\"ml-4\">\n                  <Switch\n                    checked={selectedNode.data.allowMultipleSelection ?? false}\n                    onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { allowMultipleSelection: checked })}\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* Multiple Selection Settings */}\n            {selectedNode.data.keyboardType !== 'none' && selectedNode.data.allowMultipleSelection && (\n              <div className=\"space-y-4\">\n                {/* Variable Name for Saving Multiple Selection */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-xs font-medium text-muted-foreground\">–ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞</Label>\n                  <Input\n                    value={selectedNode.data.multiSelectVariable || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { multiSelectVariable: e.target.value })}\n                    className=\"text-xs\"\n                    placeholder=\"–≤—ã–±—Ä–∞–Ω–Ω—ã–µ_–æ–ø—Ü–∏–∏\"\n                  />\n                  <div className=\"text-xs text-muted-foreground\">\n                    –í—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.\n                    <br />\n                    <span className=\"text-amber-600 dark:text-amber-400\">‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–º—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–∑ \"‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤\"</span>\n                  </div>\n                </div>\n                \n\n              </div>\n            )}\n\n            {/* Buttons List */}\n            {selectedNode.data.keyboardType !== 'none' && (\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <Label className=\"text-xs font-medium text-muted-foreground\">\n                    –ö–Ω–æ–ø–∫–∏\n                  </Label>\n                  <div className=\"flex gap-2\">\n                    <UIButton\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={handleAddButton}\n                      className=\"text-xs text-primary hover:text-primary/80 font-medium h-auto p-1\"\n                    >\n                      + –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É\n                    </UIButton>\n                    {selectedNode.data.allowMultipleSelection && (\n                      <>\n                        <UIButton\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => {\n                            const newButton = {\n                              id: Date.now().toString(),\n                              text: '–ù–æ–≤–∞—è –æ–ø—Ü–∏—è',\n                              action: 'selection' as const,\n                              target: '',\n                              buttonType: 'option' as const,\n                              skipDataCollection: false\n                            };\n                            \n                            const currentButtons = selectedNode.data.buttons || [];\n                            const updatedButtons = [...currentButtons, newButton];\n                            onNodeUpdate(selectedNode.id, { buttons: updatedButtons });\n                          }}\n                          className=\"text-xs text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 font-medium h-auto p-1\"\n                        >\n                          + –û–ø—Ü–∏—è\n                        </UIButton>\n                        <UIButton\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => {\n                            const newButton = {\n                              id: Date.now().toString(),\n                              text: '–ì–æ—Ç–æ–≤–æ',\n                              action: 'goto' as const,\n                              target: '',\n                              buttonType: 'complete' as const,\n                              skipDataCollection: false\n                            };\n                            \n                            const currentButtons = selectedNode.data.buttons || [];\n                            const updatedButtons = [...currentButtons, newButton];\n                            onNodeUpdate(selectedNode.id, { buttons: updatedButtons });\n                          }}\n                          className=\"text-xs text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 font-medium h-auto p-1\"\n                        >\n                          + –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ\n                        </UIButton>\n                      </>\n                    )}\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  {/* Show Continue Button for Multiple Selection */}\n                  {selectedNode.data.allowMultipleSelection && (\n                    <div className=\"bg-muted/50 rounded-lg p-3\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <Input\n                          value={selectedNode.data.continueButtonText || '–ì–æ—Ç–æ–≤–æ'}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { continueButtonText: e.target.value })}\n                          className=\"flex-1 text-sm font-medium bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-primary\"\n                          placeholder=\"–ì–æ—Ç–æ–≤–æ\"\n                        />\n                        <div className=\"flex items-center gap-2\">\n                          {/* Button Type Indicator */}\n                          <div className=\"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-1 rounded text-xs font-medium\">\n                            –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ\n                          </div>\n                          <button\n                            onClick={() => {\n                              // No delete action for auto-generated button, just show info\n                              toast({\n                                title: \"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–Ω–æ–ø–∫–∞\",\n                                description: \"–≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞\",\n                              });\n                            }}\n                            className=\"text-xs text-muted-foreground hover:text-destructive p-1\"\n                          >\n                            <i className=\"fas fa-info-circle\"></i>\n                          </button>\n                        </div>\n                      </div>\n\n                      {/* Button Type Selection - Disabled for continue button */}\n                      <div className=\"mb-2\">\n                        <Label className=\"text-xs font-medium text-muted-foreground mb-1\">–¢–∏–ø –∫–Ω–æ–ø–∫–∏</Label>\n                        <Select value=\"complete\" disabled>\n                          <SelectTrigger className=\"text-xs opacity-60\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"complete\">–ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <div className=\"text-xs text-muted-foreground mt-1\">\n                          –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç–∫—Ä–∞–Ω—É\n                        </div>\n                      </div>\n\n                      {/* Continue Button Target */}\n                      <div className=\"space-y-2\">\n                        <Label className=\"text-xs font-medium text-muted-foreground\">–í—ã–±–µ—Ä–∏—Ç–µ —ç–∫—Ä–∞–Ω</Label>\n                        <Select\n                          value={selectedNode.data.continueButtonTarget || 'none'}\n                          onValueChange={(value) => onNodeUpdate(selectedNode.id, { continueButtonTarget: value === 'none' ? '' : value })}\n                        >\n                          <SelectTrigger className=\"text-xs\">\n                            <SelectValue placeholder=\"–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ ID –≤—Ä—É—á–Ω—É—é\" />\n                          </SelectTrigger>\n                          <SelectContent className=\"max-h-48 overflow-y-auto\">\n                            <SelectItem value=\"none\">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</SelectItem>\n                            {getAllNodesFromAllSheets\n                              .filter(n => n.node.id !== selectedNode.id)\n                              .map(({node, sheetName}) => (\n                                <SelectItem key={node.id} value={node.id}>\n                                  <div className=\"flex items-center space-x-2\">\n                                    <i className={`${nodeIcons[node.type]} text-xs`}></i>\n                                    <span className=\"truncate\">{node.id}</span>\n                                    <span className=\"text-muted-foreground text-xs\">({nodeTypeNames[node.type]})</span>\n                                    <span className=\"text-xs text-blue-600 dark:text-blue-400\">({sheetName})</span>\n                                  </div>\n                                </SelectItem>\n                              ))\n                            }\n                          </SelectContent>\n                        </Select>\n                        <Input\n                          value={selectedNode.data.continueButtonTarget || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { continueButtonTarget: e.target.value })}\n                          className=\"text-xs\"\n                          placeholder=\"–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ ID –≤—Ä—É—á–Ω—É—é\"\n                        />\n                      </div>\n                    </div>\n                  )}\n                  \n                  {(selectedNode.data.buttons || []).map((button) => (\n                    <div key={button.id} className=\"bg-muted/50 rounded-lg p-3\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <Input\n                          value={button.text}\n                          onChange={(e) => onButtonUpdate(selectedNode.id, button.id, { text: e.target.value })}\n                          className=\"flex-1 text-sm font-medium bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-primary\"\n                          placeholder=\"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏\"\n                        />\n                        <div className=\"flex items-center gap-2\">\n                          {/* Button Type Indicator */}\n                          {selectedNode.data.allowMultipleSelection && (\n                            <>\n                              {button.buttonType === 'option' && (\n                                <div className=\"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded text-xs font-medium\">\n                                  –û–ø—Ü–∏—è\n                                </div>\n                              )}\n                              {button.buttonType === 'complete' && (\n                                <div className=\"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-1 rounded text-xs font-medium\">\n                                  –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ\n                                </div>\n                              )}\n                              {button.buttonType === 'normal' && (\n                                <div className=\"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded text-xs font-medium\">\n                                  –û–±—ã—á–Ω–∞—è\n                                </div>\n                              )}\n                            </>\n                          )}\n                          <UIButton\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => onButtonDelete(selectedNode.id, button.id)}\n                            className=\"text-muted-foreground hover:text-destructive dark:text-muted-foreground dark:hover:text-destructive h-auto p-1 transition-colors duration-200\"\n                          >\n                            <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                              <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                            </svg>\n                          </UIButton>\n                        </div>\n                      </div>\n                      \n                      {/* Button Type Selection - Show for Multiple Selection Mode */}\n                      {selectedNode.data.allowMultipleSelection && (\n                        <div className=\"mb-3\">\n                          <Label className=\"text-xs font-medium text-muted-foreground mb-2 block\">–¢–∏–ø –∫–Ω–æ–ø–∫–∏</Label>\n                          <Select\n                            value={button.buttonType || 'normal'}\n                            onValueChange={(value: 'normal' | 'option' | 'complete') => {\n                              if (value === 'option') {\n                                onButtonUpdate(selectedNode.id, button.id, { \n                                  buttonType: 'option', \n                                  action: 'selection', \n                                  target: '' \n                                });\n                              } else if (value === 'complete') {\n                                onButtonUpdate(selectedNode.id, button.id, { \n                                  buttonType: 'complete', \n                                  action: 'goto', \n                                  target: selectedNode.data.continueButtonTarget || '' \n                                });\n                              } else {\n                                onButtonUpdate(selectedNode.id, button.id, { \n                                  buttonType: 'normal', \n                                  action: 'goto', \n                                  target: '' \n                                });\n                              }\n                            }}\n                          >\n                            <SelectTrigger className=\"w-full text-xs\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"normal\">\n                                <div className=\"flex items-center gap-2\">\n                                  <div className=\"w-2 h-2 rounded-full bg-blue-500\"></div>\n                                  <span>–û–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞</span>\n                                </div>\n                              </SelectItem>\n                              <SelectItem value=\"option\">\n                                <div className=\"flex items-center gap-2\">\n                                  <div className=\"w-2 h-2 rounded-full bg-green-500\"></div>\n                                  <span>–û–ø—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞</span>\n                                </div>\n                              </SelectItem>\n                              <SelectItem value=\"complete\">\n                                <div className=\"flex items-center gap-2\">\n                                  <div className=\"w-2 h-2 rounded-full bg-purple-500\"></div>\n                                  <span>–ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</span>\n                                </div>\n                              </SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      )}\n                      {/* Action Selection - Show for normal buttons or non-multiple-selection modes */}\n                      {(!selectedNode.data.allowMultipleSelection || (button.buttonType !== 'option' && button.buttonType !== 'complete')) && (\n                        <Select\n                          value={button.action}\n                          onValueChange={(value: 'goto' | 'command' | 'url' | 'selection') =>\n                            onButtonUpdate(selectedNode.id, button.id, { action: value })\n                          }\n                        >\n                          <SelectTrigger className=\"w-full text-xs\">\n                            <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"goto\">–ü–µ—Ä–µ–π—Ç–∏ –∫ —ç–∫—Ä–∞–Ω—É</SelectItem>\n                            <SelectItem value=\"command\">–í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</SelectItem>\n                            <SelectItem value=\"url\">–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É</SelectItem>\n                            <SelectItem value=\"selection\">–í—ã–±–æ—Ä –æ–ø—Ü–∏–∏</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      )}\n\n                      {/* Skip Data Collection Toggle - Only show when collectUserInput is enabled */}\n                      {selectedNode.data.collectUserInput && (\n                        <div className=\"flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-primary/30 hover:bg-card/80 transition-all duration-200 mt-3\">\n                          <div className=\"flex-1\">\n                            <Label className=\"text-xs font-medium text-foreground\">\n                              –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ç–≤–µ—Ç—ã\n                            </Label>\n                            <div className=\"text-xs text-muted-foreground mt-1\">\n                              –ö–Ω–æ–ø–∫–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –±–µ–∑ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n                            </div>\n                          </div>\n                          <div className=\"ml-4\">\n                            <Switch\n                              checked={button.skipDataCollection ?? false}\n                              onCheckedChange={(checked) => \n                                onButtonUpdate(selectedNode.id, button.id, { skipDataCollection: checked })\n                              }\n                            />\n                          </div>\n                        </div>\n                      )}\n                      \n                      {/* Button Type Info Blocks */}\n                      {selectedNode.data.allowMultipleSelection && (\n                        <>\n                          {/* Option Button Info */}\n                          {button.buttonType === 'option' && (\n                            <div className=\"bg-green-50/50 dark:bg-green-950/20 border border-green-200/40 dark:border-green-800/40 rounded-lg p-2 mt-2 space-y-2\">\n                              <div className=\"text-xs text-green-700 dark:text-green-300 font-medium\">\n                                –û–ø—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞\n                              </div>\n                              <div className=\"text-xs text-green-600 dark:text-green-400\">\n                                {selectedNode.data.keyboardType === 'inline' \n                                  ? `–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–æ—è–≤–∏—Ç—Å—è –æ—Ç–º–µ—Ç–∫–∞ ${selectedNode.data.checkmarkSymbol || '‚úÖ'}`\n                                  : '–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–∫–∞–∂–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞'\n                                }\n                              </div>\n                              \n                              {/* Checkmark Symbol Input */}\n                              {selectedNode.data.keyboardType === 'inline' && (\n                                <div className=\"space-y-1\">\n                                  <Label className=\"text-xs font-medium text-green-700 dark:text-green-300\">–°–∏–º–≤–æ–ª –æ—Ç–º–µ—Ç–∫–∏</Label>\n                                  <Input\n                                    value={selectedNode.data.checkmarkSymbol || '‚úÖ'}\n                                    onChange={(e) => onNodeUpdate(selectedNode.id, { checkmarkSymbol: e.target.value })}\n                                    className=\"text-xs bg-white dark:bg-green-950/30 border-green-300 dark:border-green-700\"\n                                    placeholder=\"‚úÖ\"\n                                    maxLength={3}\n                                  />\n                                </div>\n                              )}\n                            </div>\n                          )}\n                          \n                          {/* Complete Button Info */}\n                          {button.buttonType === 'complete' && (\n                            <div className=\"bg-purple-50/50 dark:bg-purple-950/20 border border-purple-200/40 dark:border-purple-800/40 rounded-lg p-2 mt-2\">\n                              <div className=\"text-xs text-purple-700 dark:text-purple-300 font-medium\">\n                                –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è\n                              </div>\n                              <div className=\"text-xs text-purple-600 dark:text-purple-400 mt-1\">\n                                –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç–∫—Ä–∞–Ω—É\n                              </div>\n                            </div>\n                          )}\n                          \n                          {/* Normal Button Info */}\n                          {button.buttonType === 'normal' && (\n                            <div className=\"bg-blue-50/50 dark:bg-blue-950/20 border border-blue-200/40 dark:border-blue-800/40 rounded-lg p-2 mt-2\">\n                              <div className=\"text-xs text-blue-700 dark:text-blue-300 font-medium\">\n                                –û–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞\n                              </div>\n                              <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\n                                –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞\n                              </div>\n                            </div>\n                          )}\n                        </>\n                      )}\n                      \n                      {(!selectedNode.data.allowMultipleSelection || button.action !== 'selection') && button.action === 'url' && (\n                        <Input\n                          value={button.url || ''}\n                          onChange={(e) => onButtonUpdate(selectedNode.id, button.id, { url: e.target.value })}\n                          className=\"mt-2 text-xs\"\n                          placeholder=\"https://example.com\"\n                        />\n                      )}\n                      \n                      {(!selectedNode.data.allowMultipleSelection || button.action !== 'selection') && button.action === 'command' && (\n                        <div className=\"mt-2 space-y-2\">\n                          <Select\n                            value={button.target || ''}\n                            onValueChange={(value) => onButtonUpdate(selectedNode.id, button.id, { target: value })}\n                          >\n                            <SelectTrigger className=\"text-xs\">\n                              <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {allNodes\n                                .filter(node => (node.type === 'start' || node.type === 'command') && node.data.command)\n                                .map((node) => (\n                                  <SelectItem key={node.id} value={node.data.command!}>\n                                    <div className=\"flex items-center space-x-2\">\n                                      <i className={`${node.type === 'start' ? 'fas fa-play' : 'fas fa-terminal'} text-xs`}></i>\n                                      <span>{node.data.command}</span>\n                                      {node.data.description && (\n                                        <span className=\"text-gray-500\">- {node.data.description}</span>\n                                      )}\n                                    </div>\n                                  </SelectItem>\n                                ))}\n                              {STANDARD_COMMANDS.map((cmd) => (\n                                <SelectItem key={cmd.command} value={cmd.command}>\n                                  <div className=\"flex items-center space-x-2\">\n                                    <i className=\"fas fa-lightbulb text-yellow-500 text-xs\"></i>\n                                    <span>{cmd.command}</span>\n                                    <span className=\"text-gray-500\">- {cmd.description}</span>\n                                  </div>\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          \n                          <Input\n                            value={button.target || ''}\n                            onChange={(e) => onButtonUpdate(selectedNode.id, button.id, { target: e.target.value })}\n                            className=\"text-xs\"\n                            placeholder=\"–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤—Ä—É—á–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: /help)\"\n                          />\n                          \n                          {button.target && !button.target.startsWith('/') && (\n                            <div className=\"flex items-center text-xs text-warning-foreground bg-warning/10 dark:bg-warning/5 border border-warning/20 dark:border-warning/10 p-2 rounded-md\">\n                              <svg className=\"w-3 h-3 mr-2 text-warning\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <span>–ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —Å–∏–º–≤–æ–ª–∞ \"/\"</span>\n                            </div>\n                          )}\n                        </div>\n                      )}\n\n                      {(!selectedNode.data.allowMultipleSelection || button.action !== 'selection') && button.action === 'goto' && (\n                        <div className=\"mt-2 space-y-2\">\n                          <Select\n                            value={button.target || ''}\n                            onValueChange={(value) => onButtonUpdate(selectedNode.id, button.id, { target: value })}\n                          >\n                            <SelectTrigger className=\"text-xs\">\n                              <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ —ç–∫—Ä–∞–Ω\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {getAllNodesFromAllSheets\n                                .filter(n => n.node.id !== selectedNode.id)\n                                .map(({node, sheetName}) => {\n                                  const nodeName = \n                                    node.type === 'start' ? node.data.command :\n                                    node.type === 'command' ? node.data.command :\n                                    node.type === 'message' ? '–°–æ–æ–±—â–µ–Ω–∏–µ' :\n                                    node.type === 'photo' ? '–§–æ—Ç–æ' :\n                                    node.type === 'keyboard' ? '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞' :\n                                    node.type === 'condition' ? '–£—Å–ª–æ–≤–∏–µ' :\n                                    '–£–∑–µ–ª';\n                                  \n                                  return (\n                                    <SelectItem key={node.id} value={node.id}>\n                                      <div className=\"flex items-center gap-2\">\n                                        <span>{nodeName} ({node.id})</span>\n                                        <span className=\"text-xs text-blue-600 dark:text-blue-400\">({sheetName})</span>\n                                      </div>\n                                    </SelectItem>\n                                  );\n                                })}\n                              {getAllNodesFromAllSheets.filter(n => n.node.id !== selectedNode.id).length === 0 && (\n                                <SelectItem value=\"no-nodes\" disabled>\n                                  –°–æ–∑–¥–∞–π—Ç–µ –¥—Ä—É–≥–∏–µ —ç–∫—Ä–∞–Ω—ã –¥–ª—è –≤—ã–±–æ—Ä–∞\n                                </SelectItem>\n                              )}\n                            </SelectContent>\n                          </Select>\n                          \n                          <Input\n                            value={button.target || ''}\n                            onChange={(e) => onButtonUpdate(selectedNode.id, button.id, { target: e.target.value })}\n                            className=\"text-xs\"\n                            placeholder=\"–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ ID –≤—Ä—É—á–Ω—É—é\"\n                          />\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Conditional Messages */}\n        {(selectedNode.type === 'start' || selectedNode.type === 'command' || selectedNode.type === 'message' || selectedNode.type === 'keyboard') && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">üîÑ –£—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>\n            <div className=\"space-y-4\">\n              {/* Enable Conditional Messages */}\n              <div className=\"flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-primary/30 hover:bg-card/80 transition-all duration-200\">\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs font-medium text-foreground\">\n                    –í–∫–ª—é—á–∏—Ç—å —É—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n                  </Label>\n                  <div className=\"text-xs text-muted-foreground mt-1\">\n                    –†–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –æ—Ç–≤–µ—á–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã\n                  </div>\n                </div>\n                <div className=\"ml-4\">\n                  <Switch\n                    checked={selectedNode.data.enableConditionalMessages ?? false}\n                    onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { enableConditionalMessages: checked })}\n                  />\n                </div>\n              </div>\n\n              {/* Conditional Messages Settings */}\n              {selectedNode.data.enableConditionalMessages && (\n                <div className=\"space-y-4 bg-gradient-to-br from-purple-50/50 to-indigo-50/30 dark:from-purple-950/20 dark:to-indigo-950/10 border border-purple-200/30 dark:border-purple-800/30 rounded-lg p-4\">\n                  \n                  {/* Information Block */}\n                  <div className=\"bg-blue-50/70 dark:bg-blue-950/30 border border-blue-200/40 dark:border-blue-800/40 rounded-lg p-3\">\n                    <div className=\"flex items-start space-x-2\">\n                      <div className=\"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5\">\n                        <i className=\"fas fa-info text-white text-xs\"></i>\n                      </div>\n                      <div>\n                        <div className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">\n                          –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?\n                        </div>\n                        <div className=\"text-xs text-blue-600 dark:text-blue-400 leading-relaxed\">\n                          <div className=\"space-y-1\">\n                            <div>üìù –ë–æ—Ç –∑–∞–ø–æ–º–Ω–∏—Ç –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã</div>\n                            <div>üéØ –ü–æ–∫–∞–∂–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —ç—Ç–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>\n                            <div>‚ö° –ù–∞–ø—Ä–∏–º–µ—Ä: –Ω–æ–≤—ã–º - \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\", —Å—Ç–∞—Ä—ã–º - \"–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!\"</div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Rule Conflicts and Validation */}\n                  {detectRuleConflicts.length > 0 && (\n                    <div className=\"bg-red-50/50 dark:bg-red-950/20 border border-red-200/40 dark:border-red-800/40 rounded-lg p-3 mb-4\">\n                      <div className=\"flex items-start space-x-2\">\n                        <div className=\"w-4 h-4 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5\">\n                          <i className=\"fas fa-exclamation text-white text-xs\"></i>\n                        </div>\n                        <div className=\"flex-1\">\n                          <div className=\"text-xs font-medium text-red-700 dark:text-red-300 mb-2\">\n                            –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ ({detectRuleConflicts.length}):\n                          </div>\n                          <div className=\"space-y-1\">\n                            {detectRuleConflicts.map((conflict, idx) => (\n                              <div key={idx} className={`text-xs p-2 rounded ${\n                                conflict.severity === 'error' \n                                  ? 'bg-red-100/50 dark:bg-red-900/20 text-red-700 dark:text-red-300' \n                                  : 'bg-yellow-100/50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300'\n                              }`}>\n                                <div className=\"font-medium flex items-center space-x-1\">\n                                  <i className={`fas ${conflict.severity === 'error' ? 'fa-times-circle' : 'fa-exclamation-triangle'} text-xs`}></i>\n                                  <span>{conflict.description}</span>\n                                </div>\n                                <div className=\"text-xs opacity-75 mt-1\">{conflict.suggestion}</div>\n                              </div>\n                            ))}\n                          </div>\n                          <div className=\"flex space-x-2 mt-3\">\n                            <UIButton\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              onClick={autoFixPriorities}\n                              className=\"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300\"\n                            >\n                              <i className=\"fas fa-magic mr-1\"></i>\n                              –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤\n                            </UIButton>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Conditional Messages List */}\n                  <div>\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300\">\n                        –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π\n                      </Label>\n                      <div className=\"flex space-x-2\">\n                        <UIButton\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={autoFixPriorities}\n                          className=\"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300\"\n                          title=\"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤\"\n                        >\n                          <i className=\"fas fa-sort-amount-down mr-1\"></i>\n                          –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã\n                        </UIButton>\n                        <UIButton\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => {\n                            const currentConditions = selectedNode.data.conditionalMessages || [];\n                            const nextPriority = Math.max(0, ...currentConditions.map(c => c.priority || 0)) + 10;\n                            \n                            const newCondition = {\n                              id: `condition-${Date.now()}`,\n                              condition: 'user_data_exists' as const,\n                              variableName: '',\n                              variableNames: [],\n                              logicOperator: 'AND' as const,\n                              messageText: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!',\n                              formatMode: 'text' as const,\n                              keyboardType: 'none' as const,\n                              buttons: [],\n                              waitForTextInput: false,\n                              priority: nextPriority\n                            };\n                            onNodeUpdate(selectedNode.id, { \n                              conditionalMessages: [...currentConditions, newCondition] \n                            });\n                          }}\n                          className=\"text-xs\"\n                        >\n                          <i className=\"fas fa-plus mr-1\"></i>\n                          –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ\n                        </UIButton>\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-3\">\n                      {(selectedNode.data.conditionalMessages || [])\n                        .sort((a, b) => (b.priority || 0) - (a.priority || 0))\n                        .map((condition, index) => {\n                          // Check if this rule has conflicts\n                          const ruleConflicts = detectRuleConflicts.filter(c => c.ruleIndex === index);\n                          const hasErrors = ruleConflicts.some(c => c.severity === 'error');\n                          const hasWarnings = ruleConflicts.some(c => c.severity === 'warning');\n                          \n                          return (\n                            <div key={condition.id} className={`bg-white/50 dark:bg-gray-900/30 border rounded-lg p-3 ${\n                              hasErrors \n                                ? 'border-red-300 dark:border-red-700 bg-red-50/20 dark:bg-red-950/10' \n                                : hasWarnings \n                                  ? 'border-yellow-300 dark:border-yellow-700 bg-yellow-50/20 dark:bg-yellow-950/10'\n                                  : 'border-purple-200/30 dark:border-purple-800/30'\n                            }`}>\n                              <div className=\"flex items-center justify-between mb-3\">\n                                <div className=\"flex items-center space-x-2\">\n                                  <div className=\"text-xs font-medium text-purple-700 dark:text-purple-300\">\n                                    –ü—Ä–∞–≤–∏–ª–æ #{index + 1}\n                                  </div>\n                                  {hasErrors && (\n                                    <div className=\"w-4 h-4 bg-red-500 rounded-full flex items-center justify-center\">\n                                      <i className=\"fas fa-times text-white text-xs\"></i>\n                                    </div>\n                                  )}\n                                  {hasWarnings && !hasErrors && (\n                                    <div className=\"w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center\">\n                                      <i className=\"fas fa-exclamation text-white text-xs\"></i>\n                                    </div>\n                                  )}\n                                  <div className=\"text-xs text-muted-foreground\">\n                                    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {condition.priority || 0}\n                                  </div>\n                                </div>\n                                <div className=\"flex items-center space-x-1\">\n                                  {/* Priority controls */}\n                                  <UIButton\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => {\n                                      const currentConditions = selectedNode.data.conditionalMessages || [];\n                                      const updatedConditions = currentConditions.map(c => \n                                        c.id === condition.id \n                                          ? { ...c, priority: (c.priority || 0) + 10 } \n                                          : c\n                                      );\n                                      onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                    }}\n                                    className=\"text-muted-foreground hover:text-blue-600 h-auto p-1\"\n                                    title=\"–ü–æ–≤—ã—Å–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç\"\n                                  >\n                                    <i className=\"fas fa-arrow-up text-xs\"></i>\n                                  </UIButton>\n                                  <UIButton\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => {\n                                      const currentConditions = selectedNode.data.conditionalMessages || [];\n                                      const updatedConditions = currentConditions.map(c => \n                                        c.id === condition.id \n                                          ? { ...c, priority: Math.max(0, (c.priority || 0) - 10) } \n                                          : c\n                                      );\n                                      onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                    }}\n                                    className=\"text-muted-foreground hover:text-blue-600 h-auto p-1\"\n                                    title=\"–ü–æ–Ω–∏–∑–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç\"\n                                  >\n                                    <i className=\"fas fa-arrow-down text-xs\"></i>\n                                  </UIButton>\n                                  <UIButton\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => {\n                                      const currentConditions = selectedNode.data.conditionalMessages || [];\n                                      const newConditions = currentConditions.filter(c => c.id !== condition.id);\n                                      onNodeUpdate(selectedNode.id, { conditionalMessages: newConditions });\n                                    }}\n                                    className=\"text-muted-foreground hover:text-destructive h-auto p-1\"\n                                  >\n                                    <i className=\"fas fa-trash text-xs\"></i>\n                                  </UIButton>\n                                </div>\n                              </div>\n\n                              {/* Show conflicts for this rule */}\n                              {ruleConflicts.length > 0 && (\n                                <div className=\"mb-3 p-2 bg-red-50/50 dark:bg-red-950/20 border border-red-200/40 dark:border-red-800/40 rounded text-xs\">\n                                  {ruleConflicts.map((conflict, idx) => (\n                                    <div key={idx} className=\"text-red-700 dark:text-red-300\">\n                                      <i className={`fas ${conflict.severity === 'error' ? 'fa-times-circle' : 'fa-exclamation-triangle'} mr-1`}></i>\n                                      {conflict.description}\n                                    </div>\n                                  ))}\n                                </div>\n                              )}\n\n                              <div className=\"space-y-3\">\n                            {/* Condition Type */}\n                            <div>\n                              <Label className=\"text-xs font-medium text-muted-foreground mb-1 block\">\n                                –¢–∏–ø —É—Å–ª–æ–≤–∏—è\n                              </Label>\n                              <Select\n                                value={condition.condition}\n                                onValueChange={(value) => {\n                                  const currentConditions = selectedNode.data.conditionalMessages || [];\n                                  const updatedConditions = currentConditions.map(c => \n                                    c.id === condition.id ? { ...c, condition: value as any } : c\n                                  );\n                                  onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                }}\n                              >\n                                <SelectTrigger className=\"text-xs\">\n                                  <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  <SelectItem value=\"user_data_exists\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –æ—Ç–≤–µ—á–∞–ª –Ω–∞ –≤–æ–ø—Ä–æ—Å</SelectItem>\n                                  <SelectItem value=\"user_data_not_exists\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –æ—Ç–≤–µ—á–∞–ª –Ω–∞ –≤–æ–ø—Ä–æ—Å</SelectItem>\n                                  <SelectItem value=\"user_data_equals\">–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–≤–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é</SelectItem>\n                                  <SelectItem value=\"user_data_contains\">–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</SelectItem>\n                                  <SelectItem value=\"first_time\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –≤–ø–µ—Ä–≤—ã–µ</SelectItem>\n                                  <SelectItem value=\"returning_user\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ö–æ–¥–∏–ª —Ä–∞–Ω–µ–µ</SelectItem>\n                                </SelectContent>\n                              </Select>\n                            </div>\n\n                            {/* Variable Names - Multiple Question Selection */}\n                            {(condition.condition === 'user_data_exists' || \n                              condition.condition === 'user_data_not_exists' || \n                              condition.condition === 'user_data_equals' || \n                              condition.condition === 'user_data_contains') && (\n                              <div>\n                                <Label className=\"text-xs font-medium text-muted-foreground mb-2 block\">\n                                  –ù–∞ –∫–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–µ–Ω –±—ã–ª –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?\n                                </Label>\n                                \n                                {/* Multiple Question Selection with Checkboxes */}\n                                {availableQuestions.length > 0 ? (\n                                  <div className=\"space-y-3\">\n                                    <div className=\"bg-muted/30 rounded-lg p-3 border border-border/50\">\n                                      <div className=\"text-xs font-medium text-muted-foreground mb-2\">\n                                        –í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Å–ø–∏—Å–∫–∞:\n                                      </div>\n                                      <div className=\"space-y-2 max-h-32 overflow-y-auto\">\n                                        {availableQuestions.map((question) => {\n                                          const currentVariableNames = condition.variableNames || [];\n                                          const isSelected = currentVariableNames.includes(question.name);\n                                          \n                                          return (\n                                            <div key={`${question.nodeId}-${question.name}`} className=\"flex items-center space-x-2\">\n                                              <input\n                                                type=\"checkbox\"\n                                                id={`question-${condition.id}-${question.name}`}\n                                                checked={isSelected}\n                                                onChange={(e) => {\n                                                  const currentConditions = selectedNode.data.conditionalMessages || [];\n                                                  const currentVariableNames = condition.variableNames || [];\n                                                  \n                                                  let updatedVariableNames;\n                                                  if (e.target.checked) {\n                                                    updatedVariableNames = [...currentVariableNames, question.name];\n                                                  } else {\n                                                    updatedVariableNames = currentVariableNames.filter(name => name !== question.name);\n                                                  }\n                                                  \n                                                  const updatedConditions = currentConditions.map(c => \n                                                    c.id === condition.id ? { \n                                                      ...c, \n                                                      variableNames: updatedVariableNames,\n                                                      // Update legacy variableName for backward compatibility\n                                                      variableName: updatedVariableNames.length > 0 ? updatedVariableNames[0] : ''\n                                                    } : c\n                                                  );\n                                                  onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                                }}\n                                                className=\"w-3 h-3 text-primary focus:ring-primary border-border rounded\"\n                                              />\n                                              <label \n                                                htmlFor={`question-${condition.id}-${question.name}`}\n                                                className=\"flex items-center space-x-2 cursor-pointer flex-1\"\n                                              >\n                                                <span className=\"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1.5 py-0.5 rounded\">\n                                                  {question.nodeType}\n                                                </span>\n                                                <span className=\"text-xs\">{question.name}</span>\n                                              </label>\n                                            </div>\n                                          );\n                                        })}\n                                      </div>\n                                    </div>\n                                    \n                                    {/* Logic Operator Selection for Multiple Questions */}\n                                    {(condition.variableNames?.length || 0) > 1 && (\n                                      <div>\n                                        <Label className=\"text-xs font-medium text-muted-foreground mb-1 block\">\n                                          –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:\n                                        </Label>\n                                        <Select\n                                          value={condition.logicOperator || 'AND'}\n                                          onValueChange={(value: 'AND' | 'OR') => {\n                                            const currentConditions = selectedNode.data.conditionalMessages || [];\n                                            const updatedConditions = currentConditions.map(c => \n                                              c.id === condition.id ? { ...c, logicOperator: value } : c\n                                            );\n                                            onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                          }}\n                                        >\n                                          <SelectTrigger className=\"text-xs\">\n                                            <SelectValue />\n                                          </SelectTrigger>\n                                          <SelectContent>\n                                            <SelectItem value=\"AND\">–ò (AND) - –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</SelectItem>\n                                            <SelectItem value=\"OR\">–ò–õ–ò (OR) - –ª—é–±–æ–π –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤</SelectItem>\n                                          </SelectContent>\n                                        </Select>\n                                        <div className=\"text-xs text-muted-foreground mt-1\">\n                                          {condition.logicOperator === 'AND' \n                                            ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –í–°–ï –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã'\n                                            : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –õ–Æ–ë–û–ô –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤'\n                                          }\n                                        </div>\n                                      </div>\n                                    )}\n                                    \n                                    {/* Manual Input for Additional Questions */}\n                                    <div>\n                                      <Label className=\"text-xs font-medium text-muted-foreground mb-1 block\">\n                                        –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –≤—Ä—É—á–Ω—É—é:\n                                      </Label>\n                                      <Input\n                                        value={(condition.variableNames || []).join(', ')}\n                                        onChange={(e) => {\n                                          const currentConditions = selectedNode.data.conditionalMessages || [];\n                                          const variableNames = e.target.value.split(',').map(name => name.trim()).filter(name => name);\n                                          const updatedConditions = currentConditions.map(c => \n                                            c.id === condition.id ? { \n                                              ...c, \n                                              variableNames: variableNames,\n                                              variableName: variableNames.length > 0 ? variableNames[0] : ''\n                                            } : c\n                                          );\n                                          onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                        }}\n                                        className=\"text-xs\"\n                                        placeholder=\"–∏–º—è, –ø–æ–ª, –≤–æ–∑—Ä–∞—Å—Ç (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)\"\n                                      />\n                                      <div className=\"text-xs text-muted-foreground mt-1\">\n                                        –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é\n                                      </div>\n                                    </div>\n                                  </div>\n                                ) : (\n                                  <div className=\"text-center py-4 text-muted-foreground bg-muted/30 rounded-lg border border-border/50\">\n                                    <i className=\"fas fa-question-circle text-lg mb-2\"></i>\n                                    <div className=\"text-xs\">\n                                      –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ —É–∑–ª—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–≤–æ–¥–æ–º.\n                                    </div>\n                                  </div>\n                                )}\n                                \n                                {/* Display Selected Questions */}\n                                {(condition.variableNames?.length || 0) > 0 && (\n                                  <div className=\"bg-green-50/50 dark:bg-green-950/20 border border-green-200/40 dark:border-green-800/40 rounded-lg p-2\">\n                                    <div className=\"text-xs font-medium text-green-700 dark:text-green-300 mb-1\">\n                                      –í—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã ({condition.variableNames?.length || 0}):\n                                    </div>\n                                    <div className=\"flex flex-wrap gap-1\">\n                                      {(condition.variableNames || []).map((name, idx) => (\n                                        <span key={idx} className=\"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded-full\">\n                                          {name}\n                                        </span>\n                                      ))}\n                                    </div>\n                                  </div>\n                                )}\n                              </div>\n                            )}\n\n                            {/* Expected Value */}\n                            {(condition.condition === 'user_data_equals' || \n                              condition.condition === 'user_data_contains') && (\n                              <div>\n                                <Label className=\"text-xs font-medium text-muted-foreground mb-1 block\">\n                                  {condition.condition === 'user_data_equals' \n                                    ? '–ö–∞–∫–æ–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?' \n                                    : '–ö–∞–∫–æ–π —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å—Å—è –≤ –æ—Ç–≤–µ—Ç–µ?'}\n                                </Label>\n                                <Input\n                                  value={condition.expectedValue || ''}\n                                  onChange={(e) => {\n                                    const currentConditions = selectedNode.data.conditionalMessages || [];\n                                    const updatedConditions = currentConditions.map(c => \n                                      c.id === condition.id ? { ...c, expectedValue: e.target.value } : c\n                                    );\n                                    onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                  }}\n                                  className=\"text-xs\"\n                                  placeholder={condition.condition === 'user_data_equals' ? '–†–µ–∫–ª–∞–º–∞' : '—Ä–µ–∫–ª'}\n                                />\n                                <div className=\"text-xs text-muted-foreground mt-1\">\n                                  {condition.condition === 'user_data_equals' \n                                    ? '–ù–∞–ø—Ä–∏–º–µ—Ä: \"–†–µ–∫–ª–∞–º–∞\", \"–ú—É–∂—Å–∫–æ–π\", \"25\"' \n                                    : '–ù–∞–ø—Ä–∏–º–µ—Ä: \"—Ä–µ–∫–ª\" –Ω–∞–π–¥–µ—Ç \"–†–µ–∫–ª–∞–º–∞\", \"—Ä–µ–∫–ª–∞–º–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ\"'}\n                                </div>\n                              </div>\n                            )}\n\n\n\n                            {/* Message Text with Formatting */}\n                            <div>\n                              <Label className=\"text-xs font-medium text-muted-foreground mb-1 block\">\n                                –ß—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è?\n                              </Label>\n                              \n                              {/* Format Mode Selection */}\n                              <div className=\"mb-2\">\n                                <Select\n                                  value={condition.formatMode || 'text'}\n                                  onValueChange={(value: 'text' | 'markdown' | 'html') => {\n                                    const currentConditions = selectedNode.data.conditionalMessages || [];\n                                    const updatedConditions = currentConditions.map(c => \n                                      c.id === condition.id ? { ...c, formatMode: value } : c\n                                    );\n                                    onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                  }}\n                                >\n                                  <SelectTrigger className=\"text-xs h-7\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"text\">–û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç</SelectItem>\n                                    <SelectItem value=\"markdown\">Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</SelectItem>\n                                    <SelectItem value=\"html\">HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n\n                              {/* Rich Text Editor for conditional message */}\n                              <InlineRichEditor\n                                value={condition.messageText}\n                                onChange={(value) => {\n                                  const currentConditions = selectedNode.data.conditionalMessages || [];\n                                  const updatedConditions = currentConditions.map(c => \n                                    c.id === condition.id ? { ...c, messageText: value } : c\n                                  );\n                                  onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                }}\n                                placeholder=\"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ! –†–∞–¥—ã –≤–∞—Å —Å–Ω–æ–≤–∞ –≤–∏–¥–µ—Ç—å.\"\n                                enableMarkdown={condition.formatMode === 'markdown'}\n                                onMarkdownToggle={(enabled) => {\n                                  const currentConditions = selectedNode.data.conditionalMessages || [];\n                                  const updatedConditions = currentConditions.map(c => \n                                    c.id === condition.id ? { ...c, formatMode: (enabled ? 'markdown' : 'text') as 'text' | 'markdown' | 'html' } : c\n                                  );\n                                  onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                }}\n                                availableVariables={availableVariables}\n                              />\n                              \n\n                              \n                              <div className=\"text-xs text-muted-foreground mt-1\">\n                                –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–º–µ—Å—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞\n                              </div>\n                            </div>\n\n                            {/* Text Input Configuration */}\n                            <div className=\"border border-blue-200/50 dark:border-blue-800/50 rounded-lg p-3 bg-blue-50/30 dark:bg-blue-950/20\">\n                              <div className=\"flex items-center justify-between mb-2\">\n                                <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 flex items-center\">\n                                  <i className=\"fas fa-keyboard mr-1\"></i>\n                                  –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞\n                                </Label>\n                                <Switch\n                                  checked={condition.waitForTextInput ?? false}\n                                  onCheckedChange={(checked) => {\n                                    const currentConditions = selectedNode.data.conditionalMessages || [];\n                                    const updatedConditions = currentConditions.map(c => \n                                      c.id === condition.id ? { ...c, waitForTextInput: checked } : c\n                                    );\n                                    onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                  }}\n                                />\n                              </div>\n                              {condition.waitForTextInput && (\n                                <div className=\"space-y-2\">\n                                  <div className=\"text-xs text-blue-600 dark:text-blue-400\">\n                                    –ü–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç –±—É–¥–µ—Ç –∂–¥–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n                                  </div>\n                                  <div>\n                                    <Label className=\"text-xs font-medium text-muted-foreground mb-1 block\">\n                                      –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)\n                                    </Label>\n                                    <Input\n                                      value={condition.textInputVariable || ''}\n                                      onChange={(e) => {\n                                        const currentConditions = selectedNode.data.conditionalMessages || [];\n                                        const updatedConditions = currentConditions.map(c => \n                                          c.id === condition.id ? { ...c, textInputVariable: e.target.value } : c\n                                        );\n                                        onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                      }}\n                                      className=\"text-xs\"\n                                      placeholder=\"conditional_answer\"\n                                    />\n                                    <div className=\"text-xs text-muted-foreground mt-1\">\n                                      –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π\n                                    </div>\n                                  </div>\n                                  <div>\n                                    <Label className=\"text-xs font-medium text-muted-foreground mb-2 block\">\n                                      –ö—É–¥–∞ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞\n                                    </Label>\n                                    <div className=\"space-y-2\">\n                                      <Select\n                                        value={condition.nextNodeAfterInput || 'no-transition'}\n                                        onValueChange={(value) => {\n                                          const currentConditions = selectedNode.data.conditionalMessages || [];\n                                          const updatedConditions = currentConditions.map(c => \n                                            c.id === condition.id ? { ...c, nextNodeAfterInput: value === 'no-transition' ? undefined : value } : c\n                                          );\n                                          onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                        }}\n                                      >\n                                        <SelectTrigger className=\"text-xs h-8\">\n                                          <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥\" />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                          <SelectItem value=\"no-transition\">–ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å</SelectItem>\n                                          {getAllNodesFromAllSheets.filter(n => n.node.id !== selectedNode.id).map(({node, sheetName}) => {\n                                            const nodeLabel = node.data.label || \n                                              (node.type === 'command' ? `–ö–æ–º–∞–Ω–¥–∞: ${node.data.command}` : \n                                               node.type === 'message' ? `–°–æ–æ–±—â–µ–Ω–∏–µ: ${(node.data.messageText || '').slice(0, 30)}...` :\n                                               `${node.type} (${node.id.slice(-8)})`);\n                                            return (\n                                              <SelectItem key={node.id} value={node.id}>\n                                                <div className=\"flex items-center gap-2\">\n                                                  <span className=\"text-xs text-muted-foreground\">{node.type}</span>\n                                                  <span>{nodeLabel}</span>\n                                                  <span className=\"text-xs text-blue-600 dark:text-blue-400\">({sheetName})</span>\n                                                </div>\n                                              </SelectItem>\n                                            );\n                                          })}\n                                        </SelectContent>\n                                      </Select>\n                                      \n                                      <div className=\"text-xs text-muted-foreground mb-1\">\n                                        –ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ ID —É–∑–ª–∞ –≤—Ä—É—á–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: ylObKToWFsIl-opIcowPZ)\n                                      </div>\n                                      <Input\n                                        value={condition.nextNodeAfterInput && condition.nextNodeAfterInput !== 'no-transition' ? condition.nextNodeAfterInput : ''}\n                                        onChange={(e) => {\n                                          const currentConditions = selectedNode.data.conditionalMessages || [];\n                                          const updatedConditions = currentConditions.map(c => \n                                            c.id === condition.id ? { ...c, nextNodeAfterInput: e.target.value || undefined } : c\n                                          );\n                                          onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                        }}\n                                        className=\"text-xs h-8\"\n                                        placeholder=\"–í–≤–µ–¥–∏—Ç–µ ID —É–∑–ª–∞ –≤—Ä—É—á–Ω—É—é\"\n                                      />\n                                    </div>\n                                    <div className=\"text-xs text-muted-foreground mt-2\">\n                                      –£–∑–µ–ª, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø–µ—Ä–µ–π—Ç–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n                                    </div>\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n\n                            {/* Keyboard Configuration for Conditional Messages */}\n                            <div className=\"space-y-3 border-t border-purple-200/30 dark:border-purple-800/30 pt-3\">\n                              <div className=\"flex items-center justify-between\">\n                                <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300\">\n                                  <i className=\"fas fa-keyboard mr-1\"></i>\n                                  –ö–Ω–æ–ø–∫–∏ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n                                </Label>\n                                <Select\n                                  value={condition.keyboardType || 'none'}\n                                  onValueChange={(value: 'none' | 'inline' | 'reply') => {\n                                    const currentConditions = selectedNode.data.conditionalMessages || [];\n                                    const updatedConditions = currentConditions.map(c => \n                                      c.id === condition.id ? { ...c, keyboardType: value } : c\n                                    );\n                                    onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                  }}\n                                >\n                                  <SelectTrigger className=\"text-xs h-7 w-32\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"none\">–ë–µ–∑ –∫–Ω–æ–ø–æ–∫</SelectItem>\n                                    <SelectItem value=\"inline\">Inline –∫–Ω–æ–ø–∫–∏</SelectItem>\n                                    <SelectItem value=\"reply\">Reply –∫–Ω–æ–ø–∫–∏</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n\n                              {/* Buttons Configuration */}\n                              {condition.keyboardType && condition.keyboardType !== 'none' && (\n                                <div className=\"space-y-2\">\n                                  <div className=\"flex items-center justify-between\">\n                                    <span className=\"text-xs text-purple-600 dark:text-purple-400\">\n                                      –ö–Ω–æ–ø–∫–∏ ({(condition.buttons || []).length})\n                                    </span>\n                                    <UIButton\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => {\n                                        const newButton = {\n                                          id: nanoid(),\n                                          text: '–ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞',\n                                          action: 'goto' as const,\n                                          target: '',\n                                          url: '',\n                                          buttonType: 'normal' as const,\n                                          skipDataCollection: false\n                                        };\n                                        const currentConditions = selectedNode.data.conditionalMessages || [];\n                                        const updatedConditions = currentConditions.map(c => \n                                          c.id === condition.id ? { \n                                            ...c, \n                                            buttons: [...(c.buttons || []), newButton] \n                                          } : c\n                                        );\n                                        onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                      }}\n                                      className=\"text-xs text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-200\"\n                                    >\n                                      + –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É\n                                    </UIButton>\n                                  </div>\n\n                                  {/* Buttons List */}\n                                  <div className=\"space-y-2 max-h-40 overflow-y-auto\">\n                                    {(condition.buttons || []).map((button, buttonIndex) => (\n                                      <div key={button.id} className=\"bg-white/50 dark:bg-gray-900/30 rounded-lg p-2 border border-purple-200/30 dark:border-purple-800/30\">\n                                        <div className=\"flex items-center justify-between mb-2\">\n                                          <Input\n                                            value={button.text}\n                                            onChange={(e) => {\n                                              const currentConditions = selectedNode.data.conditionalMessages || [];\n                                              const updatedConditions = currentConditions.map(c => \n                                                c.id === condition.id ? {\n                                                  ...c,\n                                                  buttons: (c.buttons || []).map((b, i) => \n                                                    i === buttonIndex ? { ...b, text: e.target.value } : b\n                                                  )\n                                                } : c\n                                              );\n                                              onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                            }}\n                                            className=\"flex-1 text-xs mr-2\"\n                                            placeholder=\"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏\"\n                                          />\n                                          <UIButton\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={() => {\n                                              const currentConditions = selectedNode.data.conditionalMessages || [];\n                                              const updatedConditions = currentConditions.map(c => \n                                                c.id === condition.id ? {\n                                                  ...c,\n                                                  buttons: (c.buttons || []).filter((_, i) => i !== buttonIndex)\n                                                } : c\n                                              );\n                                              onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                            }}\n                                            className=\"text-xs text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200\"\n                                          >\n                                            <i className=\"fas fa-trash\"></i>\n                                          </UIButton>\n                                        </div>\n\n                                        {/* Button Action Configuration */}\n                                        <div className=\"space-y-2\">\n                                          <Select\n                                            value={button.action || 'goto'}\n                                            onValueChange={(value: 'goto' | 'url' | 'command') => {\n                                              const currentConditions = selectedNode.data.conditionalMessages || [];\n                                              const updatedConditions = currentConditions.map(c => \n                                                c.id === condition.id ? {\n                                                  ...c,\n                                                  buttons: (c.buttons || []).map((b, i) => \n                                                    i === buttonIndex ? { ...b, action: value } : b\n                                                  )\n                                                } : c\n                                              );\n                                              onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                            }}\n                                          >\n                                            <SelectTrigger className=\"text-xs h-7\">\n                                              <SelectValue />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                              <SelectItem value=\"goto\">–ü–µ—Ä–µ–π—Ç–∏ –∫ —É–∑–ª—É</SelectItem>\n                                              <SelectItem value=\"url\">–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É</SelectItem>\n                                              <SelectItem value=\"command\">–í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</SelectItem>\n                                              <SelectItem value=\"selection\">–í—ã–±–æ—Ä –æ–ø—Ü–∏–∏</SelectItem>\n                                            </SelectContent>\n                                          </Select>\n\n                                          {button.action === 'goto' && (\n                                            <Select\n                                              value={button.target || ''}\n                                              onValueChange={(value) => {\n                                                const currentConditions = selectedNode.data.conditionalMessages || [];\n                                                const updatedConditions = currentConditions.map(c => \n                                                  c.id === condition.id ? {\n                                                    ...c,\n                                                    buttons: (c.buttons || []).map((b, i) => \n                                                      i === buttonIndex ? { ...b, target: value } : b\n                                                    )\n                                                  } : c\n                                                );\n                                                onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                              }}\n                                            >\n                                              <SelectTrigger className=\"text-xs h-7\">\n                                                <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª\" />\n                                              </SelectTrigger>\n                                              <SelectContent>\n                                                {getAllNodesFromAllSheets\n                                                  .filter(n => n.node.id !== selectedNode.id)\n                                                  .map(({node, sheetName}) => {\n                                                    const nodeName = \n                                                      node.type === 'start' ? node.data.command :\n                                                      node.type === 'command' ? node.data.command :\n                                                      node.data.messageText?.slice(0, 30) + '...' || `${node.type} ${node.id}`;\n                                                    return (\n                                                      <SelectItem key={node.id} value={node.id}>\n                                                        <div className=\"flex items-center gap-2\">\n                                                          <span>{nodeName}</span>\n                                                          <span className=\"text-xs text-blue-600 dark:text-blue-400\">({sheetName})</span>\n                                                        </div>\n                                                      </SelectItem>\n                                                    );\n                                                  })}\n                                              </SelectContent>\n                                            </Select>\n                                          )}\n\n                                          {button.action === 'url' && (\n                                            <Input\n                                              value={button.url || ''}\n                                              onChange={(e) => {\n                                                const currentConditions = selectedNode.data.conditionalMessages || [];\n                                                const updatedConditions = currentConditions.map(c => \n                                                  c.id === condition.id ? {\n                                                    ...c,\n                                                    buttons: (c.buttons || []).map((b, i) => \n                                                      i === buttonIndex ? { ...b, url: e.target.value } : b\n                                                    )\n                                                  } : c\n                                                );\n                                                onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                              }}\n                                              className=\"text-xs\"\n                                              placeholder=\"https://example.com\"\n                                            />\n                                          )}\n\n                                          {button.action === 'command' && (\n                                            <Input\n                                              value={button.target || ''}\n                                              onChange={(e) => {\n                                                const currentConditions = selectedNode.data.conditionalMessages || [];\n                                                const updatedConditions = currentConditions.map(c => \n                                                  c.id === condition.id ? {\n                                                    ...c,\n                                                    buttons: (c.buttons || []).map((b, i) => \n                                                      i === buttonIndex ? { ...b, target: e.target.value } : b\n                                                    )\n                                                  } : c\n                                                );\n                                                onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                              }}\n                                              className=\"text-xs\"\n                                              placeholder=\"/help\"\n                                            />\n                                          )}\n                                        </div>\n                                      </div>\n                                    ))}\n                                  </div>\n\n                                  {/* Reply Keyboard Settings */}\n                                  {condition.keyboardType === 'reply' && (\n                                    <div className=\"grid grid-cols-2 gap-3 pt-2 border-t border-purple-200/20 dark:border-purple-800/20\">\n                                      <div className=\"flex items-center space-x-2\">\n                                        <Switch\n                                          checked={condition.resizeKeyboard ?? true}\n                                          onCheckedChange={(checked) => {\n                                            const currentConditions = selectedNode.data.conditionalMessages || [];\n                                            const updatedConditions = currentConditions.map(c => \n                                              c.id === condition.id ? { ...c, resizeKeyboard: checked } : c\n                                            );\n                                            onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                          }}\n                                        />\n                                        <Label className=\"text-xs text-purple-600 dark:text-purple-400\">–ê–≤—Ç–æ-—Ä–∞–∑–º–µ—Ä</Label>\n                                      </div>\n                                      <div className=\"flex items-center space-x-2\">\n                                        <Switch\n                                          checked={condition.oneTimeKeyboard ?? false}\n                                          onCheckedChange={(checked) => {\n                                            const currentConditions = selectedNode.data.conditionalMessages || [];\n                                            const updatedConditions = currentConditions.map(c => \n                                              c.id === condition.id ? { ...c, oneTimeKeyboard: checked } : c\n                                            );\n                                            onNodeUpdate(selectedNode.id, { conditionalMessages: updatedConditions });\n                                          }}\n                                        />\n                                        <Label className=\"text-xs text-purple-600 dark:text-purple-400\">–°–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</Label>\n                                      </div>\n                                    </div>\n                                  )}\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                          );\n                        }\n                      )}\n\n                      {(selectedNode.data.conditionalMessages || []).length === 0 && (\n                        <div className=\"text-center py-6 text-muted-foreground\">\n                          <i className=\"fas fa-plus-circle text-2xl mb-2\"></i>\n                          <div className=\"text-xs\">\n                            –ù–∞–∂–º–∏—Ç–µ \"–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ\" —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Fallback Message */}\n                  <div>\n                    <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300 mb-2 block\">\n                      –ß—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å, –µ—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ –ø–æ–¥–æ—à–ª–æ?\n                    </Label>\n                    <Textarea\n                      value={selectedNode.data.fallbackMessage || ''}\n                      onChange={(e) => onNodeUpdate(selectedNode.id, { fallbackMessage: e.target.value })}\n                      className=\"text-xs resize-none border-purple-200 dark:border-purple-700\"\n                      rows={3}\n                      placeholder=\"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç —É–∑–ª–∞\"\n                    />\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      –ï—Å–ª–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å, –ø–æ–∫–∞–∂–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* User Input Configuration */}\n        {selectedNode.data.collectUserInput && (\n          <div className=\"space-y-6\">\n            {/* Input Configuration Section */}\n            <div className=\"bg-gradient-to-br from-purple-50/50 to-violet-50/30 dark:from-purple-950/20 dark:to-violet-950/10 border border-purple-200/30 dark:border-purple-800/30 rounded-lg p-4\">\n              <div className=\"flex items-center space-x-2 mb-3\">\n                <div className=\"w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center\">\n                  <i className=\"fas fa-comments text-purple-600 dark:text-purple-400 text-xs\"></i>\n                </div>\n                <Label className=\"text-sm font-semibold text-purple-900 dark:text-purple-100\">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–∞</Label>\n              </div>\n              \n              <div className=\"space-y-4\">\n                {/* Enable/Disable Input Collection Toggle */}\n                <div className=\"flex items-center justify-between p-3 rounded-lg bg-card/50 border border-purple-200/30 dark:border-purple-800/30 hover:border-purple-300 dark:hover:border-purple-700 transition-all duration-200\">\n                  <div className=\"flex-1\">\n                    <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300\">\n                      –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤\n                    </Label>\n                    <div className=\"text-xs text-purple-600 dark:text-purple-400 mt-1\">\n                      –û–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n                    </div>\n                  </div>\n                  <div className=\"ml-4\">\n                    <Switch\n                      checked={selectedNode.data.collectUserInput ?? false}\n                      onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { collectUserInput: checked })}\n                    />\n                  </div>\n                </div>\n\n                {/* Text Input Toggle */}\n                <div className=\"flex items-center justify-between p-3 rounded-lg bg-card/50 border border-purple-200/30 dark:border-purple-800/30 hover:border-purple-300 dark:hover:border-purple-700 transition-all duration-200\">\n                  <div className=\"flex-1\">\n                    <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300\">\n                      <i className=\"fas fa-keyboard mr-1\"></i>\n                      –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥\n                    </Label>\n                    <div className=\"text-xs text-purple-600 dark:text-purple-400 mt-1\">\n                      –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥, —Ç–æ –∫–∞–∫ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –∏ –∫–Ω–æ–ø–∫–∏ –∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–π –≤–≤–æ–¥\n                    </div>\n                  </div>\n                  <div className=\"ml-4\">\n                    <Switch\n                      checked={selectedNode.data.enableTextInput ?? false}\n                      onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { enableTextInput: checked })}\n                    />\n                  </div>\n                </div>\n\n                <div>\n                  <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300 mb-2 block\">\n                    <i className=\"fas fa-code mr-1\"></i>\n                    –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π\n                  </Label>\n                  <Input\n                    value={selectedNode.data.inputVariable || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { inputVariable: e.target.value })}\n                    className=\"border-purple-200 dark:border-purple-700 focus:border-purple-500 focus:ring-purple-200\"\n                    placeholder=\"user_response\"\n                  />\n                </div>\n\n                {/* Target Node */}\n                <div>\n                  <Label className=\"text-xs font-medium text-purple-700 dark:text-purple-300 mb-2 block\">\n                    <i className=\"fas fa-arrow-right mr-1\"></i>\n                    –ö—É–¥–∞ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞\n                  </Label>\n                  <Select\n                    value={selectedNode.data.inputTargetNodeId || ''}\n                    onValueChange={(value) => onNodeUpdate(selectedNode.id, { inputTargetNodeId: value })}\n                  >\n                    <SelectTrigger className=\"border-purple-200 dark:border-purple-700 focus:border-purple-500\">\n                      <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {/* –ö–æ–º–∞–Ω–¥—ã –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ */}\n                      {getAllNodesFromAllSheets\n                        .filter(({ node }) => node.id !== selectedNode.id && (node.type === 'start' || node.type === 'command'))\n                        .map(({ node, sheetId, sheetName }) => (\n                          <SelectItem key={`${sheetId}-${node.id}`} value={node.id}>\n                            <div className=\"flex items-center gap-2\">\n                              <i className=\"fas fa-terminal text-xs text-purple-500\"></i>\n                              <span>{node.data.command}</span>\n                              {sheetId !== currentSheetId && (\n                                <span className=\"text-xs text-muted-foreground bg-purple-100 dark:bg-purple-900/30 px-1 rounded\">\n                                  üìã {sheetName}\n                                </span>\n                              )}\n                            </div>\n                          </SelectItem>\n                        ))}\n                      \n                      {/* –î—Ä—É–≥–∏–µ —É–∑–ª—ã –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ */}\n                      {getAllNodesFromAllSheets\n                        .filter(({ node }) => node.id !== selectedNode.id && node.type !== 'start' && node.type !== 'command')\n                        .map(({ node, sheetId, sheetName }) => {\n                          const nodeName = \n                            node.type === 'message' ? '–°–æ–æ–±—â–µ–Ω–∏–µ' :\n                            node.type === 'photo' ? '–§–æ—Ç–æ' :\n                            node.type === 'video' ? '–í–∏–¥–µ–æ' :\n                            node.type === 'audio' ? '–ê—É–¥–∏–æ' :\n                            node.type === 'document' ? '–î–æ–∫—É–º–µ–Ω—Ç' :\n                            node.type === 'keyboard' ? '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞' :\n                            node.type === 'condition' ? '–£—Å–ª–æ–≤–∏–µ' :\n                            node.type === 'input' ? '–í–≤–æ–¥' :\n                            node.data?.collectUserInput ? '–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö' :\n                            node.type === 'location' ? '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è' :\n                            node.type === 'contact' ? '–ö–æ–Ω—Ç–∞–∫—Ç' :\n                            node.type === 'sticker' ? '–°—Ç–∏–∫–µ—Ä' :\n                            node.type === 'voice' ? '–ì–æ–ª–æ—Å–æ–≤–æ–µ' :\n                            node.type === 'animation' ? '–ê–Ω–∏–º–∞—Ü–∏—è' : '–£–∑–µ–ª';\n                          \n                          const iconClass = \n                            node.type === 'message' ? 'fas fa-comment text-purple-500' :\n                            node.type === 'photo' ? 'fas fa-image text-purple-500' :\n                            node.type === 'video' ? 'fas fa-video text-purple-500' :\n                            node.type === 'audio' ? 'fas fa-music text-purple-500' :\n                            node.type === 'document' ? 'fas fa-file text-purple-500' :\n                            node.type === 'keyboard' ? 'fas fa-keyboard text-purple-500' :\n                            node.type === 'condition' ? 'fas fa-code-branch text-purple-500' :\n                            node.type === 'input' ? 'fas fa-edit text-purple-500' :\n                            node.data?.collectUserInput ? 'fas fa-user-edit text-purple-500' :\n                            node.type === 'location' ? 'fas fa-map-marker-alt text-purple-500' :\n                            node.type === 'contact' ? 'fas fa-address-book text-purple-500' :\n                            node.type === 'sticker' ? 'fas fa-smile text-purple-500' :\n                            node.type === 'voice' ? 'fas fa-microphone text-purple-500' :\n                            node.type === 'animation' ? 'fas fa-play-circle text-purple-500' : 'fas fa-cube text-purple-500';\n                          \n                          return (\n                            <SelectItem key={`${sheetId}-${node.id}`} value={node.id}>\n                              <div className=\"flex items-center gap-2\">\n                                <i className={`${iconClass} text-xs`}></i>\n                                <span>{nodeName}</span>\n                                {sheetId !== currentSheetId && (\n                                  <span className=\"text-xs text-muted-foreground bg-purple-100 dark:bg-purple-900/30 px-1 rounded\">\n                                    üìã {sheetName}\n                                  </span>\n                                )}\n                              </div>\n                            </SelectItem>\n                          );\n                        })}\n                      \n                      {(!getAllNodesFromAllSheets || getAllNodesFromAllSheets.filter(({ node }) => node.id !== selectedNode.id).length === 0) && (\n                        <SelectItem value=\"no-nodes\" disabled>\n                          –°–æ–∑–¥–∞–π—Ç–µ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏ –±–æ—Ç–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞\n                        </SelectItem>\n                      )}\n                    </SelectContent>\n                  </Select>\n                  \n                  <Input\n                    value={selectedNode.data.inputTargetNodeId || ''}\n                    onChange={(e) => onNodeUpdate(selectedNode.id, { inputTargetNodeId: e.target.value })}\n                    className=\"mt-2 text-xs border-purple-200 dark:border-purple-700 focus:border-purple-500 focus:ring-purple-200\"\n                    placeholder=\"–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ ID —É–∑–ª–∞ –≤—Ä—É—á–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: ylObKToWFsIl-opIcowPZ)\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Universal User Input Collection */}\n        {selectedNode.type !== 'input' && !selectedNode.data.collectUserInput && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤</h3>\n            <div className=\"space-y-4\">\n              {/* Enable Input Collection */}\n              <div className=\"flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-primary/30 hover:bg-card/80 transition-all duration-200\">\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs font-medium text-foreground\">\n                    –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤\n                  </Label>\n                  <div className=\"text-xs text-muted-foreground mt-1\">\n                    –û–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n                  </div>\n                </div>\n                <div className=\"ml-4\">\n                  <Switch\n                    checked={selectedNode.data.collectUserInput ?? false}\n                    onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { collectUserInput: checked })}\n                  />\n                </div>\n              </div>\n\n              {/* Input Collection Settings */}\n              {selectedNode.data.collectUserInput && (\n                <div className=\"space-y-4 bg-gradient-to-br from-blue-50/50 to-indigo-50/30 dark:from-blue-950/20 dark:to-indigo-950/10 border border-blue-200/30 dark:border-blue-800/30 rounded-lg p-4\">\n                  \n\n                  \n                  {/* Text Input Toggle */}\n                  <div className=\"flex items-center justify-between p-3 rounded-lg bg-card/50 border border-blue-200/30 dark:border-blue-800/30 hover:border-blue-300 dark:hover:border-blue-700 transition-all duration-200\">\n                    <div className=\"flex-1\">\n                      <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300\">\n                        <i className=\"fas fa-keyboard mr-1\"></i>\n                        –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥\n                      </Label>\n                      <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\n                        –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥, —Ç–æ –∫–∞–∫ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –∏ –∫–Ω–æ–ø–∫–∏ –∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–π –≤–≤–æ–¥\n                      </div>\n                    </div>\n                    <div className=\"ml-4\">\n                      <Switch\n                        checked={selectedNode.data.enableTextInput ?? false}\n                        onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { enableTextInput: checked })}\n                      />\n                    </div>\n                  </div>\n\n\n\n                  {/* Button Type for button responses */}\n                  {selectedNode.data.responseType === 'buttons' && (\n                    <div>\n                      <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2 block\">\n                        <i className=\"fas fa-mouse mr-1\"></i>\n                        –¢–∏–ø –∫–Ω–æ–ø–æ–∫\n                      </Label>\n                      <Select\n                        value={selectedNode.data.inputButtonType || 'inline'}\n                        onValueChange={(value: 'inline' | 'reply') => onNodeUpdate(selectedNode.id, { inputButtonType: value })}\n                      >\n                        <SelectTrigger className=\"border-blue-200 dark:border-blue-700 focus:border-blue-500\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"inline\">Inline –∫–Ω–æ–ø–∫–∏</SelectItem>\n                          <SelectItem value=\"reply\">Reply –∫–Ω–æ–ø–∫–∏</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  )}\n\n                  {/* Response Options for buttons */}\n                  {selectedNode.data.responseType === 'buttons' && (\n                    <div>\n                      <div className=\"flex items-center justify-between mb-3\">\n                        <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300\">\n                          <i className=\"fas fa-list-ul mr-1\"></i>\n                          –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤\n                        </Label>\n                        <UIButton\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => {\n                            const newOption = {\n                              id: nanoid(),\n                              text: '–ù–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç',\n                              value: '',\n                              action: 'goto' as const,\n                              target: ''\n                            };\n                            const updatedOptions = [...(selectedNode.data.responseOptions || []), newOption];\n                            onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                          }}\n                          className=\"text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200\"\n                        >\n                          + –î–æ–±–∞–≤–∏—Ç—å\n                        </UIButton>\n                      </div>\n                      \n                      <div className=\"space-y-3\">\n                        {(selectedNode.data.responseOptions || []).map((option, index) => (\n                          <div key={option.id} className=\"bg-card/50 rounded-lg p-3 border border-border/50\">\n                            <div className=\"flex items-center justify-between mb-2\">\n                              <Input\n                                value={option.text}\n                                onChange={(e) => {\n                                  const updatedOptions = [...(selectedNode.data.responseOptions || [])];\n                                  updatedOptions[index] = { ...option, text: e.target.value };\n                                  onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                                }}\n                                className=\"flex-1 text-sm font-medium bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                                placeholder=\"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏\"\n                              />\n                              <UIButton\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => {\n                                  const updatedOptions = (selectedNode.data.responseOptions || []).filter((_, i) => i !== index);\n                                  onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                                }}\n                                className=\"text-muted-foreground hover:text-destructive h-auto p-1\"\n                              >\n                                <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                  <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                                </svg>\n                              </UIButton>\n                            </div>\n                            \n                            <div className=\"space-y-2\">\n                              <div>\n                                <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1 block\">\n                                  –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\n                                </Label>\n                                <Input\n                                  value={option.value || ''}\n                                  onChange={(e) => {\n                                    const updatedOptions = [...(selectedNode.data.responseOptions || [])];\n                                    updatedOptions[index] = { ...option, value: e.target.value };\n                                    onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                                  }}\n                                  className=\"text-xs border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200\"\n                                  placeholder=\"–ó–Ω–∞—á–µ–Ω–∏–µ (–µ—Å–ª–∏ –ø—É—Å—Ç–æ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏)\"\n                                />\n                              </div>\n                              \n                              {/* Navigation settings for each button */}\n                              <div>\n                                <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1 block\">\n                                  –î–µ–π—Å—Ç–≤–∏–µ –∫–Ω–æ–ø–∫–∏\n                                </Label>\n                                <Select\n                                  value={option.action || 'goto'}\n                                  onValueChange={(value: 'goto' | 'command' | 'url' | 'selection') => {\n                                    const updatedOptions = [...(selectedNode.data.responseOptions || [])];\n                                    updatedOptions[index] = { ...option, action: value };\n                                    onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                                  }}\n                                >\n                                  <SelectTrigger className=\"text-xs border-blue-200 dark:border-blue-700 focus:border-blue-500\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"goto\">\n                                      <div className=\"flex items-center gap-2\">\n                                        <i className=\"fas fa-arrow-right text-xs text-blue-500\"></i>\n                                        <span>–ü–µ—Ä–µ–π—Ç–∏ –∫ —ç–∫—Ä–∞–Ω—É</span>\n                                      </div>\n                                    </SelectItem>\n                                    <SelectItem value=\"command\">\n                                      <div className=\"flex items-center gap-2\">\n                                        <i className=\"fas fa-terminal text-xs text-purple-500\"></i>\n                                        <span>–í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</span>\n                                      </div>\n                                    </SelectItem>\n                                    <SelectItem value=\"url\">\n                                      <div className=\"flex items-center gap-2\">\n                                        <i className=\"fas fa-external-link-alt text-xs text-green-500\"></i>\n                                        <span>–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É</span>\n                                      </div>\n                                    </SelectItem>\n                                    <SelectItem value=\"selection\">\n                                      <div className=\"flex items-center gap-2\">\n                                        <i className=\"fas fa-check-square text-xs text-purple-500\"></i>\n                                        <span>–í—ã–±–æ—Ä –æ–ø—Ü–∏–∏</span>\n                                      </div>\n                                    </SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n\n                              {/* Target selection based on action type */}\n                              {option.action === 'goto' && (\n                                <div>\n                                  <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1 block\">\n                                    –í—ã–±–µ—Ä–∏—Ç–µ —ç–∫—Ä–∞–Ω\n                                  </Label>\n                                  <Select\n                                    value={option.target || ''}\n                                    onValueChange={(value) => {\n                                      const updatedOptions = [...(selectedNode.data.responseOptions || [])];\n                                      updatedOptions[index] = { ...option, target: value };\n                                      onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                                    }}\n                                  >\n                                    <SelectTrigger className=\"text-xs border-blue-200 dark:border-blue-700 focus:border-blue-500\">\n                                      <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ —ç–∫—Ä–∞–Ω –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ ID –≤—Ä—É—á–Ω—É—é\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      {/* –ö–æ–º–∞–Ω–¥—ã */}\n                                      {getAllNodesFromAllSheets\n                                        ?.filter(n => n.node.id !== selectedNode.id && (n.node.type === 'start' || n.node.type === 'command'))\n                                        .map(({node, sheetName}) => (\n                                          <SelectItem key={node.id} value={node.id}>\n                                            <div className=\"flex items-center gap-2\">\n                                              <i className=\"fas fa-terminal text-xs text-purple-500\"></i>\n                                              <span>{node.data.command}</span>\n                                              <span className=\"text-xs text-blue-600 dark:text-blue-400\">({sheetName})</span>\n                                            </div>\n                                          </SelectItem>\n                                        ))}\n                                      \n                                      {/* –î—Ä—É–≥–∏–µ —É–∑–ª—ã */}\n                                      {getAllNodesFromAllSheets\n                                        ?.filter(n => n.node.id !== selectedNode.id && n.node.type !== 'start' && n.node.type !== 'command')\n                                        .map(({node, sheetName}) => {\n                                          const nodeName = \n                                            node.type === 'message' ? '–°–æ–æ–±—â–µ–Ω–∏–µ' :\n                                            node.type === 'photo' ? '–§–æ—Ç–æ' :\n                                            node.type === 'video' ? '–í–∏–¥–µ–æ' :\n                                            node.type === 'audio' ? '–ê—É–¥–∏–æ' :\n                                            node.type === 'document' ? '–î–æ–∫—É–º–µ–Ω—Ç' :\n                                            node.type === 'keyboard' ? '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞' :\n                                            node.type === 'condition' ? '–£—Å–ª–æ–≤–∏–µ' :\n                                            node.data?.collectUserInput ? '–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö' :\n                                            node.data?.collectUserInput ? '–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö' :\n                                            node.type === 'location' ? '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è' :\n                                            node.type === 'contact' ? '–ö–æ–Ω—Ç–∞–∫—Ç' :\n                                            node.type === 'sticker' ? '–°—Ç–∏–∫–µ—Ä' :\n                                            node.type === 'voice' ? '–ì–æ–ª–æ—Å–æ–≤–æ–µ' :\n                                            node.type === 'animation' ? '–ê–Ω–∏–º–∞—Ü–∏—è' : '–£–∑–µ–ª';\n                                          \n                                          const iconClass = \n                                            node.type === 'message' ? 'fas fa-comment text-blue-500' :\n                                            node.type === 'photo' ? 'fas fa-image text-green-500' :\n                                            node.type === 'video' ? 'fas fa-video text-red-500' :\n                                            node.type === 'audio' ? 'fas fa-music text-orange-500' :\n                                            node.type === 'document' ? 'fas fa-file text-gray-500' :\n                                            node.type === 'keyboard' ? 'fas fa-keyboard text-yellow-500' :\n                                            node.type === 'condition' ? 'fas fa-code-branch text-purple-500' :\n                                            node.data?.collectUserInput ? 'fas fa-user-edit text-indigo-500' :\n                                            node.data?.collectUserInput ? 'fas fa-user-edit text-indigo-500' :\n                                            node.type === 'location' ? 'fas fa-map-marker-alt text-pink-500' :\n                                            node.type === 'contact' ? 'fas fa-address-book text-teal-500' :\n                                            node.type === 'sticker' ? 'fas fa-smile text-yellow-400' :\n                                            node.type === 'voice' ? 'fas fa-microphone text-blue-400' :\n                                            node.type === 'animation' ? 'fas fa-play-circle text-green-400' : 'fas fa-cube text-gray-400';\n                                          \n                                          return (\n                                            <SelectItem key={node.id} value={node.id}>\n                                              <div className=\"flex items-center gap-2\">\n                                                <i className={`${iconClass} text-xs`}></i>\n                                                <span>{nodeName}</span>\n                                                <span className=\"text-xs text-blue-600 dark:text-blue-400\">({sheetName})</span>\n                                              </div>\n                                            </SelectItem>\n                                          );\n                                        })}\n                                    </SelectContent>\n                                  </Select>\n                                  \n                                  {/* Manual ID input */}\n                                  <Input\n                                    value={option.target || ''}\n                                    onChange={(e) => {\n                                      const updatedOptions = [...(selectedNode.data.responseOptions || [])];\n                                      updatedOptions[index] = { ...option, target: e.target.value };\n                                      onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                                    }}\n                                    className=\"text-xs border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200 mt-1\"\n                                    placeholder=\"–∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ ID —ç–∫—Ä–∞–Ω–∞ –≤—Ä—É—á–Ω—É—é\"\n                                  />\n                                </div>\n                              )}\n\n                              {option.action === 'command' && (\n                                <div>\n                                  <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1 block\">\n                                    –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è\n                                  </Label>\n                                  <Input\n                                    value={option.target || ''}\n                                    onChange={(e) => {\n                                      const updatedOptions = [...(selectedNode.data.responseOptions || [])];\n                                      updatedOptions[index] = { ...option, target: e.target.value };\n                                      onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                                    }}\n                                    className=\"text-xs border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200\"\n                                    placeholder=\"–Ω–∞–ø—Ä–∏–º–µ—Ä: /start, /help, /menu\"\n                                  />\n                                </div>\n                              )}\n\n                              {option.action === 'url' && (\n                                <div>\n                                  <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1 block\">\n                                    –°—Å—ã–ª–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è\n                                  </Label>\n                                  <Input\n                                    value={option.url || ''}\n                                    onChange={(e) => {\n                                      const updatedOptions = [...(selectedNode.data.responseOptions || [])];\n                                      updatedOptions[index] = { ...option, url: e.target.value };\n                                      onNodeUpdate(selectedNode.id, { responseOptions: updatedOptions });\n                                    }}\n                                    className=\"text-xs border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200\"\n                                    placeholder=\"https://example.com\"\n                                  />\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Variable Name */}\n                  <div>\n                    <Label className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-2 block\">\n                      <i className=\"fas fa-tag mr-1\"></i>\n                      –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–≤–µ—Ç–∞\n                    </Label>\n                    <Input\n                      value={selectedNode.data.inputVariable || ''}\n                      onChange={(e) => onNodeUpdate(selectedNode.id, { inputVariable: e.target.value })}\n                      className=\"border-blue-200 dark:border-blue-700 focus:border-blue-500 focus:ring-blue-200\"\n                      placeholder=\"–Ω–∞–ø—Ä–∏–º–µ—Ä: –∏–º—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ—á—Ç–∞, —Ç–µ–ª–µ—Ñ–æ–Ω\"\n                    />\n                    <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\n                      –ü–æ–¥ —ç—Ç–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n                    </div>\n                  </div>\n\n\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Command Advanced Settings */}\n        {(selectedNode.type === 'start' || selectedNode.type === 'command') && (\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem value=\"advanced-settings\" className=\"border-border\">\n              <AccordionTrigger className=\"text-sm font-medium text-foreground hover:no-underline hover:text-foreground/90 transition-colors duration-200\">\n                <div className=\"flex items-center space-x-2\">\n                  <div className=\"w-4 h-4 rounded-full bg-gradient-to-r from-primary/20 to-primary/10 flex items-center justify-center\">\n                    <svg className=\"w-2.5 h-2.5 text-primary\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path fillRule=\"evenodd\" d=\"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z\" clipRule=\"evenodd\" />\n                    </svg>\n                  </div>\n                  <span className=\"bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\">\n                    –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–∞–Ω–¥—ã\n                  </span>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent className=\"bg-gradient-to-br from-background to-muted/20 dark:from-background dark:to-muted/10 border border-border/50 rounded-lg mt-2 overflow-hidden\">\n                <div className=\"space-y-4 p-4\">\n                  {/* Show in Menu Setting */}\n                  <div className=\"group flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-primary/30 hover:bg-card/80 transition-all duration-200\">\n                    <div className=\"flex-1\">\n                      <Label className=\"text-xs font-medium text-foreground group-hover:text-primary transition-colors duration-200\">\n                        –ü–æ–∫–∞–∑–∞—Ç—å –≤ –º–µ–Ω—é\n                      </Label>\n                      <div className=\"text-xs text-muted-foreground mt-1 leading-relaxed\">\n                        –ö–æ–º–∞–Ω–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è –≤ –º–µ–Ω—é @BotFather\n                      </div>\n                    </div>\n                    <div className=\"ml-4\">\n                      <Switch\n                        checked={selectedNode.data.showInMenu ?? true}\n                        onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { showInMenu: checked })}\n                        className=\"data-[state=checked]:bg-primary\"\n                      />\n                    </div>\n                  </div>\n                  \n                  {/* Private Only Setting */}\n                  <div className=\"group flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-warning/30 hover:bg-card/80 transition-all duration-200\">\n                    <div className=\"flex-1\">\n                      <Label className=\"text-xs font-medium text-foreground group-hover:text-warning transition-colors duration-200\">\n                        –¢–æ–ª—å–∫–æ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö\n                      </Label>\n                      <div className=\"text-xs text-muted-foreground mt-1 leading-relaxed\">\n                        –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –¥–∏–∞–ª–æ–≥–µ —Å –±–æ—Ç–æ–º\n                      </div>\n                    </div>\n                    <div className=\"ml-4\">\n                      <Switch\n                        checked={selectedNode.data.isPrivateOnly ?? false}\n                        onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { isPrivateOnly: checked })}\n                        className=\"data-[state=checked]:bg-warning\"\n                      />\n                    </div>\n                  </div>\n                  \n\n                  \n                  {/* Admin Only Setting */}\n                  <div className=\"group flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-destructive/30 hover:bg-card/80 transition-all duration-200\">\n                    <div className=\"flex-1\">\n                      <Label className=\"text-xs font-medium text-foreground group-hover:text-destructive transition-colors duration-200\">\n                        –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤\n                      </Label>\n                      <div className=\"text-xs text-muted-foreground mt-1 leading-relaxed\">\n                        –ö–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º\n                      </div>\n                    </div>\n                    <div className=\"ml-4\">\n                      <Switch\n                        checked={selectedNode.data.adminOnly ?? false}\n                        onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { adminOnly: checked })}\n                        className=\"data-[state=checked]:bg-destructive\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n        )}\n\n        <Separator />\n\n        {/* User Management Actions */}\n        <Accordion type=\"single\" collapsible className=\"w-full\">\n          <AccordionItem value=\"user-management\" className=\"border-border\">\n            <AccordionTrigger className=\"text-sm font-medium text-foreground hover:no-underline hover:text-foreground/90 transition-colors duration-200\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-4 h-4 rounded-full bg-gradient-to-r from-orange-500/20 to-red-500/10 flex items-center justify-center\">\n                  <svg className=\"w-2.5 h-2.5 text-orange-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                    <path fillRule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clipRule=\"evenodd\" />\n                  </svg>\n                </div>\n                <span className=\"bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent\">\n                  –î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n                </span>\n              </div>\n            </AccordionTrigger>\n            <AccordionContent className=\"bg-gradient-to-br from-orange-50/20 to-red-50/10 dark:from-orange-950/10 dark:to-red-950/5 border border-orange-200/30 dark:border-orange-800/20 rounded-lg mt-2 overflow-hidden\">\n              <div className=\"space-y-4 p-4\">\n                \n                {/* Enable User Actions */}\n                <div className=\"group flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-orange-300 hover:bg-card/80 transition-all duration-200\">\n                  <div className=\"flex-1\">\n                    <Label className=\"text-xs font-medium text-foreground group-hover:text-orange-600 transition-colors duration-200\">\n                      –í–∫–ª—é—á–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n                    </Label>\n                    <div className=\"text-xs text-muted-foreground mt-1 leading-relaxed\">\n                      –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞\n                    </div>\n                  </div>\n                  <div className=\"ml-4\">\n                    <Switch\n                      checked={selectedNode.data.enableUserActions ?? false}\n                      onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { enableUserActions: checked })}\n                      className=\"data-[state=checked]:bg-orange-500\"\n                    />\n                  </div>\n                </div>\n\n                {/* User Actions Configuration */}\n                {selectedNode.data.enableUserActions && (\n                  <div className=\"space-y-4 border-t border-border/50 pt-4\">\n                    \n                    {/* Action Trigger */}\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        –£—Å–ª–æ–≤–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è\n                      </Label>\n                      <Select\n                        value={selectedNode.data.actionTrigger || 'on_any_response'}\n                        onValueChange={(value) => onNodeUpdate(selectedNode.id, { actionTrigger: value })}\n                      >\n                        <SelectTrigger className=\"border-orange-200 dark:border-orange-700\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"on_any_response\">–ü—Ä–∏ –ª—é–±–æ–º –æ—Ç–≤–µ—Ç–µ</SelectItem>\n                          <SelectItem value=\"on_button_click\">–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏</SelectItem>\n                          <SelectItem value=\"on_text_input\">–ü—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞</SelectItem>\n                          <SelectItem value=\"on_specific_text\">–ü—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ç–µ–∫—Å—Ç–µ</SelectItem>\n                          <SelectItem value=\"on_first_interaction\">–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    {/* Specific Text Trigger */}\n                    {selectedNode.data.actionTrigger === 'on_specific_text' && (\n                      <div>\n                        <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                          –¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç\n                        </Label>\n                        <Input\n                          value={selectedNode.data.triggerText || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { triggerText: e.target.value })}\n                          className=\"border-orange-200 dark:border-orange-700\"\n                          placeholder=\"–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å—Ç–æ–ø, –±–ª–æ–∫, –∞–¥–º–∏–Ω\"\n                        />\n                      </div>\n                    )}\n\n                    {/* User Action Type */}\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        –î–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º\n                      </Label>\n                      <Select\n                        value={selectedNode.data.userActionType || 'none'}\n                        onValueChange={(value) => onNodeUpdate(selectedNode.id, { userActionType: value })}\n                      >\n                        <SelectTrigger className=\"border-orange-200 dark:border-orange-700\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"none\">–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è</SelectItem>\n                          <SelectItem value=\"block_user\">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</SelectItem>\n                          <SelectItem value=\"unblock_user\">‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</SelectItem>\n                          <SelectItem value=\"give_premium\">üëë –î–∞—Ç—å Premium —Å—Ç–∞—Ç—É—Å</SelectItem>\n                          <SelectItem value=\"remove_premium\">‚ùå –£–±—Ä–∞—Ç—å Premium —Å—Ç–∞—Ç—É—Å</SelectItem>\n                          <SelectItem value=\"mark_active\">üü¢ –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ</SelectItem>\n                          <SelectItem value=\"mark_inactive\">üü° –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ</SelectItem>\n                          <SelectItem value=\"add_tag\">üè∑Ô∏è –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥</SelectItem>\n                          <SelectItem value=\"remove_tag\">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–µ–≥</SelectItem>\n                          <SelectItem value=\"kick_user\">üö™ –ö–∏–∫–Ω—É—Ç—å –∏–∑ –≥—Ä—É–ø–ø—ã</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    {/* Tag Input for Add/Remove Tag Actions */}\n                    {(selectedNode.data.userActionType === 'add_tag' || selectedNode.data.userActionType === 'remove_tag') && (\n                      <div>\n                        <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                          –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞\n                        </Label>\n                        <Input\n                          value={selectedNode.data.actionTag || ''}\n                          onChange={(e) => onNodeUpdate(selectedNode.id, { actionTag: e.target.value })}\n                          className=\"border-orange-200 dark:border-orange-700\"\n                          placeholder=\"–Ω–∞–ø—Ä–∏–º–µ—Ä: vip, problem_user, new_customer\"\n                        />\n                      </div>\n                    )}\n\n                    {/* Action Message */}\n                    <div>\n                      <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300 mb-2 block\">\n                        –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\n                      </Label>\n                      <Textarea\n                        value={selectedNode.data.actionMessage || ''}\n                        onChange={(e) => onNodeUpdate(selectedNode.id, { actionMessage: e.target.value })}\n                        className=\"border-orange-200 dark:border-orange-700\"\n                        placeholder=\"–ù–∞–ø—Ä–∏–º–µ—Ä: –í–∞—à —Å—Ç–∞—Ç—É—Å –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\"\n                        rows={2}\n                      />\n                    </div>\n\n                    {/* Silent Action */}\n                    <div className=\"group flex items-center justify-between p-3 rounded-lg bg-card/50 border border-orange-200/30 dark:border-orange-800/30 hover:border-orange-300 dark:hover:border-orange-700 transition-all duration-200\">\n                      <div className=\"flex-1\">\n                        <Label className=\"text-xs font-medium text-orange-700 dark:text-orange-300\">\n                          –¢–∏—Ö–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ\n                        </Label>\n                        <div className=\"text-xs text-orange-600 dark:text-orange-400 mt-1\">\n                          –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n                        </div>\n                      </div>\n                      <div className=\"ml-4\">\n                        <Switch\n                          checked={selectedNode.data.silentAction ?? false}\n                          onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { silentAction: checked })}\n                          className=\"data-[state=checked]:bg-orange-500\"\n                        />\n                      </div>\n                    </div>\n\n                  </div>\n                )}\n              </div>\n            </AccordionContent>\n          </AccordionItem>\n        </Accordion>\n\n        <Separator />\n\n        {/* Keyboard Advanced Settings */}\n        {selectedNode.data.keyboardType === 'reply' && (\n          <div className=\"bg-gradient-to-br from-background to-muted/20 dark:from-background dark:to-muted/10 border border-border/50 rounded-lg p-4\">\n            <div className=\"flex items-center space-x-2 mb-4\">\n              <div className=\"w-4 h-4 rounded-full bg-gradient-to-r from-secondary/20 to-secondary/10 flex items-center justify-center\">\n                <svg className=\"w-2.5 h-2.5 text-secondary-foreground\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\n                </svg>\n              </div>\n              <h3 className=\"text-sm font-medium text-foreground bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text\">\n                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\n              </h3>\n            </div>\n            \n            <div className=\"space-y-4\">\n              <div className=\"group flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-secondary/30 hover:bg-card/80 transition-all duration-200\">\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs font-medium text-foreground group-hover:text-secondary transition-colors duration-200\">\n                    –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞\n                  </Label>\n                  <div className=\"text-xs text-muted-foreground mt-1 leading-relaxed\">\n                    –°–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è\n                  </div>\n                </div>\n                <div className=\"ml-4\">\n                  <Switch\n                    checked={selectedNode.data.oneTimeKeyboard}\n                    onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { oneTimeKeyboard: checked })}\n                    className=\"data-[state=checked]:bg-secondary\"\n                  />\n                </div>\n              </div>\n              \n              <div className=\"group flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50 hover:border-secondary/30 hover:bg-card/80 transition-all duration-200\">\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs font-medium text-foreground group-hover:text-secondary transition-colors duration-200\">\n                    –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã\n                  </Label>\n                  <div className=\"text-xs text-muted-foreground mt-1 leading-relaxed\">\n                    –ü–æ–¥–æ–≥–Ω–∞—Ç—å –ø–æ–¥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ\n                  </div>\n                </div>\n                <div className=\"ml-4\">\n                  <Switch\n                    checked={selectedNode.data.resizeKeyboard}\n                    onCheckedChange={(checked) => onNodeUpdate(selectedNode.id, { resizeKeyboard: checked })}\n                    className=\"data-[state=checked]:bg-secondary\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Properties Footer */}\n      <div className=\"p-4 border-t border-border bg-gradient-to-r from-background to-muted/10 dark:from-background dark:to-muted/5\">\n        <div className=\"flex space-x-2\">\n          <UIButton \n            variant=\"outline\" \n            className=\"flex-1 hover:bg-muted/80 dark:hover:bg-muted/60 transition-all duration-200\"\n            onClick={() => {\n              // Reset to default values\n              onNodeUpdate(selectedNode.id, {\n                messageText: '',\n                keyboardType: 'none',\n                buttons: [],\n                markdown: false,\n                oneTimeKeyboard: false,\n                resizeKeyboard: true\n              });\n            }}\n          >\n            –°–±—Ä–æ—Å–∏—Ç—å\n          </UIButton>\n          <UIButton className=\"flex-1 bg-primary hover:bg-primary/90 dark:bg-primary dark:hover:bg-primary/80 transition-all duration-200\">\n            –ü—Ä–∏–º–µ–Ω–∏—Ç—å\n          </UIButton>\n        </div>\n      </div>\n    </aside>\n  );\n}\n","size_bytes":292451},"client/src/components/editor/quick-format-toolbar.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { Separator } from '@/components/ui/separator';\nimport { Badge } from '@/components/ui/badge';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { \n  Bold, \n  Italic, \n  Underline, \n  Strikethrough, \n  Code, \n  Link, \n  List,\n  ListOrdered,\n  Quote,\n  Smile,\n  Zap,\n  Star,\n  CheckSquare,\n  AlertTriangle,\n  Heart,\n  Phone,\n  Mail,\n  MapPin,\n  Calendar,\n  Clock,\n  Settings,\n  Sparkles,\n  Plus\n} from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface QuickFormatToolbarProps {\n  onInsert: (text: string) => void;\n  isMarkdown?: boolean;\n}\n\nexport function QuickFormatToolbar({ onInsert, isMarkdown = false }: QuickFormatToolbarProps) {\n  const { toast } = useToast();\n\n  const formatButtons = [\n    { \n      icon: Bold, \n      name: '–ñ–∏—Ä–Ω—ã–π', \n      markdown: '**—Ç–µ–∫—Å—Ç**', \n      html: '<b>—Ç–µ–∫—Å—Ç</b>',\n      shortcut: 'Ctrl+B'\n    },\n    { \n      icon: Italic, \n      name: '–ö—É—Ä—Å–∏–≤', \n      markdown: '_—Ç–µ–∫—Å—Ç_', \n      html: '<i>—Ç–µ–∫—Å—Ç</i>',\n      shortcut: 'Ctrl+I'\n    },\n    { \n      icon: Underline, \n      name: '–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π', \n      markdown: '__—Ç–µ–∫—Å—Ç__', \n      html: '<u>—Ç–µ–∫—Å—Ç</u>',\n      shortcut: 'Ctrl+U'\n    },\n    { \n      icon: Strikethrough, \n      name: '–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π', \n      markdown: '~—Ç–µ–∫—Å—Ç~', \n      html: '<s>—Ç–µ–∫—Å—Ç</s>',\n      shortcut: 'Ctrl+Shift+X'\n    },\n    { \n      icon: Code, \n      name: '–ö–æ–¥', \n      markdown: '`–∫–æ–¥`', \n      html: '<code>–∫–æ–¥</code>',\n      shortcut: 'Ctrl+E'\n    },\n    { \n      icon: Link, \n      name: '–°—Å—ã–ª–∫–∞', \n      markdown: '[—Ç–µ–∫—Å—Ç](url)', \n      html: '<a href=\"url\">—Ç–µ–∫—Å—Ç</a>',\n      shortcut: 'Ctrl+K'\n    }\n  ];\n\n  const quickEmojis = [\n    { emoji: 'üëç', name: '–õ–∞–π–∫' },\n    { emoji: '‚ù§Ô∏è', name: '–°–µ—Ä–¥—Ü–µ' },\n    { emoji: 'üî•', name: '–û–≥–æ–Ω—å' },\n    { emoji: '‚≠ê', name: '–ó–≤–µ–∑–¥–∞' },\n    { emoji: '‚úÖ', name: '–ì–∞–ª–æ—á–∫–∞' },\n    { emoji: '‚ö†Ô∏è', name: '–í–Ω–∏–º–∞–Ω–∏–µ' },\n    { emoji: 'üìû', name: '–¢–µ–ª–µ—Ñ–æ–Ω' },\n    { emoji: 'üìß', name: 'Email' },\n    { emoji: 'üìç', name: '–õ–æ–∫–∞—Ü–∏—è' },\n    { emoji: '‚è∞', name: '–í—Ä–µ–º—è' },\n    { emoji: 'üöÄ', name: '–†–∞–∫–µ—Ç–∞' },\n    { emoji: 'üí°', name: '–ò–¥–µ—è' }\n  ];\n\n  const quickSymbols = [\n    { symbol: '‚Ä¢', name: '–ú–∞—Ä–∫–µ—Ä' },\n    { symbol: '‚Üí', name: '–°—Ç—Ä–µ–ª–∫–∞' },\n    { symbol: '‚úì', name: '–ì–∞–ª–æ—á–∫–∞' },\n    { symbol: '‚úó', name: '–ö—Ä–µ—Å—Ç–∏–∫' },\n    { symbol: '‚Äî', name: '–¢–∏—Ä–µ' },\n    { symbol: '‚Ä¶', name: '–ú–Ω–æ–≥–æ—Ç–æ—á–∏–µ' },\n    { symbol: '¬´¬ª', name: '–ö–∞–≤—ã—á–∫–∏' },\n    { symbol: '‚Ññ', name: '–ù–æ–º–µ—Ä' },\n    { symbol: '¬©', name: '–ö–æ–ø–∏—Ä–∞–π—Ç' },\n    { symbol: '¬Æ', name: '–¢–æ–≤–∞—Ä–Ω—ã–π –∑–Ω–∞–∫' },\n    { symbol: '‚Ñ¢', name: '–¢–æ—Ä–≥–æ–≤–∞—è –º–∞—Ä–∫–∞' },\n    { symbol: '¬ß', name: '–ü–∞—Ä–∞–≥—Ä–∞—Ñ' }\n  ];\n\n  const quickTemplates = [\n    {\n      name: '–°–ø–∏—Å–æ–∫',\n      icon: List,\n      template: isMarkdown ? '‚Ä¢ –ü—É–Ω–∫—Ç 1\\n‚Ä¢ –ü—É–Ω–∫—Ç 2\\n‚Ä¢ –ü—É–Ω–∫—Ç 3' : '‚Ä¢ –ü—É–Ω–∫—Ç 1<br>‚Ä¢ –ü—É–Ω–∫—Ç 2<br>‚Ä¢ –ü—É–Ω–∫—Ç 3'\n    },\n    {\n      name: '–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫',\n      icon: ListOrdered,\n      template: isMarkdown ? '1. –ü—É–Ω–∫—Ç 1\\n2. –ü—É–Ω–∫—Ç 2\\n3. –ü—É–Ω–∫—Ç 3' : '1. –ü—É–Ω–∫—Ç 1<br>2. –ü—É–Ω–∫—Ç 2<br>3. –ü—É–Ω–∫—Ç 3'\n    },\n    {\n      name: '–¶–∏—Ç–∞—Ç–∞',\n      icon: Quote,\n      template: isMarkdown ? '> –≠—Ç–æ —Ü–∏—Ç–∞—Ç–∞' : '<blockquote>–≠—Ç–æ —Ü–∏—Ç–∞—Ç–∞</blockquote>'\n    },\n    {\n      name: '–ó–∞–¥–∞—á–∏',\n      icon: CheckSquare,\n      template: '‚òê –ó–∞–¥–∞—á–∞ 1\\n‚òê –ó–∞–¥–∞—á–∞ 2\\n‚òë –í—ã–ø–æ–ª–Ω–µ–Ω–æ'\n    },\n    {\n      name: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',\n      icon: AlertTriangle,\n      template: '‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ!**\\n–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'\n    },\n    {\n      name: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',\n      icon: Phone,\n      template: 'üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67\\nüìß Email: example@email.com'\n    }\n  ];\n\n  const handleInsert = (text: string, name: string) => {\n    onInsert(text);\n    toast({\n      title: \"–î–æ–±–∞–≤–ª–µ–Ω–æ\",\n      description: `${name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ç–µ–∫—Å—Ç`\n    });\n  };\n\n  return (\n    <div className=\"flex flex-wrap gap-2 p-3 bg-muted/30 rounded-lg border\">\n      {/* Format buttons */}\n      <div className=\"flex gap-1\">\n        {formatButtons.map((format) => (\n          <Button\n            key={format.name}\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => handleInsert(isMarkdown ? format.markdown : format.html, format.name)}\n            className=\"h-8 w-8 p-0\"\n            title={`${format.name} (${format.shortcut})`}\n          >\n            <format.icon className=\"w-3 h-3\" />\n          </Button>\n        ))}\n      </div>\n\n      <Separator orientation=\"vertical\" className=\"h-6\" />\n\n      {/* Quick emojis */}\n      <div className=\"flex gap-1\">\n        {quickEmojis.slice(0, 6).map((item) => (\n          <Button\n            key={item.emoji}\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => handleInsert(item.emoji, item.name)}\n            className=\"h-8 w-8 p-0\"\n            title={item.name}\n          >\n            {item.emoji}\n          </Button>\n        ))}\n        \n        <Popover>\n          <PopoverTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\" title=\"–ë–æ–ª—å—à–µ —ç–º–æ–¥–∑–∏\">\n              <Plus className=\"w-3 h-3\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-64 p-3\" align=\"start\">\n            <div className=\"grid grid-cols-6 gap-1\">\n              {quickEmojis.map((item) => (\n                <Button\n                  key={item.emoji}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => handleInsert(item.emoji, item.name)}\n                  className=\"h-8 w-8 p-0\"\n                  title={item.name}\n                >\n                  {item.emoji}\n                </Button>\n              ))}\n            </div>\n          </PopoverContent>\n        </Popover>\n      </div>\n\n      <Separator orientation=\"vertical\" className=\"h-6\" />\n\n      {/* Quick symbols */}\n      <div className=\"flex gap-1\">\n        {quickSymbols.slice(0, 4).map((item) => (\n          <Button\n            key={item.symbol}\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => handleInsert(item.symbol, item.name)}\n            className=\"h-8 w-8 p-0 text-xs\"\n            title={item.name}\n          >\n            {item.symbol}\n          </Button>\n        ))}\n        \n        <Popover>\n          <PopoverTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\" title=\"–ë–æ–ª—å—à–µ —Å–∏–º–≤–æ–ª–æ–≤\">\n              <Sparkles className=\"w-3 h-3\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-64 p-3\" align=\"start\">\n            <div className=\"grid grid-cols-4 gap-1\">\n              {quickSymbols.map((item) => (\n                <Button\n                  key={item.symbol}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => handleInsert(item.symbol, item.name)}\n                  className=\"h-8 justify-start text-xs\"\n                  title={item.name}\n                >\n                  {item.symbol}\n                </Button>\n              ))}\n            </div>\n          </PopoverContent>\n        </Popover>\n      </div>\n\n      <Separator orientation=\"vertical\" className=\"h-6\" />\n\n      {/* Quick templates */}\n      <Popover>\n        <PopoverTrigger asChild>\n          <Button variant=\"ghost\" size=\"sm\" className=\"h-8 px-2 text-xs\" title=\"–®–∞–±–ª–æ–Ω—ã\">\n            <Settings className=\"w-3 h-3 mr-1\" />\n            –®–∞–±–ª–æ–Ω—ã\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-64 p-3\" align=\"start\">\n          <div className=\"space-y-1\">\n            {quickTemplates.map((template) => (\n              <Button\n                key={template.name}\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => handleInsert(template.template, template.name)}\n                className=\"w-full justify-start h-8 text-xs\"\n              >\n                <template.icon className=\"w-3 h-3 mr-2\" />\n                {template.name}\n              </Button>\n            ))}\n          </div>\n        </PopoverContent>\n      </Popover>\n\n      {/* Format mode indicator */}\n      <div className=\"ml-auto flex items-center\">\n        <Badge variant=\"outline\" className=\"text-xs\">\n          {isMarkdown ? 'Markdown' : 'HTML'}\n        </Badge>\n      </div>\n    </div>\n  );\n}","size_bytes":8743},"client/src/components/editor/responses-panel.tsx":{"content":"import React, { useState, useMemo } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { apiRequest } from '@/lib/queryClient';\nimport { \n  MessageSquare, \n  Search, \n  Filter, \n  Download, \n  Eye, \n  Calendar,\n  RefreshCw,\n  User,\n  FileText,\n  Clock,\n  Hash,\n  MessageCircle,\n  Settings\n} from 'lucide-react';\n\ninterface ResponsesData {\n  user_id: string;\n  username: string;\n  first_name: string;\n  last_name: string;\n  registered_at: string;\n  last_interaction: string;\n  responses: Array<{\n    key: string;\n    value: string;\n    type: string;\n    timestamp: string;\n    nodeId?: string;\n    prompt?: string;\n    variable?: string;\n  }>;\n  responseCount: number;\n}\n\ninterface ResponsesPanelProps {\n  projectId: number;\n  projectName: string;\n}\n\ntype SortField = 'last_interaction' | 'responseCount' | 'registered_at' | 'first_name';\ntype SortDirection = 'asc' | 'desc';\n\nexport function ResponsesPanel({ projectId, projectName }: ResponsesPanelProps) {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedUser, setSelectedUser] = useState<ResponsesData | null>(null);\n  const [showResponseDetails, setShowResponseDetails] = useState(false);\n  const [sortField, setSortField] = useState<SortField>('last_interaction');\n  const [sortDirection, setSortDirection] = useState<SortDirection>('desc');\n  const [filterResponseType, setFilterResponseType] = useState<string>('all');\n  const [showTechnicalDetails, setShowTechnicalDetails] = useState<boolean>(false);\n\n  // Fetch responses data\n  const { data: responsesData = [], isLoading, refetch } = useQuery<ResponsesData[]>({\n    queryKey: [`/api/projects/${projectId}/responses`],\n    staleTime: 10000, // –ö–µ—à–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥\n    refetchInterval: 30000, // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ 5\n    refetchIntervalInBackground: false, // –ù–µ –æ–ø—Ä–∞—à–∏–≤–∞–µ–º –≤ —Ñ–æ–Ω–µ\n  });\n\n  // Debug logging\n  React.useEffect(() => {\n    console.log('Responses data updated:', responsesData);\n  }, [responsesData]);\n\n  // Filter and sort responses\n  const filteredAndSortedResponses = useMemo(() => {\n    let result = responsesData;\n\n    // Apply search filter\n    if (searchQuery.length > 0) {\n      const query = searchQuery.toLowerCase();\n      result = result.filter(user => \n        (user.first_name?.toLowerCase().includes(query)) ||\n        (user.last_name?.toLowerCase().includes(query)) ||\n        (user.username?.toLowerCase().includes(query)) ||\n        (user.user_id?.includes(query)) ||\n        user.responses.some(response => response.value?.toLowerCase().includes(query))\n      );\n    }\n\n    // Apply response type filter\n    if (filterResponseType !== 'all') {\n      result = result.filter(user => \n        user.responses.some(response => response.type === filterResponseType)\n      );\n    }\n\n    // Sort\n    result = [...result].sort((a, b) => {\n      let aValue: any, bValue: any;\n      \n      switch (sortField) {\n        case 'last_interaction':\n          aValue = new Date(a.last_interaction || 0).getTime();\n          bValue = new Date(b.last_interaction || 0).getTime();\n          break;\n        case 'registered_at':\n          aValue = new Date(a.registered_at || 0).getTime();\n          bValue = new Date(b.registered_at || 0).getTime();\n          break;\n        case 'responseCount':\n          aValue = a.responseCount;\n          bValue = b.responseCount;\n          break;\n        case 'first_name':\n          aValue = (a.first_name || '').toLowerCase();\n          bValue = (b.first_name || '').toLowerCase();\n          break;\n        default:\n          aValue = a[sortField];\n          bValue = b[sortField];\n      }\n\n      if (sortDirection === 'asc') {\n        return aValue > bValue ? 1 : -1;\n      } else {\n        return aValue < bValue ? 1 : -1;\n      }\n    });\n\n    return result;\n  }, [responsesData, searchQuery, filterResponseType, sortField, sortDirection]);\n\n  const formatDate = (date: string | null) => {\n    if (!date) return '–ù–∏–∫–æ–≥–¥–∞';\n    return new Date(date).toLocaleString('ru-RU', {\n      timeZone: 'Europe/Moscow',\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const formatUserName = (user: ResponsesData) => {\n    const parts = [user.first_name, user.last_name].filter(Boolean);\n    if (parts.length > 0) return parts.join(' ');\n    if (user.username) return `@${user.username}`;\n    return `ID: ${user.user_id}`;\n  };\n\n  const getResponseTypeColor = (type: string) => {\n    switch (type) {\n      case 'text': return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';\n      case 'button': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';\n      case 'number': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';\n      case 'email': return 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';\n      case 'phone': return 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200';\n      case 'inline_button': return 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200';\n      case 'reply_button': return 'bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200';\n      case 'button_choice': return 'bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200';\n      default: return 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200';\n    }\n  };\n\n  const formatResponseKey = (key: string, type?: string) => {\n    if (key === 'button_click') return '–î–µ–π—Å—Ç–≤–∏–µ';\n    if (key.startsWith('response_')) return key.replace('response_', '–û—Ç–≤–µ—Ç ');\n    if (type === 'inline_button' || type === 'button') return '–í—ã–±–æ—Ä';\n    if (key === '–∏—Å—Ç–æ—á–Ω–∏–∫') return '–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';\n    if (key === '–∂–µ–ª–∞–Ω–∏–µ') return '–ñ–µ–ª–∞–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å';\n    if (key === '–ø–æ–ª') return '–ü–æ–ª';\n    if (key === '–∏–º—è') return '–ò–º—è';\n    if (key === '–≤–æ–∑—Ä–∞—Å—Ç') return '–í–æ–∑—Ä–∞—Å—Ç';\n    return key;\n  };\n\n  const formatResponseValue = (value: string, type?: string, key?: string) => {\n    // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ node ID, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –ø–æ–Ω—è—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\n    if (typeof value === 'string') {\n      if (value.match(/^--[a-zA-Z0-9_-]{10,}$/) ||\n          value.match(/^[a-zA-Z0-9_-]{15,}$/) ||\n          value.match(/^[a-zA-Z0-9-]{20,}$/)) {\n        return '–ü—Ä–æ–¥–æ–ª–∂–∏–ª –¥–∏–∞–ª–æ–≥';\n      }\n      // –£–ª—É—á—à–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π\n      if ((value === '–ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏' || value === '–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É') && key === 'button_click') {\n        return '–ü—Ä–æ–¥–æ–ª–∂–∏–ª –¥–∏–∞–ª–æ–≥';\n      }\n    }\n    return value;\n  };\n\n  // Get unique response types for filter\n  const responseTypes = useMemo(() => {\n    const types = new Set<string>();\n    responsesData.forEach(user => {\n      user.responses.forEach(response => {\n        if (response.type) types.add(response.type);\n      });\n    });\n    return Array.from(types);\n  }, [responsesData]);\n\n  const exportResponses = () => {\n    const csvContent = [\n      ['User ID', 'Name', 'Username', 'Response Key', 'Response', 'Type', 'Timestamp', 'Node ID'].join(','),\n      ...filteredAndSortedResponses.flatMap(user =>\n        user.responses.map(response => [\n          user.user_id,\n          `\"${formatUserName(user)}\"`,\n          user.username || '',\n          formatResponseKey(response.key, response.type),\n          `\"${response.value}\"`,\n          response.type,\n          response.timestamp || '',\n          response.nodeId || ''\n        ].join(','))\n      )\n    ].join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = `responses_${projectName}_${new Date().toISOString().split('T')[0]}.csv`;\n    link.click();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"h-full flex items-center justify-center\">\n        <div className=\"text-center\">\n          <RefreshCw className=\"w-8 h-8 animate-spin text-muted-foreground mx-auto mb-2\" />\n          <p className=\"text-muted-foreground\">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col bg-background\">\n      <div className=\"border-b bg-card\">\n        <div className=\"p-4\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <h2 className=\"text-xl font-semibold flex items-center gap-2\">\n                <MessageSquare className=\"w-5 h-5\" />\n                –û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n              </h2>\n              <p className=\"text-sm text-muted-foreground\">\n                –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –±–æ—Ç–∞ \"{projectName}\"\n              </p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button onClick={() => refetch()} variant=\"outline\" size=\"sm\">\n                <RefreshCw className=\"w-4 h-4 mr-1\" />\n                –û–±–Ω–æ–≤–∏—Ç—å\n              </Button>\n              <Button onClick={exportResponses} variant=\"outline\" size=\"sm\">\n                <Download className=\"w-4 h-4 mr-1\" />\n                –≠–∫—Å–ø–æ—Ä—Ç CSV\n              </Button>\n              <Button \n                onClick={() => setShowTechnicalDetails(!showTechnicalDetails)} \n                variant={showTechnicalDetails ? \"default\" : \"outline\"} \n                size=\"sm\"\n              >\n                <Settings className=\"w-4 h-4 mr-1\" />\n                {showTechnicalDetails ? '–°–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏' : '–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏'}\n              </Button>\n            </div>\n          </div>\n\n          {/* Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4\">\n            <Card className=\"p-3\">\n              <div className=\"flex items-center gap-2\">\n                <User className=\"w-4 h-4 text-blue-500\" />\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>\n                  <p className=\"text-sm font-semibold\">{responsesData.length}</p>\n                </div>\n              </div>\n            </Card>\n            <Card className=\"p-3\">\n              <div className=\"flex items-center gap-2\">\n                <MessageCircle className=\"w-4 h-4 text-green-500\" />\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤</p>\n                  <p className=\"text-sm font-semibold\">\n                    {responsesData.reduce((sum, user) => sum + user.responseCount, 0)}\n                  </p>\n                </div>\n              </div>\n            </Card>\n            <Card className=\"p-3\">\n              <div className=\"flex items-center gap-2\">\n                <Hash className=\"w-4 h-4 text-purple-500\" />\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">–¢–∏–ø–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤</p>\n                  <p className=\"text-sm font-semibold\">{responseTypes.length}</p>\n                </div>\n              </div>\n            </Card>\n            <Card className=\"p-3\">\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"w-4 h-4 text-orange-500\" />\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">–°—Ä–µ–¥. –æ—Ç–≤–µ—Ç–æ–≤</p>\n                  <p className=\"text-sm font-semibold\">\n                    {responsesData.length > 0 \n                      ? Math.round(responsesData.reduce((sum, user) => sum + user.responseCount, 0) / responsesData.length)\n                      : 0}\n                  </p>\n                </div>\n              </div>\n            </Card>\n          </div>\n\n          {/* Search and Filters */}\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            <div className=\"flex-1 relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, username, ID –∏–ª–∏ —Ç–µ–∫—Å—Ç—É –æ—Ç–≤–µ—Ç–∞...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <div className=\"flex gap-2\">\n              <Select value={filterResponseType} onValueChange={setFilterResponseType}>\n                <SelectTrigger className=\"w-40\">\n                  <SelectValue placeholder=\"–¢–∏–ø –æ—Ç–≤–µ—Ç–∞\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">–í—Å–µ —Ç–∏–ø—ã</SelectItem>\n                  {responseTypes.map(type => (\n                    <SelectItem key={type} value={type}>\n                      {type === 'text' ? '–¢–µ–∫—Å—Ç' : \n                       type === 'button' ? '–ö–Ω–æ–ø–∫–∞' :\n                       type === 'number' ? '–ß–∏—Å–ª–æ' :\n                       type === 'email' ? 'Email' :\n                       type === 'phone' ? '–¢–µ–ª–µ—Ñ–æ–Ω' :\n                       type === 'inline_button' ? '–ò–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞' :\n                       type === 'reply_button' ? 'Reply –∫–Ω–æ–ø–∫–∞' :\n                       type === 'button_choice' ? '–í—ã–±–æ—Ä –∫–Ω–æ–ø–∫–∏' :\n                       type}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              <Select value={`${sortField}-${sortDirection}`} onValueChange={(value) => {\n                const [field, direction] = value.split('-') as [SortField, SortDirection];\n                setSortField(field);\n                setSortDirection(direction);\n              }}>\n                <SelectTrigger className=\"w-48\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"last_interaction-desc\">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Üì</SelectItem>\n                  <SelectItem value=\"last_interaction-asc\">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Üë</SelectItem>\n                  <SelectItem value=\"responseCount-desc\">–ë–æ–ª—å—à–µ –æ—Ç–≤–µ—Ç–æ–≤ ‚Üì</SelectItem>\n                  <SelectItem value=\"responseCount-asc\">–ú–µ–Ω—å—à–µ –æ—Ç–≤–µ—Ç–æ–≤ ‚Üë</SelectItem>\n                  <SelectItem value=\"registered_at-desc\">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Üì</SelectItem>\n                  <SelectItem value=\"registered_at-asc\">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Üë</SelectItem>\n                  <SelectItem value=\"first_name-asc\">–ü–æ –∏–º–µ–Ω–∏ ‚Üë</SelectItem>\n                  <SelectItem value=\"first_name-desc\">–ü–æ –∏–º–µ–Ω–∏ ‚Üì</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 overflow-hidden\">\n        <ScrollArea className=\"h-full\">\n          <div className=\"p-4\">\n            {filteredAndSortedResponses.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <MessageSquare className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium text-muted-foreground mb-2\">\n                  {searchQuery ? '–û—Ç–≤–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : '–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤'}\n                </h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  {searchQuery \n                    ? '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞' \n                    : '–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å, –∫–æ–≥–¥–∞ –æ–Ω–∏ –Ω–∞—á–Ω—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –±–æ—Ç–æ–º'}\n                </p>\n              </div>\n            ) : (\n              <div className=\"grid gap-4\">\n                {filteredAndSortedResponses.map((user) => (\n                  <Card key={user.user_id} className=\"hover:shadow-md transition-shadow\">\n                    <CardHeader className=\"pb-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                            <User className=\"w-5 h-5 text-primary\" />\n                          </div>\n                          <div>\n                            <CardTitle className=\"text-base\">{formatUserName(user)}</CardTitle>\n                            <CardDescription className=\"text-sm\">\n                              ID: {user.user_id} ‚Ä¢ {user.responseCount} –æ—Ç–≤–µ—Ç–æ–≤\n                            </CardDescription>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {formatDate(user.last_interaction)}\n                          </Badge>\n                          <Dialog>\n                            <DialogTrigger asChild>\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                onClick={() => setSelectedUser(user)}\n                              >\n                                <Eye className=\"w-3 h-3 mr-1\" />\n                                –î–µ—Ç–∞–ª–∏\n                              </Button>\n                            </DialogTrigger>\n                            <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-auto\">\n                              <DialogHeader>\n                                <DialogTitle>–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {formatUserName(user)}</DialogTitle>\n                                <DialogDescription>\n                                  –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n                                </DialogDescription>\n                              </DialogHeader>\n                              \n                              <div className=\"space-y-4\">\n                                {user.responses.map((response, index) => (\n                                  <Card key={index} className=\"border-l-4 border-l-primary\">\n                                    <CardHeader className=\"pb-2\">\n                                      <div className=\"flex items-center justify-between\">\n                                        <div className=\"flex items-center gap-2\">\n                                          <span className=\"font-medium\">\n                                            {formatResponseKey(response.key, response.type)}\n                                          </span>\n                                          <Badge \n                                            variant=\"outline\" \n                                            className={`text-xs ${getResponseTypeColor(response.type)}`}\n                                          >\n                                            {response.type === 'text' ? '–¢–µ–∫—Å—Ç' : \n                                             response.type === 'button' ? '–ö–Ω–æ–ø–∫–∞' :\n                                             response.type === 'number' ? '–ß–∏—Å–ª–æ' :\n                                             response.type === 'email' ? 'Email' :\n                                             response.type === 'phone' ? '–¢–µ–ª–µ—Ñ–æ–Ω' :\n                                             response.type === 'inline_button' ? '–ò–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞' :\n                                             response.type === 'reply_button' ? 'Reply –∫–Ω–æ–ø–∫–∞' :\n                                             response.type === 'button_choice' ? '–í—ã–±–æ—Ä –∫–Ω–æ–ø–∫–∏' :\n                                             response.type}\n                                          </Badge>\n                                        </div>\n                                        <span className=\"text-xs text-muted-foreground\">\n                                          {formatDate(response.timestamp)}\n                                        </span>\n                                      </div>\n                                    </CardHeader>\n                                    <CardContent>\n                                      <div className=\"bg-muted/50 rounded p-3 mb-2\">\n                                        <p className=\"text-sm font-medium mb-1\">–û—Ç–≤–µ—Ç:</p>\n                                        <p className=\"text-foreground\">{formatResponseValue(response.value, response.type, response.key)}</p>\n                                      </div>\n                                      {response.prompt && (\n                                        <div className=\"text-xs text-muted-foreground\">\n                                          <strong>–í–æ–ø—Ä–æ—Å:</strong> {response.prompt}\n                                        </div>\n                                      )}\n                                      {showTechnicalDetails && (\n                                        <div className=\"text-xs text-muted-foreground mt-2 p-2 bg-muted/30 rounded border-l-2 border-primary/50\">\n                                          <div className=\"space-y-1\">\n                                            <div><strong>–ö–ª—é—á –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:</strong> {response.key}</div>\n                                            <div><strong>–¢–∏–ø –æ—Ç–≤–µ—Ç–∞:</strong> {response.type}</div>\n                                            {response.nodeId && <div><strong>ID —É–∑–ª–∞:</strong> {response.nodeId}</div>}\n                                            {response.variable && <div><strong>–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è:</strong> {response.variable}</div>}\n                                            <div><strong>–ò—Å—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</strong> {response.value}</div>\n                                          </div>\n                                        </div>\n                                      )}\n                                    </CardContent>\n                                  </Card>\n                                ))}\n                              </div>\n                            </DialogContent>\n                          </Dialog>\n                        </div>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-2\">\n                        {user.responses.slice(0, 2).map((response, index) => (\n                          <div key={index} className=\"flex items-center justify-between p-2 bg-muted/50 rounded\">\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"text-sm font-medium\">\n                                {formatResponseKey(response.key, response.type)}:\n                              </span>\n                              <span className=\"text-sm text-muted-foreground truncate max-w-xs\">\n                                {formatResponseValue(response.value, response.type, response.key)}\n                              </span>\n                            </div>\n                            <Badge \n                              variant=\"outline\" \n                              className={`text-xs ${getResponseTypeColor(response.type)}`}\n                            >\n                              {response.type}\n                            </Badge>\n                          </div>\n                        ))}\n                        {user.responses.length > 2 && (\n                          <div className=\"text-xs text-muted-foreground text-center pt-1\">\n                            –ò –µ—â–µ {user.responses.length - 2} –æ—Ç–≤–µ—Ç–æ–≤...\n                          </div>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </div>\n    </div>\n  );\n}","size_bytes":24816},"client/src/components/editor/rich-text-editor.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Separator } from '@/components/ui/separator';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Switch } from '@/components/ui/switch';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { \n  Bold, \n  Italic, \n  Underline, \n  Strikethrough, \n  Code, \n  Link, \n  Type,\n  Eye,\n  Copy,\n  Sparkles,\n  Palette,\n  List,\n  ListOrdered,\n  Quote,\n  Hash,\n  Smile,\n  RotateCcw,\n  RotateCw,\n  WrapText,\n  AlignLeft,\n  AlignCenter,\n  AlignRight,\n  Font,\n  Search,\n  Save,\n  Download,\n  Upload,\n  Settings,\n  Zap,\n  Star,\n  Heart,\n  CheckSquare,\n  Code2,\n  Maximize,\n  Minimize,\n  AlertTriangle,\n  Phone\n} from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface RichTextEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  enableMarkdown?: boolean;\n  onMarkdownToggle?: (enabled: boolean) => void;\n  enablePresets?: boolean;\n  enableAdvancedFeatures?: boolean;\n}\n\nexport function RichTextEditor({\n  value,\n  onChange,\n  placeholder = \"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è...\",\n  enableMarkdown = false,\n  onMarkdownToggle,\n  enablePresets = true,\n  enableAdvancedFeatures = true\n}: RichTextEditorProps) {\n  const [activeTab, setActiveTab] = useState<'edit' | 'preview'>('edit');\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [undoStack, setUndoStack] = useState<string[]>([]);\n  const [redoStack, setRedoStack] = useState<string[]>([]);\n  const [savedTemplates, setSavedTemplates] = useState<{name: string, content: string}[]>([]);\n  const [wordCount, setWordCount] = useState(0);\n  const [charCount, setCharCount] = useState(0);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const { toast } = useToast();\n\n  // Update counts when value changes\n  useEffect(() => {\n    setWordCount(value.trim().split(/\\s+/).filter(word => word.length > 0).length);\n    setCharCount(value.length);\n  }, [value]);\n\n  // Save to undo stack\n  const saveToUndoStack = useCallback(() => {\n    setUndoStack(prev => [...prev.slice(-19), value]);\n    setRedoStack([]);\n  }, [value]);\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∂–∏–≤–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏\n  const renderLivePreview = (text: string) => {\n    let processedText = text;\n    \n    if (enableMarkdown) {\n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n      processedText = processedText\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<strong class=\"live-preview-bold\">$1</strong>') // –ñ–∏—Ä–Ω—ã–π\n        .replace(/_(.*?)_/g, '<em class=\"live-preview-italic\">$1</em>') // –ö—É—Ä—Å–∏–≤\n        .replace(/__(.*?)__/g, '<u class=\"live-preview-underline\">$1</u>') // –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π\n        .replace(/~(.*?)~/g, '<s class=\"live-preview-strikethrough\">$1</s>') // –ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π\n        .replace(/`(.*?)`/g, '<code class=\"live-preview-code\">$1</code>') // –ö–æ–¥\n        .replace(/```\\n(.*?)\\n```/gs, '<pre class=\"live-preview-pre\"><code>$1</code></pre>') // –ë–ª–æ–∫ –∫–æ–¥–∞\n        .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" class=\"live-preview-link\" target=\"_blank\" rel=\"noopener noreferrer\">$1</a>') // –°—Å—ã–ª–∫–∞\n        .replace(/^> (.*)$/gm, '<blockquote class=\"live-preview-quote\">$1</blockquote>') // –¶–∏—Ç–∞—Ç–∞\n        .replace(/^# (.*)$/gm, '<h3 class=\"live-preview-heading\">$1</h3>') // –ó–∞–≥–æ–ª–æ–≤–æ–∫\n        .replace(/^## (.*)$/gm, '<h4 class=\"live-preview-heading-2\">$1</h4>') // –ó–∞–≥–æ–ª–æ–≤–æ–∫ 2\n        .replace(/^### (.*)$/gm, '<h5 class=\"live-preview-heading-3\">$1</h5>') // –ó–∞–≥–æ–ª–æ–≤–æ–∫ 3\n        .replace(/^\\* (.*)$/gm, '<li class=\"live-preview-list-item\">$1</li>') // –°–ø–∏—Å–æ–∫\n        .replace(/^\\d+\\. (.*)$/gm, '<li class=\"live-preview-list-item-ordered\">$1</li>') // –ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫\n        .replace(/---/g, '<hr class=\"live-preview-separator\">') // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å\n        .replace(/\\n/g, '<br>'); // –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\n    } else {\n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n      processedText = processedText\n        .replace(/<b>(.*?)<\\/b>/g, '<strong class=\"live-preview-bold\">$1</strong>')\n        .replace(/<i>(.*?)<\\/i>/g, '<em class=\"live-preview-italic\">$1</em>')\n        .replace(/<u>(.*?)<\\/u>/g, '<u class=\"live-preview-underline\">$1</u>')\n        .replace(/<s>(.*?)<\\/s>/g, '<s class=\"live-preview-strikethrough\">$1</s>')\n        .replace(/<code>(.*?)<\\/code>/g, '<code class=\"live-preview-code\">$1</code>')\n        .replace(/<pre><code>(.*?)<\\/code><\\/pre>/gs, '<pre class=\"live-preview-pre\"><code>$1</code></pre>')\n        .replace(/<a href=\"([^\"]+)\">(.*?)<\\/a>/g, '<a href=\"$1\" class=\"live-preview-link\" target=\"_blank\" rel=\"noopener noreferrer\">$2</a>')\n        .replace(/<blockquote>(.*?)<\\/blockquote>/g, '<blockquote class=\"live-preview-quote\">$1</blockquote>')\n        .replace(/<h3>(.*?)<\\/h3>/g, '<h3 class=\"live-preview-heading\">$1</h3>')\n        .replace(/<h4>(.*?)<\\/h4>/g, '<h4 class=\"live-preview-heading-2\">$1</h4>')\n        .replace(/<h5>(.*?)<\\/h5>/g, '<h5 class=\"live-preview-heading-3\">$1</h5>')\n        .replace(/<hr>/g, '<hr class=\"live-preview-separator\">')\n        .replace(/\\n/g, '<br>'); // –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\n    }\n    \n    return processedText;\n  };\n\n  const formatOptions = [\n    { \n      icon: Bold, \n      name: '–ñ–∏—Ä–Ω—ã–π', \n      markdown: '**—Ç–µ–∫—Å—Ç**', \n      html: '<b>—Ç–µ–∫—Å—Ç</b>',\n      description: '–í—ã–¥–µ–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º',\n      shortcut: 'Ctrl+B',\n      category: 'basic'\n    },\n    { \n      icon: Italic, \n      name: '–ö—É—Ä—Å–∏–≤', \n      markdown: '_—Ç–µ–∫—Å—Ç_', \n      html: '<i>—Ç–µ–∫—Å—Ç</i>',\n      description: '–í—ã–¥–µ–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∫—É—Ä—Å–∏–≤–æ–º',\n      shortcut: 'Ctrl+I',\n      category: 'basic'\n    },\n    { \n      icon: Underline, \n      name: '–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π', \n      markdown: '__—Ç–µ–∫—Å—Ç__', \n      html: '<u>—Ç–µ–∫—Å—Ç</u>',\n      description: '–ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç',\n      shortcut: 'Ctrl+U',\n      category: 'basic'\n    },\n    { \n      icon: Strikethrough, \n      name: '–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π', \n      markdown: '~—Ç–µ–∫—Å—Ç~', \n      html: '<s>—Ç–µ–∫—Å—Ç</s>',\n      description: '–ó–∞—á–µ—Ä–∫–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç',\n      shortcut: 'Ctrl+Shift+X',\n      category: 'basic'\n    },\n    { \n      icon: Code, \n      name: '–ö–æ–¥', \n      markdown: '`–∫–æ–¥`', \n      html: '<code>–∫–æ–¥</code>',\n      description: '–í—ã–¥–µ–ª—è–µ—Ç –∫–æ–¥ –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º',\n      shortcut: 'Ctrl+E',\n      category: 'basic'\n    },\n    { \n      icon: Link, \n      name: '–°—Å—ã–ª–∫–∞', \n      markdown: '[—Ç–µ–∫—Å—Ç](url)', \n      html: '<a href=\"url\">—Ç–µ–∫—Å—Ç</a>',\n      description: '–°–æ–∑–¥–∞–µ—Ç –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É',\n      shortcut: 'Ctrl+K',\n      category: 'basic'\n    },\n    { \n      icon: Code2, \n      name: '–ë–ª–æ–∫ –∫–æ–¥–∞', \n      markdown: '```\\n–∫–æ–¥\\n```', \n      html: '<pre><code>–∫–æ–¥</code></pre>',\n      description: '–°–æ–∑–¥–∞–µ—Ç –±–ª–æ–∫ –∫–æ–¥–∞',\n      shortcut: 'Ctrl+Shift+C',\n      category: 'advanced'\n    },\n    { \n      icon: Quote, \n      name: '–¶–∏—Ç–∞—Ç–∞', \n      markdown: '> —Ü–∏—Ç–∞—Ç–∞', \n      html: '<blockquote>—Ü–∏—Ç–∞—Ç–∞</blockquote>',\n      description: '–°–æ–∑–¥–∞–µ—Ç –±–ª–æ–∫ —Ü–∏—Ç–∞—Ç—ã',\n      shortcut: 'Ctrl+Shift+Q',\n      category: 'advanced'\n    },\n    { \n      icon: List, \n      name: '–°–ø–∏—Å–æ–∫', \n      markdown: '‚Ä¢ –ø—É–Ω–∫—Ç\\n‚Ä¢ –ø—É–Ω–∫—Ç\\n‚Ä¢ –ø—É–Ω–∫—Ç', \n      html: '<ul><li>–ø—É–Ω–∫—Ç</li><li>–ø—É–Ω–∫—Ç</li><li>–ø—É–Ω–∫—Ç</li></ul>',\n      description: '–°–æ–∑–¥–∞–µ—Ç –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫',\n      shortcut: 'Ctrl+Shift+L',\n      category: 'advanced'\n    },\n    { \n      icon: ListOrdered, \n      name: '–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫', \n      markdown: '1. –ø—É–Ω–∫—Ç\\n2. –ø—É–Ω–∫—Ç\\n3. –ø—É–Ω–∫—Ç', \n      html: '<ol><li>–ø—É–Ω–∫—Ç</li><li>–ø—É–Ω–∫—Ç</li><li>–ø—É–Ω–∫—Ç</li></ol>',\n      description: '–°–æ–∑–¥–∞–µ—Ç –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫',\n      shortcut: 'Ctrl+Shift+O',\n      category: 'advanced'\n    },\n    { \n      icon: Hash, \n      name: '–ó–∞–≥–æ–ª–æ–≤–æ–∫', \n      markdown: '# –ó–∞–≥–æ–ª–æ–≤–æ–∫', \n      html: '<h3>–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>',\n      description: '–°–æ–∑–¥–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫',\n      shortcut: 'Ctrl+H',\n      category: 'advanced'\n    }\n  ];\n\n  const messagePresets = [\n    {\n      name: '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',\n      icon: Smile,\n      content: 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\\n\\n–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –≤ –Ω–∞—à–µ–º –±–æ—Ç–µ. –ö–∞–∫ –¥–µ–ª–∞?'\n    },\n    {\n      name: '–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å',\n      icon: Heart,\n      content: '‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ!\\n\\n–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∞–∂–Ω–æ –¥–ª—è –Ω–∞—Å.'\n    },\n    {\n      name: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',\n      icon: Phone,\n      content: 'üìû **–ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã:**\\n\\n‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67\\n‚Ä¢ Email: support@example.com\\n‚Ä¢ –°–∞–π—Ç: https://example.com'\n    },\n    {\n      name: '–ú–µ–Ω—é',\n      icon: List,\n      content: 'üìã **–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:**\\n\\n1. –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤\\n2. –ú–æ–∏ –∑–∞–∫–∞–∑—ã\\n3. –ü–æ–¥–¥–µ—Ä–∂–∫–∞\\n4. –û –∫–æ–º–ø–∞–Ω–∏–∏'\n    },\n    {\n      name: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è',\n      icon: CheckSquare,\n      content: 'üìù **–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:**\\n\\n‚úÖ –®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é\\n‚úÖ –®–∞–≥ 2: –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\\n‚úÖ –®–∞–≥ 3: –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∑–∞–∫–∞–∑'\n    },\n    {\n      name: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',\n      icon: AlertTriangle,\n      content: '‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ!**\\n\\n–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–µ—Å—Ç—å.'\n    }\n  ];\n\n  // Undo/Redo functionality\n  const undo = useCallback(() => {\n    if (undoStack.length > 0) {\n      const previousValue = undoStack[undoStack.length - 1];\n      setRedoStack(prev => [value, ...prev.slice(0, 19)]);\n      setUndoStack(prev => prev.slice(0, -1));\n      onChange(previousValue);\n      toast({\n        title: \"–û—Ç–º–µ–Ω–µ–Ω–æ\",\n        description: \"–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ\"\n      });\n    }\n  }, [undoStack, value, onChange, toast]);\n\n  const redo = useCallback(() => {\n    if (redoStack.length > 0) {\n      const nextValue = redoStack[0];\n      setUndoStack(prev => [...prev.slice(-19), value]);\n      setRedoStack(prev => prev.slice(1));\n      onChange(nextValue);\n      toast({\n        title: \"–ü–æ–≤—Ç–æ—Ä–µ–Ω–æ\",\n        description: \"–î–µ–π—Å—Ç–≤–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\"\n      });\n    }\n  }, [redoStack, value, onChange, toast]);\n\n  // Template management\n  const saveTemplate = useCallback(() => {\n    const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞:');\n    if (name && value.trim()) {\n      setSavedTemplates(prev => [...prev, { name, content: value }]);\n      toast({\n        title: \"–®–∞–±–ª–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω\",\n        description: `–®–∞–±–ª–æ–Ω \"${name}\" –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É`\n      });\n    }\n  }, [value, toast]);\n\n  const loadTemplate = useCallback((template: { name: string, content: string }) => {\n    saveToUndoStack();\n    onChange(template.content);\n    toast({\n      title: \"–®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω\",\n      description: `–ó–∞–≥—Ä—É–∂–µ–Ω —à–∞–±–ª–æ–Ω \"${template.name}\"`\n    });\n  }, [onChange, saveToUndoStack, toast]);\n\n  // Insert preset message\n  const insertPreset = (preset: typeof messagePresets[0]) => {\n    saveToUndoStack();\n    const newContent = value ? value + '\\n\\n' + preset.content : preset.content;\n    onChange(newContent);\n    toast({\n      title: \"–®–∞–±–ª–æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω\",\n      description: `–î–æ–±–∞–≤–ª–µ–Ω —à–∞–±–ª–æ–Ω \"${preset.name}\"`\n    });\n  };\n\n  // Keyboard shortcuts - work like in Telegram (no selection required)\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.ctrlKey || e.metaKey) {\n        const textarea = textareaRef.current;\n        if (!textarea) return;\n        \n        const format = formatOptions.find(f => {\n          const shortcut = f.shortcut?.toLowerCase();\n          if (!shortcut) return false;\n          \n          if (shortcut.includes('shift') && !e.shiftKey) return false;\n          if (!shortcut.includes('shift') && e.shiftKey) return false;\n          \n          const key = shortcut.split('+').pop();\n          return e.key.toLowerCase() === key;\n        });\n        \n        if (format) {\n          e.preventDefault();\n          insertFormatting(format);\n        } else if (e.key === 'z' && !e.shiftKey) {\n          e.preventDefault();\n          undo();\n        } else if ((e.key === 'y') || (e.key === 'z' && e.shiftKey)) {\n          e.preventDefault();\n          redo();\n        }\n      }\n    };\n\n    const textarea = textareaRef.current;\n    if (textarea) {\n      textarea.addEventListener('keydown', handleKeyDown);\n      return () => textarea.removeEventListener('keydown', handleKeyDown);\n    }\n  }, [formatOptions, undo, redo, toast]);\n\n  const insertFormatting = (format: typeof formatOptions[0]) => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    saveToUndoStack();\n    \n    const start = textarea.selectionStart;\n    const end = textarea.selectionEnd;\n    const selectedText = value.substring(start, end);\n    \n    const hasSelection = start !== end;\n    \n    let formatPrefix = '';\n    let formatSuffix = '';\n    let cursorOffset = 0;\n    \n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∏–º–≤–æ–ª—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞\n    if (enableMarkdown) {\n      switch (format.name) {\n        case '–ñ–∏—Ä–Ω—ã–π':\n          formatPrefix = '**';\n          formatSuffix = '**';\n          break;\n        case '–ö—É—Ä—Å–∏–≤':\n          formatPrefix = '_';\n          formatSuffix = '_';\n          break;\n        case '–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π':\n          formatPrefix = '__';\n          formatSuffix = '__';\n          break;\n        case '–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π':\n          formatPrefix = '~';\n          formatSuffix = '~';\n          break;\n        case '–ö–æ–¥':\n          formatPrefix = '`';\n          formatSuffix = '`';\n          break;\n        case '–ë–ª–æ–∫ –∫–æ–¥–∞':\n          formatPrefix = '```\\n';\n          formatSuffix = '\\n```';\n          break;\n        case '–°—Å—ã–ª–∫–∞':\n          if (hasSelection) {\n            const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL:') || 'https://example.com';\n            formatPrefix = '[';\n            formatSuffix = `](${url})`;\n          } else {\n            formatPrefix = '[';\n            formatSuffix = '](https://example.com)';\n            cursorOffset = 1; // –ü–æ—Å—Ç–∞–≤–∏—Ç—å –∫—É—Ä—Å–æ—Ä –ø–æ—Å–ª–µ '['\n          }\n          break;\n        case '–¶–∏—Ç–∞—Ç–∞':\n          formatPrefix = '> ';\n          formatSuffix = '';\n          break;\n        case '–ó–∞–≥–æ–ª–æ–≤–æ–∫':\n          formatPrefix = '# ';\n          formatSuffix = '';\n          break;\n        default:\n          return;\n      }\n    } else {\n      switch (format.name) {\n        case '–ñ–∏—Ä–Ω—ã–π':\n          formatPrefix = '<b>';\n          formatSuffix = '</b>';\n          break;\n        case '–ö—É—Ä—Å–∏–≤':\n          formatPrefix = '<i>';\n          formatSuffix = '</i>';\n          break;\n        case '–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π':\n          formatPrefix = '<u>';\n          formatSuffix = '</u>';\n          break;\n        case '–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π':\n          formatPrefix = '<s>';\n          formatSuffix = '</s>';\n          break;\n        case '–ö–æ–¥':\n          formatPrefix = '<code>';\n          formatSuffix = '</code>';\n          break;\n        case '–ë–ª–æ–∫ –∫–æ–¥–∞':\n          formatPrefix = '<pre><code>';\n          formatSuffix = '</code></pre>';\n          break;\n        case '–°—Å—ã–ª–∫–∞':\n          if (hasSelection) {\n            const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL:') || 'https://example.com';\n            formatPrefix = `<a href=\"${url}\">`;\n            formatSuffix = '</a>';\n          } else {\n            formatPrefix = '<a href=\"https://example.com\">';\n            formatSuffix = '</a>';\n            cursorOffset = formatPrefix.length; // –ü–æ—Å—Ç–∞–≤–∏—Ç—å –∫—É—Ä—Å–æ—Ä –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã–≤–∞—é—â–µ–≥–æ —Ç–µ–≥–∞\n          }\n          break;\n        case '–¶–∏—Ç–∞—Ç–∞':\n          formatPrefix = '<blockquote>';\n          formatSuffix = '</blockquote>';\n          break;\n        case '–ó–∞–≥–æ–ª–æ–≤–æ–∫':\n          formatPrefix = '<h3>';\n          formatSuffix = '</h3>';\n          break;\n        default:\n          return;\n      }\n    }\n    \n    let newText = '';\n    let newCursorPosition = start;\n    let isToggleOff = false;\n    \n    if (hasSelection) {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–∂–µ –ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É\n      const beforeSelection = value.substring(Math.max(0, start - formatPrefix.length), start);\n      const afterSelection = value.substring(end, Math.min(value.length, end + formatSuffix.length));\n      \n      // –î–ª—è —Ü–∏—Ç–∞—Ç –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏\n      if (format.name === '–¶–∏—Ç–∞—Ç–∞' || format.name === '–ó–∞–≥–æ–ª–æ–≤–æ–∫') {\n        const lineStart = value.lastIndexOf('\\n', start - 1) + 1;\n        const linePrefix = value.substring(lineStart, start);\n        \n        if (linePrefix === formatPrefix) {\n          // –£–±–∏—Ä–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n          newText = selectedText;\n          newCursorPosition = start - formatPrefix.length;\n          isToggleOff = true;\n          \n          // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç, —É–±–∏—Ä–∞—è –ø—Ä–µ—Ñ–∏–∫—Å\n          const newValue = value.substring(0, lineStart) + value.substring(start) + value.substring(end);\n          onChange(newValue);\n        } else {\n          // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n          newText = formatPrefix + selectedText;\n          newCursorPosition = start + newText.length;\n          \n          const newValue = value.substring(0, lineStart) + formatPrefix + value.substring(lineStart);\n          onChange(newValue);\n        }\n      } else {\n        // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ\n        if (beforeSelection === formatPrefix && afterSelection === formatSuffix) {\n          // –£–±–∏—Ä–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n          newText = selectedText;\n          newCursorPosition = start - formatPrefix.length;\n          isToggleOff = true;\n          \n          const newValue = value.substring(0, start - formatPrefix.length) + selectedText + value.substring(end + formatSuffix.length);\n          onChange(newValue);\n        } else {\n          // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n          newText = formatPrefix + selectedText + formatSuffix;\n          newCursorPosition = start + newText.length;\n          \n          const newValue = value.substring(0, start) + newText + value.substring(end);\n          onChange(newValue);\n        }\n      }\n    } else {\n      // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ –≤—ã–¥–µ–ª–µ–Ω - –≤—Å—Ç–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∫ –≤ Telegram\n      newText = formatPrefix + formatSuffix;\n      newCursorPosition = start + formatPrefix.length + cursorOffset;\n      \n      const newValue = value.substring(0, start) + newText + value.substring(end);\n      onChange(newValue);\n    }\n    \n    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é\n    setTimeout(() => {\n      if (hasSelection && !isToggleOff) {\n        // –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—ã–¥–µ–ª—è–µ–º –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç\n        if (format.name === '–¶–∏—Ç–∞—Ç–∞' || format.name === '–ó–∞–≥–æ–ª–æ–≤–æ–∫') {\n          textarea.setSelectionRange(newCursorPosition - selectedText.length, newCursorPosition);\n        } else {\n          textarea.setSelectionRange(start + formatPrefix.length, start + formatPrefix.length + selectedText.length);\n        }\n      } else {\n        // –û–±—ã—á–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞\n        textarea.setSelectionRange(newCursorPosition, newCursorPosition);\n      }\n      textarea.focus();\n    }, 0);\n\n    toast({\n      title: isToggleOff ? \"–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ\" : \"–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ\",\n      description: hasSelection \n        ? (isToggleOff ? `–£–±—Ä–∞–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ \"${format.name}\" —Å –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞` : `–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É: ${format.name}`)\n        : `–î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∏–º–≤–æ–ª—ã: ${format.name}`,\n      variant: \"default\"\n    });\n  };\n\n  const copyToClipboard = async (text: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      toast({\n        title: \"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!\",\n        description: \"–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞\"\n      });\n    } catch (err) {\n      console.error('Failed to copy text: ', err);\n    }\n  };\n\n  const renderPreview = () => {\n    if (!enableMarkdown) {\n      // For HTML mode, just show the raw text with HTML tags\n      return (\n        <div className=\"p-3 bg-muted/50 rounded-lg border min-h-[100px] whitespace-pre-wrap\">\n          <div className=\"text-sm text-muted-foreground mb-2\">HTML –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</div>\n          <div dangerouslySetInnerHTML={{ __html: value }} />\n        </div>\n      );\n    }\n    \n    // For Markdown mode, convert common markdown to HTML for preview\n    let htmlContent = value\n      .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n      .replace(/_(.*?)_/g, '<em>$1</em>')\n      .replace(/__(.*?)__/g, '<u>$1</u>')\n      .replace(/~(.*?)~/g, '<s>$1</s>')\n      .replace(/`(.*?)`/g, '<code>$1</code>')\n      .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\">$1</a>')\n      .replace(/\\n/g, '<br>');\n    \n    return (\n      <div className=\"p-3 bg-muted/50 rounded-lg border min-h-[100px]\">\n        <div className=\"text-sm text-muted-foreground mb-2\">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</div>\n        <div dangerouslySetInnerHTML={{ __html: htmlContent }} />\n      </div>\n    );\n  };\n\n  // Filter formats based on search\n  const filteredFormats = formatOptions.filter(format => \n    searchTerm === '' || format.name.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const basicFormats = filteredFormats.filter(f => f.category === 'basic');\n  const advancedFormats = filteredFormats.filter(f => f.category === 'advanced');\n\n  return (\n    <Card className={`w-full transition-all duration-300 ${isExpanded ? 'col-span-2' : ''}`}>\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-sm flex items-center gap-2\">\n            <Sparkles className=\"w-4 h-4 text-blue-500\" />\n            –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n            {charCount > 0 && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {wordCount} —Å–ª–æ–≤ ‚Ä¢ {charCount} —Å–∏–º–≤–æ–ª–æ–≤\n              </Badge>\n            )}\n          </CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setIsExpanded(!isExpanded)}\n              className=\"h-8 w-8 p-0\"\n              title={isExpanded ? \"–°–≤–µ—Ä–Ω—É—Ç—å\" : \"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å\"}\n            >\n              {isExpanded ? <Minimize className=\"w-4 h-4\" /> : <Maximize className=\"w-4 h-4\" />}\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => onMarkdownToggle?.(!enableMarkdown)}\n              className=\"text-xs\"\n            >\n              {enableMarkdown ? 'Markdown' : 'HTML'}\n            </Button>\n          </div>\n        </div>\n\n        {/* Enhanced toolbar with undo/redo and actions */}\n        <div className=\"flex items-center gap-2 pt-2\">\n          <div className=\"flex items-center gap-1\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={undo}\n              disabled={undoStack.length === 0}\n              className=\"h-8 w-8 p-0\"\n              title=\"–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)\"\n            >\n              <RotateCcw className=\"w-3 h-3\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={redo}\n              disabled={redoStack.length === 0}\n              className=\"h-8 w-8 p-0\"\n              title=\"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (Ctrl+Y)\"\n            >\n              <RotateCw className=\"w-3 h-3\" />\n            </Button>\n          </div>\n          \n          <Separator orientation=\"vertical\" className=\"h-6\" />\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={saveTemplate}\n            disabled={!value.trim()}\n            className=\"h-8 px-2 text-xs\"\n            title=\"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —à–∞–±–ª–æ–Ω\"\n          >\n            <Save className=\"w-3 h-3 mr-1\" />\n            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n          </Button>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => copyToClipboard(value)}\n            disabled={!value.trim()}\n            className=\"h-8 px-2 text-xs\"\n            title=\"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç\"\n          >\n            <Copy className=\"w-3 h-3 mr-1\" />\n            –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å\n          </Button>\n\n          {enableAdvancedFeatures && (\n            <div className=\"flex items-center gap-1 ml-auto\">\n              <Input\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                placeholder=\"–ü–æ–∏—Å–∫...\"\n                className=\"h-8 w-24 text-xs\"\n              />\n              <Search className=\"w-3 h-3 text-muted-foreground -ml-6\" />\n            </div>\n          )}\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-4\">\n        {/* Message Presets */}\n        {enablePresets && (\n          <div className=\"space-y-3\">\n            <Label className=\"text-xs font-medium flex items-center gap-2\">\n              <Sparkles className=\"w-3 h-3\" />\n              –ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π\n            </Label>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {messagePresets.map((preset) => (\n                <Button\n                  key={preset.name}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => insertPreset(preset)}\n                  className=\"justify-start gap-2 h-9 text-xs\"\n                  title={preset.content.slice(0, 50) + '...'}\n                >\n                  <preset.icon className=\"w-3 h-3 text-blue-500\" />\n                  {preset.name}\n                </Button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Basic Formatting Toolbar */}\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-xs font-medium flex items-center gap-2\">\n              <Type className=\"w-3 h-3\" />\n              –ë–∞–∑–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n            </Label>\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              üìù –í—ã–¥–µ–ª–∏—Ç–µ ‚Üí –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É\n            </Badge>\n          </div>\n          \n          <div className=\"bg-blue-50 dark:bg-blue-950/30 rounded-lg p-2 mb-3\">\n            <div className=\"text-xs text-blue-700 dark:text-blue-300 flex items-center gap-2\">\n              <span>üí°</span>\n              <span>–ö–∞–∫ –≤ Telegram: —Å–Ω–∞—á–∞–ª–∞ –≤—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</span>\n            </div>\n          </div>\n          \n          <div className=\"grid grid-cols-3 gap-2\">\n            {basicFormats.map((format) => (\n              <Button\n                key={format.name}\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => insertFormatting(format)}\n                className=\"justify-start gap-2 h-8 text-xs hover:bg-blue-50 dark:hover:bg-blue-950/50\"\n                title={`–í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (${format.shortcut})`}\n              >\n                <format.icon className=\"w-3 h-3\" />\n                {format.name}\n              </Button>\n            ))}\n          </div>\n        </div>\n\n        {/* Advanced Formatting */}\n        {enableAdvancedFeatures && advancedFormats.length > 0 && (\n          <div className=\"space-y-3\">\n            <Label className=\"text-xs font-medium flex items-center gap-2\">\n              <Settings className=\"w-3 h-3\" />\n              –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n            </Label>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {advancedFormats.map((format) => (\n                <Button\n                  key={format.name}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => insertFormatting(format)}\n                  className=\"justify-start gap-2 h-8 text-xs\"\n                  title={`${format.description} (${format.shortcut})`}\n                >\n                  <format.icon className=\"w-3 h-3\" />\n                  {format.name}\n                </Button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Saved Templates */}\n        {savedTemplates.length > 0 && (\n          <div className=\"space-y-3\">\n            <Label className=\"text-xs font-medium flex items-center gap-2\">\n              <Star className=\"w-3 h-3\" />\n              –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã\n            </Label>\n            <ScrollArea className=\"h-20\">\n              <div className=\"space-y-1\">\n                {savedTemplates.map((template, index) => (\n                  <div key={index} className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => loadTemplate(template)}\n                      className=\"flex-1 justify-start text-xs h-7\"\n                    >\n                      {template.name}\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setSavedTemplates(prev => prev.filter((_, i) => i !== index))}\n                      className=\"h-7 w-7 p-0 text-red-500\"\n                    >\n                      √ó\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            </ScrollArea>\n          </div>\n        )}\n\n        <Separator />\n\n        {/* Enhanced Text Editor with Tabs */}\n        <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as 'edit' | 'preview')}>\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"edit\" className=\"flex items-center gap-2\">\n              <Type className=\"w-3 h-3\" />\n              –†–µ–¥–∞–∫—Ç–æ—Ä {charCount > 0 && <Badge variant=\"outline\" className=\"text-xs\">{charCount}</Badge>}\n            </TabsTrigger>\n            <TabsTrigger value=\"preview\" className=\"flex items-center gap-2\">\n              <Eye className=\"w-3 h-3\" />\n              –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"edit\" className=\"space-y-3\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n              {/* –†–µ–¥–∞–∫—Ç–æ—Ä */}\n              <div className=\"relative\">\n                <Label className=\"text-xs font-medium text-muted-foreground mb-2 block\">\n                  –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞\n                </Label>\n                <Textarea\n                  ref={textareaRef}\n                  value={value}\n                  onChange={(e) => {\n                    saveToUndoStack();\n                    onChange(e.target.value);\n                  }}\n                  placeholder=\"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è...\"\n                  className={`min-h-[120px] resize-none transition-all duration-200 font-mono text-sm ${\n                    isExpanded ? 'min-h-[200px]' : ''\n                  }`}\n                  rows={isExpanded ? 10 : 6}\n                  onSelect={(e) => {\n                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–∏ –≤—ã–¥–µ–ª–µ–Ω–∏–∏ –∫–∞–∫ –≤ Telegram\n                    const textarea = e.target as HTMLTextAreaElement;\n                    if (textarea && textarea.selectionStart !== textarea.selectionEnd) {\n                      const selectedText = value.substring(textarea.selectionStart, textarea.selectionEnd);\n                      if (selectedText.length > 0 && selectedText.length <= 200) {\n                        // Debounce –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Å–ø–∞–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n                        setTimeout(() => {\n                          if (textarea.selectionStart !== textarea.selectionEnd) {\n                            const currentSelection = value.substring(textarea.selectionStart, textarea.selectionEnd);\n                            if (currentSelection === selectedText) {\n                              toast({\n                                title: `‚úÖ –í—ã–¥–µ–ª–µ–Ω–æ: \"${selectedText.slice(0, 20)}${selectedText.length > 20 ? '...' : ''}\"`,\n                                description: \"–¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏—Ç–µ B/I/U –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ –ø–∞–Ω–µ–ª–∏ –≤—ã—à–µ\",\n                                duration: 3000\n                              });\n                            }\n                          }\n                        }, 500);\n                      }\n                    }\n                  }}\n                />\n                \n                {/* Character count overlay */}\n                {charCount > 0 && (\n                  <div className=\"absolute bottom-2 right-2 text-xs text-muted-foreground bg-background/80 px-2 py-1 rounded\">\n                    {charCount}/4096\n                  </div>\n                )}\n                \n                {/* Selection helper overlay - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞ */}\n                {!value && (\n                  <div className=\"absolute top-2 right-2 text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950/50 px-2 py-1 rounded opacity-70\">\n                    üí° –í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n                  </div>\n                )}\n              </div>\n\n              {/* –ñ–∏–≤–æ–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä */}\n              <div className=\"relative\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <Label className=\"text-xs font-medium text-muted-foreground flex items-center gap-2\">\n                    <Eye className=\"w-3 h-3\" />\n                    –ñ–∏–≤–æ–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä\n                  </Label>\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {enableMarkdown ? 'Markdown' : 'HTML'}\n                    </Badge>\n                    {value && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => copyToClipboard(value)}\n                        className=\"h-6 w-6 p-0\"\n                        title=\"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç\"\n                      >\n                        <Copy className=\"w-3 h-3\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n                \n                <div className={`border rounded-md bg-gradient-to-br from-white to-gray-50 dark:from-gray-900 dark:to-gray-800 min-h-[120px] ${\n                  isExpanded ? 'min-h-[200px]' : ''\n                } overflow-auto shadow-inner`}>\n                  {value ? (\n                    <div className=\"p-3\">\n                      {/* Telegram-style message bubble */}\n                      <div className=\"max-w-full\">\n                        <div className=\"bg-blue-500 text-white rounded-2xl rounded-tl-sm px-4 py-2 inline-block max-w-[80%] shadow-lg\">\n                          <div className=\"text-sm whitespace-pre-wrap\" dangerouslySetInnerHTML={{\n                            __html: renderLivePreview(value)\n                          }} />\n                        </div>\n                        <div className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n                          <span>‚úì‚úì</span>\n                          <span>{new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\n                        </div>\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">\n                      <div className=\"text-center space-y-2\">\n                        <Eye className=\"w-8 h-8 mx-auto opacity-50\" />\n                        <div>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>\n                        <div className=\"text-xs opacity-70\">–ù–∞—á–Ω–∏—Ç–µ –ø–µ—á–∞—Ç–∞—Ç—å –¥–ª—è –∂–∏–≤–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                \n                {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */}\n                {value && (\n                  <div className=\"mt-2 flex items-center justify-between text-xs text-muted-foreground\">\n                    <div className=\"flex items-center gap-3\">\n                      <span className=\"flex items-center gap-1\">\n                        <span className=\"w-2 h-2 bg-green-500 rounded-full\"></span>\n                        –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏\n                      </span>\n                      <span>{wordCount} —Å–ª–æ–≤</span>\n                      <span>{charCount} —Å–∏–º–≤–æ–ª–æ–≤</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      {charCount <= 4096 ? (\n                        <span className=\"text-green-600 dark:text-green-400\">‚úì Telegram OK</span>\n                      ) : (\n                        <span className=\"text-red-600 dark:text-red-400\">‚ö† –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç</span>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n            \n            <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n              <div className=\"flex items-center gap-4\">\n                <span>\n                  {enableMarkdown ? 'üìù Markdown' : 'üè∑Ô∏è HTML'} —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n                </span>\n                <span>üìä {wordCount} —Å–ª–æ–≤, {charCount} —Å–∏–º–≤–æ–ª–æ–≤</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <span>‚å®Ô∏è –í—ã–¥–µ–ª–µ–Ω–∏–µ + Ctrl+B/I/U</span>\n              </div>\n            </div>\n            \n            {/* Usage instructions */}\n            <div className=\"bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-950/20 dark:to-blue-950/20 rounded-lg p-3 border border-green-200 dark:border-green-800\">\n              <div className=\"text-xs space-y-1\">\n                <div className=\"font-medium text-green-700 dark:text-green-300 mb-2\">üéØ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</div>\n                <div className=\"space-y-1 text-green-600 dark:text-green-400\">\n                  <div>1Ô∏è‚É£ –ù–∞–ø–∏—à–∏—Ç–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç</div>\n                  <div>2Ô∏è‚É£ –í—ã–¥–µ–ª–∏—Ç–µ —á–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ –º—ã—à–∫–æ–π</div>\n                  <div>3Ô∏è‚É£ –ù–∞–∂–º–∏—Ç–µ –Ω—É–∂–Ω—É—é –∫–Ω–æ–ø–∫—É —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>\n                  <div className=\"text-blue-600 dark:text-blue-400 mt-2\">‚ö° –ë—ã—Å—Ç—Ä–æ: Ctrl+B (–∂–∏—Ä–Ω—ã–π), Ctrl+I (–∫—É—Ä—Å–∏–≤), Ctrl+U (–ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π)</div>\n                </div>\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"preview\" className=\"space-y-3\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <Label className=\"text-xs font-medium\">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–∫ –≤ Telegram</Label>\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  {enableMarkdown ? 'Markdown' : 'HTML'}\n                </Badge>\n                {charCount > 4096 && (\n                  <Badge variant=\"destructive\" className=\"text-xs\">\n                    –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç\n                  </Badge>\n                )}\n              </div>\n            </div>\n            {renderPreview()}\n            \n            {charCount > 0 && (\n              <div className=\"flex items-center gap-4 text-xs text-muted-foreground pt-2 border-t\">\n                <span>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {wordCount} —Å–ª–æ–≤, {charCount} —Å–∏–º–≤–æ–ª–æ–≤</span>\n                <span>üì± –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {charCount <= 4096 ? '‚úÖ' : '‚ùå'} Telegram</span>\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n\n        {/* Enhanced Quick Reference with expandable content */}\n        <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/30 dark:to-purple-950/30 rounded-lg p-3 space-y-2 border border-blue-200 dark:border-blue-800\">\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-xs font-medium flex items-center gap-2\">\n              <Zap className=\"w-3 h-3 text-blue-500\" />\n              –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—é\n            </Label>\n            <div className=\"flex items-center gap-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => copyToClipboard(formatOptions.map(f => \n                  `${f.name}: ${enableMarkdown ? f.markdown : f.html}`\n                ).join('\\n'))}\n                className=\"h-6 px-2\"\n                title=\"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã\"\n              >\n                <Copy className=\"w-3 h-3\" />\n              </Button>\n            </div>\n          </div>\n          \n          <div className=\"grid grid-cols-1 gap-1 text-xs\">\n            {(searchTerm ? filteredFormats : formatOptions).slice(0, 6).map((format) => (\n              <div key={format.name} className=\"flex items-center justify-between py-1\">\n                <div className=\"flex items-center gap-2\">\n                  <format.icon className=\"w-3 h-3 text-blue-500\" />\n                  <span className=\"text-muted-foreground\">{format.name}:</span>\n                </div>\n                <code className=\"bg-white dark:bg-gray-800 px-2 py-1 rounded text-xs border\">\n                  {enableMarkdown ? format.markdown : format.html}\n                </code>\n              </div>\n            ))}\n          </div>\n          \n          {formatOptions.length > 6 && (\n            <div className=\"text-center pt-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"text-xs h-6\"\n                onClick={() => setSearchTerm('')}\n              >\n                –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ ({formatOptions.length}) –∫–æ–º–∞–Ω–¥\n              </Button>\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":44282},"client/src/components/editor/save-template-modal.tsx":{"content":"import React, { useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport { Save, Loader2 } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport type { BotData } from '@/types/bot';\n\ninterface SaveTemplateModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  botData: BotData;\n  projectName?: string;\n}\n\ninterface TemplateFormData {\n  name: string;\n  description: string;\n  category: string;\n  isPublic: boolean;\n}\n\nexport function SaveTemplateModal({ isOpen, onClose, botData, projectName }: SaveTemplateModalProps) {\n  const [formData, setFormData] = useState<TemplateFormData>({\n    name: projectName ? `${projectName} - –®–∞–±–ª–æ–Ω` : '–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω',\n    description: '',\n    category: 'custom',\n    isPublic: false,\n  });\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤\n  const getStats = (data: BotData | any) => {\n    let nodes: any[] = [];\n    let connections: any[] = [];\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω –∏–ª–∏ –æ–±—ã—á–Ω—ã–π\n    if (data.sheets && Array.isArray(data.sheets)) {\n      // –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω - —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–∑–ª—ã –∏ —Å–≤—è–∑–∏ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤\n      data.sheets.forEach((sheet: any) => {\n        if (sheet.nodes) nodes.push(...sheet.nodes);\n        if (sheet.connections) connections.push(...sheet.connections);\n      });\n      // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã–µ —Å–≤—è–∑–∏\n      if (data.interSheetConnections) {\n        connections.push(...data.interSheetConnections);\n      }\n    } else {\n      // –û–±—ã—á–Ω—ã–π —à–∞–±–ª–æ–Ω\n      nodes = data.nodes || [];\n      connections = data.connections || [];\n    }\n    \n    return {\n      nodes: nodes.length,\n      connections: connections.length,\n      commands: nodes.filter(node => node.data?.command).length,\n      buttons: nodes.reduce((acc, node) => acc + (node.data?.buttons?.length || 0), 0),\n    };\n  };\n\n  const stats = getStats(botData);\n\n  const saveTemplateMutation = useMutation({\n    mutationFn: async (data: TemplateFormData) => {\n      return await apiRequest('POST', '/api/templates', {\n        name: data.name,\n        description: data.description,\n        category: data.category,\n        tags: [],\n        isPublic: data.isPublic ? 1 : 0,\n        difficulty: 'easy',\n        language: 'ru',\n        requiresToken: 1,\n        complexity: 1,\n        estimatedTime: 5,\n        authorName: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',\n        featured: 0,\n        data: botData,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/templates/category/custom'] });\n      toast({\n        title: '–®–∞–±–ª–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω',\n        description: '–í–∞—à —à–∞–±–ª–æ–Ω –±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω',\n      });\n      onClose();\n      resetForm();\n    },\n    onError: () => {\n      toast({\n        title: '–û—à–∏–±–∫–∞',\n        description: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      name: projectName ? `${projectName} - –®–∞–±–ª–æ–Ω` : '–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω',\n      description: '',\n      category: 'custom',\n      isPublic: false,\n    });\n  };\n\n\n  const handleSave = () => {\n    if (!formData.name.trim()) {\n      toast({\n        title: '–û—à–∏–±–∫–∞',\n        description: '–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ',\n        variant: 'destructive',\n      });\n      return;\n    }\n    saveTemplateMutation.mutate(formData);\n  };\n\n  const categories = [\n    { value: 'custom', label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π' },\n    { value: 'business', label: '–ë–∏–∑–Ω–µ—Å' },\n    { value: 'utility', label: '–£—Ç–∏–ª–∏—Ç—ã' },\n    { value: 'games', label: '–ò–≥—Ä—ã' },\n  ];\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Save className=\"h-5 w-5\" />\n            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —à–∞–±–ª–æ–Ω\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          {/* –ù–∞–∑–≤–∞–Ω–∏–µ */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"name\">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</Label>\n            <Input\n              id=\"name\"\n              value={formData.name}\n              onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n              placeholder=\"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞\"\n            />\n          </div>\n\n          {/* –û–ø–∏—Å–∞–Ω–∏–µ */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"description\">–û–ø–∏—Å–∞–Ω–∏–µ</Label>\n            <Textarea\n              id=\"description\"\n              value={formData.description}\n              onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\n              placeholder=\"–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, –¥–ª—è —á–µ–≥–æ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω\"\n              rows={3}\n            />\n          </div>\n\n          {/* –ö–∞—Ç–µ–≥–æ—Ä–∏—è */}\n          <div className=\"space-y-2\">\n            <Label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</Label>\n            <Select\n              value={formData.category}\n              onValueChange={(value) => setFormData(prev => ({ ...prev, category: value }))}\n            >\n              <SelectTrigger>\n                <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é\" />\n              </SelectTrigger>\n              <SelectContent>\n                {categories.map((category) => (\n                  <SelectItem key={category.value} value={category.value}>\n                    {category.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* –ü—É–±–ª–∏—á–Ω–æ—Å—Ç—å */}\n          <div className=\"flex items-center space-x-2\">\n            <input\n              id=\"isPublic\"\n              type=\"checkbox\"\n              checked={formData.isPublic}\n              onChange={(e) => setFormData(prev => ({ ...prev, isPublic: e.target.checked }))}\n              className=\"h-4 w-4\"\n            />\n            <Label htmlFor=\"isPublic\">\n              –°–¥–µ–ª–∞—Ç—å —à–∞–±–ª–æ–Ω –ø—É–±–ª–∏—á–Ω—ã–º (–¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)\n            </Label>\n          </div>\n\n          {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞ */}\n          <div className=\"p-4 bg-muted rounded-lg\">\n            <h4 className=\"font-medium mb-2\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∞–±–ª–æ–Ω–µ:</h4>\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div>\n                <span className=\"text-muted-foreground\">–£–∑–ª–æ–≤:</span>\n                <span className=\"ml-2 font-medium\">{stats.nodes}</span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">–°–≤—è–∑–µ–π:</span>\n                <span className=\"ml-2 font-medium\">{stats.connections}</span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">–ö–æ–º–∞–Ω–¥:</span>\n                <span className=\"ml-2 font-medium\">{stats.commands}</span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">–ö–Ω–æ–ø–æ–∫:</span>\n                <span className=\"ml-2 font-medium\">{stats.buttons}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={onClose}>\n            –û—Ç–º–µ–Ω–∞\n          </Button>\n          <Button\n            onClick={handleSave}\n            disabled={saveTemplateMutation.isPending || !formData.name.trim()}\n          >\n            {saveTemplateMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":8785},"client/src/components/editor/smart-connection-creator.tsx":{"content":"import React, { useState, useCallback, useMemo } from 'react';\nimport { Node, Connection, Button } from '@/types/bot';\nimport { Badge } from '@/components/ui/badge';\nimport { Button as UIButton } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Separator } from '@/components/ui/separator';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { \n  Plus, \n  Zap, \n  Target, \n  Link, \n  ArrowRight,\n  Lightbulb,\n  CheckCircle,\n  XCircle,\n  Settings,\n  Network,\n  Brain,\n  Wand2,\n  Sparkles\n} from 'lucide-react';\nimport { ConnectionManager, ConnectionSuggestion } from '@/utils/connection-manager';\nimport { cn } from '@/lib/utils';\n\ninterface SmartConnectionCreatorProps {\n  nodes: Node[];\n  connections: Connection[];\n  onConnectionAdd: (connection: Connection) => void;\n  onNodesChange: (nodes: Node[]) => void;\n  autoButtonCreation: boolean;\n  selectedNodeId?: string;\n}\n\ninterface ConnectionTemplate {\n  id: string;\n  name: string;\n  description: string;\n  sourceTypes: Node['type'][];\n  targetTypes: Node['type'][];\n  buttonTemplate: Partial<Button>;\n  priority: number;\n  useCase: string;\n}\n\nconst connectionTemplates: ConnectionTemplate[] = [\n  {\n    id: 'start-welcome',\n    name: '–°—Ç–∞—Ä—Ç–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',\n    description: '–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Å—Ç–∞—Ä—Ç–∞ –∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é',\n    sourceTypes: ['start'],\n    targetTypes: ['message'],\n    buttonTemplate: {\n      text: 'üëã –ù–∞—á–∞—Ç—å',\n      action: 'goto'\n    },\n    priority: 1,\n    useCase: '–ü–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º'\n  },\n  {\n    id: 'menu-navigation',\n    name: '–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ–Ω—é',\n    description: '–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º—É –º–µ–Ω—é',\n    sourceTypes: ['message'],\n    targetTypes: ['keyboard'],\n    buttonTemplate: {\n      text: 'üìã –ú–µ–Ω—é',\n      action: 'goto'\n    },\n    priority: 2,\n    useCase: '–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—ã–±–æ—Ä–∞'\n  },\n  {\n    id: 'command-response',\n    name: '–û—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É',\n    description: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n    sourceTypes: ['command'],\n    targetTypes: ['message', 'photo'],\n    buttonTemplate: {\n      text: '‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å',\n      action: 'command'\n    },\n    priority: 3,\n    useCase: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'\n  },\n  {\n    id: 'input-processing',\n    name: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞',\n    description: '–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –≤–≤–æ–¥–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö',\n    sourceTypes: ['input'],\n    targetTypes: ['message', 'condition'],\n    buttonTemplate: {\n      text: 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å',\n      action: 'goto'\n    },\n    priority: 4,\n    useCase: '–°–±–æ—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö'\n  },\n  {\n    id: 'media-showcase',\n    name: '–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–µ–¥–∏–∞',\n    description: '–ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é —Ñ–æ—Ç–æ –∏–ª–∏ –º–µ–¥–∏–∞–∫–æ–Ω—Ç–µ–Ω—Ç–∞',\n    sourceTypes: ['message', 'keyboard'],\n    targetTypes: ['photo'],\n    buttonTemplate: {\n      text: 'üñºÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å',\n      action: 'goto'\n    },\n    priority: 5,\n    useCase: '–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞'\n  }\n];\n\nexport function SmartConnectionCreator({\n  nodes,\n  connections,\n  onConnectionAdd,\n  onNodesChange,\n  autoButtonCreation,\n  selectedNodeId\n}: SmartConnectionCreatorProps) {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [activeTab, setActiveTab] = useState<'manual' | 'templates' | 'smart'>('smart');\n  const [selectedSourceId, setSelectedSourceId] = useState<string>(selectedNodeId || '');\n  const [selectedTargetId, setSelectedTargetId] = useState<string>('');\n  const [buttonText, setButtonText] = useState('');\n  const [buttonAction, setButtonAction] = useState<'goto' | 'command' | 'url'>('goto');\n  const [smartSuggestions, setSmartSuggestions] = useState<ConnectionSuggestion[]>([]);\n  const [isGeneratingSmartSuggestions, setIsGeneratingSmartSuggestions] = useState(false);\n\n  const connectionManager = useMemo(() => \n    new ConnectionManager({\n      nodes,\n      connections,\n      autoButtonCreation\n    }),\n    [nodes, connections, autoButtonCreation]\n  );\n\n  // –ê–Ω–∞–ª–∏–∑ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å–≤—è–∑–µ–π\n  const missingConnections = useMemo(() => {\n    const orphanedNodes = nodes.filter(node => {\n      const hasIncoming = connections.some(conn => conn.target === node.id);\n      const hasOutgoing = connections.some(conn => conn.source === node.id);\n      \n      if (node.type === 'start') return !hasOutgoing;\n      if (node.type === 'command') return !hasOutgoing;\n      return !hasIncoming && !hasOutgoing;\n    });\n\n    return orphanedNodes;\n  }, [nodes, connections]);\n\n  // –ü–æ–¥—Ö–æ–¥—è—â–∏–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞\n  const applicableTemplates = useMemo(() => {\n    if (!selectedSourceId) return connectionTemplates;\n    \n    const sourceNode = nodes.find(n => n.id === selectedSourceId);\n    if (!sourceNode) return [];\n    \n    return connectionTemplates.filter(template => \n      template.sourceTypes.includes(sourceNode.type)\n    );\n  }, [selectedSourceId, nodes]);\n\n  // –î–æ—Å—Ç—É–ø–Ω—ã–µ —É–∑–ª—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\n  const availableTargets = useMemo(() => {\n    if (!selectedSourceId) return nodes;\n    \n    const existingTargets = new Set(\n      connections\n        .filter(conn => conn.source === selectedSourceId)\n        .map(conn => conn.target)\n    );\n    \n    return nodes.filter(node => \n      node.id !== selectedSourceId && !existingTargets.has(node.id)\n    );\n  }, [selectedSourceId, nodes, connections]);\n\n  const getNodeName = useCallback((nodeId: string) => {\n    const node = nodes.find(n => n.id === nodeId);\n    if (!node) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª';\n    \n    const typeNames = {\n      start: '–°—Ç–∞—Ä—Ç',\n      command: node.data.command || '–ö–æ–º–∞–Ω–¥–∞',\n      message: '–°–æ–æ–±—â–µ–Ω–∏–µ',\n      keyboard: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞',\n      photo: '–§–æ—Ç–æ',\n      condition: '–£—Å–ª–æ–≤–∏–µ',\n      input: '–í–≤–æ–¥'\n    };\n    \n    return typeNames[node.type] || node.type;\n  }, [nodes]);\n\n  const generateSmartSuggestions = useCallback(async () => {\n    setIsGeneratingSmartSuggestions(true);\n    try {\n      connectionManager.updateState({ nodes, connections });\n      const suggestions = connectionManager.generateConnectionSuggestions();\n      setSmartSuggestions(suggestions.slice(0, 10)); // –¢–æ–ø 10 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π\n    } finally {\n      setIsGeneratingSmartSuggestions(false);\n    }\n  }, [connectionManager, nodes, connections]);\n\n  const createManualConnection = useCallback(() => {\n    if (!selectedSourceId || !selectedTargetId) return;\n    \n    try {\n      const { connection, updatedNodes } = connectionManager.createConnection(\n        selectedSourceId,\n        selectedTargetId,\n        {\n          autoCreateButton: autoButtonCreation,\n          buttonText: buttonText || undefined,\n          buttonAction: buttonAction\n        }\n      );\n      \n      onConnectionAdd(connection);\n      onNodesChange(updatedNodes);\n      \n      // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã\n      setSelectedTargetId('');\n      setButtonText('');\n      setIsDialogOpen(false);\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–≤—è–∑–∏:', error);\n    }\n  }, [\n    selectedSourceId,\n    selectedTargetId,\n    buttonText,\n    buttonAction,\n    connectionManager,\n    autoButtonCreation,\n    onConnectionAdd,\n    onNodesChange\n  ]);\n\n  const applyTemplate = useCallback((template: ConnectionTemplate) => {\n    if (!selectedSourceId) return;\n    \n    const sourceNode = nodes.find(n => n.id === selectedSourceId);\n    if (!sourceNode) return;\n    \n    const suitableTargets = availableTargets.filter(node => \n      template.targetTypes.includes(node.type)\n    );\n    \n    if (suitableTargets.length === 0) return;\n    \n    const targetNode = suitableTargets[0]; // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π\n    \n    try {\n      const { connection, updatedNodes } = connectionManager.createConnection(\n        selectedSourceId,\n        targetNode.id,\n        {\n          autoCreateButton: true,\n          buttonText: template.buttonTemplate.text,\n          buttonAction: template.buttonTemplate.action\n        }\n      );\n      \n      onConnectionAdd(connection);\n      onNodesChange(updatedNodes);\n      setIsDialogOpen(false);\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞:', error);\n    }\n  }, [selectedSourceId, nodes, availableTargets, connectionManager, onConnectionAdd, onNodesChange]);\n\n  const applySuggestion = useCallback((suggestion: ConnectionSuggestion) => {\n    try {\n      const { connection, updatedNodes } = connectionManager.createConnection(\n        suggestion.connection.source,\n        suggestion.connection.target,\n        {\n          autoCreateButton: autoButtonCreation,\n          buttonText: suggestion.suggestedButton.text,\n          buttonAction: suggestion.suggestedButton.action\n        }\n      );\n      \n      onConnectionAdd(connection);\n      onNodesChange(updatedNodes);\n      \n      // –£–¥–∞–ª—è–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ\n      setSmartSuggestions(prev => prev.filter(s => s.id !== suggestion.id));\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:', error);\n    }\n  }, [connectionManager, autoButtonCreation, onConnectionAdd, onNodesChange]);\n\n  const getConfidenceColor = useCallback((confidence: number) => {\n    if (confidence >= 0.8) return 'bg-green-100 text-green-800 border-green-200';\n    if (confidence >= 0.6) return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n    return 'bg-red-100 text-red-800 border-red-200';\n  }, []);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5\" />\n            –£–º–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π\n          </CardTitle>\n          <CardDescription>\n            –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}\n          <div className=\"grid grid-cols-3 gap-4 mb-4\">\n            <div className=\"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n              <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                {connections.length}\n              </div>\n              <div className=\"text-sm text-muted-foreground\">–í—Å–µ–≥–æ —Å–≤—è–∑–µ–π</div>\n            </div>\n            <div className=\"text-center p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg\">\n              <div className=\"text-2xl font-bold text-orange-600 dark:text-orange-400\">\n                {missingConnections.length}\n              </div>\n              <div className=\"text-sm text-muted-foreground\">–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤</div>\n            </div>\n            <div className=\"text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\n              <div className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">\n                {smartSuggestions.length}\n              </div>\n              <div className=\"text-sm text-muted-foreground\">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</div>\n            </div>\n          </div>\n\n          {/* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n          <div className=\"flex gap-2 mb-4\">\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n              <DialogTrigger asChild>\n                <UIButton>\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å\n                </UIButton>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–≤—è–∑–∏</DialogTitle>\n                  <DialogDescription>\n                    –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏\n                  </DialogDescription>\n                </DialogHeader>\n                \n                <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as typeof activeTab)}>\n                  <TabsList className=\"grid w-full grid-cols-3\">\n                    <TabsTrigger value=\"smart\">\n                      <Sparkles className=\"h-4 w-4 mr-2\" />\n                      –£–º–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è\n                    </TabsTrigger>\n                    <TabsTrigger value=\"templates\">\n                      <Wand2 className=\"h-4 w-4 mr-2\" />\n                      –®–∞–±–ª–æ–Ω—ã\n                    </TabsTrigger>\n                    <TabsTrigger value=\"manual\">\n                      <Settings className=\"h-4 w-4 mr-2\" />\n                      –í—Ä—É—á–Ω—É—é\n                    </TabsTrigger>\n                  </TabsList>\n\n                  <TabsContent value=\"smart\" className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <p className=\"text-sm text-muted-foreground\">\n                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–æ—Ç–∞\n                      </p>\n                      <UIButton\n                        onClick={generateSmartSuggestions}\n                        disabled={isGeneratingSmartSuggestions}\n                        variant=\"outline\"\n                      >\n                        {isGeneratingSmartSuggestions ? '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...' : '–û–±–Ω–æ–≤–∏—Ç—å'}\n                      </UIButton>\n                    </div>\n                    \n                    <div className=\"space-y-2 max-h-80 overflow-y-auto\">\n                      {smartSuggestions.map((suggestion) => (\n                        <div\n                          key={suggestion.id}\n                          className=\"p-3 border rounded-lg space-y-2\"\n                        >\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-2\">\n                              <Target className=\"h-4 w-4\" />\n                              <span className=\"font-medium text-sm\">\n                                {getNodeName(suggestion.connection.source)} ‚Üí {getNodeName(suggestion.connection.target)}\n                              </span>\n                            </div>\n                            <Badge className={cn(\"text-xs\", getConfidenceColor(suggestion.confidence))}>\n                              {Math.round(suggestion.confidence * 100)}%\n                            </Badge>\n                          </div>\n                          \n                          <p className=\"text-xs text-muted-foreground\">\n                            {suggestion.reason}\n                          </p>\n                          \n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-2\">\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                {suggestion.suggestedButton.text}\n                              </Badge>\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                {suggestion.suggestedButton.action}\n                              </Badge>\n                            </div>\n                            \n                            <UIButton\n                              size=\"sm\"\n                              onClick={() => applySuggestion(suggestion)}\n                              disabled={suggestion.confidence < 0.5}\n                            >\n                              <CheckCircle className=\"h-3 w-3 mr-1\" />\n                              –ü—Ä–∏–º–µ–Ω–∏—Ç—å\n                            </UIButton>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"templates\" className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"template-source\">–ò—Å—Ö–æ–¥–Ω—ã–π —É–∑–µ–ª</Label>\n                      <Select value={selectedSourceId} onValueChange={setSelectedSourceId}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π —É–∑–µ–ª\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {nodes.map(node => (\n                            <SelectItem key={node.id} value={node.id}>\n                              {getNodeName(node.id)}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    \n                    <div className=\"space-y-2 max-h-80 overflow-y-auto\">\n                      {applicableTemplates.map((template) => (\n                        <div\n                          key={template.id}\n                          className=\"p-3 border rounded-lg space-y-2\"\n                        >\n                          <div className=\"flex items-center justify-between\">\n                            <h4 className=\"font-medium\">{template.name}</h4>\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {template.priority}\n                            </Badge>\n                          </div>\n                          \n                          <p className=\"text-sm text-muted-foreground\">\n                            {template.description}\n                          </p>\n                          \n                          <div className=\"flex items-center gap-2\">\n                            <Badge variant=\"secondary\" className=\"text-xs\">\n                              {template.useCase}\n                            </Badge>\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {template.buttonTemplate.text}\n                            </Badge>\n                          </div>\n                          \n                          <UIButton\n                            size=\"sm\"\n                            onClick={() => applyTemplate(template)}\n                            disabled={!selectedSourceId}\n                            className=\"w-full\"\n                          >\n                            <Zap className=\"h-3 w-3 mr-1\" />\n                            –ü—Ä–∏–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω\n                          </UIButton>\n                        </div>\n                      ))}\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"manual\" className=\"space-y-4\">\n                    <div className=\"space-y-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"source-node\">–ò—Å—Ö–æ–¥–Ω—ã–π —É–∑–µ–ª</Label>\n                        <Select value={selectedSourceId} onValueChange={setSelectedSourceId}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π —É–∑–µ–ª\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {nodes.map(node => (\n                              <SelectItem key={node.id} value={node.id}>\n                                {getNodeName(node.id)}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"target-node\">–¶–µ–ª–µ–≤–æ–π —É–∑–µ–ª</Label>\n                        <Select value={selectedTargetId} onValueChange={setSelectedTargetId}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {availableTargets.map(node => (\n                              <SelectItem key={node.id} value={node.id}>\n                                {getNodeName(node.id)}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      \n                      <Separator />\n                      \n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"button-text\">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</Label>\n                        <Input\n                          id=\"button-text\"\n                          value={buttonText}\n                          onChange={(e) => setButtonText(e.target.value)}\n                          placeholder=\"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è\"\n                        />\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"button-action\">–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è –∫–Ω–æ–ø–∫–∏</Label>\n                        <Select value={buttonAction} onValueChange={(value: typeof buttonAction) => setButtonAction(value)}>\n                          <SelectTrigger>\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"goto\">–ü–µ—Ä–µ—Ö–æ–¥</SelectItem>\n                            <SelectItem value=\"command\">–ö–æ–º–∞–Ω–¥–∞</SelectItem>\n                            <SelectItem value=\"url\">–°—Å—ã–ª–∫–∞</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      \n                      <UIButton\n                        onClick={createManualConnection}\n                        disabled={!selectedSourceId || !selectedTargetId}\n                        className=\"w-full\"\n                      >\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å\n                      </UIButton>\n                    </div>\n                  </TabsContent>\n                </Tabs>\n              </DialogContent>\n            </Dialog>\n            \n            <UIButton\n              onClick={generateSmartSuggestions}\n              disabled={isGeneratingSmartSuggestions}\n              variant=\"outline\"\n            >\n              <Lightbulb className=\"h-4 w-4 mr-2\" />\n              –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è\n            </UIButton>\n          </div>\n\n          {/* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è */}\n          {missingConnections.length > 0 && (\n            <div className=\"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 rounded-lg\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                <XCircle className=\"h-4 w-4 text-yellow-600\" />\n                <span className=\"font-medium text-yellow-800 dark:text-yellow-200\">\n                  –ù–∞–π–¥–µ–Ω—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–∑–ª—ã\n                </span>\n              </div>\n              <p className=\"text-sm text-yellow-700 dark:text-yellow-300 mb-2\">\n                {missingConnections.length} —É–∑–ª–æ–≤ –Ω–µ –∏–º–µ—é—Ç —Å–≤—è–∑–µ–π –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n              </p>\n              <div className=\"flex flex-wrap gap-1\">\n                {missingConnections.map(node => (\n                  <Badge key={node.id} variant=\"outline\" className=\"text-xs\">\n                    {getNodeName(node.id)}\n                  </Badge>\n                ))}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":24824},"client/src/components/editor/templates-modal.tsx":{"content":"import { useState, useMemo } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Loader2, Search, Download, Eye, Calendar, User, Filter, Star, TrendingUp, Crown, Sparkles, Trash2, Heart, Bookmark, Clock, Globe, Shield } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { format } from 'date-fns';\nimport { ru } from 'date-fns/locale';\nimport type { BotTemplate } from '@shared/schema';\nimport type { BotData } from '@/types/bot';\n\ninterface TemplatesModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelectTemplate: (template: BotTemplate) => void;\n}\n\nexport function TemplatesModal({ isOpen, onClose, onSelectTemplate }: TemplatesModalProps) {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [selectedTemplate, setSelectedTemplate] = useState<BotTemplate | null>(null);\n  const [showPreview, setShowPreview] = useState(false);\n  const [currentTab, setCurrentTab] = useState('all');\n  const [sortBy, setSortBy] = useState<'popular' | 'rating' | 'recent' | 'name'>('popular');\n\n  const { toast } = useToast();\n\n  // –û—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞\n  if (isOpen) {\n    console.log('Templates modal is open');\n  }\n\n  const { data: templates = [], isLoading } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates'],\n    enabled: isOpen,\n  });\n\n  const { data: featuredTemplates = [], isLoading: isLoadingFeatured } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates/featured'],\n    enabled: isOpen && currentTab === 'featured',\n  });\n\n  const { data: myTemplates = [], isLoading: isLoadingMy } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates/category/custom'],\n    enabled: isOpen,\n    staleTime: 0, // Always refetch when needed\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n  const useTemplateMutation = useMutation({\n    mutationFn: async (templateId: number) => {\n      const response = await fetch(`/api/templates/${templateId}/use`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to increment use count');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —à–∞–±–ª–æ–Ω–∞\n  const rateTemplateMutation = useMutation({\n    mutationFn: async ({ templateId, rating }: { templateId: number; rating: number }) => {\n      const response = await fetch(`/api/templates/${templateId}/rate`, {\n        method: 'POST',\n        body: JSON.stringify({ rating }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) throw new Error('Failed to rate template');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      toast({\n        title: '–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!',\n        description: '–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ –ø–æ–º–æ–∂–µ—Ç –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º',\n      });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞\n  const deleteTemplateMutation = useMutation({\n    mutationFn: async (templateId: number) => {\n      const response = await fetch(`/api/templates/${templateId}`, {\n        method: 'DELETE',\n      });\n      if (!response.ok) throw new Error('Failed to delete template');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/templates/category/custom'] });\n      toast({\n        title: '–®–∞–±–ª–æ–Ω —É–¥–∞–ª–µ–Ω',\n        description: '–®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω',\n      });\n    },\n    onError: () => {\n      toast({\n        title: '–û—à–∏–±–∫–∞',\n        description: '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —à–∞–±–ª–æ–Ω–∞\n  const viewTemplateMutation = useMutation({\n    mutationFn: async (templateId: number) => {\n      const response = await fetch(`/api/templates/${templateId}/view`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to increment view count');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –ª–∞–π–∫–∞ —à–∞–±–ª–æ–Ω–∞\n  const likeTemplateMutation = useMutation({\n    mutationFn: async ({ templateId, liked }: { templateId: number; liked: boolean }) => {\n      const response = await fetch(`/api/templates/${templateId}/like`, {\n        method: 'POST',\n        body: JSON.stringify({ liked }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) throw new Error('Failed to toggle like');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      toast({\n        title: '–ì–æ—Ç–æ–≤–æ!',\n        description: '–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ —É—á—Ç–µ–Ω–∞',\n      });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –∑–∞–∫–ª–∞–¥–∫–∏ —à–∞–±–ª–æ–Ω–∞\n  const bookmarkTemplateMutation = useMutation({\n    mutationFn: async ({ templateId, bookmarked }: { templateId: number; bookmarked: boolean }) => {\n      const response = await fetch(`/api/templates/${templateId}/bookmark`, {\n        method: 'POST',\n        body: JSON.stringify({ bookmarked }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) throw new Error('Failed to toggle bookmark');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      toast({\n        title: '–ì–æ—Ç–æ–≤–æ!',\n        description: '–ó–∞–∫–ª–∞–¥–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞',\n      });\n    },\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞\n  const downloadTemplateMutation = useMutation({\n    mutationFn: async (templateId: number) => {\n      const response = await fetch(`/api/templates/${templateId}/download`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to increment download count');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n    },\n  });\n\n  const categories = [\n    { value: 'all', label: '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' },\n    { value: 'custom', label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ' },\n    { value: 'business', label: '–ë–∏–∑–Ω–µ—Å' },\n    { value: 'entertainment', label: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è' },\n    { value: 'education', label: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ' },\n    { value: 'utility', label: '–£—Ç–∏–ª–∏—Ç—ã' },\n    { value: 'games', label: '–ò–≥—Ä—ã' },\n    { value: 'official', label: '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ' },\n    { value: 'community', label: '–°–æ–æ–±—â–µ—Å—Ç–≤–æ' },\n  ];\n\n  const difficultyLabels = {\n    easy: '–õ–µ–≥–∫–∏–π',\n    medium: '–°—Ä–µ–¥–Ω–∏–π',\n    hard: '–°–ª–æ–∂–Ω—ã–π',\n  };\n\n  const filteredAndSortedTemplates = useMemo(() => {\n    let templatesData = currentTab === 'featured' ? featuredTemplates : \n                       currentTab === 'my' ? myTemplates : templates;\n    \n    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è\n    let filtered = templatesData.filter((template: BotTemplate) => {\n      const matchesSearch = template.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                           (template.description && template.description.toLowerCase().includes(searchTerm.toLowerCase())) ||\n                           (template.tags && template.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase())));\n      const matchesCategory = selectedCategory === 'all' || template.category === selectedCategory;\n      return matchesSearch && matchesCategory;\n    });\n\n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ \"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ\"\n    if (currentTab === 'popular') {\n      filtered = filtered.filter(t => (t.useCount || 0) > 0);\n    }\n\n    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞\n    filtered.sort((a, b) => {\n      switch (sortBy) {\n        case 'popular':\n          return (b.useCount || 0) - (a.useCount || 0);\n        case 'rating':\n          return (b.rating || 0) - (a.rating || 0);\n        case 'recent':\n          const bDate = b.createdAt ? new Date(b.createdAt).getTime() : 0;\n          const aDate = a.createdAt ? new Date(a.createdAt).getTime() : 0;\n          return bDate - aDate;\n        case 'name':\n          return a.name.localeCompare(b.name);\n        default:\n          return 0;\n      }\n    });\n\n    return filtered;\n  }, [templates, featuredTemplates, myTemplates, currentTab, searchTerm, selectedCategory, sortBy]);\n\n  const handleUseTemplate = async (template: BotTemplate) => {\n    try {\n      console.log('–ü—Ä–∏–º–µ–Ω—è–µ–º —à–∞–±–ª–æ–Ω:', template.name, template.data);\n      \n      // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º —à–∞–±–ª–æ–Ω –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É\n      onSelectTemplate(template);\n      \n      // –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n      await useTemplateMutation.mutateAsync(template.id);\n      \n      toast({\n        title: '–®–∞–±–ª–æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω',\n        description: `–®–∞–±–ª–æ–Ω \"${template.name}\" –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Ö–æ–ª—Å—Ç`,\n      });\n      onClose();\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞:', error);\n      toast({\n        title: '–û—à–∏–±–∫–∞',\n        description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleRateTemplate = async (template: BotTemplate, rating: number) => {\n    try {\n      await rateTemplateMutation.mutateAsync({ templateId: template.id, rating });\n    } catch (error) {\n      toast({\n        title: '–û—à–∏–±–∫–∞',\n        description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleDeleteTemplate = async (template: BotTemplate) => {\n    if (window.confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω \"${template.name}\"?`)) {\n      try {\n        await deleteTemplateMutation.mutateAsync(template.id);\n      } catch (error) {\n        toast({\n          title: '–û—à–∏–±–∫–∞',\n          description: '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω',\n          variant: 'destructive',\n        });\n      }\n    }\n  };\n\n  const getTemplateStats = (botData: BotData | any) => {\n    let nodes: any[] = [];\n    let connections: any[] = [];\n    \n    console.log('üîç Calculating stats for template data:', botData);\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω –∏–ª–∏ –æ–±—ã—á–Ω—ã–π\n    if (botData.sheets && Array.isArray(botData.sheets)) {\n      console.log('üìã Multi-sheet template detected, sheets count:', botData.sheets.length);\n      // –ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω - —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–∑–ª—ã –∏ —Å–≤—è–∑–∏ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤\n      botData.sheets.forEach((sheet: any, index: number) => {\n        if (sheet.nodes) {\n          console.log(`üìÑ Sheet ${index + 1} (${sheet.name}): ${sheet.nodes.length} nodes`);\n          nodes.push(...sheet.nodes);\n        }\n        if (sheet.connections) {\n          console.log(`üîó Sheet ${index + 1} (${sheet.name}): ${sheet.connections.length} connections`);\n          connections.push(...sheet.connections);\n        }\n      });\n      // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–∂–ª–∏—Å—Ç–æ–≤—ã–µ —Å–≤—è–∑–∏\n      if (botData.interSheetConnections) {\n        console.log('üîÑ Inter-sheet connections:', botData.interSheetConnections.length);\n        connections.push(...botData.interSheetConnections);\n      }\n    } else {\n      console.log('üìù Regular template detected');\n      // –û–±—ã—á–Ω—ã–π —à–∞–±–ª–æ–Ω\n      nodes = botData.nodes || [];\n      connections = botData.connections || [];\n    }\n    \n    const stats = {\n      nodes: nodes.length,\n      connections: connections.length,\n      commands: nodes.filter(node => node.data?.command).length,\n      buttons: nodes.reduce((acc, node) => acc + (node.data?.buttons?.length || 0), 0),\n    };\n    \n    console.log('üìä Final stats:', stats);\n    return stats;\n  };\n\n  const handlePreview = (template: BotTemplate) => {\n    console.log('üéØ PREVIEW BUTTON CLICKED FOR TEMPLATE:', template.name);\n    console.log('üéØ TEMPLATE DATA STRUCTURE:', Object.keys(template.data || {}));\n    console.log('üéØ FULL TEMPLATE DATA:', template.data);\n    setSelectedTemplate(template);\n    setShowPreview(true);\n  };\n\n  const TemplatePreview = ({ template }: { template: BotTemplate }) => {\n    console.log('üëÅÔ∏è TemplatePreview rendering for:', template.name);\n    console.log('üì¶ Template data received:', template.data);\n    const stats = getTemplateStats(template.data as BotData);\n    console.log('üìà Stats calculated:', stats);\n    \n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold\">{template.name}</h3>\n          <Button size=\"sm\" onClick={() => setShowPreview(false)}>\n            –ó–∞–∫—Ä—ã—Ç—å\n          </Button>\n        </div>\n        \n        {template.description && (\n          <p className=\"text-muted-foreground\">{template.description}</p>\n        )}\n        \n        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n          <div className=\"p-3 bg-muted dark:bg-muted/50 rounded-lg\">\n            <div className=\"font-medium\">–£–∑–ª–æ–≤</div>\n            <div className=\"text-2xl font-bold text-primary\">{stats.nodes}</div>\n          </div>\n          <div className=\"p-3 bg-muted dark:bg-muted/50 rounded-lg\">\n            <div className=\"font-medium\">–°–≤—è–∑–µ–π</div>\n            <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{stats.connections}</div>\n          </div>\n          <div className=\"p-3 bg-muted dark:bg-muted/50 rounded-lg\">\n            <div className=\"font-medium\">–ö–æ–º–∞–Ω–¥</div>\n            <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{stats.commands}</div>\n          </div>\n          <div className=\"p-3 bg-muted dark:bg-muted/50 rounded-lg\">\n            <div className=\"font-medium\">–ö–Ω–æ–ø–æ–∫</div>\n            <div className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">{stats.buttons}</div>\n          </div>\n        </div>\n        \n        {template.tags && template.tags.length > 0 && (\n          <div>\n            <h4 className=\"font-medium mb-2\">–¢–µ–≥–∏:</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {template.tags.map((tag) => (\n                <Badge key={tag} variant=\"secondary\">{tag}</Badge>\n              ))}\n            </div>\n          </div>\n        )}\n        \n        <div className=\"flex gap-2 pt-4\">\n          <Button onClick={() => handleUseTemplate(template)} className=\"flex-1\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω\n          </Button>\n        </div>\n      </div>\n    );\n  };\n\n  interface TemplateGridProps {\n    templates: BotTemplate[];\n    isLoading: boolean;\n    onPreview: (template: BotTemplate) => void;\n    onUse: (template: BotTemplate) => void;\n    onRate: (template: BotTemplate, rating: number) => void;\n    onDelete?: (template: BotTemplate) => void;\n    searchTerm: string;\n    selectedCategory: string;\n    showDeleteButton?: boolean;\n  }\n\n  const TemplateGrid = ({ \n    templates, \n    isLoading, \n    onPreview, \n    onUse, \n    onRate, \n    onDelete, \n    searchTerm, \n    selectedCategory, \n    showDeleteButton = false \n  }: TemplateGridProps) => {\n    if (isLoading) {\n      return (\n        <div className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-8 w-8 animate-spin\" />\n        </div>\n      );\n    }\n\n    if (templates.length === 0) {\n      return (\n        <div className=\"text-center py-8\">\n          <p className=\"text-muted-foreground\">\n            {searchTerm || selectedCategory !== 'all' \n              ? '–®–∞–±–ª–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' \n              : '–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤'}\n          </p>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 py-4\">\n        {templates.map((template: BotTemplate) => {\n          console.log('üé´ Rendering template card for:', template.name);\n          console.log('üé´ Template data keys:', Object.keys(template.data || {}));\n          const stats = getTemplateStats(template.data as BotData);\n          console.log('üé´ Stats for', template.name, ':', stats);\n          \n          // –í—Ä–µ–º–µ–Ω–Ω—ã–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –∞–ª–µ—Ä—Ç –¥–ª—è –º–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞\n          if (template.name.includes('–ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π')) {\n            console.log('üö® DEBUGGING MULTI-SHEET TEMPLATE');\n            console.log('üö® Template data:', template.data);\n            console.log('üö® Has sheets:', !!(template.data as any)?.sheets);\n            console.log('üö® Stats calculated:', stats);\n            // –í—Ä–µ–º–µ–Ω–Ω—ã–π –∞–ª–µ—Ä—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n            if (stats.nodes === 0) {\n              alert(`–ú–Ω–æ–≥–æ–ª–∏—Å—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω: nodes=${stats.nodes}, –Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å ${(template.data as any)?.sheets?.length || 0} –ª–∏—Å—Ç–æ–≤`);\n            }\n          }\n          \n          return (\n            <Card key={template.id} className=\"hover:shadow-lg transition-all duration-200 border-border/50 hover:border-primary/20 dark:bg-card/50 dark:hover:bg-card/80\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <CardTitle className=\"text-base\">{template.name}</CardTitle>\n                      {template.featured === 1 && (\n                        <Crown className=\"h-4 w-4 text-yellow-500\" />\n                      )}\n                    </div>\n                    {template.description && (\n                      <CardDescription className=\"mt-1 line-clamp-2\">\n                        {template.description}\n                      </CardDescription>\n                    )}\n                  </div>\n                  <Badge variant={template.isPublic ? 'default' : 'secondary'}>\n                    {template.isPublic ? '–ü—É–±–ª–∏—á–Ω—ã–π' : '–õ–∏—á–Ω—ã–π'}\n                  </Badge>\n                </div>\n                \n                <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                  <div className=\"flex items-center gap-1\">\n                    <Star className=\"h-3 w-3 fill-current\" />\n                    <span>{template.rating || 0}</span>\n                    <span>({template.ratingCount || 0})</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <TrendingUp className=\"h-3 w-3\" />\n                    <span>{template.useCount || 0} –∏—Å–ø.</span>\n                  </div>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {difficultyLabels[template.difficulty as keyof typeof difficultyLabels] || template.difficulty}\n                  </Badge>\n                </div>\n              </CardHeader>\n              \n              <CardContent className=\"space-y-3\">\n                <div className=\"grid grid-cols-4 gap-2 text-xs\">\n                  <div className=\"text-center p-2 bg-muted dark:bg-muted/30 rounded\">\n                    <div className=\"font-medium\">{stats.nodes}</div>\n                    <div className=\"text-muted-foreground\">—É–∑–ª–æ–≤</div>\n                  </div>\n                  <div className=\"text-center p-2 bg-muted dark:bg-muted/30 rounded\">\n                    <div className=\"font-medium\">{stats.connections}</div>\n                    <div className=\"text-muted-foreground\">—Å–≤—è–∑–µ–π</div>\n                  </div>\n                  <div className=\"text-center p-2 bg-muted dark:bg-muted/30 rounded\">\n                    <div className=\"font-medium\">{stats.commands}</div>\n                    <div className=\"text-muted-foreground\">–∫–æ–º–∞–Ω–¥</div>\n                  </div>\n                  <div className=\"text-center p-2 bg-muted dark:bg-muted/30 rounded\">\n                    <div className=\"font-medium\">{stats.buttons}</div>\n                    <div className=\"text-muted-foreground\">–∫–Ω–æ–ø–æ–∫</div>\n                  </div>\n                </div>\n\n                {/* –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}\n                <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                  <div className=\"flex items-center gap-2 p-2 bg-muted/50 dark:bg-muted/20 rounded\">\n                    <Eye className=\"h-3 w-3 text-muted-foreground\" />\n                    <span className=\"font-medium\">{template.viewCount || 0}</span>\n                    <span className=\"text-muted-foreground\">–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 p-2 bg-muted/50 dark:bg-muted/20 rounded\">\n                    <Download className=\"h-3 w-3 text-muted-foreground\" />\n                    <span className=\"font-medium\">{template.downloadCount || 0}</span>\n                    <span className=\"text-muted-foreground\">—Å–∫–∞—á–∏–≤–∞–Ω–∏–π</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 p-2 bg-muted/50 dark:bg-muted/20 rounded\">\n                    <Heart className=\"h-3 w-3 text-muted-foreground\" />\n                    <span className=\"font-medium\">{template.likeCount || 0}</span>\n                    <span className=\"text-muted-foreground\">–ª–∞–π–∫–æ–≤</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 p-2 bg-muted/50 dark:bg-muted/20 rounded\">\n                    <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                    <span className=\"font-medium\">{template.estimatedTime || 5}</span>\n                    <span className=\"text-muted-foreground\">–º–∏–Ω.</span>\n                  </div>\n                </div>\n\n                {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */}\n                <div className=\"flex items-center gap-2 text-xs\">\n                  {template.requiresToken === 1 && (\n                    <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                      <Shield className=\"h-3 w-3\" />\n                      –¢–æ–∫–µ–Ω\n                    </Badge>\n                  )}\n                  {template.language && template.language !== 'ru' && (\n                    <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                      <Globe className=\"h-3 w-3\" />\n                      {template.language.toUpperCase()}\n                    </Badge>\n                  )}\n                  <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                    <TrendingUp className=\"h-3 w-3\" />\n                    {template.complexity || 1}/10\n                  </Badge>\n                </div>\n                \n                {template.tags && template.tags.length > 0 && (\n                  <div className=\"flex flex-wrap gap-1\">\n                    {template.tags.slice(0, 3).map((tag) => (\n                      <Badge key={tag} variant=\"outline\" className=\"text-xs\">\n                        {tag}\n                      </Badge>\n                    ))}\n                    {template.tags.length > 3 && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        +{template.tags.length - 3}\n                      </Badge>\n                    )}\n                  </div>\n                )}\n                \n                <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                  <div className=\"flex items-center gap-1\">\n                    <Calendar className=\"h-3 w-3\" />\n                    {template.createdAt && format(new Date(template.createdAt), 'dd.MM.yyyy', { locale: ru })}\n                  </div>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {categories.find(c => c.value === template.category)?.label || template.category}\n                  </Badge>\n                </div>\n                \n                <div className=\"flex gap-2\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => onPreview(template)}\n                    className=\"flex-1\"\n                  >\n                    <Eye className=\"h-4 w-4 mr-1\" />\n                    –ü—Ä–æ—Å–º–æ—Ç—Ä\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    onClick={() => onUse(template)}\n                    className=\"flex-1\"\n                  >\n                    <Download className=\"h-4 w-4 mr-1\" />\n                    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å\n                  </Button>\n                  {showDeleteButton && onDelete && template.category === 'custom' && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"destructive\"\n                      onClick={() => onDelete(template)}\n                      className=\"px-2\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n\n                {/* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n                <div className=\"flex items-center justify-between pt-2 border-t\">\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => likeTemplateMutation.mutate({ \n                        templateId: template.id, \n                        liked: true \n                      })}\n                      className=\"h-7 px-2\"\n                    >\n                      <Heart className=\"h-3 w-3 mr-1\" />\n                      <span className=\"text-xs\">{template.likeCount || 0}</span>\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => bookmarkTemplateMutation.mutate({ \n                        templateId: template.id, \n                        bookmarked: true \n                      })}\n                      className=\"h-7 px-2\"\n                    >\n                      <Bookmark className=\"h-3 w-3 mr-1\" />\n                      <span className=\"text-xs\">{template.bookmarkCount || 0}</span>\n                    </Button>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-1\">\n                    <span className=\"text-xs text-muted-foreground mr-1\">–û—Ü–µ–Ω–∏—Ç—å:</span>\n                    {[1, 2, 3, 4, 5].map((rating) => (\n                      <button\n                        key={rating}\n                        onClick={() => onRate(template, rating)}\n                        className=\"text-muted-foreground hover:text-yellow-500 transition-colors\"\n                      >\n                        <Star className=\"h-3 w-3\" />\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    );\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <DialogHeader className=\"flex-shrink-0\">\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Sparkles className=\"h-5 w-5\" />\n            –®–∞–±–ª–æ–Ω—ã –±–æ—Ç–æ–≤\n          </DialogTitle>\n        </DialogHeader>\n\n        {showPreview && selectedTemplate ? (\n          <div className=\"flex-1 overflow-y-auto py-4 pr-2\">\n            <TemplatePreview template={selectedTemplate} />\n          </div>\n        ) : (\n          <Tabs value={currentTab} onValueChange={setCurrentTab} className=\"flex flex-col h-full min-h-0\">\n            <TabsList className=\"grid w-full grid-cols-4 flex-shrink-0\">\n              <TabsTrigger value=\"all\" className=\"flex items-center gap-2\">\n                <Filter className=\"h-4 w-4\" />\n                –í—Å–µ —à–∞–±–ª–æ–Ω—ã\n              </TabsTrigger>\n              <TabsTrigger value=\"featured\" className=\"flex items-center gap-2\">\n                <Crown className=\"h-4 w-4\" />\n                –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ\n              </TabsTrigger>\n              <TabsTrigger value=\"popular\" className=\"flex items-center gap-2\">\n                <TrendingUp className=\"h-4 w-4\" />\n                –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ\n              </TabsTrigger>\n              <TabsTrigger value=\"my\" className=\"flex items-center gap-2\">\n                <User className=\"h-4 w-4\" />\n                –ú–æ–∏ —à–∞–±–ª–æ–Ω—ã\n              </TabsTrigger>\n            </TabsList>\n\n            <div className=\"space-y-4 py-4 border-b flex-shrink-0\">\n              <div className=\"flex gap-4\">\n                <div className=\"flex-1\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n                    <Input\n                      placeholder=\"–ü–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–æ–≤...\"\n                      value={searchTerm}\n                      onChange={(e) => setSearchTerm(e.target.value)}\n                      className=\"pl-10\"\n                    />\n                  </div>\n                </div>\n                <div className=\"w-48\">\n                  <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"–ö–∞—Ç–µ–≥–æ—Ä–∏—è\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {categories.map((category) => (\n                        <SelectItem key={category.value} value={category.value}>\n                          {category.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"w-36\">\n                  <Select value={sortBy} onValueChange={(value: any) => setSortBy(value)}>\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"popular\">–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</SelectItem>\n                      <SelectItem value=\"rating\">–†–µ–π—Ç–∏–Ω–≥</SelectItem>\n                      <SelectItem value=\"recent\">–ù–æ–≤—ã–µ</SelectItem>\n                      <SelectItem value=\"name\">–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex-1 min-h-0 overflow-hidden\">\n              <TabsContent value=\"all\" className=\"h-full overflow-y-auto pr-2 mt-0\">\n                <TemplateGrid \n                  templates={filteredAndSortedTemplates} \n                  isLoading={isLoading}\n                  onPreview={handlePreview}\n                  onUse={handleUseTemplate}\n                  onRate={handleRateTemplate}\n                  searchTerm={searchTerm}\n                  selectedCategory={selectedCategory}\n                />\n              </TabsContent>\n              \n              <TabsContent value=\"featured\" className=\"h-full overflow-y-auto pr-2 mt-0\">\n                <TemplateGrid \n                  templates={filteredAndSortedTemplates} \n                  isLoading={isLoadingFeatured}\n                  onPreview={handlePreview}\n                  onUse={handleUseTemplate}\n                  onRate={handleRateTemplate}\n                  searchTerm={searchTerm}\n                  selectedCategory={selectedCategory}\n                />\n              </TabsContent>\n              \n              <TabsContent value=\"popular\" className=\"h-full overflow-y-auto pr-2 mt-0\">\n                <TemplateGrid \n                  templates={filteredAndSortedTemplates} \n                  isLoading={isLoading}\n                  onPreview={handlePreview}\n                  onUse={handleUseTemplate}\n                  onRate={handleRateTemplate}\n                  searchTerm={searchTerm}\n                  selectedCategory={selectedCategory}\n                />\n              </TabsContent>\n              \n              <TabsContent value=\"my\" className=\"h-full overflow-y-auto pr-2 mt-0\">\n                <TemplateGrid \n                  templates={filteredAndSortedTemplates} \n                  isLoading={isLoadingMy}\n                  onPreview={handlePreview}\n                  onUse={handleUseTemplate}\n                  onRate={handleRateTemplate}\n                  onDelete={handleDeleteTemplate}\n                  searchTerm={searchTerm}\n                  selectedCategory={selectedCategory}\n                  showDeleteButton={true}\n                />\n              </TabsContent>\n            </div>\n          </Tabs>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":34094},"client/src/components/editor/token-manager.tsx":{"content":"import React, { useState } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { Plus, MoreVertical, Star, StarOff, Edit, Trash2, Copy, Eye, EyeOff } from 'lucide-react';\n\ninterface BotToken {\n  id: number;\n  projectId: number;\n  name: string;\n  token: string; // Partially hidden\n  isDefault: number;\n  isActive: number;\n  description?: string;\n  lastUsedAt?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface TokenManagerProps {\n  projectId: number;\n  onTokenSelect?: (tokenId: number) => void;\n  selectedTokenId?: number | null;\n}\n\nexport function TokenManager({ projectId, onTokenSelect, selectedTokenId }: TokenManagerProps) {\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [editingToken, setEditingToken] = useState<BotToken | null>(null);\n  const [newTokenData, setNewTokenData] = useState({\n    name: '',\n    token: '',\n    description: '',\n    isDefault: false\n  });\n  const [showTokenValues, setShowTokenValues] = useState<Record<number, boolean>>({});\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞\n  const { data: tokens = [], isLoading } = useQuery<BotToken[]>({\n    queryKey: [`/api/projects/${projectId}/tokens`],\n  });\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞\n  const createTokenMutation = useMutation({\n    mutationFn: async (tokenData: typeof newTokenData) => {\n      return apiRequest('POST', `/api/projects/${projectId}/tokens`, {\n        ...tokenData,\n        isDefault: tokenData.isDefault ? 1 : 0\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"–¢–æ–∫–µ–Ω —Å–æ–∑–¥–∞–Ω\",\n        description: \"–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/tokens`] });\n      setIsAddDialogOpen(false);\n      setNewTokenData({ name: '', token: '', description: '', isDefault: false });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞\n  const updateTokenMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<BotToken> }) => {\n      return apiRequest('PUT', `/api/tokens/${id}`, data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"–¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω\",\n        description: \"–¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/tokens`] });\n      setIsEditDialogOpen(false);\n      setEditingToken(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞\n  const deleteTokenMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest('DELETE', `/api/tokens/${id}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"–¢–æ–∫–µ–Ω —É–¥–∞–ª–µ–Ω\",\n        description: \"–¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/tokens`] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç–æ–∫–µ–Ω.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n  const setDefaultMutation = useMutation({\n    mutationFn: async (tokenId: number) => {\n      return apiRequest('POST', `/api/projects/${projectId}/tokens/${tokenId}/set-default`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"–¢–æ–∫–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\",\n        description: \"–¢–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/tokens`] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: error.message || \"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreateToken = () => {\n    createTokenMutation.mutate(newTokenData);\n  };\n\n  const handleEditToken = (token: BotToken) => {\n    setEditingToken(token);\n    setIsEditDialogOpen(true);\n  };\n\n  const handleUpdateToken = () => {\n    if (!editingToken) return;\n    \n    updateTokenMutation.mutate({\n      id: editingToken.id,\n      data: {\n        name: editingToken.name,\n        description: editingToken.description,\n        isActive: editingToken.isActive\n      }\n    });\n  };\n\n  const handleDeleteToken = (id: number) => {\n    if (window.confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω?')) {\n      deleteTokenMutation.mutate(id);\n    }\n  };\n\n  const handleSetDefault = (tokenId: number) => {\n    setDefaultMutation.mutate(tokenId);\n  };\n\n  const toggleTokenVisibility = (tokenId: number) => {\n    setShowTokenValues(prev => ({\n      ...prev,\n      [tokenId]: !prev[tokenId]\n    }));\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast({\n      title: \"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ\",\n      description: \"–¢–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.\",\n    });\n  };\n\n  if (isLoading) {\n    return <div className=\"p-4\">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤...</div>;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h3 className=\"text-lg font-semibold\">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ç–æ–∫–µ–Ω–∞–º–∏ Telegram –±–æ—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞\n          </p>\n        </div>\n        \n        <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n          <DialogTrigger asChild>\n            <Button>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω</DialogTitle>\n              <DialogDescription>\n                –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"token-name\">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞</Label>\n                <Input\n                  id=\"token-name\"\n                  placeholder=\"–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç\"\n                  value={newTokenData.name}\n                  onChange={(e) => setNewTokenData({ ...newTokenData, name: e.target.value })}\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"token-value\">–¢–æ–∫–µ–Ω –±–æ—Ç–∞</Label>\n                <Input\n                  id=\"token-value\"\n                  type=\"password\"\n                  placeholder=\"–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather\"\n                  value={newTokenData.token}\n                  onChange={(e) => setNewTokenData({ ...newTokenData, token: e.target.value })}\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"token-description\">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</Label>\n                <Textarea\n                  id=\"token-description\"\n                  placeholder=\"–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞\"\n                  value={newTokenData.description}\n                  onChange={(e) => setNewTokenData({ ...newTokenData, description: e.target.value })}\n                />\n              </div>\n              \n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"is-default\"\n                  checked={newTokenData.isDefault}\n                  onCheckedChange={(checked) => setNewTokenData({ ...newTokenData, isDefault: checked })}\n                />\n                <Label htmlFor=\"is-default\">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</Label>\n              </div>\n            </div>\n            \n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setIsAddDialogOpen(false)}>\n                –û—Ç–º–µ–Ω–∞\n              </Button>\n              <Button \n                onClick={handleCreateToken}\n                disabled={!newTokenData.name || !newTokenData.token || createTokenMutation.isPending}\n              >\n                {createTokenMutation.isPending ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : '–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω'}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {tokens.length === 0 ? (\n        <Card>\n          <CardContent className=\"p-6 text-center\">\n            <p className=\"text-muted-foreground\">–¢–æ–∫–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-3\">\n          {tokens.map((token) => (\n            <Card \n              key={token.id} \n              className={`cursor-pointer transition-colors ${\n                selectedTokenId === token.id \n                  ? 'ring-2 ring-primary bg-primary/5' \n                  : 'hover:bg-accent/50'\n              }`}\n              onClick={() => onTokenSelect?.(token.id)}\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <h4 className=\"font-medium\">{token.name}</h4>\n                      {token.isDefault === 1 && (\n                        <Badge variant=\"default\">\n                          <Star className=\"w-3 h-3 mr-1\" />\n                          –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n                        </Badge>\n                      )}\n                      {token.isActive === 0 && (\n                        <Badge variant=\"secondary\">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</Badge>\n                      )}\n                    </div>\n                    \n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <span className=\"font-mono\">\n                        {showTokenValues[token.id] ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : token.token}\n                      </span>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          toggleTokenVisibility(token.id);\n                        }}\n                      >\n                        {showTokenValues[token.id] ? (\n                          <EyeOff className=\"w-3 h-3\" />\n                        ) : (\n                          <Eye className=\"w-3 h-3\" />\n                        )}\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          copyToClipboard(token.token);\n                        }}\n                      >\n                        <Copy className=\"w-3 h-3\" />\n                      </Button>\n                    </div>\n                    \n                    {token.description && (\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        {token.description}\n                      </p>\n                    )}\n                    \n                    {token.lastUsedAt && (\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: {new Date(token.lastUsedAt).toLocaleString('ru-RU', { timeZone: 'Europe/Moscow' })}\n                      </p>\n                    )}\n                  </div>\n                  \n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" size=\"sm\" onClick={(e) => e.stopPropagation()}>\n                        <MoreVertical className=\"w-4 h-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuItem onClick={() => handleEditToken(token)}>\n                        <Edit className=\"w-4 h-4 mr-2\" />\n                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å\n                      </DropdownMenuItem>\n                      \n                      {token.isDefault !== 1 && (\n                        <DropdownMenuItem onClick={() => handleSetDefault(token.id)}>\n                          <Star className=\"w-4 h-4 mr-2\" />\n                          –°–¥–µ–ª–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n                        </DropdownMenuItem>\n                      )}\n                      \n                      <DropdownMenuItem \n                        onClick={() => handleDeleteToken(token.id)}\n                        className=\"text-destructive\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        –£–¥–∞–ª–∏—Ç—å\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* Edit Token Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω</DialogTitle>\n            <DialogDescription>\n              –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–∫–µ–Ω–∞\n            </DialogDescription>\n          </DialogHeader>\n          \n          {editingToken && (\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"edit-token-name\">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞</Label>\n                <Input\n                  id=\"edit-token-name\"\n                  value={editingToken.name}\n                  onChange={(e) => setEditingToken({ ...editingToken, name: e.target.value })}\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"edit-token-description\">–û–ø–∏—Å–∞–Ω–∏–µ</Label>\n                <Textarea\n                  id=\"edit-token-description\"\n                  value={editingToken.description || ''}\n                  onChange={(e) => setEditingToken({ ...editingToken, description: e.target.value })}\n                />\n              </div>\n              \n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"edit-is-active\"\n                  checked={editingToken.isActive === 1}\n                  onCheckedChange={(checked) => setEditingToken({ \n                    ...editingToken, \n                    isActive: checked ? 1 : 0 \n                  })}\n                />\n                <Label htmlFor=\"edit-is-active\">–ê–∫—Ç–∏–≤–Ω—ã–π —Ç–æ–∫–µ–Ω</Label>\n              </div>\n            </div>\n          )}\n          \n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsEditDialogOpen(false)}>\n              –û—Ç–º–µ–Ω–∞\n            </Button>\n            <Button \n              onClick={handleUpdateToken}\n              disabled={updateTokenMutation.isPending}\n            >\n              {updateTokenMutation.isPending ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":17091},"client/src/components/editor/user-database-panel.tsx":{"content":"import { useState, useMemo } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from '@/components/ui/alert-dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { \n  Users, \n  Search, \n  Filter, \n  Download, \n  Trash2, \n  Plus, \n  BarChart3, \n  Activity, \n  Shield, \n  Crown, \n  MessageSquare,\n  Calendar,\n  Settings,\n  RefreshCw,\n  Eye,\n  UserCheck,\n  UserX,\n  Edit\n} from 'lucide-react';\nimport { UserBotData } from '@shared/schema';\nimport { DatabaseBackupPanel } from './database-backup-panel';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\ninterface UserDatabasePanelProps {\n  projectId: number;\n  projectName: string;\n}\n\ntype SortField = 'lastInteraction' | 'interactionCount' | 'createdAt' | 'firstName' | 'userName';\ntype SortDirection = 'asc' | 'desc';\n\nexport function UserDatabasePanel({ projectId, projectName }: UserDatabasePanelProps) {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedUser, setSelectedUser] = useState<UserBotData | null>(null);\n  const [showUserDetails, setShowUserDetails] = useState(false);\n  const [showCreateUser, setShowCreateUser] = useState(false);\n  const [sortField, setSortField] = useState<SortField>('lastInteraction');\n  const [sortDirection, setSortDirection] = useState<SortDirection>('desc');\n  const [filterActive, setFilterActive] = useState<boolean | null>(null);\n  const [filterPremium, setFilterPremium] = useState<boolean | null>(null);\n  const [filterBlocked, setFilterBlocked] = useState<boolean | null>(null);\n  const [filterDateRange, setFilterDateRange] = useState<'all' | 'today' | 'week' | 'month'>('all');\n  const [selectedUsers, setSelectedUsers] = useState<number[]>([]);\n  const [showBulkActions, setShowBulkActions] = useState(false);\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const isMobile = useIsMobile();\n\n  // Fetch user data\n  const { data: users = [], isLoading: usersLoading, refetch: refetchUsers } = useQuery<UserBotData[]>({\n    queryKey: [`/api/projects/${projectId}/users`],\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n  // Fetch user stats  \n  const { data: stats = {}, isLoading: statsLoading, refetch: refetchStats } = useQuery<{\n    totalUsers?: number;\n    activeUsers?: number;\n    blockedUsers?: number;\n    premiumUsers?: number;\n    totalInteractions?: number;\n    avgInteractionsPerUser?: number;\n    usersWithResponses?: number;\n  }>({\n    queryKey: [`/api/projects/${projectId}/users/stats`],\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n  // Search users\n  const { data: searchResults = [], isFetching: searchLoading } = useQuery<UserBotData[]>({\n    queryKey: [`/api/projects/${projectId}/users/search`, searchQuery],\n    enabled: searchQuery.length > 0,\n    queryFn: () => apiRequest('GET', `/api/projects/${projectId}/users/search?q=${encodeURIComponent(searchQuery)}`),\n  });\n\n  // Delete user mutation\n  const deleteUserMutation = useMutation({\n    mutationFn: (userId: number) => {\n      console.log(`Attempting to delete user with ID: ${userId}`);\n      return apiRequest('DELETE', `/api/users/${userId}`);\n    },\n    onSuccess: (data) => {\n      console.log(\"User deletion successful:\", data);\n      // Force clear cache and refetch\n      queryClient.removeQueries({ queryKey: [`/api/projects/${projectId}/users`] });\n      queryClient.removeQueries({ queryKey: [`/api/projects/${projectId}/users/stats`] });\n      \n      // Delay refetch to ensure cache is cleared\n      setTimeout(() => {\n        refetchUsers();\n        refetchStats();\n      }, 100);\n      \n      toast({\n        title: \"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω\",\n        description: \"–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã\",\n      });\n    },\n    onError: (error) => {\n      console.error(\"User deletion failed:\", error);\n      toast({\n        title: \"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Update user mutation\n  const updateUserMutation = useMutation({\n    mutationFn: ({ userId, data }: { userId: number; data: Partial<UserBotData> }) => \n      apiRequest('PUT', `/api/users/${userId}`, data),\n    onSuccess: () => {\n      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º –∫—ç—à –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ\n      queryClient.removeQueries({ queryKey: [`/api/projects/${projectId}/users`] });\n      queryClient.removeQueries({ queryKey: [`/api/projects/${projectId}/users/stats`] });\n      \n      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ\n      setTimeout(() => {\n        refetchUsers();\n        refetchStats();\n      }, 100);\n      \n      toast({\n        title: \"–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω\",\n        description: \"–°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Delete all users mutation\n  const deleteAllUsersMutation = useMutation({\n    mutationFn: () => {\n      console.log(`Attempting to delete all users for project: ${projectId}`);\n      return apiRequest('DELETE', `/api/projects/${projectId}/users`);\n    },\n    onSuccess: (data) => {\n      console.log(\"Bulk deletion successful:\", data);\n      // Force clear cache and refetch\n      queryClient.removeQueries({ queryKey: [`/api/projects/${projectId}/users`] });\n      queryClient.removeQueries({ queryKey: [`/api/projects/${projectId}/users/stats`] });\n      \n      // Delay refetch to ensure cache is cleared\n      setTimeout(() => {\n        refetchUsers();\n        refetchStats();\n      }, 100);\n      \n      const deletedCount = data?.deletedCount || 0;\n      toast({\n        title: \"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞\",\n        description: `–£–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${deletedCount}. –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã.`,\n      });\n    },\n    onError: (error) => {\n      console.error(\"Bulk deletion failed:\", error);\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –±–∞–∑—ã\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Filter and sort users\n  const filteredAndSortedUsers = useMemo(() => {\n    let result = searchQuery.length > 0 ? searchResults : users;\n\n    // Apply filters\n    if (filterActive !== null) {\n      result = result.filter(user => Boolean(user.isActive) === filterActive);\n    }\n    if (filterPremium !== null) {\n      result = result.filter(user => Boolean(user.isPremium) === filterPremium);\n    }\n    if (filterBlocked !== null) {\n      result = result.filter(user => Boolean(user.isBlocked) === filterBlocked);\n    }\n\n    // Sort\n    result = [...result].sort((a, b) => {\n      let aValue: any, bValue: any;\n      \n      // Map camelCase field names to snake_case if needed\n      if (sortField === 'lastInteraction') {\n        aValue = a.lastInteraction || a.last_interaction;\n        bValue = b.lastInteraction || b.last_interaction;\n      } else if (sortField === 'createdAt') {\n        aValue = a.createdAt || a.registered_at;\n        bValue = b.createdAt || b.registered_at;\n      } else if (sortField === 'interactionCount') {\n        aValue = a.interactionCount || a.interaction_count;\n        bValue = b.interactionCount || b.interaction_count;\n      } else if (sortField === 'firstName') {\n        aValue = a.firstName || a.first_name;\n        bValue = b.firstName || b.first_name;\n      } else if (sortField === 'userName') {\n        aValue = a.userName || a.username;\n        bValue = b.userName || b.username;\n      } else {\n        aValue = a[sortField];\n        bValue = b[sortField];\n      }\n\n      if (sortField === 'lastInteraction' || sortField === 'createdAt') {\n        aValue = new Date(aValue || 0).getTime();\n        bValue = new Date(bValue || 0).getTime();\n      } else if (typeof aValue === 'string') {\n        aValue = aValue.toLowerCase();\n        bValue = bValue?.toLowerCase() || '';\n      }\n\n      if (sortDirection === 'asc') {\n        return aValue > bValue ? 1 : -1;\n      } else {\n        return aValue < bValue ? 1 : -1;\n      }\n    });\n\n    return result;\n  }, [users, searchResults, searchQuery, filterActive, filterPremium, filterBlocked, sortField, sortDirection]);\n\n  const handleRefresh = () => {\n    refetchUsers();\n    refetchStats();\n  };\n\n  const handleUserStatusToggle = (user: UserBotData, field: 'isActive' | 'isBlocked' | 'isPremium') => {\n    const currentValue = user[field];\n    const newValue = currentValue === 1 ? 0 : 1;\n    const userId = user.id;\n    \n    if (!userId) {\n      console.error('User ID not found');\n      return;\n    }\n    \n    // –¢–æ–ª—å–∫–æ isActive —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n    if (field === 'isActive') {\n      updateUserMutation.mutate({\n        userId: userId,\n        data: { [field]: newValue }\n      });\n    } else {\n      toast({\n        title: \"–§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞\",\n        description: `–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ \"${field}\" –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è`,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const formatDate = (date: string | Date | null) => {\n    if (!date) return '–ù–∏–∫–æ–≥–¥–∞';\n    return new Date(date).toLocaleString('ru-RU', {\n      timeZone: 'Europe/Moscow',\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const formatUserName = (user: UserBotData) => {\n    const firstName = user.firstName;\n    const lastName = user.lastName;\n    const userName = user.userName;\n    const userId = user.userId;\n    \n    const parts = [firstName, lastName].filter(Boolean);\n    if (parts.length > 0) return parts.join(' ');\n    if (userName) return `@${userName}`;\n    return `ID: ${userId}`;\n  };\n\n  if (usersLoading || statsLoading) {\n    return (\n      <div className=\"h-full flex items-center justify-center\">\n        <div className=\"text-center\">\n          <RefreshCw className=\"w-8 h-8 animate-spin text-muted-foreground mx-auto mb-2\" />\n          <p className=\"text-muted-foreground\">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col bg-background min-h-0\">\n      <div className=\"border-b bg-card flex-none\">\n        <div className=\"p-4\">\n          <div className={`flex ${isMobile ? 'flex-col gap-3' : 'items-center justify-between'} mb-4`}>\n            <div>\n              <h2 className={`${isMobile ? 'text-lg' : 'text-xl'} font-semibold flex items-center gap-2`}>\n                <Users className=\"w-5 h-5\" />\n                –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n              </h2>\n              <p className=\"text-sm text-muted-foreground\">\n                –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –±–æ—Ç–∞ \"{projectName}\"\n              </p>\n            </div>\n            <div className={`flex items-center gap-2 ${isMobile ? 'self-stretch' : ''}`}>\n              <Button onClick={handleRefresh} variant=\"outline\" size={isMobile ? \"sm\" : \"sm\"} className={isMobile ? 'flex-1' : ''}>\n                <RefreshCw className=\"w-4 h-4 mr-1\" />\n                {isMobile ? '–û–±–Ω–æ–≤–∏—Ç—å' : '–û–±–Ω–æ–≤–∏—Ç—å'}\n              </Button>\n              <AlertDialog>\n                <AlertDialogTrigger asChild>\n                  <Button variant=\"destructive\" size={isMobile ? \"sm\" : \"sm\"} className={isMobile ? 'flex-1' : ''}>\n                    <Trash2 className=\"w-4 h-4 mr-1\" />\n                    {isMobile ? '–û—á–∏—Å—Ç–∏—Ç—å' : '–û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É'}\n                  </Button>\n                </AlertDialogTrigger>\n                <AlertDialogContent>\n                  <AlertDialogHeader>\n                    <AlertDialogTitle>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?</AlertDialogTitle>\n                    <AlertDialogDescription>\n                      –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —ç—Ç–æ–≥–æ –±–æ—Ç–∞ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞.\n                    </AlertDialogDescription>\n                  </AlertDialogHeader>\n                  <AlertDialogFooter>\n                    <AlertDialogCancel>–û—Ç–º–µ–Ω–∞</AlertDialogCancel>\n                    <AlertDialogAction\n                      onClick={() => deleteAllUsersMutation.mutate()}\n                      className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                    >\n                      –£–¥–∞–ª–∏—Ç—å –≤—Å–µ\n                    </AlertDialogAction>\n                  </AlertDialogFooter>\n                </AlertDialogContent>\n              </AlertDialog>\n            </div>\n          </div>\n\n          {/* Stats Cards */}\n          {stats && (\n            <div className={`grid ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-7'} gap-3 mb-4`}>\n              <Card className=\"p-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"w-4 h-4 text-blue-500\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">–í—Å–µ–≥–æ</p>\n                    <p className=\"text-sm font-semibold\">{stats.totalUsers}</p>\n                  </div>\n                </div>\n              </Card>\n              <Card className=\"p-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Activity className=\"w-4 h-4 text-green-500\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">–ê–∫—Ç–∏–≤–Ω—ã—Ö</p>\n                    <p className=\"text-sm font-semibold\">{stats.activeUsers}</p>\n                  </div>\n                </div>\n              </Card>\n              <Card className=\"p-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Shield className=\"w-4 h-4 text-red-500\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</p>\n                    <p className=\"text-sm font-semibold\">{stats.blockedUsers}</p>\n                  </div>\n                </div>\n              </Card>\n              <Card className=\"p-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Crown className=\"w-4 h-4 text-yellow-500\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">Premium</p>\n                    <p className=\"text-sm font-semibold\">{stats.premiumUsers}</p>\n                  </div>\n                </div>\n              </Card>\n              <Card className=\"p-3\">\n                <div className=\"flex items-center gap-2\">\n                  <MessageSquare className=\"w-4 h-4 text-purple-500\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">–°–æ–æ–±—â–µ–Ω–∏–π</p>\n                    <p className=\"text-sm font-semibold\">{stats.totalInteractions}</p>\n                  </div>\n                </div>\n              </Card>\n              <Card className=\"p-3\">\n                <div className=\"flex items-center gap-2\">\n                  <BarChart3 className=\"w-4 h-4 text-indigo-500\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">–°—Ä–µ–¥–Ω–µ–µ</p>\n                    <p className=\"text-sm font-semibold\">{stats.avgInteractionsPerUser}</p>\n                  </div>\n                </div>\n              </Card>\n              <Card className=\"p-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Edit className=\"w-4 h-4 text-orange-500\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">–° –æ—Ç–≤–µ—Ç–∞–º–∏</p>\n                    <p className=\"text-sm font-semibold\">{stats.usersWithResponses || 0}</p>\n                  </div>\n                </div>\n              </Card>\n            </div>\n          )}\n\n          {/* Search and Filters */}\n          <div className={`flex ${isMobile ? 'flex-col' : 'flex-col sm:flex-row'} gap-3`}>\n            <div className=\"flex-1 relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n              <Input\n                placeholder={isMobile ? \"–ü–æ–∏—Å–∫...\" : \"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, username –∏–ª–∏ ID...\"}\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <div className={`flex gap-2 ${isMobile ? 'grid grid-cols-2' : 'flex'}`}>\n              <Select value={filterActive?.toString() || 'all'} onValueChange={(value) => setFilterActive(value === 'all' ? null : value === 'true')}>\n                <SelectTrigger className={isMobile ? 'w-full' : 'w-32'}>\n                  <SelectValue placeholder=\"–°—Ç–∞—Ç—É—Å\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">–í—Å–µ</SelectItem>\n                  <SelectItem value=\"true\">–ê–∫—Ç–∏–≤–Ω—ã–µ</SelectItem>\n                  <SelectItem value=\"false\">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</SelectItem>\n                </SelectContent>\n              </Select>\n\n              <Select value={filterPremium?.toString() || 'all'} onValueChange={(value) => setFilterPremium(value === 'all' ? null : value === 'true')}>\n                <SelectTrigger className={isMobile ? 'w-full' : 'w-32'}>\n                  <SelectValue placeholder=\"Premium\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">–í—Å–µ</SelectItem>\n                  <SelectItem value=\"true\">Premium</SelectItem>\n                  <SelectItem value=\"false\">–û–±—ã—á–Ω—ã–µ</SelectItem>\n                </SelectContent>\n              </Select>\n\n              <Select value={`${sortField}-${sortDirection}`} onValueChange={(value) => {\n                const [field, direction] = value.split('-') as [SortField, SortDirection];\n                setSortField(field);\n                setSortDirection(direction);\n              }}>\n                <SelectTrigger className={isMobile ? 'w-full col-span-2' : 'w-40'}>\n                  <SelectValue placeholder=\"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"lastInteraction-desc\">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Üì</SelectItem>\n                  <SelectItem value=\"lastInteraction-asc\">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Üë</SelectItem>\n                  <SelectItem value=\"interactionCount-desc\">–ë–æ–ª—å—à–µ —Å–æ–æ–±—â–µ–Ω–∏–π</SelectItem>\n                  <SelectItem value=\"interactionCount-asc\">–ú–µ–Ω—å—à–µ —Å–æ–æ–±—â–µ–Ω–∏–π</SelectItem>\n                  <SelectItem value=\"createdAt-desc\">–ù–æ–≤—ã–µ</SelectItem>\n                  <SelectItem value=\"createdAt-asc\">–°—Ç–∞—Ä—ã–µ</SelectItem>\n                  <SelectItem value=\"firstName-asc\">–ü–æ –∏–º–µ–Ω–∏ A-Z</SelectItem>\n                  <SelectItem value=\"firstName-desc\">–ü–æ –∏–º–µ–Ω–∏ Z-A</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"w-full\">\n        <Tabs defaultValue=\"users\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"users\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</TabsTrigger>\n            <TabsTrigger value=\"backup\">–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"users\" className=\"w-full\">\n            {isMobile ? (\n              // Mobile card layout with simple scrolling  \n              <div \n                className=\"overflow-y-scroll\" \n                style={{ \n                  height: '350px', \n                  overflowY: 'scroll', \n                  WebkitOverflowScrolling: 'touch',\n                  scrollBehavior: 'smooth'\n                }}\n              >\n                <div className=\"p-4 space-y-4\">\n                  {/* Debug info */}\n                  <div className=\"text-xs text-blue-500 bg-blue-50 p-2 rounded mb-2\" data-testid=\"debug-mobile-info\">\n                    DEBUG: isMobile={isMobile.toString()}, users={users.length}, filteredUsers={filteredAndSortedUsers.length}\n                  </div>\n                  {filteredAndSortedUsers.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <div className=\"text-muted-foreground\">\n                        {searchQuery ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—â–µ –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª–∏ —Å –±–æ—Ç–æ–º'}\n                      </div>\n                    </div>\n                  ) : (\n                    filteredAndSortedUsers.map((user, index) => (\n                      <Card key={user.id || user.user_id || index} className=\"p-4\" data-testid={`user-card-mobile-${index}`}>\n                        <div className=\"space-y-3\">\n                          {/* User Header */}\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-base\">{formatUserName(user)}</div>\n                              <div className=\"text-sm text-muted-foreground\">ID: {user.userId || user.user_id}</div>\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setSelectedUser(user);\n                                  setShowUserDetails(true);\n                                }}\n                              >\n                                <Eye className=\"w-3 h-3\" />\n                              </Button>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => handleUserStatusToggle(user, 'isActive')}\n                                className={(user.isActive || user.is_active) ? \"text-red-600\" : \"text-green-600\"}\n                              >\n                                {(user.isActive || user.is_active) ? <UserX className=\"w-3 h-3\" /> : <UserCheck className=\"w-3 h-3\" />}\n                              </Button>\n                            </div>\n                          </div>\n\n                          {/* Status Badges */}\n                          <div className=\"flex flex-wrap gap-2\">\n                            <Badge variant={(user.isActive || user.is_active) ? \"default\" : \"secondary\"}>\n                              {(user.isActive || user.is_active) ? \"–ê–∫—Ç–∏–≤–µ–Ω\" : \"–ù–µ–∞–∫—Ç–∏–≤–µ–Ω\"}\n                            </Badge>\n                            {(user.isPremium || user.is_premium) && <Badge variant=\"outline\" className=\"text-yellow-600\"><Crown className=\"w-3 h-3 mr-1\" />Premium</Badge>}\n                            {(user.isBlocked || user.is_blocked) && <Badge variant=\"destructive\">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</Badge>}\n                            {(user.isBot || user.is_bot) && <Badge variant=\"outline\">–ë–æ—Ç</Badge>}\n                          </div>\n\n                          {/* Stats */}\n                          <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                            <div>\n                              <div className=\"text-muted-foreground\">–°–æ–æ–±—â–µ–Ω–∏–π</div>\n                              <div className=\"font-medium\">{user.interactionCount || user.interaction_count || 0}</div>\n                            </div>\n                            <div>\n                              <div className=\"text-muted-foreground\">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>\n                              <div className=\"font-medium text-xs\">{formatDate(user.lastInteraction || user.last_interaction)}</div>\n                            </div>\n                          </div>\n\n                          {/* Recent Responses */}\n                          {((user.userData || user.user_data) && Object.keys(user.userData || user.user_data).length > 0) && (\n                            <div className=\"border-t pt-3\">\n                              <div className=\"text-sm font-medium mb-2\">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç–≤–µ—Ç—ã:</div>\n                              <div className=\"space-y-2\">\n                                {Object.entries(user.userData || user.user_data || {}).slice(0, 1).map(([key, value]) => {\n                                  let responseData = value;\n                                  if (typeof value === 'string') {\n                                    try {\n                                      responseData = JSON.parse(value);\n                                    } catch {\n                                      responseData = { value: value, type: 'text' };\n                                    }\n                                  }\n                                  \n                                  return (\n                                    <div key={key} className=\"text-xs bg-muted/50 rounded-lg p-2\">\n                                      <div className=\"text-muted-foreground mb-1\">{key}:</div>\n                                      <div className=\"font-medium\">\n                                        {(responseData as any)?.value ? \n                                          ((responseData as any).value.length > 50 ? `${(responseData as any).value.substring(0, 50)}...` : (responseData as any).value) :\n                                          (typeof value === 'string' ? (value.length > 50 ? `${value.substring(0, 50)}...` : value) : JSON.stringify(value))\n                                        }\n                                      </div>\n                                    </div>\n                                  );\n                                })}\n                                {Object.keys(user.userData || user.user_data || {}).length > 1 && (\n                                  <div className=\"text-xs text-muted-foreground\">\n                                    +{Object.keys(user.userData || user.user_data || {}).length - 1} –µ—â–µ...\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      </Card>\n                    ))\n                  )}\n                </div>\n              </div>\n            ) : (\n              // Desktop table layout\n              <ScrollArea className=\"h-full\">\n                <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</TableHead>\n                <TableHead>–°—Ç–∞—Ç—É—Å</TableHead>\n                <TableHead>–°–æ–æ–±—â–µ–Ω–∏—è</TableHead>\n                <TableHead>–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</TableHead>\n                <TableHead>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</TableHead>\n                <TableHead>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</TableHead>\n                <TableHead>–î–µ–π—Å—Ç–≤–∏—è</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredAndSortedUsers.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={7} className=\"text-center py-8\">\n                    <div className=\"text-muted-foreground\">\n                      {searchQuery ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—â–µ –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª–∏ —Å –±–æ—Ç–æ–º'}\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ) : (\n                filteredAndSortedUsers.map((user, index) => (\n                  <TableRow key={user.id || user.user_id || index}>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <div>\n                          <div className=\"font-medium\">{formatUserName(user)}</div>\n                          <div className=\"text-xs text-muted-foreground\">ID: {user.userId || user.user_id}</div>\n                        </div>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex flex-wrap gap-1\">\n                        <Badge variant={(user.isActive || user.is_active) ? \"default\" : \"secondary\"}>\n                          {(user.isActive || user.is_active) ? \"–ê–∫—Ç–∏–≤–µ–Ω\" : \"–ù–µ–∞–∫—Ç–∏–≤–µ–Ω\"}\n                        </Badge>\n                        {(user.isPremium || user.is_premium) && <Badge variant=\"outline\" className=\"text-yellow-600\"><Crown className=\"w-3 h-3 mr-1\" />Premium</Badge>}\n                        {(user.isBlocked || user.is_blocked) && <Badge variant=\"destructive\">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</Badge>}\n                        {(user.isBot || user.is_bot) && <Badge variant=\"outline\">–ë–æ—Ç</Badge>}\n                      </div>\n                    </TableCell>\n                    <TableCell>{user.interactionCount || user.interaction_count || 0}</TableCell>\n                    <TableCell>\n                      <div className=\"max-w-xs\">\n                        {((user.userData || user.user_data) && Object.keys(user.userData || user.user_data).length > 0) ? (\n                          <div className=\"space-y-1\">\n                            {Object.entries(user.userData || user.user_data).slice(0, 2).map(([key, value]) => {\n                              // Parse value if it's a string (from PostgreSQL)\n                              let responseData = value;\n                              if (typeof value === 'string') {\n                                try {\n                                  responseData = JSON.parse(value);\n                                } catch {\n                                  responseData = { value: value, type: 'text' };\n                                }\n                              }\n                              \n                              // Format the question text\n                              const formatQuestionText = (key, responseData) => {\n                                if (responseData?.prompt && responseData.prompt.trim()) {\n                                  return responseData.prompt;\n                                }\n                                \n                                // Generate a question based on the key\n                                if (key.includes('feedback')) return '–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–≤–æ–∏—Ö –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è—Ö. –ß—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –∏–ª–∏ —á—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å?';\n                                if (key.includes('name')) return '–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?';\n                                if (key.includes('age')) return '–°–∫–æ–ª—å–∫–æ –≤–∞–º –ª–µ—Ç?';\n                                if (key.includes('city')) return '–ò–∑ –∫–∞–∫–æ–≥–æ –≤—ã –≥–æ—Ä–æ–¥–∞?';\n                                if (key.includes('contact')) return '–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º';\n                                if (key.includes('email')) return '–£–∫–∞–∂–∏—Ç–µ –≤–∞—à email';\n                                if (key.includes('phone')) return '–£–∫–∞–∂–∏—Ç–µ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω';\n                                if (key.includes('rating')) return '–û—Ü–µ–Ω–∏—Ç–µ –Ω–∞—à—É —Ä–∞–±–æ—Ç—É';\n                                if (key.includes('review')) return '–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤';\n                                if (key.includes('suggestion')) return '–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º';\n                                if (key.startsWith('response_')) return `–í–æ–ø—Ä–æ—Å ${key.replace('response_', '')}`;\n                                if (key.startsWith('user_')) return `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥: ${key.replace('user_', '').replace('_', ' ')}`;\n                                return `–í–æ–ø—Ä–æ—Å: ${key}`;\n                              };\n                              \n                              return (\n                                <div key={key} className=\"text-xs bg-gradient-to-br from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 rounded-lg p-3 border border-blue-200 dark:border-blue-800 mb-2\">\n                                  <div className=\"mb-2\">\n                                    <div className=\"flex items-start gap-2 mb-1\">\n                                      <MessageSquare className=\"w-3 h-3 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0\" />\n                                      <div className=\"font-medium text-blue-700 dark:text-blue-300 text-xs\">\n                                        –í–æ–ø—Ä–æ—Å:\n                                      </div>\n                                    </div>\n                                    <div className=\"text-xs text-gray-700 dark:text-gray-300 ml-5 leading-relaxed\">\n                                      {formatQuestionText(key, responseData)}\n                                    </div>\n                                  </div>\n                                  <div>\n                                    <div className=\"flex items-start gap-2 mb-1\">\n                                      <Edit className=\"w-3 h-3 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0\" />\n                                      <div className=\"font-medium text-green-700 dark:text-green-300 text-xs\">\n                                        –û—Ç–≤–µ—Ç:\n                                      </div>\n                                    </div>\n                                    <div className=\"text-xs text-foreground font-medium ml-5 leading-relaxed\">\n                                      {responseData?.value ? \n                                        (responseData.value.length > 50 ? `${responseData.value.substring(0, 50)}...` : responseData.value) :\n                                        (typeof value === 'string' ? (value.length > 50 ? `${value.substring(0, 50)}...` : value) : JSON.stringify(value))\n                                      }\n                                    </div>\n                                  </div>\n                                </div>\n                              );\n                            })}\n                            {Object.keys(user.userData || user.user_data).length > 2 && (\n                              <div className=\"text-xs text-muted-foreground\">\n                                +{Object.keys(user.userData || user.user_data).length - 2} –µ—â–µ...\n                              </div>\n                            )}\n                          </div>\n                        ) : (\n                          <span className=\"text-xs text-muted-foreground\">–ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</span>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-sm\">{formatDate(user.lastInteraction || user.last_interaction)}</TableCell>\n                    <TableCell className=\"text-sm\">{formatDate(user.createdAt || user.registered_at)}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setSelectedUser(user);\n                            setShowUserDetails(true);\n                          }}\n                        >\n                          <Eye className=\"w-3 h-3\" />\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleUserStatusToggle(user, 'isActive')}\n                          className={(user.isActive || user.is_active) ? \"text-red-600\" : \"text-green-600\"}\n                        >\n                          {(user.isActive || user.is_active) ? <UserX className=\"w-3 h-3\" /> : <UserCheck className=\"w-3 h-3\" />}\n                        </Button>\n                        <AlertDialog>\n                          <AlertDialogTrigger asChild>\n                            <Button variant=\"outline\" size=\"sm\" className=\"text-red-600\">\n                              <Trash2 className=\"w-3 h-3\" />\n                            </Button>\n                          </AlertDialogTrigger>\n                          <AlertDialogContent>\n                            <AlertDialogHeader>\n                              <AlertDialogTitle>–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?</AlertDialogTitle>\n                              <AlertDialogDescription>\n                                –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è \"{formatUserName(user)}\" –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.\n                              </AlertDialogDescription>\n                            </AlertDialogHeader>\n                            <AlertDialogFooter>\n                              <AlertDialogCancel>–û—Ç–º–µ–Ω–∞</AlertDialogCancel>\n                              <AlertDialogAction onClick={() => deleteUserMutation.mutate(user.id || user.user_id)}>\n                                –£–¥–∞–ª–∏—Ç—å\n                              </AlertDialogAction>\n                            </AlertDialogFooter>\n                          </AlertDialogContent>\n                        </AlertDialog>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n              </Table>\n              </ScrollArea>\n            )}\n          </TabsContent>\n          \n          <TabsContent value=\"backup\" className=\"flex-1 overflow-hidden\">\n            <ScrollArea className=\"h-full\">\n              <div className=\"p-4\">\n                <DatabaseBackupPanel />\n              </div>\n            </ScrollArea>\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      {/* User Details Dialog */}\n      <Dialog open={showUserDetails} onOpenChange={setShowUserDetails}>\n        <DialogContent className={`${isMobile ? 'max-w-[95vw] max-h-[90vh]' : 'max-w-3xl max-h-[80vh]'} overflow-auto`}>\n          <DialogHeader>\n            <DialogTitle>–î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</DialogTitle>\n            <DialogDescription>\n              –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedUser && (\n            <div className=\"space-y-6\">\n              <div className={`grid ${isMobile ? 'grid-cols-1' : 'grid-cols-2'} gap-4`}>\n                <div>\n                  <Label className=\"text-sm font-medium\">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</Label>\n                  <div className=\"mt-2 space-y-2\">\n                    <div><span className=\"text-sm text-muted-foreground\">–ò–º—è:</span> {selectedUser.firstName || selectedUser.first_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>\n                    <div><span className=\"text-sm text-muted-foreground\">–§–∞–º–∏–ª–∏—è:</span> {selectedUser.lastName || selectedUser.last_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>\n                    <div><span className=\"text-sm text-muted-foreground\">Username:</span> {(selectedUser.userName || selectedUser.username) ? `@${selectedUser.userName || selectedUser.username}` : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>\n                    <div><span className=\"text-sm text-muted-foreground\">Telegram ID:</span> {selectedUser.userId || selectedUser.user_id}</div>\n                    <div><span className=\"text-sm text-muted-foreground\">–Ø–∑—ã–∫:</span> {selectedUser.languageCode || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>\n                  </div>\n                </div>\n                \n                <div>\n                  <Label className=\"text-sm font-medium\">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</Label>\n                  <div className=\"mt-2 space-y-2\">\n                    <div><span className=\"text-sm text-muted-foreground\">–°–æ–æ–±—â–µ–Ω–∏–π:</span> {selectedUser.interactionCount || selectedUser.interaction_count || 0}</div>\n                    <div><span className=\"text-sm text-muted-foreground\">–°–µ—Å—Å–∏–π:</span> {selectedUser.sessionsCount || 0}</div>\n                    <div><span className=\"text-sm text-muted-foreground\">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</span> {selectedUser.totalMessagesSent || 0}</div>\n                    <div><span className=\"text-sm text-muted-foreground\">–ü–æ–ª—É—á–µ–Ω–æ:</span> {selectedUser.totalMessagesReceived || 0}</div>\n                    <div><span className=\"text-sm text-muted-foreground\">–°–æ—Å—Ç–æ—è–Ω–∏–µ:</span> {selectedUser.currentState || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'}</div>\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <Label className=\"text-sm font-medium\">–°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</Label>\n                <div className=\"mt-2\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Switch\n                      checked={Boolean(selectedUser.isActive || selectedUser.is_active)}\n                      onCheckedChange={(checked) => handleUserStatusToggle(selectedUser, 'isActive')}\n                    />\n                    <Label>–ê–∫—Ç–∏–≤–µ–Ω</Label>\n                    <span className=\"text-xs text-muted-foreground ml-2\">\n                      (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –±–æ—Ç–æ–º)\n                    </span>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-2\">\n                    –í—ã –º–æ–∂–µ—Ç–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –µ–≥–æ –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É.\n                  </p>\n                </div>\n              </div>\n\n              <div>\n                <Label className=\"text-sm font-medium\">–î–∞—Ç—ã</Label>\n                <div className=\"mt-2 space-y-2\">\n                  <div><span className=\"text-sm text-muted-foreground\">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:</span> {formatDate(selectedUser.createdAt || selectedUser.registered_at)}</div>\n                  <div><span className=\"text-sm text-muted-foreground\">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</span> {formatDate(selectedUser.updatedAt)}</div>\n                  <div><span className=\"text-sm text-muted-foreground\">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</span> {formatDate(selectedUser.lastInteraction || selectedUser.last_interaction)}</div>\n                </div>\n              </div>\n\n              {selectedUser.tags && selectedUser.tags.length > 0 && (\n                <div>\n                  <Label className=\"text-sm font-medium\">–¢–µ–≥–∏</Label>\n                  <div className=\"mt-2 flex flex-wrap gap-1\">\n                    {selectedUser.tags.map((tag, index) => (\n                      <Badge key={index} variant=\"secondary\">{tag}</Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Enhanced user responses section */}\n              {((selectedUser.userData || selectedUser.user_data) && Object.keys(selectedUser.userData || selectedUser.user_data).length > 0) && (\n                <div>\n                  <div className=\"flex items-center gap-2 mb-4\">\n                    <MessageSquare className=\"w-5 h-5 text-primary\" />\n                    <Label className=\"text-base font-semibold\">–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</Label>\n                    <Badge variant=\"secondary\" className=\"text-xs\">\n                      {Object.keys(selectedUser.userData || selectedUser.user_data).length}\n                    </Badge>\n                  </div>\n                  <div className=\"space-y-4\">\n                    {Object.entries(selectedUser.userData || selectedUser.user_data).map(([key, value]) => {\n                      // Parse value if it's a string (from PostgreSQL)\n                      let responseData = value;\n                      if (typeof value === 'string') {\n                        try {\n                          responseData = JSON.parse(value);\n                        } catch {\n                          responseData = { value: value, type: 'text' };\n                        }\n                      }\n                      \n                      return (\n                        <div key={key} className=\"border rounded-lg p-4 bg-gradient-to-br from-muted/30 to-muted/60 hover:from-muted/50 hover:to-muted/80 transition-all duration-200 shadow-sm hover:shadow-md\">\n                          <div className=\"flex items-center justify-between mb-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <div className=\"flex items-center gap-2\">\n                                <div className=\"w-3 h-3 rounded-full bg-gradient-to-r from-blue-500 to-green-500\"></div>\n                                <span className=\"text-sm font-medium text-foreground\">\n                                  {key.startsWith('response_') ? key.replace('response_', '–û—Ç–≤–µ—Ç ') : key}\n                                </span>\n                              </div>\n                              {responseData?.type && (\n                                <Badge variant=\"outline\" className=\"text-xs border-primary/20 text-primary\">\n                                  {responseData.type === 'text' ? 'üìù –¢–µ–∫—Å—Ç' : \n                                   responseData.type === 'number' ? 'üî¢ –ß–∏—Å–ª–æ' :\n                                   responseData.type === 'email' ? 'üìß Email' :\n                                   responseData.type === 'phone' ? 'üìû –¢–µ–ª–µ—Ñ–æ–Ω' :\n                                   responseData.type}\n                                </Badge>\n                              )}\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Calendar className=\"w-3 h-3 text-muted-foreground\" />\n                              <span className=\"text-xs text-muted-foreground font-medium\">\n                                {responseData?.timestamp \n                                  ? formatDate(responseData.timestamp) \n                                  : '–ù–µ–¥–∞–≤–Ω–æ'}\n                              </span>\n                            </div>\n                          </div>\n                          \n                          <div className=\"text-sm\">\n                            {responseData?.value ? (\n                              <div className=\"bg-background rounded-lg p-4 border border-border shadow-sm\">\n                                {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å –µ—Å–ª–∏ –µ—Å—Ç—å */}\n                                {responseData.prompt ? (\n                                  <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                                    <div className=\"flex items-center gap-2 mb-2\">\n                                      <MessageSquare className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n                                      <span className=\"font-medium text-blue-900 dark:text-blue-100\">–í–æ–ø—Ä–æ—Å:</span>\n                                    </div>\n                                    <div className=\"text-blue-800 dark:text-blue-200 leading-relaxed\">\n                                      {responseData.prompt}\n                                    </div>\n                                  </div>\n                                ) : (\n                                  <div className=\"mb-4 p-3 bg-gray-50 dark:bg-gray-900/20 rounded-lg border border-gray-200 dark:border-gray-800\">\n                                    <div className=\"flex items-center gap-2 mb-2\">\n                                      <MessageSquare className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\n                                      <span className=\"font-medium text-gray-900 dark:text-gray-100\">–í–æ–ø—Ä–æ—Å:</span>\n                                    </div>\n                                    <div className=\"text-gray-600 dark:text-gray-400 leading-relaxed italic\">\n                                      {key.startsWith('response_') \n                                        ? `–û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å ${key.replace('response_', '')}`\n                                        : '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–ø—Ä–æ—Å–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}\n                                    </div>\n                                  </div>\n                                )}\n                                \n                                {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç */}\n                                <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\n                                  <div className=\"flex items-center gap-2 mb-2\">\n                                    <Edit className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\n                                    <span className=\"font-medium text-green-900 dark:text-green-100\">–û—Ç–≤–µ—Ç:</span>\n                                  </div>\n                                  <div className=\"text-green-800 dark:text-green-200 leading-relaxed font-medium\">\n                                    {responseData.value}\n                                  </div>\n                                </div>\n                                \n                                {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */}\n                                {responseData.nodeId && (\n                                  <div className=\"mt-3 pt-3 border-t border-border\">\n                                    <div className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                                      <span className=\"inline-block w-2 h-2 bg-muted-foreground rounded-full\"></span>\n                                      ID —É–∑–ª–∞: {responseData.nodeId}\n                                    </div>\n                                  </div>\n                                )}\n                              </div>\n                            ) : typeof value === 'object' && value !== null ? (\n                              <div className=\"bg-background rounded-lg p-4 border border-border shadow-sm\">\n                                <div className=\"flex items-center gap-2 mb-3\">\n                                  <Settings className=\"w-4 h-4 text-orange-600 dark:text-orange-400\" />\n                                  <span className=\"font-medium text-orange-900 dark:text-orange-100\">–°–∏—Å—Ç–µ–º–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</span>\n                                </div>\n                                <div className=\"bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800 p-3\">\n                                  <pre className=\"text-xs text-orange-800 dark:text-orange-200 overflow-auto whitespace-pre-wrap\">\n                                    {JSON.stringify(value, null, 2)}\n                                  </pre>\n                                </div>\n                              </div>\n                            ) : (\n                              <div className=\"bg-background rounded-lg p-4 border border-border shadow-sm\">\n                                <div className=\"flex items-center gap-2 mb-3\">\n                                  <Eye className=\"w-4 h-4 text-purple-600 dark:text-purple-400\" />\n                                  <span className=\"font-medium text-purple-900 dark:text-purple-100\">–ó–Ω–∞—á–µ–Ω–∏–µ:</span>\n                                </div>\n                                <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 p-3\">\n                                  <div className=\"text-purple-800 dark:text-purple-200 leading-relaxed\">{String(value)}</div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                  \n                  <div className=\"mt-4\">\n                    <Label className=\"text-sm font-medium\">–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (JSON)</Label>\n                    <div className=\"mt-2\">\n                      <Textarea\n                        value={JSON.stringify(selectedUser.userData || selectedUser.user_data, null, 2)}\n                        readOnly\n                        rows={6}\n                        className=\"text-xs font-mono bg-muted\"\n                        placeholder=\"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":54622},"client/src/components/editor/visibility-controls.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Eye, EyeOff, Layout, Sidebar, Square, Settings } from 'lucide-react';\n\ninterface VisibilityControlsProps {\n  headerVisible: boolean;\n  sidebarVisible: boolean;\n  canvasVisible: boolean;\n  propertiesVisible: boolean;\n  onToggleHeader: () => void;\n  onToggleSidebar: () => void;\n  onToggleCanvas: () => void;\n  onToggleProperties: () => void;\n}\n\nexport function VisibilityControls({\n  headerVisible,\n  sidebarVisible,\n  canvasVisible,\n  propertiesVisible,\n  onToggleHeader,\n  onToggleSidebar,\n  onToggleCanvas,\n  onToggleProperties,\n}: VisibilityControlsProps) {\n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n  const shouldShowControls = !headerVisible || !sidebarVisible || !canvasVisible || !propertiesVisible;\n\n  if (!shouldShowControls) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed top-4 left-4 z-50\">\n      <Card className=\"bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border shadow-lg\">\n        <CardContent className=\"p-3\">\n          <div className=\"flex flex-col gap-2\">\n            <h3 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª–∏:\n            </h3>\n            \n            <div className=\"grid grid-cols-2 gap-2\">\n              <Button\n                variant={headerVisible ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={onToggleHeader}\n                className=\"flex items-center gap-2 text-xs\"\n              >\n                {headerVisible ? <Eye size={14} /> : <EyeOff size={14} />}\n                –®–∞–ø–∫–∞\n              </Button>\n\n              <Button\n                variant={sidebarVisible ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={onToggleSidebar}\n                className=\"flex items-center gap-2 text-xs\"\n              >\n                {sidebarVisible ? <Eye size={14} /> : <EyeOff size={14} />}\n                –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å\n              </Button>\n\n              <Button\n                variant={canvasVisible ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={onToggleCanvas}\n                className=\"flex items-center gap-2 text-xs\"\n              >\n                {canvasVisible ? <Eye size={14} /> : <EyeOff size={14} />}\n                –•–æ–ª—Å—Ç\n              </Button>\n\n              <Button\n                variant={propertiesVisible ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={onToggleProperties}\n                className=\"flex items-center gap-2 text-xs\"\n              >\n                {propertiesVisible ? <Eye size={14} /> : <EyeOff size={14} />}\n                –°–≤–æ–π—Å—Ç–≤–∞\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":2928},"client/src/components/layout/adaptive-header.tsx":{"content":"import React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { ThemeToggle } from '@/components/theme-toggle';\nimport { Sheet, SheetContent, SheetTrigger, SheetHeader, SheetTitle } from '@/components/ui/sheet';\nimport { FolderOpen, Bookmark, Download, User, Send, Layout, Navigation as NavigationIcon, Sidebar, Monitor, Sliders, Users, Menu, X } from 'lucide-react';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { LayoutConfig } from './layout-manager';\n\ninterface BotInfo {\n  first_name: string;\n  username?: string;\n  description?: string;\n  short_description?: string;\n}\n\ninterface AdaptiveHeaderProps {\n  config: LayoutConfig;\n  projectName: string;\n  botInfo?: BotInfo | null;\n  currentTab: 'editor' | 'preview' | 'export' | 'bot' | 'users' | 'groups';\n  onTabChange: (tab: 'editor' | 'preview' | 'export' | 'bot' | 'users' | 'groups') => void;\n  onExport: () => void;\n  onSaveAsTemplate?: () => void;\n  onLoadTemplate?: () => void;\n  onLayoutSettings?: () => void;\n  // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–∫–µ—Ç–æ–º\n  onToggleHeader?: () => void;\n  onToggleSidebar?: () => void;\n  onToggleProperties?: () => void;\n  onToggleCanvas?: () => void;\n  headerVisible?: boolean;\n  sidebarVisible?: boolean;\n  propertiesVisible?: boolean;\n  canvasVisible?: boolean;\n  // –ú–æ–±–∏–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\n  onOpenMobileSidebar?: () => void;\n  onOpenMobileProperties?: () => void;\n}\n\nexport function AdaptiveHeader({ \n  config,\n  projectName,\n  botInfo,\n  currentTab, \n  onTabChange, \n  onExport, \n  onSaveAsTemplate, \n  onLoadTemplate,\n  onLayoutSettings,\n  onToggleHeader,\n  onToggleSidebar,\n  onToggleProperties,\n  onToggleCanvas,\n  headerVisible,\n  sidebarVisible,\n  propertiesVisible,\n  canvasVisible,\n  onOpenMobileSidebar,\n  onOpenMobileProperties\n}: AdaptiveHeaderProps) {\n  \n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n  \n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ\n  const isMobile = useIsMobile();\n  \n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–∞\n  const isVertical = config.headerPosition === 'left' || config.headerPosition === 'right';\n  const isCompact = config.compactMode;\n  \n  // –ö–ª–∞—Å—Å—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –≤—ã—Å–æ—Ç–æ–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤\n  const containerClasses = [\n    'bg-background border-border relative z-50',\n    isVertical ? 'h-full w-full border-r flex flex-col' : `${isMobile ? 'h-10' : 'h-12'} flex items-center justify-between ${isMobile ? 'px-3' : 'px-6'} border-b`,\n    isCompact ? 'text-sm' : ''\n  ].join(' ');\n\n  // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ª–æ–≥–æ—Ç–∏–ø–∞ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è\n  const BrandSection = () => (\n    <div className={`flex items-center ${isVertical ? 'flex-col space-y-2 p-4' : (isMobile ? 'space-x-2' : 'space-x-3')}`}>\n      <div className={`bg-primary rounded-lg flex items-center justify-center ${isCompact || isMobile ? 'w-6 h-6' : 'w-8 h-8'}`}>\n        <i className={`fab fa-telegram-plane text-primary-foreground ${isCompact || isMobile ? 'text-sm' : 'text-lg'}`}></i>\n      </div>\n      <div className={isVertical ? 'text-center' : ''}>\n        <h1 className={`font-semibold text-foreground ${isCompact || isMobile ? 'text-sm' : 'text-lg'}`}>\n          {isVertical && !isCompact ? 'BotCraft' : 'BotCraft Studio'}\n        </h1>\n        <p className={`text-muted-foreground ${isCompact || isMobile ? 'text-xs' : 'text-xs'}`}>\n          {(() => {\n            const displayName = botInfo?.first_name || projectName;\n            return isVertical ? (displayName.length > 12 ? displayName.substring(0, 12) + '...' : displayName) : displayName;\n          })()}\n        </p>\n      </div>\n    </div>\n  );\n\n  // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n  const Navigation = () => (\n    <nav className={`${isVertical ? 'flex flex-col space-y-1 px-2' : 'hidden lg:flex flex-wrap items-center gap-1'}`}>\n      {[\n        { key: 'editor', label: '–†–µ–¥–∞–∫—Ç–æ—Ä' },\n        { key: 'preview', label: '–ü—Ä–µ–≤—å—é' },\n        { key: 'export', label: '–≠–∫—Å–ø–æ—Ä—Ç' },\n        { key: 'bot', label: '–ë–æ—Ç' },\n        { key: 'users', label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏' },\n        { key: 'groups', label: '–ì—Ä—É–ø–ø—ã' }\n      ].map((tab) => (\n        <button \n          key={tab.key}\n          onClick={() => onTabChange(tab.key as any)}\n          className={`${isCompact ? 'px-2 py-1 text-xs' : 'px-3 py-1.5 text-sm'} font-medium rounded-md transition-colors ${\n            currentTab === tab.key \n              ? 'text-primary bg-primary/10' \n              : 'text-muted-foreground hover:bg-muted'\n          } ${isVertical ? 'w-full text-left' : 'whitespace-nowrap'} max-sm:text-xs max-sm:px-2 max-sm:py-1`}\n        >\n          {isVertical && isCompact ? tab.label.substring(0, 3) : tab.label}\n        </button>\n      ))}\n    </nav>\n  );\n\n  // –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n  const MobileNavigation = () => (\n    <div className=\"flex flex-col space-y-4\">\n      <div className=\"grid grid-cols-2 gap-2\">\n        {[\n          { key: 'editor', label: '–†–µ–¥–∞–∫—Ç–æ—Ä' },\n          { key: 'preview', label: '–ü—Ä–µ–≤—å—é' },\n          { key: 'export', label: '–≠–∫—Å–ø–æ—Ä—Ç' },\n          { key: 'bot', label: '–ë–æ—Ç' },\n          { key: 'users', label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏' },\n          { key: 'groups', label: '–ì—Ä—É–ø–ø—ã' }\n        ].map((tab) => (\n          <button \n            key={tab.key}\n            onClick={() => {\n              onTabChange(tab.key as any);\n              setIsMobileMenuOpen(false);\n            }}\n            className={`px-3 py-2 text-sm font-medium rounded-md transition-colors ${\n              currentTab === tab.key \n                ? 'text-primary bg-primary/10' \n                : 'text-muted-foreground hover:bg-muted'\n            }`}\n          >\n            {tab.label}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n\n  // –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–µ–π—Å—Ç–≤–∏–π\n  const MobileActions = () => (\n    <div className=\"flex flex-col space-y-3\">\n      {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–∫–µ—Ç–æ–º */}\n      {(onToggleHeader || onToggleSidebar || onToggleProperties || onToggleCanvas) && (\n        <div className=\"grid grid-cols-2 gap-2\">\n          {onToggleHeader && (\n            <Button\n              variant={headerVisible ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => {\n                onToggleHeader();\n                setIsMobileMenuOpen(false);\n              }}\n              className=\"flex items-center justify-center\"\n              title={`${headerVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} —à–∞–ø–∫—É`}\n            >\n              <NavigationIcon className=\"w-3 h-3 mr-1\" />\n              –®–∞–ø–∫–∞\n            </Button>\n          )}\n          \n          {onToggleSidebar && (\n            <Button\n              variant={sidebarVisible ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => {\n                onToggleSidebar();\n                setIsMobileMenuOpen(false);\n              }}\n              className=\"flex items-center justify-center\"\n              title={`${sidebarVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å`}\n            >\n              <Sidebar className=\"w-3 h-3 mr-1\" />\n              –ü–∞–Ω–µ–ª—å\n            </Button>\n          )}\n          \n          {onToggleCanvas && (\n            <Button\n              variant={canvasVisible ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => {\n                onToggleCanvas();\n                setIsMobileMenuOpen(false);\n              }}\n              className=\"flex items-center justify-center\"\n              title={`${canvasVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} —Ö–æ–ª—Å—Ç`}\n            >\n              <Monitor className=\"w-3 h-3 mr-1\" />\n              –•–æ–ª—Å—Ç\n            </Button>\n          )}\n          \n          {onToggleProperties && (\n            <Button\n              variant={propertiesVisible ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => {\n                onToggleProperties();\n                setIsMobileMenuOpen(false);\n              }}\n              className=\"flex items-center justify-center\"\n              title={`${propertiesVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤`}\n            >\n              <Sliders className=\"w-3 h-3 mr-1\" />\n              –°–≤–æ–π—Å—Ç–≤–∞\n            </Button>\n          )}\n        </div>\n      )}\n      \n      <div className=\"grid grid-cols-1 gap-2\">\n        {onLoadTemplate && (\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            onClick={() => {\n              onLoadTemplate();\n              setIsMobileMenuOpen(false);\n            }}\n            className=\"flex items-center justify-center\"\n          >\n            <FolderOpen className=\"h-3 w-3 mr-2\" />\n            –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω\n          </Button>\n        )}\n        \n        {onSaveAsTemplate && (\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            onClick={() => {\n              onSaveAsTemplate();\n              setIsMobileMenuOpen(false);\n            }}\n            className=\"flex items-center justify-center\"\n          >\n            <Bookmark className=\"h-3 w-3 mr-2\" />\n            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —à–∞–±–ª–æ–Ω\n          </Button>\n        )}\n        \n        <Button \n          size=\"sm\"\n          onClick={() => {\n            onExport();\n            setIsMobileMenuOpen(false);\n          }}\n          className=\"flex items-center justify-center\"\n        >\n          <i className=\"fas fa-download mr-2\"></i>\n          –≠–∫—Å–ø–æ—Ä—Ç\n        </Button>\n        \n        <div className=\"flex justify-center pt-2\">\n          <ThemeToggle />\n        </div>\n      </div>\n    </div>\n  );\n\n  // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–µ–π—Å—Ç–≤–∏–π\n  const Actions = () => (\n    <div className={`flex ${isVertical ? 'flex-col space-y-2 p-2' : 'hidden lg:flex flex-wrap items-center gap-2'}`}>\n      \n      {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–∫–µ—Ç–æ–º */}\n      {(onToggleHeader || onToggleSidebar || onToggleProperties || onToggleCanvas) && (\n        <div className=\"flex items-center space-x-1 bg-background/80 backdrop-blur-sm border border-border rounded-md p-1\">\n          {onToggleHeader && (\n            <Button\n              variant={headerVisible ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={onToggleHeader}\n              className=\"h-7 w-7 p-0\"\n              title={`${headerVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} —à–∞–ø–∫—É`}\n            >\n              <NavigationIcon className=\"w-3 h-3\" />\n            </Button>\n          )}\n          \n          {onToggleSidebar && (\n            <Button\n              variant={sidebarVisible ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={onToggleSidebar}\n              className=\"h-7 w-7 p-0\"\n              title={`${sidebarVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å`}\n            >\n              <Sidebar className=\"w-3 h-3\" />\n            </Button>\n          )}\n          \n          {onToggleCanvas && (\n            <Button\n              variant={canvasVisible ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={onToggleCanvas}\n              className=\"h-7 w-7 p-0\"\n              title={`${canvasVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} —Ö–æ–ª—Å—Ç`}\n            >\n              <Monitor className=\"w-3 h-3\" />\n            </Button>\n          )}\n          \n          {onToggleProperties && (\n            <Button\n              variant={propertiesVisible ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={onToggleProperties}\n              className=\"h-7 w-7 p-0\"\n              title={`${propertiesVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤`}\n            >\n              <Sliders className=\"w-3 h-3\" />\n            </Button>\n          )}\n        </div>\n      )}\n      \n      {onLoadTemplate && (\n        <Button \n          variant=\"outline\" \n          size=\"sm\"\n          onClick={onLoadTemplate}\n          className={`${isVertical ? 'w-full justify-center' : 'flex items-center justify-center'} px-1 py-0.5 text-xs max-sm:px-1 max-sm:py-0.5 max-sm:min-w-0 max-sm:w-full`}\n        >\n          <FolderOpen className=\"h-2.5 w-2.5 max-sm:mx-auto\" />\n          <span className=\"max-sm:hidden ml-1\">–®–∞–±–ª–æ–Ω</span>\n        </Button>\n      )}\n      \n      {onSaveAsTemplate && (\n        <Button \n          variant=\"outline\" \n          size=\"sm\"\n          onClick={onSaveAsTemplate}\n          className={`${isVertical ? 'w-full justify-center' : 'flex items-center justify-center'} px-1 py-0.5 text-xs max-sm:px-1 max-sm:py-0.5 max-sm:min-w-0 max-sm:w-full`}\n        >\n          <Bookmark className=\"h-2.5 w-2.5 max-sm:mx-auto\" />\n          <span className=\"max-sm:hidden ml-1\">–°–æ–∑–¥–∞—Ç—å</span>\n        </Button>\n      )}\n      \n\n      \n      <Button \n        size=\"sm\"\n        onClick={onExport}\n        className={`${isVertical ? 'w-full justify-center' : 'flex items-center justify-center'} px-1 py-0.5 text-xs max-sm:px-1 max-sm:py-0.5 max-sm:min-w-0 max-sm:w-full max-sm:col-span-2`}\n      >\n        <i className=\"fas fa-download text-2xs max-sm:mx-auto\"></i>\n        <span className=\"max-sm:hidden ml-1\">–≠–∫—Å–ø–æ—Ä—Ç</span>\n      </Button>\n      \n      {isVertical && (\n        <div className=\"h-px w-full bg-border my-2\"></div>\n      )}\n      \n      <div className=\"max-sm:col-span-1 max-sm:flex max-sm:justify-center\">\n        <ThemeToggle />\n      </div>\n    </div>\n  );\n\n  // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å\n  const Separator = () => (\n    <div className={`${isVertical ? 'h-px w-full' : 'h-6 w-px'} bg-border`}></div>\n  );\n\n  if (isVertical) {\n    return (\n      <header className={containerClasses}>\n        <BrandSection />\n        <Separator />\n        <div className=\"flex-1 overflow-y-auto\">\n          <Navigation />\n        </div>\n        <Separator />\n        <Actions />\n      </header>\n    );\n  }\n\n  return (\n    <header className={containerClasses}>\n      <div className=\"flex items-center space-x-4\">\n        <BrandSection />\n        <Separator />\n        {/* –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Å–≤–æ–π—Å—Ç–≤ –ø–æ—Å–ª–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è */}\n        {isMobile && !isVertical && (\n          <div className=\"flex items-center space-x-1\">\n            {onOpenMobileSidebar && (\n              <button\n                onClick={onOpenMobileSidebar}\n                className=\"group p-1.5 bg-blue-500/10 dark:bg-blue-400/15 rounded-md border border-blue-300/30 dark:border-blue-500/20 hover:bg-blue-500/20 dark:hover:bg-blue-400/25 hover:border-blue-400/50 dark:hover:border-blue-400/30 transition-all duration-200 hover:shadow-sm hover:shadow-blue-500/20\"\n                title=\"–û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\"\n                data-testid=\"button-mobile-components\"\n              >\n                <Menu className=\"w-3.5 h-3.5 text-blue-600 dark:text-blue-400 group-hover:text-blue-700 dark:group-hover:text-blue-300 transition-colors duration-200\" />\n              </button>\n            )}\n            {onOpenMobileProperties && (\n              <button\n                onClick={onOpenMobileProperties}\n                className=\"group p-1.5 bg-purple-500/10 dark:bg-purple-400/15 rounded-md border border-purple-300/30 dark:border-purple-500/20 hover:bg-purple-500/20 dark:hover:bg-purple-400/25 hover:border-purple-400/50 dark:hover:border-purple-400/30 transition-all duration-200 hover:shadow-sm hover:shadow-purple-500/20\"\n                title=\"–û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤\"\n                data-testid=\"button-mobile-properties\"\n              >\n                <Sliders className=\"w-3.5 h-3.5 text-purple-600 dark:text-purple-400 group-hover:text-purple-700 dark:group-hover:text-purple-300 transition-colors duration-200\" />\n              </button>\n            )}\n          </div>\n        )}\n        <Navigation />\n      </div>\n      \n      {/* –î–µ—Å–∫—Ç–æ–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n      <Actions />\n      \n      {/* –ú–æ–±–∏–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é */}\n      <div className=\"lg:hidden\">\n        <Sheet open={isMobileMenuOpen} onOpenChange={setIsMobileMenuOpen}>\n          <SheetTrigger asChild>\n            <Button variant=\"outline\" size=\"sm\" className=\"p-2\">\n              <Menu className=\"h-4 w-4\" />\n            </Button>\n          </SheetTrigger>\n          <SheetContent side=\"right\" className=\"w-80\">\n            <SheetHeader>\n              <SheetTitle className=\"text-left\">–ú–µ–Ω—é</SheetTitle>\n            </SheetHeader>\n            <div className=\"mt-6 space-y-6\">\n              <div>\n                <h3 className=\"text-sm font-medium text-muted-foreground mb-3\">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>\n                <MobileNavigation />\n              </div>\n              <div>\n                <h3 className=\"text-sm font-medium text-muted-foreground mb-3\">–î–µ–π—Å—Ç–≤–∏—è</h3>\n                <MobileActions />\n              </div>\n            </div>\n          </SheetContent>\n        </Sheet>\n      </div>\n    </header>\n  );\n}","size_bytes":17260},"client/src/components/layout/adaptive-layout.tsx":{"content":"import { ReactNode, useMemo } from 'react';\nimport { ResizablePanelGroup, ResizablePanel, ResizableHandle } from '@/components/ui/resizable';\nimport { LayoutConfig } from './layout-manager';\n\ninterface AdaptiveLayoutProps {\n  config: LayoutConfig;\n  header: ReactNode;\n  sidebar: ReactNode;\n  canvas: ReactNode;\n  properties: ReactNode;\n  children?: ReactNode;\n}\n\nexport function AdaptiveLayout({\n  config,\n  header,\n  sidebar,\n  canvas,\n  properties,\n  children\n}: AdaptiveLayoutProps) {\n  \n  // –í—ã—á–∏—Å–ª—è–µ–º CSS –∫–ª–∞—Å—Å—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\n  const containerClasses = useMemo(() => {\n    const classes = ['h-screen overflow-hidden bg-gray-50 dark:bg-gray-900'];\n    \n    if (config.compactMode) {\n      classes.push('text-sm');\n    }\n    \n    return classes.join(' ');\n  }, [config.compactMode]);\n\n  // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞\n  const headerSize = useMemo(() => {\n    if (config.headerPosition === 'top' || config.headerPosition === 'bottom') {\n      return config.compactMode ? 48 : 64; // 3rem –∏–ª–∏ 4rem\n    }\n    return config.compactMode ? 240 : 320; // 15rem –∏–ª–∏ 20rem\n  }, [config.headerPosition, config.compactMode]);\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞–∫–µ—Ç–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É\n  const createVerticalLayout = () => {\n    const headerElement = (\n      <div \n        className={`${config.headerPosition === 'top' ? 'order-1' : 'order-3'} flex-shrink-0`}\n        style={{ height: `${headerSize}px` }}\n      >\n        {header}\n      </div>\n    );\n\n    const contentElement = (\n      <div className={`${config.headerPosition === 'top' ? 'order-2' : 'order-1'} flex-1 min-h-0`}>\n        {createHorizontalPanels()}\n      </div>\n    );\n\n    return (\n      <div className={`${containerClasses} flex flex-col`}>\n        {config.headerPosition === 'top' ? headerElement : contentElement}\n        {config.headerPosition === 'top' ? contentElement : headerElement}\n        {children}\n      </div>\n    );\n  };\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞–∫–µ—Ç–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞\n  const createHorizontalLayout = () => {\n    const headerElement = (\n      <div \n        className={`${config.headerPosition === 'left' ? 'order-1' : 'order-3'} flex-shrink-0`}\n        style={{ width: `${headerSize}px` }}\n      >\n        <div className=\"h-full flex flex-col\">\n          {header}\n        </div>\n      </div>\n    );\n\n    const contentElement = (\n      <div className={`${config.headerPosition === 'left' ? 'order-2' : 'order-1'} flex-1 min-w-0`}>\n        {createVerticalPanels()}\n      </div>\n    );\n\n    return (\n      <div className={`${containerClasses} flex`}>\n        {config.headerPosition === 'left' ? headerElement : contentElement}\n        {config.headerPosition === 'left' ? contentElement : headerElement}\n        {children}\n      </div>\n    );\n  };\n\n  // –°–æ–∑–¥–∞–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ (—Å–∞–π–¥–±–∞—Ä | —Ö–æ–ª—Å—Ç | —Å–≤–æ–π—Å—Ç–≤–∞)\n  const createHorizontalPanels = () => {\n    const panels = [];\n    \n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –ø–∞–Ω–µ–ª–µ–π\n    if (config.sidebarPosition === 'left') {\n      panels.push(\n        <ResizablePanel \n          key=\"sidebar\"\n          defaultSize={config.panelSizes.sidebar} \n          minSize={10} \n          maxSize={40}\n          className=\"flex-shrink-0\"\n        >\n          {sidebar}\n        </ResizablePanel>\n      );\n      panels.push(<ResizableHandle key=\"handle1\" withHandle />);\n    }\n\n    if (config.propertiesPosition === 'left' && config.sidebarPosition === 'right') {\n      panels.push(\n        <ResizablePanel \n          key=\"properties-left\"\n          defaultSize={config.panelSizes.properties} \n          minSize={15} \n          maxSize={40}\n          className=\"flex-shrink-0\"\n        >\n          {properties}\n        </ResizablePanel>\n      );\n      panels.push(<ResizableHandle key=\"handle-prop-left\" withHandle />);\n    }\n\n    // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å —Ö–æ–ª—Å—Ç–∞\n    panels.push(\n      <ResizablePanel \n        key=\"canvas\"\n        defaultSize={config.panelSizes.canvas} \n        minSize={30}\n        className=\"flex-1\"\n      >\n        {config.canvasFullscreen ? (\n          <div className=\"h-full relative\">\n            {canvas}\n            <div className=\"absolute inset-0 pointer-events-none\">\n              {config.showGrid && (\n                <div className=\"absolute inset-0 opacity-10 bg-grid-small bg-grid-slate-200 dark:bg-grid-slate-800\" />\n              )}\n            </div>\n          </div>\n        ) : (\n          canvas\n        )}\n      </ResizablePanel>\n    );\n\n    if (config.propertiesPosition === 'right' || (config.propertiesPosition === 'left' && config.sidebarPosition === 'left')) {\n      panels.push(<ResizableHandle key=\"handle2\" withHandle />);\n      panels.push(\n        <ResizablePanel \n          key=\"properties-right\"\n          defaultSize={config.panelSizes.properties} \n          minSize={15} \n          maxSize={40}\n          className=\"flex-shrink-0\"\n        >\n          {properties}\n        </ResizablePanel>\n      );\n    }\n\n    if (config.sidebarPosition === 'right') {\n      panels.push(<ResizableHandle key=\"handle3\" withHandle />);\n      panels.push(\n        <ResizablePanel \n          key=\"sidebar-right\"\n          defaultSize={config.panelSizes.sidebar} \n          minSize={10} \n          maxSize={40}\n          className=\"flex-shrink-0\"\n        >\n          {sidebar}\n        </ResizablePanel>\n      );\n    }\n\n    return (\n      <ResizablePanelGroup direction=\"horizontal\" className=\"h-full\">\n        {panels}\n      </ResizablePanelGroup>\n    );\n  };\n\n  // –°–æ–∑–¥–∞–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ (–¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞)\n  const createVerticalPanels = () => {\n    return (\n      <ResizablePanelGroup direction=\"vertical\" className=\"h-full\">\n        <ResizablePanel defaultSize={20} minSize={15} maxSize={35}>\n          {sidebar}\n        </ResizablePanel>\n        \n        <ResizableHandle withHandle />\n        \n        <ResizablePanel defaultSize={60} minSize={30}>\n          <ResizablePanelGroup direction=\"horizontal\">\n            <ResizablePanel defaultSize={75} minSize={50}>\n              {canvas}\n            </ResizablePanel>\n            <ResizableHandle withHandle />\n            <ResizablePanel defaultSize={25} minSize={20} maxSize={40}>\n              {properties}\n            </ResizablePanel>\n          </ResizablePanelGroup>\n        </ResizablePanel>\n      </ResizablePanelGroup>\n    );\n  };\n\n  // –ì–ª–∞–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–∞–∫–µ—Ç–∞\n  if (config.headerPosition === 'top' || config.headerPosition === 'bottom') {\n    return createVerticalLayout();\n  } else {\n    return createHorizontalLayout();\n  }\n}","size_bytes":6815},"client/src/components/layout/custom-layout-editor.tsx":{"content":"import React, { useState, useCallback, useMemo, useRef } from 'react';\nimport { DndProvider, useDrag, useDrop } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Slider } from '@/components/ui/slider';\nimport { \n  Layout, \n  Move, \n  RotateCcw, \n  Settings, \n  Grid,\n  ArrowUp,\n  ArrowDown,\n  ArrowLeft,\n  ArrowRight,\n  Navigation,\n  Sidebar,\n  Monitor,\n  Sliders,\n  Eye,\n  EyeOff,\n  GripVertical,\n  Maximize2,\n  Minimize2,\n  Save,\n  Undo2\n} from 'lucide-react';\n\nexport interface LayoutElement {\n  id: string;\n  type: 'header' | 'sidebar' | 'canvas' | 'properties';\n  name: string;\n  position: 'top' | 'bottom' | 'left' | 'right' | 'center';\n  size: number; // –†–∞–∑–º–µ—Ä –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö\n  visible: boolean;\n  order: number; // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n  content: React.ReactNode;\n}\n\nexport interface CustomLayoutConfig {\n  elements: LayoutElement[];\n  gridSize: number;\n  snapToGrid: boolean;\n  showGrid: boolean;\n  compactMode: boolean;\n  lastModified: Date;\n}\n\ninterface CustomLayoutEditorProps {\n  children: React.ReactNode;\n  headerContent: React.ReactNode;\n  sidebarContent: React.ReactNode;\n  canvasContent: React.ReactNode;\n  propertiesContent: React.ReactNode;\n  onLayoutChange?: (config: CustomLayoutConfig) => void;\n}\n\nconst DEFAULT_LAYOUT: CustomLayoutConfig = {\n  elements: [\n    {\n      id: 'header',\n      type: 'header',\n      name: '–®–∞–ø–∫–∞',\n      position: 'top',\n      size: 8,\n      visible: true,\n      order: 1,\n      content: null\n    },\n    {\n      id: 'sidebar',\n      type: 'sidebar',\n      name: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n      position: 'left',\n      size: 20,\n      visible: true,\n      order: 2,\n      content: null\n    },\n    {\n      id: 'canvas',\n      type: 'canvas',\n      name: '–•–æ–ª—Å—Ç',\n      position: 'center',\n      size: 55,\n      visible: true,\n      order: 3,\n      content: null\n    },\n    {\n      id: 'properties',\n      type: 'properties',\n      name: '–°–≤–æ–π—Å—Ç–≤–∞',\n      position: 'right',\n      size: 25,\n      visible: true,\n      order: 4,\n      content: null\n    }\n  ],\n  gridSize: 10,\n  snapToGrid: true,\n  showGrid: false,\n  compactMode: false,\n  lastModified: new Date()\n};\n\nconst DRAG_TYPE = 'layout-element';\nconst DROP_ZONES = ['top', 'bottom', 'left', 'right', 'center'] as const;\n\n// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞\nconst DraggableElement: React.FC<{\n  element: LayoutElement;\n  isPreview?: boolean;\n  onMove?: (elementId: string, position: typeof DROP_ZONES[number]) => void;\n}> = ({ element, isPreview = false, onMove }) => {\n  const [{ isDragging }, drag] = useDrag({\n    type: DRAG_TYPE,\n    item: { id: element.id, type: element.type },\n    collect: (monitor) => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const getIcon = () => {\n    switch (element.type) {\n      case 'header':\n        return <Navigation className=\"w-4 h-4\" />;\n      case 'sidebar':\n        return <Sidebar className=\"w-4 h-4\" />;\n      case 'canvas':\n        return <Monitor className=\"w-4 h-4\" />;\n      case 'properties':\n        return <Sliders className=\"w-4 h-4\" />;\n      default:\n        return <Layout className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getPositionIcon = () => {\n    switch (element.position) {\n      case 'top':\n        return <ArrowUp className=\"w-3 h-3\" />;\n      case 'bottom':\n        return <ArrowDown className=\"w-3 h-3\" />;\n      case 'left':\n        return <ArrowLeft className=\"w-3 h-3\" />;\n      case 'right':\n        return <ArrowRight className=\"w-3 h-3\" />;\n      case 'center':\n        return <Grid className=\"w-3 h-3\" />;\n      default:\n        return null;\n    }\n  };\n\n  if (isPreview) {\n    return (\n      <div className=\"h-full w-full flex items-center justify-center bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-600\">\n        <div className=\"text-center\">\n          {getIcon()}\n          <p className=\"text-xs font-medium mt-1\">{element.name}</p>\n          <div className=\"flex items-center justify-center mt-1\">\n            {getPositionIcon()}\n            <span className=\"text-xs ml-1\">{element.size}%</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      ref={drag}\n      className={`\n        p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg cursor-move\n        shadow-sm hover:shadow-md transition-all duration-200\n        ${isDragging ? 'opacity-50 rotate-3 scale-105' : ''}\n        ${!element.visible ? 'opacity-50' : ''}\n      `}\n    >\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-2\">\n          <GripVertical className=\"w-4 h-4 text-gray-400\" />\n          {getIcon()}\n          <span className=\"text-sm font-medium\">{element.name}</span>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          {getPositionIcon()}\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            {element.size}%\n          </Badge>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–æ–Ω—ã —Å–±—Ä–æ—Å–∞\nconst DropZone: React.FC<{\n  position: typeof DROP_ZONES[number];\n  onDrop: (elementId: string, position: typeof DROP_ZONES[number]) => void;\n  className?: string;\n}> = ({ position, onDrop, className = '' }) => {\n  const [{ isOver, canDrop }, drop] = useDrop({\n    accept: DRAG_TYPE,\n    drop: (item: { id: string; type: string }) => {\n      onDrop(item.id, position);\n    },\n    collect: (monitor) => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop(),\n    }),\n  });\n\n  const getPositionLabel = () => {\n    switch (position) {\n      case 'top':\n        return '–°–≤–µ—Ä—Ö—É';\n      case 'bottom':\n        return '–°–Ω–∏–∑—É';\n      case 'left':\n        return '–°–ª–µ–≤–∞';\n      case 'right':\n        return '–°–ø—Ä–∞–≤–∞';\n      case 'center':\n        return '–¶–µ–Ω—Ç—Ä';\n      default:\n        return position;\n    }\n  };\n\n  const getPositionIcon = () => {\n    switch (position) {\n      case 'top':\n        return <ArrowUp className=\"w-4 h-4\" />;\n      case 'bottom':\n        return <ArrowDown className=\"w-4 h-4\" />;\n      case 'left':\n        return <ArrowLeft className=\"w-4 h-4\" />;\n      case 'right':\n        return <ArrowRight className=\"w-4 h-4\" />;\n      case 'center':\n        return <Grid className=\"w-4 h-4\" />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div\n      ref={drop}\n      className={`\n        min-h-[60px] border-2 border-dashed rounded-lg transition-all duration-200\n        flex items-center justify-center\n        ${isOver && canDrop \n          ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' \n          : 'border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500'\n        }\n        ${className}\n      `}\n    >\n      <div className=\"text-center\">\n        {getPositionIcon()}\n        <p className=\"text-xs font-medium mt-1\">{getPositionLabel()}</p>\n      </div>\n    </div>\n  );\n};\n\nexport const CustomLayoutEditor: React.FC<CustomLayoutEditorProps> = ({\n  children,\n  headerContent,\n  sidebarContent,\n  canvasContent,\n  propertiesContent,\n  onLayoutChange\n}) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [currentLayout, setCurrentLayout] = useState<CustomLayoutConfig>(() => ({\n    ...DEFAULT_LAYOUT,\n    elements: DEFAULT_LAYOUT.elements.map(element => ({\n      ...element,\n      content: element.type === 'header' ? headerContent :\n               element.type === 'sidebar' ? sidebarContent :\n               element.type === 'canvas' ? canvasContent :\n               element.type === 'properties' ? propertiesContent : null\n    }))\n  }));\n\n  const [originalLayout, setOriginalLayout] = useState<CustomLayoutConfig>(currentLayout);\n\n  const handleElementMove = useCallback((elementId: string, newPosition: typeof DROP_ZONES[number]) => {\n    setCurrentLayout(prev => ({\n      ...prev,\n      elements: prev.elements.map(element => \n        element.id === elementId \n          ? { ...element, position: newPosition }\n          : element\n      ),\n      lastModified: new Date()\n    }));\n  }, []);\n\n  const handleElementResize = useCallback((elementId: string, newSize: number) => {\n    setCurrentLayout(prev => ({\n      ...prev,\n      elements: prev.elements.map(element => \n        element.id === elementId \n          ? { ...element, size: newSize }\n          : element\n      ),\n      lastModified: new Date()\n    }));\n  }, []);\n\n  const handleElementVisibility = useCallback((elementId: string, visible: boolean) => {\n    setCurrentLayout(prev => ({\n      ...prev,\n      elements: prev.elements.map(element => \n        element.id === elementId \n          ? { ...element, visible }\n          : element\n      ),\n      lastModified: new Date()\n    }));\n  }, []);\n\n  const handleApplyLayout = useCallback(() => {\n    if (onLayoutChange) {\n      onLayoutChange(currentLayout);\n    }\n    setOriginalLayout(currentLayout);\n    setIsEditing(false);\n  }, [currentLayout, onLayoutChange]);\n\n  const handleCancelEdit = useCallback(() => {\n    setCurrentLayout(originalLayout);\n    setIsEditing(false);\n  }, [originalLayout]);\n\n  const handleResetLayout = useCallback(() => {\n    const resetLayout = {\n      ...DEFAULT_LAYOUT,\n      elements: DEFAULT_LAYOUT.elements.map(element => ({\n        ...element,\n        content: element.type === 'header' ? headerContent :\n                 element.type === 'sidebar' ? sidebarContent :\n                 element.type === 'canvas' ? canvasContent :\n                 element.type === 'properties' ? propertiesContent : null\n      }))\n    };\n    setCurrentLayout(resetLayout);\n  }, [headerContent, sidebarContent, canvasContent, propertiesContent]);\n\n  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–∞–∫–µ—Ç–∞\n  const generateLayoutStyles = useMemo(() => {\n    const visibleElements = currentLayout.elements.filter(el => el.visible);\n    const headerEl = visibleElements.find(el => el.type === 'header');\n    const sidebarEl = visibleElements.find(el => el.type === 'sidebar');\n    const canvasEl = visibleElements.find(el => el.type === 'canvas');\n    const propertiesEl = visibleElements.find(el => el.type === 'properties');\n\n    // –°–æ–∑–¥–∞–µ–º CSS Grid areas –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∑–∏—Ü–∏–π\n    const gridAreas = {\n      top: visibleElements.filter(el => el.position === 'top').map(el => el.id),\n      left: visibleElements.filter(el => el.position === 'left').map(el => el.id),\n      center: visibleElements.filter(el => el.position === 'center').map(el => el.id),\n      right: visibleElements.filter(el => el.position === 'right').map(el => el.id),\n      bottom: visibleElements.filter(el => el.position === 'bottom').map(el => el.id),\n    };\n\n    return {\n      container: {\n        display: 'grid',\n        height: '100vh',\n        gridTemplateAreas: `\n          \"${gridAreas.top.join(' ')}\"\n          \"${gridAreas.left.join(' ')} ${gridAreas.center.join(' ')} ${gridAreas.right.join(' ')}\"\n          \"${gridAreas.bottom.join(' ')}\"\n        `,\n        gridTemplateRows: `${headerEl?.position === 'top' ? headerEl.size + '%' : 'auto'} 1fr ${headerEl?.position === 'bottom' ? headerEl.size + '%' : 'auto'}`,\n        gridTemplateColumns: `${sidebarEl?.position === 'left' ? sidebarEl.size + '%' : 'auto'} 1fr ${propertiesEl?.position === 'right' ? propertiesEl.size + '%' : 'auto'}`,\n      },\n      elements: visibleElements.reduce((acc, el) => {\n        acc[el.id] = {\n          gridArea: el.id,\n          minHeight: el.type === 'header' ? '60px' : '200px',\n          overflow: 'hidden'\n        };\n        return acc;\n      }, {} as Record<string, React.CSSProperties>)\n    };\n  }, [currentLayout]);\n\n  const renderCurrentLayout = () => {\n    if (isEditing) return children;\n\n    const visibleElements = currentLayout.elements.filter(el => el.visible);\n    \n    return (\n      <div style={generateLayoutStyles.container}>\n        {visibleElements.map(element => (\n          <div\n            key={element.id}\n            style={generateLayoutStyles.elements[element.id]}\n            className=\"bg-background border border-border\"\n          >\n            {element.content}\n          </div>\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <DndProvider backend={HTML5Backend}>\n      <div className=\"h-screen flex flex-col\">\n        {/* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–∫–µ—Ç–æ–º */}\n        <div className=\"flex-shrink-0 bg-background border-b border-border p-2\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-2\">\n              <Button\n                variant={isEditing ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setIsEditing(!isEditing)}\n              >\n                <Layout className=\"w-4 h-4 mr-2\" />\n                {isEditing ? '–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è' : '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–∫–µ—Ç'}\n              </Button>\n              \n              {isEditing && (\n                <>\n                  <Button\n                    variant=\"default\"\n                    size=\"sm\"\n                    onClick={handleApplyLayout}\n                  >\n                    <Save className=\"w-4 h-4 mr-2\" />\n                    –ü—Ä–∏–º–µ–Ω–∏—Ç—å\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleCancelEdit}\n                  >\n                    <Undo2 className=\"w-4 h-4 mr-2\" />\n                    –û—Ç–º–µ–Ω–∏—Ç—å\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleResetLayout}\n                  >\n                    <RotateCcw className=\"w-4 h-4 mr-2\" />\n                    –°–±—Ä–æ—Å–∏—Ç—å\n                  </Button>\n                </>\n              )}\n            </div>\n            \n            <div className=\"flex items-center space-x-2\">\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: {currentLayout.lastModified.toLocaleTimeString()}\n              </Badge>\n            </div>\n          </div>\n        </div>\n\n        {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}\n        <div className=\"flex-1 overflow-hidden\">\n          {isEditing ? (\n            <div className=\"h-full flex\">\n              {/* –ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */}\n              <div className=\"w-80 bg-background border-r border-border flex flex-col\">\n                <div className=\"p-4 border-b border-border\">\n                  <h3 className=\"font-semibold mb-2\">–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞–∫–µ—Ç–∞</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –Ω—É–∂–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏\n                  </p>\n                </div>\n                \n                <div className=\"flex-1 overflow-auto p-4\">\n                  {/* –°–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */}\n                  <div className=\"space-y-3 mb-6\">\n                    <h4 className=\"text-sm font-medium\">–≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h4>\n                    {currentLayout.elements.map(element => (\n                      <div key={element.id} className=\"space-y-2\">\n                        <DraggableElement\n                          element={element}\n                          onMove={handleElementMove}\n                        />\n                        \n                        {/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ */}\n                        <div className=\"pl-4 space-y-2\">\n                          <div className=\"flex items-center space-x-2\">\n                            <Switch\n                              id={`visible-${element.id}`}\n                              checked={element.visible}\n                              onCheckedChange={(checked) => handleElementVisibility(element.id, checked)}\n                            />\n                            <Label htmlFor={`visible-${element.id}`} className=\"text-xs\">\n                              –í–∏–¥–∏–º—ã–π\n                            </Label>\n                          </div>\n                          \n                          <div className=\"space-y-1\">\n                            <Label className=\"text-xs\">–†–∞–∑–º–µ—Ä: {element.size}%</Label>\n                            <Slider\n                              value={[element.size]}\n                              onValueChange={(value) => handleElementResize(element.id, value[0])}\n                              max={50}\n                              min={10}\n                              step={5}\n                              className=\"w-full\"\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                  \n                  {/* –ó–æ–Ω—ã —Å–±—Ä–æ—Å–∞ */}\n                  <div className=\"space-y-3\">\n                    <h4 className=\"text-sm font-medium\">–ó–æ–Ω—ã —Ä–∞–∑–º–µ—â–µ–Ω–∏—è</h4>\n                    <div className=\"grid grid-cols-1 gap-2\">\n                      {DROP_ZONES.map(zone => (\n                        <DropZone\n                          key={zone}\n                          position={zone}\n                          onDrop={handleElementMove}\n                        />\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              {/* –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä */}\n              <div className=\"flex-1 bg-gray-50 dark:bg-gray-900 p-4\">\n                <div className=\"h-full border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg relative\">\n                  <div className=\"absolute top-2 left-2 bg-white dark:bg-gray-800 px-2 py-1 rounded text-xs font-medium\">\n                    –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä\n                  </div>\n                  <div className=\"h-full p-6 pt-10\">\n                    <div style={generateLayoutStyles.container}>\n                      {currentLayout.elements.filter(el => el.visible).map(element => (\n                        <div\n                          key={element.id}\n                          style={generateLayoutStyles.elements[element.id]}\n                          className=\"border border-gray-200 dark:border-gray-700 rounded\"\n                        >\n                          <DraggableElement element={element} isPreview />\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          ) : (\n            renderCurrentLayout()\n          )}\n        </div>\n      </div>\n    </DndProvider>\n  );\n};\n\nexport default CustomLayoutEditor;","size_bytes":19264},"client/src/components/layout/drag-drop-test-button.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { Move } from 'lucide-react';\n\ninterface DragDropTestButtonProps {\n  onOpenCustomizer: () => void;\n}\n\nexport const DragDropTestButton: React.FC<DragDropTestButtonProps> = ({ onOpenCustomizer }) => {\n  return (\n    <div className=\"p-4 border-t border-gray-200 dark:border-gray-700\">\n      <Button \n        variant=\"outline\" \n        size=\"sm\" \n        onClick={onOpenCustomizer}\n        className=\"w-full flex items-center gap-2\"\n      >\n        <Move className=\"w-4 h-4\" />\n        –ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã\n      </Button>\n    </div>\n  );\n};","size_bytes":610},"client/src/components/layout/drag-layout-manager.tsx":{"content":"import React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { DndProvider, useDrag, useDrop } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Separator } from '@/components/ui/separator';\nimport { \n  Layout, \n  GripVertical, \n  Move, \n  RotateCcw, \n  Eye, \n  EyeOff,\n  Settings,\n  ArrowUp,\n  ArrowDown,\n  ArrowLeft,\n  ArrowRight,\n  Maximize2,\n  Minimize2\n} from 'lucide-react';\n\nexport interface DragLayoutElement {\n  id: string;\n  type: 'header' | 'sidebar' | 'canvas' | 'properties';\n  title: string;\n  position: 'top' | 'bottom' | 'left' | 'right' | 'center';\n  size: number; // –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏\n  visible: boolean;\n  locked: boolean;\n  content: React.ReactNode;\n}\n\nexport interface DragLayoutConfig {\n  elements: DragLayoutElement[];\n  gridSnap: boolean;\n  showGrid: boolean;\n  compactMode: boolean;\n}\n\nconst DRAG_TYPE = 'layout-element';\nconst DROP_ZONES = ['top', 'bottom', 'left', 'right', 'center'] as const;\n\ninterface DragLayoutManagerProps {\n  headerContent: React.ReactNode;\n  sidebarContent: React.ReactNode;\n  canvasContent: React.ReactNode;\n  propertiesContent: React.ReactNode;\n  onLayoutChange?: (config: DragLayoutConfig) => void;\n  className?: string;\n}\n\ninterface DraggableElementProps {\n  element: DragLayoutElement;\n  isPreview?: boolean;\n  onMove?: (elementId: string, newPosition: string) => void;\n  onToggleVisibility?: (elementId: string) => void;\n  onToggleLock?: (elementId: string) => void;\n}\n\nconst DraggableElement: React.FC<DraggableElementProps> = ({ \n  element, \n  isPreview = false, \n  onMove, \n  onToggleVisibility, \n  onToggleLock \n}) => {\n  const [{ isDragging }, drag] = useDrag({\n    type: DRAG_TYPE,\n    item: { id: element.id, type: element.type },\n    collect: (monitor) => ({\n      isDragging: monitor.isDragging(),\n    }),\n    canDrag: !element.locked && !isPreview,\n  });\n\n  const getPositionIcon = () => {\n    switch (element.position) {\n      case 'top': return <ArrowUp className=\"w-4 h-4\" />;\n      case 'bottom': return <ArrowDown className=\"w-4 h-4\" />;\n      case 'left': return <ArrowLeft className=\"w-4 h-4\" />;\n      case 'right': return <ArrowRight className=\"w-4 h-4\" />;\n      case 'center': return <Maximize2 className=\"w-4 h-4\" />;\n      default: return <Move className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getElementColor = () => {\n    switch (element.type) {\n      case 'header': return 'bg-blue-100 dark:bg-blue-900/20 border-blue-300 dark:border-blue-700';\n      case 'sidebar': return 'bg-green-100 dark:bg-green-900/20 border-green-300 dark:border-green-700';\n      case 'canvas': return 'bg-purple-100 dark:bg-purple-900/20 border-purple-300 dark:border-purple-700';\n      case 'properties': return 'bg-orange-100 dark:bg-orange-900/20 border-orange-300 dark:border-orange-700';\n      default: return 'bg-gray-100 dark:bg-gray-900/20 border-gray-300 dark:border-gray-700';\n    }\n  };\n\n  if (isPreview) {\n    return (\n      <div className={`\n        relative border-2 rounded-lg p-4 transition-all duration-200\n        ${getElementColor()}\n        ${!element.visible ? 'opacity-50' : ''}\n        ${element.locked ? 'ring-2 ring-red-300' : ''}\n      `}>\n        {element.content}\n      </div>\n    );\n  }\n\n  return (\n    <div\n      ref={drag}\n      className={`\n        relative border-2 rounded-lg p-3 cursor-move transition-all duration-200\n        ${getElementColor()}\n        ${isDragging ? 'opacity-50 scale-95' : ''}\n        ${!element.visible ? 'opacity-50' : ''}\n        ${element.locked ? 'cursor-not-allowed ring-2 ring-red-300' : 'hover:shadow-md'}\n      `}\n    >\n      <div className=\"flex items-center justify-between mb-2\">\n        <div className=\"flex items-center gap-2\">\n          <GripVertical className=\"w-4 h-4 text-gray-400\" />\n          <span className=\"font-medium text-sm\">{element.title}</span>\n          {getPositionIcon()}\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => onToggleVisibility?.(element.id)}\n            className=\"h-6 w-6 p-0\"\n          >\n            {element.visible ? <Eye className=\"w-3 h-3\" /> : <EyeOff className=\"w-3 h-3\" />}\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => onToggleLock?.(element.id)}\n            className=\"h-6 w-6 p-0\"\n          >\n            {element.locked ? <Settings className=\"w-3 h-3\" /> : <Move className=\"w-3 h-3\" />}\n          </Button>\n        </div>\n      </div>\n      \n      <Badge variant=\"secondary\" className=\"text-xs\">\n        {element.position} ‚Ä¢ {element.size}%\n      </Badge>\n    </div>\n  );\n};\n\ninterface DropZoneProps {\n  position: string;\n  onDrop: (elementId: string, position: string) => void;\n  isActive: boolean;\n  children?: React.ReactNode;\n}\n\nconst DropZone: React.FC<DropZoneProps> = ({ position, onDrop, isActive, children }) => {\n  const [{ isOver, canDrop }, drop] = useDrop({\n    accept: DRAG_TYPE,\n    drop: (item: { id: string; type: string }) => {\n      onDrop(item.id, position);\n    },\n    collect: (monitor) => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop(),\n    }),\n  });\n\n  const getDropZoneClasses = () => {\n    let classes = 'relative border-2 border-dashed transition-all duration-200 rounded-lg ';\n    \n    if (isActive) {\n      classes += 'border-blue-400 bg-blue-50 dark:bg-blue-900/10 ';\n    } else {\n      classes += 'border-gray-300 dark:border-gray-600 ';\n    }\n    \n    if (isOver && canDrop) {\n      classes += 'border-green-400 bg-green-50 dark:bg-green-900/10 scale-105 ';\n    } else if (canDrop) {\n      classes += 'border-blue-400 bg-blue-50 dark:bg-blue-900/10 ';\n    }\n    \n    return classes;\n  };\n\n  return (\n    <div ref={drop} className={getDropZoneClasses()}>\n      {children}\n      {isOver && canDrop && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-green-100 dark:bg-green-900/20 rounded-lg\">\n          <div className=\"text-green-700 dark:text-green-300 font-medium\">\n            –û—Ç–ø—É—Å—Ç–∏—Ç–µ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst DragLayoutManager: React.FC<DragLayoutManagerProps> = ({\n  headerContent,\n  sidebarContent,\n  canvasContent,\n  propertiesContent,\n  onLayoutChange,\n  className = \"\"\n}) => {\n  const [config, setConfig] = useState<DragLayoutConfig>({\n    elements: [\n      {\n        id: 'header',\n        type: 'header',\n        title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫',\n        position: 'top',\n        size: 10,\n        visible: true,\n        locked: false,\n        content: headerContent\n      },\n      {\n        id: 'sidebar',\n        type: 'sidebar',\n        title: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n        position: 'left',\n        size: 20,\n        visible: true,\n        locked: false,\n        content: sidebarContent\n      },\n      {\n        id: 'canvas',\n        type: 'canvas',\n        title: '–•–æ–ª—Å—Ç',\n        position: 'center',\n        size: 50,\n        visible: true,\n        locked: false,\n        content: canvasContent\n      },\n      {\n        id: 'properties',\n        type: 'properties',\n        title: '–°–≤–æ–π—Å—Ç–≤–∞',\n        position: 'right',\n        size: 20,\n        visible: true,\n        locked: false,\n        content: propertiesContent\n      }\n    ],\n    gridSnap: true,\n    showGrid: true,\n    compactMode: false\n  });\n\n  const [isCustomizing, setIsCustomizing] = useState(false);\n  const [previewMode, setPreviewMode] = useState(false);\n\n  const handleElementMove = useCallback((elementId: string, newPosition: string) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(el => \n        el.id === elementId \n          ? { ...el, position: newPosition as any }\n          : el\n      )\n    }));\n  }, []);\n\n  const handleToggleVisibility = useCallback((elementId: string) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(el => \n        el.id === elementId \n          ? { ...el, visible: !el.visible }\n          : el\n      )\n    }));\n  }, []);\n\n  const handleToggleLock = useCallback((elementId: string) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(el => \n        el.id === elementId \n          ? { ...el, locked: !el.locked }\n          : el\n      )\n    }));\n  }, []);\n\n  const handleConfigChange = useCallback((key: keyof DragLayoutConfig, value: any) => {\n    setConfig(prev => ({\n      ...prev,\n      [key]: value\n    }));\n  }, []);\n\n  const handleReset = useCallback(() => {\n    setConfig({\n      elements: [\n        {\n          id: 'header',\n          type: 'header',\n          title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫',\n          position: 'top',\n          size: 10,\n          visible: true,\n          locked: false,\n          content: headerContent\n        },\n        {\n          id: 'sidebar',\n          type: 'sidebar',\n          title: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n          position: 'left',\n          size: 20,\n          visible: true,\n          locked: false,\n          content: sidebarContent\n        },\n        {\n          id: 'canvas',\n          type: 'canvas',\n          title: '–•–æ–ª—Å—Ç',\n          position: 'center',\n          size: 50,\n          visible: true,\n          locked: false,\n          content: canvasContent\n        },\n        {\n          id: 'properties',\n          type: 'properties',\n          title: '–°–≤–æ–π—Å—Ç–≤–∞',\n          position: 'right',\n          size: 20,\n          visible: true,\n          locked: false,\n          content: propertiesContent\n        }\n      ],\n      gridSnap: true,\n      showGrid: true,\n      compactMode: false\n    });\n  }, [headerContent, sidebarContent, canvasContent, propertiesContent]);\n\n  const handleApply = useCallback(() => {\n    onLayoutChange?.(config);\n    setIsCustomizing(false);\n  }, [config, onLayoutChange]);\n\n  const renderCurrentLayout = () => {\n    const visibleElements = config.elements.filter(el => el.visible);\n    const topElements = visibleElements.filter(el => el.position === 'top');\n    const bottomElements = visibleElements.filter(el => el.position === 'bottom');\n    const leftElements = visibleElements.filter(el => el.position === 'left');\n    const rightElements = visibleElements.filter(el => el.position === 'right');\n    const centerElements = visibleElements.filter(el => el.position === 'center');\n\n    return (\n      <div className=\"h-full flex flex-col\">\n        {/* –í–µ—Ä—Ö–Ω—è—è –æ–±–ª–∞—Å—Ç—å */}\n        {topElements.length > 0 && (\n          <div className=\"flex-shrink-0 border-b border-gray-200 dark:border-gray-700\">\n            <div className=\"flex\">\n              {topElements.map(element => (\n                <DraggableElement\n                  key={element.id}\n                  element={element}\n                  isPreview={previewMode}\n                  onMove={handleElementMove}\n                  onToggleVisibility={handleToggleVisibility}\n                  onToggleLock={handleToggleLock}\n                />\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */}\n        <div className=\"flex-1 flex\">\n          {/* –õ–µ–≤–∞—è –æ–±–ª–∞—Å—Ç—å */}\n          {leftElements.length > 0 && (\n            <div className=\"flex-shrink-0 border-r border-gray-200 dark:border-gray-700\">\n              <div className=\"flex flex-col h-full\">\n                {leftElements.map(element => (\n                  <DraggableElement\n                    key={element.id}\n                    element={element}\n                    isPreview={previewMode}\n                    onMove={handleElementMove}\n                    onToggleVisibility={handleToggleVisibility}\n                    onToggleLock={handleToggleLock}\n                  />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */}\n          <div className=\"flex-1\">\n            {centerElements.map(element => (\n              <DraggableElement\n                key={element.id}\n                element={element}\n                isPreview={previewMode}\n                onMove={handleElementMove}\n                onToggleVisibility={handleToggleVisibility}\n                onToggleLock={handleToggleLock}\n              />\n            ))}\n          </div>\n\n          {/* –ü—Ä–∞–≤–∞—è –æ–±–ª–∞—Å—Ç—å */}\n          {rightElements.length > 0 && (\n            <div className=\"flex-shrink-0 border-l border-gray-200 dark:border-gray-700\">\n              <div className=\"flex flex-col h-full\">\n                {rightElements.map(element => (\n                  <DraggableElement\n                    key={element.id}\n                    element={element}\n                    isPreview={previewMode}\n                    onMove={handleElementMove}\n                    onToggleVisibility={handleToggleVisibility}\n                    onToggleLock={handleToggleLock}\n                  />\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* –ù–∏–∂–Ω—è—è –æ–±–ª–∞—Å—Ç—å */}\n        {bottomElements.length > 0 && (\n          <div className=\"flex-shrink-0 border-t border-gray-200 dark:border-gray-700\">\n            <div className=\"flex\">\n              {bottomElements.map(element => (\n                <DraggableElement\n                  key={element.id}\n                  element={element}\n                  isPreview={previewMode}\n                  onMove={handleElementMove}\n                  onToggleVisibility={handleToggleVisibility}\n                  onToggleLock={handleToggleLock}\n                />\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  const renderCustomizer = () => {\n    return (\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 h-full\">\n        {/* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Layout className=\"w-5 h-5\" />\n                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–∫–µ—Ç–∞\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"grid-snap\">–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ç–∫–µ</Label>\n                <Switch\n                  id=\"grid-snap\"\n                  checked={config.gridSnap}\n                  onCheckedChange={(checked) => handleConfigChange('gridSnap', checked)}\n                />\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"show-grid\">–ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ç–∫—É</Label>\n                <Switch\n                  id=\"show-grid\"\n                  checked={config.showGrid}\n                  onCheckedChange={(checked) => handleConfigChange('showGrid', checked)}\n                />\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"compact-mode\">–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º</Label>\n                <Switch\n                  id=\"compact-mode\"\n                  checked={config.compactMode}\n                  onCheckedChange={(checked) => handleConfigChange('compactMode', checked)}\n                />\n              </div>\n              \n              <Separator />\n              \n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"preview-mode\">–†–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</Label>\n                <Switch\n                  id=\"preview-mode\"\n                  checked={previewMode}\n                  onCheckedChange={setPreviewMode}\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>–≠–ª–µ–º–µ–Ω—Ç—ã –º–∞–∫–µ—Ç–∞</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {config.elements.map(element => (\n                  <DraggableElement\n                    key={element.id}\n                    element={element}\n                    onMove={handleElementMove}\n                    onToggleVisibility={handleToggleVisibility}\n                    onToggleLock={handleToggleLock}\n                  />\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* –û–±–ª–∞—Å—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –∑–æ–Ω—ã —Ä–∞–∑–º–µ—â–µ–Ω–∏—è */}\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –º–∞–∫–µ—Ç–∞</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-96 relative\">\n                {previewMode ? (\n                  renderCurrentLayout()\n                ) : (\n                  <div className=\"grid grid-cols-3 grid-rows-3 gap-2 h-full\">\n                    {/* –ó–æ–Ω—ã —Ä–∞–∑–º–µ—â–µ–Ω–∏—è */}\n                    <div className=\"col-span-3\">\n                      <DropZone\n                        position=\"top\"\n                        onDrop={handleElementMove}\n                        isActive={config.elements.some(el => el.position === 'top')}\n                      >\n                        <div className=\"p-4 text-center text-sm text-gray-500\">\n                          –í–µ—Ä—Ö–Ω—è—è –æ–±–ª–∞—Å—Ç—å\n                        </div>\n                      </DropZone>\n                    </div>\n                    \n                    <DropZone\n                      position=\"left\"\n                      onDrop={handleElementMove}\n                      isActive={config.elements.some(el => el.position === 'left')}\n                    >\n                      <div className=\"p-4 text-center text-sm text-gray-500\">\n                        –õ–µ–≤–∞—è\n                      </div>\n                    </DropZone>\n                    \n                    <DropZone\n                      position=\"center\"\n                      onDrop={handleElementMove}\n                      isActive={config.elements.some(el => el.position === 'center')}\n                    >\n                      <div className=\"p-4 text-center text-sm text-gray-500\">\n                        –¶–µ–Ω—Ç—Ä\n                      </div>\n                    </DropZone>\n                    \n                    <DropZone\n                      position=\"right\"\n                      onDrop={handleElementMove}\n                      isActive={config.elements.some(el => el.position === 'right')}\n                    >\n                      <div className=\"p-4 text-center text-sm text-gray-500\">\n                        –ü—Ä–∞–≤–∞—è\n                      </div>\n                    </DropZone>\n                    \n                    <div className=\"col-span-3\">\n                      <DropZone\n                        position=\"bottom\"\n                        onDrop={handleElementMove}\n                        isActive={config.elements.some(el => el.position === 'bottom')}\n                      >\n                        <div className=\"p-4 text-center text-sm text-gray-500\">\n                          –ù–∏–∂–Ω—è—è –æ–±–ª–∞—Å—Ç—å\n                        </div>\n                      </DropZone>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <DndProvider backend={HTML5Backend}>\n      <div className={className}>\n        {/* –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ */}\n        <Dialog open={isCustomizing} onOpenChange={setIsCustomizing}>\n          <DialogTrigger asChild>\n            <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n              <Layout className=\"w-4 h-4\" />\n              –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–∫–µ—Ç\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-7xl h-[80vh] overflow-auto\">\n            <DialogHeader>\n              <DialogTitle>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞–∫–µ—Ç–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</DialogTitle>\n            </DialogHeader>\n            \n            {renderCustomizer()}\n            \n            <div className=\"flex justify-end gap-2 mt-6\">\n              <Button variant=\"outline\" onClick={handleReset}>\n                <RotateCcw className=\"w-4 h-4 mr-2\" />\n                –°–±—Ä–æ—Å–∏—Ç—å\n              </Button>\n              <Button onClick={handleApply}>\n                –ü—Ä–∏–º–µ–Ω–∏—Ç—å\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* –¢–µ–∫—É—â–∏–π –º–∞–∫–µ—Ç */}\n        {!isCustomizing && renderCurrentLayout()}\n      </div>\n    </DndProvider>\n  );\n};\n\nexport default DragLayoutManager;","size_bytes":21215},"client/src/components/layout/draggable-layout.tsx":{"content":"import React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { useDrag, useDrop, DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { \n  GripVertical, \n  Move, \n  RotateCcw, \n  Layout, \n  Eye, \n  EyeOff,\n  Lock,\n  Unlock,\n  Settings\n} from 'lucide-react';\n\nexport interface DraggableLayoutConfig {\n  elements: LayoutElement[];\n  gridSize: number;\n  snapToGrid: boolean;\n  showGrid: boolean;\n  lockElements: boolean;\n  previewMode: boolean;\n}\n\nexport interface LayoutElement {\n  id: string;\n  type: 'header' | 'sidebar' | 'canvas' | 'properties';\n  position: { x: number; y: number };\n  size: { width: number; height: number };\n  visible: boolean;\n  locked: boolean;\n  zIndex: number;\n  minSize: { width: number; height: number };\n  maxSize: { width: number; height: number };\n  resizable: boolean;\n  draggable: boolean;\n  content?: React.ReactNode;\n}\n\nconst DEFAULT_ELEMENTS: LayoutElement[] = [\n  {\n    id: 'header',\n    type: 'header',\n    position: { x: 0, y: 0 },\n    size: { width: 100, height: 60 },\n    visible: true,\n    locked: false,\n    zIndex: 1000,\n    minSize: { width: 200, height: 40 },\n    maxSize: { width: 2000, height: 100 },\n    resizable: true,\n    draggable: true,\n  },\n  {\n    id: 'sidebar',\n    type: 'sidebar',\n    position: { x: 0, y: 60 },\n    size: { width: 280, height: 80 },\n    visible: true,\n    locked: false,\n    zIndex: 100,\n    minSize: { width: 200, height: 200 },\n    maxSize: { width: 600, height: 2000 },\n    resizable: true,\n    draggable: true,\n  },\n  {\n    id: 'canvas',\n    type: 'canvas',\n    position: { x: 280, y: 60 },\n    size: { width: 60, height: 80 },\n    visible: true,\n    locked: false,\n    zIndex: 1,\n    minSize: { width: 300, height: 200 },\n    maxSize: { width: 2000, height: 2000 },\n    resizable: true,\n    draggable: true,\n  },\n  {\n    id: 'properties',\n    type: 'properties',\n    position: { x: 75, y: 60 },\n    size: { width: 25, height: 80 },\n    visible: true,\n    locked: false,\n    zIndex: 100,\n    minSize: { width: 200, height: 200 },\n    maxSize: { width: 500, height: 2000 },\n    resizable: true,\n    draggable: true,\n  },\n];\n\ninterface DraggableElementProps {\n  element: LayoutElement;\n  onMove: (id: string, position: { x: number; y: number }) => void;\n  onResize: (id: string, size: { width: number; height: number }) => void;\n  onToggleVisibility: (id: string) => void;\n  onToggleLock: (id: string) => void;\n  gridSize: number;\n  snapToGrid: boolean;\n  showGrid: boolean;\n  previewMode: boolean;\n  containerRef: React.RefObject<HTMLDivElement>;\n}\n\nconst DraggableElement: React.FC<DraggableElementProps> = ({\n  element,\n  onMove,\n  onResize,\n  onToggleVisibility,\n  onToggleLock,\n  gridSize,\n  snapToGrid,\n  previewMode,\n  containerRef\n}) => {\n  const [isResizing, setIsResizing] = useState(false);\n  const [resizeStart, setResizeStart] = useState({ x: 0, y: 0, width: 0, height: 0 });\n  const elementRef = useRef<HTMLDivElement>(null);\n\n  const [{ isDragging }, drag] = useDrag({\n    type: 'layout-element',\n    item: { id: element.id, type: element.type },\n    canDrag: element.draggable && !element.locked && !previewMode,\n    collect: (monitor) => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const [, drop] = useDrop({\n    accept: 'layout-element',\n    hover: (item: { id: string; type: string }, monitor) => {\n      if (!elementRef.current || !containerRef.current) return;\n      \n      const draggedElement = item;\n      if (draggedElement.id === element.id) return;\n\n      const clientOffset = monitor.getClientOffset();\n      if (!clientOffset) return;\n\n      const containerRect = containerRef.current.getBoundingClientRect();\n      const relativeX = clientOffset.x - containerRect.left;\n      const relativeY = clientOffset.y - containerRect.top;\n\n      let newX = (relativeX / containerRect.width) * 100;\n      let newY = (relativeY / containerRect.height) * 100;\n\n      if (snapToGrid) {\n        newX = Math.round(newX / gridSize) * gridSize;\n        newY = Math.round(newY / gridSize) * gridSize;\n      }\n\n      onMove(draggedElement.id, { x: newX, y: newY });\n    },\n  });\n\n  drag(drop(elementRef));\n\n  const handleResizeStart = useCallback((e: React.MouseEvent) => {\n    if (element.locked || previewMode || !element.resizable) return;\n    \n    e.preventDefault();\n    setIsResizing(true);\n    setResizeStart({\n      x: e.clientX,\n      y: e.clientY,\n      width: element.size.width,\n      height: element.size.height,\n    });\n  }, [element.locked, element.resizable, element.size, previewMode]);\n\n  const handleResizeMove = useCallback((e: MouseEvent) => {\n    if (!isResizing || !containerRef.current) return;\n\n    const containerRect = containerRef.current.getBoundingClientRect();\n    const deltaX = e.clientX - resizeStart.x;\n    const deltaY = e.clientY - resizeStart.y;\n\n    let newWidth = resizeStart.width + (deltaX / containerRect.width) * 100;\n    let newHeight = resizeStart.height + (deltaY / containerRect.height) * 100;\n\n    // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞\n    newWidth = Math.max(element.minSize.width, Math.min(element.maxSize.width, newWidth));\n    newHeight = Math.max(element.minSize.height, Math.min(element.maxSize.height, newHeight));\n\n    if (snapToGrid) {\n      newWidth = Math.round(newWidth / gridSize) * gridSize;\n      newHeight = Math.round(newHeight / gridSize) * gridSize;\n    }\n\n    onResize(element.id, { width: newWidth, height: newHeight });\n  }, [isResizing, resizeStart, element.minSize, element.maxSize, element.id, onResize, snapToGrid, gridSize, containerRef]);\n\n  const handleResizeEnd = useCallback(() => {\n    setIsResizing(false);\n  }, []);\n\n  useEffect(() => {\n    if (isResizing) {\n      document.addEventListener('mousemove', handleResizeMove);\n      document.addEventListener('mouseup', handleResizeEnd);\n      return () => {\n        document.removeEventListener('mousemove', handleResizeMove);\n        document.removeEventListener('mouseup', handleResizeEnd);\n      };\n    }\n  }, [isResizing, handleResizeMove, handleResizeEnd]);\n\n  if (!element.visible) return null;\n\n  const elementStyle: React.CSSProperties = {\n    position: 'absolute',\n    left: `${element.position.x}%`,\n    top: `${element.position.y}%`,\n    width: `${element.size.width}%`,\n    height: `${element.size.height}%`,\n    zIndex: element.zIndex,\n    opacity: isDragging ? 0.5 : 1,\n    cursor: element.locked ? 'not-allowed' : element.draggable ? 'move' : 'default',\n  };\n\n  return (\n    <div\n      ref={elementRef}\n      style={elementStyle}\n      className={`\n        border-2 border-dashed transition-all duration-200\n        ${element.locked ? 'border-gray-400' : 'border-blue-500'}\n        ${isDragging ? 'scale-105' : ''}\n        ${previewMode ? 'border-transparent' : ''}\n        bg-white dark:bg-gray-800 rounded-lg shadow-lg\n        ${element.locked ? 'opacity-75' : ''}\n      `}\n    >\n      {/* Header Controls */}\n      {!previewMode && (\n        <div className=\"absolute -top-8 left-0 right-0 flex items-center justify-between px-2 py-1 bg-gray-800 dark:bg-gray-700 text-white text-xs rounded-t-lg\">\n          <div className=\"flex items-center gap-1\">\n            <GripVertical className=\"w-3 h-3\" />\n            <span className=\"font-medium capitalize\">{element.type}</span>\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {Math.round(element.size.width)}x{Math.round(element.size.height)}\n            </Badge>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <button\n              onClick={() => onToggleVisibility(element.id)}\n              className=\"p-1 hover:bg-gray-600 rounded\"\n              title=\"–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å\"\n            >\n              {element.visible ? <Eye className=\"w-3 h-3\" /> : <EyeOff className=\"w-3 h-3\" />}\n            </button>\n            <button\n              onClick={() => onToggleLock(element.id)}\n              className=\"p-1 hover:bg-gray-600 rounded\"\n              title=\"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å\"\n            >\n              {element.locked ? <Lock className=\"w-3 h-3\" /> : <Unlock className=\"w-3 h-3\" />}\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Content */}\n      <div className=\"h-full p-4 flex items-center justify-center\">\n        {element.content || (\n          <div className=\"text-center text-gray-500 dark:text-gray-400\">\n            <Layout className=\"w-8 h-8 mx-auto mb-2\" />\n            <p className=\"text-sm font-medium capitalize\">{element.type}</p>\n            <p className=\"text-xs opacity-75\">\n              {Math.round(element.position.x)}, {Math.round(element.position.y)}\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Resize Handle */}\n      {!previewMode && element.resizable && !element.locked && (\n        <div\n          className=\"absolute bottom-0 right-0 w-4 h-4 bg-blue-500 cursor-se-resize rounded-tl-lg hover:bg-blue-600 transition-colors\"\n          onMouseDown={handleResizeStart}\n          title=\"–ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä\"\n        />\n      )}\n    </div>\n  );\n};\n\ninterface DraggableLayoutProps {\n  elements: LayoutElement[];\n  config: DraggableLayoutConfig;\n  onElementMove: (id: string, position: { x: number; y: number }) => void;\n  onElementResize: (id: string, size: { width: number; height: number }) => void;\n  onElementToggleVisibility: (id: string) => void;\n  onElementToggleLock: (id: string) => void;\n  onConfigChange: (config: Partial<DraggableLayoutConfig>) => void;\n  children?: React.ReactNode;\n}\n\nexport const DraggableLayout: React.FC<DraggableLayoutProps> = ({\n  elements,\n  config,\n  onElementMove,\n  onElementResize,\n  onElementToggleVisibility,\n  onElementToggleLock,\n  onConfigChange,\n  children\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const gridStyle = config.showGrid ? {\n    backgroundImage: `\n      linear-gradient(to right, rgba(0,0,0,0.1) 1px, transparent 1px),\n      linear-gradient(to bottom, rgba(0,0,0,0.1) 1px, transparent 1px)\n    `,\n    backgroundSize: `${config.gridSize}% ${config.gridSize}%`,\n  } : {};\n\n  return (\n    <DndProvider backend={HTML5Backend}>\n      <div className=\"h-full flex flex-col\">\n        {/* Controls */}\n        {!config.previewMode && (\n          <div className=\"flex-shrink-0 p-4 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700\">\n            <div className=\"flex items-center gap-4 flex-wrap\">\n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  id=\"preview-mode\"\n                  checked={config.previewMode}\n                  onCheckedChange={(checked) => onConfigChange({ previewMode: checked })}\n                />\n                <Label htmlFor=\"preview-mode\">–†–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</Label>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  id=\"snap-to-grid\"\n                  checked={config.snapToGrid}\n                  onCheckedChange={(checked) => onConfigChange({ snapToGrid: checked })}\n                />\n                <Label htmlFor=\"snap-to-grid\">–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ç–∫–µ</Label>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  id=\"show-grid\"\n                  checked={config.showGrid}\n                  onCheckedChange={(checked) => onConfigChange({ showGrid: checked })}\n                />\n                <Label htmlFor=\"show-grid\">–ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ç–∫—É</Label>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  id=\"lock-elements\"\n                  checked={config.lockElements}\n                  onCheckedChange={(checked) => onConfigChange({ lockElements: checked })}\n                />\n                <Label htmlFor=\"lock-elements\">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ</Label>\n              </div>\n\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => {\n                  // –°–±—Ä–æ—Å –∫ —É–º–æ–ª—á–∞–Ω–∏—é\n                  onConfigChange({ \n                    elements: DEFAULT_ELEMENTS,\n                    gridSize: 5,\n                    snapToGrid: true,\n                    showGrid: true,\n                    lockElements: false,\n                    previewMode: false\n                  });\n                }}\n              >\n                <RotateCcw className=\"w-4 h-4 mr-2\" />\n                –°–±—Ä–æ—Å–∏—Ç—å\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* Layout Container */}\n        <div\n          ref={containerRef}\n          className=\"flex-1 relative overflow-hidden bg-gray-100 dark:bg-gray-900\"\n          style={gridStyle}\n        >\n          {elements.map((element) => (\n            <DraggableElement\n              key={element.id}\n              element={element}\n              onMove={onElementMove}\n              onResize={onElementResize}\n              onToggleVisibility={onElementToggleVisibility}\n              onToggleLock={onElementToggleLock}\n              gridSize={config.gridSize}\n              snapToGrid={config.snapToGrid}\n              showGrid={config.showGrid}\n              previewMode={config.previewMode}\n              containerRef={containerRef}\n            />\n          ))}\n          {children}\n        </div>\n      </div>\n    </DndProvider>\n  );\n};\n\nexport const useDraggableLayout = () => {\n  const [config, setConfig] = useState<DraggableLayoutConfig>({\n    elements: DEFAULT_ELEMENTS,\n    gridSize: 5,\n    snapToGrid: true,\n    showGrid: true,\n    lockElements: false,\n    previewMode: false,\n  });\n\n  const updateConfig = useCallback((newConfig: Partial<DraggableLayoutConfig>) => {\n    setConfig(prev => ({ ...prev, ...newConfig }));\n  }, []);\n\n  const updateElement = useCallback((id: string, updates: Partial<LayoutElement>) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(el => \n        el.id === id ? { ...el, ...updates } : el\n      )\n    }));\n  }, []);\n\n  const moveElement = useCallback((id: string, position: { x: number; y: number }) => {\n    updateElement(id, { position });\n  }, [updateElement]);\n\n  const resizeElement = useCallback((id: string, size: { width: number; height: number }) => {\n    updateElement(id, { size });\n  }, [updateElement]);\n\n  const toggleElementVisibility = useCallback((id: string) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(el =>\n        el.id === id ? { ...el, visible: !el.visible } : el\n      )\n    }));\n  }, []);\n\n  const toggleElementLock = useCallback((id: string) => {\n    setConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(el =>\n        el.id === id ? { ...el, locked: !el.locked } : el\n      )\n    }));\n  }, []);\n\n  const resetLayout = useCallback(() => {\n    setConfig({\n      elements: DEFAULT_ELEMENTS,\n      gridSize: 5,\n      snapToGrid: true,\n      showGrid: true,\n      lockElements: false,\n      previewMode: false,\n    });\n  }, []);\n\n  return {\n    config,\n    updateConfig,\n    moveElement,\n    resizeElement,\n    toggleElementVisibility,\n    toggleElementLock,\n    resetLayout,\n  };\n};","size_bytes":15550},"client/src/components/layout/flexible-layout.tsx":{"content":"import React, { useMemo } from 'react';\nimport { SimpleLayoutConfig } from './simple-layout-customizer';\nimport { ResizableHandle, ResizablePanel, ResizablePanelGroup } from '@/components/ui/resizable';\nimport { Navigation, Sidebar, Sliders, Monitor } from 'lucide-react';\nimport { useMediaQuery } from '@/hooks/use-media-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\ninterface FlexibleLayoutProps {\n  config: SimpleLayoutConfig;\n  headerContent: React.ReactNode;\n  sidebarContent: React.ReactNode;\n  canvasContent: React.ReactNode;\n  propertiesContent: React.ReactNode;\n  onConfigChange?: (newConfig: SimpleLayoutConfig) => void;\n  hideOnMobile?: boolean; // –°–∫—Ä—ã–≤–∞—Ç—å –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö\n  currentTab?: string; // –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞\n}\n\nexport const FlexibleLayout: React.FC<FlexibleLayoutProps> = ({\n  config,\n  headerContent,\n  sidebarContent,\n  canvasContent,\n  propertiesContent,\n  onConfigChange,\n  hideOnMobile = false,\n  currentTab\n}) => {\n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (—ç–∫—Ä–∞–Ω—ã –º–µ–Ω—å—à–µ 1200px –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)\n  const isMobile = useMediaQuery('(max-width: 1200px)');\n  const isSmallMobile = useIsMobile();\n  \n  const layoutStyles = useMemo(() => {\n    const visibleElements = config.elements.filter(el => {\n      if (!el.visible) return false;\n      \n      // –°–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º hideOnMobile\n      if (hideOnMobile && isMobile && (el.type === 'sidebar' || el.type === 'properties')) {\n        return false;\n      }\n      \n      // –ù–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö —Å–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ –≤—Å–µ–≥–¥–∞\n      if (isSmallMobile && (el.type === 'sidebar' || el.type === 'properties')) {\n        return false;\n      }\n      \n      return true;\n    });\n    \n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –ø–æ–∑–∏—Ü–∏—è–º\n    const topElements = visibleElements.filter(el => el.position === 'top');\n    const bottomElements = visibleElements.filter(el => el.position === 'bottom');\n    const leftElements = visibleElements.filter(el => el.position === 'left');\n    const rightElements = visibleElements.filter(el => el.position === 'right');\n    const centerElements = visibleElements.filter(el => el.position === 'center');\n    \n    // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã\n    const topSize = topElements.reduce((sum, el) => sum + el.size, 0);\n    const bottomSize = bottomElements.reduce((sum, el) => sum + el.size, 0);\n    const leftSize = leftElements.reduce((sum, el) => sum + el.size, 0);\n    const rightSize = rightElements.reduce((sum, el) => sum + el.size, 0);\n    \n    return {\n      container: {\n        display: 'grid',\n        height: '100vh',\n        gridTemplateRows: `${topSize > 0 ? `${topSize}rem` : ''} 1fr ${bottomSize > 0 ? `${bottomSize}rem` : ''}`.trim(),\n        gridTemplateColumns: `${leftSize > 0 ? `${leftSize}%` : ''} 1fr ${rightSize > 0 ? `${rightSize}%` : ''}`.trim(),\n        gridTemplateAreas: `\n          ${topSize > 0 ? `\"${leftSize > 0 ? 'top-left' : ''} top ${rightSize > 0 ? 'top-right' : ''}\"` : ''}\n          \"${leftSize > 0 ? 'left' : ''} center ${rightSize > 0 ? 'right' : ''}\"\n          ${bottomSize > 0 ? `\"${leftSize > 0 ? 'bottom-left' : ''} bottom ${rightSize > 0 ? 'bottom-right' : ''}\"` : ''}\n        `.trim()\n      },\n      elements: {\n        top: topSize > 0 ? { gridArea: 'top' } : undefined,\n        bottom: bottomSize > 0 ? { gridArea: 'bottom' } : undefined,\n        left: leftSize > 0 ? { gridArea: 'left' } : undefined,\n        right: rightSize > 0 ? { gridArea: 'right' } : undefined,\n        center: { gridArea: 'center' }\n      }\n    };\n  }, [config, hideOnMobile, isMobile]);\n\n  const getElementContent = (type: string) => {\n    switch (type) {\n      case 'header':\n        return headerContent;\n      case 'sidebar':\n        return sidebarContent;\n      case 'canvas':\n        return canvasContent;\n      case 'properties':\n        return propertiesContent;\n      default:\n        return null;\n    }\n  };\n\n  const renderElement = (element: any) => {\n    const content = getElementContent(element.type);\n    if (!content) return null;\n\n    const gridArea = element.position === 'center' ? 'center' : \n                    element.position === 'top' ? 'top' :\n                    element.position === 'bottom' ? 'bottom' :\n                    element.position === 'left' ? 'left' :\n                    element.position === 'right' ? 'right' : 'center';\n\n    return (\n      <div\n        key={element.id}\n        className={`\n          ${element.type === 'header' ? 'border-b' : ''}\n          ${element.type === 'sidebar' ? 'border-r' : ''}\n          ${element.type === 'properties' ? 'border-l' : ''}\n          ${config.compactMode ? 'text-sm' : ''}\n          border-border bg-background\n          ${config.showGrid ? 'relative' : ''}\n        `}\n        style={{\n          gridArea: gridArea,\n          minHeight: element.type === 'header' ? 'auto' : '200px',\n          overflow: 'hidden'\n        }}\n      >\n        {config.showGrid && (\n          <div className=\"absolute inset-0 opacity-5 pointer-events-none\" style={{\n            backgroundImage: `\n              linear-gradient(to right, hsl(var(--border)) 1px, transparent 1px),\n              linear-gradient(to bottom, hsl(var(--border)) 1px, transparent 1px)\n            `,\n            backgroundSize: '20px 20px'\n          }} />\n        )}\n        <div className=\"relative z-10 h-full\">\n          {content}\n        </div>\n      </div>\n    );\n  };\n\n  // –°–æ–∑–¥–∞–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π CSS Grid layout\n  const createSimpleLayout = () => {\n    const visibleElements = config.elements.filter(el => {\n      if (!el.visible) return false;\n      \n      // –°–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º hideOnMobile\n      if (hideOnMobile && isMobile && (el.type === 'sidebar' || el.type === 'properties')) {\n        return false;\n      }\n      \n      return true;\n    });\n    \n    if (visibleElements.length === 0) {\n      return (\n        <div className=\"h-full w-full flex flex-col items-center justify-center text-muted-foreground bg-background relative\">\n          <div className=\"text-center mb-8\">\n            <h3 className=\"text-lg font-medium mb-2\">\n              {hideOnMobile && isMobile ? '–ú–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º' : '–í—Å–µ –ø–∞–Ω–µ–ª–∏ —Å–∫—Ä—ã—Ç—ã'}\n            </h3>\n            <p className=\"text-sm\">\n              {hideOnMobile && isMobile \n                ? '–ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ —Å–∫—Ä—ã—Ç—ã –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞' \n                : '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–∞–Ω–µ–ª–µ–π'\n              }\n            </p>\n          </div>\n          \n          {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–∫–µ—Ç–æ–º */}\n          <div className=\"flex items-center space-x-2 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 p-3\">\n            <button\n              onClick={() => {\n                if (onConfigChange) {\n                  const newConfig = { ...config };\n                  const headerElement = newConfig.elements.find(el => el.id === 'header');\n                  if (headerElement) {\n                    headerElement.visible = true;\n                    onConfigChange(newConfig);\n                  }\n                }\n              }}\n              className=\"p-3 rounded-md transition-all duration-200 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700 hover:text-blue-600 dark:hover:text-blue-400\"\n              title=\"–ü–æ–∫–∞–∑–∞—Ç—å —à–∞–ø–∫—É\"\n            >\n              <Navigation className=\"w-5 h-5\" />\n            </button>\n            \n            <button\n              onClick={() => {\n                if (onConfigChange) {\n                  const newConfig = { ...config };\n                  const sidebarElement = newConfig.elements.find(el => el.id === 'sidebar');\n                  if (sidebarElement) {\n                    sidebarElement.visible = true;\n                    onConfigChange(newConfig);\n                  }\n                }\n              }}\n              className=\"p-3 rounded-md transition-all duration-200 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700 hover:text-blue-600 dark:hover:text-blue-400\"\n              title=\"–ü–æ–∫–∞–∑–∞—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å\"\n            >\n              <Sidebar className=\"w-5 h-5\" />\n            </button>\n            \n            <button\n              onClick={() => {\n                if (onConfigChange) {\n                  const newConfig = { ...config };\n                  const canvasElement = newConfig.elements.find(el => el.id === 'canvas');\n                  if (canvasElement) {\n                    canvasElement.visible = true;\n                    onConfigChange(newConfig);\n                  }\n                }\n              }}\n              className=\"p-3 rounded-md transition-all duration-200 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700 hover:text-blue-600 dark:hover:text-blue-400\"\n              title=\"–ü–æ–∫–∞–∑–∞—Ç—å —Ö–æ–ª—Å—Ç\"\n            >\n              <Monitor className=\"w-5 h-5\" />\n            </button>\n            \n            <button\n              onClick={() => {\n                if (onConfigChange) {\n                  const newConfig = { ...config };\n                  const propertiesElement = newConfig.elements.find(el => el.id === 'properties');\n                  if (propertiesElement) {\n                    propertiesElement.visible = true;\n                    onConfigChange(newConfig);\n                  }\n                }\n              }}\n              className=\"p-3 rounded-md transition-all duration-200 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700 hover:text-blue-600 dark:hover:text-blue-400\"\n              title=\"–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤\"\n            >\n              <Sliders className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç\n    if (visibleElements.length === 1) {\n      const singleElement = visibleElements[0];\n      return (\n        <div className=\"h-full w-full overflow-hidden bg-background\">\n          <div className=\"h-full w-full\">\n            {getElementContent(singleElement.type)}\n          </div>\n        </div>\n      );\n    }\n\n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –ø–æ–∑–∏—Ü–∏—è–º\n    const topEl = visibleElements.find(el => el.position === 'top');\n    const bottomEl = visibleElements.find(el => el.position === 'bottom');\n    const leftEl = visibleElements.find(el => el.position === 'left');\n    const rightEl = visibleElements.find(el => el.position === 'right');\n    const centerEl = visibleElements.find(el => el.position === 'center');\n\n    // –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: top / middle / bottom\n    const rows = [];\n    const areas = [];\n    \n    // –í–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞\n    if (topEl) {\n      rows.push(`${topEl.size}px`);\n      areas.push('\"header header header\"');\n    }\n    \n    // –°—Ä–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞\n    rows.push('1fr');\n    let middleArea = '\"';\n    if (leftEl) middleArea += 'sidebar ';\n    else middleArea += '. ';\n    \n    if (centerEl) middleArea += 'main ';\n    else middleArea += '. ';\n    \n    if (rightEl) middleArea += 'properties';\n    else middleArea += '.';\n    \n    middleArea += '\"';\n    areas.push(middleArea);\n    \n    // –ù–∏–∂–Ω—è—è —Å—Ç—Ä–æ–∫–∞  \n    if (bottomEl) {\n      rows.push(`${bottomEl.size}px`);\n      areas.push('\"footer footer footer\"');\n    }\n\n    // –ö–æ–ª–æ–Ω–∫–∏\n    const columns = [];\n    if (leftEl) columns.push(`${leftEl.size}%`);\n    else columns.push('0px');\n    \n    columns.push('1fr');\n    \n    if (rightEl) columns.push(`${rightEl.size}%`);\n    else columns.push('0px');\n\n    // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω—è—è/–Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç\n    if (topEl && !leftEl && !rightEl && (centerEl || bottomEl)) {\n      // –°–∫—Ä—ã–≤–∞–µ–º ResizableHandle –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ \"–ë–æ—Ç\"\n      const hideResizeHandle = isMobile && currentTab === 'bot';\n      \n      return (\n        <ResizablePanelGroup direction=\"vertical\" className=\"h-full\">\n          <ResizablePanel defaultSize={isMobile ? 7 : topEl.size} minSize={isMobile ? 7 : 15} maxSize={30}>\n            <div className=\"h-full bg-background overflow-auto\">\n              {getElementContent(topEl.type)}\n            </div>\n          </ResizablePanel>\n          <ResizableHandle className=\"opacity-0 pointer-events-none h-0\" />\n          <ResizablePanel defaultSize={isMobile ? 93 : (100 - topEl.size)}>\n            <div className=\"h-full bg-background overflow-auto\">\n              {centerEl ? getElementContent(centerEl.type) : (bottomEl ? getElementContent(bottomEl.type) : null)}\n            </div>\n          </ResizablePanel>\n        </ResizablePanelGroup>\n      );\n    }\n\n    // –ï—Å–ª–∏ –µ—Å—Ç—å –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç\n    if ((leftEl || rightEl) && centerEl && !topEl && !bottomEl) {\n      const leftSize = leftEl?.size || 0;\n      const rightSize = rightEl?.size || 0;\n      \n      return (\n        <ResizablePanelGroup direction=\"horizontal\" className=\"h-full\">\n          {leftEl && (\n            <>\n              <ResizablePanel \n                defaultSize={leftSize} \n                minSize={15} \n                maxSize={40}\n              >\n                <div className=\"h-full border-r border-border bg-background overflow-hidden\">\n                  {getElementContent(leftEl.type)}\n                </div>\n              </ResizablePanel>\n              <ResizableHandle withHandle />\n            </>\n          )}\n          <ResizablePanel \n            minSize={30}\n          >\n            <div className=\"h-full bg-background overflow-hidden\">\n              {getElementContent(centerEl.type)}\n            </div>\n          </ResizablePanel>\n          {rightEl && (\n            <>\n              <ResizableHandle withHandle />\n              <ResizablePanel \n                defaultSize={rightSize} \n                minSize={15} \n                maxSize={40}\n              >\n                <div className=\"h-full border-l border-border bg-background overflow-hidden\">\n                  {getElementContent(rightEl.type)}\n                </div>\n              </ResizablePanel>\n            </>\n          )}\n        </ResizablePanelGroup>\n      );\n    }\n\n    // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞–∫–µ—Ç (–≤–µ—Ä—Ö + –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏)\n    return (\n      <div className=\"h-full flex flex-col\">\n        {topEl && (\n          <div className=\"border-b border-border bg-background\" style={{ minHeight: `${topEl.size}rem` }}>\n            {getElementContent(topEl.type)}\n          </div>\n        )}\n        <div className=\"flex-1 min-h-0\">\n          <ResizablePanelGroup direction=\"horizontal\" className=\"h-full\">\n            {leftEl && (\n              <>\n                <ResizablePanel \n                  defaultSize={leftEl.size} \n                  minSize={15} \n                  maxSize={40}\n                >\n                  <div className=\"h-full border-r border-border bg-background overflow-hidden\">\n                    {getElementContent(leftEl.type)}\n                  </div>\n                </ResizablePanel>\n                <ResizableHandle withHandle />\n              </>\n            )}\n            <ResizablePanel \n              minSize={30}\n            >\n              <div className=\"h-full bg-background overflow-hidden\">\n                {centerEl ? getElementContent(centerEl.type) : null}\n              </div>\n            </ResizablePanel>\n            {rightEl && (\n              <>\n                <ResizableHandle withHandle />\n                <ResizablePanel \n                  defaultSize={rightEl.size} \n                  minSize={15} \n                  maxSize={40}\n                >\n                  <div className=\"h-full border-l border-border bg-background overflow-hidden\">\n                    {getElementContent(rightEl.type)}\n                  </div>\n                </ResizablePanel>\n              </>\n            )}\n          </ResizablePanelGroup>\n        </div>\n        {bottomEl && (\n          <div className=\"border-t border-border bg-background\" style={{ minHeight: `${bottomEl.size}px` }}>\n            {getElementContent(bottomEl.type)}\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"h-screen overflow-hidden\">\n      {createSimpleLayout()}\n    </div>\n  );\n};\n\nexport default FlexibleLayout;","size_bytes":16961},"client/src/components/layout/layout-buttons.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { \n  PanelTop, \n  PanelLeft, \n  LayoutGrid,\n  PanelRight,\n  EyeOff,\n  Eye\n} from 'lucide-react';\n\ninterface LayoutButtonsProps {\n  onToggleCanvas?: () => void;\n  onToggleHeader?: () => void;\n  onToggleSidebar?: () => void;\n  onToggleProperties?: () => void;\n  onShowFullLayout?: () => void;\n  canvasVisible?: boolean;\n  headerVisible?: boolean;\n  sidebarVisible?: boolean;\n  propertiesVisible?: boolean;\n  className?: string;\n}\n\nexport function LayoutButtons({ \n  onToggleCanvas, \n  onToggleHeader, \n  onToggleSidebar,\n  onToggleProperties,\n  onShowFullLayout,\n  canvasVisible = true,\n  headerVisible = true,\n  sidebarVisible = true,\n  propertiesVisible = true,\n  className = \"\" \n}: LayoutButtonsProps) {\n  return (\n    <TooltipProvider>\n      <div className={`flex items-center gap-1 p-2 bg-background border border-border rounded-lg ${className}`}>\n        {/* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —à–∞–ø–∫–∏ - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ */}\n        {onToggleHeader && (\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onToggleHeader}\n                className={`h-8 w-8 p-0 rounded-md ${\n                  headerVisible \n                    ? 'bg-gray-600 hover:bg-gray-700 text-white' \n                    : 'bg-gray-300 hover:bg-gray-400 text-gray-600'\n                }`}\n              >\n                <PanelTop className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>\n              <p>{headerVisible ? '–°–∫—Ä—ã—Ç—å —à–∞–ø–∫—É' : '–ü–æ–∫–∞–∑–∞—Ç—å —à–∞–ø–∫—É'}</p>\n            </TooltipContent>\n          </Tooltip>\n        )}\n\n        {/* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ */}\n        {onToggleSidebar && (\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onToggleSidebar}\n                className={`h-8 w-8 p-0 rounded-md ${\n                  sidebarVisible \n                    ? 'bg-gray-600 hover:bg-gray-700 text-white' \n                    : 'bg-gray-300 hover:bg-gray-400 text-gray-600'\n                }`}\n              >\n                <PanelLeft className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>\n              <p>{sidebarVisible ? '–°–∫—Ä—ã—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å' : '–ü–æ–∫–∞–∑–∞—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å'}</p>\n            </TooltipContent>\n          </Tooltip>\n        )}\n\n        {/* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ö–æ–ª—Å—Ç–∞ - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ */}\n        {onToggleCanvas && (\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onToggleCanvas}\n                className={`h-8 w-8 p-0 rounded-md ${\n                  canvasVisible \n                    ? 'bg-gray-600 hover:bg-gray-700 text-white' \n                    : 'bg-gray-300 hover:bg-gray-400 text-gray-600'\n                }`}\n              >\n                <LayoutGrid className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>\n              <p>{canvasVisible ? '–°–∫—Ä—ã—Ç—å —Ö–æ–ª—Å—Ç' : '–ü–æ–∫–∞–∑–∞—Ç—å —Ö–æ–ª—Å—Ç'}</p>\n            </TooltipContent>\n          </Tooltip>\n        )}\n\n        {/* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ —Å–≤–æ–π—Å—Ç–≤ - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ */}\n        {onToggleProperties && (\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onToggleProperties}\n                className={`h-8 w-8 p-0 rounded-md ${\n                  propertiesVisible \n                    ? 'bg-gray-600 hover:bg-gray-700 text-white' \n                    : 'bg-gray-300 hover:bg-gray-400 text-gray-600'\n                }`}\n              >\n                <PanelRight className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>\n              <p>{propertiesVisible ? '–°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤'}</p>\n            </TooltipContent>\n          </Tooltip>\n        )}\n\n        {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}\n        {(() => {\n          const visiblePanels = [headerVisible, sidebarVisible, canvasVisible, propertiesVisible].filter(Boolean).length;\n          const hiddenPanels = 4 - visiblePanels;\n\n          // –ï—Å–ª–∏ –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –ø–∞–Ω–µ–ª—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É \"–°–∫—Ä—ã—Ç—å —Ç–µ–∫—É—â—É—é\"\n          if (visiblePanels === 1) {\n            let currentVisibleAction;\n            let currentVisibleIcon;\n            let currentVisibleTooltip;\n\n            if (sidebarVisible) {\n              currentVisibleAction = onToggleSidebar;\n              currentVisibleIcon = <EyeOff className=\"h-4 w-4\" />;\n              currentVisibleTooltip = \"–°–∫—Ä—ã—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å\";\n            } else if (headerVisible) {\n              currentVisibleAction = onToggleHeader;\n              currentVisibleIcon = <EyeOff className=\"h-4 w-4\" />;\n              currentVisibleTooltip = \"–°–∫—Ä—ã—Ç—å —à–∞–ø–∫—É\";\n            } else if (canvasVisible) {\n              currentVisibleAction = onToggleCanvas;\n              currentVisibleIcon = <EyeOff className=\"h-4 w-4\" />;\n              currentVisibleTooltip = \"–°–∫—Ä—ã—Ç—å —Ö–æ–ª—Å—Ç\";\n            } else if (propertiesVisible) {\n              currentVisibleAction = onToggleProperties;\n              currentVisibleIcon = <EyeOff className=\"h-4 w-4\" />;\n              currentVisibleTooltip = \"–°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤\";\n            }\n\n            return currentVisibleAction && (\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={currentVisibleAction}\n                    className=\"h-8 w-8 p-0 bg-orange-600 hover:bg-orange-700 text-white rounded-md\"\n                  >\n                    {currentVisibleIcon}\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>{currentVisibleTooltip}</p>\n                </TooltipContent>\n              </Tooltip>\n            );\n          }\n          \n          // –ï—Å–ª–∏ —Å–∫—Ä—ã—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞–Ω–µ–ª–µ–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É \"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë\"\n          if (hiddenPanels > 1 && onShowFullLayout) {\n            return (\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={onShowFullLayout}\n                    className=\"h-8 w-8 p-0 bg-blue-600 hover:bg-blue-700 text-white rounded-md\"\n                  >\n                    <Eye className=\"h-4 w-4\" />\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–∞–Ω–µ–ª–∏</p>\n                </TooltipContent>\n              </Tooltip>\n            );\n          }\n\n          return null;\n        })()}\n      </div>\n    </TooltipProvider>\n  );\n}","size_bytes":7583},"client/src/components/layout/layout-customizer.tsx":{"content":"import React, { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { DraggableLayout, useDraggableLayout, LayoutElement } from './draggable-layout';\nimport { \n  Layout, \n  Move, \n  Settings, \n  Grid, \n  Eye, \n  EyeOff, \n  Lock, \n  Unlock,\n  RotateCcw,\n  Play,\n  Pause\n} from 'lucide-react';\n\ninterface LayoutCustomizerProps {\n  headerContent: React.ReactNode;\n  sidebarContent: React.ReactNode;\n  canvasContent: React.ReactNode;\n  propertiesContent: React.ReactNode;\n  onLayoutChange?: (elements: LayoutElement[]) => void;\n}\n\nexport const LayoutCustomizer: React.FC<LayoutCustomizerProps> = ({\n  headerContent,\n  sidebarContent,\n  canvasContent,\n  propertiesContent,\n  onLayoutChange\n}) => {\n  const [isCustomizing, setIsCustomizing] = useState(false);\n  const {\n    config,\n    updateConfig,\n    moveElement,\n    resizeElement,\n    toggleElementVisibility,\n    toggleElementLock,\n    resetLayout\n  } = useDraggableLayout();\n\n  // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n  const elementsWithContent = config.elements.map(element => ({\n    ...element,\n    content: (() => {\n      switch (element.type) {\n        case 'header':\n          return headerContent;\n        case 'sidebar':\n          return sidebarContent;\n        case 'canvas':\n          return canvasContent;\n        case 'properties':\n          return propertiesContent;\n        default:\n          return null;\n      }\n    })()\n  }));\n\n  const handleApplyLayout = useCallback(() => {\n    if (onLayoutChange) {\n      onLayoutChange(elementsWithContent);\n    }\n    setIsCustomizing(false);\n  }, [elementsWithContent, onLayoutChange]);\n\n  const handleToggleCustomizer = useCallback(() => {\n    setIsCustomizing(!isCustomizing);\n  }, [isCustomizing]);\n\n  const visibleElements = elementsWithContent.filter(el => el.visible);\n  const lockedElements = elementsWithContent.filter(el => el.locked);\n\n  return (\n    <Dialog open={isCustomizing} onOpenChange={setIsCustomizing}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" onClick={handleToggleCustomizer}>\n          <Move className=\"w-4 h-4 mr-2\" />\n          –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ\n        </Button>\n      </DialogTrigger>\n      \n      <DialogContent className=\"max-w-7xl max-h-[90vh] p-0\">\n        <DialogHeader className=\"p-6 pb-0\">\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Layout className=\"w-5 h-5\" />\n            –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n          </DialogTitle>\n        </DialogHeader>\n        \n        <Tabs defaultValue=\"customize\" className=\"flex-1 flex flex-col\">\n          <div className=\"px-6\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"customize\">–ù–∞—Å—Ç—Ä–æ–π–∫–∞</TabsTrigger>\n              <TabsTrigger value=\"elements\">–≠–ª–µ–º–µ–Ω—Ç—ã</TabsTrigger>\n            </TabsList>\n          </div>\n          \n          <TabsContent value=\"customize\" className=\"flex-1 m-0\">\n            <div className=\"h-[600px] flex flex-col\">\n              <DraggableLayout\n                elements={elementsWithContent}\n                config={config}\n                onElementMove={moveElement}\n                onElementResize={resizeElement}\n                onElementToggleVisibility={toggleElementVisibility}\n                onElementToggleLock={toggleElementLock}\n                onConfigChange={updateConfig}\n              />\n            </div>\n          </TabsContent>\n          \n          <TabsContent value=\"elements\" className=\"flex-1 m-0 p-6\">\n            <div className=\"space-y-6\">\n              {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}\n              <div className=\"grid grid-cols-4 gap-4\">\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <Layout className=\"w-4 h-4 text-blue-500\" />\n                      <div>\n                        <p className=\"text-sm font-medium\">–í—Å–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤</p>\n                        <p className=\"text-lg font-bold\">{elementsWithContent.length}</p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n                \n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <Eye className=\"w-4 h-4 text-green-500\" />\n                      <div>\n                        <p className=\"text-sm font-medium\">–í–∏–¥–∏–º—ã–µ</p>\n                        <p className=\"text-lg font-bold\">{visibleElements.length}</p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n                \n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <Lock className=\"w-4 h-4 text-orange-500\" />\n                      <div>\n                        <p className=\"text-sm font-medium\">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</p>\n                        <p className=\"text-lg font-bold\">{lockedElements.length}</p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n                \n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <Grid className=\"w-4 h-4 text-purple-500\" />\n                      <div>\n                        <p className=\"text-sm font-medium\">–°–µ—Ç–∫–∞</p>\n                        <p className=\"text-lg font-bold\">{config.gridSize}%</p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* –°–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-semibold\">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏</h3>\n                \n                {elementsWithContent.map((element) => (\n                  <Card key={element.id} className=\"border-l-4 border-l-blue-500\">\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center\">\n                            <Layout className=\"w-4 h-4\" />\n                          </div>\n                          <div>\n                            <h4 className=\"font-medium capitalize\">{element.type}</h4>\n                            <p className=\"text-sm text-gray-500\">\n                              {Math.round(element.position.x)}%, {Math.round(element.position.y)}% ‚Ä¢ \n                              {Math.round(element.size.width)}√ó{Math.round(element.size.height)}%\n                            </p>\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2\">\n                          <Badge variant={element.visible ? \"default\" : \"secondary\"}>\n                            {element.visible ? \"–í–∏–¥–∏–º—ã–π\" : \"–°–∫—Ä—ã—Ç—ã–π\"}\n                          </Badge>\n                          <Badge variant={element.locked ? \"destructive\" : \"outline\"}>\n                            {element.locked ? \"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω\" : \"–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω\"}\n                          </Badge>\n                          \n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => toggleElementVisibility(element.id)}\n                          >\n                            {element.visible ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                          </Button>\n                          \n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => toggleElementLock(element.id)}\n                          >\n                            {element.locked ? <Unlock className=\"w-4 h-4\" /> : <Lock className=\"w-4 h-4\" />}\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n\n              {/* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-semibold\">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>\n                \n                <div className=\"flex flex-wrap gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      elementsWithContent.forEach(el => {\n                        toggleElementVisibility(el.id);\n                      });\n                    }}\n                  >\n                    {visibleElements.length === elementsWithContent.length ? (\n                      <>\n                        <EyeOff className=\"w-4 h-4 mr-2\" />\n                        –°–∫—Ä—ã—Ç—å –≤—Å–µ\n                      </>\n                    ) : (\n                      <>\n                        <Eye className=\"w-4 h-4 mr-2\" />\n                        –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ\n                      </>\n                    )}\n                  </Button>\n                  \n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      elementsWithContent.forEach(el => {\n                        toggleElementLock(el.id);\n                      });\n                    }}\n                  >\n                    {lockedElements.length === elementsWithContent.length ? (\n                      <>\n                        <Unlock className=\"w-4 h-4 mr-2\" />\n                        –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ\n                      </>\n                    ) : (\n                      <>\n                        <Lock className=\"w-4 h-4 mr-2\" />\n                        –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ\n                      </>\n                    )}\n                  </Button>\n                  \n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => updateConfig({ previewMode: !config.previewMode })}\n                  >\n                    {config.previewMode ? (\n                      <>\n                        <Pause className=\"w-4 h-4 mr-2\" />\n                        –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n                      </>\n                    ) : (\n                      <>\n                        <Play className=\"w-4 h-4 mr-2\" />\n                        –†–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞\n                      </>\n                    )}\n                  </Button>\n                  \n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={resetLayout}\n                  >\n                    <RotateCcw className=\"w-4 h-4 mr-2\" />\n                    –°–±—Ä–æ—Å–∏—Ç—å\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </TabsContent>\n        </Tabs>\n        \n        {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}\n        <div className=\"flex justify-between items-center p-6 pt-0 border-t\">\n          <div className=\"flex items-center gap-2\">\n            <Switch\n              id=\"live-preview\"\n              checked={config.previewMode}\n              onCheckedChange={(checked) => updateConfig({ previewMode: checked })}\n            />\n            <Label htmlFor=\"live-preview\">–†–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</Label>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={() => setIsCustomizing(false)}>\n              –û—Ç–º–µ–Ω–∞\n            </Button>\n            <Button onClick={handleApplyLayout}>\n              –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default LayoutCustomizer;","size_bytes":12851},"client/src/components/layout/layout-manager.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { \n  Settings, \n  Move, \n  RotateCcw, \n  Grid, \n  Layout, \n  Sidebar, \n  Navigation, \n  Maximize,\n  ArrowUp,\n  ArrowDown,\n  ArrowLeft,\n  ArrowRight\n} from 'lucide-react';\n\nexport interface LayoutConfig {\n  headerPosition: 'top' | 'bottom' | 'left' | 'right';\n  sidebarPosition: 'left' | 'right';\n  propertiesPosition: 'right' | 'left';\n  canvasFullscreen: boolean;\n  compactMode: boolean;\n  showGrid: boolean;\n  panelSizes: {\n    sidebar: number;\n    properties: number;\n    canvas: number;\n  };\n}\n\nconst DEFAULT_LAYOUT: LayoutConfig = {\n  headerPosition: 'top',\n  sidebarPosition: 'left',\n  propertiesPosition: 'right',\n  canvasFullscreen: false,\n  compactMode: false,\n  showGrid: true,\n  panelSizes: {\n    sidebar: 20,\n    properties: 25,\n    canvas: 55\n  }\n};\n\ninterface LayoutManagerProps {\n  config: LayoutConfig;\n  onConfigChange: (config: LayoutConfig) => void;\n  onApply: () => void;\n  onReset: () => void;\n}\n\nexport function LayoutManager({ config, onConfigChange, onApply, onReset }: LayoutManagerProps) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [previewMode, setPreviewMode] = useState(false);\n\n  const handleConfigUpdate = (key: keyof LayoutConfig, value: any) => {\n    const newConfig = { ...config, [key]: value };\n    onConfigChange(newConfig);\n  };\n\n  const handlePanelSizeUpdate = (panel: keyof LayoutConfig['panelSizes'], value: number) => {\n    const newSizes = { ...config.panelSizes, [panel]: value };\n    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ä–∞–∑–º–µ—Ä—ã —á—Ç–æ–±—ã –æ–Ω–∏ —Å–æ—Å—Ç–∞–≤–ª—è–ª–∏ 100%\n    const total = Object.values(newSizes).reduce((sum, size) => sum + size, 0);\n    const normalizedSizes = Object.fromEntries(\n      Object.entries(newSizes).map(([key, size]) => [key, Math.round((size / total) * 100)])\n    ) as LayoutConfig['panelSizes'];\n    \n    handleConfigUpdate('panelSizes', normalizedSizes);\n  };\n\n  const presets = [\n    {\n      name: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π',\n      description: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ',\n      config: DEFAULT_LAYOUT\n    },\n    {\n      name: '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π',\n      description: '–°–∂–∞—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å',\n      config: {\n        ...DEFAULT_LAYOUT,\n        compactMode: true,\n        panelSizes: { sidebar: 15, properties: 20, canvas: 65 }\n      }\n    },\n    {\n      name: '–§–æ–∫—É—Å –Ω–∞ —Ö–æ–ª—Å—Ç–µ',\n      description: '–ú–∞–∫—Å–∏–º—É–º –º–µ—Å—Ç–∞ –¥–ª—è —Ö–æ–ª—Å—Ç–∞',\n      config: {\n        ...DEFAULT_LAYOUT,\n        headerPosition: 'bottom' as const,\n        panelSizes: { sidebar: 12, properties: 15, canvas: 73 }\n      }\n    },\n    {\n      name: '–õ–µ–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π',\n      description: '–í—Å–µ –ø–∞–Ω–µ–ª–∏ —Å–ª–µ–≤–∞',\n      config: {\n        ...DEFAULT_LAYOUT,\n        sidebarPosition: 'left' as const,\n        propertiesPosition: 'left' as const,\n        panelSizes: { sidebar: 25, properties: 25, canvas: 50 }\n      }\n    },\n    {\n      name: '–ü—Ä–∞–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π',\n      description: '–í—Å–µ –ø–∞–Ω–µ–ª–∏ —Å–ø—Ä–∞–≤–∞',\n      config: {\n        ...DEFAULT_LAYOUT,\n        sidebarPosition: 'right' as const,\n        propertiesPosition: 'right' as const,\n        panelSizes: { sidebar: 25, properties: 25, canvas: 50 }\n      }\n    }\n  ];\n\n  if (!isVisible) {\n    return (\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={() => setIsVisible(true)}\n        className=\"fixed bottom-4 right-4 z-50 bg-background/80 backdrop-blur-sm border-2 border-primary/20 hover:border-primary/40 transition-all duration-200\"\n      >\n        <Layout className=\"h-4 w-4 mr-2\" />\n        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–∫–µ—Ç–∞\n      </Button>\n    );\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Layout className=\"h-5 w-5\" />\n                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–∫–µ—Ç–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n              </CardTitle>\n              <CardDescription>\n                –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–¥ —Å–≤–æ–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏\n              </CardDescription>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setIsVisible(false)}\n            >\n              ‚úï\n            </Button>\n          </div>\n        </CardHeader>\n        \n        <CardContent className=\"space-y-6\">\n          {/* –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã */}\n          <div>\n            <h3 className=\"text-lg font-semibold mb-3\">–ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n              {presets.map((preset, index) => (\n                <Card \n                  key={index}\n                  className=\"cursor-pointer hover:border-primary/50 transition-colors\"\n                  onClick={() => onConfigChange(preset.config)}\n                >\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm\">{preset.name}</CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      {preset.description}\n                    </CardDescription>\n                  </CardHeader>\n                </Card>\n              ))}\n            </div>\n          </div>\n\n          <Separator />\n\n          {/* –î–µ—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            \n            {/* –ü–æ–∑–∏—Ü–∏—è —à–∞–ø–∫–∏ */}\n            <div className=\"space-y-3\">\n              <Label className=\"text-sm font-medium flex items-center gap-2\">\n                <Navigation className=\"h-4 w-4\" />\n                –ü–æ–∑–∏—Ü–∏—è —à–∞–ø–∫–∏\n              </Label>\n              <Select \n                value={config.headerPosition} \n                onValueChange={(value) => handleConfigUpdate('headerPosition', value)}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"top\">\n                    <div className=\"flex items-center gap-2\">\n                      <ArrowUp className=\"h-4 w-4\" />\n                      –°–≤–µ—Ä—Ö—É\n                    </div>\n                  </SelectItem>\n                  <SelectItem value=\"bottom\">\n                    <div className=\"flex items-center gap-2\">\n                      <ArrowDown className=\"h-4 w-4\" />\n                      –°–Ω–∏–∑—É\n                    </div>\n                  </SelectItem>\n                  <SelectItem value=\"left\">\n                    <div className=\"flex items-center gap-2\">\n                      <ArrowLeft className=\"h-4 w-4\" />\n                      –°–ª–µ–≤–∞\n                    </div>\n                  </SelectItem>\n                  <SelectItem value=\"right\">\n                    <div className=\"flex items-center gap-2\">\n                      <ArrowRight className=\"h-4 w-4\" />\n                      –°–ø—Ä–∞–≤–∞\n                    </div>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* –ü–æ–∑–∏—Ü–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */}\n            <div className=\"space-y-3\">\n              <Label className=\"text-sm font-medium flex items-center gap-2\">\n                <Sidebar className=\"h-4 w-4\" />\n                –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)\n              </Label>\n              <Select \n                value={config.sidebarPosition} \n                onValueChange={(value) => handleConfigUpdate('sidebarPosition', value)}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"left\">\n                    <div className=\"flex items-center gap-2\">\n                      <ArrowLeft className=\"h-4 w-4\" />\n                      –°–ª–µ–≤–∞\n                    </div>\n                  </SelectItem>\n                  <SelectItem value=\"right\">\n                    <div className=\"flex items-center gap-2\">\n                      <ArrowRight className=\"h-4 w-4\" />\n                      –°–ø—Ä–∞–≤–∞\n                    </div>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* –ü–æ–∑–∏—Ü–∏—è –ø–∞–Ω–µ–ª–∏ —Å–≤–æ–π—Å—Ç–≤ */}\n            <div className=\"space-y-3\">\n              <Label className=\"text-sm font-medium flex items-center gap-2\">\n                <Settings className=\"h-4 w-4\" />\n                –ü–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤\n              </Label>\n              <Select \n                value={config.propertiesPosition} \n                onValueChange={(value) => handleConfigUpdate('propertiesPosition', value)}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"left\">\n                    <div className=\"flex items-center gap-2\">\n                      <ArrowLeft className=\"h-4 w-4\" />\n                      –°–ª–µ–≤–∞\n                    </div>\n                  </SelectItem>\n                  <SelectItem value=\"right\">\n                    <div className=\"flex items-center gap-2\">\n                      <ArrowRight className=\"h-4 w-4\" />\n                      –°–ø—Ä–∞–≤–∞\n                    </div>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */}\n            <div className=\"space-y-3\">\n              <Label className=\"text-sm font-medium\">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</Label>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <Label htmlFor=\"compact\" className=\"text-sm\">–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º</Label>\n                  <Switch\n                    id=\"compact\"\n                    checked={config.compactMode}\n                    onCheckedChange={(checked) => handleConfigUpdate('compactMode', checked)}\n                  />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <Label htmlFor=\"fullscreen\" className=\"text-sm\">–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ö–æ–ª—Å—Ç</Label>\n                  <Switch\n                    id=\"fullscreen\"\n                    checked={config.canvasFullscreen}\n                    onCheckedChange={(checked) => handleConfigUpdate('canvasFullscreen', checked)}\n                  />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <Label htmlFor=\"grid\" className=\"text-sm\">–ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ç–∫—É</Label>\n                  <Switch\n                    id=\"grid\"\n                    checked={config.showGrid}\n                    onCheckedChange={(checked) => handleConfigUpdate('showGrid', checked)}\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* –†–∞–∑–º–µ—Ä—ã –ø–∞–Ω–µ–ª–µ–π */}\n          <div className=\"space-y-3\">\n            <Label className=\"text-sm font-medium\">–†–∞–∑–º–µ—Ä—ã –ø–∞–Ω–µ–ª–µ–π (%)</Label>\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-xs\">–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å</Label>\n                <div className=\"flex items-center gap-2\">\n                  <input\n                    type=\"range\"\n                    min=\"10\"\n                    max=\"40\"\n                    value={config.panelSizes.sidebar}\n                    onChange={(e) => handlePanelSizeUpdate('sidebar', parseInt(e.target.value))}\n                    className=\"flex-1\"\n                  />\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {config.panelSizes.sidebar}%\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-xs\">–•–æ–ª—Å—Ç</Label>\n                <div className=\"flex items-center gap-2\">\n                  <input\n                    type=\"range\"\n                    min=\"30\"\n                    max=\"80\"\n                    value={config.panelSizes.canvas}\n                    onChange={(e) => handlePanelSizeUpdate('canvas', parseInt(e.target.value))}\n                    className=\"flex-1\"\n                  />\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {config.panelSizes.canvas}%\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-xs\">–ü–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤</Label>\n                <div className=\"flex items-center gap-2\">\n                  <input\n                    type=\"range\"\n                    min=\"15\"\n                    max=\"40\"\n                    value={config.panelSizes.properties}\n                    onChange={(e) => handlePanelSizeUpdate('properties', parseInt(e.target.value))}\n                    className=\"flex-1\"\n                  />\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {config.panelSizes.properties}%\n                  </Badge>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <Separator />\n\n          {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={onReset}\n              >\n                <RotateCcw className=\"h-4 w-4 mr-2\" />\n                –°–±—Ä–æ—Å\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setPreviewMode(!previewMode)}\n              >\n                <Maximize className=\"h-4 w-4 mr-2\" />\n                {previewMode ? '–°–∫—Ä—ã—Ç—å –ø—Ä–µ–≤—å—é' : '–ü—Ä–µ–≤—å—é'}\n              </Button>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsVisible(false)}\n              >\n                –û—Ç–º–µ–Ω–∞\n              </Button>\n              <Button\n                onClick={() => {\n                  onApply();\n                  setIsVisible(false);\n                }}\n              >\n                –ü—Ä–∏–º–µ–Ω–∏—Ç—å\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n// –•—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –º–∞–∫–µ—Ç–∞\nexport function useLayoutManager() {\n  const [config, setConfig] = useState<LayoutConfig>(() => {\n    const saved = localStorage.getItem('telegram-bot-builder-layout');\n    return saved ? JSON.parse(saved) : DEFAULT_LAYOUT;\n  });\n\n  const saveConfig = (newConfig: LayoutConfig) => {\n    setConfig(newConfig);\n    localStorage.setItem('telegram-bot-builder-layout', JSON.stringify(newConfig));\n  };\n\n  const resetConfig = () => {\n    setConfig(DEFAULT_LAYOUT);\n    localStorage.removeItem('telegram-bot-builder-layout');\n  };\n\n  const applyConfig = () => {\n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫\n    console.log('Applying layout config:', config);\n  };\n\n  return {\n    config,\n    updateConfig: saveConfig,\n    resetConfig,\n    applyConfig\n  };\n}","size_bytes":16279},"client/src/components/layout/layout-toggle-button.tsx":{"content":"import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Layout, \n  Settings, \n  Move, \n  Eye,\n  EyeOff,\n  ArrowUp,\n  ArrowDown,\n  ArrowLeft,\n  ArrowRight,\n  Grid\n} from 'lucide-react';\n\ninterface LayoutToggleButtonProps {\n  isEditing: boolean;\n  onToggle: () => void;\n  hasUnsavedChanges?: boolean;\n  elementsCount?: number;\n  className?: string;\n}\n\nexport const LayoutToggleButton: React.FC<LayoutToggleButtonProps> = ({\n  isEditing,\n  onToggle,\n  hasUnsavedChanges = false,\n  elementsCount = 4,\n  className = ''\n}) => {\n  return (\n    <TooltipProvider>\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            variant={isEditing ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={onToggle}\n            className={`relative ${className}`}\n          >\n            <Layout className=\"w-4 h-4 mr-2\" />\n            {isEditing ? '–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞–∫–µ—Ç–∞' : '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–∫–µ—Ç'}\n            \n            {hasUnsavedChanges && (\n              <div className=\"absolute -top-1 -right-1 w-2 h-2 bg-orange-500 rounded-full animate-pulse\" />\n            )}\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent>\n          <div className=\"text-sm\">\n            {isEditing ? (\n              <div>\n                <p className=\"font-medium\">–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞–∫–µ—Ç–∞\n                </p>\n              </div>\n            ) : (\n              <div>\n                <p className=\"font-medium\">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–µ–π –ø–∞–Ω–µ–ª–µ–π –∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏\n                </p>\n                <div className=\"flex items-center justify-between mt-2\">\n                  <span className=\"text-xs\">–≠–ª–µ–º–µ–Ω—Ç–æ–≤:</span>\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    {elementsCount}\n                  </Badge>\n                </div>\n              </div>\n            )}\n          </div>\n        </TooltipContent>\n      </Tooltip>\n    </TooltipProvider>\n  );\n};\n\ninterface QuickLayoutControlsProps {\n  onMoveHeader: (position: 'top' | 'bottom') => void;\n  onToggleSidebar: () => void;\n  onToggleProperties: () => void;\n  onResetLayout: () => void;\n  headerPosition: 'top' | 'bottom';\n  sidebarVisible: boolean;\n  propertiesVisible: boolean;\n  className?: string;\n}\n\nexport const QuickLayoutControls: React.FC<QuickLayoutControlsProps> = ({\n  onMoveHeader,\n  onToggleSidebar,\n  onToggleProperties,\n  onResetLayout,\n  headerPosition,\n  sidebarVisible,\n  propertiesVisible,\n  className = ''\n}) => {\n  return (\n    <div className={`flex items-center space-x-1 ${className}`}>\n      <TooltipProvider>\n        {/* –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —à–∞–ø–∫–∏ */}\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => onMoveHeader(headerPosition === 'top' ? 'bottom' : 'top')}\n            >\n              {headerPosition === 'top' ? (\n                <ArrowDown className=\"w-4 h-4\" />\n              ) : (\n                <ArrowUp className=\"w-4 h-4\" />\n              )}\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p className=\"text-xs\">\n              –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —à–∞–ø–∫—É {headerPosition === 'top' ? '–≤–Ω–∏–∑' : '–≤–≤–µ—Ä—Ö'}\n            </p>\n          </TooltipContent>\n        </Tooltip>\n\n        {/* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */}\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onToggleSidebar}\n            >\n              {sidebarVisible ? (\n                <EyeOff className=\"w-4 h-4\" />\n              ) : (\n                <Eye className=\"w-4 h-4\" />\n              )}\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p className=\"text-xs\">\n              {sidebarVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å\n            </p>\n          </TooltipContent>\n        </Tooltip>\n\n        {/* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —Å–≤–æ–π—Å—Ç–≤ */}\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onToggleProperties}\n            >\n              {propertiesVisible ? (\n                <ArrowRight className=\"w-4 h-4\" />\n              ) : (\n                <ArrowLeft className=\"w-4 h-4\" />\n              )}\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p className=\"text-xs\">\n              {propertiesVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤\n            </p>\n          </TooltipContent>\n        </Tooltip>\n\n        {/* –°–±—Ä–æ—Å –º–∞–∫–µ—Ç–∞ */}\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onResetLayout}\n            >\n              <Grid className=\"w-4 h-4\" />\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p className=\"text-xs\">–°–±—Ä–æ—Å–∏—Ç—å –º–∞–∫–µ—Ç –∫ —É–º–æ–ª—á–∞–Ω–∏—é</p>\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    </div>\n  );\n};\n\ninterface LayoutStatusIndicatorProps {\n  config: {\n    elements: Array<{\n      id: string;\n      type: string;\n      position: string;\n      visible: boolean;\n      size: number;\n    }>;\n    lastModified: Date;\n  };\n  className?: string;\n}\n\nexport const LayoutStatusIndicator: React.FC<LayoutStatusIndicatorProps> = ({\n  config,\n  className = ''\n}) => {\n  const visibleElements = config.elements.filter(el => el.visible);\n  const customized = config.elements.some(el => \n    (el.type === 'header' && el.position !== 'top') ||\n    (el.type === 'sidebar' && el.position !== 'left') ||\n    (el.type === 'properties' && el.position !== 'right') ||\n    !el.visible\n  );\n\n  return (\n    <div className={`flex items-center space-x-2 ${className}`}>\n      <div className=\"flex items-center space-x-1\">\n        {customized && (\n          <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-pulse\" />\n        )}\n        <span className=\"text-xs text-muted-foreground\">\n          {visibleElements.length}/{config.elements.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n        </span>\n      </div>\n      \n      <Badge variant={customized ? \"default\" : \"secondary\"} className=\"text-xs\">\n        {customized ? '–ù–∞—Å—Ç—Ä–æ–µ–Ω' : '–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é'}\n      </Badge>\n    </div>\n  );\n};","size_bytes":7048},"client/src/components/layout/layout-toggle-buttons.tsx":{"content":"import { Navigation, Sidebar, Sliders, Monitor } from 'lucide-react';\n\ninterface LayoutToggleButtonsProps {\n  onToggleHeader?: () => void;\n  onToggleSidebar?: () => void;\n  onToggleProperties?: () => void;\n  onToggleCanvas?: () => void;\n  headerVisible?: boolean;\n  sidebarVisible?: boolean;\n  propertiesVisible?: boolean;\n  canvasVisible?: boolean;\n}\n\nexport function LayoutToggleButtons({\n  onToggleHeader,\n  onToggleSidebar,\n  onToggleProperties,\n  onToggleCanvas,\n  headerVisible,\n  sidebarVisible,\n  propertiesVisible,\n  canvasVisible\n}: LayoutToggleButtonsProps) {\n  if (!(onToggleHeader || onToggleSidebar || onToggleProperties || onToggleCanvas)) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed top-4 right-4 z-50\">\n      <div className=\"flex items-center space-x-1 bg-white/90 dark:bg-slate-900/90 backdrop-blur-md rounded-lg shadow-lg border border-gray-200/50 dark:border-slate-700/50 p-1\">\n        {onToggleHeader && (\n          <button\n            onClick={onToggleHeader}\n            className={`p-2 rounded-md transition-all duration-200 ${\n              headerVisible \n                ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400' \n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700'\n            }`}\n            title={`${headerVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} —à–∞–ø–∫—É`}\n          >\n            <Navigation className=\"w-4 h-4\" />\n          </button>\n        )}\n        \n        {onToggleSidebar && (\n          <button\n            onClick={onToggleSidebar}\n            className={`p-2 rounded-md transition-all duration-200 ${\n              sidebarVisible \n                ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400' \n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700'\n            }`}\n            title={`${sidebarVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å`}\n          >\n            <Sidebar className=\"w-4 h-4\" />\n          </button>\n        )}\n        \n        {onToggleCanvas && (\n          <button\n            onClick={onToggleCanvas}\n            className={`p-2 rounded-md transition-all duration-200 ${\n              canvasVisible \n                ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400' \n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700'\n            }`}\n            title={`${canvasVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} —Ö–æ–ª—Å—Ç`}\n          >\n            <Monitor className=\"w-4 h-4\" />\n          </button>\n        )}\n        \n        {onToggleProperties && (\n          <button\n            onClick={onToggleProperties}\n            className={`p-2 rounded-md transition-all duration-200 ${\n              propertiesVisible \n                ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400' \n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700'\n            }`}\n            title={`${propertiesVisible ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤`}\n          >\n            <Sliders className=\"w-4 h-4\" />\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":3249},"client/src/components/layout/quick-layout-switcher.tsx":{"content":"import React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { \n  Layout, \n  ArrowUp, \n  ArrowDown, \n  ArrowLeft, \n  ArrowRight,\n  Grid,\n  Monitor,\n  Smartphone,\n  Tablet\n} from 'lucide-react';\n\nexport interface QuickLayoutPreset {\n  id: string;\n  name: string;\n  description: string;\n  icon: React.ReactNode;\n  config: {\n    headerPosition: 'top' | 'bottom' | 'left' | 'right';\n    sidebarPosition: 'left' | 'right';\n    propertiesPosition: 'right' | 'left';\n    headerSize: number;\n    sidebarSize: number;\n    propertiesSize: number;\n  };\n  preview: React.ReactNode;\n}\n\nconst LAYOUT_PRESETS: QuickLayoutPreset[] = [\n  {\n    id: 'default',\n    name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π',\n    description: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–≤–µ—Ä—Ö—É, –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–ª–µ–≤–∞, —Å–≤–æ–π—Å—Ç–≤–∞ —Å–ø—Ä–∞–≤–∞',\n    icon: <Monitor className=\"w-5 h-5\" />,\n    config: {\n      headerPosition: 'top',\n      sidebarPosition: 'left',\n      propertiesPosition: 'right',\n      headerSize: 60,\n      sidebarSize: 280,\n      propertiesSize: 320\n    },\n    preview: (\n      <div className=\"w-full h-20 border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800\">\n        <div className=\"h-3 bg-blue-200 dark:bg-blue-800\"></div>\n        <div className=\"flex h-17\">\n          <div className=\"w-1/4 bg-green-200 dark:bg-green-800\"></div>\n          <div className=\"flex-1 bg-gray-100 dark:bg-gray-700\"></div>\n          <div className=\"w-1/4 bg-orange-200 dark:bg-orange-800\"></div>\n        </div>\n      </div>\n    )\n  },\n  {\n    id: 'header-bottom',\n    name: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–Ω–∏–∑—É',\n    description: '–ù–µ–æ–±—ã—á–Ω—ã–π –º–∞–∫–µ—Ç —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞',\n    icon: <ArrowDown className=\"w-5 h-5\" />,\n    config: {\n      headerPosition: 'bottom',\n      sidebarPosition: 'left',\n      propertiesPosition: 'right',\n      headerSize: 60,\n      sidebarSize: 280,\n      propertiesSize: 320\n    },\n    preview: (\n      <div className=\"w-full h-20 border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800\">\n        <div className=\"flex h-17\">\n          <div className=\"w-1/4 bg-green-200 dark:bg-green-800\"></div>\n          <div className=\"flex-1 bg-gray-100 dark:bg-gray-700\"></div>\n          <div className=\"w-1/4 bg-orange-200 dark:bg-orange-800\"></div>\n        </div>\n        <div className=\"h-3 bg-blue-200 dark:bg-blue-800\"></div>\n      </div>\n    )\n  },\n  {\n    id: 'sidebar-right',\n    name: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞',\n    description: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞, —Å–≤–æ–π—Å—Ç–≤–∞ —Å–ª–µ–≤–∞',\n    icon: <ArrowRight className=\"w-5 h-5\" />,\n    config: {\n      headerPosition: 'top',\n      sidebarPosition: 'right',\n      propertiesPosition: 'left',\n      headerSize: 60,\n      sidebarSize: 280,\n      propertiesSize: 320\n    },\n    preview: (\n      <div className=\"w-full h-20 border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800\">\n        <div className=\"h-3 bg-blue-200 dark:bg-blue-800\"></div>\n        <div className=\"flex h-17\">\n          <div className=\"w-1/4 bg-orange-200 dark:bg-orange-800\"></div>\n          <div className=\"flex-1 bg-gray-100 dark:bg-gray-700\"></div>\n          <div className=\"w-1/4 bg-green-200 dark:bg-green-800\"></div>\n        </div>\n      </div>\n    )\n  },\n  {\n    id: 'header-left',\n    name: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ª–µ–≤–∞',\n    description: '–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ª–µ–≤–∞, –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –º–∞–∫–µ—Ç',\n    icon: <ArrowLeft className=\"w-5 h-5\" />,\n    config: {\n      headerPosition: 'left',\n      sidebarPosition: 'right',\n      propertiesPosition: 'right',\n      headerSize: 200,\n      sidebarSize: 280,\n      propertiesSize: 320\n    },\n    preview: (\n      <div className=\"w-full h-20 border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800\">\n        <div className=\"flex h-full\">\n          <div className=\"w-1/5 bg-blue-200 dark:bg-blue-800\"></div>\n          <div className=\"flex-1 bg-gray-100 dark:bg-gray-700\"></div>\n          <div className=\"w-1/4 bg-green-200 dark:bg-green-800\"></div>\n          <div className=\"w-1/4 bg-orange-200 dark:bg-orange-800\"></div>\n        </div>\n      </div>\n    )\n  },\n  {\n    id: 'compact',\n    name: '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π',\n    description: '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤',\n    icon: <Tablet className=\"w-5 h-5\" />,\n    config: {\n      headerPosition: 'top',\n      sidebarPosition: 'left',\n      propertiesPosition: 'right',\n      headerSize: 48,\n      sidebarSize: 240,\n      propertiesSize: 260\n    },\n    preview: (\n      <div className=\"w-full h-20 border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800\">\n        <div className=\"h-2 bg-blue-200 dark:bg-blue-800\"></div>\n        <div className=\"flex h-18\">\n          <div className=\"w-1/5 bg-green-200 dark:bg-green-800\"></div>\n          <div className=\"flex-1 bg-gray-100 dark:bg-gray-700\"></div>\n          <div className=\"w-1/5 bg-orange-200 dark:bg-orange-800\"></div>\n        </div>\n      </div>\n    )\n  },\n  {\n    id: 'mobile',\n    name: '–ú–æ–±–∏–ª—å–Ω—ã–π',\n    description: '–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤',\n    icon: <Smartphone className=\"w-5 h-5\" />,\n    config: {\n      headerPosition: 'top',\n      sidebarPosition: 'left',\n      propertiesPosition: 'right',\n      headerSize: 56,\n      sidebarSize: 200,\n      propertiesSize: 200\n    },\n    preview: (\n      <div className=\"w-full h-20 border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800\">\n        <div className=\"h-3 bg-blue-200 dark:bg-blue-800\"></div>\n        <div className=\"flex h-17\">\n          <div className=\"w-1/6 bg-green-200 dark:bg-green-800\"></div>\n          <div className=\"flex-1 bg-gray-100 dark:bg-gray-700\"></div>\n          <div className=\"w-1/6 bg-orange-200 dark:bg-orange-800\"></div>\n        </div>\n      </div>\n    )\n  }\n];\n\ninterface QuickLayoutSwitcherProps {\n  currentConfig?: any;\n  onLayoutChange: (config: any) => void;\n}\n\nconst QuickLayoutSwitcher: React.FC<QuickLayoutSwitcherProps> = ({\n  currentConfig,\n  onLayoutChange\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedPreset, setSelectedPreset] = useState<string>('default');\n\n  const handlePresetSelect = (preset: QuickLayoutPreset) => {\n    setSelectedPreset(preset.id);\n    \n    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø—Ä–µ—Å–µ—Ç –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–∞–∫–µ—Ç–∞\n    const layoutConfig = {\n      headerPosition: preset.config.headerPosition,\n      sidebarPosition: preset.config.sidebarPosition,\n      propertiesPosition: preset.config.propertiesPosition,\n      canvasFullscreen: false,\n      compactMode: preset.id === 'compact' || preset.id === 'mobile',\n      showGrid: true,\n      panelSizes: {\n        sidebar: preset.config.sidebarSize / 15, // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã\n        properties: preset.config.propertiesSize / 15,\n        canvas: 100 - (preset.config.sidebarSize / 15) - (preset.config.propertiesSize / 15)\n      }\n    };\n\n    onLayoutChange(layoutConfig);\n    setIsOpen(false);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n          <Layout className=\"w-4 h-4\" />\n          –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-4xl\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Grid className=\"w-5 h-5\" />\n            –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞–∫–µ—Ç–∞\n          </DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          <p className=\"text-sm text-muted-foreground\">\n            –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –º–∞–∫–µ—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n          </p>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {LAYOUT_PRESETS.map((preset) => (\n              <Card \n                key={preset.id}\n                className={`cursor-pointer transition-all duration-200 hover:shadow-md ${\n                  selectedPreset === preset.id \n                    ? 'ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/20' \n                    : 'hover:bg-gray-50 dark:hover:bg-gray-800'\n                }`}\n                onClick={() => handlePresetSelect(preset)}\n              >\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\n                      {preset.icon}\n                      {preset.name}\n                    </CardTitle>\n                    {selectedPreset === preset.id && (\n                      <Badge variant=\"default\" className=\"text-xs\">\n                        –í—ã–±—Ä–∞–Ω\n                      </Badge>\n                    )}\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    <p className=\"text-sm text-muted-foreground\">\n                      {preset.description}\n                    </p>\n                    \n                    <div className=\"space-y-2\">\n                      <div className=\"text-xs font-medium text-muted-foreground\">\n                        –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:\n                      </div>\n                      {preset.preview}\n                    </div>\n                    \n                    <Separator />\n                    \n                    <div className=\"space-y-1 text-xs text-muted-foreground\">\n                      <div className=\"flex justify-between\">\n                        <span>–ó–∞–≥–æ–ª–æ–≤–æ–∫:</span>\n                        <span className=\"capitalize\">{preset.config.headerPosition}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å:</span>\n                        <span className=\"capitalize\">{preset.config.sidebarPosition}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>–°–≤–æ–π—Å—Ç–≤–∞:</span>\n                        <span className=\"capitalize\">{preset.config.propertiesPosition}</span>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n          \n          <div className=\"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n            <div className=\"flex items-start gap-3\">\n              <Layout className=\"w-5 h-5 text-blue-600 mt-0.5\" />\n              <div>\n                <h4 className=\"font-medium text-blue-900 dark:text-blue-100\">\n                  –°–æ–≤–µ—Ç –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é\n                </h4>\n                <p className=\"text-sm text-blue-700 dark:text-blue-300 mt-1\">\n                  –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–∫–µ—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç.\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default QuickLayoutSwitcher;","size_bytes":11671},"client/src/components/layout/simple-layout-customizer.tsx":{"content":"import React, { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Slider } from '@/components/ui/slider';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Separator } from '@/components/ui/separator';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { \n  Layout, \n  Settings, \n  RotateCcw, \n  ArrowUp,\n  ArrowDown,\n  ArrowLeft,\n  ArrowRight,\n  Navigation,\n  Sidebar,\n  Monitor,\n  Sliders,\n  Grid,\n  Save,\n  Eye,\n  EyeOff,\n  Palette,\n  Zap,\n  Download,\n  Upload,\n  Maximize2,\n  Minimize2,\n  Move,\n  ArrowUpDown,\n  ArrowLeftRight,\n  LayoutDashboard,\n  Smartphone,\n  Tablet\n} from 'lucide-react';\n\nexport interface SimpleLayoutElement {\n  id: string;\n  type: 'header' | 'sidebar' | 'canvas' | 'properties';\n  name: string;\n  position: 'top' | 'bottom' | 'left' | 'right' | 'center';\n  size: number;\n  visible: boolean;\n}\n\nexport interface SimpleLayoutConfig {\n  elements: SimpleLayoutElement[];\n  compactMode: boolean;\n  showGrid: boolean;\n}\n\ninterface SimpleLayoutCustomizerProps {\n  config: SimpleLayoutConfig;\n  onConfigChange: (config: SimpleLayoutConfig) => void;\n  children?: React.ReactNode;\n}\n\nconst DEFAULT_CONFIG: SimpleLayoutConfig = {\n  elements: [\n    {\n      id: 'header',\n      type: 'header',\n      name: '–®–∞–ø–∫–∞',\n      position: 'top',\n      size: 64,\n      visible: true\n    },\n    {\n      id: 'sidebar',\n      type: 'sidebar',\n      name: '–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å',\n      position: 'left',\n      size: 20,\n      visible: true\n    },\n    {\n      id: 'canvas',\n      type: 'canvas',\n      name: '–•–æ–ª—Å—Ç',\n      position: 'center',\n      size: 55,\n      visible: true\n    },\n    {\n      id: 'properties',\n      type: 'properties',\n      name: '–°–≤–æ–π—Å—Ç–≤–∞',\n      position: 'right',\n      size: 25,\n      visible: true\n    }\n  ],\n  compactMode: false,\n  showGrid: true\n};\n\nexport const SimpleLayoutCustomizer: React.FC<SimpleLayoutCustomizerProps> = ({\n  config,\n  onConfigChange,\n  children\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [tempConfig, setTempConfig] = useState<SimpleLayoutConfig>(config);\n\n  const handleElementUpdate = useCallback((elementId: string, updates: Partial<SimpleLayoutElement>) => {\n    setTempConfig(prev => ({\n      ...prev,\n      elements: prev.elements.map(element =>\n        element.id === elementId\n          ? { ...element, ...updates }\n          : element\n      )\n    }));\n  }, []);\n\n  const handleApply = useCallback(() => {\n    onConfigChange(tempConfig);\n    setIsOpen(false);\n  }, [tempConfig, onConfigChange]);\n\n  const handleCancel = useCallback(() => {\n    setTempConfig(config);\n    setIsOpen(false);\n  }, [config]);\n\n  const handleReset = useCallback(() => {\n    setTempConfig(DEFAULT_CONFIG);\n  }, []);\n\n\n\n  const getIcon = (type: string) => {\n    switch (type) {\n      case 'header':\n        return <Navigation className=\"w-4 h-4\" />;\n      case 'sidebar':\n        return <Sidebar className=\"w-4 h-4\" />;\n      case 'canvas':\n        return <Monitor className=\"w-4 h-4\" />;\n      case 'properties':\n        return <Sliders className=\"w-4 h-4\" />;\n      default:\n        return <Layout className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getPositionIcon = (position: string) => {\n    switch (position) {\n      case 'top':\n        return <ArrowUp className=\"w-3 h-3\" />;\n      case 'bottom':\n        return <ArrowDown className=\"w-3 h-3\" />;\n      case 'left':\n        return <ArrowLeft className=\"w-3 h-3\" />;\n      case 'right':\n        return <ArrowRight className=\"w-3 h-3\" />;\n      case 'center':\n        return <Grid className=\"w-3 h-3\" />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"relative\">\n      {/* –î–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–µ–∫ - —Å–∫—Ä—ã—Ç, –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ */}\n      <div className=\"hidden\">\n        <Dialog open={isOpen} onOpenChange={setIsOpen}>\n          <DialogTrigger asChild>\n            <div />\n          </DialogTrigger>\n          <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-hidden\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <LayoutDashboard className=\"w-5 h-5\" />\n                –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞–∫–µ—Ç–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n              </DialogTitle>\n            </DialogHeader>\n            \n            <div className=\"flex h-[700px] gap-6\">\n              {/* –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ */}\n              <div className=\"w-96 flex flex-col\">\n                <Tabs defaultValue=\"elements\" className=\"flex-1 flex flex-col\">\n                  <TabsList className=\"grid w-full grid-cols-3\">\n                    <TabsTrigger value=\"elements\" className=\"flex items-center gap-1\">\n                      <Layout className=\"w-4 h-4\" />\n                      –≠–ª–µ–º–µ–Ω—Ç—ã\n                    </TabsTrigger>\n                    <TabsTrigger value=\"presets\" className=\"flex items-center gap-1\">\n                      <Zap className=\"w-4 h-4\" />\n                      –ü—Ä–µ—Å–µ—Ç—ã\n                    </TabsTrigger>\n                    <TabsTrigger value=\"advanced\" className=\"flex items-center gap-1\">\n                      <Settings className=\"w-4 h-4\" />\n                      –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ\n                    </TabsTrigger>\n                  </TabsList>\n\n                  <TabsContent value=\"elements\" className=\"flex-1 overflow-auto space-y-4 mt-4\">\n                    {/* –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */}\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <LayoutDashboard className=\"w-4 h-4\" />\n                        <h3 className=\"font-semibold\">–≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h3>\n                      </div>\n                      {tempConfig.elements.map(element => (\n                      <Card key={element.id} className=\"p-3\">\n                        <div className=\"space-y-3\">\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center space-x-2\">\n                              {getIcon(element.type)}\n                              <span className=\"font-medium\">{element.name}</span>\n                            </div>\n                            <Switch\n                              checked={element.visible}\n                              onCheckedChange={(checked) => \n                                handleElementUpdate(element.id, { visible: checked })\n                              }\n                            />\n                          </div>\n                          \n                          {element.visible && (\n                            <div className=\"space-y-2\">\n                              <div>\n                                <Label className=\"text-sm\">–ü–æ–∑–∏—Ü–∏—è</Label>\n                                <Select\n                                  value={element.position}\n                                  onValueChange={(value) => \n                                    handleElementUpdate(element.id, { position: value as any })\n                                  }\n                                >\n                                  <SelectTrigger className=\"w-full\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"top\">–°–≤–µ—Ä—Ö—É</SelectItem>\n                                    <SelectItem value=\"bottom\">–°–Ω–∏–∑—É</SelectItem>\n                                    <SelectItem value=\"left\">–°–ª–µ–≤–∞</SelectItem>\n                                    <SelectItem value=\"right\">–°–ø—Ä–∞–≤–∞</SelectItem>\n                                    <SelectItem value=\"center\">–¶–µ–Ω—Ç—Ä</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                              \n                              <div>\n                                <Label className=\"text-sm\">–†–∞–∑–º–µ—Ä: {element.size}%</Label>\n                                <Slider\n                                  value={[element.size]}\n                                  onValueChange={(value) => \n                                    handleElementUpdate(element.id, { size: value[0] })\n                                  }\n                                  max={80}\n                                  min={5}\n                                  step={5}\n                                  className=\"w-full\"\n                                />\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      </Card>\n                    ))}\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"presets\" className=\"flex-1 overflow-auto space-y-4 mt-4\">\n                    {/* –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã */}\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Zap className=\"w-4 h-4\" />\n                        <h3 className=\"font-semibold\">–ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã</h3>\n                      </div>\n                      <div className=\"grid grid-cols-1 gap-3\">\n                        <Card className=\"p-4 cursor-pointer hover:bg-accent transition-colors\" onClick={() => {\n                          const preset = {\n                            ...tempConfig,\n                            elements: tempConfig.elements.map(el => ({\n                              ...el,\n                              position: (el.type === 'header' ? 'bottom' : el.position) as SimpleLayoutElement['position']\n                            }))\n                          };\n                          setTempConfig(preset);\n                        }}>\n                          <div className=\"flex items-center gap-3\">\n                            <ArrowDown className=\"w-5 h-5 text-blue-500\" />\n                            <div>\n                              <h4 className=\"font-medium\">–®–∞–ø–∫–∞ —Å–Ω–∏–∑—É</h4>\n                              <p className=\"text-sm text-muted-foreground\">–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –Ω–∏–∂–Ω—é—é —á–∞—Å—Ç—å</p>\n                            </div>\n                          </div>\n                        </Card>\n\n                        <Card className=\"p-4 cursor-pointer hover:bg-accent transition-colors\" onClick={() => {\n                          const preset = {\n                            ...tempConfig,\n                            elements: tempConfig.elements.map(el => ({\n                              ...el,\n                              visible: el.type === 'canvas' || el.type === 'header'\n                            }))\n                          };\n                          setTempConfig(preset);\n                        }}>\n                          <div className=\"flex items-center gap-3\">\n                            <Minimize2 className=\"w-5 h-5 text-green-500\" />\n                            <div>\n                              <h4 className=\"font-medium\">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</h4>\n                              <p className=\"text-sm text-muted-foreground\">–¢–æ–ª—å–∫–æ —Ö–æ–ª—Å—Ç –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫</p>\n                            </div>\n                          </div>\n                        </Card>\n\n                        <Card className=\"p-4 cursor-pointer hover:bg-accent transition-colors\" onClick={() => {\n                          const preset = {\n                            ...tempConfig,\n                            elements: tempConfig.elements.map(el => ({\n                              ...el,\n                              visible: true,\n                              position: (el.type === 'header' ? 'top' : \n                                       el.type === 'sidebar' ? 'left' :\n                                       el.type === 'properties' ? 'right' : 'center') as SimpleLayoutElement['position']\n                            }))\n                          };\n                          setTempConfig(preset);\n                        }}>\n                          <div className=\"flex items-center gap-3\">\n                            <Maximize2 className=\"w-5 h-5 text-purple-500\" />\n                            <div>\n                              <h4 className=\"font-medium\">–ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º</h4>\n                              <p className=\"text-sm text-muted-foreground\">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–∞–Ω–µ–ª–∏</p>\n                            </div>\n                          </div>\n                        </Card>\n                      </div>\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"advanced\" className=\"flex-1 overflow-auto space-y-4 mt-4\">\n                    {/* –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */}\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Settings className=\"w-4 h-4\" />\n                        <h3 className=\"font-semibold\">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>\n                      </div>\n\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Switch\n                            id=\"compact\"\n                            checked={tempConfig.compactMode}\n                            onCheckedChange={(checked) => \n                              setTempConfig(prev => ({ ...prev, compactMode: checked }))\n                            }\n                          />\n                          <Label htmlFor=\"compact\">–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º</Label>\n                        </div>\n                        \n                        <div className=\"flex items-center space-x-2\">\n                          <Switch\n                            id=\"grid\"\n                            checked={tempConfig.showGrid}\n                            onCheckedChange={(checked) => \n                              setTempConfig(prev => ({ ...prev, showGrid: checked }))\n                            }\n                          />\n                          <Label htmlFor=\"grid\">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–µ—Ç–∫—É</Label>\n                        </div>\n                      </div>\n\n                      <Separator />\n\n                      <div className=\"space-y-3\">\n                        <h4 className=\"font-medium flex items-center gap-2\">\n                          <Palette className=\"w-4 h-4\" />\n                          –≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç\n                        </h4>\n                        <div className=\"flex gap-2\">\n                          <Button variant=\"outline\" size=\"sm\" className=\"flex-1\">\n                            <Download className=\"w-4 h-4 mr-2\" />\n                            –≠–∫—Å–ø–æ—Ä—Ç\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"flex-1\">\n                            <Upload className=\"w-4 h-4 mr-2\" />\n                            –ò–º–ø–æ—Ä—Ç\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  </TabsContent>\n                  {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}\n                  <div className=\"flex items-center justify-between border-t pt-4 mt-4\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleReset}\n                  >\n                    <RotateCcw className=\"w-4 h-4 mr-2\" />\n                    –°–±—Ä–æ—Å\n                  </Button>\n                  <div className=\"flex items-center space-x-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={handleCancel}\n                    >\n                      –û—Ç–º–µ–Ω–∞\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleApply}\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      –ü—Ä–∏–º–µ–Ω–∏—Ç—å\n                    </Button>\n                  </div>\n                  </div>\n                </Tabs>\n              </div>\n              \n              {/* –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä */}\n              <div className=\"flex-1 bg-gray-50 dark:bg-gray-900 rounded-lg p-4\">\n                <div className=\"h-full border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg relative\">\n                  <div className=\"absolute top-2 left-2 bg-white dark:bg-gray-800 px-2 py-1 rounded text-xs font-medium\">\n                    –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä\n                  </div>\n                  <div className=\"h-full p-6 pt-10\">\n                    <div className=\"h-full grid gap-2\" style={{\n                      gridTemplateAreas: `\n                        \"${tempConfig.elements.find(e => e.position === 'top' && e.visible)?.id || '.'}\"\n                        \"${tempConfig.elements.find(e => e.position === 'left' && e.visible)?.id || '.'} ${tempConfig.elements.find(e => e.position === 'center' && e.visible)?.id || '.'} ${tempConfig.elements.find(e => e.position === 'right' && e.visible)?.id || '.'}\"\n                        \"${tempConfig.elements.find(e => e.position === 'bottom' && e.visible)?.id || '.'}\"\n                      `,\n                      gridTemplateRows: `${tempConfig.elements.find(e => e.position === 'top' && e.visible)?.size || 0}px 1fr ${tempConfig.elements.find(e => e.position === 'bottom' && e.visible)?.size || 0}px`,\n                      gridTemplateColumns: `${tempConfig.elements.find(e => e.position === 'left' && e.visible)?.size || 0}px 1fr ${tempConfig.elements.find(e => e.position === 'right' && e.visible)?.size || 0}px`,\n                    }}>\n                      {tempConfig.elements.filter(e => e.visible).map(element => (\n                        <div\n                          key={element.id}\n                          style={{ gridArea: element.id }}\n                          className=\"border border-gray-200 dark:border-gray-700 rounded flex items-center justify-center bg-white dark:bg-gray-800\"\n                        >\n                          <div className=\"text-center\">\n                            {getIcon(element.type)}\n                            <p className=\"text-xs font-medium mt-1\">{element.name}</p>\n                            <div className=\"flex items-center justify-center mt-1\">\n                              {getPositionIcon(element.position)}\n                              <span className=\"text-xs ml-1\">{element.size}%</span>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n\n\n      {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}\n      <div className=\"h-screen\">\n        {children}\n      </div>\n    </div>\n  );\n};\n\nexport default SimpleLayoutCustomizer;","size_bytes":19754},"client/src/components/media/camera-capture.tsx":{"content":"import React, { useState, useRef, useCallback } from 'react';\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useUploadMedia } from \"@/hooks/use-media\";\nimport { Camera, X, RotateCcw, Zap, Loader2 } from \"lucide-react\";\n\ninterface CameraCaptureProps {\n  projectId: number;\n  onCapture?: (file: File) => void;\n  onClose?: () => void;\n  isOpen: boolean;\n}\n\nexport function CameraCapture({ projectId, onCapture, onClose, isOpen }: CameraCaptureProps) {\n  const { toast } = useToast();\n  const uploadMutation = useUploadMedia(projectId);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  \n  const [isStreaming, setIsStreaming] = useState(false);\n  const [capturedImage, setCapturedImage] = useState<string | null>(null);\n  const [facing, setFacing] = useState<'user' | 'environment'>('environment');\n\n  const startCamera = useCallback(async () => {\n    try {\n      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ—Ç–æ–∫, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: facing,\n          width: { ideal: 1280 },\n          height: { ideal: 720 }\n        },\n        audio: false\n      });\n\n      streamRef.current = stream;\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        videoRef.current.play();\n        setIsStreaming(true);\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.\",\n        variant: \"destructive\",\n      });\n    }\n  }, [facing, toast]);\n\n  const stopCamera = useCallback(() => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    setIsStreaming(false);\n    setCapturedImage(null);\n  }, []);\n\n  const capturePhoto = useCallback(() => {\n    if (videoRef.current && canvasRef.current) {\n      const video = videoRef.current;\n      const canvas = canvasRef.current;\n      const context = canvas.getContext('2d');\n\n      if (context) {\n        canvas.width = video.videoWidth;\n        canvas.height = video.videoHeight;\n        context.drawImage(video, 0, 0, canvas.width, canvas.height);\n        \n        const dataUrl = canvas.toDataURL('image/jpeg', 0.8);\n        setCapturedImage(dataUrl);\n      }\n    }\n  }, []);\n\n  const retakePhoto = useCallback(() => {\n    setCapturedImage(null);\n  }, []);\n\n  const switchCamera = useCallback(() => {\n    setFacing(prev => prev === 'user' ? 'environment' : 'user');\n    setCapturedImage(null);\n    if (isStreaming) {\n      startCamera();\n    }\n  }, [isStreaming, startCamera]);\n\n  const savePhoto = useCallback(async () => {\n    if (capturedImage && canvasRef.current) {\n      try {\n        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º canvas –≤ Blob\n        canvasRef.current.toBlob(async (blob) => {\n          if (blob) {\n            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n            const file = new File([blob], `camera-photo-${timestamp}.jpg`, {\n              type: 'image/jpeg',\n              lastModified: Date.now()\n            });\n\n            if (onCapture) {\n              onCapture(file);\n            } else {\n              // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É—é\n              uploadMutation.mutate({\n                file,\n                description: '–§–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã',\n                tags: ['–∫–∞–º–µ—Ä–∞', '—Ñ–æ—Ç–æ']\n              }, {\n                onSuccess: () => {\n                  toast({\n                    title: \"–§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ\",\n                    description: \"–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É\",\n                  });\n                  handleClose();\n                },\n                onError: (error) => {\n                  toast({\n                    title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n                    description: error.message,\n                    variant: \"destructive\",\n                  });\n                }\n              });\n            }\n          }\n        }, 'image/jpeg', 0.8);\n      } catch (error) {\n        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ:', error);\n        toast({\n          title: \"–û—à–∏–±–∫–∞\",\n          description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ç–æ\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  }, [capturedImage, onCapture, uploadMutation, toast]);\n\n  const handleClose = useCallback(() => {\n    stopCamera();\n    if (onClose) {\n      onClose();\n    }\n  }, [stopCamera, onClose]);\n\n  // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–∏–∞–ª–æ–≥–∞\n  React.useEffect(() => {\n    if (isOpen && !isStreaming && !capturedImage) {\n      startCamera();\n    } else if (!isOpen) {\n      stopCamera();\n    }\n  }, [isOpen, isStreaming, capturedImage, startCamera, stopCamera]);\n\n  // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏\n  React.useEffect(() => {\n    return () => {\n      stopCamera();\n    };\n  }, [stopCamera]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Camera className=\"w-5 h-5\" />\n            –°—ä–µ–º–∫–∞ —Å –∫–∞–º–µ—Ä—ã\n          </DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          {/* Camera Preview */}\n          <div className=\"relative bg-black rounded-lg overflow-hidden aspect-video\">\n            {!capturedImage ? (\n              <>\n                <video\n                  ref={videoRef}\n                  className=\"w-full h-full object-cover\"\n                  autoPlay\n                  playsInline\n                  muted\n                />\n                {isStreaming && (\n                  <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-2\">\n                    <Button\n                      onClick={switchCamera}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"rounded-full w-10 h-10 p-0\"\n                    >\n                      <RotateCcw className=\"w-4 h-4\" />\n                    </Button>\n                    <Button\n                      onClick={capturePhoto}\n                      className=\"rounded-full w-16 h-16 bg-white border-4 border-white hover:bg-gray-100\"\n                    >\n                      <div className=\"w-full h-full rounded-full bg-white\" />\n                    </Button>\n                  </div>\n                )}\n              </>\n            ) : (\n              <img\n                src={capturedImage}\n                alt=\"Captured\"\n                className=\"w-full h-full object-cover\"\n              />\n            )}\n            \n            {!isStreaming && !capturedImage && (\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <Button onClick={startCamera} className=\"flex items-center gap-2\">\n                  <Camera className=\"w-4 h-4\" />\n                  –í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É\n                </Button>\n              </div>\n            )}\n          </div>\n\n          {/* Hidden Canvas */}\n          <canvas ref={canvasRef} className=\"hidden\" />\n\n          {/* Controls */}\n          {capturedImage && (\n            <div className=\"flex justify-between gap-2\">\n              <Button\n                onClick={retakePhoto}\n                variant=\"outline\"\n                className=\"flex-1\"\n              >\n                –ü–µ—Ä–µ—Å–Ω—è—Ç—å\n              </Button>\n              <Button\n                onClick={savePhoto}\n                disabled={uploadMutation.isPending}\n                className=\"flex-1 flex items-center gap-2\"\n              >\n                {uploadMutation.isPending ? (\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                ) : (\n                  <Zap className=\"w-4 h-4\" />\n                )}\n                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n              </Button>\n            </div>\n          )}\n\n          {/* Info */}\n          <div className=\"text-xs text-gray-500 text-center\">\n            {!isStreaming && !capturedImage && \"–ù–∞–∂–º–∏—Ç–µ '–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É' –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å—ä–µ–º–∫–∏\"}\n            {isStreaming && !capturedImage && \"–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±–µ–ª—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è —Å—ä–µ–º–∫–∏\"}\n            {capturedImage && \"–§–æ—Ç–æ –≥–æ—Ç–æ–≤–æ! –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Å–Ω–∏–º–∏—Ç–µ\"}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":9078},"client/src/components/media/enhanced-media-uploader.tsx":{"content":"import React, { useState, useCallback } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useUploadMedia, useUploadMultipleMedia } from \"@/hooks/use-media\";\nimport { FileOptimizer } from \"./file-optimizer\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { \n  Upload, \n  X, \n  FileImage, \n  FileVideo, \n  FileAudio, \n  FileText,\n  AlertTriangle,\n  CheckCircle2,\n  Loader2,\n  Eye,\n  Trash2,\n  Tag,\n  Settings,\n  Zap\n} from \"lucide-react\";\nimport type { MediaFile } from \"@shared/schema\";\n\ninterface FileWithPreview extends File {\n  preview?: string;\n  id: string;\n  uploadProgress?: number;\n  uploadStatus?: 'pending' | 'uploading' | 'success' | 'error';\n  uploadError?: string;\n}\n\ninterface EnhancedMediaUploaderProps {\n  projectId: number;\n  onUploadComplete?: (files: MediaFile[]) => void;\n  onClose?: () => void;\n  maxFiles?: number;\n  acceptedTypes?: string[];\n}\n\nexport function EnhancedMediaUploader({ \n  projectId, \n  onUploadComplete, \n  onClose,\n  maxFiles = 20,\n  acceptedTypes = [\n    'image/*', \n    'video/*', \n    'audio/*', \n    '.pdf', \n    '.doc', \n    '.docx',\n    '.txt',\n    '.xls',\n    '.xlsx',\n    '.zip',\n    '.rar',\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'text/plain'\n  ]\n}: EnhancedMediaUploaderProps) {\n  const { toast } = useToast();\n  const [files, setFiles] = useState<FileWithPreview[]>([]);\n  const [isPublic, setIsPublic] = useState(false);\n  const [defaultDescription, setDefaultDescription] = useState('');\n  const [defaultTags, setDefaultTags] = useState('');\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [showAdvanced, setShowAdvanced] = useState(false);\n  const [showOptimizer, setShowOptimizer] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n\n  const uploadSingleMutation = useUploadMedia(projectId);\n  const uploadMultipleMutation = useUploadMultipleMedia(projectId);\n\n  // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞\n  const validateFile = useCallback((file: File): string | null => {\n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞\n    const maxSizes = {\n      'image': 25 * 1024 * 1024, // 25MB\n      'video': 200 * 1024 * 1024, // 200MB\n      'audio': 100 * 1024 * 1024, // 100MB\n      'application': 50 * 1024 * 1024, // 50MB\n      'text': 10 * 1024 * 1024 // 10MB\n    };\n\n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è\n    const supportedExtensions = [\n      '.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg', '.bmp', // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n      '.mp4', '.webm', '.avi', '.mov', '.mkv', // –í–∏–¥–µ–æ\n      '.mp3', '.wav', '.ogg', '.aac', '.flac', '.m4a', // –ê—É–¥–∏–æ\n      '.pdf', '.doc', '.docx', '.txt', '.xls', '.xlsx', '.zip', '.rar' // –î–æ–∫—É–º–µ–Ω—Ç—ã\n    ];\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞\n    const extension = '.' + file.name.split('.').pop()?.toLowerCase();\n    if (!supportedExtensions.includes(extension)) {\n      return `–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: ${extension}. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã`;\n    }\n\n    const fileType = file.type.split('/')[0];\n    const maxSize = maxSizes[fileType as keyof typeof maxSizes] || maxSizes.application;\n\n    if (file.size > maxSize) {\n      const maxSizeMB = Math.round(maxSize / (1024 * 1024));\n      return `–§–∞–π–ª \"${file.name}\" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è ${fileType}: ${maxSizeMB}–ú–ë`;\n    }\n\n    if (file.name.length > 255) {\n      return '–ò–º—è —Ñ–∞–π–ª–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å–∏–º—É–º 255 —Å–∏–º–≤–æ–ª–æ–≤)';\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞\n    const dangerousChars = /[<>:\"|?*]/;\n    if (dangerousChars.test(file.name)) {\n      return '–ò–º—è —Ñ–∞–π–ª–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã: < > : \" | ? *';\n    }\n\n    return null;\n  }, []);\n\n  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤\n  const onDrop = useCallback((acceptedFiles: File[], rejectedFiles: any[]) => {\n    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\n    rejectedFiles.forEach(({ file, errors }) => {\n      errors.forEach((error: any) => {\n        toast({\n          title: \"–§–∞–π–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω\",\n          description: `${file.name}: ${error.message}`,\n          variant: \"destructive\",\n        });\n      });\n    });\n\n    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–∏–Ω—è—Ç—ã–µ —Ñ–∞–π–ª—ã\n    const newFiles: FileWithPreview[] = acceptedFiles.map(file => {\n      const validationError = validateFile(file);\n      if (validationError) {\n        toast({\n          title: \"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\",\n          description: `${file.name}: ${validationError}`,\n          variant: \"destructive\",\n        });\n        return null;\n      }\n\n      // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤\n      let preview = undefined;\n      if (file.type.startsWith('image/')) {\n        preview = URL.createObjectURL(file);\n      } else if (file.type.startsWith('video/')) {\n        // –î–ª—è –≤–∏–¥–µ–æ —Å–æ–∑–¥–∞–µ–º thumbnail —á–µ—Ä–µ–∑ canvas (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ)\n        preview = undefined; // TODO: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è thumbnail –¥–ª—è –≤–∏–¥–µ–æ\n      }\n\n      return {\n        ...file,\n        preview,\n        id: Math.random().toString(36).substr(2, 9),\n        uploadStatus: 'pending' as const,\n        uploadProgress: 0\n      };\n    }).filter(Boolean) as FileWithPreview[];\n\n    if (files.length + newFiles.length > maxFiles) {\n      toast({\n        title: \"–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤\",\n        description: `–ú–∞–∫—Å–∏–º—É–º ${maxFiles} —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setFiles(prev => [...prev, ...newFiles]);\n  }, [files.length, maxFiles, validateFile, toast]);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: acceptedTypes.reduce((acc, type) => {\n      acc[type] = [];\n      return acc;\n    }, {} as Record<string, string[]>),\n    maxFiles: maxFiles - files.length,\n    multiple: true\n  });\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞\n  const removeFile = useCallback((fileId: string) => {\n    setFiles(prev => {\n      const updated = prev.filter(f => f.id !== fileId);\n      // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º memory –¥–ª—è –ø—Ä–µ–≤—å—é\n      const removedFile = prev.find(f => f.id === fileId);\n      if (removedFile?.preview) {\n        URL.revokeObjectURL(removedFile.preview);\n      }\n      return updated;\n    });\n  }, []);\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ —Ñ–∞–π–ª–∞\n  const getFileIcon = (file: File) => {\n    const type = file.type.split('/')[0];\n    switch (type) {\n      case 'image': return <FileImage className=\"w-5 h-5\" />;\n      case 'video': return <FileVideo className=\"w-5 h-5\" />;\n      case 'audio': return <FileAudio className=\"w-5 h-5\" />;\n      default: return <FileText className=\"w-5 h-5\" />;\n    }\n  };\n\n  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤\n  const handleUpload = async () => {\n    if (files.length === 0) return;\n\n    setIsUploading(true);\n    setUploadProgress(0);\n\n    try {\n      const tags = defaultTags.split(',').map(tag => tag.trim()).filter(Boolean);\n\n      if (files.length === 1) {\n        // –û–¥–∏–Ω–æ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞\n        const file = files[0];\n        setFiles(prev => prev.map(f => \n          f.id === file.id \n            ? { ...f, uploadStatus: 'uploading', uploadProgress: 0 }\n            : f\n        ));\n\n        const result = await uploadSingleMutation.mutateAsync({\n          file,\n          description: defaultDescription,\n          tags,\n          isPublic,\n          onProgress: (progress) => {\n            setUploadProgress(progress);\n            setFiles(prev => prev.map(f => \n              f.id === file.id \n                ? { ...f, uploadProgress: progress }\n                : f\n            ));\n          }\n        });\n\n        setFiles(prev => prev.map(f => \n          f.id === file.id \n            ? { ...f, uploadStatus: 'success', uploadProgress: 100 }\n            : f\n        ));\n\n        toast({\n          title: \"–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω\",\n          description: `${file.name} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`,\n        });\n\n        onUploadComplete?.([result]);\n      } else {\n        // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞\n        setFiles(prev => prev.map(f => ({ ...f, uploadStatus: 'uploading', uploadProgress: 0 })));\n\n        const result = await uploadMultipleMutation.mutateAsync({\n          files,\n          defaultDescription,\n          isPublic,\n          onProgress: (progress) => {\n            setUploadProgress(progress);\n            setFiles(prev => prev.map(f => ({ ...f, uploadProgress: progress })));\n          }\n        });\n\n        setFiles(prev => prev.map(f => ({ ...f, uploadStatus: 'success', uploadProgress: 100 })));\n\n        toast({\n          title: \"–§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã\",\n          description: `–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${result.success} –∏–∑ ${files.length} —Ñ–∞–π–ª–æ–≤`,\n        });\n\n        if (result.errors > 0) {\n          result.errorDetails.forEach((error: any) => {\n            toast({\n              title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n              description: `${error.fileName}: ${error.error}`,\n              variant: \"destructive\",\n            });\n          });\n        }\n\n        onUploadComplete?.(result.uploadedFiles);\n      }\n\n      // –û—á–∏—â–∞–µ–º —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏\n      setTimeout(() => {\n        setFiles([]);\n        onClose?.();\n      }, 2000);\n\n    } catch (error) {\n      console.error('Upload error:', error);\n      setFiles(prev => prev.map(f => ({ \n        ...f, \n        uploadStatus: 'error', \n        uploadError: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'\n      })));\n      \n      toast({\n        title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n        description: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsUploading(false);\n      setUploadProgress(0);\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-xl font-semibold\">–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤</h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n          </p>\n        </div>\n        {onClose && (\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n            <X className=\"w-4 h-4\" />\n          </Button>\n        )}\n      </div>\n\n      {/* –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */}\n      <div\n        {...getRootProps()}\n        className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer ${\n          isDragActive \n            ? 'border-blue-500 bg-blue-50 dark:bg-blue-950/20' \n            : 'border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500'\n        }`}\n      >\n        <input {...getInputProps()} />\n        <Upload className=\"w-12 h-12 mx-auto mb-4 text-gray-400\" />\n        {isDragActive ? (\n          <div>\n            <p className=\"text-lg font-medium text-blue-600 dark:text-blue-400\">\n              –û—Ç–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã –∑–¥–µ—Å—å\n            </p>\n            <p className=\"text-sm text-blue-500\">\n              –§–∞–π–ª—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏\n            </p>\n          </div>\n        ) : (\n          <div>\n            <p className=\"text-lg font-medium text-gray-600 dark:text-gray-400 mb-2\">\n              –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞\n            </p>\n            <p className=\"text-sm text-gray-500\">\n              –ú–∞–∫—Å–∏–º—É–º {maxFiles} —Ñ–∞–π–ª–æ–≤, –¥–æ 200–ú–ë –¥–ª—è –≤–∏–¥–µ–æ, 25–ú–ë –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\n            </p>\n            <div className=\"flex flex-wrap gap-2 mt-2 text-xs text-muted-foreground\">\n              <span className=\"bg-blue-100 dark:bg-blue-900 px-2 py-1 rounded\">üì∑ JPG, PNG, GIF</span>\n              <span className=\"bg-green-100 dark:bg-green-900 px-2 py-1 rounded\">üé¨ MP4, WebM</span>\n              <span className=\"bg-orange-100 dark:bg-orange-900 px-2 py-1 rounded\">üéµ MP3, WAV</span>\n              <span className=\"bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded\">üìÑ PDF, DOC, TXT</span>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ */}\n      {files.length > 0 && (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-base font-medium\">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏</Label>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowPreview(true)}\n                className=\"flex items-center\"\n              >\n                <Eye className=\"w-4 h-4 mr-2\" />\n                –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowOptimizer(true)}\n                className=\"flex items-center\"\n              >\n                <Zap className=\"w-4 h-4 mr-2\" />\n                –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowAdvanced(!showAdvanced)}\n              >\n                <Settings className=\"w-4 h-4 mr-2\" />\n                {showAdvanced ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'} –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</Label>\n              <Textarea\n                id=\"description\"\n                placeholder=\"–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤...\"\n                value={defaultDescription}\n                onChange={(e) => setDefaultDescription(e.target.value)}\n                rows={3}\n              />\n            </div>\n\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tags\">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</Label>\n                <Input\n                  id=\"tags\"\n                  placeholder=\"—Ç–µ–≥1, —Ç–µ–≥2, —Ç–µ–≥3...\"\n                  value={defaultTags}\n                  onChange={(e) => setDefaultTags(e.target.value)}\n                />\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"public\"\n                  checked={isPublic}\n                  onCheckedChange={setIsPublic}\n                />\n                <Label htmlFor=\"public\">–°–¥–µ–ª–∞—Ç—å —Ñ–∞–π–ª—ã –ø—É–±–ª–∏—á–Ω—ã–º–∏</Label>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* –°–≤–æ–¥–∫–∞ –ø–æ —Ñ–∞–π–ª–∞–º */}\n      {files.length > 0 && (\n        <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-base font-medium\">\n              –§–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ ({files.length})\n            </Label>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setFiles([])}\n              disabled={isUploading}\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ\n            </Button>\n          </div>\n          \n          {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤ */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs\">\n            {(() => {\n              const stats = files.reduce((acc, file) => {\n                const type = file.type.split('/')[0];\n                acc[type] = (acc[type] || 0) + 1;\n                return acc;\n              }, {} as Record<string, number>);\n              \n              return Object.entries(stats).map(([type, count]) => {\n                const icons = { image: 'üì∑', video: 'üé¨', audio: 'üéµ', application: 'üìÑ', text: 'üìÑ' };\n                return (\n                  <div key={type} className=\"bg-white dark:bg-gray-700 rounded px-2 py-1 text-center\">\n                    <span className=\"mr-1\">{icons[type as keyof typeof icons] || 'üìÑ'}</span>\n                    {count} {type === 'image' ? '–∏–∑–æ–±—Ä.' : type === 'video' ? '–≤–∏–¥–µ–æ' : type === 'audio' ? '–∞—É–¥–∏–æ' : '–¥–æ–∫.'}\n                  </div>\n                );\n              });\n            })()}\n          </div>\n          \n          {/* –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä */}\n          <div className=\"text-sm text-muted-foreground\">\n            –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: {formatFileSize(files.reduce((sum, file) => sum + file.size, 0))}\n          </div>\n        </div>\n      )}\n\n      {/* –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ */}\n      {files.length > 0 && (\n        <div className=\"space-y-3\">\n\n          <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n            {files.map((file) => (\n              <div\n                key={file.id}\n                className=\"flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n              >\n                {/* –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ø—Ä–µ–≤—å—é –∏–ª–∏ –∏–∫–æ–Ω–∫–∞ */}\n                <div className=\"flex-shrink-0 relative\">\n                  {file.preview ? (\n                    <div className=\"relative\">\n                      <img\n                        src={file.preview}\n                        alt={file.name}\n                        className=\"w-12 h-12 object-cover rounded\"\n                      />\n                      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ */}\n                      <div className=\"absolute -top-1 -right-1 bg-blue-500 text-white text-xs px-1 rounded\">\n                        {file.type.split('/')[1]?.toUpperCase().substring(0, 3) || 'IMG'}\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded flex items-center justify-center relative\">\n                      {getFileIcon(file)}\n                      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ */}\n                      <div className=\"absolute -bottom-1 -right-1 bg-gray-600 text-white text-xs px-1 rounded\">\n                        {file.size > 1024 * 1024 ? `${Math.round(file.size / (1024 * 1024))}M` : `${Math.round(file.size / 1024)}K`}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ */}\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100 truncate\">\n                    {file.name}\n                  </p>\n                  <p className=\"text-xs text-gray-500\">\n                    {formatFileSize(file.size)}\n                  </p>\n                  \n                  {/* –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ */}\n                  {file.uploadStatus === 'uploading' && (\n                    <Progress value={file.uploadProgress || 0} className=\"mt-1\" />\n                  )}\n                  \n                  {/* –°—Ç–∞—Ç—É—Å */}\n                  {file.uploadStatus === 'success' && (\n                    <div className=\"flex items-center mt-1 text-green-600 text-xs\">\n                      <CheckCircle2 className=\"w-3 h-3 mr-1\" />\n                      –ó–∞–≥—Ä—É–∂–µ–Ω–æ\n                    </div>\n                  )}\n                  \n                  {file.uploadStatus === 'error' && (\n                    <div className=\"flex items-center mt-1 text-red-600 text-xs\">\n                      <AlertTriangle className=\"w-3 h-3 mr-1\" />\n                      {file.uploadError || '–û—à–∏–±–∫–∞'}\n                    </div>\n                  )}\n                </div>\n\n                {/* –î–µ–π—Å—Ç–≤–∏—è */}\n                <div className=\"flex items-center space-x-2\">\n                  {file.uploadStatus === 'uploading' && (\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  )}\n                  \n                  {file.uploadStatus !== 'uploading' && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => removeFile(file.id)}\n                      disabled={isUploading}\n                    >\n                      <X className=\"w-4 h-4\" />\n                    </Button>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ */}\n      {isUploading && (\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <Label>–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏</Label>\n            <span className=\"text-sm text-muted-foreground\">{uploadProgress}%</span>\n          </div>\n          <Progress value={uploadProgress} />\n        </div>\n      )}\n\n      {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}\n      {files.length > 0 && (\n        <div className=\"flex justify-end space-x-3 pt-4 border-t\">\n          {onClose && (\n            <Button variant=\"outline\" onClick={onClose} disabled={isUploading}>\n              –û—Ç–º–µ–Ω–∞\n            </Button>\n          )}\n          <Button \n            onClick={handleUpload} \n            disabled={isUploading || files.length === 0}\n            className=\"min-w-[120px]\"\n          >\n            {isUploading ? (\n              <>\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                –ó–∞–≥—Ä—É–∑–∫–∞...\n              </>\n            ) : (\n              <>\n                <Upload className=\"w-4 h-4 mr-2\" />\n                –ó–∞–≥—Ä—É–∑–∏—Ç—å ({files.length})\n              </>\n            )}\n          </Button>\n        </div>\n      )}\n\n      {/* –î–∏–∞–ª–æ–≥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ */}\n      <Dialog open={showOptimizer} onOpenChange={setShowOptimizer}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" aria-describedby=\"optimizer-description\">\n          <DialogHeader>\n            <DialogTitle>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤</DialogTitle>\n            <div id=\"optimizer-description\" className=\"text-sm text-muted-foreground\">\n              –°–∂–∞—Ç–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞\n            </div>\n          </DialogHeader>\n          <FileOptimizer\n            files={files}\n            onOptimizedFiles={(optimizedFiles) => {\n              setFiles(optimizedFiles.map((file, index) => ({\n                ...file,\n                preview: file.type.startsWith('image/') ? URL.createObjectURL(file) : undefined,\n                id: Math.random().toString(36).substr(2, 9),\n                uploadStatus: 'pending' as const,\n                uploadProgress: 0\n              })));\n              setShowOptimizer(false);\n              toast({\n                title: \"–§–∞–π–ª—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã\",\n                description: `${optimizedFiles.length} —Ñ–∞–π–ª–æ–≤ –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–≥—Ä—É–∑–∫–µ`,\n              });\n            }}\n            onClose={() => setShowOptimizer(false)}\n          />\n        </DialogContent>\n      </Dialog>\n\n      {/* –î–∏–∞–ª–æ–≥ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤ */}\n      <Dialog open={showPreview} onOpenChange={setShowPreview}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" aria-describedby=\"preview-description\">\n          <DialogHeader>\n            <DialogTitle>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤</DialogTitle>\n            <div id=\"preview-description\" className=\"text-sm text-muted-foreground\">\n              –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π\n            </div>\n          </DialogHeader>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[60vh] overflow-y-auto\">\n            {files.map((file) => (\n              <div key={file.id} className=\"border rounded-lg p-4 space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium truncate\">{file.name}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => handleRemoveFile(file.id)}\n                    className=\"text-red-500 hover:text-red-700\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n                \n                {file.preview && (\n                  <div className=\"relative\">\n                    <img\n                      src={file.preview}\n                      alt={file.name}\n                      className=\"w-full h-32 object-cover rounded\"\n                    />\n                  </div>\n                )}\n                \n                {!file.preview && (\n                  <div className=\"flex items-center justify-center h-32 bg-muted rounded\">\n                    {getFileIcon(file)}\n                  </div>\n                )}\n                \n                <div className=\"text-xs text-muted-foreground\">\n                  {formatFileSize(file.size)} ‚Ä¢ {file.type}\n                </div>\n              </div>\n            ))}\n          </div>\n          \n          <div className=\"flex justify-end gap-2 pt-4 border-t\">\n            <Button variant=\"outline\" onClick={() => setShowPreview(false)}>\n              –ó–∞–∫—Ä—ã—Ç—å\n            </Button>\n            <Button onClick={() => setShowPreview(false)}>\n              –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":27388},"client/src/components/media/file-optimizer.tsx":{"content":"import React, { useState, useCallback } from 'react';\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Zap, Image, FileVideo, FileAudio, Download, Settings, CheckCircle2 } from \"lucide-react\";\n\ninterface FileOptimizerProps {\n  files: File[];\n  onOptimizedFiles?: (files: File[]) => void;\n  onClose?: () => void;\n}\n\ninterface OptimizationSettings {\n  images: {\n    compress: boolean;\n    quality: number;\n    maxWidth: number;\n    format: 'original' | 'jpeg' | 'webp';\n  };\n  videos: {\n    compress: boolean;\n    quality: 'low' | 'medium' | 'high';\n    maxSize: number;\n  };\n  audio: {\n    compress: boolean;\n    bitrate: number;\n  };\n}\n\nexport function FileOptimizer({ files, onOptimizedFiles, onClose }: FileOptimizerProps) {\n  const { toast } = useToast();\n  const [isOptimizing, setIsOptimizing] = useState(false);\n  const [optimizationProgress, setOptimizationProgress] = useState(0);\n  const [optimizedFiles, setOptimizedFiles] = useState<File[]>([]);\n  const [settings, setSettings] = useState<OptimizationSettings>({\n    images: {\n      compress: true,\n      quality: 85,\n      maxWidth: 1920,\n      format: 'original'\n    },\n    videos: {\n      compress: false,\n      quality: 'medium',\n      maxSize: 50\n    },\n    audio: {\n      compress: false,\n      bitrate: 128\n    }\n  });\n\n  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤\n  const fileStats = files.reduce((acc, file) => {\n    const type = file.type.split('/')[0];\n    acc[type] = (acc[type] || 0) + 1;\n    acc.totalSize = (acc.totalSize || 0) + file.size;\n    return acc;\n  }, {} as Record<string, number>);\n\n  // –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\n  const compressImage = useCallback(async (file: File): Promise<File> => {\n    return new Promise((resolve) => {\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      const img = new Image();\n      \n      img.onload = () => {\n        // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã\n        let { width, height } = img;\n        const maxWidth = settings.images.maxWidth;\n        \n        if (width > maxWidth) {\n          height = (height * maxWidth) / width;\n          width = maxWidth;\n        }\n        \n        canvas.width = width;\n        canvas.height = height;\n        \n        // –†–∏—Å—É–µ–º —Å–∂–∞—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ\n        ctx?.drawImage(img, 0, 0, width, height);\n        \n        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Blob\n        canvas.toBlob((blob) => {\n          if (blob) {\n            const compressedFile = new File([blob], file.name, {\n              type: settings.images.format === 'original' ? file.type : `image/${settings.images.format}`,\n              lastModified: Date.now()\n            });\n            resolve(compressedFile);\n          } else {\n            resolve(file);\n          }\n        }, settings.images.format === 'original' ? file.type : `image/${settings.images.format}`, settings.images.quality / 100);\n      };\n      \n      img.src = URL.createObjectURL(file);\n    });\n  }, [settings.images]);\n\n  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤\n  const optimizeFiles = useCallback(async () => {\n    setIsOptimizing(true);\n    setOptimizationProgress(0);\n    \n    try {\n      const optimized: File[] = [];\n      \n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        let optimizedFile = file;\n        \n        // –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n        if (file.type.startsWith('image/') && settings.images.compress) {\n          optimizedFile = await compressImage(file);\n        }\n        \n        optimized.push(optimizedFile);\n        setOptimizationProgress(Math.round(((i + 1) / files.length) * 100));\n        \n        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n        await new Promise(resolve => setTimeout(resolve, 100));\n      }\n      \n      setOptimizedFiles(optimized);\n      \n      // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∂–∞—Ç–∏—è\n      const originalSize = files.reduce((sum, file) => sum + file.size, 0);\n      const optimizedSize = optimized.reduce((sum, file) => sum + file.size, 0);\n      const savedPercentage = Math.round(((originalSize - optimizedSize) / originalSize) * 100);\n      \n      toast({\n        title: \"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞\",\n        description: `–°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ ${savedPercentage}% –º–µ—Å—Ç–∞ (${formatFileSize(originalSize - optimizedSize)})`,\n      });\n      \n    } catch (error) {\n      console.error('Optimization error:', error);\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsOptimizing(false);\n    }\n  }, [files, settings, compressImage, toast]);\n\n  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤\n  const applyOptimizedFiles = () => {\n    onOptimizedFiles?.(optimizedFiles);\n    onClose?.();\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-xl font-semibold flex items-center\">\n            <Zap className=\"w-5 h-5 mr-2 text-yellow-500\" />\n            –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤\n          </h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            –°–∂–∞—Ç–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏\n          </p>\n        </div>\n      </div>\n\n      {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤ */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">–û–±–∑–æ—Ä —Ñ–∞–π–ª–æ–≤</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-blue-600\">{files.length}</div>\n              <div className=\"text-muted-foreground\">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-green-600\">{fileStats.image || 0}</div>\n              <div className=\"text-muted-foreground\">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-purple-600\">{fileStats.video || 0}</div>\n              <div className=\"text-muted-foreground\">–í–∏–¥–µ–æ</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-orange-600\">{formatFileSize(fileStats.totalSize || 0)}</div>\n              <div className=\"text-muted-foreground\">–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä</div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ */}\n      <Tabs defaultValue=\"images\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"images\" className=\"flex items-center\">\n            <Image className=\"w-4 h-4 mr-2\" />\n            –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n            <Badge variant=\"secondary\" className=\"ml-2\">{fileStats.image || 0}</Badge>\n          </TabsTrigger>\n          <TabsTrigger value=\"videos\" disabled={!fileStats.video}>\n            <FileVideo className=\"w-4 h-4 mr-2\" />\n            –í–∏–¥–µ–æ\n            <Badge variant=\"secondary\" className=\"ml-2\">{fileStats.video || 0}</Badge>\n          </TabsTrigger>\n          <TabsTrigger value=\"audio\" disabled={!fileStats.audio}>\n            <FileAudio className=\"w-4 h-4 mr-2\" />\n            –ê—É–¥–∏–æ\n            <Badge variant=\"secondary\" className=\"ml-2\">{fileStats.audio || 0}</Badge>\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"images\" className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <Label htmlFor=\"compress-images\">–°–∂–∏–º–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</Label>\n                  <Switch\n                    id=\"compress-images\"\n                    checked={settings.images.compress}\n                    onCheckedChange={(checked) => \n                      setSettings(prev => ({ \n                        ...prev, \n                        images: { ...prev.images, compress: checked }\n                      }))\n                    }\n                  />\n                </div>\n                \n                {settings.images.compress && (\n                  <>\n                    <div className=\"space-y-2\">\n                      <Label>–ö–∞—á–µ—Å—Ç–≤–æ: {settings.images.quality}%</Label>\n                      <Slider\n                        value={[settings.images.quality]}\n                        onValueChange={([value]) => \n                          setSettings(prev => ({ \n                            ...prev, \n                            images: { ...prev.images, quality: value }\n                          }))\n                        }\n                        max={100}\n                        min={10}\n                        step={5}\n                      />\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞: {settings.images.maxWidth}px</Label>\n                      <Slider\n                        value={[settings.images.maxWidth]}\n                        onValueChange={([value]) => \n                          setSettings(prev => ({ \n                            ...prev, \n                            images: { ...prev.images, maxWidth: value }\n                          }))\n                        }\n                        max={4096}\n                        min={800}\n                        step={100}\n                      />\n                    </div>\n                  </>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"videos\" className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"text-center text-muted-foreground\">\n                <FileVideo className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                <p>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö</p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"audio\" className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"text-center text-muted-foreground\">\n                <FileAudio className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                <p>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö</p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ */}\n      {isOptimizing && (\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <Label>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤...</Label>\n            <span className=\"text-sm text-muted-foreground\">{optimizationProgress}%</span>\n          </div>\n          <Progress value={optimizationProgress} />\n        </div>\n      )}\n\n      {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ */}\n      {optimizedFiles.length > 0 && !isOptimizing && (\n        <Card className=\"border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center mb-4\">\n              <CheckCircle2 className=\"w-5 h-5 text-green-600 mr-2\" />\n              <span className=\"font-medium text-green-800 dark:text-green-200\">\n                –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ\n              </span>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div>\n                <span className=\"text-muted-foreground\">–ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä:</span>\n                <div className=\"font-medium\">{formatFileSize(files.reduce((sum, file) => sum + file.size, 0))}</div>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä:</span>\n                <div className=\"font-medium text-green-600\">\n                  {formatFileSize(optimizedFiles.reduce((sum, file) => sum + file.size, 0))}\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}\n      <div className=\"flex justify-end gap-3\">\n        <Button variant=\"outline\" onClick={onClose} disabled={isOptimizing}>\n          –û—Ç–º–µ–Ω–∞\n        </Button>\n        \n        {optimizedFiles.length === 0 ? (\n          <Button \n            onClick={optimizeFiles} \n            disabled={isOptimizing || !settings.images.compress}\n            className=\"flex items-center\"\n          >\n            <Zap className=\"w-4 h-4 mr-2\" />\n            {isOptimizing ? '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è...' : '–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å'}\n          </Button>\n        ) : (\n          <Button onClick={applyOptimizedFiles} className=\"flex items-center\">\n            <Download className=\"w-4 h-4 mr-2\" />\n            –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":14396},"client/src/components/media/media-manager.tsx":{"content":"import React, { useState, useCallback } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMediaFiles, useUploadMedia, useDeleteMedia, useUpdateMedia, useIncrementUsage } from \"@/hooks/use-media\";\nimport { CameraCapture } from \"./camera-capture\";\nimport { EnhancedMediaUploader } from \"./enhanced-media-uploader\";\nimport type { MediaFile } from \"@shared/schema\";\nimport { Loader2, Upload, Search, X, Edit, Trash2, Eye, Download, Play, Volume2, FileText, Image, AlertCircle, CheckCircle2, Camera, FolderOpen, Zap, Smartphone, Plus } from \"lucide-react\";\n\ninterface MediaManagerProps {\n  projectId: number;\n  onSelectFile?: (file: MediaFile) => void;\n  selectedType?: 'photo' | 'video' | 'audio' | 'document';\n}\n\ninterface UploadingFile {\n  file: File;\n  progress: number;\n  status: 'uploading' | 'success' | 'error';\n  error?: string;\n}\n\nexport function MediaManager({ projectId, onSelectFile, selectedType }: MediaManagerProps) {\n  const { toast } = useToast();\n  const [currentTab, setCurrentTab] = useState(selectedType || 'all');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedFile, setSelectedFile] = useState<MediaFile | null>(null);\n  const [editingFile, setEditingFile] = useState<MediaFile | null>(null);\n  const [uploadingFiles, setUploadingFiles] = useState<UploadingFile[]>([]);\n  const [showUploadDetails, setShowUploadDetails] = useState(false);\n  const [showCameraCapture, setShowCameraCapture] = useState(false);\n  const [showEnhancedUploader, setShowEnhancedUploader] = useState(false);\n  const [hasCamera, setHasCamera] = useState(false);\n\n  const { data: allFiles, isLoading } = useMediaFiles(projectId);\n  const { data: photoFiles } = useMediaFiles(projectId, 'photo');\n  const { data: videoFiles } = useMediaFiles(projectId, 'video');\n  const { data: audioFiles } = useMediaFiles(projectId, 'audio');\n  const { data: documentFiles } = useMediaFiles(projectId, 'document');\n\n  const uploadMutation = useUploadMedia(projectId);\n  const deleteMutation = useDeleteMedia();\n  const updateMutation = useUpdateMedia();\n  const incrementUsage = useIncrementUsage();\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–º–µ—Ä—ã\n  React.useEffect(() => {\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      navigator.mediaDevices.enumerateDevices()\n        .then(devices => {\n          const hasVideoInput = devices.some(device => device.kind === 'videoinput');\n          setHasCamera(hasVideoInput);\n        })\n        .catch(() => setHasCamera(false));\n    }\n  }, []);\n\n  const validateFile = (file: File): string | null => {\n    // Check file size with different limits for different types\n    const maxSize = file.type.startsWith('video/') ? 100 * 1024 * 1024 : 50 * 1024 * 1024;\n    if (file.size > maxSize) {\n      return `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ${file.type.startsWith('video/') ? '100' : '50'}–ú–ë`;\n    }\n\n    // Enhanced file type support\n    const allowedTypes = [\n      // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n      'image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp', 'image/bmp', 'image/tiff',\n      // –í–∏–¥–µ–æ\n      'video/mp4', 'video/webm', 'video/ogg', 'video/avi', 'video/mov', 'video/wmv', 'video/flv', 'video/mkv',\n      // –ê—É–¥–∏–æ\n      'audio/mp3', 'audio/wav', 'audio/ogg', 'audio/mpeg', 'audio/webm', 'audio/aac', 'audio/flac', 'audio/m4a',\n      // –î–æ–∫—É–º–µ–Ω—Ç—ã\n      'application/pdf', \n      'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n      'application/vnd.ms-powerpoint', 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n      'text/plain', 'text/csv', 'text/rtf',\n      // –ê—Ä—Ö–∏–≤—ã\n      'application/zip', 'application/rar', 'application/x-7z-compressed', 'application/x-tar', 'application/gzip'\n    ];\n\n    if (!allowedTypes.includes(file.type)) {\n      return `–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞: ${file.type}`;\n    }\n\n    return null;\n  };\n\n  const onDrop = useCallback((acceptedFiles: File[], rejectedFiles: any[]) => {\n    // Handle rejected files\n    rejectedFiles.forEach(rejection => {\n      const error = rejection.errors[0]?.message || '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–∞–π–ª';\n      toast({\n        title: \"–§–∞–π–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω\",\n        description: `${rejection.file.name}: ${error}`,\n        variant: \"destructive\",\n      });\n    });\n\n    // Process accepted files\n    acceptedFiles.forEach(file => {\n      // Additional validation\n      const validationError = validateFile(file);\n      if (validationError) {\n        toast({\n          title: \"–§–∞–π–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω\",\n          description: `${file.name}: ${validationError}`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Add to uploading files list\n      const uploadingFile: UploadingFile = {\n        file,\n        progress: 0,\n        status: 'uploading'\n      };\n\n      setUploadingFiles(prev => [...prev, uploadingFile]);\n      setShowUploadDetails(true);\n\n      // Start upload with progress simulation\n      uploadMutation.mutate({\n        file,\n        description: '',\n        tags: []\n      }, {\n        onSuccess: () => {\n          setUploadingFiles(prev => \n            prev.map(uf => \n              uf.file === file \n                ? { ...uf, progress: 100, status: 'success' }\n                : uf\n            )\n          );\n          toast({\n            title: \"–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω\",\n            description: `${file.name} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`,\n          });\n          // Remove from uploading list after delay\n          setTimeout(() => {\n            setUploadingFiles(prev => prev.filter(uf => uf.file !== file));\n          }, 3000);\n        },\n        onError: (error) => {\n          setUploadingFiles(prev => \n            prev.map(uf => \n              uf.file === file \n                ? { ...uf, status: 'error', error: error.message }\n                : uf\n            )\n          );\n          toast({\n            title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n            description: error.message,\n            variant: \"destructive\",\n          });\n        }\n      });\n\n      // Simulate progress (since we don't have real progress from backend)\n      const progressInterval = setInterval(() => {\n        setUploadingFiles(prev => \n          prev.map(uf => {\n            if (uf.file === file && uf.status === 'uploading' && uf.progress < 90) {\n              return { ...uf, progress: Math.min(uf.progress + Math.random() * 20, 90) };\n            }\n            return uf;\n          })\n        );\n      }, 500);\n\n      setTimeout(() => clearInterval(progressInterval), 10000);\n    });\n  }, [uploadMutation, toast]);\n\n  const { getRootProps, getInputProps, isDragActive, isDragReject, fileRejections } = useDropzone({\n    onDrop,\n    accept: {\n      'image/*': ['.jpeg', '.jpg', '.png', '.gif', '.webp'],\n      'video/*': ['.mp4', '.webm', '.ogg', '.avi', '.mov'],\n      'audio/*': ['.mp3', '.wav', '.ogg', '.mpeg', '.webm'],\n      'application/pdf': ['.pdf'],\n      'application/msword': ['.doc'],\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],\n      'text/plain': ['.txt'],\n      'application/zip': ['.zip'],\n      'application/rar': ['.rar']\n    },\n    maxSize: 50 * 1024 * 1024, // 50MB\n    maxFiles: 10, // Maximum 10 files at once\n    multiple: true,\n    disabled: uploadingFiles.some(uf => uf.status === 'uploading'),\n    // Better mobile support\n    useFsAccessApi: false,\n    getFilesFromEvent: async (event) => {\n      const files = [];\n      \n      if (event.type === 'drop') {\n        // Handle dropped files\n        const items = Array.from(event.dataTransfer.items);\n        for (const item of items) {\n          if (item.kind === 'file') {\n            const file = item.getAsFile();\n            if (file) files.push(file);\n          }\n        }\n      } else if (event.target && event.target.files) {\n        // Handle selected files\n        files.push(...Array.from(event.target.files));\n      }\n      \n      return files;\n    }\n  });\n\n  const handleDeleteFile = (file: MediaFile) => {\n    deleteMutation.mutate(file.id, {\n      onSuccess: () => {\n        toast({\n          title: \"–§–∞–π–ª —É–¥–∞–ª–µ–Ω\",\n          description: `${file.fileName} –±—ã–ª —É–¥–∞–ª–µ–Ω`,\n        });\n        setSelectedFile(null);\n      },\n      onError: (error) => {\n        toast({\n          title: \"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      }\n    });\n  };\n\n  const handleSelectFile = (file: MediaFile) => {\n    if (onSelectFile) {\n      onSelectFile(file);\n      incrementUsage.mutate(file.id);\n    } else {\n      setSelectedFile(file);\n    }\n  };\n\n  const handleUpdateFile = (file: MediaFile, updates: Partial<MediaFile>) => {\n    updateMutation.mutate({\n      id: file.id,\n      updates\n    }, {\n      onSuccess: () => {\n        toast({\n          title: \"–§–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω\",\n          description: \"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ –±—ã–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞\",\n        });\n        setEditingFile(null);\n      },\n      onError: (error) => {\n        toast({\n          title: \"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      }\n    });\n  };\n\n  const getFileIcon = (fileType: string) => {\n    switch (fileType) {\n      case 'photo': return <Image className=\"w-4 h-4\" />;\n      case 'video': return <Play className=\"w-4 h-4\" />;\n      case 'audio': return <Volume2 className=\"w-4 h-4\" />;\n      case 'document': return <FileText className=\"w-4 h-4\" />;\n      default: return <FileText className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getFilesToDisplay = () => {\n    let files: MediaFile[] = [];\n    \n    switch (currentTab) {\n      case 'photo': files = photoFiles || []; break;\n      case 'video': files = videoFiles || []; break;\n      case 'audio': files = audioFiles || []; break;\n      case 'document': files = documentFiles || []; break;\n      default: files = allFiles || [];\n    }\n\n    if (searchQuery) {\n      files = files.filter(file => \n        file.fileName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        (file.description && file.description.toLowerCase().includes(searchQuery.toLowerCase()))\n      );\n    }\n\n    return files;\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 –ë';\n    const k = 1024;\n    const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"w-8 h-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Enhanced Upload Area */}\n      <Card className=\"relative overflow-hidden\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center\">\n                <Upload className=\"w-4 h-4 text-white\" />\n              </div>\n              –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã\n            </div>\n            {uploadingFiles.length > 0 && (\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => setShowUploadDetails(!showUploadDetails)}\n                className=\"flex items-center gap-2\"\n              >\n                <Zap className=\"w-4 h-4\" />\n                {uploadingFiles.length} –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è\n              </Button>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div\n            {...getRootProps()}\n            className={`\n              relative border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all duration-300 group\n              ${isDragActive && !isDragReject\n                ? 'border-blue-500 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/20 scale-105' \n                : isDragReject\n                ? 'border-red-500 bg-red-50 dark:bg-red-950/20'\n                : uploadingFiles.some(uf => uf.status === 'uploading')\n                ? 'border-gray-300 dark:border-gray-600 opacity-50 cursor-not-allowed'\n                : 'border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 hover:bg-blue-50/50 dark:hover:bg-blue-950/10'\n              }\n            `}\n          >\n            <input {...getInputProps()} />\n            \n            {/* Upload Icon with Animation */}\n            <div className=\"relative mb-4\">\n              {uploadingFiles.some(uf => uf.status === 'uploading') ? (\n                <Loader2 className=\"w-16 h-16 mx-auto text-blue-500 animate-spin\" />\n              ) : isDragActive && !isDragReject ? (\n                <div className=\"w-16 h-16 mx-auto bg-blue-500 rounded-full flex items-center justify-center animate-pulse\">\n                  <Upload className=\"w-8 h-8 text-white\" />\n                </div>\n              ) : isDragReject ? (\n                <div className=\"w-16 h-16 mx-auto bg-red-500 rounded-full flex items-center justify-center\">\n                  <AlertCircle className=\"w-8 h-8 text-white\" />\n                </div>\n              ) : (\n                <div className=\"relative\">\n                  <Upload className=\"w-16 h-16 mx-auto text-gray-400 group-hover:text-blue-500 transition-colors\" />\n                  <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\n                    <Camera className=\"w-3 h-3 text-white\" />\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Upload Text */}\n            {isDragActive && !isDragReject ? (\n              <div>\n                <p className=\"text-xl font-semibold text-blue-600 dark:text-blue-400 mb-2\">\n                  –û—Ç–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã –∑–¥–µ—Å—å!\n                </p>\n                <p className=\"text-sm text-blue-500\">\n                  –§–∞–π–ª—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\n                </p>\n              </div>\n            ) : isDragReject ? (\n              <div>\n                <p className=\"text-xl font-semibold text-red-600 dark:text-red-400 mb-2\">\n                  –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã\n                </p>\n                <p className=\"text-sm text-red-500\">\n                  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø –∏ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤\n                </p>\n              </div>\n            ) : uploadingFiles.some(uf => uf.status === 'uploading') ? (\n              <div>\n                <p className=\"text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2\">\n                  –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...\n                </p>\n                <p className=\"text-sm text-gray-500\">\n                  –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ\n                </p>\n              </div>\n            ) : (\n              <div>\n                <p className=\"text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200\">\n                  –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞\n                </p>\n                <p className=\"text-sm text-gray-500 mb-4\">\n                  –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã (–¥–æ 50–ú–ë)\n                </p>\n                <div className=\"flex items-center justify-center gap-4 text-xs text-gray-400\">\n                  <div className=\"flex items-center gap-1\">\n                    <Image className=\"w-4 h-4\" />\n                    –§–æ—Ç–æ\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Play className=\"w-4 h-4\" />\n                    –í–∏–¥–µ–æ\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Volume2 className=\"w-4 h-4\" />\n                    –ê—É–¥–∏–æ\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <FileText className=\"w-4 h-4\" />\n                    –î–æ–∫—É–º–µ–Ω—Ç—ã\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Background Pattern */}\n            <div className=\"absolute inset-0 opacity-5 dark:opacity-10\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500\" />\n            </div>\n          </div>\n\n          {/* Upload Progress */}\n          {showUploadDetails && uploadingFiles.length > 0 && (\n            <div className=\"mt-6 space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <h4 className=\"font-medium text-sm text-gray-700 dark:text-gray-300\">\n                  –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ ({uploadingFiles.length} —Ñ–∞–π–ª–æ–≤)\n                </h4>\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\"\n                  onClick={() => setShowUploadDetails(false)}\n                  className=\"h-6 w-6 p-0\"\n                >\n                  <X className=\"w-4 h-4\" />\n                </Button>\n              </div>\n              {uploadingFiles.map((uploadingFile, index) => (\n                <div key={index} className=\"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div className=\"flex items-center gap-2\">\n                      {uploadingFile.status === 'uploading' && <Loader2 className=\"w-4 h-4 animate-spin text-blue-500\" />}\n                      {uploadingFile.status === 'success' && <CheckCircle2 className=\"w-4 h-4 text-green-500\" />}\n                      {uploadingFile.status === 'error' && <AlertCircle className=\"w-4 h-4 text-red-500\" />}\n                      <span className=\"text-sm font-medium truncate max-w-48\">\n                        {uploadingFile.file.name}\n                      </span>\n                    </div>\n                    <div className=\"text-xs text-gray-500\">\n                      {formatFileSize(uploadingFile.file.size)}\n                    </div>\n                  </div>\n                  {uploadingFile.status === 'uploading' && (\n                    <Progress value={uploadingFile.progress} className=\"h-2\" />\n                  )}\n                  {uploadingFile.status === 'error' && uploadingFile.error && (\n                    <p className=\"text-xs text-red-600 dark:text-red-400 mt-1\">\n                      {uploadingFile.error}\n                    </p>\n                  )}\n                  {uploadingFile.status === 'success' && (\n                    <p className=\"text-xs text-green-600 dark:text-green-400 mt-1\">\n                      –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω\n                    </p>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n\n          {/* Quick Actions */}\n          <div className=\"mt-6 space-y-4\">\n            {/* Quick Upload Actions */}\n            <div className=\"flex items-center justify-center gap-3 flex-wrap\">\n              <Button\n                onClick={() => setShowEnhancedUploader(true)}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"flex items-center gap-2 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-950/20 dark:to-pink-950/20 border-purple-200 dark:border-purple-800 hover:from-purple-100 hover:to-pink-100 dark:hover:from-purple-900/30 dark:hover:to-pink-900/30\"\n              >\n                <Plus className=\"w-4 h-4 text-purple-600 dark:text-purple-400\" />\n                –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞\n              </Button>\n              \n              {hasCamera && (\n                <Button\n                  onClick={() => setShowCameraCapture(true)}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"flex items-center gap-2 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-950/20 dark:to-blue-950/20 border-green-200 dark:border-green-800 hover:from-green-100 hover:to-blue-100 dark:hover:from-green-900/30 dark:hover:to-blue-900/30\"\n                >\n                  <Camera className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\n                  –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ\n                </Button>\n              )}\n              \n              {/* Hidden file inputs for specific types */}\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"file\"\n                  id=\"photo-input\"\n                  accept=\"image/*\"\n                  multiple\n                  className=\"hidden\"\n                  onChange={(e) => {\n                    if (e.target.files) {\n                      onDrop(Array.from(e.target.files), []);\n                      e.target.value = '';\n                    }\n                  }}\n                />\n                <Button\n                  onClick={() => document.getElementById('photo-input')?.click()}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"flex items-center gap-2\"\n                >\n                  <Image className=\"w-4 h-4\" />\n                  –§–æ—Ç–æ\n                </Button>\n                \n                <input\n                  type=\"file\"\n                  id=\"video-input\"\n                  accept=\"video/*\"\n                  multiple\n                  className=\"hidden\"\n                  onChange={(e) => {\n                    if (e.target.files) {\n                      onDrop(Array.from(e.target.files), []);\n                      e.target.value = '';\n                    }\n                  }}\n                />\n                <Button\n                  onClick={() => document.getElementById('video-input')?.click()}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"flex items-center gap-2\"\n                >\n                  <Play className=\"w-4 h-4\" />\n                  –í–∏–¥–µ–æ\n                </Button>\n                \n                <input\n                  type=\"file\"\n                  id=\"document-input\"\n                  accept=\".pdf,.doc,.docx,.txt\"\n                  multiple\n                  className=\"hidden\"\n                  onChange={(e) => {\n                    if (e.target.files) {\n                      onDrop(Array.from(e.target.files), []);\n                      e.target.value = '';\n                    }\n                  }}\n                />\n                <Button\n                  onClick={() => document.getElementById('document-input')?.click()}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"flex items-center gap-2\"\n                >\n                  <FileText className=\"w-4 h-4\" />\n                  –î–æ–∫—É–º–µ–Ω—Ç—ã\n                </Button>\n              </div>\n            </div>\n            \n            {/* Stats */}\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4 text-xs text-gray-500\">\n                <span>–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 100–ú–ë (–≤–∏–¥–µ–æ), 50–ú–ë (–æ—Å—Ç–∞–ª—å–Ω–æ–µ)</span>\n                <span>‚Ä¢</span>\n                <span>–î–æ 10 —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑</span>\n              </div>\n              {allFiles && allFiles.length > 0 && (\n                <Button variant=\"outline\" size=\"sm\" className=\"flex items-center gap-2\">\n                  <FolderOpen className=\"w-4 h-4\" />\n                  {allFiles.length} —Ñ–∞–π–ª–æ–≤ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Enhanced Search and Filter */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n              <Input\n                placeholder=\"–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            \n            {/* Upload Stats */}\n            {allFiles && allFiles.length > 0 && (\n              <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400\">\n                <div className=\"flex items-center gap-1\">\n                  <Image className=\"w-4 h-4\" />\n                  <span>{photoFiles?.length || 0}</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Play className=\"w-4 h-4\" />\n                  <span>{videoFiles?.length || 0}</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Volume2 className=\"w-4 h-4\" />\n                  <span>{audioFiles?.length || 0}</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <FileText className=\"w-4 h-4\" />\n                  <span>{documentFiles?.length || 0}</span>\n                </div>\n              </div>\n            )}\n          </div>\n          \n          {searchQuery && (\n            <div className=\"mt-2 flex items-center gap-2\">\n              <span className=\"text-sm text-gray-500\">\n                –ù–∞–π–¥–µ–Ω–æ: {getFilesToDisplay().length} —Ñ–∞–π–ª–æ–≤\n              </span>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setSearchQuery('')}\n                className=\"h-6 px-2\"\n              >\n                <X className=\"w-3 h-3\" />\n                –û—á–∏—Å—Ç–∏—Ç—å\n              </Button>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Tabs */}\n      <Tabs value={currentTab} onValueChange={setCurrentTab}>\n        <TabsList className=\"grid w-full grid-cols-5\">\n          <TabsTrigger value=\"all\">–í—Å–µ</TabsTrigger>\n          <TabsTrigger value=\"photo\">–§–æ—Ç–æ</TabsTrigger>\n          <TabsTrigger value=\"video\">–í–∏–¥–µ–æ</TabsTrigger>\n          <TabsTrigger value=\"audio\">–ê—É–¥–∏–æ</TabsTrigger>\n          <TabsTrigger value=\"document\">–î–æ–∫—É–º–µ–Ω—Ç—ã</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={currentTab} className=\"mt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {getFilesToDisplay().map((file) => (\n              <Card key={file.id} className=\"group hover:shadow-md transition-shadow\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <div className=\"flex items-center gap-2\">\n                      {getFileIcon(file.fileType)}\n                      <span className=\"font-medium text-sm truncate\">{file.fileName}</span>\n                    </div>\n                    <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => handleSelectFile(file)}\n                        className=\"h-7 w-7 p-0\"\n                      >\n                        <Eye className=\"w-3 h-3\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => setEditingFile(file)}\n                        className=\"h-7 w-7 p-0\"\n                      >\n                        <Edit className=\"w-3 h-3\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => handleDeleteFile(file)}\n                        className=\"h-7 w-7 p-0 text-red-600 hover:text-red-700\"\n                      >\n                        <Trash2 className=\"w-3 h-3\" />\n                      </Button>\n                    </div>\n                  </div>\n\n                  {/* Preview */}\n                  <div className=\"mb-3\">\n                    {file.fileType === 'photo' && (\n                      <img\n                        src={file.url}\n                        alt={file.fileName}\n                        className=\"w-full h-32 object-cover rounded border\"\n                      />\n                    )}\n                    {file.fileType === 'video' && (\n                      <video\n                        src={file.url}\n                        className=\"w-full h-32 object-cover rounded border\"\n                        controls={false}\n                      />\n                    )}\n                    {file.fileType === 'audio' && (\n                      <div className=\"w-full h-32 bg-gray-100 dark:bg-gray-800 rounded border flex items-center justify-center\">\n                        <Volume2 className=\"w-8 h-8 text-gray-400\" />\n                      </div>\n                    )}\n                    {file.fileType === 'document' && (\n                      <div className=\"w-full h-32 bg-gray-100 dark:bg-gray-800 rounded border flex items-center justify-center\">\n                        <FileText className=\"w-8 h-8 text-gray-400\" />\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between text-xs text-gray-500\">\n                      <span>{formatFileSize(file.fileSize)}</span>\n                      <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω: {file.usageCount || 0} —Ä–∞–∑</span>\n                    </div>\n                    {file.description && (\n                      <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate\">\n                        {file.description}\n                      </p>\n                    )}\n                    {file.tags && file.tags.length > 0 && (\n                      <div className=\"flex flex-wrap gap-1\">\n                        {file.tags.slice(0, 3).map((tag, index) => (\n                          <Badge key={index} variant=\"secondary\" className=\"text-xs\">\n                            {tag}\n                          </Badge>\n                        ))}\n                        {file.tags.length > 3 && (\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            +{file.tags.length - 3}\n                          </Badge>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n\n          {getFilesToDisplay().length === 0 && (\n            <div className=\"text-center py-12\">\n              <FileText className=\"w-12 h-12 mx-auto mb-4 text-gray-300\" />\n              <p className=\"text-gray-500\">\n                {searchQuery ? '–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : '–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤'}\n              </p>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      {/* Edit Dialog */}\n      {editingFile && (\n        <Dialog open={!!editingFile} onOpenChange={() => setEditingFile(null)}>\n          <DialogContent aria-describedby=\"edit-file-description\">\n            <DialogHeader>\n              <DialogTitle>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª</DialogTitle>\n              <div id=\"edit-file-description\" className=\"text-sm text-muted-foreground\">\n                –ò–∑–º–µ–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Ç–µ–≥–∏ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ–¥–∏–∞ —Ñ–∞–π–ª–∞\n              </div>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"text-sm font-medium\">–û–ø–∏—Å–∞–Ω–∏–µ</label>\n                <Textarea\n                  value={editingFile.description || ''}\n                  onChange={(e) => setEditingFile({\n                    ...editingFile,\n                    description: e.target.value\n                  })}\n                  placeholder=\"–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–∞\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>\n                <Input\n                  value={editingFile.tags?.join(', ') || ''}\n                  onChange={(e) => setEditingFile({\n                    ...editingFile,\n                    tags: e.target.value.split(',').map(tag => tag.trim()).filter(Boolean)\n                  })}\n                  placeholder=\"—Ç–µ–≥1, —Ç–µ–≥2, —Ç–µ–≥3\"\n                />\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={() => setEditingFile(null)}>\n                  –û—Ç–º–µ–Ω–∞\n                </Button>\n                <Button onClick={() => handleUpdateFile(editingFile, {\n                  description: editingFile.description,\n                  tags: editingFile.tags\n                })}>\n                  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Camera Capture */}\n      <CameraCapture\n        projectId={projectId}\n        isOpen={showCameraCapture}\n        onClose={() => setShowCameraCapture(false)}\n        onCapture={(file) => {\n          // Process captured file same as dropped file\n          const validationError = validateFile(file);\n          if (validationError) {\n            toast({\n              title: \"–§–∞–π–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω\",\n              description: `${file.name}: ${validationError}`,\n              variant: \"destructive\",\n            });\n            return;\n          }\n\n          const uploadingFile: UploadingFile = {\n            file,\n            progress: 0,\n            status: 'uploading'\n          };\n\n          setUploadingFiles(prev => [...prev, uploadingFile]);\n          setShowUploadDetails(true);\n          setShowCameraCapture(false);\n\n          uploadMutation.mutate({\n            file,\n            description: '–§–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã',\n            tags: ['–∫–∞–º–µ—Ä–∞', '—Ñ–æ—Ç–æ']\n          }, {\n            onSuccess: () => {\n              setUploadingFiles(prev => \n                prev.map(uf => \n                  uf.file === file \n                    ? { ...uf, progress: 100, status: 'success' }\n                    : uf\n                )\n              );\n              toast({\n                title: \"–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ\",\n                description: `${file.name} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`,\n              });\n              setTimeout(() => {\n                setUploadingFiles(prev => prev.filter(uf => uf.file !== file));\n              }, 3000);\n            },\n            onError: (error) => {\n              setUploadingFiles(prev => \n                prev.map(uf => \n                  uf.file === file \n                    ? { ...uf, status: 'error', error: error.message }\n                    : uf\n                )\n              );\n              toast({\n                title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n                description: error.message,\n                variant: \"destructive\",\n              });\n            }\n          });\n        }}\n      />\n\n      {/* Enhanced Media Uploader Dialog */}\n      <Dialog open={showEnhancedUploader} onOpenChange={setShowEnhancedUploader}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" aria-describedby=\"enhanced-upload-description\">\n          <DialogHeader>\n            <DialogTitle>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</DialogTitle>\n            <div id=\"enhanced-upload-description\" className=\"text-sm text-muted-foreground\">\n              –ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–µ–¥–∏–∞ —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏: –ø–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, —Ç–µ–≥–∏, –æ–ø–∏—Å–∞–Ω–∏—è\n            </div>\n          </DialogHeader>\n          <EnhancedMediaUploader\n            projectId={projectId}\n            onUploadComplete={(uploadedFiles) => {\n              toast({\n                title: \"–§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã\",\n                description: `–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${uploadedFiles.length} —Ñ–∞–π–ª–æ–≤`,\n              });\n              setShowEnhancedUploader(false);\n            }}\n            onClose={() => setShowEnhancedUploader(false)}\n            maxFiles={20}\n            acceptedTypes={['image/*', 'video/*', 'audio/*', '.pdf', '.doc', '.docx', '.txt']}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":37701},"client/src/components/media/media-selector.tsx":{"content":"import React, { useState } from 'react';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MediaManager } from \"./media-manager\";\nimport { UrlDownloader } from \"./url-downloader\";\nimport type { MediaFile } from \"@shared/schema\";\nimport { Upload, X, Eye, FileText, Image, Play, Volume2, LinkIcon, Download } from \"lucide-react\";\n\ninterface MediaSelectorProps {\n  projectId: number;\n  value?: string;\n  onChange: (url: string, fileName?: string) => void;\n  fileType?: 'photo' | 'video' | 'audio' | 'document';\n  placeholder?: string;\n  label?: string;\n}\n\nexport function MediaSelector({ \n  projectId, \n  value, \n  onChange, \n  fileType, \n  placeholder = \"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ URL\",\n  label = \"–ú–µ–¥–∏–∞—Ñ–∞–π–ª\"\n}: MediaSelectorProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedFile, setSelectedFile] = useState<MediaFile | null>(null);\n\n  const handleSelectFile = (file: MediaFile) => {\n    setSelectedFile(file);\n    onChange(file.url, file.fileName);\n    setIsOpen(false);\n  };\n\n  const handleClearSelection = () => {\n    setSelectedFile(null);\n    onChange('');\n  };\n\n  const getFileIcon = (fileType: string) => {\n    switch (fileType) {\n      case 'photo': return <Image className=\"w-4 h-4\" />;\n      case 'video': return <Play className=\"w-4 h-4\" />;\n      case 'audio': return <Volume2 className=\"w-4 h-4\" />;\n      case 'document': return <FileText className=\"w-4 h-4\" />;\n      default: return <FileText className=\"w-4 h-4\" />;\n    }\n  };\n\n  const isUsingUploadedFile = selectedFile && value === selectedFile.url;\n\n  return (\n    <div className=\"space-y-3\">\n      <label className=\"text-sm font-medium block\">{label}</label>\n      \n      {isUsingUploadedFile ? (\n        <div className=\"flex items-center justify-between p-3 border rounded-lg bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800\">\n          <div className=\"flex items-center gap-2\">\n            {getFileIcon(selectedFile.fileType)}\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium truncate\">{selectedFile.fileName}</p>\n              <p className=\"text-xs text-gray-500 truncate\">{selectedFile.url}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            {selectedFile.fileType === 'photo' && (\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => window.open(selectedFile.url, '_blank')}\n                className=\"h-7 w-7 p-0\"\n              >\n                <Eye className=\"w-3 h-3\" />\n              </Button>\n            )}\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              onClick={handleClearSelection}\n              className=\"h-7 w-7 p-0 text-red-600 hover:text-red-700\"\n            >\n              <X className=\"w-3 h-3\" />\n            </Button>\n          </div>\n        </div>\n      ) : (\n        <div className=\"space-y-2\">\n          <Input\n            value={value || ''}\n            onChange={(e) => onChange(e.target.value)}\n            placeholder={placeholder}\n            className=\"mb-2\"\n          />\n          \n          <Dialog open={isOpen} onOpenChange={setIsOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                <Upload className=\"w-4 h-4 mr-2\" />\n                –í—ã–±—Ä–∞—Ç—å –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-5xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏</DialogTitle>\n              </DialogHeader>\n              \n              <Tabs defaultValue=\"library\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-3\">\n                  <TabsTrigger value=\"library\" className=\"flex items-center gap-2\">\n                    <Image className=\"w-4 h-4\" />\n                    –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ñ–∞–π–ª–æ–≤\n                  </TabsTrigger>\n                  <TabsTrigger value=\"upload\" className=\"flex items-center gap-2\">\n                    <Upload className=\"w-4 h-4\" />\n                    –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã\n                  </TabsTrigger>\n                  <TabsTrigger value=\"url\" className=\"flex items-center gap-2\">\n                    <LinkIcon className=\"w-4 h-4\" />\n                    –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ URL\n                  </TabsTrigger>\n                </TabsList>\n                \n                <TabsContent value=\"library\" className=\"mt-4\">\n                  <MediaManager \n                    projectId={projectId}\n                    onSelectFile={handleSelectFile}\n                    selectedType={fileType}\n                  />\n                </TabsContent>\n                \n                <TabsContent value=\"upload\" className=\"mt-4\">\n                  <MediaManager \n                    projectId={projectId}\n                    onSelectFile={handleSelectFile}\n                    selectedType={fileType}\n                    showUploader={true}\n                  />\n                </TabsContent>\n                \n                <TabsContent value=\"url\" className=\"mt-4\">\n                  <UrlDownloader\n                    projectId={projectId}\n                    onDownloadComplete={(files) => {\n                      if (files.length > 0) {\n                        handleSelectFile(files[0]);\n                      }\n                      setIsOpen(false);\n                    }}\n                    onClose={() => setIsOpen(false)}\n                  />\n                </TabsContent>\n              </Tabs>\n            </DialogContent>\n          </Dialog>\n        </div>\n      )}\n\n      {selectedFile && (\n        <div className=\"space-y-2\">\n          {selectedFile.description && (\n            <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n              {selectedFile.description}\n            </p>\n          )}\n          {selectedFile.tags && selectedFile.tags.length > 0 && (\n            <div className=\"flex flex-wrap gap-1\">\n              {selectedFile.tags.map((tag, index) => (\n                <Badge key={index} variant=\"secondary\" className=\"text-xs\">\n                  {tag}\n                </Badge>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":6698},"client/src/components/media/url-downloader.tsx":{"content":"import React, { useState } from 'react';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { MediaFile } from \"@shared/schema\";\nimport { \n  Download, \n  LinkIcon, \n  CheckCircle, \n  XCircle, \n  AlertTriangle, \n  FileText, \n  Image, \n  Play, \n  Volume2,\n  Loader2,\n  Info,\n  ExternalLink,\n  Copy,\n  Trash2,\n  Plus\n} from \"lucide-react\";\n\ninterface UrlDownloaderProps {\n  projectId: number;\n  onDownloadComplete?: (files: MediaFile[]) => void;\n  onClose?: () => void;\n  maxUrls?: number;\n}\n\ninterface UrlData {\n  id: string;\n  url: string;\n  fileName?: string;\n  description?: string;\n  status: 'pending' | 'checking' | 'valid' | 'invalid' | 'downloading' | 'success' | 'error';\n  fileInfo?: {\n    mimeType?: string;\n    size?: number;\n    fileName?: string;\n    fileType?: string;\n    category?: string;\n    sizeMB?: number;\n  };\n  error?: string;\n  progress?: number;\n}\n\nexport function UrlDownloader({ \n  projectId, \n  onDownloadComplete, \n  onClose,\n  maxUrls = 10\n}: UrlDownloaderProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [urls, setUrls] = useState<UrlData[]>([{\n    id: Math.random().toString(36).substr(2, 9),\n    url: '',\n    status: 'pending'\n  }]);\n  const [isPublic, setIsPublic] = useState(false);\n  const [defaultDescription, setDefaultDescription] = useState('');\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ URL\n  const checkUrlMutation = useMutation({\n    mutationFn: async (url: string) => {\n      const response = await apiRequest('POST', '/api/media/check-url', { url });\n      return response;\n    }\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞\n  const downloadUrlMutation = useMutation({\n    mutationFn: async ({ url, description, customFileName }: { \n      url: string; \n      description?: string; \n      customFileName?: string; \n    }) => {\n      const response = await apiRequest('POST', `/api/media/download-url/${projectId}`, { \n        url, \n        description, \n        customFileName,\n        isPublic \n      });\n      return response;\n    }\n  });\n\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏\n  const downloadUrlsMutation = useMutation({\n    mutationFn: async (urlsData: { url: string; fileName?: string; description?: string }[]) => {\n      const response = await apiRequest('POST', `/api/media/download-urls/${projectId}`, { \n        urls: urlsData,\n        isPublic,\n        defaultDescription \n      });\n      return response;\n    }\n  });\n\n  const getFileIcon = (fileType?: string) => {\n    switch (fileType) {\n      case 'photo': return <Image className=\"w-4 h-4 text-blue-500\" />;\n      case 'video': return <Play className=\"w-4 h-4 text-purple-500\" />;\n      case 'audio': return <Volume2 className=\"w-4 h-4 text-green-500\" />;\n      case 'document': return <FileText className=\"w-4 h-4 text-orange-500\" />;\n      default: return <FileText className=\"w-4 h-4 text-gray-500\" />;\n    }\n  };\n\n  const addUrlField = () => {\n    if (urls.length < maxUrls) {\n      setUrls(prev => [...prev, {\n        id: Math.random().toString(36).substr(2, 9),\n        url: '',\n        status: 'pending'\n      }]);\n    }\n  };\n\n  const removeUrlField = (id: string) => {\n    if (urls.length > 1) {\n      setUrls(prev => prev.filter(u => u.id !== id));\n    }\n  };\n\n  const updateUrl = (id: string, url: string) => {\n    setUrls(prev => prev.map(u => \n      u.id === id \n        ? { ...u, url, status: 'pending' as const, fileInfo: undefined, error: undefined }\n        : u\n    ));\n  };\n\n  const updateUrlField = (id: string, field: keyof UrlData, value: any) => {\n    setUrls(prev => prev.map(u => \n      u.id === id \n        ? { ...u, [field]: value }\n        : u\n    ));\n  };\n\n  const checkUrl = async (id: string, url: string) => {\n    if (!url.trim()) return;\n\n    updateUrlField(id, 'status', 'checking');\n\n    try {\n      const result = await checkUrlMutation.mutateAsync(url);\n      \n      if (result.accessible) {\n        updateUrlField(id, 'status', 'valid');\n        updateUrlField(id, 'fileInfo', result.fileInfo);\n        \n        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –∑–∞–¥–∞–Ω–æ\n        if (result.fileInfo?.fileName && !urls.find(u => u.id === id)?.fileName) {\n          updateUrlField(id, 'fileName', result.fileInfo.fileName);\n        }\n      } else {\n        updateUrlField(id, 'status', 'invalid');\n        updateUrlField(id, 'error', result.error);\n      }\n    } catch (error) {\n      updateUrlField(id, 'status', 'invalid');\n      updateUrlField(id, 'error', error instanceof Error ? error.message : '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ URL');\n    }\n  };\n\n  const downloadSingle = async (urlData: UrlData) => {\n    if (!urlData.url.trim() || urlData.status !== 'valid') return;\n\n    updateUrlField(urlData.id, 'status', 'downloading');\n    updateUrlField(urlData.id, 'progress', 0);\n\n    try {\n      const result = await downloadUrlMutation.mutateAsync({\n        url: urlData.url,\n        description: urlData.description || defaultDescription,\n        customFileName: urlData.fileName\n      });\n\n      updateUrlField(urlData.id, 'status', 'success');\n      updateUrlField(urlData.id, 'progress', 100);\n\n      toast({\n        title: \"–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω\",\n        description: `${result.fileName} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`,\n      });\n\n      // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤\n      queryClient.invalidateQueries({ queryKey: ['/api/media/project', projectId] });\n\n      onDownloadComplete?.([result]);\n\n    } catch (error) {\n      updateUrlField(urlData.id, 'status', 'error');\n      updateUrlField(urlData.id, 'error', error instanceof Error ? error.message : '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');\n      \n      toast({\n        title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n        description: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const downloadAll = async () => {\n    const validUrls = urls.filter(u => u.status === 'valid' && u.url.trim());\n    \n    if (validUrls.length === 0) {\n      toast({\n        title: \"–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö URL\",\n        description: \"–î–æ–±–∞–≤—å—Ç–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsProcessing(true);\n\n    try {\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö URL\n      validUrls.forEach(urlData => {\n        updateUrlField(urlData.id, 'status', 'downloading');\n        updateUrlField(urlData.id, 'progress', 0);\n      });\n\n      const urlsData = validUrls.map(u => ({\n        url: u.url,\n        fileName: u.fileName,\n        description: u.description\n      }));\n\n      const result = await downloadUrlsMutation.mutateAsync(urlsData);\n\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞\n      validUrls.forEach((urlData, index) => {\n        const wasSuccessful = result.downloadedFiles.some((f: any) => f.sourceUrl === urlData.url);\n        const error = result.errorDetails.find((e: any) => e.url === urlData.url);\n        \n        if (wasSuccessful) {\n          updateUrlField(urlData.id, 'status', 'success');\n          updateUrlField(urlData.id, 'progress', 100);\n        } else {\n          updateUrlField(urlData.id, 'status', 'error');\n          updateUrlField(urlData.id, 'error', error?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');\n        }\n      });\n\n      toast({\n        title: \"–ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞\",\n        description: `–£—Å–ø–µ—à–Ω–æ: ${result.success}, –û—à–∏–±–æ–∫: ${result.errors}`,\n      });\n\n      // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤\n      queryClient.invalidateQueries({ queryKey: ['/api/media/project', projectId] });\n\n      if (result.downloadedFiles.length > 0) {\n        onDownloadComplete?.(result.downloadedFiles);\n      }\n\n      // –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –µ—Å–ª–∏ –≤—Å–µ —É—Å–ø–µ—à–Ω–æ\n      if (result.errors === 0) {\n        setTimeout(() => {\n          onClose?.();\n        }, 3000);\n      }\n\n    } catch (error) {\n      validUrls.forEach(urlData => {\n        updateUrlField(urlData.id, 'status', 'error');\n        updateUrlField(urlData.id, 'error', '–û—à–∏–±–∫–∞ –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏');\n      });\n\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏\",\n        description: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const pasteFromClipboard = async (id: string) => {\n    try {\n      const text = await navigator.clipboard.readText();\n      if (text) {\n        updateUrl(id, text);\n        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏\n        setTimeout(() => checkUrl(id, text), 100);\n      }\n    } catch (error) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞ –≤—Å—Ç–∞–≤–∫–∏\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const validUrlsCount = urls.filter(u => u.status === 'valid').length;\n  const totalUrlsCount = urls.filter(u => u.url.trim()).length;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <LinkIcon className=\"w-5 h-5\" />\n            –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ —Å—Å—ã–ª–∫–∞–º\n          </h3>\n          <p className=\"text-sm text-muted-foreground\">\n            –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø–æ URL\n          </p>\n        </div>\n        <Badge variant=\"outline\">\n          {validUrlsCount}/{totalUrlsCount} –≥–æ—Ç–æ–≤–æ\n        </Badge>\n      </div>\n\n      {/* –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">–û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"defaultDescription\">–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</Label>\n            <Textarea\n              id=\"defaultDescription\"\n              placeholder=\"–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤...\"\n              value={defaultDescription}\n              onChange={(e) => setDefaultDescription(e.target.value)}\n              rows={2}\n            />\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <Switch\n              id=\"isPublic\"\n              checked={isPublic}\n              onCheckedChange={setIsPublic}\n            />\n            <Label htmlFor=\"isPublic\">–ü—É–±–ª–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã</Label>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* URL –ø–æ–ª—è */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base flex items-center justify-between\">\n            URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏\n            <Button\n              onClick={addUrlField}\n              size=\"sm\"\n              variant=\"outline\"\n              disabled={urls.length >= maxUrls}\n            >\n              <Plus className=\"w-4 h-4 mr-1\" />\n              –î–æ–±–∞–≤–∏—Ç—å URL\n            </Button>\n          </CardTitle>\n          <CardDescription>\n            –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ 200–ú–ë\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {urls.map((urlData, index) => (\n            <div key={urlData.id} className=\"space-y-3 p-4 border rounded-lg\">\n              {/* URL –≤–≤–æ–¥ */}\n              <div className=\"flex gap-2\">\n                <div className=\"flex-1\">\n                  <Input\n                    placeholder=\"https://example.com/file.jpg\"\n                    value={urlData.url}\n                    onChange={(e) => updateUrl(urlData.id, e.target.value)}\n                    onBlur={() => urlData.url.trim() && checkUrl(urlData.id, urlData.url)}\n                  />\n                </div>\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => pasteFromClipboard(urlData.id)}\n                >\n                  <Copy className=\"w-4 h-4\" />\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => urlData.url.trim() && checkUrl(urlData.id, urlData.url)}\n                  disabled={!urlData.url.trim() || urlData.status === 'checking'}\n                >\n                  {urlData.status === 'checking' ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  ) : (\n                    <ExternalLink className=\"w-4 h-4\" />\n                  )}\n                </Button>\n                {urls.length > 1 && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => removeUrlField(urlData.id)}\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </Button>\n                )}\n              </div>\n\n              {/* –°—Ç–∞—Ç—É—Å */}\n              {urlData.status !== 'pending' && (\n                <div className=\"flex items-center gap-2\">\n                  {urlData.status === 'checking' && (\n                    <div className=\"flex items-center gap-2 text-blue-600\">\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                      <span className=\"text-sm\">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>\n                    </div>\n                  )}\n                  \n                  {urlData.status === 'valid' && (\n                    <div className=\"flex items-center gap-2 text-green-600\">\n                      <CheckCircle className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">URL –≤–∞–ª–∏–¥–µ–Ω</span>\n                    </div>\n                  )}\n                  \n                  {urlData.status === 'invalid' && (\n                    <div className=\"flex items-center gap-2 text-red-600\">\n                      <XCircle className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">–û—à–∏–±–∫–∞: {urlData.error}</span>\n                    </div>\n                  )}\n                  \n                  {urlData.status === 'downloading' && (\n                    <div className=\"flex items-center gap-2 text-blue-600\">\n                      <Download className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">–ó–∞–≥—Ä—É–∑–∫–∞... {urlData.progress || 0}%</span>\n                      <Progress value={urlData.progress || 0} className=\"w-20\" />\n                    </div>\n                  )}\n                  \n                  {urlData.status === 'success' && (\n                    <div className=\"flex items-center gap-2 text-green-600\">\n                      <CheckCircle className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">–ó–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ</span>\n                    </div>\n                  )}\n                  \n                  {urlData.status === 'error' && (\n                    <div className=\"flex items-center gap-2 text-red-600\">\n                      <XCircle className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">–û—à–∏–±–∫–∞: {urlData.error}</span>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ */}\n              {urlData.fileInfo && (\n                <div className=\"flex items-center gap-3 p-2 bg-muted rounded text-sm\">\n                  {getFileIcon(urlData.fileInfo.fileType)}\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium\">{urlData.fileInfo.fileName}</div>\n                    <div className=\"text-muted-foreground\">\n                      {urlData.fileInfo.category} ‚Ä¢ {urlData.fileInfo.sizeMB}–ú–ë\n                    </div>\n                  </div>\n                  <Badge variant=\"secondary\">{urlData.fileInfo.fileType}</Badge>\n                </div>\n              )}\n\n              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö URL */}\n              {urlData.status === 'valid' && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                  <div className=\"space-y-1\">\n                    <Label htmlFor={`fileName-${urlData.id}`}>–ò–º—è —Ñ–∞–π–ª–∞</Label>\n                    <Input\n                      id={`fileName-${urlData.id}`}\n                      placeholder=\"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è\"\n                      value={urlData.fileName || ''}\n                      onChange={(e) => updateUrlField(urlData.id, 'fileName', e.target.value)}\n                    />\n                  </div>\n                  <div className=\"space-y-1\">\n                    <Label htmlFor={`description-${urlData.id}`}>–û–ø–∏—Å–∞–Ω–∏–µ</Label>\n                    <Input\n                      id={`description-${urlData.id}`}\n                      placeholder=\"–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–∞\"\n                      value={urlData.description || ''}\n                      onChange={(e) => updateUrlField(urlData.id, 'description', e.target.value)}\n                    />\n                  </div>\n                </div>\n              )}\n\n              {/* –ö–Ω–æ–ø–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ */}\n              {urlData.status === 'valid' && (\n                <Button\n                  onClick={() => downloadSingle(urlData)}\n                  size=\"sm\"\n                  className=\"w-full\"\n                  disabled={urlData.status === 'downloading'}\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  –ó–∞–≥—Ä—É–∑–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª\n                </Button>\n              )}\n            </div>\n          ))}\n        </CardContent>\n      </Card>\n\n      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ */}\n      <Alert>\n        <Info className=\"h-4 w-4\" />\n        <AlertDescription>\n          <strong>–°–æ–≤–µ—Ç:</strong> –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –≤—Å–µ URL –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏, \n          –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ \"–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã\" –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.\n        </AlertDescription>\n      </Alert>\n\n      {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}\n      <div className=\"flex gap-2\">\n        <Button\n          onClick={downloadAll}\n          disabled={validUrlsCount === 0 || isProcessing}\n          className=\"flex-1\"\n        >\n          {isProcessing ? (\n            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n          ) : (\n            <Download className=\"w-4 h-4 mr-2\" />\n          )}\n          –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã ({validUrlsCount})\n        </Button>\n        \n        {onClose && (\n          <Button variant=\"outline\" onClick={onClose}>\n            –ó–∞–∫—Ä—ã—Ç—å\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":20001},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b border-border\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:no-underline hover:bg-muted/50 rounded-lg px-2 text-foreground\",\n        \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2\",\n        \"[&[data-state=open]>svg]:rotate-180 [&[data-state=open]]:bg-muted/30\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-300 text-muted-foreground group-hover:text-foreground\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":2252},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/auto-connection-panel.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { \n  Tooltip, \n  TooltipContent, \n  TooltipProvider, \n  TooltipTrigger \n} from '@/components/ui/tooltip';\nimport { \n  AlertCircle, \n  ArrowRight, \n  CheckCircle, \n  Link2, \n  Settings, \n  Sparkles, \n  Zap \n} from 'lucide-react';\nimport { Node, Connection } from '@/types/bot';\nimport { ConnectionManager, ConnectionSuggestion } from '@/utils/connection-manager';\n\ninterface AutoConnectionPanelProps {\n  nodes: Node[];\n  connections: Connection[];\n  onConnectionAdd: (connection: Connection) => void;\n  onNodesUpdate: (nodes: Node[]) => void;\n  autoButtonCreation: boolean;\n  onAutoButtonCreationChange: (enabled: boolean) => void;\n}\n\nexport function AutoConnectionPanel({\n  nodes,\n  connections,\n  onConnectionAdd,\n  onNodesUpdate,\n  autoButtonCreation,\n  onAutoButtonCreationChange\n}: AutoConnectionPanelProps) {\n  const [suggestions, setSuggestions] = useState<ConnectionSuggestion[]>([]);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [appliedSuggestions, setAppliedSuggestions] = useState<Set<string>>(new Set());\n\n  const connectionManager = new ConnectionManager({\n    nodes,\n    connections,\n    autoButtonCreation\n  });\n\n  useEffect(() => {\n    generateSuggestions();\n  }, [nodes, connections]);\n\n  const generateSuggestions = () => {\n    setIsGenerating(true);\n    try {\n      const newSuggestions = connectionManager.generateConnectionSuggestions();\n      setSuggestions(newSuggestions);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const applySuggestion = (suggestion: ConnectionSuggestion) => {\n    try {\n      const { connection, updatedNodes } = connectionManager.createConnection(\n        suggestion.connection.source,\n        suggestion.connection.target,\n        {\n          autoCreateButton: autoButtonCreation,\n          buttonText: suggestion.suggestedButton.text,\n          buttonAction: suggestion.suggestedButton.action\n        }\n      );\n\n      onConnectionAdd(connection);\n      onNodesUpdate(updatedNodes);\n      setAppliedSuggestions(prev => new Set([...prev, suggestion.id]));\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:', error);\n    }\n  };\n\n  const applyAllHighConfidence = () => {\n    const highConfidenceSuggestions = suggestions.filter(s => s.confidence > 0.8);\n    \n    highConfidenceSuggestions.forEach(suggestion => {\n      if (!appliedSuggestions.has(suggestion.id)) {\n        applySuggestion(suggestion);\n      }\n    });\n  };\n\n  const syncButtonsWithConnections = () => {\n    const updatedNodes = connectionManager.syncButtonsWithConnections();\n    onNodesUpdate(updatedNodes);\n  };\n\n  const cleanupOrphanedButtons = () => {\n    const updatedNodes = connectionManager.cleanupOrphanedButtons();\n    onNodesUpdate(updatedNodes);\n  };\n\n  const getNodeName = (nodeId: string) => {\n    const node = nodes.find(n => n.id === nodeId);\n    if (!node) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª';\n    \n    switch (node.type) {\n      case 'start': return '–°—Ç–∞—Ä—Ç';\n      case 'command': return node.data.command || '–ö–æ–º–∞–Ω–¥–∞';\n      case 'message': return node.data.messageText?.slice(0, 20) + '...' || '–°–æ–æ–±—â–µ–Ω–∏–µ';\n      case 'keyboard': return '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞';\n      case 'photo': return '–§–æ—Ç–æ';\n      case 'condition': return '–£—Å–ª–æ–≤–∏–µ';\n      case 'input': return '–í–≤–æ–¥';\n      default: return node.type;\n    }\n  };\n\n  const getConfidenceColor = (confidence: number) => {\n    if (confidence >= 0.8) return 'bg-green-500';\n    if (confidence >= 0.6) return 'bg-yellow-500';\n    return 'bg-red-500';\n  };\n\n  const getConfidenceText = (confidence: number) => {\n    if (confidence >= 0.8) return '–í—ã—Å–æ–∫–∞—è';\n    if (confidence >= 0.6) return '–°—Ä–µ–¥–Ω—è—è';\n    return '–ù–∏–∑–∫–∞—è';\n  };\n\n  return (\n    <Card className=\"w-full max-w-md\">\n      <CardHeader className=\"pb-4\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <Link2 className=\"h-5 w-5\" />\n            –ê–≤—Ç–æ—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n          </CardTitle>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={generateSuggestions}\n            disabled={isGenerating}\n          >\n            {isGenerating ? (\n              <Settings className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              <Sparkles className=\"h-4 w-4\" />\n            )}\n          </Button>\n        </div>\n        <CardDescription>\n          –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —É–∑–ª–∞–º–∏\n        </CardDescription>\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        {/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"space-y-1\">\n            <label className=\"text-sm font-medium\">–ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫</label>\n            <p className=\"text-xs text-muted-foreground\">\n              –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–µ–π\n            </p>\n          </div>\n          <Switch\n            checked={autoButtonCreation}\n            onCheckedChange={onAutoButtonCreationChange}\n          />\n        </div>\n\n        <Separator />\n\n        {/* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n        <div className=\"space-y-2\">\n          <h4 className=\"text-sm font-medium\">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>\n          <div className=\"grid grid-cols-2 gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={applyAllHighConfidence}\n              disabled={suggestions.filter(s => s.confidence > 0.8).length === 0}\n            >\n              <Zap className=\"h-4 w-4 mr-1\" />\n              –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª—É—á—à–∏–µ\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={syncButtonsWithConnections}\n            >\n              <CheckCircle className=\"h-4 w-4 mr-1\" />\n              –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å\n            </Button>\n          </div>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={cleanupOrphanedButtons}\n            className=\"w-full\"\n          >\n            <AlertCircle className=\"h-4 w-4 mr-1\" />\n            –û—á–∏—Å—Ç–∏—Ç—å –ª–∏—à–Ω–∏–µ –∫–Ω–æ–ø–∫–∏\n          </Button>\n        </div>\n\n        <Separator />\n\n        {/* –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è */}\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <h4 className=\"text-sm font-medium\">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h4>\n            <Badge variant=\"secondary\">{suggestions.length}</Badge>\n          </div>\n\n          {suggestions.length === 0 ? (\n            <div className=\"text-center py-6 text-muted-foreground\">\n              <Link2 className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n              <p className=\"text-sm\">–ù–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</p>\n            </div>\n          ) : (\n            <ScrollArea className=\"h-80\">\n              <div className=\"space-y-2\">\n                {suggestions.map((suggestion) => (\n                  <Card\n                    key={suggestion.id}\n                    className={`p-3 ${appliedSuggestions.has(suggestion.id) ? 'opacity-50' : ''}`}\n                  >\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <Badge\n                            variant=\"secondary\"\n                            className={`text-xs ${getConfidenceColor(suggestion.confidence)} text-white`}\n                          >\n                            {getConfidenceText(suggestion.confidence)}\n                          </Badge>\n                          {suggestion.autoCreate && (\n                            <TooltipProvider>\n                              <Tooltip>\n                                <TooltipTrigger>\n                                  <Sparkles className=\"h-4 w-4 text-yellow-500\" />\n                                </TooltipTrigger>\n                                <TooltipContent>\n                                  <p>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫ –∞–≤—Ç–æ–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é</p>\n                                </TooltipContent>\n                              </Tooltip>\n                            </TooltipProvider>\n                          )}\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => applySuggestion(suggestion)}\n                          disabled={appliedSuggestions.has(suggestion.id)}\n                        >\n                          {appliedSuggestions.has(suggestion.id) ? (\n                            <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                          ) : (\n                            '–ü—Ä–∏–º–µ–Ω–∏—Ç—å'\n                          )}\n                        </Button>\n                      </div>\n\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <span className=\"font-medium truncate\">\n                          {getNodeName(suggestion.connection.source)}\n                        </span>\n                        <ArrowRight className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"font-medium truncate\">\n                          {getNodeName(suggestion.connection.target)}\n                        </span>\n                      </div>\n\n                      <div className=\"text-xs text-muted-foreground\">\n                        {suggestion.reason}\n                      </div>\n\n                      {autoButtonCreation && (\n                        <div className=\"bg-muted p-2 rounded text-xs\">\n                          <div className=\"font-medium\">–°–æ–∑–¥–∞–≤–∞–µ–º–∞—è –∫–Ω–æ–ø–∫–∞:</div>\n                          <div className=\"flex items-center gap-1 mt-1\">\n                            <span className=\"bg-background px-2 py-1 rounded\">\n                              {suggestion.suggestedButton.text}\n                            </span>\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {suggestion.suggestedButton.action}\n                            </Badge>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            </ScrollArea>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":11089},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }","size_bytes":1127},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/canvas-node.tsx":{"content":"import { Node } from '@/types/bot';\nimport { cn } from '@/lib/utils';\nimport { useState, useRef, useEffect } from 'react';\n\n// Function to parse and render formatted text\nfunction parseFormattedText(text: string, formatMode?: string, markdown?: boolean): JSX.Element {\n  if (!text) return <span>{text}</span>;\n  \n  // –£–±—Ä–∞–ª–∏ debug –ª–æ–≥–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n  \n  // Remove HTML tags and replace with styled spans\n  const parseHTML = (htmlText: string): JSX.Element[] => {\n    const parts: JSX.Element[] = [];\n    let remaining = htmlText;\n    let key = 0;\n    \n    while (remaining.length > 0) {\n      // Bold text (both <b> and <strong> tags)\n      const boldMatch = remaining.match(/^(.*?)<(?:b|strong)>(.*?)<\\/(?:b|strong)>(.*)/);\n      if (boldMatch) {\n        if (boldMatch[1]) parts.push(<span key={key++}>{boldMatch[1]}</span>);\n        parts.push(<strong key={key++} className=\"font-bold\">{boldMatch[2]}</strong>);\n        remaining = boldMatch[3];\n        continue;\n      }\n      \n      // Italic text (both <i> and <em> tags)\n      const italicMatch = remaining.match(/^(.*?)<(?:i|em)>(.*?)<\\/(?:i|em)>(.*)/);\n      if (italicMatch) {\n        if (italicMatch[1]) parts.push(<span key={key++}>{italicMatch[1]}</span>);\n        parts.push(<em key={key++} className=\"italic\">{italicMatch[2]}</em>);\n        remaining = italicMatch[3];\n        continue;\n      }\n      \n      // Underline text\n      const underlineMatch = remaining.match(/^(.*?)<u>(.*?)<\\/u>(.*)/);\n      if (underlineMatch) {\n        if (underlineMatch[1]) parts.push(<span key={key++}>{underlineMatch[1]}</span>);\n        parts.push(<span key={key++} className=\"underline\">{underlineMatch[2]}</span>);\n        remaining = underlineMatch[3];\n        continue;\n      }\n      \n      // Strikethrough text\n      const strikeMatch = remaining.match(/^(.*?)<s>(.*?)<\\/s>(.*)/);\n      if (strikeMatch) {\n        if (strikeMatch[1]) parts.push(<span key={key++}>{strikeMatch[1]}</span>);\n        parts.push(<span key={key++} className=\"line-through\">{strikeMatch[2]}</span>);\n        remaining = strikeMatch[3];\n        continue;\n      }\n      \n      // Code text\n      const codeMatch = remaining.match(/^(.*?)<code>(.*?)<\\/code>(.*)/);\n      if (codeMatch) {\n        if (codeMatch[1]) parts.push(<span key={key++}>{codeMatch[1]}</span>);\n        parts.push(<code key={key++} className=\"bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-xs font-mono\">{codeMatch[2]}</code>);\n        remaining = codeMatch[3];\n        continue;\n      }\n      \n      // No more matches, add remaining text\n      parts.push(<span key={key++}>{remaining}</span>);\n      break;\n    }\n    \n    return parts;\n  };\n  \n  // Parse Markdown format\n  const parseMarkdown = (mdText: string): JSX.Element[] => {\n    const parts: JSX.Element[] = [];\n    let remaining = mdText;\n    let key = 0;\n    \n    while (remaining.length > 0) {\n      // Bold text\n      const boldMatch = remaining.match(/^(.*?)\\*\\*(.*?)\\*\\*(.*)/);\n      if (boldMatch) {\n        if (boldMatch[1]) parts.push(<span key={key++}>{boldMatch[1]}</span>);\n        parts.push(<strong key={key++} className=\"font-bold\">{boldMatch[2]}</strong>);\n        remaining = boldMatch[3];\n        continue;\n      }\n      \n      // Italic text\n      const italicMatch = remaining.match(/^(.*?)\\*(.*?)\\*(.*)/);\n      if (italicMatch) {\n        if (italicMatch[1]) parts.push(<span key={key++}>{italicMatch[1]}</span>);\n        parts.push(<em key={key++} className=\"italic\">{italicMatch[2]}</em>);\n        remaining = italicMatch[3];\n        continue;\n      }\n      \n      // Underline text\n      const underlineMatch = remaining.match(/^(.*?)__(.*?)__(.*)/);\n      if (underlineMatch) {\n        if (underlineMatch[1]) parts.push(<span key={key++}>{underlineMatch[1]}</span>);\n        parts.push(<span key={key++} className=\"underline\">{underlineMatch[2]}</span>);\n        remaining = underlineMatch[3];\n        continue;\n      }\n      \n      // Strikethrough text\n      const strikeMatch = remaining.match(/^(.*?)~~(.*?)~~(.*)/);\n      if (strikeMatch) {\n        if (strikeMatch[1]) parts.push(<span key={key++}>{strikeMatch[1]}</span>);\n        parts.push(<span key={key++} className=\"line-through\">{strikeMatch[2]}</span>);\n        remaining = strikeMatch[3];\n        continue;\n      }\n      \n      // Code text\n      const codeMatch = remaining.match(/^(.*?)`(.*?)`(.*)/);\n      if (codeMatch) {\n        if (codeMatch[1]) parts.push(<span key={key++}>{codeMatch[1]}</span>);\n        parts.push(<code key={key++} className=\"bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-xs font-mono\">{codeMatch[2]}</code>);\n        remaining = codeMatch[3];\n        continue;\n      }\n      \n      // No more matches, add remaining text\n      parts.push(<span key={key++}>{remaining}</span>);\n      break;\n    }\n    \n    return parts;\n  };\n  \n  // Determine formatting mode based on node properties\n  let shouldUseHTML = false;\n  \n  if (formatMode === 'html') {\n    shouldUseHTML = true;\n  } else if (formatMode === 'markdown') {\n    shouldUseHTML = false;\n  } else if (formatMode === 'none') {\n    // For 'none' mode, check if text contains HTML tags and parse them\n    // Look for common HTML tags used in formatting\n    const hasHTMLTags = text.includes('<b>') || text.includes('<i>') || text.includes('<u>') || \n                       text.includes('<s>') || text.includes('<code>') || text.includes('<strong>') || \n                       text.includes('<em>') || text.includes('<a href');\n    shouldUseHTML = hasHTMLTags;\n  } else if (markdown === true) {\n    // Legacy support for 'markdown' property\n    shouldUseHTML = false;\n  } else {\n    // Auto-detect: if text contains HTML formatting tags, use HTML parser\n    const hasHTMLTags = text.includes('<b>') || text.includes('<i>') || text.includes('<u>') || \n                       text.includes('<s>') || text.includes('<code>') || text.includes('<strong>') || \n                       text.includes('<em>') || text.includes('<a href');\n    shouldUseHTML = hasHTMLTags;\n  }\n  \n  \n  const parsedParts = shouldUseHTML ? parseHTML(text) : parseMarkdown(text);\n  \n  return <span>{parsedParts}</span>;\n}\n\ninterface CanvasNodeProps {\n  node: Node;\n  isSelected?: boolean;\n  onClick?: () => void;\n  onDelete?: () => void;\n  onDuplicate?: () => void;\n  onMove?: (position: { x: number; y: number }) => void;\n  onConnectionStart?: (nodeId: string, handle: 'source' | 'target') => void;\n  connectionStart?: {\n    nodeId: string;\n    handle: 'source' | 'target';\n  } | null;\n  zoom?: number;\n  pan?: { x: number; y: number };\n  setIsNodeBeingDragged?: (isDragging: boolean) => void;\n  onSizeChange?: (nodeId: string, size: { width: number; height: number }) => void;\n}\n\nconst nodeIcons = {\n  start: 'fas fa-play',\n  message: 'fas fa-comment',\n  photo: 'fas fa-image',\n  video: 'fas fa-video',\n  audio: 'fas fa-music',\n  document: 'fas fa-file-alt',\n  keyboard: 'fas fa-keyboard',\n  command: 'fas fa-terminal',\n  sticker: 'fas fa-laugh',\n  voice: 'fas fa-microphone',\n  animation: 'fas fa-film',\n  location: 'fas fa-map-marker-alt',\n  contact: 'fas fa-address-book',\n  pin_message: 'fas fa-thumbtack',\n  unpin_message: 'fas fa-times',\n  delete_message: 'fas fa-trash',\n  ban_user: 'fas fa-ban',\n  unban_user: 'fas fa-user-check',\n  mute_user: 'fas fa-volume-mute',\n  unmute_user: 'fas fa-volume-up',\n  kick_user: 'fas fa-user-times',\n  promote_user: 'fas fa-crown',\n  demote_user: 'fas fa-user-minus',\n  admin_rights: 'fas fa-user-shield'\n};\n\nconst nodeColors = {\n  start: 'bg-gradient-to-br from-emerald-50 to-green-100 dark:from-emerald-900/30 dark:to-green-900/30 text-emerald-600 dark:text-emerald-400 border border-emerald-200 dark:border-emerald-800',\n  message: 'bg-gradient-to-br from-blue-50 to-sky-100 dark:from-blue-900/30 dark:to-sky-900/30 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800',\n  photo: 'bg-gradient-to-br from-purple-50 to-violet-100 dark:from-purple-900/30 dark:to-violet-900/30 text-purple-600 dark:text-purple-400 border border-purple-200 dark:border-purple-800',\n  video: 'bg-gradient-to-br from-rose-50 to-pink-100 dark:from-rose-900/30 dark:to-pink-900/30 text-rose-600 dark:text-rose-400 border border-rose-200 dark:border-rose-800',\n  audio: 'bg-gradient-to-br from-orange-50 to-amber-100 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-600 dark:text-orange-400 border border-orange-200 dark:border-orange-800',\n  document: 'bg-gradient-to-br from-teal-50 to-cyan-100 dark:from-teal-900/30 dark:to-cyan-900/30 text-teal-600 dark:text-teal-400 border border-teal-200 dark:border-teal-800',\n  keyboard: 'bg-gradient-to-br from-amber-50 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/30 text-amber-600 dark:text-amber-400 border border-amber-200 dark:border-amber-800',\n  command: 'bg-gradient-to-br from-indigo-50 to-blue-100 dark:from-indigo-900/30 dark:to-blue-900/30 text-indigo-600 dark:text-indigo-400 border border-indigo-200 dark:border-indigo-800',\n  sticker: 'bg-gradient-to-br from-pink-50 to-fuchsia-100 dark:from-pink-900/30 dark:to-fuchsia-900/30 text-pink-600 dark:text-pink-400 border border-pink-200 dark:border-pink-800',\n  voice: 'bg-gradient-to-br from-emerald-50 to-teal-100 dark:from-emerald-900/30 dark:to-teal-900/30 text-emerald-600 dark:text-emerald-400 border border-emerald-200 dark:border-emerald-800',\n  animation: 'bg-gradient-to-br from-yellow-50 to-orange-100 dark:from-yellow-900/30 dark:to-orange-900/30 text-yellow-600 dark:text-yellow-400 border border-yellow-200 dark:border-yellow-800',\n  location: 'bg-gradient-to-br from-green-50 to-lime-100 dark:from-green-900/30 dark:to-lime-900/30 text-green-600 dark:text-green-400 border border-green-200 dark:border-green-800',\n  contact: 'bg-gradient-to-br from-sky-50 to-blue-100 dark:from-sky-900/30 dark:to-blue-900/30 text-sky-600 dark:text-sky-400 border border-sky-200 dark:border-sky-800',\n  pin_message: 'bg-gradient-to-br from-cyan-100 to-blue-200 dark:from-cyan-900/40 dark:to-blue-800/40 text-cyan-700 dark:text-cyan-300 border-2 border-cyan-300 dark:border-cyan-700/50 shadow-lg shadow-cyan-500/20',\n  unpin_message: 'bg-gradient-to-br from-slate-100 to-gray-200 dark:from-slate-900/40 dark:to-gray-800/40 text-slate-700 dark:text-slate-300 border-2 border-slate-300 dark:border-slate-700/50 shadow-lg shadow-slate-500/20',\n  delete_message: 'bg-gradient-to-br from-red-100 to-rose-200 dark:from-red-900/40 dark:to-rose-800/40 text-red-700 dark:text-red-300 border-2 border-red-300 dark:border-red-700/50 shadow-lg shadow-red-500/20',\n  ban_user: 'bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900/40 dark:to-red-800/40 text-red-700 dark:text-red-300 border-2 border-red-300 dark:border-red-700/50 shadow-lg shadow-red-500/20',\n  unban_user: 'bg-gradient-to-br from-emerald-100 to-green-200 dark:from-emerald-900/40 dark:to-green-800/40 text-emerald-700 dark:text-emerald-300 border-2 border-emerald-300 dark:border-emerald-700/50 shadow-lg shadow-emerald-500/20',\n  mute_user: 'bg-gradient-to-br from-orange-100 to-amber-200 dark:from-orange-900/40 dark:to-amber-800/40 text-orange-700 dark:text-orange-300 border-2 border-orange-300 dark:border-orange-700/50 shadow-lg shadow-orange-500/20',\n  unmute_user: 'bg-gradient-to-br from-sky-100 to-blue-200 dark:from-sky-900/40 dark:to-blue-800/40 text-sky-700 dark:text-sky-300 border-2 border-sky-300 dark:border-sky-700/50 shadow-lg shadow-sky-500/20',\n  kick_user: 'bg-gradient-to-br from-rose-100 to-pink-200 dark:from-rose-900/40 dark:to-pink-800/40 text-rose-700 dark:text-rose-300 border-2 border-rose-300 dark:border-rose-700/50 shadow-lg shadow-rose-500/20',\n  promote_user: 'bg-gradient-to-br from-yellow-100 to-amber-200 dark:from-yellow-900/40 dark:to-amber-800/40 text-yellow-700 dark:text-yellow-300 border-2 border-yellow-300 dark:border-yellow-700/50 shadow-lg shadow-yellow-500/20',\n  demote_user: 'bg-gradient-to-br from-slate-100 to-gray-200 dark:from-slate-900/40 dark:to-gray-800/40 text-slate-700 dark:text-slate-300 border-2 border-slate-300 dark:border-slate-700/50 shadow-lg shadow-slate-500/20',\n  admin_rights: 'bg-gradient-to-br from-violet-100 to-purple-200 dark:from-violet-900/40 dark:to-purple-800/40 text-violet-800 dark:text-violet-200 border-2 border-violet-300 dark:border-violet-700/50 shadow-xl shadow-violet-500/25 ring-1 ring-violet-400/30 dark:ring-violet-600/30'\n};\n\nexport function CanvasNode({ node, isSelected, onClick, onDelete, onDuplicate, onMove, onConnectionStart, connectionStart, zoom = 100, pan = { x: 0, y: 0 }, setIsNodeBeingDragged, onSizeChange }: CanvasNodeProps) {\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const nodeRef = useRef<HTMLDivElement>(null);\n  \n  // Touch —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n  const [isTouchDragging, setIsTouchDragging] = useState(false);\n  const [touchOffset, setTouchOffset] = useState({ x: 0, y: 0 });\n  const [touchStartTime, setTouchStartTime] = useState(0);\n  const [touchStartPos, setTouchStartPos] = useState({ x: 0, y: 0 });\n  const [touchMoved, setTouchMoved] = useState(false);\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (!onMove) return;\n    \n    // –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –¥—Ä–∞–≥ –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –ø–æ –∫–Ω–æ–ø–∫–µ —É–¥–∞–ª–µ–Ω–∏—è\n    if ((e.target as HTMLElement).closest('button')) return;\n    \n    // –ù–∞—Ö–æ–¥–∏–º –∫–∞–Ω–≤–∞—Å (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)\n    const transformedContainer = nodeRef.current?.parentElement;\n    const canvas = transformedContainer?.parentElement;\n    \n    if (canvas) {\n      const canvasRect = canvas.getBoundingClientRect();\n      const zoomFactor = zoom / 100;\n      \n      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–≤–∞—Å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö\n      const screenX = e.clientX - canvasRect.left;\n      const screenY = e.clientY - canvasRect.top;\n      \n      const canvasX = (screenX - pan.x) / zoomFactor;\n      const canvasY = (screenY - pan.y) / zoomFactor;\n      \n      setDragOffset({\n        x: canvasX - node.position.x,\n        y: canvasY - node.position.y\n      });\n      setIsDragging(true);\n      // –£–≤–µ–¥–æ–º–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è\n      if (setIsNodeBeingDragged) {\n        setIsNodeBeingDragged(true);\n      }\n    }\n    \n    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏\n    e.preventDefault();\n  };\n\n  const handleMouseMove = (e: MouseEvent) => {\n    if (!isDragging || !onMove) return;\n    \n    // –ù–∞—Ö–æ–¥–∏–º –∫–∞–Ω–≤–∞—Å (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)\n    const transformedContainer = nodeRef.current?.parentElement;\n    const canvas = transformedContainer?.parentElement;\n    \n    if (canvas && transformedContainer) {\n      const canvasRect = canvas.getBoundingClientRect();\n      \n      // –ü–æ–ª—É—á–∞–µ–º —ç–∫—Ä–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º—ã—à–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞–Ω–≤–∞—Å–∞\n      const screenX = e.clientX - canvasRect.left;\n      const screenY = e.clientY - canvasRect.top;\n      \n      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —ç–∫—Ä–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞–Ω–≤–∞—Å–∞ —Å —É—á–µ—Ç–æ–º –∑—É–º–∞ –∏ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏—è\n      const zoomFactor = zoom / 100;\n      const canvasX = (screenX - pan.x) / zoomFactor - dragOffset.x;\n      const canvasY = (screenY - pan.y) / zoomFactor - dragOffset.y;\n      \n      // –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ç–∫–µ (20px grid –≤ –∫–∞–Ω–≤–∞—Å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö)\n      const gridSize = 20;\n      const snappedX = Math.round(canvasX / gridSize) * gridSize;\n      const snappedY = Math.round(canvasY / gridSize) * gridSize;\n      \n      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö canvas —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ (–≤ –∫–∞–Ω–≤–∞—Å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö)\n      const minX = 20;\n      const minY = 20;\n      const maxX = Math.max(minX, (canvas.clientWidth / zoomFactor) - 340);\n      const maxY = Math.max(minY, Math.min(snappedY, (canvas.clientHeight / zoomFactor) - 220));\n      \n      const boundedX = Math.max(minX, Math.min(snappedX, maxX));\n      const boundedY = Math.max(minY, Math.min(snappedY, maxY));\n      \n      // –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ —É–±—Ä–∞–Ω –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n      \n      onMove({ x: boundedX, y: boundedY });\n    }\n  };\n\n  const handleMouseUp = () => {\n    setIsDragging(false);\n    // –£–≤–µ–¥–æ–º–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è\n    if (setIsNodeBeingDragged) {\n      setIsNodeBeingDragged(false);\n    }\n  };\n\n  // Touch –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n  const handleTouchStart = (e: React.TouchEvent) => {\n    // –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –ø–æ –∫–Ω–æ–ø–∫–µ\n    if ((e.target as HTMLElement).closest('button')) return;\n    \n    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞\n    e.preventDefault();\n    e.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ö–æ–ª—Å—Ç–∞\n    \n    const touch = e.touches[0];\n    if (!touch) return;\n    \n    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞—á–∞–ª–µ –∫–∞—Å–∞–Ω–∏—è\n    setTouchStartTime(Date.now());\n    setTouchStartPos({ x: touch.clientX, y: touch.clientY });\n    setTouchMoved(false);\n    \n    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ onMove –¥–æ—Å—Ç—É–ø–µ–Ω\n    if (onMove) {\n      // –ù–∞—Ö–æ–¥–∏–º –∫–∞–Ω–≤–∞—Å (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)\n      const transformedContainer = nodeRef.current?.parentElement;\n      const canvas = transformedContainer?.parentElement;\n      \n      if (canvas) {\n        const canvasRect = canvas.getBoundingClientRect();\n        const zoomFactor = zoom / 100;\n        \n        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–≤–∞—Å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö\n        const screenX = touch.clientX - canvasRect.left;\n        const screenY = touch.clientY - canvasRect.top;\n        \n        const canvasX = (screenX - pan.x) / zoomFactor;\n        const canvasY = (screenY - pan.y) / zoomFactor;\n        \n        setTouchOffset({\n          x: canvasX - node.position.x,\n          y: canvasY - node.position.y\n        });\n      }\n    }\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    const touch = e.touches[0];\n    if (!touch || !onMove) return;\n    \n    // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏ –∫–∞—Å–∞–Ω–∏—è\n    const deltaX = touch.clientX - touchStartPos.x;\n    const deltaY = touch.clientY - touchStartPos.y;\n    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n    \n    // –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –±–æ–ª—å—à–µ 10 –ø–∏–∫—Å–µ–ª–µ–π\n    if (distance > 10 && !isTouchDragging) {\n      setIsTouchDragging(true);\n      setTouchMoved(true);\n      // –£–≤–µ–¥–æ–º–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è\n      if (setIsNodeBeingDragged) {\n        setIsNodeBeingDragged(true);\n      }\n    }\n    \n    // –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –ø–æ —É–∑–ª—É, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–æ—Å—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ\n    e.preventDefault();\n    e.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ö–æ–ª—Å—Ç–∞\n    \n    if (!isTouchDragging) return;\n    \n    // –ù–∞—Ö–æ–¥–∏–º –∫–∞–Ω–≤–∞—Å (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)\n    const transformedContainer = nodeRef.current?.parentElement;\n    const canvas = transformedContainer?.parentElement;\n    \n    if (canvas && transformedContainer) {\n      const canvasRect = canvas.getBoundingClientRect();\n      \n      // –ü–æ–ª—É—á–∞–µ–º —ç–∫—Ä–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã touch –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞–Ω–≤–∞—Å–∞\n      const screenX = touch.clientX - canvasRect.left;\n      const screenY = touch.clientY - canvasRect.top;\n      \n      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —ç–∫—Ä–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞–Ω–≤–∞—Å–∞ —Å —É—á–µ—Ç–æ–º –∑—É–º–∞ –∏ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏—è\n      const zoomFactor = zoom / 100;\n      const canvasX = (screenX - pan.x) / zoomFactor - touchOffset.x;\n      const canvasY = (screenY - pan.y) / zoomFactor - touchOffset.y;\n      \n      // –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ç–∫–µ (20px grid –≤ –∫–∞–Ω–≤–∞—Å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö)\n      const gridSize = 20;\n      const snappedX = Math.round(canvasX / gridSize) * gridSize;\n      const snappedY = Math.round(canvasY / gridSize) * gridSize;\n      \n      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö canvas —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ (–≤ –∫–∞–Ω–≤–∞—Å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö)\n      const minX = 20;\n      const minY = 20;\n      const maxX = Math.max(minX, (canvas.clientWidth / zoomFactor) - 340);\n      const maxY = Math.max(minY, Math.min(snappedY, (canvas.clientHeight / zoomFactor) - 220));\n      \n      const boundedX = Math.max(minX, Math.min(snappedX, maxX));\n      const boundedY = Math.max(minY, Math.min(snappedY, maxY));\n      \n      onMove({ x: boundedX, y: boundedY });\n    }\n  };\n\n  const handleTouchEnd = (e: React.TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ\n    \n    const touchEndTime = Date.now();\n    const touchDuration = touchEndTime - touchStartTime;\n    \n    // –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ (–º–µ–Ω–µ–µ 300ms) –∏ –Ω–µ –±—ã–ª–æ –¥–≤–∏–∂–µ–Ω–∏—è, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –∫–ª–∏–∫\n    if (touchDuration < 300 && !touchMoved && onClick) {\n      onClick();\n    }\n    \n    setIsTouchDragging(false);\n    setTouchMoved(false);\n    // –£–≤–µ–¥–æ–º–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è\n    if (setIsNodeBeingDragged) {\n      setIsNodeBeingDragged(false);\n    }\n  };\n\n  // –î–æ–±–∞–≤–ª—è–µ–º –∏ —É–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è mouse\n  useEffect(() => {\n    if (isDragging) {\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n      document.body.style.cursor = 'grabbing';\n      document.body.style.userSelect = 'none';\n      \n      return () => {\n        document.removeEventListener('mousemove', handleMouseMove);\n        document.removeEventListener('mouseup', handleMouseUp);\n        document.body.style.cursor = '';\n        document.body.style.userSelect = '';\n      };\n    }\n  }, [isDragging, dragOffset, onMove]);\n\n  // Touch —Å–æ–±—ã—Ç–∏—è —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ handleTouchMove, –Ω–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏\n  useEffect(() => {\n    if (isTouchDragging) {\n      document.body.style.userSelect = 'none';\n      document.body.style.touchAction = 'none'; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏\n      \n      return () => {\n        document.body.style.userSelect = '';\n        document.body.style.touchAction = '';\n      };\n    }\n  }, [isTouchDragging]);\n\n  // ResizeObserver –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —É–∑–ª–∞\n  useEffect(() => {\n    if (!onSizeChange || !nodeRef.current) return;\n\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const { width, height } = entry.contentRect;\n        onSizeChange(node.id, { width, height });\n      }\n    });\n\n    resizeObserver.observe(nodeRef.current);\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, [node.id, onSizeChange]);\n\n  return (\n    <div\n      ref={nodeRef}\n      data-canvas-node=\"true\"\n      className={cn(\n        \"bg-white/90 dark:bg-slate-900/90 backdrop-blur-sm rounded-2xl shadow-xl border-2 p-6 w-80 transition-all duration-300 relative select-none group\",\n        isSelected ? \"border-blue-500 ring-4 ring-blue-500/20 shadow-2xl shadow-blue-500/10\" : \"border-gray-200 dark:border-slate-700\",\n        (isDragging || isTouchDragging) ? \"shadow-3xl scale-105 cursor-grabbing z-50 border-blue-500 bg-blue-50/50 dark:bg-blue-900/20\" : \"hover:shadow-2xl hover:border-gray-300 dark:hover:border-slate-600\",\n        onMove ? \"cursor-grab hover:cursor-grab\" : \"cursor-pointer\"\n      )}\n      onClick={!isDragging ? onClick : undefined}\n      onMouseDown={handleMouseDown}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n      style={{\n        position: 'absolute',\n        left: node.position.x,\n        top: node.position.y,\n        transform: (isDragging || isTouchDragging) ? 'rotate(2deg) scale(1.05)' : 'rotate(0deg) scale(1)',\n        zIndex: (isDragging || isTouchDragging) ? 1000 : isSelected ? 10 : 1,\n        transition: (isDragging || isTouchDragging) ? 'none' : 'all 0.2s ease'\n      }}\n    >\n      {/* Action buttons */}\n      {/* Copy button - left top */}\n      {onDuplicate && (\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            onDuplicate();\n          }}\n          className=\"absolute -top-2 -left-2 w-7 h-7 bg-white/95 dark:bg-slate-800/95 backdrop-blur-sm text-blue-600 dark:text-blue-400 rounded-xl flex items-center justify-center hover:bg-gradient-to-br hover:from-blue-50 hover:to-indigo-50 dark:hover:from-blue-900/40 dark:hover:to-indigo-900/40 hover:text-blue-700 dark:hover:text-blue-300 focus:bg-gradient-to-br focus:from-blue-100 focus:to-indigo-100 dark:focus:from-blue-800/50 dark:focus:to-indigo-800/50 active:scale-95 transition-all duration-300 shadow-lg hover:shadow-xl focus:shadow-2xl border border-blue-200/50 dark:border-blue-700/50 hover:border-blue-300 dark:hover:border-blue-600 focus:border-blue-400 dark:focus:border-blue-500 hover:scale-110 focus:scale-105 group opacity-0 group-hover:opacity-100 focus:opacity-100\"\n          title=\"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç\"\n        >\n          <i className=\"fas fa-copy text-xs transition-transform duration-200 group-hover:scale-110\"></i>\n        </button>\n      )}\n      \n      {/* Delete button - right top */}\n      {onDelete && (\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            onDelete();\n          }}\n          className=\"absolute -top-2 -right-2 w-7 h-7 bg-white/95 dark:bg-slate-800/95 backdrop-blur-sm text-red-600 dark:text-red-400 rounded-xl flex items-center justify-center hover:bg-gradient-to-br hover:from-red-50 hover:to-rose-50 dark:hover:from-red-900/40 dark:hover:to-rose-900/40 hover:text-red-700 dark:hover:text-red-300 focus:bg-gradient-to-br focus:from-red-100 focus:to-rose-100 dark:focus:from-red-800/50 dark:focus:to-rose-800/50 active:scale-95 transition-all duration-300 shadow-lg hover:shadow-xl focus:shadow-2xl border border-red-200/50 dark:border-red-700/50 hover:border-red-300 dark:hover:border-red-600 focus:border-red-400 dark:focus:border-red-500 hover:scale-110 focus:scale-105 group opacity-0 group-hover:opacity-100 focus:opacity-100\"\n          title=\"–£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç\"\n        >\n          <i className=\"fas fa-times text-xs transition-transform duration-200 group-hover:scale-110\"></i>\n        </button>\n      )}\n      \n\n      \n      {/* Node header */}\n      <div className=\"flex items-start mb-6 relative\">\n        <div className={cn(\"w-12 h-12 rounded-xl flex items-center justify-center mr-4 shadow-sm relative\", nodeColors[node.type])}>\n          <i className={cn(nodeIcons[node.type], \"text-lg\")}></i>\n          {/* Status indicators */}\n          <div className=\"absolute -top-1 -right-1 flex items-center space-x-1\">\n            {/* Conditional messages indicator */}\n            {node.data.enableConditionalMessages && node.data.conditionalMessages && node.data.conditionalMessages.length > 0 && (\n              <div className=\"w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center border-2 border-white dark:border-slate-900\" title={`–£—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: ${node.data.conditionalMessages.length}`}>\n                <i className=\"fas fa-code-branch text-white text-xs\"></i>\n              </div>\n            )}\n            \n            {/* Main status indicator */}\n            {(() => {\n              const hasRequiredFields = (() => {\n                switch (node.type) {\n                  case 'photo': return !!node.data.imageUrl;\n                  case 'video': return !!node.data.videoUrl;\n                  case 'audio': return !!node.data.audioUrl;\n                  case 'document': return !!node.data.documentUrl;\n                  case 'sticker': return !!(node.data.stickerUrl || node.data.stickerFileId);\n                  case 'voice': return !!node.data.voiceUrl;\n                  case 'animation': return !!node.data.animationUrl;\n                  case 'location': return !!(node.data.latitude && node.data.longitude);\n                  case 'contact': return !!(node.data.phoneNumber && node.data.firstName);\n                  case 'poll': return !!(node.data.question && node.data.options?.length);\n                  case 'command': return !!node.data.command;\n                  case 'admin_rights': return true;\n                  default: return !!node.data.messageText;\n                }\n              })();\n              \n              return hasRequiredFields ? (\n                <div className=\"w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-white dark:border-slate-900\">\n                  <i className=\"fas fa-check text-white text-xs\"></i>\n                </div>\n              ) : (\n                <div className=\"w-4 h-4 bg-orange-500 rounded-full flex items-center justify-center border-2 border-white dark:border-slate-900\">\n                  <i className=\"fas fa-exclamation text-white text-xs\"></i>\n                </div>\n              );\n            })()}\n          </div>\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center justify-between mb-1\">\n            <h3 className=\"font-semibold text-gray-800 dark:text-gray-200 text-base flex items-center truncate\">\n              {node.type === 'start' && (\n                <span className=\"inline-flex items-center\">\n                  <span className=\"text-emerald-600 dark:text-emerald-400 font-mono text-sm bg-emerald-50 dark:bg-emerald-900/30 px-2 py-1 rounded-lg border border-emerald-200 dark:border-emerald-800\">\n                    {node.data.command || '/start'}\n                  </span>\n                </span>\n              )}\n              {node.type === 'command' && (\n                <span className=\"inline-flex items-center\">\n                  <span className=\"text-indigo-600 dark:text-indigo-400 font-mono text-sm bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1 rounded-lg border border-indigo-200 dark:border-indigo-800\">\n                    {node.data.command}\n                  </span>\n                </span>\n              )}\n              {node.type === 'message' && '–°–æ–æ–±—â–µ–Ω–∏–µ'}\n              {node.type === 'photo' && '–§–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º'}\n              {node.type === 'video' && '–í–∏–¥–µ–æ —Å —Ç–µ–∫—Å—Ç–æ–º'}\n              {node.type === 'audio' && '–ê—É–¥–∏–æ —Å–æ–æ–±—â–µ–Ω–∏–µ'}\n              {node.type === 'document' && '–î–æ–∫—É–º–µ–Ω—Ç'}\n              {node.type === 'keyboard' && '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞'}\n              {node.type === 'sticker' && '–°—Ç–∏–∫–µ—Ä'}\n              {node.type === 'voice' && '–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'}\n              {node.type === 'animation' && 'GIF –∞–Ω–∏–º–∞—Ü–∏—è'}\n              {node.type === 'location' && '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è'}\n              {node.type === 'contact' && '–ö–æ–Ω—Ç–∞–∫—Ç'}\n              {(node.type === 'pin_message' || node.type === 'unpin_message' || node.type === 'delete_message') && (\n                <span className=\"inline-flex items-center\">\n                  <span className=\"text-cyan-600 dark:text-cyan-400 font-mono text-sm bg-cyan-50 dark:bg-cyan-900/30 px-2 py-1 rounded-lg border border-cyan-200 dark:border-cyan-800 mr-2\">\n                    {node.data.command || `/${node.type}`}\n                  </span>\n                  <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</span>\n                </span>\n              )}\n              {(node.type === 'ban_user' || node.type === 'unban_user' || node.type === 'mute_user' || \n                node.type === 'unmute_user' || node.type === 'kick_user' || node.type === 'promote_user' || \n                node.type === 'demote_user') && (\n                <span className=\"inline-flex items-center\">\n                  <span className=\"text-rose-600 dark:text-rose-400 font-mono text-sm bg-rose-50 dark:bg-rose-900/30 px-2 py-1 rounded-lg border border-rose-200 dark:border-rose-800 mr-2\">\n                    {node.data.command || `/${node.type}`}\n                  </span>\n                  <span>–î–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</span>\n                </span>\n              )}\n              {node.type === 'admin_rights' && (\n                <span className=\"inline-flex items-center\">\n                  <span className=\"text-violet-600 dark:text-violet-400 font-mono text-sm bg-violet-50 dark:bg-violet-900/30 px-2 py-1 rounded-lg border border-violet-200 dark:border-violet-800 mr-2\">\n                    {node.data.command || '/admin_rights'}\n                  </span>\n                  <span>–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞</span>\n                </span>\n              )}\n            </h3>\n            {onMove && (\n              <div className=\"ml-2 opacity-40 hover:opacity-70 transition-all duration-200 cursor-grab\">\n                <i className=\"fas fa-grip-vertical text-xs text-gray-400 dark:text-gray-500\"></i>\n              </div>\n            )}\n          </div>\n          {node.data.description && (\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 leading-relaxed\">\n              {parseFormattedText(node.data.description, node.data.formatMode, node.data.markdown)}\n            </p>\n          )}\n          \n          {/* –°–∏–Ω–æ–Ω–∏–º—ã */}\n          {node.data.synonyms && node.data.synonyms.length > 0 && (\n            <div className=\"mt-2\">\n              <div className=\"flex flex-wrap gap-1\">\n                {node.data.synonyms.slice(0, 3).map((synonym, index) => (\n                  <span\n                    key={index}\n                    className=\"inline-flex items-center px-2 py-1 rounded-md bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-700 dark:text-indigo-300 text-xs font-medium border border-indigo-200 dark:border-indigo-700/50\"\n                    title={`–°–∏–Ω–æ–Ω–∏–º: ${synonym}`}\n                  >\n                    <i className=\"fas fa-quote-left text-indigo-400 dark:text-indigo-500 mr-1\" style={{ fontSize: '8px' }}></i>\n                    {synonym}\n                  </span>\n                ))}\n                {node.data.synonyms.length > 3 && (\n                  <span\n                    className=\"inline-flex items-center px-2 py-1 rounded-md bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-900/20 dark:to-slate-900/20 text-gray-600 dark:text-gray-400 text-xs font-medium border border-gray-200 dark:border-gray-700/50\"\n                    title={`–ï—â—ë —Å–∏–Ω–æ–Ω–∏–º–æ–≤: ${node.data.synonyms.slice(3).join(', ')}`}\n                  >\n                    +{node.data.synonyms.length - 3}\n                  </span>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n      {/* Message preview */}\n      {node.data.messageText && (\n        <div className=\"rounded-xl p-4 mb-4 bg-gradient-to-br from-blue-50/80 to-sky-50/80 dark:from-blue-900/20 dark:to-sky-900/20 border border-blue-100 dark:border-blue-800/30\">\n          <div className=\"flex items-start space-x-2\">\n            <div className=\"w-2 h-2 rounded-full bg-blue-500 dark:bg-blue-400 mt-1.5 flex-shrink-0\"></div>\n            <div className=\"text-sm text-blue-700 dark:text-blue-300 leading-relaxed line-clamp-3 font-medium\">\n              {parseFormattedText(node.data.messageText, node.data.formatMode, node.data.markdown)}\n            </div>\n          </div>\n        </div>\n      )}\n      {/* Media previews */}\n      {node.type === 'photo' && (\n        <div className=\"bg-gradient-to-br from-purple-100/50 to-pink-100/50 dark:from-purple-900/30 dark:to-pink-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center border-2 border-dashed border-purple-200 dark:border-purple-700 hover:border-purple-300 dark:hover:border-purple-600 transition-colors group\">\n          {node.data.imageUrl ? (\n            <div className=\"relative w-full h-full\">\n              <img src={node.data.imageUrl} alt=\"Preview\" className=\"max-h-full max-w-full object-contain rounded-md shadow-sm\" />\n              <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 rounded-md flex items-center justify-center\">\n                <div className=\"opacity-0 group-hover:opacity-100 transition-opacity bg-white dark:bg-gray-800 rounded-full p-1 shadow-lg\">\n                  <i className=\"fas fa-edit text-purple-600 dark:text-purple-400 text-xs\"></i>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"text-center space-y-2\">\n              <i className=\"fas fa-cloud-upload-alt text-purple-400 dark:text-purple-300 text-3xl group-hover:scale-110 transition-transform\"></i>\n              <div className=\"text-xs text-purple-600 dark:text-purple-400 font-medium\">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>\n            </div>\n          )}\n        </div>\n      )}\n      \n      {/* Video preview */}\n      {node.type === 'video' && (\n        <div className=\"bg-gradient-to-br from-rose-100/50 to-pink-100/50 dark:from-rose-900/30 dark:to-pink-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center border-2 border-dashed border-rose-200 dark:border-rose-700 hover:border-rose-300 dark:hover:border-rose-600 transition-colors group\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-video text-rose-400 dark:text-rose-300 text-3xl group-hover:scale-110 transition-transform\"></i>\n            {node.data.videoUrl ? (\n              <div className=\"text-xs text-rose-600 dark:text-rose-400 space-y-1\">\n                <div className=\"font-medium flex items-center justify-center space-x-1\">\n                  <i className=\"fas fa-check-circle text-green-500 text-xs\"></i>\n                  <span>–í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</span>\n                </div>\n                {node.data.duration && (\n                  <div className=\"flex items-center justify-center space-x-1\">\n                    <i className=\"fas fa-clock text-xs\"></i>\n                    <span>{node.data.duration}—Å</span>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-xs text-rose-600 dark:text-rose-400 font-medium\">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Audio preview */}\n      {node.type === 'audio' && (\n        <div className=\"bg-gradient-to-br from-orange-100/50 to-amber-100/50 dark:from-orange-900/30 dark:to-amber-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center border-2 border-dashed border-orange-200 dark:border-orange-700 hover:border-orange-300 dark:hover:border-orange-600 transition-colors group\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-music text-orange-400 dark:text-orange-300 text-3xl group-hover:scale-110 transition-transform\"></i>\n            {node.data.audioUrl ? (\n              <div className=\"text-xs text-orange-600 dark:text-orange-400 space-y-1\">\n                <div className=\"font-medium flex items-center justify-center space-x-1\">\n                  <i className=\"fas fa-check-circle text-green-500 text-xs\"></i>\n                  <span>{node.data.title || '–ê—É–¥–∏–æ —Ç—Ä–µ–∫'}</span>\n                </div>\n                {node.data.performer && (\n                  <div className=\"flex items-center justify-center space-x-1\">\n                    <i className=\"fas fa-user text-xs\"></i>\n                    <span>{node.data.performer}</span>\n                  </div>\n                )}\n                {node.data.duration && (\n                  <div className=\"flex items-center justify-center space-x-1\">\n                    <i className=\"fas fa-clock text-xs\"></i>\n                    <span>{node.data.duration}—Å</span>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-xs text-orange-600 dark:text-orange-400 font-medium\">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Document preview */}\n      {node.type === 'document' && (\n        <div className=\"bg-gradient-to-br from-teal-100/50 to-cyan-100/50 dark:from-teal-900/30 dark:to-cyan-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center border-2 border-dashed border-teal-200 dark:border-teal-700 hover:border-teal-300 dark:hover:border-teal-600 transition-colors group\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-file-alt text-teal-400 dark:text-teal-300 text-3xl group-hover:scale-110 transition-transform\"></i>\n            {node.data.documentUrl ? (\n              <div className=\"text-xs text-teal-600 dark:text-teal-400 space-y-1\">\n                <div className=\"font-medium flex items-center justify-center space-x-1\">\n                  <i className=\"fas fa-check-circle text-green-500 text-xs\"></i>\n                  <span>{node.data.filename || '–î–æ–∫—É–º–µ–Ω—Ç'}</span>\n                </div>\n                {node.data.fileSize && (\n                  <div className=\"flex items-center justify-center space-x-1\">\n                    <i className=\"fas fa-hdd text-xs\"></i>\n                    <span>{node.data.fileSize} –ú–ë</span>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-xs text-teal-600 dark:text-teal-400 font-medium\">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Sticker preview */}\n      {node.type === 'sticker' && (\n        <div className=\"bg-gradient-to-br from-pink-100/50 to-fuchsia-100/50 dark:from-pink-900/30 dark:to-fuchsia-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-laugh text-pink-400 dark:text-pink-300 text-3xl\"></i>\n            {node.data.stickerUrl || node.data.stickerFileId ? (\n              <div className=\"text-xs text-pink-600 dark:text-pink-400 space-y-1\">\n                <div className=\"font-medium\">–°—Ç–∏–∫–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω</div>\n                <div className=\"flex items-center justify-center space-x-1\">\n                  <i className=\"fas fa-images text-xs\"></i>\n                  <span>–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</span>\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-xs text-pink-500 dark:text-pink-400\">–î–æ–±–∞–≤—å—Ç–µ URL —Å—Ç–∏–∫–µ—Ä–∞</div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Voice message preview */}\n      {node.type === 'voice' && (\n        <div className=\"bg-gradient-to-br from-emerald-100/50 to-teal-100/50 dark:from-emerald-900/30 dark:to-teal-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-microphone text-emerald-400 dark:text-emerald-300 text-3xl\"></i>\n            {node.data.voiceUrl ? (\n              <div className=\"text-xs text-emerald-600 dark:text-emerald-400 space-y-1\">\n                <div className=\"font-medium\">–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</div>\n                {node.data.duration && (\n                  <div className=\"flex items-center justify-center space-x-1\">\n                    <i className=\"fas fa-clock text-xs\"></i>\n                    <span>{node.data.duration}—Å</span>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-xs text-emerald-500 dark:text-emerald-400\">–î–æ–±–∞–≤—å—Ç–µ URL –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Animation preview */}\n      {node.type === 'animation' && (\n        <div className=\"bg-gradient-to-br from-yellow-100/50 to-orange-100/50 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-film text-yellow-400 dark:text-yellow-300 text-3xl\"></i>\n            {node.data.animationUrl ? (\n              <div className=\"text-xs text-yellow-600 dark:text-yellow-400 space-y-1\">\n                <div className=\"font-medium\">GIF –∞–Ω–∏–º–∞—Ü–∏—è</div>\n                {node.data.duration && (\n                  <div className=\"flex items-center justify-center space-x-1\">\n                    <i className=\"fas fa-clock text-xs\"></i>\n                    <span>{node.data.duration}—Å</span>\n                  </div>\n                )}\n                {node.data.width && node.data.height && (\n                  <div className=\"flex items-center justify-center space-x-1\">\n                    <i className=\"fas fa-expand text-xs\"></i>\n                    <span>{node.data.width}x{node.data.height}</span>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-xs text-yellow-500 dark:text-yellow-400\">–î–æ–±–∞–≤—å—Ç–µ URL GIF –∞–Ω–∏–º–∞—Ü–∏–∏</div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Location preview */}\n      {node.type === 'location' && (\n        <div className=\"bg-gradient-to-br from-green-100/50 to-lime-100/50 dark:from-green-900/30 dark:to-lime-900/30 rounded-lg p-3 mb-4 flex flex-col justify-center space-y-2\">\n          <div className=\"flex items-center justify-center space-x-2\">\n            <i className=\"fas fa-map-marker-alt text-green-400 dark:text-green-300 text-2xl\"></i>\n            {node.data.mapService && node.data.mapService !== 'custom' && (\n              <div className=\"flex items-center space-x-1\">\n                {node.data.mapService === 'yandex' && (\n                  <span className=\"text-xs px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-full font-medium border border-yellow-200 dark:border-yellow-800\">\n                    –Ø–Ω–¥–µ–∫—Å\n                  </span>\n                )}\n                {node.data.mapService === 'google' && (\n                  <span className=\"text-xs px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full font-medium border border-blue-200 dark:border-blue-800\">\n                    Google\n                  </span>\n                )}\n                {node.data.mapService === '2gis' && (\n                  <span className=\"text-xs px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full font-medium border border-green-200 dark:border-green-800\">\n                    2–ì–ò–°\n                  </span>\n                )}\n              </div>\n            )}\n          </div>\n          \n          <div className=\"text-xs text-green-600 dark:text-green-400 space-y-1 text-center\">\n            <div className=\"font-medium text-sm\">{node.data.title || '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è'}</div>\n            \n            {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å */}\n            {node.data.latitude && node.data.longitude && (\n              <div className=\"flex items-center justify-center space-x-1\">\n                <i className=\"fas fa-crosshairs text-xs\"></i>\n                <span className=\"font-mono text-xs\">\n                  {parseFloat(node.data.latitude as string).toFixed(4)}, {parseFloat(node.data.longitude as string).toFixed(4)}\n                </span>\n              </div>\n            )}\n            \n            {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å */}\n            {node.data.address && (\n              <div className=\"flex items-center justify-center space-x-1\">\n                <i className=\"fas fa-map text-xs\"></i>\n                <span className=\"truncate max-w-32 text-xs\">{node.data.address}</span>\n              </div>\n            )}\n            \n            {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —á—Ç–æ URL –∑–∞–≥—Ä—É–∂–µ–Ω */}\n            {(node.data.yandexMapUrl || node.data.googleMapUrl || node.data.gisMapUrl) && (\n              <div className=\"flex items-center justify-center space-x-1\">\n                <i className=\"fas fa-link text-xs text-green-500\"></i>\n                <span className=\"text-xs opacity-75\">URL –∑–∞–≥—Ä—É–∂–µ–Ω</span>\n              </div>\n            )}\n            \n            {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ */}\n            {node.data.generateMapPreview && (\n              <div className=\"flex items-center justify-center space-x-1\">\n                <i className=\"fas fa-external-link-alt text-xs text-blue-500\"></i>\n                <span className=\"text-xs opacity-75\">–ö–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç</span>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Contact preview */}\n      {node.type === 'contact' && (\n        <div className=\"bg-gradient-to-br from-sky-100/50 to-blue-100/50 dark:from-sky-900/30 dark:to-blue-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-address-book text-sky-400 dark:text-sky-300 text-3xl\"></i>\n            <div className=\"text-xs text-sky-600 dark:text-sky-400 space-y-1\">\n              <div className=\"font-medium\">{node.data.firstName} {node.data.lastName}</div>\n              {node.data.phoneNumber && (\n                <div className=\"flex items-center justify-center space-x-1\">\n                  <i className=\"fas fa-phone text-xs\"></i>\n                  <span>{node.data.phoneNumber}</span>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Admin Rights preview */}\n      {node.type === 'admin_rights' && (\n        <div className=\"bg-gradient-to-br from-violet-50/80 to-purple-50/80 dark:from-violet-900/25 dark:to-purple-900/25 border border-violet-200/50 dark:border-violet-800/40 rounded-xl p-4 mb-4 shadow-sm\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"w-6 h-6 rounded-full bg-violet-100 dark:bg-violet-900/60 flex items-center justify-center\">\n                <i className=\"fas fa-user-shield text-violet-600 dark:text-violet-400 text-sm\"></i>\n              </div>\n              <div className=\"text-sm font-semibold text-violet-800 dark:text-violet-200\">\n                –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n              </div>\n            </div>\n            <div className=\"text-xs text-violet-600 dark:text-violet-400 bg-violet-100 dark:bg-violet-900/50 px-2 py-1 rounded-full font-medium\">\n              11 –∫–Ω–æ–ø–æ–∫\n            </div>\n          </div>\n          \n          <div className=\"space-y-3\">\n            <div className=\"flex items-center space-x-2 mb-3\">\n              <div className=\"w-1 h-4 bg-amber-500 dark:bg-amber-400 rounded-full\"></div>\n              <span className=\"text-xs font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide\">\n                Inline –∫–Ω–æ–ø–∫–∏\n              </span>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-2\">\n              {[\n                { key: 'can_change_info', name: 'üè∑Ô∏è –ü—Ä–æ—Ñ–∏–ª—å' },\n                { key: 'can_delete_messages', name: 'üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ' },\n                { key: 'can_restrict_members', name: 'üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞' },\n                { key: 'can_invite_users', name: 'üì® –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è' },\n                { key: 'can_pin_messages', name: 'üìå –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ' },\n                { key: 'can_manage_video_chats', name: 'üé• –í–∏–¥–µ–æ—á–∞—Ç—ã' }\n              ].map((right, index) => (\n                <div key={right.key} className=\"group relative\">\n                  <div className=\"p-3 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg text-xs font-medium text-blue-700 dark:text-blue-300 text-center border border-blue-200 dark:border-blue-800 hover:border-blue-300 dark:hover:border-blue-700 transition-all duration-200 shadow-sm\">\n                    <div className=\"flex items-center justify-center space-x-1\">\n                      <span className=\"truncate\">{right.name}</span>\n                      <i className=\"fas fa-chevron-right text-blue-500 dark:text-blue-400 text-xs opacity-70\"></i>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n            \n            {/* –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –µ—Å—Ç—å –µ—â–µ –∫–Ω–æ–ø–∫–∏ */}\n            <div className=\"text-xs text-gray-500 dark:text-gray-400 text-center py-1 font-medium\">\n              <span className=\"inline-flex items-center px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded-full\">\n                +5 –µ—â–µ\n              </span>\n            </div>\n          </div>\n          \n          {/* Additional info */}\n          <div className=\"mt-3 pt-3 border-t border-violet-200/50 dark:border-violet-700/30\">\n            <div className=\"flex items-center justify-center space-x-3 text-xs text-violet-600 dark:text-violet-400\">\n              <div className=\"flex items-center space-x-1\">\n                <i className=\"fas fa-toggle-on\"></i>\n                <span>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏</span>\n              </div>\n              <div className=\"flex items-center space-x-1\">\n                <i className=\"fas fa-sync-alt\"></i>\n                <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Poll preview */}\n      {node.type === 'poll' && (\n        <div className=\"bg-gradient-to-br from-violet-100/50 to-purple-100/50 dark:from-violet-900/30 dark:to-purple-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-poll text-violet-400 dark:text-violet-300 text-3xl\"></i>\n            <div className=\"text-xs text-violet-600 dark:text-violet-400 space-y-1\">\n              <div className=\"font-medium\">{node.data.question || '–û–ø—Ä–æ—Å'}</div>\n              {node.data.options && node.data.options.length > 0 && (\n                <div className=\"flex items-center justify-center space-x-1\">\n                  <i className=\"fas fa-list text-xs\"></i>\n                  <span>{node.data.options.length} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</span>\n                </div>\n              )}\n              {node.data.allowsMultipleAnswers && (\n                <div className=\"text-xs text-violet-500 dark:text-violet-400\">–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä</div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Dice preview */}\n      {node.type === 'dice' && (\n        <div className=\"bg-gradient-to-br from-slate-100/50 to-gray-100/50 dark:from-slate-900/30 dark:to-gray-900/30 rounded-lg p-4 mb-4 h-32 flex items-center justify-center\">\n          <div className=\"text-center space-y-2\">\n            <i className=\"fas fa-dice text-slate-400 dark:text-slate-300 text-3xl\"></i>\n            <div className=\"text-xs text-slate-600 dark:text-slate-400 space-y-1\">\n              <div className=\"font-medium\">–ò–≥—Ä–∞–ª—å–Ω—ã–π –∫—É–±–∏–∫</div>\n              <div className=\"flex items-center justify-center space-x-1\">\n                <i className=\"fas fa-gamepad text-xs\"></i>\n                <span>{node.data.emoji || 'üé≤'} –†–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* User Input preview */}\n      {false && (\n        <div className=\"bg-gradient-to-br from-purple-50/70 to-indigo-50/70 dark:from-purple-900/30 dark:to-indigo-900/30 rounded-xl p-4 mb-4 border border-purple-200 dark:border-purple-800/30\">\n          <div className=\"space-y-3\">\n            {/* Input type and variable display */}\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center\">\n                  <i className=\"fas fa-edit text-purple-600 dark:text-purple-400 text-xs\"></i>\n                </div>\n                <div className=\"text-sm font-medium text-purple-800 dark:text-purple-200\">\n                  {node.data.inputType ? (\n                    <span className=\"capitalize\">\n                      {node.data.inputType === 'text' && '–¢–µ–∫—Å—Ç'}\n                      {node.data.inputType === 'number' && '–ß–∏—Å–ª–æ'}\n                      {node.data.inputType === 'email' && 'Email'}\n                      {node.data.inputType === 'phone' && '–¢–µ–ª–µ—Ñ–æ–Ω'}\n                      {node.data.inputType === 'photo' && '–§–æ—Ç–æ'}\n                      {node.data.inputType === 'video' && '–í–∏–¥–µ–æ'}\n                      {node.data.inputType === 'audio' && '–ê—É–¥–∏–æ'}\n                      {node.data.inputType === 'document' && '–î–æ–∫—É–º–µ–Ω—Ç'}\n                      {node.data.inputType === 'location' && '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'}\n                      {node.data.inputType === 'contact' && '–ö–æ–Ω—Ç–∞–∫—Ç'}\n                      {node.data.inputType === 'any' && '–õ—é–±–æ–π —Ç–∏–ø'}\n                    </span>\n                  ) : (\n                    '–¢–∏–ø –≤–≤–æ–¥–∞'\n                  )}\n                </div>\n              </div>\n              {(node.data as any).variableName && (\n                <div className=\"text-xs font-mono text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/50 px-2 py-1 rounded\">\n                  ${(node.data as any).variableName}\n                </div>\n              )}\n            </div>\n\n            {/* Response type indicator */}\n            {node.data.responseType && (\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-5 h-5 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center\">\n                  <i className={cn(\n                    \"text-indigo-600 dark:text-indigo-400 text-xs\",\n                    node.data.responseType === 'text' ? 'fas fa-keyboard' : 'fas fa-mouse-pointer'\n                  )}></i>\n                </div>\n                <div className=\"text-xs text-indigo-700 dark:text-indigo-300\">\n                  {node.data.responseType === 'text' ? '–¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥' : '–ö–Ω–æ–ø–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç'}\n                </div>\n              </div>\n            )}\n\n            {/* Button options preview */}\n            {node.data.responseType === 'buttons' && node.data.responseOptions && node.data.responseOptions.length > 0 && (\n              <div className=\"space-y-2\">\n                <div className=\"text-xs text-gray-600 dark:text-gray-400 font-medium\">–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:</div>\n                <div className=\"flex flex-wrap gap-1\">\n                  {node.data.responseOptions.slice(0, 3).map((option, index) => (\n                    <div key={index} className=\"text-xs bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 px-2 py-1 rounded-full\">\n                      {option.text}\n                    </div>\n                  ))}\n                  {node.data.responseOptions.length > 3 && (\n                    <div className=\"text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full\">\n                      +{node.data.responseOptions.length - 3} –µ—â–µ\n                    </div>\n                  )}\n                </div>\n                {node.data.allowMultipleSelection && (\n                  <div className=\"text-xs text-indigo-600 dark:text-indigo-400 flex items-center space-x-1\">\n                    <i className=\"fas fa-check-double text-xs\"></i>\n                    <span>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä</span>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Validation info */}\n            {((node.data as any).minLength || (node.data as any).maxLength || (node.data as any).timeout) && (\n              <div className=\"flex items-center space-x-3 text-xs text-gray-600 dark:text-gray-400\">\n                {(node.data as any).minLength && (\n                  <div className=\"flex items-center space-x-1\">\n                    <i className=\"fas fa-arrow-up text-xs\"></i>\n                    <span>–ú–∏–Ω: {(node.data as any).minLength}</span>\n                  </div>\n                )}\n                {(node.data as any).maxLength && (\n                  <div className=\"flex items-center space-x-1\">\n                    <i className=\"fas fa-arrow-down text-xs\"></i>\n                    <span>–ú–∞–∫—Å: {(node.data as any).maxLength}</span>\n                  </div>\n                )}\n                {(node.data as any).timeout && (\n                  <div className=\"flex items-center space-x-1\">\n                    <i className=\"fas fa-clock text-xs\"></i>\n                    <span>{(node.data as any).timeout}—Å</span>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Save to database indicator */}\n            {(node.data as any).saveToDatabase && (\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-4 h-4 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center\">\n                  <i className=\"fas fa-database text-green-600 dark:text-green-400 text-xs\"></i>\n                </div>\n                <div className=\"text-xs text-green-700 dark:text-green-300\">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î</div>\n              </div>\n            )}\n\n            {/* Configuration status */}\n            {!((node.data as any).inputType && (node.data as any).variableName) && (\n              <div className=\"flex items-center space-x-2 text-orange-600 dark:text-orange-400\">\n                <i className=\"fas fa-exclamation-triangle text-xs\"></i>\n                <div className=\"text-xs\">–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞</div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Conditional Messages Indicator */}\n      {node.data.enableConditionalMessages && node.data.conditionalMessages && node.data.conditionalMessages.length > 0 && (\n        <div className=\"bg-gradient-to-br from-purple-50/90 to-indigo-50/90 dark:from-purple-900/25 dark:to-indigo-900/25 border border-purple-200/50 dark:border-purple-800/40 rounded-xl p-4 mb-4 shadow-sm\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/60 flex items-center justify-center\">\n                <i className=\"fas fa-code-branch text-purple-600 dark:text-purple-400 text-sm\"></i>\n              </div>\n              <div className=\"text-sm font-semibold text-purple-800 dark:text-purple-200\">\n                –£—Å–ª–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n              </div>\n            </div>\n            <div className=\"text-xs text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/50 px-2 py-1 rounded-full font-medium\">\n              {node.data.conditionalMessages.length} –ø—Ä–∞–≤–∏–ª{node.data.conditionalMessages.length === 1 ? '–æ' : node.data.conditionalMessages.length < 5 ? '–∞' : ''}\n            </div>\n          </div>\n          \n          <div className=\"space-y-2\">\n            {node.data.conditionalMessages\n              .sort((a, b) => (b.priority || 0) - (a.priority || 0))\n              .slice(0, 3)\n              .map((condition, index) => {\n                const getConditionIcon = (conditionType: string) => {\n                  switch(conditionType) {\n                    case 'user_data_equals': return 'fas fa-equals';\n                    case 'user_data_contains': return 'fas fa-search';\n                    case 'user_data_exists': return 'fas fa-check-circle';\n                    case 'user_data_not_exists': return 'fas fa-times-circle';\n                    case 'first_time': return 'fas fa-user-plus';\n                    case 'returning_user': return 'fas fa-user-check';\n                    default: return 'fas fa-filter';\n                  }\n                };\n\n                const getConditionColor = (conditionType: string) => {\n                  switch(conditionType) {\n                    case 'user_data_equals': return 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30';\n                    case 'user_data_contains': return 'text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30';\n                    case 'user_data_exists': return 'text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/30';\n                    case 'user_data_not_exists': return 'text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/30';\n                    case 'first_time': return 'text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/30';\n                    case 'returning_user': return 'text-cyan-600 dark:text-cyan-400 bg-cyan-50 dark:bg-cyan-900/30';\n                    default: return 'text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/30';\n                  }\n                };\n\n                const conditionName = {\n                  'user_data_equals': '–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ',\n                  'user_data_contains': '–°–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç',\n                  'user_data_exists': '–ò–º—è –≤–≤–µ–¥–µ–Ω–æ —Ä–∞–Ω–µ–µ',\n                  'user_data_not_exists': '–ò–º—è –Ω–µ –≤–≤–µ–¥–µ–Ω–æ',\n                  'first_time': '–ü–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ',\n                  'returning_user': '–í–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'\n                }[condition.condition] || '–£—Å–ª–æ–≤–∏–µ';\n\n                return (\n                  <div key={condition.id || index} className=\"bg-white/60 dark:bg-slate-900/40 rounded-lg border border-purple-100 dark:border-purple-800/30 p-3 hover:bg-white/80 dark:hover:bg-slate-900/60 transition-colors\">\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <div className=\"flex items-center space-x-2 flex-1\">\n                        <div className={cn(\"w-5 h-5 rounded-full flex items-center justify-center text-xs\", getConditionColor(condition.condition))}>\n                          <i className={getConditionIcon(condition.condition)}></i>\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"text-xs font-medium text-slate-700 dark:text-slate-300 truncate\">\n                            {conditionName}\n                          </div>\n                          {(condition as any).variableName && (\n                            <div className=\"text-xs text-slate-500 dark:text-slate-400 flex items-center space-x-1 mt-1\">\n                              <i className=\"fas fa-tag text-xs\"></i>\n                              <code className=\"bg-slate-100 dark:bg-slate-800 px-1 py-0.5 rounded text-xs\">{(condition as any).variableName}</code>\n                              {(condition as any).value && (\n                                <>\n                                  <span>=</span>\n                                  <span className=\"truncate max-w-[60px]\">\"{(condition as any).value}\"</span>\n                                </>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center space-x-2 ml-2\">\n                        <div className=\"text-xs font-medium text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/50 px-2 py-1 rounded\">\n                          #{condition.priority || 0}\n                        </div>\n                      </div>\n                    </div>\n                    \n                    {condition.messageText && (\n                      <div className=\"bg-slate-50/70 dark:bg-slate-800/50 rounded p-2 border border-slate-200/50 dark:border-slate-700/50\">\n                        <div className=\"text-xs text-slate-600 dark:text-slate-400 mb-1 flex items-center space-x-1\">\n                          <i className=\"fas fa-comment text-xs\"></i>\n                          <span className=\"font-medium\">–°–æ–æ–±—â–µ–Ω–∏–µ:</span>\n                        </div>\n                        <div className=\"text-xs text-slate-700 dark:text-slate-300 leading-relaxed line-clamp-2\">\n                          {condition.messageText}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            \n            {node.data.conditionalMessages.length > 3 && (\n              <div className=\"text-center py-2\">\n                <div className=\"text-xs text-purple-600 dark:text-purple-400 bg-purple-100/70 dark:bg-purple-900/30 px-3 py-2 rounded-lg border border-purple-200/30 dark:border-purple-800/30 inline-flex items-center space-x-1\">\n                  <i className=\"fas fa-ellipsis-h text-xs\"></i>\n                  <span>–ï—â–µ {node.data.conditionalMessages.length - 3} —É—Å–ª–æ–≤–∏–π</span>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Content Management Action Preview */}\n      {(node.type === 'pin_message' || node.type === 'unpin_message' || node.type === 'delete_message') && (\n        <div className=\"bg-gradient-to-br from-blue-50/80 to-cyan-50/80 dark:from-blue-900/30 dark:to-cyan-900/30 rounded-xl p-4 mb-4 border border-blue-200 dark:border-blue-700/50 shadow-sm\">\n          <div className=\"flex items-start space-x-3\">\n            <div className={cn(\"w-10 h-10 rounded-xl flex items-center justify-center shadow-sm\", nodeColors[node.type])}>\n              <i className={cn(nodeIcons[node.type], \"text-lg\")}></i>\n            </div>\n            <div className=\"flex-1 space-y-3\">\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-sm font-semibold text-gray-800 dark:text-gray-200\">\n                  {node.type === 'pin_message' && '–ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ'}\n                  {node.type === 'unpin_message' && '–û—Ç–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ'}\n                  {node.type === 'delete_message' && '–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ'}\n                </span>\n                <div className=\"h-1.5 w-1.5 rounded-full bg-current opacity-30\"></div>\n                <span className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium\">\n                  –ö–æ–Ω—Ç–µ–Ω—Ç\n                </span>\n              </div>\n              \n              {/* Target Info */}\n              <div className=\"space-y-2\">\n                {node.data.targetGroupId && (\n                  <div className=\"flex items-center space-x-2 text-xs\">\n                    <i className=\"fas fa-users text-blue-500 dark:text-blue-400\"></i>\n                    <span className=\"text-gray-600 dark:text-gray-400\">–ì—Ä—É–ø–ø–∞:</span>\n                    <code className=\"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded font-mono\">\n                      {node.data.targetGroupId}\n                    </code>\n                  </div>\n                )}\n                {node.data.targetMessageId && (\n                  <div className=\"flex items-center space-x-2 text-xs\">\n                    <i className=\"fas fa-comment text-purple-500 dark:text-purple-400\"></i>\n                    <span className=\"text-gray-600 dark:text-gray-400\">–°–æ–æ–±—â–µ–Ω–∏–µ:</span>\n                    <code className=\"bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-1 rounded font-mono\">\n                      {node.data.targetMessageId}\n                    </code>\n                  </div>\n                )}\n              </div>\n              \n              {/* Action Status */}\n              <div className=\"flex items-center space-x-2 pt-2 border-t border-blue-200/50 dark:border-blue-700/50\">\n                {(() => {\n                  // –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –≥–æ—Ç–æ–≤—ã –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é - ID –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\n                  const isReady = true;\n                  \n                  return (\n                    <>\n                      <div className={cn(\n                        \"w-2 h-2 rounded-full\",\n                        \"bg-green-500\"\n                      )}></div>\n                      <span className=\"text-xs font-medium\">\n                        <span className=\"text-green-600 dark:text-green-400\">–ì–æ—Ç–æ–≤–æ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</span>\n                      </span>\n                    </>\n                  );\n                })()}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* User Management Action Preview */}\n      {(node.type === 'ban_user' || node.type === 'unban_user' || node.type === 'kick_user' || node.type === 'mute_user' || node.type === 'unmute_user' || node.type === 'promote_user' || node.type === 'demote_user') && (\n        <div className=\"bg-gradient-to-br from-gray-50/80 to-slate-50/80 dark:from-gray-900/30 dark:to-slate-900/30 rounded-xl p-4 mb-4 border border-gray-200 dark:border-gray-700/50 shadow-sm\">\n          <div className=\"flex items-start space-x-3\">\n            <div className={cn(\"w-10 h-10 rounded-xl flex items-center justify-center shadow-sm\", nodeColors[node.type])}>\n              <i className={cn(nodeIcons[node.type], \"text-lg\")}></i>\n            </div>\n            <div className=\"flex-1 space-y-3\">\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-sm font-semibold text-gray-800 dark:text-gray-200\">\n                  {node.type === 'ban_user' && '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'}\n                  {node.type === 'unban_user' && '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'}\n                  {node.type === 'kick_user' && '–ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'}\n                  {node.type === 'mute_user' && '–ó–∞–≥–ª—É—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'}\n                  {node.type === 'unmute_user' && '–†–∞–∑—Ä–µ—à–∏—Ç—å –≥–æ–≤–æ—Ä–∏—Ç—å'}\n                  {node.type === 'promote_user' && '–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º'}\n                  {node.type === 'demote_user' && '–°–Ω—è—Ç—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞'}\n                </span>\n                <div className=\"h-1.5 w-1.5 rounded-full bg-current opacity-30\"></div>\n                <span className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium\">\n                  –î–µ–π—Å—Ç–≤–∏–µ\n                </span>\n              </div>\n              \n              {/* Target Info */}\n              <div className=\"space-y-2\">\n                {node.data.targetGroupId && (\n                  <div className=\"flex items-center space-x-2 text-xs\">\n                    <i className=\"fas fa-users text-blue-500 dark:text-blue-400\"></i>\n                    <span className=\"text-gray-600 dark:text-gray-400\">–ì—Ä—É–ø–ø–∞:</span>\n                    <code className=\"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded font-mono\">\n                      {node.data.targetGroupId}\n                    </code>\n                  </div>\n                )}\n                {node.data.targetUserId && (\n                  <div className=\"flex items-center space-x-2 text-xs\">\n                    <i className=\"fas fa-user text-purple-500 dark:text-purple-400\"></i>\n                    <span className=\"text-gray-600 dark:text-gray-400\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span>\n                    <code className=\"bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-1 rounded font-mono\">\n                      {node.data.targetUserId}\n                    </code>\n                  </div>\n                )}\n                {node.data.reason && (\n                  <div className=\"flex items-start space-x-2 text-xs\">\n                    <i className=\"fas fa-comment-dots text-orange-500 dark:text-orange-400 mt-0.5\"></i>\n                    <div className=\"flex-1\">\n                      <span className=\"text-gray-600 dark:text-gray-400\">–ü—Ä–∏—á–∏–Ω–∞:</span>\n                      <div className=\"bg-orange-50 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-1 rounded mt-1 text-xs leading-relaxed\">\n                        {node.data.reason}\n                      </div>\n                    </div>\n                  </div>\n                )}\n                {(node.type === 'ban_user' || node.type === 'mute_user') && node.data.untilDate && (\n                  <div className=\"flex items-center space-x-2 text-xs\">\n                    <i className=\"fas fa-clock text-red-500 dark:text-red-400\"></i>\n                    <span className=\"text-gray-600 dark:text-gray-400\">–î–æ:</span>\n                    <span className=\"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300 px-2 py-1 rounded\">\n                      {new Date(node.data.untilDate * 1000).toLocaleString()}\n                    </span>\n                  </div>\n                )}\n              </div>\n              \n              {/* Action Status */}\n              <div className=\"flex items-center space-x-2 pt-2 border-t border-gray-200/50 dark:border-gray-700/50\">\n                {(() => {\n                  // –ì—Ä—É–ø–ø–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è\n                  const isReady = true;\n                  \n                  return (\n                    <>\n                      <div className={cn(\n                        \"w-2 h-2 rounded-full\",\n                        \"bg-green-500\"\n                      )}></div>\n                      <span className=\"text-xs font-medium\">\n                        <span className=\"text-green-600 dark:text-green-400\">–ì–æ—Ç–æ–≤–æ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</span>\n                      </span>\n                    </>\n                  );\n                })()}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Text Input Indicator for keyboard type 'none' */}\n      {node.type === 'keyboard' && node.data.keyboardType === 'none' && (node.data as any).enableTextInput && (\n        <div className=\"bg-gradient-to-br from-cyan-50/70 to-blue-50/70 dark:from-cyan-900/30 dark:to-blue-900/30 rounded-xl p-4 mb-4 border border-cyan-200 dark:border-cyan-800/30\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 rounded-full bg-cyan-100 dark:bg-cyan-900/50 flex items-center justify-center\">\n              <i className=\"fas fa-keyboard text-cyan-600 dark:text-cyan-400 text-sm\"></i>\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"text-sm font-medium text-cyan-800 dark:text-cyan-200 mb-1\">\n                –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥\n              </div>\n              <div className=\"text-xs text-cyan-600 dark:text-cyan-400 space-y-1\">\n                {(node.data as any).inputVariable && (\n                  <div className=\"flex items-center space-x-1\">\n                    <i className=\"fas fa-tag text-xs\"></i>\n                    <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤: <code className=\"bg-cyan-100 dark:bg-cyan-900/50 px-1 py-0.5 rounded text-xs\">{(node.data as any).inputVariable}</code></span>\n                  </div>\n                )}\n                {(node.data as any).inputTargetNodeId && (\n                  <div className=\"flex items-center space-x-1\">\n                    <i className=\"fas fa-arrow-right text-xs\"></i>\n                    <span>–°–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª: {(node.data as any).inputTargetNodeId}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Buttons preview */}\n      {node.data.buttons && node.data.buttons.length > 0 && node.data.keyboardType !== 'none' && (\n        <div className=\"space-y-3\">\n          {(() => {\n            // Check if this is a multi-select node (has buttons with buttonType: \"option\")\n            const hasOptionButtons = node.data.buttons.some((button: any) => button.buttonType === 'option');\n            const isMultiSelect = hasOptionButtons && (node.data as any).allowMultipleSelection;\n            \n            return (\n              <>\n                <div className=\"flex items-center space-x-2 mb-3\">\n                  <div className=\"w-1 h-4 bg-amber-500 dark:bg-amber-400 rounded-full\"></div>\n                  <span className=\"text-xs font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide\">\n                    {isMultiSelect ? '–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä' : \n                     node.data.keyboardType === 'inline' ? 'Inline –∫–Ω–æ–ø–∫–∏' : 'Reply –∫–Ω–æ–ø–∫–∏'}\n                  </span>\n                  {isMultiSelect && (\n                    <div className=\"text-xs text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/50 px-2 py-1 rounded-full\">\n                      <i className=\"fas fa-check-double text-xs mr-1\"></i>\n                      –ú—É–ª—å—Ç–∏-–≤—ã–±–æ—Ä\n                    </div>\n                  )}\n                </div>\n                \n                {node.data.keyboardType === 'inline' ? (\n                  <div className=\"space-y-3\">\n                    {/* Option buttons for multi-select */}\n                    {isMultiSelect ? (\n                      <>\n                        <div className=\"grid grid-cols-2 gap-2\">\n                          {node.data.buttons.filter((button: any) => button.buttonType === 'option').slice(0, 6).map((button: any) => (\n                            <div key={button.id} className=\"group relative\">\n                              <div className=\"p-3 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 rounded-lg text-xs font-medium text-green-700 dark:text-green-300 text-center border border-green-200 dark:border-green-800 hover:border-green-300 dark:hover:border-green-700 transition-all duration-200 shadow-sm relative\">\n                              <div className=\"flex items-center justify-center space-x-1\">\n                                <i className=\"fas fa-square text-green-600 dark:text-green-400 text-xs opacity-50\" title=\"–ù–µ–≤—ã–±—Ä–∞–Ω–æ\"></i>\n                                <span className=\"truncate\">{button.text}</span>\n                              </div>\n                              {/* Simulated selected state */}\n                              <div className=\"absolute inset-0 bg-green-500/10 dark:bg-green-400/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none\"></div>\n                            </div>\n                            </div>\n                          ))}\n                        </div>\n                        \n                        {/* Show \"Done\" button for multi-select */}\n                        <div className=\"mt-3 pt-2 border-t border-gray-200 dark:border-gray-700\">\n                          <div className=\"p-3 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg text-xs font-medium text-blue-700 dark:text-blue-300 text-center border border-blue-200 dark:border-blue-800 shadow-sm\">\n                            <div className=\"flex items-center justify-center space-x-1\">\n                              <i className=\"fas fa-check text-blue-600 dark:text-blue-400 text-xs\"></i>\n                              <span>–ì–æ—Ç–æ–≤–æ</span>\n                            </div>\n                          </div>\n                        </div>\n                        \n                        {/* Show count of remaining option buttons */}\n                        {node.data.buttons.filter((button: any) => button.buttonType === 'option').length > 6 && (\n                          <div className=\"text-xs text-gray-500 dark:text-gray-400 text-center py-1 font-medium\">\n                            <span className=\"inline-flex items-center px-2 py-1 bg-green-100 dark:bg-green-800 rounded-full\">\n                              +{node.data.buttons.filter((button: any) => button.buttonType === 'option').length - 6} –æ–ø—Ü–∏–π\n                            </span>\n                          </div>\n                        )}\n                      </>\n                    ) : (\n                      /* Regular inline buttons */\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        {node.data.buttons.slice(0, 4).map((button: any) => (\n                          <div key={button.id} className=\"group relative\">\n                            <div className=\"p-3 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg text-xs font-medium text-blue-700 dark:text-blue-300 text-center border border-blue-200 dark:border-blue-800 hover:border-blue-300 dark:hover:border-blue-700 transition-all duration-200 shadow-sm\">\n                              <div className=\"flex items-center justify-center space-x-1\">\n                                <span className=\"truncate\">{button.text}</span>\n                                {button.action === 'command' && (\n                                  <i className=\"fas fa-terminal text-emerald-600 dark:text-emerald-400 text-xs opacity-70\" title=\"–ö–æ–º–∞–Ω–¥–∞\"></i>\n                                )}\n                                {button.action === 'url' && (\n                                  <i className=\"fas fa-external-link-alt text-purple-600 dark:text-purple-400 text-xs opacity-70\" title=\"–°—Å—ã–ª–∫–∞\"></i>\n                                )}\n                                {button.action === 'goto' && (\n                                  <i className=\"fas fa-arrow-right text-blue-600 dark:text-blue-400 text-xs opacity-70\" title=\"–ü–µ—Ä–µ—Ö–æ–¥\"></i>\n                                )}\n                                {button.action === 'selection' && (\n                                  <i className=\"fas fa-mouse-pointer text-purple-600 dark:text-purple-400 text-xs opacity-70\" title=\"–í—ã–±–æ—Ä\"></i>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                ) : (\n                  /* Reply keyboard buttons */\n                  <div className=\"space-y-2\">\n                    {node.data.buttons.slice(0, 2).map((button: any) => (\n                      <div key={button.id} className=\"flex items-center justify-between p-3 bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-800/50 dark:to-slate-800/50 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm\">\n                        <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300 truncate\">{button.text}</span>\n                        <div className=\"flex items-center space-x-1 ml-2\">\n                          {button.action === 'command' && (\n                            <i className=\"fas fa-terminal text-emerald-600 dark:text-emerald-400 text-xs opacity-70\" title=\"–ö–æ–º–∞–Ω–¥–∞\"></i>\n                          )}\n                          {button.action === 'url' && (\n                            <i className=\"fas fa-external-link-alt text-purple-600 dark:text-purple-400 text-xs opacity-70\" title=\"–°—Å—ã–ª–∫–∞\"></i>\n                          )}\n                          {button.action === 'goto' && (\n                            <i className=\"fas fa-arrow-right text-blue-600 dark:text-blue-400 text-xs opacity-70\" title=\"–ü–µ—Ä–µ—Ö–æ–¥\"></i>\n                          )}\n                          {button.action === 'selection' && (\n                            <i className=\"fas fa-mouse-pointer text-purple-600 dark:text-purple-400 text-xs opacity-70\" title=\"–í—ã–±–æ—Ä\"></i>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n                \n                {/* Show remaining buttons count for non-multi-select */}\n                {!isMultiSelect && node.data.buttons && node.data.buttons.length > (node.data.keyboardType === 'inline' ? 4 : 2) && (\n                  <div className=\"text-xs text-gray-500 dark:text-gray-400 text-center py-2 font-medium\">\n                    <span className=\"inline-flex items-center px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded-full\">\n                      +{node.data.buttons.length - (node.data.keyboardType === 'inline' ? 4 : 2)} –µ—â–µ\n                    </span>\n                  </div>\n                )}\n              </>\n            );\n          })()}\n        </div>\n      )}\n      {/* Connection points */}\n      <button\n        className={cn(\n          \"absolute -left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 rounded-full border-2 border-white dark:border-slate-900 shadow-lg hover:scale-125 transition-all duration-300 opacity-0 group-hover:opacity-100 z-10\",\n          connectionStart?.nodeId === node.id && connectionStart?.handle === 'target'\n            ? \"bg-gradient-to-br from-emerald-400 to-green-500 hover:from-emerald-500 hover:to-green-600 animate-pulse shadow-2xl shadow-emerald-500/50 opacity-100\"\n            : connectionStart && connectionStart.nodeId !== node.id && connectionStart.handle === 'source'\n            ? \"bg-gradient-to-br from-emerald-300 to-green-400 hover:from-emerald-400 hover:to-green-500 animate-bounce shadow-xl shadow-emerald-400/40 opacity-100\"\n            : \"bg-gradient-to-br from-gray-400 to-gray-500 hover:from-blue-400 hover:to-blue-500 hover:shadow-blue-500/30\"\n        )}\n        onClick={(e) => {\n          e.stopPropagation();\n          onConnectionStart?.(node.id, 'target');\n        }}\n        title=\"–í—Ö–æ–¥—è—â–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\"\n      >\n        <div className=\"absolute inset-1 rounded-full bg-white/30 dark:bg-slate-800/30 opacity-0 hover:opacity-100 transition-opacity duration-200\" />\n        <div className=\"absolute inset-0 rounded-full bg-current opacity-0 hover:opacity-10 transition-opacity duration-300 animate-ping\" />\n      </button>\n      <button\n        className={cn(\n          \"absolute -right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 rounded-full border-2 border-white dark:border-slate-900 shadow-lg hover:scale-125 transition-all duration-300 opacity-0 group-hover:opacity-100 z-10\",\n          connectionStart?.nodeId === node.id && connectionStart?.handle === 'source'\n            ? \"bg-gradient-to-br from-emerald-400 to-green-500 hover:from-emerald-500 hover:to-green-600 animate-pulse shadow-2xl shadow-emerald-500/50 opacity-100\"\n            : connectionStart && connectionStart.nodeId !== node.id && connectionStart.handle === 'target'\n            ? \"bg-gradient-to-br from-emerald-300 to-green-400 hover:from-emerald-400 hover:to-green-500 animate-bounce shadow-xl shadow-emerald-400/40 opacity-100\"\n            : \"bg-gradient-to-br from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 hover:shadow-blue-500/30\"\n        )}\n        onClick={(e) => {\n          e.stopPropagation();\n          onConnectionStart?.(node.id, 'source');\n        }}\n        title=\"–ò—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\"\n      >\n        <div className=\"absolute inset-1 rounded-full bg-white/30 dark:bg-slate-800/30 opacity-0 hover:opacity-100 transition-opacity duration-200\" />\n        <div className=\"absolute inset-0 rounded-full bg-current opacity-0 hover:opacity-10 transition-opacity duration-300 animate-ping\" />\n      </button>\n    </div>\n  );\n}\n","size_bytes":93420},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }","size_bytes":1876},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground transition-all duration-200 dark:border-2 dark:border-border/80 dark:hover:border-primary/80 dark:hover:shadow-lg dark:hover:scale-105 dark:data-[state=checked]:border-primary dark:data-[state=checked]:shadow-primary/20 dark:data-[state=checked]:shadow-lg\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current transition-all duration-200 dark:drop-shadow-sm\")}\n    >\n      <Check className=\"h-4 w-4 dark:font-bold dark:stroke-2\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1389},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/connection-line.tsx":{"content":"import { useMemo } from 'react';\nimport { Connection, Node } from '@/types/bot';\nimport { cn } from '@/lib/utils';\n\ninterface ConnectionLineProps {\n  connection: Connection;\n  nodes: Node[];\n  isSelected?: boolean;\n  onClick?: () => void;\n  onDelete?: () => void;\n}\n\nexport function ConnectionLine({ connection, nodes, isSelected, onClick, onDelete }: ConnectionLineProps) {\n  const { path, midPoint, distance } = useMemo(() => {\n    const sourceNode = nodes.find(n => n.id === connection.source);\n    const targetNode = nodes.find(n => n.id === connection.target);\n    \n    if (!sourceNode || !targetNode) {\n      return { path: '', midPoint: { x: 0, y: 0 }, distance: 0 };\n    }\n\n    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã —É–∑–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ\n    const baseWidth = 320; // –ë–∞–∑–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞\n    const baseHeight = 200; // –ë–∞–∑–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞\n    \n    // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è –∫–Ω–æ–ø–æ–∫\n    const sourceButtonHeight = sourceNode.data.buttons.length > 0 ? \n      (sourceNode.data.keyboardType === 'inline' ? \n        Math.ceil(sourceNode.data.buttons.length / 2) * 50 : \n        sourceNode.data.buttons.length * 40) : 0;\n    \n    const targetButtonHeight = targetNode.data.buttons.length > 0 ? \n      (targetNode.data.keyboardType === 'inline' ? \n        Math.ceil(targetNode.data.buttons.length / 2) * 50 : \n        targetNode.data.buttons.length * 40) : 0;\n\n    const sourceHeight = baseHeight + sourceButtonHeight;\n    const targetHeight = baseHeight + targetButtonHeight;\n\n    // –£–º–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n    const sourceX = sourceNode.position.x + baseWidth + 8;\n    const sourceY = sourceNode.position.y + sourceHeight / 2;\n    const targetX = targetNode.position.x - 8;\n    const targetY = targetNode.position.y + targetHeight / 2;\n\n    // –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –∫—Ä–∏–≤–æ–π\n    const deltaX = targetX - sourceX;\n    const deltaY = targetY - sourceY;\n    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n\n    // –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫—Ä–∏–≤–∞—è –ë–µ–∑—å–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n    let controlPointOffset = Math.min(Math.abs(deltaX) / 2, Math.max(80, distance * 0.3));\n    \n    // –ï—Å–ª–∏ —É–∑–ª—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –æ–¥–∏–Ω –ø–æ–¥ –¥—Ä—É–≥–∏–º, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫—Ä–∏–≤–∏–∑–Ω—É\n    if (Math.abs(deltaY) > Math.abs(deltaX)) {\n      controlPointOffset = Math.max(controlPointOffset, 120);\n    }\n\n    const controlPoint1X = sourceX + controlPointOffset;\n    const controlPoint1Y = sourceY;\n    const controlPoint2X = targetX - controlPointOffset;\n    const controlPoint2Y = targetY;\n\n    const path = `M ${sourceX} ${sourceY} C ${controlPoint1X} ${controlPoint1Y}, ${controlPoint2X} ${controlPoint2Y}, ${targetX} ${targetY}`;\n    \n    // –ë–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è —Å—Ä–µ–¥–Ω—è—è —Ç–æ—á–∫–∞ —Å —É—á–µ—Ç–æ–º –∫—Ä–∏–≤–æ–π\n    const t = 0.5;\n    const midX = Math.pow(1-t, 3) * sourceX + 3 * Math.pow(1-t, 2) * t * controlPoint1X + 3 * (1-t) * Math.pow(t, 2) * controlPoint2X + Math.pow(t, 3) * targetX;\n    const midY = Math.pow(1-t, 3) * sourceY + 3 * Math.pow(1-t, 2) * t * controlPoint1Y + 3 * (1-t) * Math.pow(t, 2) * controlPoint2Y + Math.pow(t, 3) * targetY;\n\n    const midPoint = { x: midX, y: midY };\n\n    return { path, midPoint, distance };\n  }, [connection, nodes]);\n\n  if (!path) return null;\n\n  return (\n    <g className=\"connection-line\">\n      {/* –ù–µ–≤–∏–¥–∏–º–∞—è —Ç–æ–ª—Å—Ç–∞—è –ª–∏–Ω–∏—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∫–ª–∏–∫–∞ */}\n      <path\n        d={path}\n        stroke=\"transparent\"\n        strokeWidth=\"20\"\n        fill=\"none\"\n        className=\"cursor-pointer\"\n        onClick={onClick}\n      />\n      \n      {/* –û—Å–Ω–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è */}\n      <path\n        d={path}\n        stroke={isSelected ? \"hsl(var(--primary))\" : \"hsl(var(--muted-foreground))\"}\n        strokeWidth={isSelected ? \"3\" : \"2\"}\n        fill=\"none\"\n        className={cn(\n          \"transition-all duration-300\",\n          isSelected ? \"drop-shadow-lg\" : \"hover:stroke-primary/70\"\n        )}\n        style={{\n          strokeDasharray: isSelected ? \"none\" : \"none\",\n          filter: isSelected ? \"drop-shadow(0 0 8px hsl(var(--primary) / 0.3))\" : \"none\"\n        }}\n        onClick={onClick}\n      />\n\n      {/* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–∏–Ω–∏—è –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ */}\n      {isSelected && (\n        <path\n          d={path}\n          stroke=\"hsl(var(--primary))\"\n          strokeWidth=\"1\"\n          fill=\"none\"\n          className=\"animate-pulse opacity-60\"\n          style={{\n            strokeDasharray: \"8 4\",\n            animation: \"dash 2s linear infinite\"\n          }}\n        />\n      )}\n\n      {/* –°—Ç—Ä–µ–ª–∫–∞ */}\n      <defs>\n        <marker\n          id={`arrowhead-${connection.id}`}\n          markerWidth=\"10\"\n          markerHeight=\"7\"\n          refX=\"9\"\n          refY=\"3.5\"\n          orient=\"auto\"\n        >\n          <polygon\n            points=\"0 0, 10 3.5, 0 7\"\n            fill={isSelected ? \"hsl(var(--primary))\" : \"hsl(var(--muted-foreground))\"}\n            className=\"transition-all duration-200\"\n          />\n        </marker>\n      </defs>\n      \n      <path\n        d={path}\n        stroke={isSelected ? \"hsl(var(--primary))\" : \"hsl(var(--muted-foreground))\"}\n        strokeWidth={isSelected ? \"3\" : \"2\"}\n        fill=\"none\"\n        markerEnd={`url(#arrowhead-${connection.id})`}\n        className={cn(\n          \"transition-all duration-200\",\n          isSelected ? \"drop-shadow-lg\" : \"hover:stroke-primary/70\"\n        )}\n        onClick={onClick}\n      />\n\n      {/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è */}\n      {isSelected && onDelete && (\n        <foreignObject\n          x={midPoint.x - 12}\n          y={midPoint.y - 12}\n          width=\"24\"\n          height=\"24\"\n          className=\"pointer-events-none\"\n        >\n          <button\n            className=\"w-6 h-6 bg-gradient-to-br from-red-500 to-red-600 text-white rounded-full flex items-center justify-center hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl border-2 border-white dark:border-slate-900 pointer-events-auto\"\n            onClick={(e) => {\n              e.stopPropagation();\n              onDelete();\n            }}\n          >\n            <i className=\"fas fa-times text-xs\"></i>\n          </button>\n        </foreignObject>\n      )}\n    </g>\n  );\n}","size_bytes":6464},"client/src/components/ui/connection-suggestions.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Node, Connection } from '@/types/bot';\nimport { ConnectionSuggestion, generateAutoConnections } from '@/utils/auto-connection';\n\ninterface ConnectionSuggestionsProps {\n  nodes: Node[];\n  connections: Connection[];\n  onCreateConnection: (source: string, target: string) => void;\n}\n\nexport function ConnectionSuggestions({ nodes, connections, onCreateConnection }: ConnectionSuggestionsProps) {\n  const [suggestions] = useState<ConnectionSuggestion[]>(() => \n    generateAutoConnections(nodes, connections).slice(0, 5)\n  );\n\n  if (suggestions.length === 0) {\n    return null;\n  }\n\n  const getNodeName = (nodeId: string) => {\n    const node = nodes.find(n => n.id === nodeId);\n    if (!node) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª';\n    \n    if (node.type === 'start') return '–°—Ç–∞—Ä—Ç';\n    if (node.type === 'command') return node.data.command || '–ö–æ–º–∞–Ω–¥–∞';\n    if (node.type === 'message') return '–°–æ–æ–±—â–µ–Ω–∏–µ';\n    if (node.type === 'keyboard') return '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞';\n    if (node.type === 'photo') return '–§–æ—Ç–æ';\n    if (node.type === 'condition') return '–£—Å–ª–æ–≤–∏–µ';\n    if (node.type === 'input') return '–í–≤–æ–¥';\n    return node.type;\n  };\n\n  const getConfidenceColor = (confidence: number) => {\n    if (confidence > 0.8) return 'bg-green-500';\n    if (confidence > 0.6) return 'bg-yellow-500';\n    return 'bg-orange-500';\n  };\n\n  return (\n    <Card className=\"w-full max-w-md\">\n      <CardHeader>\n        <CardTitle className=\"text-sm font-medium flex items-center\">\n          <i className=\"fas fa-magic text-blue-500 mr-2\" />\n          –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n        </CardTitle>\n        <CardDescription className=\"text-xs\">\n          –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ –±–æ—Ç–∞\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        {suggestions.map((suggestion, index) => (\n          <div key={index} className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex items-center space-x-2 text-sm\">\n                <span className=\"font-medium truncate\">\n                  {getNodeName(suggestion.source)}\n                </span>\n                <i className=\"fas fa-arrow-right text-gray-400 text-xs\" />\n                <span className=\"font-medium truncate\">\n                  {getNodeName(suggestion.target)}\n                </span>\n              </div>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate\">\n                {suggestion.reason}\n              </p>\n              <div className=\"flex items-center mt-2 space-x-2\">\n                <div className=\"flex items-center space-x-1\">\n                  <div className={`w-2 h-2 rounded-full ${getConfidenceColor(suggestion.confidence)}`} />\n                  <span className=\"text-xs text-gray-500\">\n                    {Math.round(suggestion.confidence * 100)}%\n                  </span>\n                </div>\n              </div>\n            </div>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => onCreateConnection(suggestion.source, suggestion.target)}\n              className=\"ml-2 flex-shrink-0\"\n            >\n              <i className=\"fas fa-plus text-xs\" />\n            </Button>\n          </div>\n        ))}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":3714},"client/src/components/ui/connections-layer.tsx":{"content":"import { Connection, Node } from '@/types/bot';\nimport { EnhancedConnectionLine } from './enhanced-connection-line';\n\ninterface ConnectionsLayerProps {\n  connections: Connection[];\n  nodes: Node[];\n  selectedConnectionId?: string;\n  onConnectionSelect?: (connectionId: string) => void;\n  onConnectionDelete?: (connectionId: string) => void;\n}\n\nexport function ConnectionsLayer({ \n  connections, \n  nodes, \n  selectedConnectionId,\n  onConnectionSelect,\n  onConnectionDelete\n}: ConnectionsLayerProps) {\n  if (!connections || connections.length === 0) return null;\n\n  return (\n    <svg \n      className=\"absolute inset-0 w-full h-full pointer-events-none\"\n      style={{ \n        zIndex: 2,\n        overflow: 'visible'\n      }}\n    >\n      {connections.map((connection) => (\n        <EnhancedConnectionLine\n          key={connection.id}\n          connection={connection}\n          nodes={nodes}\n          isSelected={selectedConnectionId === connection.id}\n          onClick={() => onConnectionSelect?.(connection.id)}\n          onDelete={() => onConnectionDelete?.(connection.id)}\n          showButtonInfo={true}\n        />\n      ))}\n    </svg>\n  );\n}","size_bytes":1149},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/enhanced-connection-line.tsx":{"content":"import { useMemo } from 'react';\nimport { Connection, Node } from '@/types/bot';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  ArrowRight, \n  Mouse, \n  Terminal, \n  ExternalLink, \n  AlertCircle \n} from 'lucide-react';\n\ninterface EnhancedConnectionLineProps {\n  connection: Connection;\n  nodes: Node[];\n  isSelected?: boolean;\n  onClick?: () => void;\n  onDelete?: () => void;\n  showButtonInfo?: boolean;\n}\n\nexport function EnhancedConnectionLine({ \n  connection, \n  nodes, \n  isSelected, \n  onClick, \n  onDelete,\n  showButtonInfo = true\n}: EnhancedConnectionLineProps) {\n  const { path, midPoint, distance, buttonInfo, hasButton } = useMemo(() => {\n    const sourceNode = nodes.find(n => n.id === connection.source);\n    const targetNode = nodes.find(n => n.id === connection.target);\n    \n    if (!sourceNode || !targetNode) {\n      return { \n        path: '', \n        midPoint: { x: 0, y: 0 }, \n        distance: 0, \n        buttonInfo: null, \n        hasButton: false \n      };\n    }\n\n    // –†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π —É–∑–ª–æ–≤\n    const baseWidth = 320;\n    const baseHeight = 200;\n    \n    const sourceButtonHeight = sourceNode.data.buttons && sourceNode.data.buttons.length > 0 ? \n      (sourceNode.data.keyboardType === 'inline' ? \n        Math.ceil(sourceNode.data.buttons.length / 2) * 50 : \n        sourceNode.data.buttons.length * 40) : 0;\n    \n    const targetButtonHeight = targetNode.data.buttons && targetNode.data.buttons.length > 0 ? \n      (targetNode.data.keyboardType === 'inline' ? \n        Math.ceil(targetNode.data.buttons.length / 2) * 50 : \n        targetNode.data.buttons.length * 40) : 0;\n\n    const sourceHeight = baseHeight + sourceButtonHeight;\n    const targetHeight = baseHeight + targetButtonHeight;\n\n    // –ü–æ–∑–∏—Ü–∏–∏ —Ç–æ—á–µ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n    const sourceX = sourceNode.position.x + baseWidth + 8;\n    const sourceY = sourceNode.position.y + sourceHeight / 2;\n    const targetX = targetNode.position.x - 8;\n    const targetY = targetNode.position.y + targetHeight / 2;\n\n    // –†–∞—Å—á–µ—Ç –∫—Ä–∏–≤–æ–π –ë–µ–∑—å–µ\n    const deltaX = targetX - sourceX;\n    const deltaY = targetY - sourceY;\n    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n    \n    let controlPointOffset = Math.min(Math.abs(deltaX) / 2, Math.max(80, distance * 0.3));\n    \n    if (Math.abs(deltaY) > Math.abs(deltaX)) {\n      controlPointOffset = Math.max(controlPointOffset, 120);\n    }\n\n    const controlPoint1X = sourceX + controlPointOffset;\n    const controlPoint1Y = sourceY;\n    const controlPoint2X = targetX - controlPointOffset;\n    const controlPoint2Y = targetY;\n\n    const path = `M ${sourceX} ${sourceY} C ${controlPoint1X} ${controlPoint1Y}, ${controlPoint2X} ${controlPoint2Y}, ${targetX} ${targetY}`;\n    \n    // –°—Ä–µ–¥–Ω—è—è —Ç–æ—á–∫–∞ –∫—Ä–∏–≤–æ–π\n    const t = 0.5;\n    const midX = Math.pow(1-t, 3) * sourceX + 3 * Math.pow(1-t, 2) * t * controlPoint1X + 3 * (1-t) * Math.pow(t, 2) * controlPoint2X + Math.pow(t, 3) * targetX;\n    const midY = Math.pow(1-t, 3) * sourceY + 3 * Math.pow(1-t, 2) * t * controlPoint1Y + 3 * (1-t) * Math.pow(t, 2) * controlPoint2Y + Math.pow(t, 3) * targetY;\n\n    const midPoint = { x: midX, y: midY };\n\n    // –ü–æ–∏—Å–∫ —Å–≤—è–∑–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏\n    const relatedButton = sourceNode.data.buttons ? sourceNode.data.buttons.find(button => \n      button.action === 'goto' && button.target === connection.target\n    ) : undefined;\n\n    const buttonInfo = relatedButton ? {\n      text: relatedButton.text,\n      action: relatedButton.action,\n      hasButton: true\n    } : null;\n\n    return { path, midPoint, distance, buttonInfo, hasButton: !!relatedButton };\n  }, [connection, nodes]);\n\n  if (!path) return null;\n\n  const getActionIcon = (action: string) => {\n    switch (action) {\n      case 'goto': return <ArrowRight className=\"h-3 w-3\" />;\n      case 'command': return <Terminal className=\"h-3 w-3\" />;\n      case 'url': return <ExternalLink className=\"h-3 w-3\" />;\n      default: return <Mouse className=\"h-3 w-3\" />;\n    }\n  };\n\n  const getConnectionType = () => {\n    if (hasButton) return 'button';\n    return 'direct';\n  };\n\n  const connectionType = getConnectionType();\n\n  return (\n    <g className=\"connection-line\">\n      {/* –ù–µ–≤–∏–¥–∏–º–∞—è —Ç–æ–ª—Å—Ç–∞—è –ª–∏–Ω–∏—è –¥–ª—è –∫–ª–∏–∫–æ–≤ */}\n      <path\n        d={path}\n        stroke=\"transparent\"\n        strokeWidth=\"20\"\n        fill=\"none\"\n        className=\"cursor-pointer\"\n        onClick={onClick}\n      />\n      \n      {/* –û—Å–Ω–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è */}\n      <path\n        d={path}\n        stroke={\n          isSelected \n            ? \"hsl(var(--primary))\" \n            : connectionType === 'button' \n              ? \"hsl(var(--green-500))\" \n              : \"hsl(var(--muted-foreground))\"\n        }\n        strokeWidth={isSelected ? \"3\" : \"2\"}\n        fill=\"none\"\n        strokeDasharray={\n          connectionType === 'button' \n            ? \"none\" \n            : \"5,5\"\n        }\n        className={`\n          transition-all duration-300\n          ${isSelected ? 'drop-shadow-md' : ''}\n          ${connectionType === 'button' ? 'opacity-100' : 'opacity-70'}\n        `}\n        markerEnd=\"url(#arrowhead)\"\n      />\n      \n      {/* –°—Ç—Ä–µ–ª–∫–∞ */}\n      <defs>\n        <marker\n          id=\"arrowhead\"\n          markerWidth=\"10\"\n          markerHeight=\"7\"\n          refX=\"9\"\n          refY=\"3.5\"\n          orient=\"auto\"\n        >\n          <polygon\n            points=\"0 0, 10 3.5, 0 7\"\n            fill={\n              isSelected \n                ? \"hsl(var(--primary))\" \n                : connectionType === 'button' \n                  ? \"hsl(var(--green-500))\" \n                  : \"hsl(var(--muted-foreground))\"\n            }\n          />\n        </marker>\n      </defs>\n\n      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–æ–ø–∫–µ */}\n      {showButtonInfo && (\n        <foreignObject\n          x={midPoint.x - 60}\n          y={midPoint.y - 15}\n          width=\"120\"\n          height=\"30\"\n          className=\"pointer-events-none\"\n        >\n          <div className=\"flex items-center justify-center h-full\">\n            {buttonInfo ? (\n              <Badge \n                variant=\"secondary\" \n                className=\"text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 flex items-center gap-1\"\n              >\n                {getActionIcon(buttonInfo.action)}\n                <span className=\"truncate max-w-16\">{buttonInfo.text}</span>\n              </Badge>\n            ) : (\n              <Badge \n                variant=\"outline\" \n                className=\"text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 flex items-center gap-1\"\n              >\n                <AlertCircle className=\"h-3 w-3\" />\n                <span>–ù–µ—Ç –∫–Ω–æ–ø–∫–∏</span>\n              </Badge>\n            )}\n          </div>\n        </foreignObject>\n      )}\n\n      {/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è */}\n      {isSelected && onDelete && (\n        <foreignObject\n          x={midPoint.x + 65}\n          y={midPoint.y - 12}\n          width=\"24\"\n          height=\"24\"\n          className=\"pointer-events-auto\"\n        >\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onDelete();\n            }}\n            className=\"w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs transition-colors\"\n            title=\"–£–¥–∞–ª–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\"\n          >\n            √ó\n          </button>\n        </foreignObject>\n      )}\n\n      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è */}\n      <circle\n        cx={midPoint.x}\n        cy={midPoint.y}\n        r=\"4\"\n        fill={\n          connectionType === 'button' \n            ? \"hsl(var(--green-500))\" \n            : \"hsl(var(--yellow-500))\"\n        }\n        stroke=\"white\"\n        strokeWidth=\"2\"\n        className={`\n          transition-all duration-300\n          ${isSelected ? 'r-6' : 'r-4'}\n          cursor-pointer\n        `}\n        onClick={onClick}\n      />\n    </g>\n  );\n}","size_bytes":8055},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }","size_bytes":1229},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\nimport { useState } from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => {\n  const [isHovered, setIsHovered] = useState(false)\n  const [isDragging, setIsDragging] = useState(false)\n\n  return (\n    <ResizablePrimitive.PanelResizeHandle\n      className={cn(\n        \"group relative flex w-px items-center justify-center bg-border transition-all duration-200\",\n        \"hover:bg-primary/20 hover:w-1 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2\",\n        \"after:absolute after:inset-y-0 after:left-1/2 after:w-3 after:-translate-x-1/2 after:bg-transparent hover:after:bg-primary/10 after:transition-all after:duration-200\",\n        \"data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:hover:h-1\",\n        \"data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-3 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0\",\n        \"[&[data-panel-group-direction=vertical]>div]:rotate-90\",\n        isDragging && \"bg-primary w-1 after:bg-primary/20\",\n        className\n      )}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n      onMouseDown={() => setIsDragging(true)}\n      onMouseUp={() => setIsDragging(false)}\n      {...props}\n    >\n      {withHandle && (\n        <div className={cn(\n          \"grip-handle z-10 flex h-6 w-4 items-center justify-center rounded-md border border-border bg-background shadow-sm transition-all duration-200\",\n          \"group-hover:bg-muted group-hover:border-primary/30 group-hover:shadow-md group-hover:scale-105\",\n          \"dark:bg-background dark:border-border dark:group-hover:bg-muted dark:group-hover:border-primary/50\",\n          \"focus-within:ring-2 focus-within:ring-primary focus-within:ring-offset-1\",\n          isHovered && \"scale-110 shadow-lg border-primary/40\",\n          isDragging && \"scale-105 bg-primary/10 border-primary shadow-lg ring-2 ring-primary/20\"\n        )}>\n          <GripVertical className={cn(\n            \"h-3 w-3 text-muted-foreground transition-all duration-200\",\n            \"group-hover:text-primary group-hover:drop-shadow-sm\",\n            isHovered && \"scale-110 text-primary\",\n            isDragging && \"text-primary scale-125 drop-shadow-md\"\n          )} />\n          \n          {/* Dot indicators for better visual feedback */}\n          <div className={cn(\n            \"absolute inset-0 rounded-md opacity-0 transition-opacity duration-200\",\n            \"bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5\",\n            isHovered && \"opacity-100\",\n            isDragging && \"opacity-100 from-primary/10 via-primary/20 to-primary/10\"\n          )} />\n        </div>\n      )}\n    </ResizablePrimitive.PanelResizeHandle>\n  )\n}\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":3631},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }","size_bytes":1641},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\";\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  );\n}\n\n// –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∫–µ–ª–µ—Ç–æ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤\nfunction EditorSkeleton() {\n  return (\n    <div className=\"flex h-screen\">\n      {/* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */}\n      <div className=\"w-64 border-r bg-background p-4 space-y-4\">\n        <Skeleton className=\"h-8 w-full\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-12 w-full\" />\n          <Skeleton className=\"h-12 w-full\" />\n          <Skeleton className=\"h-12 w-full\" />\n          <Skeleton className=\"h-12 w-full\" />\n        </div>\n      </div>\n      \n      {/* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */}\n      <div className=\"flex-1 flex flex-col\">\n        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}\n        <div className=\"border-b h-16 flex items-center px-6 space-x-4\">\n          <Skeleton className=\"h-6 w-32\" />\n          <Skeleton className=\"h-8 w-24\" />\n          <Skeleton className=\"h-8 w-20\" />\n        </div>\n        \n        {/* –•–æ–ª—Å—Ç */}\n        <div className=\"flex-1 flex\">\n          <div className=\"flex-1 p-6\">\n            <div className=\"grid grid-cols-3 gap-6\">\n              <Skeleton className=\"h-32 w-full\" />\n              <Skeleton className=\"h-32 w-full\" />\n              <Skeleton className=\"h-32 w-full\" />\n            </div>\n          </div>\n          \n          {/* –ü–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤ */}\n          <div className=\"w-80 border-l p-4 space-y-4\">\n            <Skeleton className=\"h-8 w-full\" />\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-10 w-full\" />\n              <Skeleton className=\"h-20 w-full\" />\n              <Skeleton className=\"h-10 w-full\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction ProjectsSkeleton() {\n  return (\n    <div className=\"container mx-auto px-6 py-8\">\n      <div className=\"mb-8\">\n        <Skeleton className=\"h-8 w-48 mb-4\" />\n        <div className=\"flex space-x-4\">\n          <Skeleton className=\"h-10 w-32\" />\n          <Skeleton className=\"h-10 w-24\" />\n        </div>\n      </div>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {Array.from({ length: 6 }).map((_, i) => (\n          <div key={i} className=\"border rounded-lg p-4 space-y-4\">\n            <Skeleton className=\"h-6 w-3/4\" />\n            <Skeleton className=\"h-4 w-full\" />\n            <Skeleton className=\"h-4 w-2/3\" />\n            <div className=\"flex space-x-2\">\n              <Skeleton className=\"h-8 w-20\" />\n              <Skeleton className=\"h-8 w-16\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction TemplatesSkeleton() {\n  return (\n    <div className=\"container mx-auto px-6 py-8\">\n      <div className=\"mb-8\">\n        <Skeleton className=\"h-8 w-40 mb-4\" />\n        <div className=\"flex space-x-4\">\n          <Skeleton className=\"h-10 w-64\" />\n          <Skeleton className=\"h-10 w-32\" />\n          <Skeleton className=\"h-10 w-24\" />\n        </div>\n      </div>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {Array.from({ length: 8 }).map((_, i) => (\n          <div key={i} className=\"border rounded-lg p-4 space-y-3\">\n            <Skeleton className=\"h-32 w-full\" />\n            <Skeleton className=\"h-5 w-3/4\" />\n            <Skeleton className=\"h-4 w-full\" />\n            <div className=\"flex justify-between items-center\">\n              <Skeleton className=\"h-6 w-16\" />\n              <Skeleton className=\"h-8 w-20\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport { Skeleton, EditorSkeleton, ProjectsSkeleton, TemplatesSkeleton };\n","size_bytes":3888},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }","size_bytes":1035},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input dark:border-border/50 dark:data-[state=unchecked]:bg-muted/30\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-all duration-200 data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 dark:border dark:border-border/60 dark:shadow-xl dark:data-[state=checked]:bg-primary-foreground dark:data-[state=unchecked]:bg-background\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1357},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }","size_bytes":1882},"client/src/components/ui/temporary-connection.tsx":{"content":"import { useMemo } from 'react';\nimport { Node } from '@/types/bot';\n\ninterface TemporaryConnectionProps {\n  startNode: Node;\n  endPosition: { x: number; y: number };\n  handle: 'source' | 'target';\n}\n\nexport function TemporaryConnection({ startNode, endPosition, handle }: TemporaryConnectionProps) {\n  const path = useMemo(() => {\n    const baseWidth = 320;\n    const baseHeight = 200;\n    \n    const buttonHeight = startNode.data.buttons.length > 0 ? \n      (startNode.data.keyboardType === 'inline' ? \n        Math.ceil(startNode.data.buttons.length / 2) * 50 : \n        startNode.data.buttons.length * 40) : 0;\n\n    const nodeHeight = baseHeight + buttonHeight;\n\n    // –ü–æ–∑–∏—Ü–∏–∏ —Ç–æ—á–µ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n    const startX = handle === 'source' ? \n      startNode.position.x + baseWidth + 8 : \n      startNode.position.x - 8;\n    const startY = startNode.position.y + nodeHeight / 2;\n    const endX = endPosition.x;\n    const endY = endPosition.y;\n\n    // –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫—Ä–∏–≤–∞—è –ë–µ–∑—å–µ\n    const deltaX = endX - startX;\n    const deltaY = endY - startY;\n    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n    \n    let controlPointOffset = Math.min(Math.abs(deltaX) / 2, Math.max(80, distance * 0.3));\n    \n    if (Math.abs(deltaY) > Math.abs(deltaX)) {\n      controlPointOffset = Math.max(controlPointOffset, 120);\n    }\n\n    const controlPoint1X = startX + (handle === 'source' ? controlPointOffset : -controlPointOffset);\n    const controlPoint1Y = startY;\n    const controlPoint2X = endX + (handle === 'source' ? -controlPointOffset : controlPointOffset);\n    const controlPoint2Y = endY;\n\n    return `M ${startX} ${startY} C ${controlPoint1X} ${controlPoint1Y}, ${controlPoint2X} ${controlPoint2Y}, ${endX} ${endY}`;\n  }, [startNode, endPosition, handle]);\n\n  return (\n    <svg \n      className=\"absolute inset-0 w-full h-full pointer-events-none\"\n      style={{ \n        zIndex: 1000,\n        overflow: 'visible'\n      }}\n    >\n      <defs>\n        <marker\n          id=\"temp-arrowhead\"\n          markerWidth=\"10\"\n          markerHeight=\"7\"\n          refX=\"9\"\n          refY=\"3.5\"\n          orient=\"auto\"\n        >\n          <polygon\n            points=\"0 0, 10 3.5, 0 7\"\n            fill=\"hsl(var(--primary))\"\n            className=\"opacity-70\"\n          />\n        </marker>\n      </defs>\n\n      {/* –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è */}\n      <path\n        d={path}\n        stroke=\"hsl(var(--primary))\"\n        strokeWidth=\"2\"\n        fill=\"none\"\n        className=\"opacity-70\"\n        style={{\n          strokeDasharray: \"8 4\",\n          animation: \"dash 1s linear infinite\"\n        }}\n        markerEnd=\"url(#temp-arrowhead)\"\n      />\n\n      {/* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */}\n      <path\n        d={path}\n        stroke=\"hsl(var(--primary))\"\n        strokeWidth=\"1\"\n        fill=\"none\"\n        className=\"opacity-30\"\n        style={{\n          strokeDasharray: \"4 8\",\n          animation: \"dash 1.5s linear infinite reverse\"\n        }}\n      />\n    </svg>\n  );\n}","size_bytes":3049},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"import * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }","size_bytes":1144},"client/src/components/ui/canvas-sheets.tsx":{"content":"import { useState, useRef, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\n// –£–±–∏—Ä–∞–µ–º DropdownMenu –∏ Dialog - —Ç–µ–ø–µ—Ä—å –≤—Å—ë –ø—Ä–æ—Å—Ç–æ\nimport { \n  Plus, \n  X, \n  Copy, \n  Trash2, \n  ChevronLeft, \n  ChevronRight,\n  FileText\n} from 'lucide-react';\nimport { CanvasSheet } from '@shared/schema';\nimport { cn } from '@/lib/utils';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\ninterface CanvasSheetsProps {\n  sheets: CanvasSheet[];\n  activeSheetId: string | null;\n  onSheetSelect: (sheetId: string) => void;\n  onSheetAdd: (name: string) => void;\n  onSheetDelete: (sheetId: string) => void;\n  onSheetRename: (sheetId: string, newName: string) => void;\n  onSheetDuplicate: (sheetId: string) => void;\n  maxVisibleTabs?: number;\n}\n\nexport function CanvasSheets({\n  sheets,\n  activeSheetId,\n  onSheetSelect,\n  onSheetAdd,\n  onSheetDelete,\n  onSheetRename,\n  onSheetDuplicate,\n  maxVisibleTabs = 8\n}: CanvasSheetsProps) {\n  const [scrollPosition, setScrollPosition] = useState(0);\n  const [isRenaming, setIsRenaming] = useState<string | null>(null);\n  const [newName, setNewName] = useState('');\n  // –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–≤–∞–π–ø-–∂–µ—Å—Ç–æ–≤\n  const [touchStart, setTouchStart] = useState<number | null>(null);\n  const [touchEnd, setTouchEnd] = useState<number | null>(null);\n  // –£–±–∏—Ä–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ - —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—ë–º –ª–∏—Å—Ç—ã —Å—Ä–∞–∑—É\n  const tabsContainerRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const isMobile = useIsMobile();\n\n  // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è\n  useEffect(() => {\n    if (isRenaming && inputRef.current) {\n      inputRef.current.focus();\n      inputRef.current.select();\n    }\n  }, [isRenaming]);\n\n  // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ\n  useEffect(() => {\n    if (activeSheetId && tabsContainerRef.current) {\n      const activeTab = tabsContainerRef.current.querySelector(`[data-sheet-id=\"${activeSheetId}\"]`);\n      if (activeTab) {\n        activeTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });\n      }\n    }\n  }, [activeSheetId]);\n\n  const canScrollLeft = scrollPosition > 0;\n  const canScrollRight = sheets.length > maxVisibleTabs;\n\n  const scrollLeft = () => {\n    if (tabsContainerRef.current) {\n      const newPosition = Math.max(0, scrollPosition - 1);\n      setScrollPosition(newPosition);\n      tabsContainerRef.current.scrollTo({\n        left: newPosition * 150, // 150px per tab\n        behavior: 'smooth'\n      });\n    }\n  };\n\n  const scrollRight = () => {\n    if (tabsContainerRef.current) {\n      const maxScroll = Math.max(0, sheets.length - maxVisibleTabs);\n      const newPosition = Math.min(maxScroll, scrollPosition + 1);\n      setScrollPosition(newPosition);\n      tabsContainerRef.current.scrollTo({\n        left: newPosition * 150,\n        behavior: 'smooth'\n      });\n    }\n  };\n\n  const handleRename = (sheetId: string) => {\n    const sheet = sheets.find(s => s.id === sheetId);\n    if (sheet) {\n      setNewName(sheet.name);\n      setIsRenaming(sheetId);\n    }\n  };\n\n  const confirmRename = () => {\n    if (isRenaming && newName.trim()) {\n      onSheetRename(isRenaming, newName.trim());\n      setIsRenaming(null);\n      setNewName('');\n    }\n  };\n\n  const cancelRename = () => {\n    setIsRenaming(null);\n    setNewName('');\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      confirmRename();\n    } else if (e.key === 'Escape') {\n      cancelRename();\n    }\n  };\n\n  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–≤–∞–π–ø–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏\n  const minSwipeDistance = 50;\n\n  const onTouchStart = (e: React.TouchEvent) => {\n    if (!isMobile) return;\n    setTouchEnd(null);\n    setTouchStart(e.targetTouches[0].clientX);\n  };\n\n  const onTouchMove = (e: React.TouchEvent) => {\n    if (!isMobile) return;\n    setTouchEnd(e.targetTouches[0].clientX);\n  };\n\n  const onTouchEnd = () => {\n    if (!isMobile || !touchStart || !touchEnd) return;\n    \n    const distance = touchStart - touchEnd;\n    const isLeftSwipe = distance > minSwipeDistance;\n    const isRightSwipe = distance < -minSwipeDistance;\n\n    if (isLeftSwipe || isRightSwipe) {\n      if (!activeSheetId) return;\n      \n      const currentIndex = sheets.findIndex(sheet => sheet.id === activeSheetId);\n      if (currentIndex === -1) return;\n\n      if (isLeftSwipe && currentIndex < sheets.length - 1) {\n        // –°–≤–∞–π–ø –≤–ª–µ–≤–æ - —Å–ª–µ–¥—É—é—â–∏–π –ª–∏—Å—Ç\n        onSheetSelect(sheets[currentIndex + 1].id);\n      } else if (isRightSwipe && currentIndex > 0) {\n        // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ - –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ª–∏—Å—Ç  \n        onSheetSelect(sheets[currentIndex - 1].id);\n      }\n    }\n  };\n\n  // –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ª–∏—Å—Ç–∞–º–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö\n  const switchToNextSheet = () => {\n    if (!activeSheetId) return;\n    const currentIndex = sheets.findIndex(sheet => sheet.id === activeSheetId);\n    if (currentIndex < sheets.length - 1) {\n      onSheetSelect(sheets[currentIndex + 1].id);\n    }\n  };\n\n  const switchToPrevSheet = () => {\n    if (!activeSheetId) return;\n    const currentIndex = sheets.findIndex(sheet => sheet.id === activeSheetId);\n    if (currentIndex > 0) {\n      onSheetSelect(sheets[currentIndex - 1].id);\n    }\n  };\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∏–º–µ–Ω–µ–º\n  const addNewSheet = () => {\n    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞\n    const existingNumbers = sheets\n      .map(sheet => {\n        const match = sheet.name.match(/^–õ–∏—Å—Ç (\\d+)$/);\n        return match ? parseInt(match[1]) : 0;\n      })\n      .filter(num => num > 0);\n    \n    const nextNumber = existingNumbers.length > 0 ? Math.max(...existingNumbers) + 1 : sheets.length + 1;\n    const newSheetName = `–õ–∏—Å—Ç ${nextNumber}`;\n    \n    onSheetAdd(newSheetName);\n  };\n\n  return (\n    <div className={`flex items-center bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-lg shadow-xl relative transition-all duration-300 hover:shadow-2xl ${isMobile ? 'px-2 py-2' : 'px-3 py-2'}`}>\n      {/* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ */}\n      <div className=\"absolute inset-0 bg-gradient-to-r from-blue-50/50 via-transparent to-purple-50/50 dark:from-blue-950/20 dark:via-transparent dark:to-purple-950/20 rounded-lg pointer-events-none\"></div>\n      {/* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–ª–µ–≤–æ - –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ª–∏—Å—Ç—ã */}\n      {(canScrollLeft || (isMobile && sheets.length > 1)) && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={isMobile ? switchToPrevSheet : scrollLeft}\n          className={`p-0 rounded-full bg-gradient-to-r from-blue-500/10 to-blue-600/10 hover:from-blue-500/20 hover:to-blue-600/20 active:from-blue-500/30 active:to-blue-600/30 dark:from-blue-400/10 dark:to-blue-500/10 dark:hover:from-blue-400/20 dark:hover:to-blue-500/20 dark:active:from-blue-400/30 dark:active:to-blue-500/30 transition-all duration-200 hover:scale-110 active:scale-95 relative z-10 touch-manipulation ${isMobile ? 'h-12 w-12 mr-2' : 'h-8 w-8 mr-2'}`}\n          disabled={isMobile ? (activeSheetId ? sheets.findIndex(s => s.id === activeSheetId) === 0 : true) : false}\n        >\n          <ChevronLeft className={`text-blue-600 dark:text-blue-400 ${isMobile ? 'h-6 w-6' : 'h-4 w-4'}`} />\n        </Button>\n      )}\n\n      {/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∫–ª–∞–¥–æ–∫ */}\n      <div \n        ref={tabsContainerRef}\n        className=\"flex-1 flex overflow-x-hidden scroll-smooth relative z-10\"\n        style={{ \n          maxWidth: isMobile \n            ? `calc(100vw - 180px)` \n            : `min(${maxVisibleTabs * 170}px, calc(100vw - 320px))` \n        }}\n        onTouchStart={onTouchStart}\n        onTouchMove={onTouchMove}\n        onTouchEnd={onTouchEnd}\n      >\n        <div className={`flex ${isMobile ? 'gap-2' : 'gap-2'}`}>\n          {sheets.map((sheet) => (\n            <div\n              key={sheet.id}\n              data-sheet-id={sheet.id}\n              className={cn(\n                \"group flex items-center cursor-pointer transition-all duration-300 relative backdrop-blur-sm select-none touch-manipulation\",\n                isMobile \n                  ? \"min-w-[120px] max-w-[180px] min-h-[44px] h-12 px-3 active:scale-[0.98] rounded-xl\" \n                  : \"min-w-[140px] max-w-[200px] h-10 px-3 transform hover:scale-[1.02] rounded-lg\",\n                activeSheetId === sheet.id\n                  ? \"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/25 z-20 ring-2 ring-blue-300/50 dark:ring-blue-600/50\"\n                  : \"bg-white/70 dark:bg-slate-800/70 text-gray-700 dark:text-gray-300 hover:bg-white/90 dark:hover:bg-slate-700/90 shadow-sm hover:shadow-md border border-gray-200/50 dark:border-slate-600/50\"\n              )}\n              onClick={() => onSheetSelect(sheet.id)}\n            >\n              {!isMobile && (\n                <FileText className={cn(\n                  \"h-4 w-4 mr-3 transition-all duration-200\",\n                  activeSheetId === sheet.id\n                    ? \"text-white/90 drop-shadow-sm\"\n                    : \"text-gray-500 dark:text-gray-400 group-hover:text-blue-500 dark:group-hover:text-blue-400\"\n                )} />\n              )}\n              \n              {isRenaming === sheet.id ? (\n                <Input\n                  ref={inputRef}\n                  value={newName}\n                  onChange={(e) => setNewName(e.target.value)}\n                  onKeyDown={handleKeyDown}\n                  onBlur={confirmRename}\n                  className={`bg-transparent border-none focus:ring-1 focus:ring-blue-500 ${\n                    isMobile ? 'h-7 text-sm px-2 py-1' : 'h-6 text-xs px-1 py-0'\n                  }`}\n                />\n              ) : (\n                <span \n                  className={cn(\n                    \"flex-1 cursor-text transition-all duration-200 truncate\",\n                    isMobile \n                      ? \"text-sm font-semibold\" \n                      : \"text-sm font-semibold\",\n                    activeSheetId === sheet.id\n                      ? \"text-white drop-shadow-sm\"\n                      : \"text-gray-700 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400\"\n                  )}\n                  onDoubleClick={() => handleRename(sheet.id)}\n                  title={isMobile ? sheet.name : \"–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è\"}\n                >\n                  {sheet.name}\n                </span>\n              )}\n\n              {/* –û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}\n              <div className={`flex items-center transition-all duration-200 ${\n                isMobile \n                  ? 'ml-2 opacity-90' \n                  : 'ml-2 opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0'\n              }`}>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className={cn(\n                    \"p-0 rounded-full transition-all duration-200 hover:scale-110 active:scale-95 touch-manipulation\",\n                    isMobile ? \"h-8 w-8\" : \"h-6 w-6\",\n                    activeSheetId === sheet.id\n                      ? \"hover:bg-white/20 active:bg-white/30 text-white/90 hover:text-white\"\n                      : \"hover:bg-blue-100 active:bg-blue-200 dark:hover:bg-blue-900/50 dark:active:bg-blue-800/50 text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300\"\n                  )}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onSheetDuplicate(sheet.id);\n                  }}\n                  title=\"–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç\"\n                >\n                  <Copy className={isMobile ? \"h-4 w-4\" : \"h-3 w-3\"} />\n                </Button>\n                \n                {sheets.length > 1 && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={cn(\n                      \"p-0 rounded-full transition-all duration-200 hover:scale-110 active:scale-95 touch-manipulation\",\n                      isMobile ? \"h-8 w-8 ml-1\" : \"h-6 w-6 ml-1\",\n                      activeSheetId === sheet.id\n                        ? \"hover:bg-red-500/20 active:bg-red-500/30 text-red-200 hover:text-white\"\n                        : \"hover:bg-red-100 active:bg-red-200 dark:hover:bg-red-900/50 dark:active:bg-red-800/50 text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300\"\n                    )}\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      onSheetDelete(sheet.id);\n                    }}\n                    title=\"–£–¥–∞–ª–∏—Ç—å –ª–∏—Å—Ç\"\n                  >\n                    <X className={isMobile ? \"h-4 w-4\" : \"h-3 w-3\"} />\n                  </Button>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–ø—Ä–∞–≤–æ - –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ª–∏—Å—Ç—ã */}\n      {(canScrollRight || (isMobile && sheets.length > 1)) && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={isMobile ? switchToNextSheet : scrollRight}\n          className={`p-0 rounded-full bg-gradient-to-r from-blue-500/10 to-blue-600/10 hover:from-blue-500/20 hover:to-blue-600/20 active:from-blue-500/30 active:to-blue-600/30 dark:from-blue-400/10 dark:to-blue-500/10 dark:hover:from-blue-400/20 dark:hover:to-blue-500/20 dark:active:from-blue-400/30 dark:active:to-blue-500/30 transition-all duration-200 hover:scale-110 active:scale-95 relative z-10 touch-manipulation ${isMobile ? 'h-12 w-12 ml-2' : 'h-8 w-8 ml-2'}`}\n          disabled={isMobile ? (activeSheetId ? sheets.findIndex(s => s.id === activeSheetId) === sheets.length - 1 : true) : false}\n        >\n          <ChevronRight className={`text-blue-600 dark:text-blue-400 ${isMobile ? 'h-6 w-6' : 'h-4 w-4'}`} />\n        </Button>\n      )}\n\n      {/* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞ */}\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        onClick={addNewSheet}\n        className={`p-0 rounded-full bg-gradient-to-br from-green-500/10 to-emerald-600/10 hover:from-green-500/20 hover:to-emerald-600/20 active:from-green-500/30 active:to-emerald-600/30 dark:from-green-400/10 dark:to-emerald-500/10 dark:hover:from-green-400/20 dark:hover:to-emerald-500/20 dark:active:from-green-400/30 dark:active:to-emerald-500/30 transition-all duration-300 hover:scale-110 active:scale-95 hover:shadow-lg hover:shadow-green-500/20 active:shadow-green-500/30 relative z-10 ring-2 ring-transparent hover:ring-green-300/30 dark:hover:ring-green-600/30 touch-manipulation ${isMobile ? 'h-11 w-11 ml-3' : 'h-9 w-9 ml-3'}`}\n        title=\"–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ª–∏—Å—Ç\"\n      >\n        <Plus className={`text-green-600 dark:text-green-400 drop-shadow-sm ${isMobile ? 'h-5 w-5' : 'h-5 w-5'}`} />\n      </Button>\n\n      {/* –î–∏–∞–ª–æ–≥ —É–±—Ä–∞–Ω - —Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º */}\n    </div>\n  );\n}","size_bytes":15498},"client/src/utils/sheets-manager.ts":{"content":"import { nanoid } from 'nanoid';\nimport { CanvasSheet, BotDataWithSheets, BotData, Node, Connection } from '@shared/schema';\n\nexport class SheetsManager {\n  \n  // –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫ –Ω–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É —Å –ª–∏—Å—Ç–∞–º–∏\n  static migrateLegacyData(legacyData: BotData): BotDataWithSheets {\n    const defaultSheet: CanvasSheet = {\n      id: nanoid(),\n      name: '–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫',\n      nodes: legacyData.nodes || [],\n      connections: legacyData.connections || [],\n      viewState: {\n        pan: { x: 0, y: 0 },\n        zoom: 100\n      },\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n\n    return {\n      sheets: [defaultSheet],\n      activeSheetId: defaultSheet.id,\n      version: 2\n    };\n  }\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º —Å –ª–∏—Å—Ç–∞–º–∏\n  static isNewFormat(data: any): data is BotDataWithSheets {\n    return data && data.version === 2 && Array.isArray(data.sheets);\n  }\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞\n  static createSheet(name: string, nodes: Node[] = [], connections: Connection[] = []): CanvasSheet {\n    // –ï—Å–ª–∏ —É–∑–ª—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã, —Å–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n    const defaultNodes = nodes.length === 0 ? [{\n      id: 'start',\n      type: 'start' as const,\n      position: { x: 100, y: 100 },\n      data: {\n        messageText: '–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –Ω–æ–≤—ã–π –±–æ—Ç. –ù–∞–∂–º–∏—Ç–µ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏.',\n        keyboardType: 'none' as const,\n        buttons: [],\n        resizeKeyboard: true,\n        oneTimeKeyboard: false,\n        markdown: false,\n        formatMode: 'none' as const,\n        synonyms: [],\n        isPrivateOnly: false,\n        adminOnly: false,\n        requiresAuth: false,\n        showInMenu: true,\n        enableStatistics: true,\n        customParameters: [],\n        options: [],\n        command: '/start',\n        description: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞'\n      }\n    }] : nodes;\n\n    return {\n      id: nanoid(),\n      name,\n      nodes: defaultNodes,\n      connections,\n      viewState: {\n        pan: { x: 0, y: 0 },\n        zoom: 100\n      },\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n  }\n\n  // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞\n  static duplicateSheet(originalSheet: CanvasSheet): CanvasSheet {\n    const duplicatedNodes = originalSheet.nodes.map(node => ({\n      ...node,\n      id: nanoid(),\n      position: {\n        x: node.position.x + 50, // –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏\n        y: node.position.y + 50\n      }\n    }));\n\n    // –û–±–Ω–æ–≤–ª—è–µ–º ID –≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö\n    const nodeIdMap = new Map(\n      originalSheet.nodes.map((node, index) => [node.id, duplicatedNodes[index].id])\n    );\n\n    const duplicatedConnections = originalSheet.connections.map(conn => ({\n      ...conn,\n      id: nanoid(),\n      source: nodeIdMap.get(conn.source) || conn.source,\n      target: nodeIdMap.get(conn.target) || conn.target\n    }));\n\n    return {\n      id: nanoid(),\n      name: `${originalSheet.name} (–∫–æ–ø–∏—è)`,\n      nodes: duplicatedNodes,\n      connections: duplicatedConnections,\n      viewState: { ...originalSheet.viewState },\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n  }\n\n  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç\n  static addSheet(data: BotDataWithSheets, name: string): BotDataWithSheets {\n    const newSheet = this.createSheet(name);\n    return {\n      ...data,\n      sheets: [...data.sheets, newSheet],\n      activeSheetId: newSheet.id\n    };\n  }\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—Å—Ç–∞\n  static deleteSheet(data: BotDataWithSheets, sheetId: string): BotDataWithSheets {\n    if (data.sheets.length <= 1) {\n      throw new Error('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –ª–∏—Å—Ç');\n    }\n\n    const filteredSheets = data.sheets.filter(sheet => sheet.id !== sheetId);\n    const newActiveSheetId = data.activeSheetId === sheetId \n      ? filteredSheets[0].id \n      : data.activeSheetId;\n\n    return {\n      ...data,\n      sheets: filteredSheets,\n      activeSheetId: newActiveSheetId\n    };\n  }\n\n  // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞\n  static renameSheet(data: BotDataWithSheets, sheetId: string, newName: string): BotDataWithSheets {\n    return {\n      ...data,\n      sheets: data.sheets.map(sheet => \n        sheet.id === sheetId \n          ? { ...sheet, name: newName, updatedAt: new Date() }\n          : sheet\n      )\n    };\n  }\n\n  // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ\n  static duplicateSheetInProject(data: BotDataWithSheets, sheetId: string): BotDataWithSheets {\n    const originalSheet = data.sheets.find(sheet => sheet.id === sheetId);\n    if (!originalSheet) {\n      throw new Error('–õ–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');\n    }\n\n    const duplicatedSheet = this.duplicateSheet(originalSheet);\n    return {\n      ...data,\n      sheets: [...data.sheets, duplicatedSheet],\n      activeSheetId: duplicatedSheet.id\n    };\n  }\n\n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞\n  static setActiveSheet(data: BotDataWithSheets, sheetId: string): BotDataWithSheets {\n    const sheetExists = data.sheets.some(sheet => sheet.id === sheetId);\n    if (!sheetExists) {\n      throw new Error('–õ–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');\n    }\n\n    return {\n      ...data,\n      activeSheetId: sheetId\n    };\n  }\n\n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤ –≤ –ª–∏—Å—Ç–µ\n  static updateSheetNodes(data: BotDataWithSheets, sheetId: string, nodes: Node[]): BotDataWithSheets {\n    return {\n      ...data,\n      sheets: data.sheets.map(sheet => \n        sheet.id === sheetId \n          ? { ...sheet, nodes, updatedAt: new Date() }\n          : sheet\n      )\n    };\n  }\n\n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ª–∏—Å—Ç–µ\n  static updateSheetConnections(data: BotDataWithSheets, sheetId: string, connections: Connection[]): BotDataWithSheets {\n    return {\n      ...data,\n      sheets: data.sheets.map(sheet => \n        sheet.id === sheetId \n          ? { ...sheet, connections, updatedAt: new Date() }\n          : sheet\n      )\n    };\n  }\n\n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤ –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ª–∏—Å—Ç–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n  static updateSheetData(data: BotDataWithSheets, sheetId: string, nodes: Node[], connections: Connection[]): BotDataWithSheets {\n    return {\n      ...data,\n      sheets: data.sheets.map(sheet => \n        sheet.id === sheetId \n          ? { ...sheet, nodes, connections, updatedAt: new Date() }\n          : sheet\n      )\n    };\n  }\n\n  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∏–¥–∞ –ª–∏—Å—Ç–∞ (–∑—É–º, –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ)\n  static updateSheetViewState(data: BotDataWithSheets, sheetId: string, viewState: { pan: { x: number; y: number }; zoom: number }): BotDataWithSheets {\n    return {\n      ...data,\n      sheets: data.sheets.map(sheet => \n        sheet.id === sheetId \n          ? { ...sheet, viewState, updatedAt: new Date() }\n          : sheet\n      )\n    };\n  }\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞\n  static getActiveSheet(data: BotDataWithSheets): CanvasSheet | null {\n    if (!data.activeSheetId) {\n      return data.sheets[0] || null;\n    }\n    return data.sheets.find(sheet => sheet.id === data.activeSheetId) || null;\n  }\n\n  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö\n  static validateData(data: BotDataWithSheets): string[] {\n    const errors: string[] = [];\n\n    if (!Array.isArray(data.sheets)) {\n      errors.push('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∏—Å—Ç–æ–≤');\n    }\n\n    if (data.sheets.length === 0) {\n      errors.push('–ü—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ª–∏—Å—Ç');\n    }\n\n    const activeSheet = this.getActiveSheet(data);\n    if (!activeSheet) {\n      errors.push('–ê–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ ID –ª–∏—Å—Ç–æ–≤\n    const sheetIds = data.sheets.map(sheet => sheet.id);\n    const uniqueIds = new Set(sheetIds);\n    if (sheetIds.length !== uniqueIds.size) {\n      errors.push('–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è ID –ª–∏—Å—Ç–æ–≤');\n    }\n\n    return errors;\n  }\n\n  // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n  static toLegacyFormat(data: BotDataWithSheets): BotData {\n    const activeSheet = this.getActiveSheet(data);\n    if (!activeSheet) {\n      return { nodes: [], connections: [] };\n    }\n\n    return {\n      nodes: activeSheet.nodes,\n      connections: activeSheet.connections\n    };\n  }\n}","size_bytes":8571},"client/src/components/editor/groups-panel.tsx":{"content":"import React, { useState, useEffect, useCallback } from 'react';\nimport { Users, Plus, UserPlus, X, Settings, Upload, Shield, UserCheck, MessageSquare, Globe, Clock, Tag, Search, Filter, Send, BarChart3, TrendingUp, Edit, Pin, PinOff, Trash, Crown, Bot, Ban, Volume2, VolumeX, UserMinus, MoreHorizontal } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Separator } from '@/components/ui/separator';\nimport { DropdownMenu, DropdownMenuTrigger, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuSub, DropdownMenuSubTrigger, DropdownMenuSubContent } from '@/components/ui/dropdown-menu';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { TelegramAuth } from '@/components/telegram-auth';\nimport type { BotGroup, InsertBotGroup } from '@shared/schema';\n\ninterface GroupsPanelProps {\n  projectId: number;\n  projectName: string;\n}\n\n// Using BotGroup type from schema instead of local interface\n\n// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–≤–∞—Ç–∞—Ä–∫–∏ –≥—Ä—É–ø–ø—ã —Å fallback\nfunction GroupAvatar({ \n  avatarUrl, \n  groupName, \n  size = 40, \n  className = \"\" \n}: { \n  avatarUrl?: string | null; \n  groupName: string; \n  size?: number; \n  className?: string; \n}) {\n  const [imageError, setImageError] = useState(false);\n  \n  // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã –¥–ª—è fallback\n  const initials = groupName\n    .split(' ')\n    .map(word => word.charAt(0))\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n  \n  const handleImageError = () => {\n    setImageError(true);\n  };\n  \n  // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä–∫–∞ –∏ –æ–Ω–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç <TOKEN>, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë\n  const showImage = avatarUrl && !imageError && !avatarUrl.includes('<TOKEN>');\n  \n  if (showImage) {\n    return (\n      <div \n        className={`relative rounded-lg overflow-hidden flex-shrink-0 ${className}`}\n        style={{ width: size, height: size }}\n      >\n        <img \n          src={avatarUrl}\n          alt={`${groupName} avatar`}\n          className=\"w-full h-full object-cover\"\n          onError={handleImageError}\n        />\n      </div>\n    );\n  }\n  \n  // Fallback: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã –∏–ª–∏ –∏–∫–æ–Ω–∫—É\n  return (\n    <div \n      className={`bg-gradient-to-br from-blue-500 to-purple-600 dark:from-blue-600 dark:to-purple-700 rounded-lg flex items-center justify-center flex-shrink-0 ${className}`}\n      style={{ width: size, height: size }}\n    >\n      {initials ? (\n        <span \n          className=\"text-white font-semibold\"\n          style={{ fontSize: size * 0.4 }}\n        >\n          {initials}\n        </span>\n      ) : (\n        <Users \n          className=\"text-white\" \n          size={size * 0.5} \n        />\n      )}\n    </div>\n  );\n}\n\nexport function GroupsPanel({ projectId, projectName }: GroupsPanelProps) {\n  const [showAddGroup, setShowAddGroup] = useState(false);\n  const [showGroupSettings, setShowGroupSettings] = useState(false);\n  const [selectedGroup, setSelectedGroup] = useState<BotGroup | null>(null);\n  const [groupUrl, setGroupUrl] = useState('');\n  const [groupName, setGroupName] = useState('');\n  const [groupId, setGroupId] = useState('');\n  const [isParsingGroup, setIsParsingGroup] = useState(false);\n  const [groupDescription, setGroupDescription] = useState('');\n  const [groupAvatarUrl, setGroupAvatarUrl] = useState('');\n  const [groupLanguage, setGroupLanguage] = useState('ru');\n  const [groupTimezone, setGroupTimezone] = useState('');\n  const [groupTags, setGroupTags] = useState<string[]>([]);\n  const [groupNotes, setGroupNotes] = useState('');\n  const [makeAdmin, setMakeAdmin] = useState(false);\n  const [isPublicGroup, setIsPublicGroup] = useState(false);\n  const [publicUsername, setPublicUsername] = useState('');\n  const [adminRights, setAdminRights] = useState({\n    can_manage_chat: false,\n    can_change_info: false,\n    can_delete_messages: false,\n    can_invite_users: false,\n    can_restrict_members: false,\n    can_pin_messages: false,\n    can_promote_members: false,\n    can_manage_video_chats: false,\n    can_be_anonymous: false,\n    can_manage_stories: false\n  });\n  const [searchQuery, setSearchQuery] = useState('');\n  const [filterType, setFilterType] = useState<'all' | 'admin' | 'member'>('all');\n  const [showSendMessage, setShowSendMessage] = useState(false);\n  const [messageToSend, setMessageToSend] = useState('');\n  const [selectedGroupForMessage, setSelectedGroupForMessage] = useState<BotGroup | null>(null);\n  \n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  const [showUserSearch, setShowUserSearch] = useState(false);\n  const [userSearchQuery, setUserSearchQuery] = useState('');\n  const [selectedGroupForPromotion, setSelectedGroupForPromotion] = useState<BotGroup | null>(null);\n  const [userToFind, setUserToFind] = useState(''); // –î–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n  const [showAdminSearch, setShowAdminSearch] = useState(false); // –î–ª—è –ø–æ–∏—Å–∫–∞ —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–æ–º\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Load groups from database\n  const { data: groups = [], isLoading, error, refetch } = useQuery({\n    queryKey: ['/api/projects', projectId, 'groups'],\n    queryFn: () => fetch(`/api/projects/${projectId}/groups`).then(res => res.json()) as Promise<BotGroup[]>\n  });\n\n  // Ensure groups is always an array\n  const safeGroups = Array.isArray(groups) ? groups : [];\n  \n  // Auto-update existing groups with missing info\n  useEffect(() => {\n    if (safeGroups.length > 0) {\n      safeGroups.forEach(group => {\n        // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä—É–ø–ø—ã –≥–¥–µ –Ω–∞–∑–≤–∞–Ω–∏–µ = ID (–∑–Ω–∞—á–∏—Ç –Ω–µ —Å–ø–∞—Ä—Å–∏–ª–æ—Å—å)\n        if (group.name === group.groupId && group.groupId) {\n          console.log('Auto-updating group info for:', group.groupId);\n          // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤\n          setTimeout(() => {\n            parseGroupInfoMutation.mutate(group.groupId!);\n          }, Math.random() * 2000 + 1000); // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 1-3 —Å–µ–∫—É–Ω–¥—ã\n        }\n      });\n    }\n  }, [safeGroups.length]); // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥—Ä—É–ø–ø\n\n  // Create group mutation\n  const createGroupMutation = useMutation({\n    mutationFn: async (groupData: Omit<InsertBotGroup, 'projectId'>) => {\n      return apiRequest('POST', `/api/projects/${projectId}/groups`, groupData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/projects', projectId, 'groups'] });\n      toast({ title: '–ì—Ä—É–ø–ø–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞' });\n    },\n    onError: () => {\n      toast({ title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≥—Ä—É–ø–ø—ã', variant: 'destructive' });\n    }\n  });\n\n  // Delete group mutation\n  const deleteGroupMutation = useMutation({\n    mutationFn: async (groupId: number) => {\n      return apiRequest('DELETE', `/api/projects/${projectId}/groups/${groupId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/projects', projectId, 'groups'] });\n      toast({ title: '–ì—Ä—É–ø–ø–∞ —É–¥–∞–ª–µ–Ω–∞' });\n    },\n    onError: () => {\n      toast({ title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≥—Ä—É–ø–ø—ã', variant: 'destructive' });\n    }\n  });\n\n  // Update group mutation\n  const updateGroupMutation = useMutation({\n    mutationFn: async ({ groupId, data, showSuccessMessage = true }: { groupId: number, data: Partial<InsertBotGroup>, showSuccessMessage?: boolean }) => {\n      return apiRequest('PUT', `/api/projects/${projectId}/groups/${groupId}`, data);\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/projects', projectId, 'groups'] });\n      if (variables.showSuccessMessage) {\n        toast({ title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã' });\n      }\n      setShowGroupSettings(false);\n      setSelectedGroup(null);\n    },\n    onError: () => {\n      toast({ title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫', variant: 'destructive' });\n    }\n  });\n\n  // Send message to group mutation\n  const sendMessageMutation = useMutation({\n    mutationFn: async ({ groupId, message }: { groupId: string | null; message: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/send-group-message`, {\n        groupId,\n        message\n      });\n    },\n    onSuccess: () => {\n      toast({ title: '–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –≥—Ä—É–ø–ø—É' });\n      setShowSendMessage(false);\n      setMessageToSend('');\n      setSelectedGroupForMessage(null);\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Get group info mutation\n  const getGroupInfoMutation = useMutation({\n    mutationFn: async (groupId: string | null) => {\n      // Get both group info and member count\n      const [groupInfo, memberCount] = await Promise.all([\n        apiRequest('GET', `/api/projects/${projectId}/bot/group-info/${groupId}`),\n        apiRequest('GET', `/api/projects/${projectId}/bot/group-members-count/${groupId}`)\n      ]);\n      return { ...groupInfo, memberCount: memberCount.count };\n    },\n    onSuccess: (data) => {\n      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä—É–ø–ø–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n      const groupToUpdate = safeGroups.find(g => g.groupId === data.id?.toString());\n      if (groupToUpdate) {\n        updateGroupMutation.mutate({\n          groupId: groupToUpdate.id,\n          data: { \n            memberCount: data.memberCount,\n            chatType: data.type,\n            name: data.title || groupToUpdate.name\n          }\n        });\n      }\n      toast({ \n        title: `–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–µ –ø–æ–ª—É—á–µ–Ω–∞`, \n        description: `–ù–∞–∑–≤–∞–Ω–∏–µ: ${data.title}, –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${data.memberCount}, –¢–∏–ø: ${data.type === 'supergroup' ? '–°—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞' : data.type === 'group' ? '–ì—Ä—É–ø–ø–∞' : '–ö–∞–Ω–∞–ª'}`\n      });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Auto-parse group info mutation\n  const parseGroupInfoMutation = useMutation({\n    mutationFn: async (groupIdentifier: string) => {\n      setIsParsingGroup(true);\n      try {\n        // Get group info, admin status, and member count\n        const [groupInfo, adminStatus, memberCountData] = await Promise.all([\n          apiRequest('GET', `/api/projects/${projectId}/bot/group-info/${groupIdentifier}`),\n          apiRequest('GET', `/api/projects/${projectId}/bot/admin-status/${groupIdentifier}`),\n          apiRequest('GET', `/api/projects/${projectId}/bot/group-members-count/${groupIdentifier}`).catch(() => ({ count: null }))\n        ]);\n        return { \n          ...groupInfo, \n          isAdmin: adminStatus.isAdmin,\n          memberCount: memberCountData?.count || null\n        };\n      } finally {\n        setIsParsingGroup(false);\n      }\n    },\n    onSuccess: (data) => {\n      // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - —á—Ç–æ –ø—Ä–∏—à–ª–æ –æ—Ç Telegram API\n      console.log('TELEGRAM API RESPONSE:', JSON.stringify(data, null, 2));\n      console.log('Available fields:', Object.keys(data));\n      console.log('Description field:', data.description);\n      console.log('Bio field:', data.bio);\n      console.log('About field:', data.about);\n      \n      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\n      if (data.title && !groupName) {\n        setGroupName(data.title);\n      }\n      \n      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å\n      let generatedUrl = '';\n      let isGroupPublic = false;\n      \n      if (data.username) {\n        // –ì—Ä—É–ø–ø–∞ –ø—É–±–ª–∏—á–Ω–∞—è, –µ—Å—Ç—å username\n        generatedUrl = `https://t.me/${data.username}`;\n        isGroupPublic = true;\n        setGroupUrl(generatedUrl);\n        setIsPublicGroup(true);\n        setPublicUsername(`@${data.username}`);\n      } else if (data.invite_link) {\n        // –ì—Ä—É–ø–ø–∞ –ø—Ä–∏–≤–∞—Ç–Ω–∞—è, –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ invite link\n        generatedUrl = data.invite_link;\n        isGroupPublic = false;\n        setGroupUrl(generatedUrl);\n        setIsPublicGroup(false);\n        setPublicUsername('');\n      } else {\n        // –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö ID –Ω–µ —Å–æ–∑–¥–∞–µ–º –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É\n        setGroupUrl('');\n        setIsPublicGroup(false);\n        setPublicUsername('');\n      }\n      \n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n      setMakeAdmin(data.isAdmin || false);\n      \n      // –û–±–Ω–æ–≤–ª—è–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –≥—Ä—É–ø–ø—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n      const existingGroup = safeGroups.find(g => g.groupId === data.id?.toString());\n      if (existingGroup && data.title) {\n        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n        const updateData: any = {\n          name: data.title,\n          url: generatedUrl,\n          isAdmin: data.isAdmin ? 1 : 0,\n          isPublic: isGroupPublic ? 1 : 0,\n          chatType: data.type || 'group'\n        };\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å\n        if (data.description) {\n          updateData.description = data.description;\n        }\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å\n        if (data.avatarUrl) {\n          updateData.avatarUrl = data.avatarUrl;\n        }\n        \n        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –µ—Å–ª–∏ –µ—Å—Ç—å\n        if (data.memberCount !== null && data.memberCount !== undefined) {\n          updateData.memberCount = data.memberCount;\n        }\n        \n        updateGroupMutation.mutate({\n          groupId: existingGroup.id,\n          data: updateData\n        });\n      }\n      \n      // –°–æ–∑–¥–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n      const infoLines = [\n        `${data.title || data.id}`,\n        `${data.username ? '@' + data.username : 'ID: ' + data.id}`,\n        `${data.isAdmin ? '–ê–¥–º–∏–Ω' : '–£—á–∞—Å—Ç–Ω–∏–∫'}`,\n      ];\n      \n      if (data.memberCount) {\n        infoLines.push(`${data.memberCount} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`);\n      }\n      \n      if (data.description && data.description.length > 0) {\n        const shortDescription = data.description.length > 50 \n          ? data.description.substring(0, 50) + '...' \n          : data.description;\n        infoLines.push(`–û–ø–∏—Å–∞–Ω–∏–µ: ${shortDescription}`);\n      }\n      \n      toast({ \n        title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', \n        description: infoLines.join(' ‚Ä¢ ')\n      });\n    },\n    onError: (error: any) => {\n      setIsParsingGroup(false);\n      // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥\n    }\n  });\n\n  // Auto-parse when groupId changes\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      const identifier = groupId.trim();\n      if (identifier && (identifier.startsWith('-') || identifier.startsWith('@') || identifier.includes('t.me'))) {\n        let groupIdentifier = identifier;\n        \n        // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å—Å—ã–ª–æ–∫\n        if (identifier.includes('t.me/')) {\n          const match = identifier.match(/t.me\\/([^?\\/]+)/);\n          if (match) {\n            groupIdentifier = match[1].startsWith('+') ? match[1] : '@' + match[1];\n          }\n        }\n        \n        parseGroupInfoMutation.mutate(groupIdentifier);\n      }\n    }, 1500); // –ó–∞–¥–µ—Ä–∂–∫–∞ 1.5 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞\n\n    return () => clearTimeout(timeoutId);\n  }, [groupId, projectId]);\n\n  // Get group members count mutation\n  const getMembersCountMutation = useMutation({\n    mutationFn: async (groupId: string | null) => {\n      return apiRequest('GET', `/api/projects/${projectId}/bot/group-members-count/${groupId}`);\n    },\n    onSuccess: (data) => {\n      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n      const groupToUpdate = safeGroups.find(g => g.groupId === data.groupId);\n      if (groupToUpdate) {\n        updateGroupMutation.mutate({\n          groupId: groupToUpdate.id,\n          data: { memberCount: data.count }\n        });\n      }\n      toast({ title: `–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –≥—Ä—É–ø–ø–µ: ${data.count}` });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Get admin status mutation\n  const getAdminStatusMutation = useMutation({\n    mutationFn: async (groupId: string | null) => {\n      return apiRequest('GET', `/api/projects/${projectId}/bot/admin-status/${groupId}`);\n    },\n    onSuccess: (data) => {\n      toast({ \n        title: `–°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ: ${data.isAdmin ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–£—á–∞—Å—Ç–Ω–∏–∫'}`, \n        description: `–ü—Ä–∞–≤–∞: ${data.status}`\n      });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞', \n        description: error.error || '–ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Get group administrators mutation\n  const [administrators, setAdministrators] = React.useState<any[]>([]);\n  const [isLoadingMembers, setIsLoadingMembers] = useState(false);\n  const [clientApiMembers, setClientApiMembers] = React.useState<any[]>([]);\n  const [showTelegramAuth, setShowTelegramAuth] = useState(false);\n  const [selectedMember, setSelectedMember] = useState<any>(null);\n  const [showPermissionsDialog, setShowPermissionsDialog] = useState(false);\n  const [memberPermissions, setMemberPermissions] = useState({\n    // –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞\n    can_send_messages: true,\n    can_send_media_messages: true,\n    can_send_polls: true,\n    can_send_other_messages: true,\n    can_add_web_page_previews: true,\n    \n    // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è\n    can_change_info: false,\n    can_delete_messages: false,\n    can_restrict_members: false,\n    can_invite_users: false,\n    can_pin_messages: false,\n    can_manage_video_chats: false,\n    can_be_anonymous: false,\n    can_promote_members: false\n  });\n  \n  const getAdminsMutation = useMutation({\n    mutationFn: async (groupId: string | null) => {\n      return apiRequest('GET', `/api/projects/${projectId}/bot/group-admins/${groupId}`);\n    },\n    onSuccess: (data) => {\n      setAdministrators(data.administrators || []);\n      toast({ title: `–ü–æ–ª—É—á–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: ${data.administrators?.length || 0}` });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Get all group members mutation\n  const getAllMembersMutation = useMutation({\n    mutationFn: async (groupId: string | null) => {\n      return apiRequest('GET', `/api/projects/${projectId}/bot/group-members/${groupId}`);\n    },\n    onSuccess: (data) => {\n      setClientApiMembers(data.members || []);\n      toast({ \n        title: data.isPartialList ? `–ü–æ–∫–∞–∑–∞–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã: ${data.totalCount || 0}` : `–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏: ${data.totalCount || 0}`,\n        description: data.message || data.explanation || (data.isPartialList ? \"Telegram API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫\" : \"–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\")\n      });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤', \n        description: error.error || '–°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –≥—Ä—É–ø–ø',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Get saved members from database\n  const [savedMembers, setSavedMembers] = React.useState<any[]>([]);\n  \n  const getSavedMembersMutation = useMutation({\n    mutationFn: async (groupId: string | null) => {\n      return apiRequest('GET', `/api/projects/${projectId}/groups/${groupId}/saved-members`);\n    },\n    onSuccess: (data) => {\n      setSavedMembers(data.members || []);\n      console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.members?.length || 0} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö`);\n    },\n    onError: (error: any) => {\n      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:', error);\n      // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º toast –¥–ª—è —ç—Ç–æ–π –æ—à–∏–±–∫–∏, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Ñ–æ–Ω–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è\n    }\n  });\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–≥–¥–∞ –≤—ã–±—Ä–∞–Ω–∞ –≥—Ä—É–ø–ø–∞\n  useEffect(() => {\n    if (selectedGroup?.groupId) {\n      getSavedMembersMutation.mutate(selectedGroup.groupId);\n    }\n  }, [selectedGroup?.groupId]);\n\n  // Mute member mutation\n  const muteMemberMutation = useMutation({\n    mutationFn: async ({ groupId, userId, untilDate }: { groupId: string | null; userId: string; untilDate?: number }) => {\n      try {\n        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º Bot API\n        return await apiRequest('POST', `/api/projects/${projectId}/bot/restrict-member`, {\n          groupId,\n          userId,\n          permissions: {\n            can_send_messages: false,\n            can_send_media_messages: false,\n            can_send_polls: false,\n            can_send_other_messages: false,\n            can_add_web_page_previews: false\n          },\n          untilDate\n        });\n      } catch (botApiError: any) {\n        console.log('Bot API failed, trying Client API:', botApiError);\n        // –ï—Å–ª–∏ Bot API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º Client API\n        return await apiRequest('POST', `/api/projects/${projectId}/telegram-client/restrict-member`, {\n          groupId,\n          userId,\n          untilDate: untilDate || Math.floor(Date.now() / 1000) + 3600\n        });\n      }\n    },\n    onSuccess: (data: any) => {\n      toast({ \n        title: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–º—É—á–µ–Ω',\n        description: data.message || '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ'\n      });\n      setUserIdToBan('');\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/telegram-client/group-members/${selectedGroup?.groupId}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/group-admins/${selectedGroup?.groupId}`] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –º—É—Ç–µ', \n        description: error.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–º—É—Ç–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Kick member mutation - –ø—Ä–æ–±—É–µ–º —Å–Ω–∞—á–∞–ª–∞ Bot API, –ø–æ—Ç–æ–º Client API\n  const kickMemberMutation = useMutation({\n    mutationFn: async ({ groupId, userId }: { groupId: string | null; userId: string }) => {\n      try {\n        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º Bot API\n        return await apiRequest('POST', `/api/projects/${projectId}/bot/kick-member`, {\n          groupId,\n          userId\n        });\n      } catch (botApiError: any) {\n        console.log('Bot API failed, trying Client API:', botApiError);\n        // –ï—Å–ª–∏ Bot API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º Client API\n        return await apiRequest('POST', `/api/projects/${projectId}/telegram-client/kick-member`, {\n          groupId,\n          userId\n        });\n      }\n    },\n    onSuccess: (data: any) => {\n      toast({ \n        title: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ –≥—Ä—É–ø–ø—ã',\n        description: data.message || '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ'\n      });\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/telegram-client/group-members/${selectedGroup?.groupId}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/group-admins/${selectedGroup?.groupId}`] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏', \n        description: error.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∏—Å–∫–ª—é—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Load member permissions when dialog opens\n  const loadMemberPermissionsMutation = useMutation({\n    mutationFn: async ({ groupId, userId }: { groupId: string; userId: string }) => {\n      console.log('üîç Loading member permissions for:', { groupId, userId });\n      return await apiRequest('GET', `/api/projects/${projectId}/bot/check-member/${groupId}/${userId}`);\n    },\n    onSuccess: (data: any) => {\n      console.log('‚úÖ loadMemberPermissionsMutation success:', data);\n      const member = data?.member;\n      if (member) {\n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞\n        setMemberPermissions({\n          // –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)\n          can_send_messages: true,\n          can_send_media_messages: true,\n          can_send_polls: true,\n          can_send_other_messages: true,\n          can_add_web_page_previews: true,\n          \n          // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (–±–µ—Ä–µ–º –∏–∑ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤)\n          can_change_info: member.can_change_info || false,\n          can_delete_messages: member.can_delete_messages || false,\n          can_restrict_members: member.can_restrict_members || false,\n          can_invite_users: member.can_invite_users || false,\n          can_pin_messages: member.can_pin_messages || false,\n          can_manage_video_chats: member.can_manage_video_chats || false,\n          can_be_anonymous: member.is_anonymous || member.can_be_anonymous || false,\n          can_promote_members: member.can_promote_members || false\n        });\n        \n        console.log('Loaded member permissions from API:', {\n          member,\n          mappedPermissions: {\n            can_change_info: member.can_change_info,\n            can_delete_messages: member.can_delete_messages,\n            can_restrict_members: member.can_restrict_members,\n            can_invite_users: member.can_invite_users,\n            can_pin_messages: member.can_pin_messages,\n            can_manage_video_chats: member.can_manage_video_chats,\n            can_be_anonymous: member.is_anonymous || member.can_be_anonymous,\n            can_promote_members: member.can_promote_members\n          }\n        });\n      }\n    },\n    onError: (error: any) => {\n      console.log('Failed to load member permissions:', error);\n      // –û—Å—Ç–∞–≤–ª—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n    }\n  });\n\n  // Update member permissions mutation\n  const updatePermissionsMutation = useMutation({\n    mutationFn: async ({ groupId, userId, permissions }: { groupId: string | null; userId: string; permissions: any }) => {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞\n      const hasAdminRights = permissions.can_delete_messages || permissions.can_restrict_members || \n                            permissions.can_promote_members || permissions.can_manage_video_chats ||\n                            permissions.can_be_anonymous || permissions.can_change_info || \n                            permissions.can_pin_messages || permissions.can_invite_users;\n      \n      console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:', {\n        selectedMember: selectedMember,\n        userId: userId,\n        groupId: groupId,\n        currentPermissions: memberPermissions,\n        newPermissions: permissions,\n        hasAdminRights: hasAdminRights\n      });\n      \n      if (hasAdminRights) {\n        // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º promote-member\n        try {\n          return await apiRequest('POST', `/api/projects/${projectId}/bot/promote-member`, {\n            groupId,\n            userId,\n            can_change_info: permissions.can_change_info,\n            can_delete_messages: permissions.can_delete_messages,\n            can_invite_users: permissions.can_invite_users,\n            can_restrict_members: permissions.can_restrict_members,\n            can_pin_messages: permissions.can_pin_messages,\n            can_promote_members: permissions.can_promote_members,\n            can_manage_video_chats: permissions.can_manage_video_chats,\n            can_be_anonymous: permissions.can_be_anonymous,\n            can_manage_topics: false\n          });\n        } catch (botApiError: any) {\n          console.log('Bot API failed for promotion, trying Client API:', botApiError);\n          // –ï—Å–ª–∏ Bot API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º Client API\n          return await apiRequest('POST', `/api/projects/${projectId}/telegram-client/promote-member`, {\n            groupId,\n            userId,\n            adminRights: {\n              can_change_info: permissions.can_change_info,\n              can_delete_messages: permissions.can_delete_messages,\n              can_invite_users: permissions.can_invite_users,\n              can_restrict_members: permissions.can_restrict_members,\n              can_pin_messages: permissions.can_pin_messages,\n              can_promote_members: permissions.can_promote_members,\n              can_manage_video_chats: permissions.can_manage_video_chats,\n              can_be_anonymous: permissions.can_be_anonymous,\n              can_manage_topics: false\n            }\n          });\n        }\n      } else if (selectedMember?.status === 'administrator' || selectedMember?.friendlyStatus === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {\n        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –Ω–æ —É –Ω–µ–≥–æ –Ω–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∞–≤, –¥–µ–º–æ—Ç–∏—Ä—É–µ–º –µ–≥–æ\n        try {\n          return await apiRequest('POST', `/api/projects/${projectId}/bot/demote-member`, {\n            groupId,\n            userId\n          });\n        } catch (botApiError: any) {\n          console.log('Bot API failed for demotion, trying Client API:', botApiError);\n          // –ï—Å–ª–∏ Bot API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º Client API\n          return await apiRequest('POST', `/api/projects/${projectId}/telegram-client/demote-member`, {\n            groupId,\n            userId\n          });\n        }\n      } else {\n        // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–µ –ø—Ä–∞–≤–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º restrict-member\n        try {\n          return await apiRequest('POST', `/api/projects/${projectId}/bot/restrict-member`, {\n            groupId,\n            userId,\n            permissions: {\n              can_send_messages: permissions.can_send_messages,\n              can_send_media_messages: permissions.can_send_media_messages,\n              can_send_polls: permissions.can_send_polls,\n              can_send_other_messages: permissions.can_send_other_messages,\n              can_add_web_page_previews: permissions.can_add_web_page_previews\n            }\n          });\n        } catch (botApiError: any) {\n          console.log('Bot API failed, trying Client API:', botApiError);\n          // –ï—Å–ª–∏ Bot API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º Client API\n          return await apiRequest('POST', `/api/projects/${projectId}/telegram-client/restrict-member`, {\n            groupId,\n            userId,\n            untilDate: Math.floor(Date.now() / 1000) + 3600 // 1 —á–∞—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n          });\n        }\n      }\n    },\n    onSuccess: () => {\n      toast({ title: '–†–∞–∑—Ä–µ—à–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã' });\n      setShowPermissionsDialog(false);\n      refetch();\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–º–µ–Ω—É –≥—Ä—É–ø–ø—ã –¥–ª—è —Å–±—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö\n  const [lastSelectedGroupId, setLastSelectedGroupId] = React.useState<string | null>(null);\n  \n  React.useEffect(() => {\n    if (selectedGroup) {\n      // –ï—Å–ª–∏ —Å–º–µ–Ω–∏–ª–∞—Å—å –≥—Ä—É–ø–ø–∞, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ\n      if (lastSelectedGroupId !== selectedGroup.groupId) {\n        setAdministrators([]);\n        setClientApiMembers([]);\n        setLastSelectedGroupId(selectedGroup.groupId);\n      }\n    }\n  }, [selectedGroup]);\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –≥—Ä—É–ø–ø—ã\n  React.useEffect(() => {\n    if (selectedGroup && showGroupSettings) {\n      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç\n      if (administrators.length === 0) {\n        getAdminsMutation.mutate(selectedGroup.groupId);\n      }\n    }\n  }, [selectedGroup, showGroupSettings]);\n\n  // Ban member mutation\n  const [userIdToBan, setUserIdToBan] = React.useState('');\n  const [userIdToUnban, setUserIdToUnban] = React.useState('');\n  const banMemberMutation = useMutation({\n    mutationFn: async ({ groupId, userId, untilDate }: { groupId: string | null; userId: string; untilDate?: number }) => {\n      try {\n        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º Bot API\n        return await apiRequest('POST', `/api/projects/${projectId}/bot/ban-member`, {\n          groupId,\n          userId,\n          untilDate\n        });\n      } catch (botApiError: any) {\n        console.log('Bot API failed, trying Client API:', botApiError);\n        // –ï—Å–ª–∏ Bot API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º Client API\n        return await apiRequest('POST', `/api/projects/${projectId}/telegram-client/ban-member`, {\n          groupId,\n          userId,\n          untilDate\n        });\n      }\n    },\n    onSuccess: (data: any) => {\n      toast({ \n        title: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω',\n        description: data.message || '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ'\n      });\n      setUserIdToBan('');\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/telegram-client/group-members/${selectedGroup?.groupId}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/group-admins/${selectedGroup?.groupId}`] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ', \n        description: error.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Unban member mutation\n  const unbanMemberMutation = useMutation({\n    mutationFn: async ({ groupId, userId }: { groupId: string | null; userId: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/unban-member`, {\n        groupId,\n        userId\n      });\n    },\n    onSuccess: () => {\n      toast({ title: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' });\n      setUserIdToUnban('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Group settings mutations\n  const [newGroupTitle, setNewGroupTitle] = React.useState('');\n  const [newGroupDescription, setNewGroupDescription] = React.useState('');\n  const [messageIdToPin, setMessageIdToPin] = React.useState('');\n  const [messageIdToUnpin, setMessageIdToUnpin] = React.useState('');\n  const [messageIdToDelete, setMessageIdToDelete] = React.useState('');\n  const [inviteLinkName, setInviteLinkName] = React.useState('');\n  const [inviteLinkLimit, setInviteLinkLimit] = React.useState('');\n\n  const setGroupTitleMutation = useMutation({\n    mutationFn: async ({ groupId, title }: { groupId: string | null; title: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/set-group-title`, {\n        groupId,\n        title\n      });\n    },\n    onSuccess: () => {\n      toast({ title: '–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∏–∑–º–µ–Ω–µ–Ω–æ' });\n      setNewGroupTitle('');\n      // Refresh group data\n      refetch();\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  const setGroupDescriptionMutation = useMutation({\n    mutationFn: async ({ groupId, description }: { groupId: string | null; description: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/set-group-description`, {\n        groupId,\n        description\n      });\n    },\n    onSuccess: () => {\n      toast({ title: '–û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∏–∑–º–µ–Ω–µ–Ω–æ' });\n      setNewGroupDescription('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  const setGroupUsernameMutation = useMutation({\n    mutationFn: async ({ groupId, username }: { groupId: string | null; username: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/set-group-username`, {\n        groupId,\n        username\n      });\n    }\n  });\n\n  const setGroupPhotoMutation = useMutation({\n    mutationFn: async ({ groupId, photoPath }: { groupId: string | null; photoPath: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/set-group-photo`, {\n        groupId,\n        photoPath\n      });\n    },\n    onSuccess: () => {\n      toast({ title: '–ê–≤–∞—Ç–∞—Ä–∫–∞ –≥—Ä—É–ø–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∞' });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  const updateBotAdminRightsMutation = useMutation({\n    mutationFn: async ({ groupId, adminRights }: { groupId: string | null; adminRights: any }) => {\n      // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º Bot API, –Ω–æ –æ–Ω –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤\n      try {\n        return await apiRequest('POST', `/api/projects/${projectId}/bot/update-admin-rights`, {\n          groupId,\n          adminRights\n        });\n      } catch (botApiError: any) {\n        console.log('Bot API –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º Client API:', botApiError);\n        // –ò—Å–ø–æ–ª—å–∑—É–µ–º Client API –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n        return await apiRequest('POST', `/api/projects/${projectId}/telegram-client/update-bot-admin-rights`, {\n          groupId,\n          adminRights\n        });\n      }\n    },\n    onSuccess: () => {\n      toast({ title: '–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ Telegram' });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–∞–≤ –≤ Telegram', \n        description: error.error || '–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤ –±–æ—Ç–∞ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≥—Ä—É–ø–ø—ã –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –ø—Ä–∞–≤–æ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  const pinMessageMutation = useMutation({\n    mutationFn: async ({ groupId, messageId }: { groupId: string | null; messageId: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/pin-message`, {\n        groupId,\n        messageId,\n        disableNotification: false\n      });\n    },\n    onSuccess: () => {\n      toast({ title: '–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ' });\n      setMessageIdToPin('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –∏ ID —Å–æ–æ–±—â–µ–Ω–∏—è',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  const unpinMessageMutation = useMutation({\n    mutationFn: async ({ groupId, messageId }: { groupId: string | null; messageId?: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/unpin-message`, {\n        groupId,\n        messageId\n      });\n    },\n    onSuccess: (_, variables) => {\n      toast({ title: variables.messageId ? '–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–æ' : '–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω—ã' });\n      setMessageIdToUnpin('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  const deleteMessageMutation = useMutation({\n    mutationFn: async ({ groupId, messageId }: { groupId: string | null; messageId: string }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/delete-message`, {\n        groupId,\n        messageId\n      });\n    },\n    onSuccess: () => {\n      toast({ title: '–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ' });\n      setMessageIdToDelete('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –∏ ID —Å–æ–æ–±—â–µ–Ω–∏—è',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  const createInviteLinkMutation = useMutation({\n    mutationFn: async ({ groupId, name, memberLimit, createsJoinRequest }: { \n      groupId: string | null; \n      name?: string; \n      memberLimit?: number; \n      createsJoinRequest: boolean \n    }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/create-invite-link`, {\n        groupId,\n        name,\n        memberLimit,\n        createsJoinRequest\n      });\n    },\n    onSuccess: (data) => {\n      toast({ \n        title: '–°—Å—ã–ª–∫–∞-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∞',\n        description: `–ù–æ–≤–∞—è —Å—Å—ã–ª–∫–∞: ${data.inviteLink.invite_link}`\n      });\n      setInviteLinkName('');\n      setInviteLinkLimit('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Å—ã–ª–∫–∏', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Restrict member mutation (mute)\n  const [userIdToMute, setUserIdToMute] = React.useState('');\n  const [muteMinutes, setMuteMinutes] = React.useState('');\n  \n  const restrictMemberMutation = useMutation({\n    mutationFn: async ({ groupId, userId, untilDate }: { groupId: string | null; userId: string; untilDate?: number }) => {\n      return apiRequest('POST', `/api/projects/${projectId}/bot/restrict-member`, {\n        groupId,\n        userId,\n        permissions: {\n          can_send_messages: false,\n          can_send_audios: false,\n          can_send_documents: false,\n          can_send_photos: false,\n          can_send_videos: false,\n          can_send_video_notes: false,\n          can_send_voice_notes: false,\n          can_send_polls: false,\n          can_send_other_messages: false,\n          can_add_web_page_previews: false,\n          can_change_info: false,\n          can_invite_users: false,\n          can_pin_messages: false,\n          can_manage_topics: false\n        },\n        untilDate\n      });\n    },\n    onSuccess: () => {\n      toast({ title: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥–ª—É—à–µ–Ω' });\n      setUserIdToMute('');\n      setMuteMinutes('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥–ª—É—à–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', \n        description: error.error || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Promote member mutation - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ Bot API\n  const promoteMemberMutation = useMutation({\n    mutationFn: async ({ groupId, userId, adminRights }: { groupId: string | null; userId: string; adminRights: any }) => {\n      return await apiRequest('POST', `/api/projects/${projectId}/bot/promote-member`, {\n        groupId,\n        userId,\n        ...adminRights  // –ü–µ—Ä–µ–¥–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –≤ permissions\n      });\n    },\n    onSuccess: (data: any) => {\n      toast({ \n        title: '–£—á–∞—Å—Ç–Ω–∏–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º',\n        description: data.message || '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ'\n      });\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/telegram-client/group-members/${selectedGroup?.groupId}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/group-admins/${selectedGroup?.groupId}`] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', \n        description: error.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Demote member mutation - —Å–Ω–∞—á–∞–ª–∞ Bot API, –ø–æ—Ç–æ–º Client API\n  const demoteMemberMutation = useMutation({\n    mutationFn: async ({ groupId, userId }: { groupId: string | null; userId: string }) => {\n      try {\n        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º Bot API\n        return await apiRequest('POST', `/api/projects/${projectId}/bot/demote-member`, {\n          groupId,\n          userId\n        });\n      } catch (botApiError: any) {\n        console.log('Bot API failed, trying Client API:', botApiError);\n        // –ï—Å–ª–∏ Bot API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º Client API\n        return await apiRequest('POST', `/api/projects/${projectId}/telegram-client/demote-member`, {\n          groupId,\n          userId\n        });\n      }\n    },\n    onSuccess: (data: any) => {\n      toast({ \n        title: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ —Å–Ω—è—Ç—ã',\n        description: data.message || '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ'\n      });\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/telegram-client/group-members/${selectedGroup?.groupId}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/projects/${projectId}/bot/group-admins/${selectedGroup?.groupId}`] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', \n        description: error.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–Ω—è—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Check member status mutation\n  const checkMemberMutation = useMutation({\n    mutationFn: async ({ groupId, userId }: { groupId: string; userId: string }) => {\n      return await apiRequest('GET', `/api/projects/${projectId}/bot/check-member/${groupId}/${userId}`);\n    },\n    onSuccess: (data: any) => {\n      console.log('checkMemberMutation success:', data);\n      const member = data?.member;\n      if (member) {\n        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n        toast({ \n          title: '‚úÖ –°—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –Ω–∞–π–¥–µ–Ω', \n          description: `${member.user?.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'} (@${member.user?.username || '–±–µ–∑ username'}) - ${member.friendlyStatus}`,\n          duration: 5000\n        });\n\n        // –î–æ–±–∞–≤–ª—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ —Å–ø–∏—Å–æ–∫, –µ—Å–ª–∏ –µ–≥–æ —Ç–∞–º –µ—â–µ –Ω–µ—Ç\n        setAdministrators(prevAdmins => {\n          const existingMember = prevAdmins.find(admin => admin.user?.id === member.user?.id);\n          if (!existingMember) {\n            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –ø–æ–º–µ—Ç–∫–æ–π\n            const newMember = {\n              ...member,\n              foundViaSearch: true, // –ü–æ–º–µ—Ç–∫–∞ —á—Ç–æ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫\n              can_be_edited: false,\n              can_manage_chat: false,\n              can_change_info: false,\n              can_delete_messages: false,\n              can_invite_users: false,\n              can_restrict_members: false,\n              can_pin_messages: false,\n              can_promote_members: false,\n              can_manage_video_chats: false,\n              can_manage_voice_chats: false,\n              can_post_stories: false,\n              can_edit_stories: false,\n              can_delete_stories: false,\n              is_anonymous: false\n            };\n            return [...prevAdmins, newMember];\n          }\n          return prevAdmins;\n        });\n\n        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è\n        setUserToFind('');\n        \n        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ\n        if (selectedGroup?.groupId) {\n          getSavedMembersMutation.mutate(selectedGroup.groupId);\n        }\n      } else {\n        toast({ \n          title: '‚ùå –£—á–∞—Å—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω', \n          description: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã',\n          variant: 'destructive',\n          duration: 5000\n        });\n      }\n    },\n    onError: (error: any) => {\n      console.error('checkMemberMutation error:', error);\n      toast({ \n        title: '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞', \n        description: error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞',\n        variant: 'destructive',\n        duration: 5000\n      });\n    }\n  });\n\n  // Simple search user mutation - —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫  \n  const simpleSearchUserMutation = useMutation({\n    mutationFn: async (query: string) => {\n      return await apiRequest('GET', `/api/projects/${projectId}/bot/search-user/${encodeURIComponent(query)}`);\n    },\n    onSuccess: (data: any) => {\n      if (data.user && selectedGroup && selectedGroup.groupId) {\n        // –ò—Å–ø–æ–ª—å–∑—É–µ–º checkMemberMutation –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–æ–∫\n        checkMemberMutation.mutate({\n          groupId: selectedGroup.groupId,\n          userId: data.userId\n        });\n      }\n      setShowUserSearch(false);\n      setUserSearchQuery('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', \n        description: error.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É username –∏–ª–∏ ID',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  // Search user mutation (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–º)\n  const searchUserMutation = useMutation({\n    mutationFn: async (query: string) => {\n      return await apiRequest('GET', `/api/projects/${projectId}/bot/search-user/${encodeURIComponent(query)}`);\n    },\n    onSuccess: (data: any) => {\n      if (data.user && selectedGroupForPromotion) {\n        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è\n        const user = data.user;\n        const confirmMessage = `–ù–∞–∑–Ω–∞—á–∏—Ç—å ${user.first_name || user.username || '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'} (@${user.username || '–±–µ–∑ username'}) –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≥—Ä—É–ø–ø—ã \"${selectedGroupForPromotion.name}\"?`;\n        \n        if (confirm(confirmMessage)) {\n          promoteMemberMutation.mutate({\n            groupId: selectedGroupForPromotion.groupId,\n            userId: data.userId,\n            adminRights: {\n              can_manage_chat: true,\n              can_change_info: true,\n              can_delete_messages: true,\n              can_invite_users: true,\n              can_restrict_members: true,\n              can_pin_messages: true,\n              can_promote_members: true,\n              can_manage_video_chats: true\n            }\n          });\n        }\n      }\n      setShowUserSearch(false);\n      setUserSearchQuery('');\n    },\n    onError: (error: any) => {\n      toast({ \n        title: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', \n        description: error.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É username –∏–ª–∏ ID',\n        variant: 'destructive' \n      });\n    }\n  });\n\n  const handleAddGroup = () => {\n    const identifier = groupId.trim();\n    if (!identifier) {\n      toast({ title: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ ID –≥—Ä—É–ø–ø—ã –∏–ª–∏ @username', variant: 'destructive' });\n      return;\n    }\n    \n    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ ID –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n    const finalGroupName = groupName.trim() || identifier.replace('@', '').replace('https://t.me/', '') || 'New Group';\n    \n    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É —Ç–æ–ª—å–∫–æ –¥–ª—è username –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–µ–Ω–Ω—É—é\n    let finalGroupUrl = groupUrl.trim();\n    if (!finalGroupUrl) {\n      if (identifier.startsWith('@') || (!identifier.startsWith('-') && !identifier.includes('t.me'))) {\n        // –î–ª—è username —Å–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É\n        finalGroupUrl = `https://t.me/${identifier.replace('@', '')}`;\n      } else {\n        // –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö ID –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–º - —Å—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω–∞ –∏–∑ API\n        finalGroupUrl = '';\n      }\n    }\n\n    createGroupMutation.mutate({\n      groupId: identifier,\n      name: finalGroupName,\n      url: finalGroupUrl || '',\n      isAdmin: makeAdmin ? 1 : 0,\n      memberCount: null,\n      isActive: 1,\n      description: null,\n      settings: {},\n      chatType: 'group' as const,\n      adminRights: {\n        can_manage_chat: false,\n        can_change_info: false,\n        can_delete_messages: false,\n        can_invite_users: false,\n        can_restrict_members: false,\n        can_pin_messages: false,\n        can_promote_members: false,\n        can_manage_video_chats: false,\n        can_be_anonymous: false,\n        can_manage_stories: false\n      },\n      messagesCount: 0,\n      activeUsers: 0,\n      isPublic: 0,\n      language: 'ru' as const,\n      tags: []\n    });\n    \n    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫–∞ –∏ –æ—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É\n    setShowAddGroup(false);\n    setGroupUrl('');\n    setGroupName('');\n    setGroupId('');\n    setMakeAdmin(false);\n  };\n\n  return (\n    <div className=\"h-full w-full p-6 bg-background\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-2xl font-bold text-foreground mb-2\">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏</h1>\n          <p className=\"text-muted-foreground\">\n            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram –≥—Ä—É–ø–ø –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ \"{projectName}\"\n          </p>\n        </div>\n        \n        {isLoading ? (\n          <div className=\"text-center py-12\">\n            <div className=\"animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-4\"></div>\n            <p className=\"text-muted-foreground\">–ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä—É–ø–ø—ã...</p>\n          </div>\n        ) : safeGroups.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <div className=\"w-16 h-16 bg-muted rounded-lg flex items-center justify-center mx-auto mb-4\">\n              <Users className=\"w-8 h-8 text-muted-foreground\" />\n            </div>\n            <h3 className=\"text-lg font-medium text-muted-foreground mb-2\">\n              –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø\n            </h3>\n            <p className=\"text-sm text-muted-foreground mb-6\">\n              –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –≥—Ä—É–ø–ø—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n            </p>\n            <Button onClick={() => setShowAddGroup(true)}>\n              <UserPlus className=\"w-4 h-4 mr-2\" />\n              –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø—É\n            </Button>\n          </div>\n        ) : (\n          <div>\n            <div className=\"flex justify-between items-center mb-6\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã ({safeGroups.length})</h2>\n                <p className=\"text-sm text-muted-foreground\">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º–∏ Telegram –≥—Ä—É–ø–ø–∞–º–∏</p>\n              </div>\n              <Button onClick={() => setShowAddGroup(true)}>\n                <Plus className=\"w-4 h-4 mr-2\" />\n                –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É\n              </Button>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {safeGroups.map((group) => (\n                <Card key={group.id} className=\"p-6\">\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div className=\"flex items-center gap-4\">\n                      <GroupAvatar \n                        avatarUrl={group.avatarUrl}\n                        groupName={group.name}\n                        size={56}\n                      />\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold text-lg leading-tight mb-1\">{group.name}</h3>\n                        <div className=\"flex items-center gap-2\">\n                          <Badge variant={group.isAdmin ? \"default\" : \"secondary\"} className=\"text-xs\">\n                            {group.isAdmin ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–£—á–∞—Å—Ç–Ω–∏–∫'}\n                          </Badge>\n                          {group.chatType && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {group.chatType === 'supergroup' ? '–°—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞' : \n                               group.chatType === 'channel' ? '–ö–∞–Ω–∞–ª' : '–ì—Ä—É–ø–ø–∞'}\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä—É–ø–ø–µ:', group.groupId);\n                        parseGroupInfoMutation.mutate(group.groupId!);\n                      }}\n                      disabled={parseGroupInfoMutation.isPending}\n                      title=\"–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä—É–ø–ø–µ\"\n                    >\n                      {parseGroupInfoMutation.isPending ? '‚è≥' : 'üîÑ'}\n                    </Button>\n                  </div>\n                  \n                  <div className=\"space-y-3 mb-4\">\n                    {/* –û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã */}\n                    {group.description && (\n                      <div className=\"space-y-1\">\n                        <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                          {group.description.length > 140 ? group.description.substring(0, 140) + '...' : group.description}\n                        </p>\n                      </div>\n                    )}\n                    \n                    {/* –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */}\n                    <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <Users className=\"w-4 h-4 text-muted-foreground\" />\n                          <span className=\"font-medium\">\n                            {group.memberCount || 'N/A'} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n                          </span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Clock className=\"w-4 h-4 text-muted-foreground\" />\n                          <span className=\"text-muted-foreground\">\n                            {group.createdAt ? new Date(group.createdAt).toLocaleDateString() : 'N/A'}\n                          </span>\n                        </div>\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-start gap-2\">\n                          <Globe className=\"w-4 h-4 text-muted-foreground mt-0.5\" />\n                          <div className=\"flex-1 min-w-0\">\n                            <a \n                              href={group.url} \n                              target=\"_blank\" \n                              rel=\"noopener noreferrer\"\n                              className=\"text-blue-600 dark:text-blue-400 hover:underline text-xs break-all font-mono\"\n                              title={group.url}\n                            >\n                              {group.url.length > 35 ? group.url.substring(0, 35) + '...' : group.url}\n                            </a>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"border-t pt-4 space-y-3\">\n                    {/* –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <Button \n                        variant=\"default\" \n                        size=\"sm\" \n                        className=\"h-10\"\n                        onClick={() => {\n                          setSelectedGroup(group);\n                          setGroupName(group.name);\n                          setGroupUrl(group.url);\n                          setGroupDescription(group.description || '');\n                          setGroupAvatarUrl(group.avatarUrl || '');\n                          setGroupLanguage(group.language || 'ru');\n                          setGroupTimezone(group.timezone || '');\n                          setGroupTags(group.tags || []);\n                          setGroupNotes(group.notes || '');\n                          setMakeAdmin(group.isAdmin === 1);\n                          setIsPublicGroup(Boolean(group.isPublic));\n                          \n                          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π username –µ—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –ø—É–±–ª–∏—á–Ω–∞—è\n                          if (group.isPublic && group.url && !group.url.includes('+')) {\n                            // –ò–∑–≤–ª–µ–∫–∞–µ–º username –∏–∑ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏\n                            if (group.url.includes('t.me/')) {\n                              const username = group.url.replace('https://t.me/', '').replace('http://t.me/', '');\n                              setPublicUsername(username.startsWith('@') ? username : `@${username}`);\n                            } else if (group.url.startsWith('@')) {\n                              setPublicUsername(group.url);\n                            } else {\n                              setPublicUsername('');\n                            }\n                          } else {\n                            setPublicUsername('');\n                          }\n                          \n                          // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–∑ Telegram API\n                          if (group.isAdmin === 1 && group.groupId) {\n                            fetch(`/api/projects/${projectId}/bot/group-admins/${group.groupId}`)\n                              .then(res => res.json())\n                              .then(data => {\n                                // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –ø—Ä–∞–≤\n                                const baseRights = {\n                                  can_manage_chat: false,\n                                  can_change_info: false,\n                                  can_delete_messages: false,\n                                  can_invite_users: false,\n                                  can_restrict_members: false,\n                                  can_pin_messages: false,\n                                  can_promote_members: false,\n                                  can_manage_video_chats: false,\n                                  can_be_anonymous: false,\n                                  can_manage_stories: false\n                                };\n                                \n                                // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ API –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n                                const finalRights = {\n                                  ...baseRights,\n                                  ...((group.adminRights as any) || {}),\n                                  ...(data.botAdminRights || {})\n                                };\n                                \n                                setAdminRights(finalRights);\n                              })\n                              .catch(() => {\n                                // Fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ - —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É\n                                const baseRights = {\n                                  can_manage_chat: false,\n                                  can_change_info: false,\n                                  can_delete_messages: false,\n                                  can_invite_users: false,\n                                  can_restrict_members: false,\n                                  can_pin_messages: false,\n                                  can_promote_members: false,\n                                  can_manage_video_chats: false,\n                                  can_be_anonymous: false,\n                                  can_manage_stories: false\n                                };\n                                \n                                const finalRights = {\n                                  ...baseRights,\n                                  ...((group.adminRights as any) || {})\n                                };\n                                \n                                setAdminRights(finalRights);\n                              });\n                          } else {\n                            // –ï—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞\n                            setAdminRights({\n                              can_manage_chat: false,\n                              can_change_info: false,\n                              can_delete_messages: false,\n                              can_invite_users: false,\n                              can_restrict_members: false,\n                              can_pin_messages: false,\n                              can_promote_members: false,\n                              can_manage_video_chats: false,\n                              can_be_anonymous: false,\n                              can_manage_stories: false\n                            });\n                          }\n                          \n                          setShowGroupSettings(true);\n                        }}\n                      >\n                        <Settings className=\"w-4 h-4 mr-2\" />\n                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏\n                      </Button>\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        className=\"h-10\"\n                        onClick={() => {\n                          setSelectedGroupForMessage(group);\n                          setShowSendMessage(true);\n                        }}\n                      >\n                        <Send className=\"w-4 h-4 mr-2\" />\n                        –°–æ–æ–±—â–µ–Ω–∏–µ\n                      </Button>\n                    </div>\n                    \n                    {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */}\n                    <div className=\"grid grid-cols-3 gap-2\">\n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\" \n                        className=\"h-9 text-xs\"\n                        onClick={() => getGroupInfoMutation.mutate(group.groupId)}\n                        disabled={getGroupInfoMutation.isPending}\n                      >\n                        <BarChart3 className=\"w-3 h-3 mr-1\" />\n                        –ò–Ω—Ñ–æ\n                      </Button>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\" \n                        className=\"h-9 text-xs\"\n                        onClick={() => getMembersCountMutation.mutate(group.groupId)}\n                        disabled={getMembersCountMutation.isPending}\n                      >\n                        <Users className=\"w-3 h-3 mr-1\" />\n                        –£—á–∞—Å—Ç–Ω–∏–∫–∏\n                      </Button>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\" \n                        className=\"h-9 text-xs\"\n                        onClick={() => getAdminStatusMutation.mutate(group.groupId)}\n                        disabled={getAdminStatusMutation.isPending}\n                      >\n                        <Shield className=\"w-3 h-3 mr-1\" />\n                        –°—Ç–∞—Ç—É—Å\n                      </Button>\n                    </div>\n                    \n                    {/* –û–ø–∞—Å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ */}\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\" \n                      className=\"w-full h-8 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950 text-xs\"\n                      onClick={() => deleteGroupMutation.mutate(group.id)}\n                      disabled={deleteGroupMutation.isPending}\n                    >\n                      <X className=\"w-3 h-3 mr-1\" />\n                      –£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É\n                    </Button>\n                  </div>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã */}\n        <Dialog open={showAddGroup} onOpenChange={setShowAddGroup}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>–ü–æ–¥–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø—É</DialogTitle>\n              <DialogDescription>\n                –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ Telegram –≥—Ä—É–ø–ø—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–æ—Ç—É\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"group-id\">ID –≥—Ä—É–ø–ø—ã –∏–ª–∏ @username</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"group-id\"\n                    placeholder=\"-1002726444678 –∏–ª–∏ @groupname –∏–ª–∏ https://t.me/group\"\n                    value={groupId}\n                    onChange={(e) => setGroupId(e.target.value)}\n                    disabled={isParsingGroup}\n                  />\n                  {isParsingGroup && (\n                    <div className=\"absolute right-2 top-2\">\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\"></div>\n                    </div>\n                  )}\n                </div>\n                <p className=\"text-sm text-gray-500\">\n                  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–µ –∏ —Å—Å—ã–ª–∫–∞ –ø–æ–ª—É—á–∞—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\n                </p>\n              </div>\n            </div>\n            \n            <div className=\"flex gap-2 pt-4\">\n              <Button \n                variant=\"outline\" \n                onClick={() => setShowAddGroup(false)} \n                className=\"flex-1\"\n              >\n                –û—Ç–º–µ–Ω–∞\n              </Button>\n              <Button onClick={handleAddGroup} className=\"flex-1\">\n                –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø—É\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≥—Ä—É–ø–ø—ã */}\n        <Dialog open={showGroupSettings} onOpenChange={setShowGroupSettings}>\n          <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-hidden\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-3\">\n                <Settings className=\"h-5 w-5\" />\n                <div className=\"flex items-center gap-2\">\n                  <GroupAvatar \n                    avatarUrl={selectedGroup?.avatarUrl}\n                    groupName={selectedGroup?.name || '–ì—Ä—É–ø–ø–∞'}\n                    size={32}\n                  />\n                  <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã: {selectedGroup?.name}</span>\n                </div>\n              </DialogTitle>\n              <DialogDescription>\n                –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π –∏ –µ—ë —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏\n              </DialogDescription>\n            </DialogHeader>\n            \n            {selectedGroup && (\n              <Tabs defaultValue=\"general\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-4\">\n                  <TabsTrigger value=\"general\" className=\"flex items-center gap-2\">\n                    <Globe className=\"h-4 w-4\" />\n                    –û–±—â–∏–µ\n                  </TabsTrigger>\n                  <TabsTrigger value=\"admin\" className=\"flex items-center gap-2\">\n                    <Shield className=\"h-4 w-4\" />\n                    –ü—Ä–∞–≤–∞\n                  </TabsTrigger>\n                  <TabsTrigger value=\"members\" className=\"flex items-center gap-2\">\n                    <UserCheck className=\"h-4 w-4\" />\n                    –£—á–∞—Å—Ç–Ω–∏–∫–∏\n                  </TabsTrigger>\n                  <TabsTrigger value=\"analytics\" className=\"flex items-center gap-2\">\n                    <MessageSquare className=\"h-4 w-4\" />\n                    –ê–Ω–∞–ª–∏—Ç–∏–∫–∞\n                  </TabsTrigger>\n                </TabsList>\n\n                <div className=\"mt-4 max-h-[60vh] overflow-y-auto\">\n                  <TabsContent value=\"general\" className=\"space-y-4 mt-0\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"edit-group-name\">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</Label>\n                        <Input\n                          id=\"edit-group-name\"\n                          placeholder=\"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\"\n                          value={groupName}\n                          onChange={(e) => setGroupName(e.target.value)}\n                        />\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"edit-group-url\">–°—Å—ã–ª–∫–∞ –Ω–∞ –≥—Ä—É–ø–ø—É</Label>\n                        <Input\n                          id=\"edit-group-url\"\n                          placeholder=\"https://t.me/group\"\n                          value={groupUrl}\n                          onChange={(e) => setGroupUrl(e.target.value)}\n                        />\n                      </div>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"edit-group-chat-id\">\n                        Chat ID –≥—Ä—É–ø–ø—ã\n                        <span className=\"text-xs text-muted-foreground ml-2\">\n                          (–¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)\n                        </span>\n                      </Label>\n                      <Input\n                        id=\"edit-group-chat-id\"\n                        placeholder=\"-1001234567890\"\n                        value={selectedGroup?.groupId || ''}\n                        onChange={(e) => {\n                          if (selectedGroup) {\n                            setSelectedGroup({\n                              ...selectedGroup,\n                              groupId: e.target.value\n                            });\n                          }\n                        }}\n                      />\n                      <p className=\"text-xs text-muted-foreground\">\n                        –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è chat_id: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Å–ª–∞–π—Ç–µ –µ–≥–æ –≤ @userinfobot\n                      </p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"edit-group-desc\">–û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</Label>\n                      <Textarea\n                        id=\"edit-group-desc\"\n                        placeholder=\"–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã...\"\n                        value={groupDescription}\n                        onChange={(e) => setGroupDescription(e.target.value)}\n                        rows={3}\n                      />\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"chat-type\">–¢–∏–ø —á–∞—Ç–∞</Label>\n                        <Input\n                          id=\"chat-type\"\n                          value={selectedGroup?.chatType === 'group' ? '–ì—Ä—É–ø–ø–∞' : selectedGroup?.chatType === 'supergroup' ? '–°—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞' : selectedGroup?.chatType === 'channel' ? '–ö–∞–Ω–∞–ª' : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}\n                          readOnly\n                          className=\"bg-muted cursor-not-allowed\"\n                        />\n                        <p className=\"text-xs text-muted-foreground\">\n                          –¢–∏–ø —á–∞—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è Telegram –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω\n                        </p>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"group-avatar\">–ê–≤–∞—Ç–∞—Ä–∫–∞ –≥—Ä—É–ø–ø—ã</Label>\n                        <div className=\"flex gap-2\">\n                          <Input\n                            id=\"group-avatar\"\n                            placeholder=\"https://example.com/avatar.jpg\"\n                            value={groupAvatarUrl}\n                            onChange={(e) => setGroupAvatarUrl(e.target.value)}\n                          />\n                          <input\n                            type=\"file\"\n                            accept=\"image/*\"\n                            className=\"hidden\"\n                            id=\"avatar-upload\"\n                            onChange={async (e) => {\n                              const file = e.target.files?.[0];\n                              if (file) {\n                                try {\n                                  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä\n                                  const formData = new FormData();\n                                  formData.append('file', file);\n                                  \n                                  const response = await fetch(`/api/media/upload/${projectId}`, {\n                                    method: 'POST',\n                                    body: formData\n                                  });\n                                  \n                                  if (response.ok) {\n                                    const result = await response.json();\n                                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Ç—å –∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É\n                                    const serverUrl = result.url || `/uploads/${result.filename}`;\n                                    setGroupAvatarUrl(serverUrl);\n                                    toast({\n                                      title: \"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ\",\n                                      description: \"–ê–≤–∞—Ç–∞—Ä–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ\"\n                                    });\n                                  } else {\n                                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');\n                                  }\n                                } catch (error) {\n                                  console.error('Upload error:', error);\n                                  toast({\n                                    title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏\",\n                                    description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ\",\n                                    variant: \"destructive\"\n                                  });\n                                }\n                              }\n                            }}\n                          />\n                          <Button \n                            variant=\"outline\" \n                            size=\"icon\"\n                            onClick={() => {\n                              document.getElementById('avatar-upload')?.click();\n                            }}\n                          >\n                            <Upload className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                        {groupAvatarUrl && (\n                          <div className=\"mt-2\">\n                            <div className=\"w-16 h-16 border rounded-lg overflow-hidden\">\n                              <img \n                                src={groupAvatarUrl} \n                                alt=\"–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∫–∏\" \n                                className=\"w-full h-full object-cover\"\n                                onError={() => {\n                                  toast({\n                                    title: \"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\",\n                                    description: \"–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL\",\n                                    variant: \"destructive\"\n                                  });\n                                }}\n                              />\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Switch \n                          id=\"public-group\"\n                          checked={isPublicGroup}\n                          onCheckedChange={(checked) => {\n                            setIsPublicGroup(checked);\n                            // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—É—é, –æ—á–∏—â–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π username\n                            if (!checked) {\n                              setPublicUsername('');\n                            }\n                          }}\n                        />\n                        <Label htmlFor=\"public-group\">\n                          –ü—É–±–ª–∏—á–Ω–∞—è –≥—Ä—É–ø–ø–∞\n                        </Label>\n                      </div>\n                      \n                      {isPublicGroup && (\n                        <div className=\"space-y-2 pl-6 border-l-2 border-primary/20\">\n                          <Label htmlFor=\"public-username\" className=\"text-sm font-medium\">\n                            –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞\n                            <span className=\"text-xs text-muted-foreground ml-2\">\n                              (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –≥—Ä—É–ø–ø)\n                            </span>\n                          </Label>\n                          <div className=\"space-y-2\">\n                            <Input\n                              id=\"public-username\"\n                              placeholder=\"@username –∏–ª–∏ t.me/username\"\n                              value={publicUsername}\n                              onChange={(e) => setPublicUsername(e.target.value)}\n                              className=\"text-sm\"\n                            />\n                            <p className=\"text-xs text-muted-foreground\">\n                              –í–≤–µ–¥–∏—Ç–µ @username –≥—Ä—É–ø–ø—ã –∏–ª–∏ –ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É t.me/username. \n                              –≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –ø—Ä–∏–≤–∞—Ç–Ω—É—é —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –ø—É–±–ª–∏—á–Ω—É—é.\n                            </p>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"group-notes\">–ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</Label>\n                      <Textarea\n                        id=\"group-notes\"\n                        placeholder=\"–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –æ –≥—Ä—É–ø–ø–µ...\"\n                        value={groupNotes}\n                        onChange={(e) => setGroupNotes(e.target.value)}\n                        rows={2}\n                      />\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"admin\" className=\"space-y-4 mt-0\">\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <h4 className=\"font-medium\">–°—Ç–∞—Ç—É—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h4>\n                          <p className=\"text-sm text-muted-foreground\">\n                            –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –±–æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≥—Ä—É–ø–ø—ã\n                          </p>\n                        </div>\n                        <Switch \n                          checked={makeAdmin}\n                          onCheckedChange={setMakeAdmin}\n                        />\n                      </div>\n                      \n                      {makeAdmin && (\n                        <div className=\"space-y-3\">\n                          <h5 className=\"font-medium text-sm\">–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h5>\n                          <div className=\"grid grid-cols-2 gap-3\">\n                            {Object.entries(adminRights).map(([key, value]) => (\n                              <div key={key} className=\"flex items-center space-x-2\">\n                                <Switch\n                                  checked={value}\n                                  onCheckedChange={(checked) => \n                                    setAdminRights(prev => ({ ...prev, [key]: checked }))\n                                  }\n                                />\n                                <Label className=\"text-xs\">\n                                  {key === 'can_manage_chat' && '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–º'}\n                                  {key === 'can_change_info' && '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏'}\n                                  {key === 'can_delete_messages' && '–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π'}\n                                  {key === 'can_invite_users' && '–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'}\n                                  {key === 'can_restrict_members' && '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'}\n                                  {key === 'can_pin_messages' && '–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π'}\n                                  {key === 'can_promote_members' && '–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤'}\n                                  {key === 'can_manage_video_chats' && '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ—á–∞—Ç–∞–º–∏'}\n                                  {key === 'can_be_anonymous' && '–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞'}\n                                  {key === 'can_manage_stories' && '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—è–º–∏'}\n                                </Label>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"members\" className=\"space-y-4 mt-0\">\n                    <div className=\"space-y-4\">\n                      \n                      {/* –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ */}\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <h5 className=\"font-medium text-sm\">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã</h5>\n                          <div className=\"flex items-center gap-2\">\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              onClick={() => {\n                                setShowUserSearch(true);\n                              }}\n                            >\n                              <Search className=\"h-4 w-4 mr-2\" />\n                              –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n                            </Button>\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              onClick={() => {\n                                setSelectedGroupForPromotion(selectedGroup);\n                                setShowAdminSearch(true);\n                              }}\n                            >\n                              <Crown className=\"h-4 w-4 mr-2\" />\n                              –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º\n                            </Button>\n                            {isLoadingMembers && (\n                              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                                <div className=\"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full\" />\n                                –ó–∞–≥—Ä—É–∑–∫–∞...\n                              </div>\n                            )}\n                            <Badge variant=\"outline\">\n                              {(() => {\n                                const totalSavedMembers = savedMembers.length;\n                                const totalApiMembers = clientApiMembers.length || administrators.length;\n                                const totalMembers = totalSavedMembers + totalApiMembers;\n                                \n                                if (totalMembers > 0) {\n                                  if (totalSavedMembers > 0 && totalApiMembers > 0) {\n                                    return `${totalMembers} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (${totalSavedMembers} —Å–æ—Ö—Ä. + ${totalApiMembers} API)`;\n                                  } else if (totalSavedMembers > 0) {\n                                    return `${totalSavedMembers} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;\n                                  } else {\n                                    return `${totalApiMembers} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;\n                                  }\n                                } else if (selectedGroup.memberCount) {\n                                  return `${selectedGroup.memberCount} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;\n                                } else {\n                                  return '–ó–∞–≥—Ä—É–∑–∫–∞...';\n                                }\n                              })()}\n                            </Badge>\n                            {clientApiMembers.length === 0 && savedMembers.length === 0 && (\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                onClick={() => setShowTelegramAuth(true)}\n                              >\n                                <Shield className=\"h-4 w-4 mr-2\" />\n                                –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n                              </Button>\n                            )}\n                            {savedMembers.length > 0 && clientApiMembers.length === 0 && (\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                onClick={() => setShowTelegramAuth(true)}\n                              >\n                                <Shield className=\"h-4 w-4 mr-2\" />\n                                –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n                              </Button>\n                            )}\n                          </div>\n                        </div>\n                        \n                        {(() => {\n                          // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫: —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏, –∑–∞—Ç–µ–º API —É—á–∞—Å—Ç–Ω–∏–∫–∏\n                          const allMembers = [];\n                          \n                          // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n                          if (savedMembers.length > 0) {\n                            allMembers.push(...savedMembers.map(member => ({ ...member, sourceType: 'database' })));\n                          }\n                          \n                          // –î–æ–±–∞–≤–ª—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ Client API (–µ—Å–ª–∏ –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)\n                          if (clientApiMembers.length > 0) {\n                            const uniqueApiMembers = clientApiMembers.filter(apiMember => {\n                              const apiUserId = apiMember.id?.toString() || apiMember.user?.id?.toString() || apiMember.userId?.toString();\n                              return !savedMembers.some(savedMember => \n                                savedMember.user?.id?.toString() === apiUserId\n                              );\n                            });\n                            allMembers.push(...uniqueApiMembers.map(member => ({ ...member, sourceType: 'api' })));\n                          }\n                          \n                          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–µ—Å–ª–∏ –Ω–µ—Ç Client API –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)\n                          if (clientApiMembers.length === 0 && administrators.length > 0) {\n                            const uniqueAdmins = administrators.filter(admin => {\n                              const adminUserId = admin.id?.toString() || admin.user?.id?.toString() || admin.userId?.toString();\n                              return !savedMembers.some(savedMember => \n                                savedMember.user?.id?.toString() === adminUserId\n                              );\n                            });\n                            allMembers.push(...uniqueAdmins.map(admin => ({ ...admin, sourceType: 'admin_api' })));\n                          }\n                          \n                          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –µ—Å–ª–∏ –µ—Å—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∏\n                          if (allMembers.length > 0) {\n                            return (\n                              <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                                {allMembers.map((member, index) => (\n                                  <div key={`${member.sourceType}-${index}`} className={`flex items-center justify-between p-3 border rounded-lg ${\n                                    member.sourceType === 'database' ? 'border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950' :\n                                    member.foundViaSearch ? 'border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-950' : ''\n                                  }`}>\n                                    <div className=\"flex items-center space-x-3\">\n                                      <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                                        member.status === 'creator' ? 'bg-yellow-100 dark:bg-yellow-900' :\n                                        member.status === 'administrator' ? 'bg-blue-100 dark:bg-blue-900' :\n                                        member.isBot ? 'bg-gray-100 dark:bg-gray-900' :\n                                        'bg-green-100 dark:bg-green-900'\n                                      }`}>\n                                        {member.status === 'creator' ? (\n                                          <Crown className={`h-4 w-4 text-yellow-600 dark:text-yellow-400`} />\n                                        ) : member.status === 'administrator' ? (\n                                          <Shield className={`h-4 w-4 text-blue-600 dark:text-blue-400`} />\n                                        ) : member.isBot ? (\n                                          <Bot className={`h-4 w-4 text-gray-600 dark:text-gray-400`} />\n                                        ) : (\n                                          <Users className={`h-4 w-4 text-green-600 dark:text-green-400`} />\n                                        )}\n                                      </div>\n                                      <div>\n                                        <div className=\"flex items-center gap-2\">\n                                          <p className=\"font-medium text-sm\">\n                                            {member?.firstName || member?.user?.first_name || member?.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} {member?.lastName || member?.user?.last_name || member?.last_name || ''}\n                                          </p>\n                                          {member?.isBot && <Badge variant=\"outline\" className=\"text-xs\">–ë–æ—Ç</Badge>}\n                                          {member.sourceType === 'database' && <Badge variant=\"outline\" className=\"text-xs bg-green-50 text-green-600 border-green-200\">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω</Badge>}\n                                        </div>\n                                        <p className=\"text-xs text-muted-foreground\">\n                                          @{member?.username || member?.user?.username || '–ë–µ–∑ username'} ‚Ä¢ ID: {member?.id || member?.user?.id || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}\n                                        </p>\n                                      </div>\n                                    </div>\n                                    <div className=\"flex items-center gap-2\">\n                                      <Badge variant={\n                                        member.status === 'creator' ? 'default' : \n                                        member.status === 'administrator' ? 'secondary' : \n                                        'outline'\n                                      }>\n                                        {member.status === 'creator' ? '–°–æ–∑–¥–∞—Ç–µ–ª—å' : \n                                         member.status === 'administrator' ? '–ê–¥–º–∏–Ω' : \n                                         member.isBot ? '–ë–æ—Ç' :\n                                         '–£—á–∞—Å—Ç–Ω–∏–∫'}\n                                      </Badge>\n                                      \n                                      {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–ª—è –≤—Å–µ—Ö –∫—Ä–æ–º–µ —Å–æ–∑–¥–∞—Ç–µ–ª—è */}\n                                      {member.status !== 'creator' && (\n                                        <DropdownMenu>\n                                          <DropdownMenuTrigger asChild>\n                                            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                                              <MoreHorizontal className=\"h-4 w-4\" />\n                                            </Button>\n                                          </DropdownMenuTrigger>\n                                          <DropdownMenuContent align=\"end\">\n                                            {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */}\n                                            <>\n                                              <DropdownMenuItem \n                                                onClick={() => {\n                                                  setSelectedMember(member);\n                                                  const userId = member.id?.toString() || member.user?.id?.toString() || member.userId?.toString();\n                                                  if (userId && selectedGroup?.groupId) {\n                                                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞\n                                                    loadMemberPermissionsMutation.mutate({ \n                                                      groupId: selectedGroup.groupId, \n                                                      userId \n                                                    });\n                                                  } else {\n                                                    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n                                                    setMemberPermissions({\n                                                      // –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞\n                                                      can_send_messages: true,\n                                                      can_send_media_messages: true,\n                                                      can_send_polls: true,\n                                                      can_send_other_messages: true,\n                                                      can_add_web_page_previews: true,\n                                                      \n                                                      // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è\n                                                      can_change_info: false,\n                                                      can_delete_messages: false,\n                                                      can_restrict_members: false,\n                                                      can_invite_users: false,\n                                                      can_pin_messages: false,\n                                                      can_manage_video_chats: false,\n                                                      can_be_anonymous: false,\n                                                      can_promote_members: false\n                                                    });\n                                                  }\n                                                  setShowPermissionsDialog(true);\n                                                }}\n                                              >\n                                                <Settings className=\"h-4 w-4 mr-2\" />\n                                                –†–∞–∑—Ä–µ—à–µ–Ω–∏—è\n                                              </DropdownMenuItem>\n                                              <DropdownMenuItem \n                                                onClick={() => {\n                                                  const userId = member.id?.toString() || member.user?.id?.toString() || member.userId?.toString();\n                                                  if (!userId) {\n                                                    toast({\n                                                      title: '–û—à–∏–±–∫–∞',\n                                                      description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n                                                      variant: 'destructive'\n                                                    });\n                                                    return;\n                                                  }\n                                                  // –ù–∞–∑–Ω–∞—á–∞–µ–º —Å –±–∞–∑–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n                                                  promoteMemberMutation.mutate({ \n                                                    groupId: selectedGroup.groupId, \n                                                    userId,\n                                                    adminRights: {\n                                                      can_change_info: false,\n                                                      can_delete_messages: true,\n                                                      can_invite_users: true,\n                                                      can_restrict_members: true,\n                                                      can_pin_messages: true,\n                                                      can_promote_members: false,\n                                                      can_manage_video_chats: false,\n                                                      can_be_anonymous: false,\n                                                      can_manage_topics: false\n                                                    }\n                                                  });\n                                                }}\n                                              >\n                                                <Crown className=\"h-4 w-4 mr-2\" />\n                                                –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\n                                              </DropdownMenuItem>\n                                              <DropdownMenuSeparator />\n                                            </>\n                                            \n                                            {/* –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è - –¥–ª—è –≤—Å–µ—Ö –∫—Ä–æ–º–µ —Å–æ–∑–¥–∞—Ç–µ–ª—è */}\n                                            <DropdownMenuItem \n                                              onClick={() => {\n                                                const userId = member.id?.toString() || member.user?.id?.toString() || member.userId?.toString();\n                                                if (!userId) {\n                                                  toast({\n                                                    title: '–û—à–∏–±–∫–∞',\n                                                    description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n                                                    variant: 'destructive'\n                                                  });\n                                                  return;\n                                                }\n                                                muteMemberMutation.mutate({ \n                                                  groupId: selectedGroup.groupId, \n                                                  userId \n                                                });\n                                              }}\n                                            >\n                                              <VolumeX className=\"h-4 w-4 mr-2\" />\n                                              {member.isBot ? '–û—Ç–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞' : '–ó–∞–º—É—Ç–∏—Ç—å'}\n                                            </DropdownMenuItem>\n                                            <DropdownMenuItem \n                                              onClick={() => {\n                                                const userId = member.id?.toString() || member.user?.id?.toString() || member.userId?.toString();\n                                                if (!userId) {\n                                                  toast({\n                                                    title: '–û—à–∏–±–∫–∞',\n                                                    description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n                                                    variant: 'destructive'\n                                                  });\n                                                  return;\n                                                }\n                                                kickMemberMutation.mutate({ \n                                                  groupId: selectedGroup.groupId, \n                                                  userId \n                                                });\n                                              }}\n                                            >\n                                              <UserMinus className=\"h-4 w-4 mr-2\" />\n                                              {member.isBot ? '–£–¥–∞–ª–∏—Ç—å –±–æ—Ç–∞' : '–ò—Å–∫–ª—é—á–∏—Ç—å'}\n                                            </DropdownMenuItem>\n                                            <DropdownMenuItem \n                                              onClick={() => banMemberMutation.mutate({ \n                                                groupId: selectedGroup.groupId, \n                                                userId: member.id?.toString() || member.user?.id?.toString() \n                                              })}\n                                              className=\"text-destructive\"\n                                            >\n                                              <Ban className=\"h-4 w-4 mr-2\" />\n                                              {member.isBot ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}\n                                            </DropdownMenuItem>\n                                            <DropdownMenuItem \n                                              onClick={() => {\n                                                const userId = member.id?.toString() || member.user?.id?.toString() || member.userId?.toString();\n                                                if (!userId) {\n                                                  toast({\n                                                    title: '–û—à–∏–±–∫–∞',\n                                                    description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n                                                    variant: 'destructive'\n                                                  });\n                                                  return;\n                                                }\n                                                unbanMemberMutation.mutate({ \n                                                  groupId: selectedGroup.groupId, \n                                                  userId \n                                                });\n                                              }}\n                                            >\n                                              <UserPlus className=\"h-4 w-4 mr-2\" />\n                                              {member.isBot ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞' : '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}\n                                            </DropdownMenuItem>\n                                          </DropdownMenuContent>\n                                        </DropdownMenu>\n                                      )}\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                            );\n                          }\n                          \n                          // –ï—Å–ª–∏ –Ω–µ—Ç Client API –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ—Ç Bot API\n                          if (administrators.length > 0) {\n                            return (\n                              <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                                {administrators.map((admin, index) => (\n                                  <div key={`bot-${index}`} className={`flex items-center justify-between p-3 border rounded-lg ${admin.foundViaSearch ? 'border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-950' : ''}`}>\n                                    <div className=\"flex items-center space-x-3\">\n                                      <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                                        admin.foundViaSearch ? 'bg-purple-100 dark:bg-purple-900' :\n                                        admin.status === 'creator' ? 'bg-yellow-100 dark:bg-yellow-900' :\n                                        'bg-blue-100 dark:bg-blue-900'\n                                      }`}>\n                                        {admin.foundViaSearch ? (\n                                          <Search className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n                                        ) : admin.status === 'creator' ? (\n                                          <Crown className=\"h-4 w-4 text-yellow-600 dark:text-yellow-400\" />\n                                        ) : (\n                                          <Shield className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                                        )}\n                                      </div>\n                                      <div>\n                                        <div className=\"flex items-center gap-2\">\n                                          <p className=\"font-medium text-sm\">\n                                            {admin?.user?.first_name || admin?.first_name || admin?.firstName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} {admin?.user?.last_name || admin?.last_name || admin?.lastName || ''}\n                                          </p>\n                                          {admin.foundViaSearch && <Badge variant=\"outline\" className=\"text-xs text-purple-600 dark:text-purple-400\">–ù–∞–π–¥–µ–Ω –ø–æ–∏—Å–∫–æ–º</Badge>}\n                                        </div>\n                                        <p className=\"text-xs text-muted-foreground\">\n                                          @{admin?.user?.username || admin?.username || '–ë–µ–∑ username'} ‚Ä¢ ID: {admin?.user?.id || admin?.id || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}\n                                        </p>\n                                      </div>\n                                    </div>\n                                    <div className=\"flex items-center gap-2\">\n                                      <Badge variant={\n                                        admin.status === 'creator' ? 'default' : \n                                        admin.foundViaSearch ? 'outline' : \n                                        'secondary'\n                                      }>\n                                        {admin.status === 'creator' ? '–°–æ–∑–¥–∞—Ç–µ–ª—å' : \n                                         admin.foundViaSearch ? admin.friendlyStatus || '–£—á–∞—Å—Ç–Ω–∏–∫' : \n                                         '–ê–¥–º–∏–Ω'}\n                                      </Badge>\n                                      \n                                      {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–ª—è –≤—Å–µ—Ö –∫—Ä–æ–º–µ —Å–æ–∑–¥–∞—Ç–µ–ª—è */}\n                                      {admin.status !== 'creator' && (\n                                        <DropdownMenu>\n                                          <DropdownMenuTrigger asChild>\n                                            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                                              <MoreHorizontal className=\"h-4 w-4\" />\n                                            </Button>\n                                          </DropdownMenuTrigger>\n                                          <DropdownMenuContent align=\"end\">\n                                            {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */}\n                                            <>\n                                              <DropdownMenuItem \n                                                onClick={() => {\n                                                  setSelectedMember(admin);\n                                                  const userId = admin?.user?.id?.toString() || admin?.id?.toString();\n                                                  if (userId && selectedGroup?.groupId) {\n                                                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —á–µ—Ä–µ–∑ API\n                                                    console.log('üîç –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ API –¥–ª—è:', { userId, groupId: selectedGroup.groupId });\n                                                    loadMemberPermissionsMutation.mutate({ \n                                                      groupId: selectedGroup.groupId, \n                                                      userId \n                                                    });\n                                                  } else {\n                                                    // Fallback - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n                                                    setMemberPermissions({\n                                                      can_send_messages: true,\n                                                      can_send_media_messages: true,\n                                                      can_send_polls: true,\n                                                      can_send_other_messages: true,\n                                                      can_add_web_page_previews: true,\n                                                      can_change_info: false,\n                                                      can_delete_messages: false,\n                                                      can_restrict_members: false,\n                                                      can_invite_users: false,\n                                                      can_pin_messages: false,\n                                                      can_manage_video_chats: false,\n                                                      can_be_anonymous: false,\n                                                      can_promote_members: false\n                                                    });\n                                                  }\n                                                  setShowPermissionsDialog(true);\n                                                }}\n                                              >\n                                                <Settings className=\"h-4 w-4 mr-2\" />\n                                                –†–∞–∑—Ä–µ—à–µ–Ω–∏—è\n                                              </DropdownMenuItem>\n                                              \n                                              {/* –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */}\n                                              {admin.foundViaSearch && admin.status !== 'administrator' && (\n                                                <DropdownMenuItem \n                                                  onClick={() => {\n                                                    const userId = admin?.user?.id?.toString() || admin?.id?.toString();\n                                                    if (!userId) {\n                                                      toast({\n                                                        title: '–û—à–∏–±–∫–∞',\n                                                        description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n                                                        variant: 'destructive'\n                                                      });\n                                                      return;\n                                                    }\n                                                    // –ù–∞–∑–Ω–∞—á–∞–µ–º —Å –±–∞–∑–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n                                                    promoteMemberMutation.mutate({ \n                                                      groupId: selectedGroup.groupId, \n                                                      userId,\n                                                      adminRights: {\n                                                        can_change_info: false,\n                                                        can_delete_messages: true,\n                                                        can_invite_users: true,\n                                                        can_restrict_members: true,\n                                                        can_pin_messages: true,\n                                                        can_promote_members: false,\n                                                        can_manage_video_chats: false,\n                                                        can_be_anonymous: false,\n                                                        can_manage_topics: false\n                                                      }\n                                                    });\n                                                  }}\n                                                >\n                                                  <Crown className=\"h-4 w-4 mr-2\" />\n                                                  –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\n                                                </DropdownMenuItem>\n                                              )}\n                                              <DropdownMenuSeparator />\n                                            </>\n                                            \n                                            {/* –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è - –¥–ª—è –≤—Å–µ—Ö –∫—Ä–æ–º–µ —Å–æ–∑–¥–∞—Ç–µ–ª—è */}\n                                            <DropdownMenuItem \n                                              onClick={() => {\n                                                const userId = admin?.user?.id?.toString() || admin?.id?.toString();\n                                                if (!userId) {\n                                                  toast({\n                                                    title: '–û—à–∏–±–∫–∞',\n                                                    description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n                                                    variant: 'destructive'\n                                                  });\n                                                  return;\n                                                }\n                                                demoteMemberMutation.mutate({ \n                                                  groupId: selectedGroup.groupId, \n                                                  userId \n                                                });\n                                              }}\n                                              className=\"text-orange-600\"\n                                            >\n                                              <Crown className=\"h-4 w-4 mr-2\" />\n                                              –°–Ω—è—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n                                            </DropdownMenuItem>\n                                            <DropdownMenuSeparator />\n                                            <DropdownMenuItem \n                                              onClick={() => muteMemberMutation.mutate({ \n                                                groupId: selectedGroup.groupId, \n                                                userId: admin?.user?.id?.toString() || admin?.id?.toString() \n                                              })}\n                                            >\n                                              <VolumeX className=\"h-4 w-4 mr-2\" />\n                                              {admin.user?.is_bot || admin.is_bot ? '–û—Ç–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞' : '–ó–∞–º—É—Ç–∏—Ç—å'}\n                                            </DropdownMenuItem>\n                                            <DropdownMenuItem \n                                              onClick={() => kickMemberMutation.mutate({ \n                                                groupId: selectedGroup.groupId, \n                                                userId: admin?.user?.id?.toString() || admin?.id?.toString() \n                                              })}\n                                            >\n                                              <UserMinus className=\"h-4 w-4 mr-2\" />\n                                              {admin.user?.is_bot || admin.is_bot ? '–£–¥–∞–ª–∏—Ç—å –±–æ—Ç–∞' : '–ò—Å–∫–ª—é—á–∏—Ç—å'}\n                                            </DropdownMenuItem>\n                                            <DropdownMenuItem \n                                              onClick={() => banMemberMutation.mutate({ \n                                                groupId: selectedGroup.groupId, \n                                                userId: admin?.user?.id?.toString() || admin?.id?.toString() \n                                              })}\n                                              className=\"text-destructive\"\n                                            >\n                                              <Ban className=\"h-4 w-4 mr-2\" />\n                                              {admin.user?.is_bot || admin.is_bot ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}\n                                            </DropdownMenuItem>\n                                            <DropdownMenuItem \n                                              onClick={() => {\n                                                const userId = admin?.user?.id?.toString() || admin?.id?.toString();\n                                                if (!userId) {\n                                                  toast({\n                                                    title: '–û—à–∏–±–∫–∞',\n                                                    description: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n                                                    variant: 'destructive'\n                                                  });\n                                                  return;\n                                                }\n                                                unbanMemberMutation.mutate({ \n                                                  groupId: selectedGroup.groupId, \n                                                  userId \n                                                });\n                                              }}\n                                            >\n                                              <UserPlus className=\"h-4 w-4 mr-2\" />\n                                              {admin.user?.is_bot || admin.is_bot ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞' : '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}\n                                            </DropdownMenuItem>\n                                          </DropdownMenuContent>\n                                        </DropdownMenu>\n                                      )}\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                            );\n                          }\n                          \n                          // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ª—É—á—à–µ–Ω–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É\n                          return (\n                            <div className=\"space-y-3 py-4\">\n                              <div className=\"text-center\">\n                                <p className=\"text-sm text-muted-foreground\">\n                                  üìù –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã\n                                </p>\n                                <p className=\"text-xs text-muted-foreground mt-1\">\n                                  –û–±—ã—á–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–∫—Ä—ã—Ç—ã –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Telegram Bot API\n                                </p>\n                                <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\n                                  üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∫–Ω–æ–ø–∫–æ–π –Ω–∏–∂–µ\n                                </p>\n                              </div>\n                              \n                              <div className=\"space-y-2\">\n                                <div className=\"flex gap-2\">\n                                  <Input\n                                    placeholder=\"@username –∏–ª–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"\n                                    value={userToFind}\n                                    onChange={(e) => setUserToFind(e.target.value)}\n                                    onKeyDown={(e) => {\n                                      if (e.key === 'Enter' && userToFind.trim() && selectedGroup?.groupId) {\n                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –∏–∑ —Å—Ç—Ä–æ–∫–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å @username –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ ID)\n                                        let userId = userToFind.trim().replace('@', '');\n                                        checkMemberMutation.mutate({\n                                          groupId: selectedGroup.groupId,\n                                          userId: userId\n                                        });\n                                      }\n                                    }}\n                                    className=\"flex-1\"\n                                  />\n                                  <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={() => {\n                                      if (userToFind.trim() && selectedGroup?.groupId) {\n                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –∏–∑ —Å—Ç—Ä–æ–∫–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å @username –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ ID)\n                                        let userId = userToFind.trim().replace('@', '');\n                                        checkMemberMutation.mutate({\n                                          groupId: selectedGroup.groupId,\n                                          userId: userId\n                                        });\n                                      }\n                                    }}\n                                    disabled={checkMemberMutation.isPending || !userToFind.trim()}\n                                  >\n                                    {checkMemberMutation.isPending ? '‚è≥' : 'üîç'}\n                                  </Button>\n                                </div>\n                                \n                                <p className=\"text-xs text-muted-foreground text-center\">\n                                  –í–≤–µ–¥–∏—Ç–µ @username –∏–ª–∏ ID –¥–ª—è –ø–æ–∏—Å–∫–∞ ‚Ä¢ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–Ω–æ–ø–∫–æ–π –≤—ã—à–µ\n                                </p>\n                              </div>\n                            </div>\n                          );\n                        })()}\n                      </div>\n\n\n\n\n                      <div className=\"border-t my-4\" />\n\n                      {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ */}\n                      <div className=\"space-y-3\">\n                        <h5 className=\"font-medium text-sm\">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏</h5>\n                        \n                        {/* –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è */}\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"pin-message\" className=\"text-xs\">–ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (ID)</Label>\n                          <div className=\"flex gap-2\">\n                            <Input\n                              id=\"pin-message\"\n                              value={messageIdToPin}\n                              onChange={(e) => setMessageIdToPin(e.target.value)}\n                              placeholder=\"ID —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è...\"\n                              className=\"flex-1\"\n                            />\n                            <Button \n                              onClick={() => pinMessageMutation.mutate({ \n                                groupId: selectedGroup.groupId, \n                                messageId: messageIdToPin \n                              })}\n                              disabled={!messageIdToPin.trim() || pinMessageMutation.isPending}\n                              size=\"sm\"\n                            >\n                              {pinMessageMutation.isPending ? (\n                                <div className=\"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full\" />\n                              ) : (\n                                <Pin className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                          </div>\n                        </div>\n\n                        {/* –û—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è */}\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"unpin-message\" className=\"text-xs\">–û—Ç–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (ID)</Label>\n                          <div className=\"flex gap-2\">\n                            <Input\n                              id=\"unpin-message\"\n                              value={messageIdToUnpin}\n                              onChange={(e) => setMessageIdToUnpin(e.target.value)}\n                              placeholder=\"ID —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö...\"\n                              className=\"flex-1\"\n                            />\n                            <Button \n                              onClick={() => unpinMessageMutation.mutate({ \n                                groupId: selectedGroup.groupId, \n                                messageId: messageIdToUnpin || undefined \n                              })}\n                              disabled={unpinMessageMutation.isPending}\n                              size=\"sm\"\n                            >\n                              {unpinMessageMutation.isPending ? (\n                                <div className=\"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full\" />\n                              ) : (\n                                <PinOff className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                          </div>\n                        </div>\n\n                        {/* –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è */}\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"delete-message\" className=\"text-xs\">–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (ID)</Label>\n                          <div className=\"flex gap-2\">\n                            <Input\n                              id=\"delete-message\"\n                              value={messageIdToDelete}\n                              onChange={(e) => setMessageIdToDelete(e.target.value)}\n                              placeholder=\"ID —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è...\"\n                              className=\"flex-1\"\n                            />\n                            <Button \n                              onClick={() => deleteMessageMutation.mutate({ \n                                groupId: selectedGroup.groupId, \n                                messageId: messageIdToDelete \n                              })}\n                              disabled={!messageIdToDelete.trim() || deleteMessageMutation.isPending}\n                              size=\"sm\"\n                              variant=\"destructive\"\n                            >\n                              {deleteMessageMutation.isPending ? (\n                                <div className=\"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full\" />\n                              ) : (\n                                <Trash className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div className=\"border-t my-4\" />\n\n                      {/* –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π */}\n                      <div className=\"space-y-3\">\n                        <h5 className=\"font-medium text-sm\">–°—Å—ã–ª–∫–∏-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h5>\n                        \n                        <div className=\"space-y-2\">\n                          <Label className=\"text-xs\">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</Label>\n                          <div className=\"grid grid-cols-2 gap-2\">\n                            <Input\n                              placeholder=\"–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\"\n                              value={inviteLinkName}\n                              onChange={(e) => setInviteLinkName(e.target.value)}\n                            />\n                            <Input\n                              type=\"number\"\n                              placeholder=\"–õ–∏–º–∏—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\"\n                              value={inviteLinkLimit}\n                              onChange={(e) => setInviteLinkLimit(e.target.value)}\n                            />\n                          </div>\n                          \n                          <Button \n                            onClick={() => createInviteLinkMutation.mutate({ \n                              groupId: selectedGroup.groupId,\n                              name: inviteLinkName || undefined,\n                              memberLimit: inviteLinkLimit ? parseInt(inviteLinkLimit) : undefined,\n                              createsJoinRequest: false\n                            })}\n                            disabled={createInviteLinkMutation.isPending}\n                            size=\"sm\"\n                            className=\"w-full\"\n                          >\n                            {createInviteLinkMutation.isPending ? (\n                              <div className=\"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full mr-2\" />\n                            ) : (\n                              <UserPlus className=\"h-4 w-4 mr-2\" />\n                            )}\n                            –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ\n                          </Button>\n                        </div>\n                      </div>\n\n\n                      <div className=\"mt-4 p-3 bg-muted/50 rounded-lg\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          üí° <strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å User ID:</strong> –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–ø–∏—Å–∞—Ç—å /start –±–æ—Ç—É @userinfobot –∏–ª–∏ –Ω–∞–π—Ç–∏ ID –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Telegram.\n                        </p>\n                      </div>\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"analytics\" className=\"space-y-4 mt-0\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <Card className=\"p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <MessageSquare className=\"h-5 w-5 text-blue-500\" />\n                          <div>\n                            <p className=\"text-sm font-medium\">–°–æ–æ–±—â–µ–Ω–∏–π</p>\n                            <p className=\"text-2xl font-bold\">{selectedGroup.messagesCount || 0}</p>\n                          </div>\n                        </div>\n                      </Card>\n                      \n                      <Card className=\"p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <Users className=\"h-5 w-5 text-green-500\" />\n                          <div>\n                            <p className=\"text-sm font-medium\">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</p>\n                            <p className=\"text-2xl font-bold\">{selectedGroup.activeUsers || 0}</p>\n                          </div>\n                        </div>\n                      </Card>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</Label>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {selectedGroup.lastActivity \n                          ? new Date(selectedGroup.lastActivity).toLocaleString('ru-RU')\n                          : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'\n                        }\n                      </p>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>–¢–µ–≥–∏ –≥—Ä—É–ø–ø—ã</Label>\n                      <div className=\"flex flex-wrap gap-2\">\n                        {groupTags.map((tag, index) => (\n                          <Badge key={index} variant=\"outline\" className=\"flex items-center gap-1\">\n                            <Tag className=\"h-3 w-3\" />\n                            {tag}\n                            <Button \n                              variant=\"ghost\" \n                              size=\"sm\" \n                              className=\"h-4 w-4 p-0 ml-1\"\n                              onClick={() => setGroupTags(prev => prev.filter((_, i) => i !== index))}\n                            >\n                              <X className=\"h-3 w-3\" />\n                            </Button>\n                          </Badge>\n                        ))}\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            const newTag = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–µ–≥:');\n                            if (newTag) setGroupTags(prev => [...prev, newTag]);\n                          }}\n                        >\n                          <Plus className=\"h-3 w-3 mr-1\" />\n                          –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥\n                        </Button>\n                      </div>\n                    </div>\n                  </TabsContent>\n                </div>\n              </Tabs>\n            )}\n            \n            <div className=\"flex gap-2 pt-4\">\n              <Button \n                variant=\"outline\" \n                onClick={() => {\n                  setShowGroupSettings(false);\n                  setSelectedGroup(null);\n                }} \n                className=\"flex-1\"\n              >\n                –û—Ç–º–µ–Ω–∞\n              </Button>\n              <Button \n                onClick={() => {\n                  if (selectedGroup) {\n                    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –≥—Ä—É–ø–ø\n                    if (isPublicGroup) {\n                      if (!publicUsername.trim()) {\n                        toast({\n                          title: \"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\",\n                          description: \"–î–ª—è –ø—É–±–ª–∏—á–Ω–æ–π –≥—Ä—É–ø–ø—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É (@username)\",\n                          variant: \"destructive\"\n                        });\n                        return;\n                      }\n                      \n                      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç username\n                      const cleanUsername = publicUsername.trim();\n                      if (!cleanUsername.startsWith('@') && !cleanUsername.includes('t.me/')) {\n                        toast({\n                          title: \"–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç\",\n                          description: \"–ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ @username –∏–ª–∏ t.me/username\",\n                          variant: \"destructive\"\n                        });\n                        return;\n                      }\n                    }\n                    \n                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –≥—Ä—É–ø–ø—ã\n                    let finalUrl = groupUrl || selectedGroup.url;\n                    if (isPublicGroup && publicUsername.trim()) {\n                      const cleanUsername = publicUsername.trim();\n                      if (cleanUsername.startsWith('@')) {\n                        finalUrl = `https://t.me/${cleanUsername.substring(1)}`;\n                      } else if (cleanUsername.includes('t.me/')) {\n                        finalUrl = cleanUsername.startsWith('http') ? cleanUsername : `https://${cleanUsername}`;\n                      }\n                    } else if (!isPublicGroup && selectedGroup.inviteLink) {\n                      // –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—É—é —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ\n                      finalUrl = selectedGroup.inviteLink;\n                    }\n                    \n                    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n                    const saveToDatabase = (showSuccess = true) => {\n                      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π —Ç–∏–ø —á–∞—Ç–∞ –∏–∑ –≥—Ä—É–ø–ø—ã (–Ω–µ –∏–∑–º–µ–Ω—è–µ–º –µ–≥–æ)\n                      const finalChatType = selectedGroup.chatType || 'group';\n\n                      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –∞–≤–∞—Ç–∞—Ä–∫–∞ –≥—Ä—É–ø–ø—ã\n                      const nameChanged = (groupName || selectedGroup.name) !== selectedGroup.name;\n                      const descriptionChanged = groupDescription !== selectedGroup.description;\n                      const avatarChanged = groupAvatarUrl !== selectedGroup.avatarUrl;\n                      \n                      if ((nameChanged || descriptionChanged || avatarChanged) && (groupName?.trim() || groupDescription.trim() || groupAvatarUrl?.trim())) {\n                        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ Telegram\n                        const saveToDBAfterTelegram = () => {\n                          updateGroupMutation.mutate({\n                            groupId: selectedGroup.id,\n                            data: {\n                              name: groupName || selectedGroup.name,\n                              url: finalUrl,\n                              groupId: selectedGroup.groupId,\n                              description: groupDescription,\n                              avatarUrl: groupAvatarUrl,\n                              language: groupLanguage as 'ru' | 'en' | 'es' | 'fr' | 'de' | 'it' | 'pt' | 'zh' | 'ja' | 'ko',\n                              timezone: groupTimezone,\n                              tags: groupTags,\n                              notes: groupNotes,\n                              isAdmin: makeAdmin ? 1 : 0,\n                              isPublic: isPublicGroup ? 1 : 0,\n                              chatType: finalChatType as 'group' | 'supergroup' | 'channel',\n                              adminRights\n                            },\n                            showSuccessMessage: showSuccess\n                          });\n                        };\n\n                        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ Telegram\n                        const updateTelegramSequentially = () => {\n                          // –°–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ\n                          if (nameChanged && groupName?.trim()) {\n                            setGroupTitleMutation.mutate({\n                              groupId: selectedGroup.groupId,\n                              title: groupName\n                            }, {\n                              onSuccess: () => updateDescriptionOrAvatar(),\n                              onError: updateDescriptionOrAvatar\n                            });\n                          } else {\n                            updateDescriptionOrAvatar();\n                          }\n                        };\n\n                        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –∏–ª–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏\n                        const updateDescriptionOrAvatar = () => {\n                          if (descriptionChanged && groupDescription.trim()) {\n                            setGroupDescriptionMutation.mutate({\n                              groupId: selectedGroup.groupId,\n                              description: groupDescription\n                            }, {\n                              onSuccess: () => updateAvatarIfNeeded(),\n                              onError: updateAvatarIfNeeded\n                            });\n                          } else {\n                            updateAvatarIfNeeded();\n                          }\n                        };\n\n                        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n                        const updateAvatarIfNeeded = () => {\n                          if (avatarChanged && groupAvatarUrl?.trim() && groupAvatarUrl.startsWith('/uploads/')) {\n                            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å —Ñ–∞–π–ª–∞\n                            const photoPath = groupAvatarUrl.replace('/uploads/', 'uploads/');\n                            setGroupPhotoMutation.mutate({\n                              groupId: selectedGroup.groupId,\n                              photoPath: photoPath\n                            }, {\n                              onSuccess: () => updateAdminRightsIfNeeded(),\n                              onError: () => updateAdminRightsIfNeeded()\n                            });\n                          } else {\n                            updateAdminRightsIfNeeded();\n                          }\n                        };\n\n                        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ Telegram –µ—Å–ª–∏ –æ–Ω–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å\n                        const updateAdminRightsIfNeeded = () => {\n                          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n                          const currentRights = selectedGroup.adminRights || {};\n                          const rightsChanged = Object.keys(adminRights).some(key => \n                            adminRights[key as keyof typeof adminRights] !== currentRights[key as keyof typeof currentRights]\n                          );\n                          \n                          if (rightsChanged && selectedGroup.isAdmin === 1) {\n                            updateBotAdminRightsMutation.mutate({\n                              groupId: selectedGroup.groupId,\n                              adminRights: adminRights\n                            }, {\n                              onSuccess: saveToDBAfterTelegram,\n                              onError: saveToDBAfterTelegram // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î –¥–∞–∂–µ –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Telegram –Ω–µ —É–¥–∞–ª–æ—Å—å\n                            });\n                          } else {\n                            saveToDBAfterTelegram();\n                          }\n                        };\n\n                        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ\n                        updateTelegramSequentially();\n                      } else {\n                        // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n                        updateGroupMutation.mutate({\n                          groupId: selectedGroup.id,\n                          data: {\n                            name: groupName || selectedGroup.name,\n                            url: finalUrl,\n                            groupId: selectedGroup.groupId,\n                            description: groupDescription,\n                            avatarUrl: groupAvatarUrl,\n                            language: groupLanguage as 'ru' | 'en' | 'es' | 'fr' | 'de' | 'it' | 'pt' | 'zh' | 'ja' | 'ko',\n                            timezone: groupTimezone,\n                            tags: groupTags,\n                            notes: groupNotes,\n                            isAdmin: makeAdmin ? 1 : 0,\n                            isPublic: isPublicGroup ? 1 : 0,\n                            chatType: finalChatType as 'group' | 'supergroup' | 'channel',\n                            adminRights\n                          },\n                          showSuccessMessage: showSuccess\n                        });\n                      }\n                    };\n\n                    // –ï—Å–ª–∏ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø—ã, —Å–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ–Ω—è–µ–º –≤ Telegram\n                    const wasPublic = Boolean(selectedGroup.isPublic);\n                    const willBePublic = isPublicGroup;\n                    \n                    if (wasPublic !== willBePublic) {\n                      // –ò–∑–º–µ–Ω—è–µ–º username –≤ Telegram –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –±–∞–∑–µ\n                      let usernameToSet = '';\n                      if (willBePublic && publicUsername.trim()) {\n                        const cleanUsername = publicUsername.trim().replace('@', '').replace('t.me/', '').replace('https://', '').replace('http://', '');\n                        usernameToSet = cleanUsername;\n                      }\n                      \n                      // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –∏–∑–º–µ–Ω–∏—Ç—å –≤ Telegram, –ø–æ—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑–µ\n                      setGroupUsernameMutation.mutate({\n                        groupId: selectedGroup.groupId,\n                        username: usernameToSet\n                      }, {\n                        onSuccess: () => {\n                          // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ Telegram —É–¥–∞–ª–æ—Å—å - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑–µ —Å —É—Å–ø–µ—à–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º\n                          saveToDatabase(true);\n                          toast({\n                            title: \"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã\",\n                            description: \"–ü—É–±–ª–∏—á–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø—ã —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∞\",\n                          });\n                        },\n                        onError: (error: any) => {\n                          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –∏ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑–µ\n                          toast({\n                            title: \"–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø—ã\",\n                            description: error.requiresClientApi \n                              ? \"–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Client API –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—É–±–ª–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≥—Ä—É–ø–ø—ã\"\n                              : error.error || error.message || \"–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ\",\n                            variant: \"destructive\"\n                          });\n                        }\n                      });\n                    } else {\n                      // –ï—Å–ª–∏ –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è - —Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å –æ–±—ã—á–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º\n                      saveToDatabase(true);\n                    }\n                  }\n                }}\n                disabled={updateGroupMutation.isPending}\n                className=\"flex-1\"\n              >\n                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É */}\n        <Dialog open={showSendMessage} onOpenChange={setShowSendMessage}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É</DialogTitle>\n              <DialogDescription>\n                –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É \"{selectedGroupForMessage?.name}\" —á–µ—Ä–µ–∑ Telegram Bot API\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"message-text\">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</Label>\n                <Textarea\n                  id=\"message-text\"\n                  placeholder=\"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è...\"\n                  value={messageToSend}\n                  onChange={(e) => setMessageToSend(e.target.value)}\n                  rows={4}\n                />\n              </div>\n            </div>\n            \n            <div className=\"flex gap-2 pt-4\">\n              <Button \n                variant=\"outline\" \n                onClick={() => {\n                  setShowSendMessage(false);\n                  setMessageToSend('');\n                  setSelectedGroupForMessage(null);\n                }} \n                className=\"flex-1\"\n              >\n                –û—Ç–º–µ–Ω–∞\n              </Button>\n              <Button \n                onClick={() => {\n                  if (selectedGroupForMessage && messageToSend.trim()) {\n                    sendMessageMutation.mutate({\n                      groupId: selectedGroupForMessage.groupId,\n                      message: messageToSend.trim()\n                    });\n                  }\n                }}\n                disabled={sendMessageMutation.isPending || !messageToSend.trim()}\n                className=\"flex-1\"\n              >\n                {sendMessageMutation.isPending ? '–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å'}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* Telegram Auth Dialog */}\n        <TelegramAuth\n          open={showTelegramAuth}\n          onOpenChange={setShowTelegramAuth}\n          onSuccess={async () => {\n            // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n            if (selectedGroup) {\n              setIsLoadingMembers(true);\n              try {\n                const response = await fetch(`/api/projects/${projectId}/telegram-client/group-members/${selectedGroup.groupId}`);\n                const data = await response.json();\n                \n                if (response.ok && data.success) {\n                  setClientApiMembers(data.members || []);\n                  toast({\n                    title: data.message,\n                    description: `–ü–æ–ª—É—á–µ–Ω–æ ${data.memberCount} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ Client API`,\n                  });\n                } else {\n                  toast({\n                    title: data.message || \"–û—à–∏–±–∫–∞\",\n                    description: data.explanation || \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ\",\n                    variant: \"destructive\"\n                  });\n                }\n              } catch (error) {\n                toast({\n                  title: \"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\",\n                  description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Client API\",\n                  variant: \"destructive\"\n                });\n              } finally {\n                setIsLoadingMembers(false);\n              }\n            }\n          }}\n        />\n\n        {/* –î–∏–∞–ª–æ–≥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ */}\n        <Dialog open={showPermissionsDialog} onOpenChange={setShowPermissionsDialog}>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞</DialogTitle>\n              <DialogDescription>\n                {selectedMember && (\n                  <span>\n                    –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è {selectedMember.firstName || selectedMember.user?.first_name || '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'} \n                    (@{selectedMember.username || selectedMember.user?.username || '–±–µ–∑ username'})\n                    {loadMemberPermissionsMutation.isPending && (\n                      <span className=\"text-blue-600 ml-2\">‚Ä¢ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∞...</span>\n                    )}\n                  </span>\n                )}\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                {/* –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è */}\n                <div className=\"space-y-3\">\n                  <h4 className=\"font-medium text-sm\">–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è</h4>\n                  {Object.entries({\n                    can_send_messages: '–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π',\n                    can_send_media_messages: '–û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞',\n                    can_send_polls: '–°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–æ–≤',\n                    can_send_other_messages: '–°—Ç–∏–∫–µ—Ä—ã –∏ GIF',\n                    can_add_web_page_previews: '–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Å—ã–ª–æ–∫'\n                  }).map(([key, label]) => (\n                    <div key={key} className=\"flex items-center space-x-2\">\n                      <Switch\n                        checked={memberPermissions[key as keyof typeof memberPermissions]}\n                        onCheckedChange={(checked) => \n                          setMemberPermissions(prev => ({ ...prev, [key]: checked }))\n                        }\n                      />\n                      <Label className=\"text-sm\">{label}</Label>\n                    </div>\n                  ))}\n                </div>\n\n                {/* –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è */}\n                <div className=\"space-y-3\">\n                  <h4 className=\"font-medium text-sm\">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è</h4>\n                  {Object.entries({\n                    can_change_info: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≥—Ä—É–ø–ø—ã',\n                    can_delete_messages: '–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π',\n                    can_restrict_members: '–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',\n                    can_invite_users: '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏',\n                    can_pin_messages: '–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π',\n                    can_manage_video_chats: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ—á–∞—Ç–∞–º–∏',\n                    can_be_anonymous: '–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å',\n                    can_promote_members: '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤'\n                  }).map(([key, label]) => (\n                    <div key={key} className=\"flex items-center space-x-2\">\n                      <Switch\n                        checked={memberPermissions[key as keyof typeof memberPermissions]}\n                        onCheckedChange={(checked) => \n                          setMemberPermissions(prev => ({ ...prev, [key]: checked }))\n                        }\n                      />\n                      <Label className=\"text-sm\">{label}</Label>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-2 pt-4\">\n                <Button variant=\"outline\" onClick={() => setShowPermissionsDialog(false)}>\n                  –û—Ç–º–µ–Ω–∞\n                </Button>\n                <Button \n                  onClick={() => {\n                    if (selectedMember && selectedGroup) {\n                      // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è userId –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ API\n                      const userId = \n                        selectedMember.id?.toString() || \n                        selectedMember.user?.id?.toString() || \n                        selectedMember.userId?.toString() ||\n                        selectedMember.from?.id?.toString() ||\n                        selectedMember.from_user?.id?.toString() ||\n                        (selectedMember as any).user_id?.toString();\n                      \n                      const groupId = selectedGroup.groupId;\n                      \n                      // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é\n                      console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:', {\n                        selectedMember,\n                        extractedUserId: userId,\n                        groupId,\n                        currentPermissions: memberPermissions,\n                        availableKeys: Object.keys(selectedMember)\n                      });\n                      \n                      if (!userId || !groupId) {\n                        toast({\n                          title: '–û—à–∏–±–∫–∞',\n                          description: `–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (${userId}) –∏–ª–∏ –≥—Ä—É–ø–ø—ã (${groupId}). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.`,\n                          variant: 'destructive'\n                        });\n                        return;\n                      }\n                      \n                      updatePermissionsMutation.mutate({\n                        groupId,\n                        userId,\n                        permissions: memberPermissions\n                      });\n                    }\n                  }}\n                  disabled={updatePermissionsMutation.isPending}\n                >\n                  {updatePermissionsMutation.isPending ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è'}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* –î–∏–∞–ª–æ–≥ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫ */}\n        <Dialog open={showUserSearch} onOpenChange={setShowUserSearch}>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</DialogTitle>\n              <DialogDescription>\n                –í–≤–µ–¥–∏—Ç–µ username (–±–µ–∑ @) –∏–ª–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"user-search\">Username –∏–ª–∏ ID</Label>\n                <Input\n                  id=\"user-search\"\n                  placeholder=\"Sonofbog2 –∏–ª–∏ 123456789\"\n                  value={userSearchQuery}\n                  onChange={(e) => setUserSearchQuery(e.target.value)}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' && userSearchQuery.trim()) {\n                      simpleSearchUserMutation.mutate(userSearchQuery.trim());\n                    }\n                  }}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  –ù–∞–ø—Ä–∏–º–µ—Ä: <code>Sonofbog2</code> –∏–ª–∏ <code>@Sonofbog2</code> –∏–ª–∏ <code>123456789</code>\n                </p>\n              </div>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button \n                  variant=\"outline\" \n                  onClick={() => {\n                    setShowUserSearch(false);\n                    setUserSearchQuery('');\n                  }}\n                >\n                  –û—Ç–º–µ–Ω–∞\n                </Button>\n                <Button \n                  onClick={() => {\n                    if (userSearchQuery.trim()) {\n                      simpleSearchUserMutation.mutate(userSearchQuery.trim());\n                    }\n                  }}\n                  disabled={simpleSearchUserMutation.isPending || !userSearchQuery.trim()}\n                >\n                  {simpleSearchUserMutation.isPending ? '–ü–æ–∏—Å–∫...' : '–ù–∞–π—Ç–∏ –∏ –¥–æ–±–∞–≤–∏—Ç—å'}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* –î–∏–∞–ª–æ–≥ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º */}\n        <Dialog open={showAdminSearch} onOpenChange={setShowAdminSearch}>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</DialogTitle>\n              <DialogDescription>\n                –í–≤–µ–¥–∏—Ç–µ username (–±–µ–∑ @) –∏–ª–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"admin-search\">Username –∏–ª–∏ ID</Label>\n                <Input\n                  id=\"admin-search\"\n                  placeholder=\"Sonofbog2 –∏–ª–∏ 123456789\"\n                  value={userSearchQuery}\n                  onChange={(e) => setUserSearchQuery(e.target.value)}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' && userSearchQuery.trim()) {\n                      searchUserMutation.mutate(userSearchQuery.trim());\n                    }\n                  }}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  –ù–∞–ø—Ä–∏–º–µ—Ä: <code>Sonofbog2</code> –∏–ª–∏ <code>@Sonofbog2</code> –∏–ª–∏ <code>123456789</code>\n                </p>\n              </div>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button \n                  variant=\"outline\" \n                  onClick={() => {\n                    setShowAdminSearch(false);\n                    setUserSearchQuery('');\n                  }}\n                >\n                  –û—Ç–º–µ–Ω–∞\n                </Button>\n                <Button \n                  onClick={() => {\n                    if (userSearchQuery.trim()) {\n                      searchUserMutation.mutate(userSearchQuery.trim());\n                    }\n                  }}\n                  disabled={searchUserMutation.isPending || !userSearchQuery.trim()}\n                >\n                  {searchUserMutation.isPending ? '–ü–æ–∏—Å–∫...' : '–ù–∞–π—Ç–∏ –∏ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º'}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}","size_bytes":173817},"server/telegram-client.ts":{"content":"import { TelegramClient } from 'telegram';\nimport { StringSession } from 'telegram/sessions';\nimport { Api } from 'telegram/tl';\nimport { db } from './db';\nimport { userTelegramSettings } from '@shared/schema';\nimport { eq } from 'drizzle-orm';\n\ninterface TelegramClientConfig {\n  apiId: string;\n  apiHash: string;\n  session?: string;\n  phoneNumber?: string;\n}\n\ninterface AuthStatus {\n  isAuthenticated: boolean;\n  phoneNumber?: string;\n  userId?: string;\n  needsCode?: boolean;\n  needsPassword?: boolean;\n}\n\nclass TelegramClientManager {\n  private clients: Map<string, TelegramClient> = new Map();\n  private sessions: Map<string, string> = new Map();\n  private authStatus: Map<string, AuthStatus> = new Map();\n\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π\n  async initialize(): Promise<void> {\n    try {\n\n      const allSessions = await db.select().from(userTelegramSettings).where(eq(userTelegramSettings.isActive, 1));\n      \n      console.log(`üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ${allSessions.length} —Å–µ—Å—Å–∏–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...`);\n      \n      for (const sessionData of allSessions) {\n        if (sessionData.sessionString && sessionData.userId) {\n          await this.restoreSession(sessionData.userId);\n        }\n      }\n      \n      console.log('‚úÖ –í—Å–µ —Å–µ—Å—Å–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–π:', error);\n    }\n  }\n\n  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\n  private async saveSessionToDatabase(userId: string, sessionString: string, phoneNumber: string): Promise<void> {\n    try {\n\n      const existing = await db.select().from(userTelegramSettings).where(eq(userTelegramSettings.userId, userId)).limit(1);\n      \n      if (existing.length > 0) {\n        await db.update(userTelegramSettings)\n          .set({ \n            sessionString, \n            phoneNumber,\n            updatedAt: new Date()\n          })\n          .where(eq(userTelegramSettings.userId, userId));\n      } else {\n        await db.insert(userTelegramSettings).values({\n          userId,\n          sessionString,\n          phoneNumber\n        });\n      }\n      console.log(`üíæ –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ë–î –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${phoneNumber}`);\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –≤ –ë–î:', error);\n    }\n  }\n\n  // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Å—Å–∏—é –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n  private async loadSessionFromDatabase(userId: string): Promise<string | null> {\n    try {\n\n      const result = await db.select().from(userTelegramSettings).where(eq(userTelegramSettings.userId, userId)).limit(1);\n      \n      if (result.length > 0 && result[0].sessionString) {\n        console.log(`üîÑ –°–µ—Å—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –ë–î –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}`);\n        return result[0].sessionString;\n      }\n      return null;\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Å—Å–∏–∏ –∏–∑ –ë–î:', error);\n      return null;\n    }\n  }\n\n  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏\n  async restoreSession(userId: string): Promise<boolean> {\n    try {\n      const sessionString = await this.loadSessionFromDatabase(userId);\n      if (!sessionString) {\n        return false;\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º credentials –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n\n      const result = await db.select().from(userTelegramSettings).where(eq(userTelegramSettings.userId, userId)).limit(1);\n      \n      if (result.length === 0 || !result[0].apiId || !result[0].apiHash) {\n        console.log(`‚ùå API credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}`);\n        return false;\n      }\n      \n      const apiId = result[0].apiId;\n      const apiHash = result[0].apiHash;\n\n      const stringSession = new StringSession(sessionString);\n      const client = new TelegramClient(stringSession, parseInt(apiId), apiHash, {\n        connectionRetries: 5,\n      });\n\n      await client.connect();\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Å—Å–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞\n      const me = await client.getMe();\n      if (me) {\n        this.clients.set(userId, client);\n        this.sessions.set(userId, sessionString);\n        this.authStatus.set(userId, {\n          isAuthenticated: true,\n          phoneNumber: (me as any).phone,\n          userId: userId,\n          needsCode: false,\n          needsPassword: false\n        });\n        console.log(`‚úÖ –°–µ—Å—Å–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}`);\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error(`–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –¥–ª—è ${userId}:`, error);\n      return false;\n    }\n  }\n\n  async sendCode(userId: string, phoneNumber: string): Promise<{ success: boolean; phoneCodeHash?: string; error?: string }> {\n    try {\n      // –ü–æ–ª—É—á–∞–µ–º credentials –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n\n      const credentialsResult = await db.select().from(userTelegramSettings).where(eq(userTelegramSettings.userId, userId)).limit(1);\n      \n      if (credentialsResult.length === 0 || !credentialsResult[0].apiId || !credentialsResult[0].apiHash) {\n        throw new Error('Telegram API credentials not configured');\n      }\n      \n      const apiId = credentialsResult[0].apiId;\n      const apiHash = credentialsResult[0].apiHash;\n\n      const stringSession = new StringSession('');\n      const client = new TelegramClient(stringSession, parseInt(apiId), apiHash, {\n        connectionRetries: 5,\n      });\n\n      await client.connect();\n\n      const result = await client.invoke(\n        new Api.auth.SendCode({\n          phoneNumber: phoneNumber,\n          apiId: parseInt(apiId),\n          apiHash: apiHash,\n          settings: new Api.CodeSettings({\n            allowFlashcall: false,\n            currentNumber: false,\n            allowAppHash: false,\n          }),\n        })\n      );\n\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n      this.clients.set(userId, client);\n      this.authStatus.set(userId, {\n        isAuthenticated: false,\n        phoneNumber: phoneNumber,\n        userId: userId,\n        needsCode: true,\n        needsPassword: false\n      });\n\n      console.log(`üì± –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –Ω–æ–º–µ—Ä ${phoneNumber}`);\n\n      return {\n        success: true,\n        phoneCodeHash: (result as any).phoneCodeHash\n      };\n\n    } catch (error: any) {\n      console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞:', error);\n      return {\n        success: false,\n        error: error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞'\n      };\n    }\n  }\n\n  async verifyCode(userId: string, phoneNumber: string, phoneCode: string, phoneCodeHash: string): Promise<{ success: boolean; error?: string; needsPassword?: boolean }> {\n    try {\n      const client = this.clients.get(userId);\n      if (!client) {\n        throw new Error('–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥.');\n      }\n\n      const result = await client.invoke(\n        new Api.auth.SignIn({\n          phoneNumber: phoneNumber,\n          phoneCodeHash: phoneCodeHash,\n          phoneCode: phoneCode,\n        })\n      );\n\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é\n      const sessionString = (client.session.save() as any) || '';\n      this.sessions.set(userId, sessionString);\n      await this.saveSessionToDatabase(userId, sessionString, phoneNumber);\n\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n      this.authStatus.set(userId, {\n        isAuthenticated: true,\n        phoneNumber: phoneNumber,\n        userId: userId,\n        needsCode: false,\n        needsPassword: false\n      });\n\n      console.log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${phoneNumber} —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω`);\n\n      return { success: true };\n\n    } catch (error: any) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞:', error);\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–µ–Ω –ª–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è 2FA\n      if (error.message && error.message.includes('SESSION_PASSWORD_NEEDED')) {\n        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å\n        this.authStatus.set(userId, {\n          isAuthenticated: false,\n          phoneNumber: phoneNumber,\n          userId: userId,\n          needsCode: false,\n          needsPassword: true\n        });\n\n        console.log(`üîê –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å 2FA –¥–ª—è ${phoneNumber}`);\n        \n        return {\n          success: false,\n          needsPassword: true,\n          error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏'\n        };\n      }\n\n      return {\n        success: false,\n        error: error.message || '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è'\n      };\n    }\n  }\n\n  async verifyPassword(userId: string, password: string): Promise<{ success: boolean; error?: string }> {\n    try {\n      const client = this.clients.get(userId);\n      if (!client) {\n        throw new Error('–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥.');\n      }\n\n      const authStatus = this.authStatus.get(userId);\n      if (!authStatus || !authStatus.needsPassword) {\n        throw new Error('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.');\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è 2FA –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏\n      const passwordInfo = await client.invoke(new Api.account.GetPassword());\n      \n      // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SRP\n      const { computeCheck } = await import('telegram/Password');\n      \n      // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–µ—à –ø–∞—Ä–æ–ª—è\n      const passwordCheck = await computeCheck(passwordInfo, password);\n      \n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π API –≤—ã–∑–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è\n      const result = await client.invoke(\n        new Api.auth.CheckPassword({\n          password: passwordCheck\n        })\n      );\n\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é\n      const sessionString = (client.session.save() as any) || '';\n      this.sessions.set(userId, sessionString);\n      await this.saveSessionToDatabase(userId, sessionString, authStatus.phoneNumber || '');\n\n      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n      this.authStatus.set(userId, {\n        isAuthenticated: true,\n        phoneNumber: authStatus.phoneNumber,\n        userId: userId,\n        needsCode: false,\n        needsPassword: false\n      });\n\n      console.log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${authStatus.phoneNumber} —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —Å 2FA`);\n\n      return { success: true };\n\n    } catch (error: any) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è:', error);\n      return {\n        success: false,\n        error: error.message === 'PASSWORD_HASH_INVALID' ? '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' : (error.message || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏')\n      };\n    }\n  }\n\n  async getAuthStatus(userId: string): Promise<AuthStatus & { hasCredentials?: boolean }> {\n    const status = this.authStatus.get(userId) || {\n      isAuthenticated: false,\n      needsCode: false,\n      needsPassword: false\n    };\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ credentials –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\n    try {\n\n      const result = await db.select().from(userTelegramSettings).where(eq(userTelegramSettings.userId, userId)).limit(1);\n      const hasCredentials = result.length > 0 && result[0].apiId && result[0].apiHash;\n      \n      return { ...status, hasCredentials };\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ credentials:', error);\n      return { ...status, hasCredentials: false };\n    }\n  }\n\n  async setCredentials(userId: string, apiId: string, apiHash: string): Promise<{ success: boolean; error?: string }> {\n    try {\n\n      const existing = await db.select().from(userTelegramSettings).where(eq(userTelegramSettings.userId, userId)).limit(1);\n      \n      if (existing.length > 0) {\n        await db.update(userTelegramSettings)\n          .set({ \n            apiId, \n            apiHash,\n            updatedAt: new Date()\n          })\n          .where(eq(userTelegramSettings.userId, userId));\n      } else {\n        await db.insert(userTelegramSettings).values({\n          userId,\n          apiId,\n          apiHash\n        });\n      }\n      \n      console.log(`üíæ API credentials —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}`);\n      return { success: true };\n    } catch (error: any) {\n      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è credentials:', error);\n      return { \n        success: false, \n        error: error.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è credentials' \n      };\n    }\n  }\n\n  async createClient(userId: string, config: TelegramClientConfig): Promise<TelegramClient> {\n    const { apiId, apiHash, session } = config;\n    \n    const stringSession = new StringSession(session || '');\n    const client = new TelegramClient(stringSession, parseInt(apiId), apiHash, {\n      connectionRetries: 5,\n    });\n\n    try {\n      await client.start({\n        phoneNumber: config.phoneNumber || '',\n        password: async () => {\n          throw new Error('2FA not supported in this implementation');\n        },\n        phoneCode: async () => {\n          throw new Error('Phone code verification not implemented');\n        },\n        onError: (err) => console.error('Telegram client error:', err),\n      });\n\n      this.clients.set(userId, client);\n      return client;\n    } catch (error) {\n      console.error('Failed to start Telegram client:', error);\n      throw error;\n    }\n  }\n\n  async getClient(userId: string): Promise<TelegramClient | null> {\n    return this.clients.get(userId) || null;\n  }\n\n  async getGroupMembers(userId: string, chatId: string | number): Promise<any[]> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    const authStatus = await this.getAuthStatus(userId);\n    if (!authStatus.isAuthenticated) {\n      throw new Error('User not authenticated. Please complete phone verification first.');\n    }\n\n    try {\n      // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞\n      let chatEntity: any;\n      \n      try {\n        // –ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —á–∞—Ç –ø–æ –µ–≥–æ ID –∏–ª–∏ username\n        chatEntity = await client.getEntity(chatId);\n      } catch (entityError) {\n        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é, –ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã');\n        \n        // –ï—Å–ª–∏ ID –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å -100, —ç—Ç–æ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞\n        if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n          const channelId = chatId.slice(4);\n          chatEntity = new Api.PeerChannel({ channelId: BigInt(channelId) });\n        } else {\n          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç —Å ID: ${chatId}`);\n        }\n      }\n\n      const result = await client.invoke(\n        new Api.channels.GetParticipants({\n          channel: chatEntity,\n          filter: new Api.ChannelParticipantsRecent(),\n          offset: 0,\n          limit: 200,\n          hash: BigInt(0),\n        })\n      );\n\n      if ('participants' in result) {\n        return result.participants.map((participant: any) => {\n          // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö\n          console.log('Participant structure:', {\n            participant: participant,\n            userId: participant.userId,\n            user_id: participant.user_id,\n            peer: participant.peer,\n            availableKeys: Object.keys(participant)\n          });\n          \n          // –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è user ID\n          const userId = participant.userId || participant.user_id || participant.peer?.user_id || participant.peer?.userId;\n          const user = result.users.find((u: any) => u.id?.toString() === userId?.toString());\n          \n          return {\n            id: userId?.toString(),\n            username: (user as any)?.username || null,\n            firstName: (user as any)?.firstName || null,\n            lastName: (user as any)?.lastName || null,\n            isBot: (user as any)?.bot || false,\n            status: this.getParticipantStatus(participant),\n            joinedAt: participant.date ? new Date(participant.date * 1000) : null,\n          };\n        });\n      }\n\n      return [];\n    } catch (error: any) {\n      console.error('Failed to get group members:', error);\n      throw new Error(`Failed to get group members: ${error.message || 'Unknown error'}`);\n    }\n  }\n\n  private getParticipantStatus(participant: any): string {\n    if (participant.className === 'ChannelParticipantCreator') return 'creator';\n    if (participant.className === 'ChannelParticipantAdmin') return 'administrator';\n    if (participant.className === 'ChannelParticipantBanned') return 'kicked';\n    return 'member';\n  }\n\n  async getChatInfo(userId: string, chatId: string | number): Promise<any> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    try {\n      let chat: any;\n      if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n        const channelId = parseInt(chatId.slice(4));\n        chat = channelId;\n      } else {\n        chat = chatId;\n      }\n\n      const result = await client.invoke(\n        new Api.channels.GetFullChannel({\n          channel: chat,\n        })\n      );\n\n      return {\n        id: result.fullChat.id.toString(),\n        title: (result.chats[0] as any)?.title || 'Unknown',\n        participantsCount: (result.fullChat as any)?.participantsCount,\n        about: (result.fullChat as any)?.about || '',\n        chatPhoto: (result.chats[0] as any)?.photo || null,\n      };\n    } catch (error: any) {\n      console.error('Failed to get chat info:', error);\n      throw new Error(`Failed to get chat info: ${error.message || 'Unknown error'}`);\n    }\n  }\n\n  async disconnect(userId: string): Promise<void> {\n    const client = this.clients.get(userId);\n    if (client) {\n      try {\n        await client.disconnect();\n        this.clients.delete(userId);\n        this.authStatus.delete(userId);\n        this.sessions.delete(userId);\n      } catch (error) {\n        console.error('Error disconnecting client:', error);\n      }\n    }\n  }\n\n  async saveSession(userId: string): Promise<string | null> {\n    const client = this.clients.get(userId);\n    if (client && client.session) {\n      return client.session.save() as string;\n    }\n    return null;\n  }\n\n  async setChatUsername(userId: string, chatId: string | number, username: string): Promise<any> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    const authStatus = await this.getAuthStatus(userId);\n    if (!authStatus.isAuthenticated) {\n      throw new Error('User not authenticated. Please complete phone verification first.');\n    }\n\n    try {\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞\n      let chatEntity: any;\n      try {\n        chatEntity = await client.getEntity(chatId);\n      } catch (entityError) {\n        if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n          const channelId = BigInt(chatId.slice(4));\n          chatEntity = new Api.PeerChannel({ channelId });\n        } else {\n          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç —Å ID: ${chatId}`);\n        }\n      }\n\n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º username —á–∞—Ç–∞ (–¥–µ–ª–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–º –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º)\n      const result = await client.invoke(\n        new Api.channels.UpdateUsername({\n          channel: chatEntity,\n          username: username || '', // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–µ–ª–∞–µ—Ç –≥—Ä—É–ø–ø—É –ø—Ä–∏–≤–∞—Ç–Ω–æ–π\n        })\n      );\n\n      return result;\n    } catch (error: any) {\n      console.error('Failed to set chat username:', error);\n      throw new Error(`Failed to set chat username: ${error.message || 'Unknown error'}`);\n    }\n  }\n\n  async setChatPhoto(userId: string, chatId: string | number, photoPath: string): Promise<any> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    const authStatus = await this.getAuthStatus(userId);\n    if (!authStatus.isAuthenticated) {\n      throw new Error('User not authenticated. Please complete phone verification first.');\n    }\n\n    try {\n      // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª\n      const fs = await import('fs');\n      const photoBuffer = fs.readFileSync(photoPath);\n\n      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –≤ Telegram\n      const file = await client.uploadFile({\n        file: photoBuffer,\n        workers: 1,\n      });\n\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞\n      let chatEntity: any;\n      try {\n        chatEntity = await client.getEntity(chatId);\n      } catch (entityError) {\n        if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n          const channelId = BigInt(chatId.slice(4));\n          chatEntity = new Api.PeerChannel({ channelId });\n        } else {\n          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç —Å ID: ${chatId}`);\n        }\n      }\n\n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ç–æ —á–∞—Ç–∞\n      const result = await client.invoke(\n        new Api.channels.EditPhoto({\n          channel: chatEntity,\n          photo: file,\n        })\n      );\n\n      return result;\n    } catch (error: any) {\n      console.error('Failed to set chat photo:', error);\n      throw new Error(`Failed to set chat photo: ${error.message || 'Unknown error'}`);\n    }\n  }\n\n  // –ò—Å–∫–ª—é—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –≥—Ä—É–ø–ø—ã —á–µ—Ä–µ–∑ Client API\n  async kickMember(userId: string, chatId: string | number, memberId: string): Promise<any> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    try {\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞\n      let chatEntity: any;\n      try {\n        chatEntity = await client.getEntity(chatId);\n      } catch (entityError) {\n        if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n          const channelId = BigInt(chatId.slice(4));\n          chatEntity = new Api.PeerChannel({ channelId });\n        } else {\n          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç —Å ID: ${chatId}`);\n        }\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      const userEntity = await client.getEntity(parseInt(memberId));\n\n      // –ò—Å–∫–ª—é—á–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞\n      const result = await client.invoke(\n        new Api.channels.EditBanned({\n          channel: chatEntity,\n          participant: userEntity,\n          bannedRights: new Api.ChatBannedRights({\n            untilDate: Math.floor(Date.now() / 1000) + 60, // –ë–∞–Ω –Ω–∞ 60 —Å–µ–∫—É–Ω–¥ (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ)\n            viewMessages: true,\n            sendMessages: true,\n            sendMedia: true,\n            sendStickers: true,\n            sendGifs: true,\n            sendGames: true,\n            sendInline: true,\n            embedLinks: true,\n            sendPolls: true,\n            changeInfo: true,\n            inviteUsers: true,\n            pinMessages: true,\n            manageTopics: true,\n          }),\n        })\n      );\n\n      return result;\n    } catch (error: any) {\n      console.error('Failed to kick member:', error);\n      throw new Error(`Failed to kick member: ${error.message || 'Unknown error'}`);\n    }\n  }\n\n  // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–µ—Ä–µ–∑ Client API\n  async banMember(userId: string, chatId: string | number, memberId: string, untilDate?: number): Promise<any> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    try {\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞\n      let chatEntity: any;\n      try {\n        chatEntity = await client.getEntity(chatId);\n      } catch (entityError) {\n        if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n          const channelId = BigInt(chatId.slice(4));\n          chatEntity = new Api.PeerChannel({ channelId });\n        } else {\n          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç —Å ID: ${chatId}`);\n        }\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      const userEntity = await client.getEntity(parseInt(memberId));\n\n      // –ë–ª–æ–∫–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞\n      const result = await client.invoke(\n        new Api.channels.EditBanned({\n          channel: chatEntity,\n          participant: userEntity,\n          bannedRights: new Api.ChatBannedRights({\n            untilDate: untilDate || 0, // 0 = –Ω–∞–≤—Å–µ–≥–¥–∞\n            viewMessages: true,\n            sendMessages: true,\n            sendMedia: true,\n            sendStickers: true,\n            sendGifs: true,\n            sendGames: true,\n            sendInline: true,\n            embedLinks: true,\n            sendPolls: true,\n            changeInfo: true,\n            inviteUsers: true,\n            pinMessages: true,\n            manageTopics: true,\n          }),\n        })\n      );\n\n      return result;\n    } catch (error: any) {\n      console.error('Failed to ban member:', error);\n      throw new Error(`Failed to ban member: ${error.message || 'Unknown error'}`);\n    }\n  }\n\n  // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–º—É—Ç) —á–µ—Ä–µ–∑ Client API\n  async restrictMember(userId: string, chatId: string | number, memberId: string, untilDate?: number): Promise<any> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    try {\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞\n      let chatEntity: any;\n      try {\n        chatEntity = await client.getEntity(chatId);\n      } catch (entityError) {\n        if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n          const channelId = BigInt(chatId.slice(4));\n          chatEntity = new Api.PeerChannel({ channelId });\n        } else {\n          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç —Å ID: ${chatId}`);\n        }\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      const userEntity = await client.getEntity(parseInt(memberId));\n\n      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞\n      const result = await client.invoke(\n        new Api.channels.EditBanned({\n          channel: chatEntity,\n          participant: userEntity,\n          bannedRights: new Api.ChatBannedRights({\n            untilDate: untilDate || Math.floor(Date.now() / 1000) + 3600, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ 1 —á–∞—Å\n            viewMessages: false, // –ú–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è\n            sendMessages: true,  // –ù–µ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å\n            sendMedia: true,\n            sendStickers: true,\n            sendGifs: true,\n            sendGames: true,\n            sendInline: true,\n            embedLinks: true,\n            sendPolls: true,\n            changeInfo: true,\n            inviteUsers: true,\n            pinMessages: true,\n            manageTopics: true,\n          }),\n        })\n      );\n\n      return result;\n    } catch (error: any) {\n      console.error('Failed to restrict member:', error);\n      throw new Error(`Failed to restrict member: ${error.message || 'Unknown error'}`);\n    }\n  }\n\n  // –ù–∞–∑–Ω–∞—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ Client API  \n  async promoteMember(userId: string, chatId: string | number, memberId: string, adminRights: any): Promise<any> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    try {\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞\n      let chatEntity: any;\n      try {\n        chatEntity = await client.getEntity(chatId);\n      } catch (entityError) {\n        if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n          const channelId = BigInt(chatId.slice(4));\n          chatEntity = new Api.PeerChannel({ channelId });\n        } else {\n          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç —Å ID: ${chatId}`);\n        }\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      const userEntity = await client.getEntity(parseInt(memberId));\n\n      // –ù–∞–∑–Ω–∞—á–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\n      const result = await client.invoke(\n        new Api.channels.EditAdmin({\n          channel: chatEntity,\n          userId: userEntity,\n          adminRights: new Api.ChatAdminRights({\n            changeInfo: adminRights.can_change_info || false,\n            postMessages: adminRights.can_post_messages || false,\n            editMessages: adminRights.can_edit_messages || false,\n            deleteMessages: adminRights.can_delete_messages || false,\n            banUsers: adminRights.can_restrict_members || false,\n            inviteUsers: adminRights.can_invite_users || false,\n            pinMessages: adminRights.can_pin_messages || false,\n            addAdmins: adminRights.can_promote_members || false,\n            manageCall: adminRights.can_manage_video_chats || false,\n            anonymous: adminRights.can_be_anonymous || false,\n            manageTopics: adminRights.can_manage_topics || false,\n            postStories: adminRights.can_post_stories || false,\n            editStories: adminRights.can_edit_stories || false,\n            deleteStories: adminRights.can_delete_stories || false,\n          }),\n          rank: adminRights.custom_title || ''\n        })\n      );\n\n      return result;\n    } catch (error: any) {\n      console.error('Failed to promote member:', error);\n      throw new Error(`Failed to promote member: ${error.message || 'Unknown error'}`);\n    }\n  }\n\n  // –°–Ω—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ Client API\n  async demoteMember(userId: string, chatId: string | number, memberId: string): Promise<any> {\n    const client = await this.getClient(userId);\n    if (!client) {\n      throw new Error('Telegram client not found. Please authenticate first.');\n    }\n\n    try {\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å —á–∞—Ç–∞\n      let chatEntity: any;\n      try {\n        chatEntity = await client.getEntity(chatId);\n      } catch (entityError) {\n        if (typeof chatId === 'string' && chatId.startsWith('-100')) {\n          const channelId = BigInt(chatId.slice(4));\n          chatEntity = new Api.PeerChannel({ channelId });\n        } else {\n          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç —Å ID: ${chatId}`);\n        }\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      const userEntity = await client.getEntity(parseInt(memberId));\n\n      // –°–Ω–∏–º–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç—ã–µ –ø—Ä–∞–≤–∞)\n      const result = await client.invoke(\n        new Api.channels.EditAdmin({\n          channel: chatEntity,\n          userId: userEntity,\n          adminRights: new Api.ChatAdminRights({\n            changeInfo: false,\n            postMessages: false,\n            editMessages: false,\n            deleteMessages: false,\n            banUsers: false,\n            inviteUsers: false,\n            pinMessages: false,\n            addAdmins: false,\n            manageCall: false,\n            anonymous: false,\n            manageTopics: false,\n            postStories: false,\n            editStories: false,\n            deleteStories: false,\n          }),\n          rank: ''\n        })\n      );\n\n      return result;\n    } catch (error: any) {\n      console.error('Failed to demote member:', error);\n      throw new Error(`Failed to demote member: ${error.message || 'Unknown error'}`);\n    }\n  }\n}\n\nexport const telegramClientManager = new TelegramClientManager();\n\n// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ routes.ts\nexport function initializeTelegramManager() {\n  return telegramClientManager.initialize();\n}","size_bytes":32746},"client/src/components/telegram-auth.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, Phone, Shield, CheckCircle2, Lock } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface TelegramAuthProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSuccess: () => void;\n}\n\ninterface AuthStatus {\n  isAuthenticated: boolean;\n  phoneNumber?: string;\n  userId?: string;\n  needsCode?: boolean;\n  needsPassword?: boolean;\n}\n\nexport function TelegramAuth({ open, onOpenChange, onSuccess }: TelegramAuthProps) {\n  const [step, setStep] = useState<'credentials' | 'phone' | 'code' | 'password'>('credentials');\n  const [apiId, setApiId] = useState('');\n  const [apiHash, setApiHash] = useState('');\n  const [phoneNumber, setPhoneNumber] = useState('');\n  const [phoneCode, setPhoneCode] = useState('');\n  const [phoneCodeHash, setPhoneCodeHash] = useState('');\n  const [password, setPassword] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [authStatus, setAuthStatus] = useState<AuthStatus>({ isAuthenticated: false });\n  const { toast } = useToast();\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏\n  useEffect(() => {\n    if (open) {\n      checkAuthStatus();\n    }\n  }, [open]);\n\n  const checkAuthStatus = async () => {\n    try {\n      const response = await fetch('/api/telegram-auth/status');\n      const status = await response.json();\n      setAuthStatus(status);\n      \n      if (status.isAuthenticated) {\n        toast({\n          title: \"–£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω\",\n          description: `–í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ ${status.phoneNumber}`,\n        });\n        onSuccess();\n        onOpenChange(false);\n      } else if (status.hasCredentials) {\n        // –ï—Å–ª–∏ credentials –µ—Å—Ç—å, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ç–µ–ª–µ—Ñ–æ–Ω—É\n        setStep('phone');\n      } else {\n        // –ï—Å–ª–∏ credentials –Ω–µ—Ç, –æ—Å—Ç–∞–µ–º—Å—è –Ω–∞ —à–∞–≥–µ –≤–≤–æ–¥–∞ credentials\n        setStep('credentials');\n      }\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);\n    }\n  };\n\n  const saveCredentials = async () => {\n    if (!apiId.trim() || !apiHash.trim()) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–í–≤–µ–¥–∏—Ç–µ API ID –∏ API Hash\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await apiRequest('POST', '/api/telegram-auth/save-credentials', { \n        apiId: apiId.trim(), \n        apiHash: apiHash.trim() \n      });\n\n      if (response.success) {\n        setStep('phone');\n        toast({\n          title: \"Credentials —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã\",\n          description: \"–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞\",\n        });\n      } else {\n        toast({\n          title: \"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\",\n          description: response.error || \"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å credentials\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const sendCode = async () => {\n    if (!phoneNumber.trim()) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await apiRequest('POST', '/api/telegram-auth/send-code', { phoneNumber: phoneNumber.trim() });\n\n      if (response.success) {\n        setPhoneCodeHash(response.phoneCodeHash);\n        setStep('code');\n        toast({\n          title: \"–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω\",\n          description: `–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SMS –Ω–∞ –Ω–æ–º–µ—Ä–µ ${phoneNumber}`,\n        });\n      } else {\n        toast({\n          title: \"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞\",\n          description: response.error || \"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const verifyCode = async () => {\n    if (!phoneCode.trim()) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await apiRequest('POST', '/api/telegram-auth/verify-code', {\n        phoneNumber: phoneNumber.trim(),\n        phoneCode: phoneCode.trim(),\n        phoneCodeHash\n      });\n\n      if (response.success) {\n        toast({\n          title: \"–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞\",\n          description: \"–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã\",\n        });\n        onSuccess();\n        onOpenChange(false);\n      } else if (response.needsPassword) {\n        setStep('password');\n        toast({\n          title: \"–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å 2FA\",\n          description: \"–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏\",\n        });\n      } else {\n        toast({\n          title: \"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\",\n          description: response.error || \"–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const verifyPassword = async () => {\n    if (!password.trim()) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await apiRequest('POST', '/api/telegram-auth/verify-password', {\n        password: password.trim()\n      });\n\n      if (response.success) {\n        toast({\n          title: \"–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞\",\n          description: \"–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞\",\n        });\n        onSuccess();\n        onOpenChange(false);\n      } else {\n        toast({\n          title: \"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\",\n          description: response.error || \"–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"–û—à–∏–±–∫–∞\",\n        description: \"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent, action: () => void) => {\n    if (e.key === 'Enter' && !isLoading) {\n      action();\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Shield className=\"h-5 w-5 text-blue-600\" />\n            –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Telegram Client API\n          </DialogTitle>\n          <DialogDescription>\n            –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {step === 'credentials' ? (\n            <>\n              <div className=\"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                <Shield className=\"h-8 w-8 text-blue-600 mx-auto mb-2\" />\n                <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                  –í–≤–µ–¥–∏—Ç–µ API credentials –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram\n                </p>\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"apiId\">API ID</Label>\n                  <Input\n                    id=\"apiId\"\n                    placeholder=\"12345678\"\n                    value={apiId}\n                    onChange={(e) => setApiId(e.target.value)}\n                    onKeyPress={(e) => handleKeyPress(e, saveCredentials)}\n                    disabled={isLoading}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    –ü–æ–ª—É—á–∏—Ç–µ –Ω–∞ my.telegram.org –≤ —Ä–∞–∑–¥–µ–ª–µ API Development Tools\n                  </p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"apiHash\">API Hash</Label>\n                  <Input\n                    id=\"apiHash\"\n                    placeholder=\"abcdef1234567890abcdef1234567890\"\n                    value={apiHash}\n                    onChange={(e) => setApiHash(e.target.value)}\n                    onKeyPress={(e) => handleKeyPress(e, saveCredentials)}\n                    disabled={isLoading}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    32-—Å–∏–º–≤–æ–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–∑ my.telegram.org\n                  </p>\n                </div>\n              </div>\n\n              <Button \n                onClick={saveCredentials} \n                disabled={isLoading || !apiId.trim() || !apiHash.trim()}\n                className=\"w-full\"\n              >\n                {isLoading ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                    –°–æ—Ö—Ä–∞–Ω—è–µ–º...\n                  </>\n                ) : (\n                  '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å credentials'\n                )}\n              </Button>\n            </>\n          ) : step === 'phone' ? (\n            <>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</Label>\n                <div className=\"flex items-center space-x-2\">\n                  <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"phone\"\n                    placeholder=\"+7 xxx xxx xxxx\"\n                    value={phoneNumber}\n                    onChange={(e) => setPhoneNumber(e.target.value)}\n                    onKeyPress={(e) => handleKeyPress(e, sendCode)}\n                    disabled={isLoading}\n                  />\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ\n                </p>\n              </div>\n\n              <Button \n                onClick={sendCode} \n                disabled={isLoading || !phoneNumber.trim()}\n                className=\"w-full\"\n              >\n                {isLoading ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                    –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥...\n                  </>\n                ) : (\n                  '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥'\n                )}\n              </Button>\n            </>\n          ) : step === 'code' ? (\n            <>\n              <div className=\"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-600 mx-auto mb-2\" />\n                <p className=\"text-sm text-green-700 dark:text-green-300\">\n                  –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –Ω–æ–º–µ—Ä <Badge variant=\"outline\">{phoneNumber}</Badge>\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"code\">–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</Label>\n                <Input\n                  id=\"code\"\n                  placeholder=\"12345\"\n                  value={phoneCode}\n                  onChange={(e) => setPhoneCode(e.target.value)}\n                  onKeyPress={(e) => handleKeyPress(e, verifyCode)}\n                  disabled={isLoading}\n                  maxLength={5}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  –í–≤–µ–¥–∏—Ç–µ 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∏–∑ SMS\n                </p>\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button \n                  variant=\"outline\" \n                  onClick={() => setStep('phone')}\n                  disabled={isLoading}\n                  className=\"flex-1\"\n                >\n                  –ù–∞–∑–∞–¥\n                </Button>\n                <Button \n                  onClick={verifyCode} \n                  disabled={isLoading || !phoneCode.trim()}\n                  className=\"flex-1\"\n                >\n                  {isLoading ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      –ü—Ä–æ–≤–µ—Ä—è–µ–º...\n                    </>\n                  ) : (\n                    '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å'\n                  )}\n                </Button>\n              </div>\n            </>\n          ) : (\n            <>\n              <div className=\"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                <Lock className=\"h-8 w-8 text-blue-600 mx-auto mb-2\" />\n                <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                  –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">–ü–∞—Ä–æ–ª—å 2FA</Label>\n                <div className=\"flex items-center space-x-2\">\n                  <Lock className=\"h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"password\"\n                    type=\"password\"\n                    placeholder=\"–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    onKeyPress={(e) => handleKeyPress(e, verifyPassword)}\n                    disabled={isLoading}\n                  />\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Telegram\n                </p>\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button \n                  variant=\"outline\" \n                  onClick={() => setStep('code')}\n                  disabled={isLoading}\n                  className=\"flex-1\"\n                >\n                  –ù–∞–∑–∞–¥\n                </Button>\n                <Button \n                  onClick={verifyPassword} \n                  disabled={isLoading || !password.trim()}\n                  className=\"flex-1\"\n                >\n                  {isLoading ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      –ê–≤—Ç–æ—Ä–∏–∑—É–µ–º—Å—è...\n                    </>\n                  ) : (\n                    '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å'\n                  )}\n                </Button>\n              </div>\n            </>\n          )}\n\n          <div className=\"text-xs text-muted-foreground space-y-1\">\n            <p>‚Ä¢ –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø</p>\n            <p>‚Ä¢ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏</p>\n            <p>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Telegram Client API</p>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":16291},"SETUP.md":{"content":"# üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞\n\n–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Telegram Bot Builder –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.\n\n## üìã –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è\n\n- **Node.js** 18.0.0+ (LTS —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)\n- **PostgreSQL** 13+ \n- **Python** 3.11+ (–¥–ª—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –±–æ—Ç–æ–≤)\n- **Git** (–¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)\n\n---\n\n## üñ• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Windows\n\n### 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π\n\n**Node.js:**\n1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://nodejs.org/\n2. –°–∫–∞—á–∞–π—Ç–µ **LTS –≤–µ—Ä—Å–∏—é** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)\n3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n4. **–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏\n\n**PostgreSQL:**\n1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://www.postgresql.org/download/windows/\n2. –°–∫–∞—á–∞–π—Ç–µ PostgreSQL installer\n3. –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:\n   - **–ó–∞–ø–æ–º–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `postgres`\n   - –û—Å—Ç–∞–≤—å—Ç–µ –ø–æ—Ä—Ç **5432**\n   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pgAdmin 4 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)\n\n**Python (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**\n1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://python.org/downloads/\n2. –°–∫–∞—á–∞–π—Ç–µ Python 3.11+\n3. –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–º–µ—Ç—å—Ç–µ \"Add Python to PATH\"\n\n### 2Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n\n**–ß–µ—Ä–µ–∑ pgAdmin 4:**\n1. –û—Ç–∫—Ä–æ–π—Ç–µ **pgAdmin 4**\n2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É (–≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å postgres)\n3. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:\n   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ \"Databases\" ‚Üí Create ‚Üí Database\n   - –ò–º—è: `telegram_bot_builder`\n4. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):\n   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ \"Login/Group Roles\" ‚Üí Create ‚Üí Login/Group Role\n   - General: –ò–º—è `bot_user`\n   - Definition: –ü–∞—Ä–æ–ª—å `your_secure_password`\n   - Privileges: ‚úÖ Can login?, ‚úÖ Superuser?\n\n**–ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É:**\n```powershell\n# –í PowerShell (–∑–∞–º–µ–Ω–∏—Ç–µ \"–≤–∞—à_–ø–∞—Ä–æ–ª—å\"):\n$env:PGPASSWORD=\"–≤–∞—à_–ø–∞—Ä–æ–ª—å\"\n& \"C:\\Program Files\\PostgreSQL\\17\\bin\\psql.exe\" -U postgres -c \"CREATE DATABASE telegram_bot_builder;\"\n```\n\n### 3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞\n\n```cmd\n# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π\ngit clone https://github.com/yourusername/telegram-bot-builder.git\ncd telegram-bot-builder\n\n# 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\ncopy .env.example .env\n\n# 3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\nnotepad .env\n```\n\n**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env —Ñ–∞–π–ª–µ:**\n```env\n# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\nNODE_ENV=development\nPORT=5000\n\n# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ)\nDATABASE_URL=postgresql://postgres:–≤–∞—à_–ø–∞—Ä–æ–ª—å@localhost:5432/telegram_bot_builder\n\n# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ\nPGHOST=localhost\nPGPORT=5432\nPGUSER=postgres\nPGPASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å\nPGDATABASE=telegram_bot_builder\n```\n\n```cmd\n# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏\nnpm install\n\n# 5. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö\nnpm run db:push\n```\n\n### 4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞\n\n**–°–ø–æ—Å–æ–± 1 - PowerShell (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø):**\n```powershell\n$env:NODE_ENV=\"development\"; tsx server/index.ts\n```\n\n**–°–ø–æ—Å–æ–± 2 - CMD:**\n```cmd\nnpm run dev\n```\n\n**–°–ø–æ—Å–æ–± 3 - –°–æ–∑–¥–∞–π—Ç–µ bat —Ñ–∞–π–ª:**\n–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `start.bat`:\n```batch\n@echo off\nset NODE_ENV=development\nnpx tsx server/index.ts\npause\n```\n\n### 5Ô∏è‚É£ –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä\n\n–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:5000**\n\n---\n\n## üêß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Linux/macOS\n\n### Ubuntu/Debian\n\n```bash\n# –û–±–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É\nsudo apt update && sudo apt upgrade -y\n\n# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js\ncurl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -\nsudo apt-get install -y nodejs\n\n# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL\nsudo apt install postgresql postgresql-contrib\n\n# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ PostgreSQL\nsudo -u postgres createdb telegram_bot_builder\nsudo -u postgres psql -c \"ALTER USER postgres PASSWORD 'your_password';\"\n\n# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç\ngit clone https://github.com/yourusername/telegram-bot-builder.git\ncd telegram-bot-builder\ncp .env.example .env\n# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª\nnano .env\n\n# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ\nnpm install\nnpm run db:push\nnpm run dev\n```\n\n### macOS\n\n```bash\n# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Homebrew (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n\n# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏\nbrew install node postgresql\n\n# –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL\nbrew services start postgresql\n\n# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\ncreatedb telegram_bot_builder\n\n# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç\ngit clone https://github.com/yourusername/telegram-bot-builder.git\ncd telegram-bot-builder\ncp .env.example .env\n# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª\n\n# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ\nnpm install\nnpm run db:push\nnpm run dev\n```\n\n---\n\n## üê≥ Docker —É—Å—Ç–∞–Ω–æ–≤–∫–∞\n\n```bash\n# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π\ngit clone https://github.com/yourusername/telegram-bot-builder.git\ncd telegram-bot-builder\n\n# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å Docker Compose\ndocker-compose up -d\n\n# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏\ndocker-compose exec app npm run db:push\n```\n\n**docker-compose.yml:**\n```yaml\nversion: '3.8'\nservices:\n  app:\n    build: .\n    ports:\n      - \"5000:5000\"\n    depends_on:\n      - postgres\n    environment:\n      - NODE_ENV=development\n      - DATABASE_URL=postgresql://postgres:password@postgres:5432/telegram_bot_builder\n\n  postgres:\n    image: postgres:15\n    environment:\n      - POSTGRES_DB=telegram_bot_builder\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - \"5432:5432\"\n\nvolumes:\n  postgres_data:\n```\n\n---\n\n## üîß –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞\n\n```bash\n# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞\nnpm run dev              # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏\nnpm run build            # –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞\nnpm run start            # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω –≤–µ—Ä—Å–∏–∏\nnpm run check            # –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript\n\n# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö\nnpm run db:push          # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã\nnpm run db:pull          # –ü–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É –∏–∑ –ë–î\nnpm run db:generate      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π\nnpm run db:migrate       # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏\n\n# –£—Ç–∏–ª–∏—Ç—ã\nnpm run lint             # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞\nnpm run format           # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞\nnpm test                 # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤\n```\n\n---\n\n## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º\n\n### Windows —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã\n\n**\"node –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫–æ–º–∞–Ω–¥–æ–π\"**\n```cmd\n# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É\n# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É\nnode --version\nnpm --version\n```\n\n**\"npm run db:push\" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**\n1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω (services.msc ‚Üí postgresql)\n2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`\n3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `psql -U postgres -d telegram_bot_builder`\n\n**–ü–æ—Ä—Ç 5000 —É–∂–µ –∑–∞–Ω—è—Ç**\n```cmd\n# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å\nnetstat -ano | findstr 5000\n# –ó–∞–≤–µ—Ä—à–∏—Ç–µ –µ–≥–æ (–∑–∞–º–µ–Ω–∏—Ç–µ 1234 –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π PID)\ntaskkill /PID 1234 /F\n```\n\n**–û—à–∏–±–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞**\n- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ PowerShell\n\n### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã\n\n**–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**\n```bash\n# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL\n# Linux/macOS:\nsudo systemctl status postgresql\n# –∏–ª–∏\nbrew services list | grep postgres\n\n# Windows:\nservices.msc ‚Üí –Ω–∞–π–¥–∏—Ç–µ postgresql\n\n# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ\npsql -U postgres -d telegram_bot_builder -h localhost\n```\n\n**–û—à–∏–±–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤**\n```bash\n# –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à npm\nnpm cache clean --force\n\n# –£–¥–∞–ª–∏—Ç–µ node_modules –∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ\nrm -rf node_modules package-lock.json\nnpm install\n\n# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ (Linux/macOS)\nsudo chown -R $(whoami) ~/.npm\n```\n\n**–û—à–∏–±–∫–∏ TypeScript**\n```bash\n# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Node.js\nnode --version  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 18+\n\n# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ TypeScript\nnpm install -g typescript\nnpm run check\n```\n\n### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å\n\n**–ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞**\n- –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ RAM PostgreSQL –≤ `postgresql.conf`\n- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSD –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö\n\n**–ë–æ–ª—å—à–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã**\n- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (AWS S3, Cloudinary)\n- –ò–∑–º–µ–Ω–∏—Ç–µ –ª–∏–º–∏—Ç—ã –≤ `server/routes.ts`\n\n---\n\n## üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n\n### –ü—Ä–æ–¥–∞–∫—à–Ω —Å—Ä–µ–¥–∞\n\n```bash\n# –°–æ–∑–¥–∞–π—Ç–µ .env.production\nNODE_ENV=production\nDATABASE_URL=postgresql://secure_user:secure_pass@localhost:5432/bot_builder_prod\nSESSION_SECRET=your_very_long_random_string\n```\n\n### PostgreSQL –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n\n```sql\n-- –°–æ–∑–¥–∞–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nCREATE USER bot_builder_user WITH PASSWORD 'secure_password';\nGRANT CONNECT ON DATABASE telegram_bot_builder TO bot_builder_user;\nGRANT USAGE ON SCHEMA public TO bot_builder_user;\nGRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO bot_builder_user;\n```\n\n### –§–∞–π—Ä–≤–æ–ª\n\n```bash\n# –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ PostgreSQL\nsudo ufw allow from your_app_server_ip to any port 5432\n\n# –ò–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø\nsudo ufw deny 5432\n```\n\n---\n\n## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥\n\n### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\n\n```bash\n# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏\ntail -f logs/app.log\n\n# –õ–æ–≥–∏ PostgreSQL\n# Linux: /var/log/postgresql/\n# macOS: /usr/local/var/log/\n# Windows: C:\\Program Files\\PostgreSQL\\xx\\data\\log\\\n```\n\n### –ú–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\n\n```sql\n-- –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö\nSELECT pg_size_pretty(pg_database_size('telegram_bot_builder'));\n\n-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\nSELECT count(*) FROM pg_stat_activity;\n\n-- –°–∞–º—ã–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã\nSELECT query, mean_time, calls FROM pg_stat_statements ORDER BY mean_time DESC LIMIT 10;\n```\n\n---\n\nüí° **–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥—Ä–æ–±–Ω–æ –≤ [GitHub Issues](https://github.com/yourusername/telegram-bot-builder/issues) - –º—ã –ø–æ–º–æ–∂–µ–º —Ä–µ—à–∏—Ç—å –ª—é–±—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏!","size_bytes":11208},"client/src/hooks/use-media-query.ts":{"content":"import { useState, useEffect } from 'react';\n\nexport function useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState<boolean>(() => {\n    if (typeof window !== 'undefined') {\n      return window.matchMedia(query).matches;\n    }\n    return false;\n  });\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = (e: MediaQueryListEvent) => setMatches(e.matches);\n    media.addEventListener('change', listener);\n    \n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}","size_bytes":603},"client/src/components/server-status.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\nimport { RefreshCw, CheckCircle, AlertCircle, Loader2 } from 'lucide-react';\n\ninterface ServerHealthStatus {\n  database: boolean;\n  templates: boolean;\n  telegram: boolean;\n  ready: boolean;\n}\n\nexport function ServerStatus() {\n  const [status, setStatus] = useState<ServerHealthStatus | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n\n  const checkHealth = async () => {\n    try {\n      const response = await fetch('/api/health');\n      const data = await response.json();\n      setStatus(data);\n      \n      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–æ–≥–¥–∞ –≤—Å–µ –≥–æ—Ç–æ–≤–æ\n      if (data.ready) {\n        setTimeout(() => setIsVisible(false), 2000);\n      }\n    } catch (error) {\n      console.error('Health check failed:', error);\n      // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ\n      setTimeout(checkHealth, 2000);\n    }\n  };\n\n  useEffect(() => {\n    checkHealth();\n    \n    // –¢–æ–ª—å–∫–æ –¥–µ–ª–∞–µ–º –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –¥–∞–ª—å—à–µ –ø–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ\n    let interval: NodeJS.Timeout | null = null;\n    \n    if (!status?.ready) {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –≥–æ—Ç–æ–≤\n      interval = setInterval(checkHealth, 5000);\n    }\n    \n    return () => {\n      if (interval) {\n        clearInterval(interval);\n      }\n    };\n  }, [status?.ready]);\n\n  // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –∏–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∏ –ø—Ä–æ—à–ª–æ –≤—Ä–µ–º—è\n  if (!status || (!isVisible && status.ready)) {\n    return null;\n  }\n\n  // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ —É–∂–µ –≤—Å–µ –≥–æ—Ç–æ–≤–æ\n  if (status.ready && isVisible) {\n    return (\n      <Alert className=\"fixed top-4 right-4 w-80 z-50 border-green-200 bg-green-50 dark:bg-green-950\">\n        <CheckCircle className=\"h-4 w-4 text-green-600\" />\n        <AlertDescription className=\"text-green-800 dark:text-green-200\">\n          –°–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!\n        </AlertDescription>\n      </Alert>\n    );\n  }\n\n  return (\n    <Alert className=\"fixed top-4 right-4 w-80 z-50\">\n      <Loader2 className=\"h-4 w-4 animate-spin\" />\n      <AlertDescription>\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"font-medium\">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞...</span>\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={checkHealth}\n              className=\"h-6 w-6 p-0\"\n            >\n              <RefreshCw className=\"h-3 w-3\" />\n            </Button>\n          </div>\n          \n          <div className=\"space-y-1 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              {status.database ? (\n                <CheckCircle className=\"h-3 w-3 text-green-600\" />\n              ) : (\n                <Loader2 className=\"h-3 w-3 animate-spin text-orange-500\" />\n              )}\n              <span className={status.database ? 'text-green-700 dark:text-green-300' : 'text-orange-600 dark:text-orange-400'}>\n                –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö\n              </span>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              {status.templates ? (\n                <CheckCircle className=\"h-3 w-3 text-green-600\" />\n              ) : (\n                <Loader2 className=\"h-3 w-3 animate-spin text-orange-500\" />\n              )}\n              <span className={status.templates ? 'text-green-700 dark:text-green-300' : 'text-orange-600 dark:text-orange-400'}>\n                –®–∞–±–ª–æ–Ω—ã\n              </span>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              {status.telegram ? (\n                <CheckCircle className=\"h-3 w-3 text-green-600\" />\n              ) : (\n                <Loader2 className=\"h-3 w-3 animate-spin text-orange-500\" />\n              )}\n              <span className={status.telegram ? 'text-green-700 dark:text-green-300' : 'text-orange-600 dark:text-orange-400'}>\n                Telegram\n              </span>\n            </div>\n          </div>\n          \n          {!status.ready && (\n            <div className=\"text-xs text-muted-foreground mt-2\">\n              –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã\n            </div>\n          )}\n        </div>\n      </AlertDescription>\n    </Alert>\n  );\n}","size_bytes":4708},"client/src/pages/templates-wrapper.tsx":{"content":"import React, { useState, useMemo } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Loader2, Search, Download, Eye, ArrowLeft, Star } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { format } from 'date-fns';\nimport { ru } from 'date-fns/locale';\nimport type { BotTemplate } from '@shared/schema';\n\n// –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —à–∞–±–ª–æ–Ω–æ–≤ –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –º–∞–∫–µ—Ç–æ–≤\nexport default function TemplatesPageWrapper() {\n  const [, setLocation] = useLocation();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [currentTab, setCurrentTab] = useState('all');\n  const [sortBy, setSortBy] = useState<'popular' | 'rating' | 'recent' | 'name'>('popular');\n  const { toast } = useToast();\n\n  const { data: templates = [], isLoading } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates'],\n  });\n\n  const { data: featuredTemplates = [], isLoading: isLoadingFeatured } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates/featured'],\n    enabled: currentTab === 'featured',\n  });\n\n  const { data: myTemplates = [], isLoading: isLoadingMy } = useQuery<BotTemplate[]>({\n    queryKey: ['/api/templates/category/custom'],\n  });\n\n  const categories = [\n    { value: 'all', label: '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' },\n    { value: 'official', label: '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ' },\n    { value: 'community', label: '–°–æ–æ–±—â–µ—Å—Ç–≤–æ' },\n    { value: 'business', label: '–ë–∏–∑–Ω–µ—Å' },\n    { value: 'entertainment', label: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è' },\n    { value: 'education', label: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ' },\n    { value: 'utility', label: '–£—Ç–∏–ª–∏—Ç—ã' },\n    { value: 'games', label: '–ò–≥—Ä—ã' }\n  ];\n\n  const filteredAndSortedTemplates = useMemo(() => {\n    let currentTemplates = templates;\n    \n    if (currentTab === 'featured') {\n      currentTemplates = featuredTemplates;\n    } else if (currentTab === 'popular') {\n      currentTemplates = templates.filter(t => (t.useCount || 0) > 5);\n    } else if (currentTab === 'my') {\n      currentTemplates = myTemplates;\n    }\n\n    if (searchTerm) {\n      currentTemplates = currentTemplates.filter(template =>\n        template.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        template.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        template.tags?.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))\n      );\n    }\n\n    if (selectedCategory !== 'all') {\n      currentTemplates = currentTemplates.filter(template => template.category === selectedCategory);\n    }\n\n    const sorted = [...currentTemplates].sort((a, b) => {\n      switch (sortBy) {\n        case 'popular':\n          return (b.useCount || 0) - (a.useCount || 0);\n        case 'rating':\n          return (b.rating || 0) - (a.rating || 0);\n        case 'recent':\n          return new Date(b.createdAt || 0).getTime() - new Date(a.createdAt || 0).getTime();\n        case 'name':\n          return a.name.localeCompare(b.name, 'ru');\n        default:\n          return 0;\n      }\n    });\n\n    return sorted;\n  }, [templates, featuredTemplates, myTemplates, currentTab, searchTerm, selectedCategory, sortBy]);\n\n  const useTemplateMutation = useMutation({\n    mutationFn: async (templateId: number) => {\n      const response = await fetch(`/api/templates/${templateId}/use`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to increment use count');\n      return response.json();\n    },\n  });\n\n  const handleUseTemplate = (template: BotTemplate) => {\n    useTemplateMutation.mutate(template.id);\n    localStorage.setItem('selectedTemplate', JSON.stringify(template));\n    setLocation('/');\n    \n    toast({\n      title: '–®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω!',\n      description: `–®–∞–±–ª–æ–Ω \"${template.name}\" –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ –≤–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É`,\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* –®–∞–ø–∫–∞ */}\n      <div className=\"border-b bg-background\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-4\">\n              <Link to=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                  –ù–∞–∑–∞–¥ –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É\n                </Button>\n              </Link>\n              <h1 className=\"text-2xl font-bold\">–®–∞–±–ª–æ–Ω—ã –±–æ—Ç–æ–≤</h1>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ */}\n      <div className=\"container mx-auto px-4 py-6\">\n        <div className=\"flex flex-col lg:flex-row gap-6\">\n          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}\n          <div className=\"flex-1\">\n            <div className=\"space-y-4\">\n              {/* –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã */}\n              <div className=\"flex flex-col sm:flex-row gap-4\">\n                <div className=\"relative flex-1\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n                  <Input\n                    placeholder=\"–ü–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–æ–≤...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n                <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n                  <SelectTrigger className=\"w-full sm:w-48\">\n                    <SelectValue placeholder=\"–ö–∞—Ç–µ–≥–æ—Ä–∏—è\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {categories.map((category) => (\n                      <SelectItem key={category.value} value={category.value}>\n                        {category.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Select value={sortBy} onValueChange={(value: any) => setSortBy(value)}>\n                  <SelectTrigger className=\"w-full sm:w-40\">\n                    <SelectValue placeholder=\"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"popular\">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</SelectItem>\n                    <SelectItem value=\"rating\">–†–µ–π—Ç–∏–Ω–≥</SelectItem>\n                    <SelectItem value=\"recent\">–ù–æ–≤—ã–µ</SelectItem>\n                    <SelectItem value=\"name\">–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* –í–∫–ª–∞–¥–∫–∏ */}\n              <Tabs value={currentTab} onValueChange={setCurrentTab}>\n                <TabsList>\n                  <TabsTrigger value=\"all\">–í—Å–µ</TabsTrigger>\n                  <TabsTrigger value=\"featured\">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ</TabsTrigger>\n                  <TabsTrigger value=\"popular\">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</TabsTrigger>\n                  <TabsTrigger value=\"my\">–ú–æ–∏</TabsTrigger>\n                </TabsList>\n\n                {/* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */}\n                <TabsContent value=\"all\" className=\"mt-4\">\n                  <TemplateGrid templates={filteredAndSortedTemplates} isLoading={isLoading} onUse={handleUseTemplate} />\n                </TabsContent>\n                \n                <TabsContent value=\"featured\" className=\"mt-4\">\n                  <TemplateGrid templates={filteredAndSortedTemplates} isLoading={isLoadingFeatured} onUse={handleUseTemplate} />\n                </TabsContent>\n                \n                <TabsContent value=\"popular\" className=\"mt-4\">\n                  <TemplateGrid templates={filteredAndSortedTemplates} isLoading={isLoading} onUse={handleUseTemplate} />\n                </TabsContent>\n                \n                <TabsContent value=\"my\" className=\"mt-4\">\n                  <TemplateGrid templates={filteredAndSortedTemplates} isLoading={isLoadingMy} onUse={handleUseTemplate} />\n                </TabsContent>\n              </Tabs>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–µ—Ç–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤\nfunction TemplateGrid({ templates, isLoading, onUse }: { \n  templates: BotTemplate[], \n  isLoading: boolean, \n  onUse: (template: BotTemplate) => void \n}) {\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (templates.length === 0) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-muted-foreground\">–®–∞–±–ª–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n      {templates.map((template) => (\n        <Card key={template.id} className=\"hover:shadow-lg transition-shadow\">\n          <CardHeader>\n            <div className=\"flex items-start justify-between\">\n              <div>\n                <CardTitle className=\"text-lg\">{template.name}</CardTitle>\n                {template.description && (\n                  <CardDescription className=\"mt-1\">{template.description}</CardDescription>\n                )}\n              </div>\n              {template.rating && template.rating > 0 && (\n                <div className=\"flex items-center gap-1\">\n                  <Star className=\"h-4 w-4 fill-yellow-500 text-yellow-500\" />\n                  <span className=\"text-sm font-medium\">{template.rating.toFixed(1)}</span>\n                </div>\n              )}\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Eye className=\"h-4 w-4\" />\n                <span>{template.viewCount || 0}</span>\n                <Download className=\"h-4 w-4 ml-2\" />\n                <span>{template.downloadCount || 0}</span>\n              </div>\n              <Button size=\"sm\" onClick={() => onUse(template)}>\n                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n}","size_bytes":10945},"server/cache.ts":{"content":"// –ü—Ä–æ—Å—Ç–æ–π in-memory –∫–µ—à –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n  ttl: number; // time to live –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö\n}\n\nclass SimpleCache {\n  private cache = new Map<string, CacheEntry<any>>();\n\n  set<T>(key: string, data: T, ttlMs: number = 60000): void {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now(),\n      ttl: ttlMs\n    });\n  }\n\n  get<T>(key: string): T | null {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n\n    const now = Date.now();\n    const isExpired = now - entry.timestamp > entry.ttl;\n    \n    if (isExpired) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return entry.data as T;\n  }\n\n  delete(key: string): boolean {\n    return this.cache.delete(key);\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n\n  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π\n  cleanup(): void {\n    const now = Date.now();\n    for (const [key, entry] of Array.from(this.cache.entries())) {\n      if (now - entry.timestamp > entry.ttl) {\n        this.cache.delete(key);\n      }\n    }\n  }\n\n  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞\n  getStats() {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys())\n    };\n  }\n}\n\nexport const serverCache = new SimpleCache();\n\n// –ó–∞–ø—É—Å–∫–∞–µ–º –æ—á–∏—Å—Ç–∫—É –∫–µ—à–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç\nsetInterval(() => {\n  serverCache.cleanup();\n}, 5 * 60 * 1000);\n\n// –•–µ–ª–ø–µ—Ä –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π\nexport function getCachedOrExecute<T>(\n  key: string,\n  fn: () => Promise<T>,\n  ttlMs: number = 60000\n): Promise<T> {\n  const cached = serverCache.get<T>(key);\n  if (cached !== null) {\n    return Promise.resolve(cached);\n  }\n\n  return fn().then(result => {\n    serverCache.set(key, result, ttlMs);\n    return result;\n  });\n}","size_bytes":1868}},"version":1}