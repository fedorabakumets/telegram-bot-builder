# Migrations

Миграции базы данных для проекта Telegram Bot Builder.

## Структура

### Файлы миграций
- `0000_brainy_wildside.sql` - начальная миграция, создание основных таблиц
- `0001_optimal_puff_adder.sql` - дополнительные таблицы и индексы
- `0001_add_google_sheet_export_fields.sql` - добавление полей для экспорта в Google Таблицы
- `relations.ts` - определение связей между таблицами
- `schema.ts` - схема базы данных для миграций

### Метаданные
- `meta/` - папка с метаданными миграций
  - `_journal.json` - журнал выполненных миграций
  - `0000_snapshot.json` - снимок схемы после первой миграции
  - `0001_snapshot.json` - снимок схемы после второй миграции

## Основные таблицы

### Пользователи и аутентификация
- `users` - основная таблица пользователей
- `sessions` - сессии пользователей

### Боты и шаблоны
- `bots` - созданные пользователями боты
- `templates` - шаблоны ботов
- `bot_nodes` - узлы в визуальном конструкторе
- `bot_connections` - связи между узлами

### Файлы и медиа
- `files` - загруженные файлы
- `media` - медиафайлы ботов

### Настройки и конфигурация
- `bot_settings` - настройки ботов
- `user_preferences` - пользовательские настройки

## Команды для работы с миграциями

### Создание новой миграции
```bash
npm run db:generate
```

### Применение миграций
```bash
npm run db:migrate
```

### Откат миграции
```bash
npm run db:rollback
```

### Просмотр статуса миграций
```bash
npm run db:status
```

## Технологии

- **Drizzle Kit** - инструмент для создания и управления миграциями
- **PostgreSQL** - основная база данных
- **SQL** - язык запросов для миграций

## Правила работы с миграциями

1. **Никогда не изменяйте существующие миграции** - создавайте новые
2. **Тестируйте миграции** на локальной базе перед применением в продакшене
3. **Делайте резервные копии** перед применением миграций в продакшене
4. **Используйте транзакции** для сложных миграций
5. **Документируйте изменения** в комментариях к миграциям