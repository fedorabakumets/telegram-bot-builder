import{t as p,b as v}from"./utils-DjgfDMXY.js";import{j as l}from"./jsx-runtime-ikxUOHmY.js";import{r as i,R as h}from"./iframe-C_0L0_58.js";function E(...e){return p(v(e))}function w(e,t){if(e===t)return!0;if(typeof e!="object"||typeof t!="object"||e===null||t===null)return!1;const o=Object.keys(e),n=Object.keys(t);if(o.length!==n.length)return!1;for(const r of o)if(!(r in t)||e[r]!==t[r])return!1;return!0}function g({displayName:e="OptimizedContext",defaultValue:t,isEqual:o=w}={}){const n=i.createContext(t);n.displayName=e;const r=h.memo(({value:s,children:a})=>{const c=i.useMemo(()=>s,[s]);return l.jsx(n.Provider,{value:c,children:a})},(s,a)=>o(s.value,a.value)&&s.children===a.children);return r.displayName=`${e}Provider`,{Context:n,Provider:r,useContext:()=>{const s=i.useContext(n);if(s===void 0)throw new Error(`use${e} must be used within a ${e}Provider`);return s}}}function T(e,t){return i.useMemo(e,t)}function b(e,t){return i.useCallback(e,t)}const{Provider:C}=g({displayName:"Theme",isEqual:(e,t)=>e.theme===t.theme&&e.resolvedTheme===t.resolvedTheme&&e.systemTheme===t.systemTheme&&e.setTheme===t.setTheme});function k(){const[e,t]=i.useState(()=>typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");return i.useEffect(()=>{if(typeof window>"u")return;const o=window.matchMedia("(prefers-color-scheme: dark)"),n=r=>{t(r.matches?"dark":"light")};return o.addEventListener("change",n),()=>o.removeEventListener("change",n)},[]),e}const f=h.memo(({children:e,defaultTheme:t="system",storageKey:o="telegram-bot-builder-theme",...n})=>{const r=k(),[m,s]=i.useState(()=>{if(typeof window>"u")return t;try{return localStorage.getItem(o)||t}catch{return t}}),a=i.useMemo(()=>m==="system"?r:m,[m,r]),c=b(d=>{try{localStorage.setItem(o,d)}catch(u){console.warn("Failed to save theme to localStorage:",u)}s(d)},[o]);i.useEffect(()=>{const u=window.document.documentElement.classList;u.contains(a)||requestAnimationFrame(()=>{u.remove("light","dark"),u.add(a)})},[a]);const y=T(()=>({theme:m,setTheme:c,resolvedTheme:a,systemTheme:r}),[m,c,a,r]);return l.jsx(C,{value:y,...n,children:e})});f.displayName="ThemeProvider";f.__docgenInfo={description:`Optimized ThemeProvider with performance enhancements\r
\r
Features:\r
- Memoized context values to prevent unnecessary re-renders\r
- Stable callback references\r
- System theme detection with proper cleanup\r
- Optimized DOM manipulation\r
- Better error handling and type safety`,methods:[],displayName:"ThemeProvider",props:{defaultTheme:{defaultValue:{value:'"system"',computed:!1},required:!1},storageKey:{defaultValue:{value:'"telegram-bot-builder-theme"',computed:!1},required:!1}}};export{E as c};
