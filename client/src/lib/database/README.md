# Папка `client/src/lib/database`

Эта папка содержит модули, связанные с базой данных для генерации Python-кода, реализующего различные функции взаимодействия с базой данных.

## Файлы

### `AliasNodes.ts`
Генерирует Python-код для алиасов функций, используемых в callback обработчиках. Создает алиасы для команд, начинающихся с `/`, и позволяет использовать их в обработчиках.

### `generateDatabaseCode.ts`
Основной модуль, который генерирует код, связанный с базой данных. Он объединяет все остальные модули и создает полный Python-код для работы с базой данных, включая инициализацию, сохранение, обновление и получение данных пользователей, а также вспомогательные функции для работы с переменными и логирования.

### `generateUniversalVariableReplacement.1.ts`
Функция для замены переменных в тексте на их значения. Поддерживает форматы `{{variable}}` и `{variable}`. Если переменная не найдена, возвращает оригинальное совпадение.

### `generateUniversalVariableReplacement.ts`
Генерирует Python-код для универсальной замены переменных в тексте. Использует функцию из `replace_variables_in_text.ts` для замены переменных в тексте.

### `generateVariableReplacement.ts`
Генерирует строку замены для переменной. Просто преобразует значение переменной в строку.

### `get_moscow_time.ts`
Генерирует Python-код для функции получения текущего времени в московском часовом поясе. Возвращает время в формате ISO 8601.

### `get_user_data_from_db.ts`
Генерирует Python-код для функции получения конкретного значения из поля `user_data` пользователя. Использует оператор `->>` для получения значения поля JSONB как текста.

### `get_user_from_db.ts`
Генерирует Python-код для функции получения данных пользователя из базы данных. Возвращает словарь с данными пользователя, включая `user_data`, если он существует.

### `init_database.ts`
Генерирует Python-код для инициализации подключения к базе данных и создания таблиц, если они не существуют. Создает таблицы `bot_users` и `bot_messages`.

### `init_user_variables.ts`
Генерирует Python-код для функции инициализации пользовательских переменных. Инициализирует базовые переменные пользователя из Telegram API, такие как `user_name`, `first_name`, `last_name`, и `username`.

### `log_message.ts`
Генерирует Python-код для функции логирования сообщений в базу данных. Логирует сообщения в таблицу `bot_messages`.

### `replace_variables_in_text.ts`
Генерирует Python-код для функции замены переменных в тексте. Заменяет переменные формата `{variable_name}` в тексте на их значения из словаря переменных пользователя.

### `save_user_data_to_db.ts`
Генерирует Python-код для функции сохранения пользовательских данных в базу данных. Это алиас для `update_user_data_in_db` для обратной совместимости.

### `save_user_to_db.ts`
Генерирует Python-код для функции сохранения пользователя в базу данных. Сохраняет пользователя в таблицу `bot_users`, обновляя его данные, если пользователь уже существует.

### `update_user_data_in_db.ts`
Генерирует Python-код для функции обновления пользовательских данных в базе данных. Обновляет поле `user_data` пользователя, добавляя или изменяя значения в JSONB поле.

### `update_user_variable_in_db.ts`
Генерирует Python-код для функции обновления переменной пользователя в базе данных. Сохраняет переменную пользователя в поле `user_data` в формате JSONB.