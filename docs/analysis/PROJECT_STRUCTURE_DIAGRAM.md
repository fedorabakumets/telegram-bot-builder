# 🏗️ Диаграмма структуры проекта

## Текущая структура (с проблемами)

```
telegram-bot-builder/
│
├── 📁 client/
│   ├── ❌ components/     [ОТСУТСТВУЮТ - удалены]
│   ├── ❌ pages/         [ОТСУТСТВУЮТ - удалены]
│   ├── ❌ App.tsx        [ОТСУТСТВУЮТ - удалены]
│   ├── ❌ index.tsx      [ОТСУТСТВУЮТ - удалены]
│   │
│   └── 📁 lib/
│       ├── 🔴 bot-generator.ts (11,942 строки!) ← МОНОЛИТ
│       └── 📁 bot-generator/   ← Рефакторинг в процессе
│           ├── analyzers/
│           ├── core/
│           ├── handlers/
│           └── utils/
│
├── 📁 server/
│   ├── 🔴 routes.ts (1,000+ строк) ← СЛИШКОМ БОЛЬШОЙ
│   ├── 🟡 routes.ts.backup         ← BACKUP ФАЙЛ
│   ├── 🟡 db-backup.ts              ← BACKUP ФАЙЛ
│   ├── storage.ts
│   ├── db.ts
│   └── telegram-client.ts
│
├── 📁 shared/
│   └── 🔴 schema.ts (917 строк) ← СЛИШКОМ БОЛЬШОЙ
│
├── 📁 scripts/ (79 файлов!) ← ИЗБЫТОК
│   ├── extract-functions/ (30+ файлов)
│   │   ├── 1-analyze-functions.cjs
│   │   ├── 2-extract-functions.cjs
│   │   ├── safe-refactor.cjs
│   │   ├── smart-refactor.cjs
│   │   └── ... (множество версий)
│   ├── fix-*.cjs (10+ файлов)
│   └── rollback-*.cjs (5+ файлов)
│
├── 📁 backups/ (31 файл)
│
├── 🟡 REFACTORING_*.md (8+ файлов) ← ИЗБЫТОЧНАЯ ДОКУМЕНТАЦИЯ
├── 🟡 TASK_*.md
├── 🟡 COMPLETION_*.md
│
└── 🟡 fix-*.bat (10+ файлов) ← ТОЛЬКО WINDOWS
```

---

## Рекомендуемая структура

```
telegram-bot-builder/
│
├── 📁 client/
│   ├── ✅ components/
│   │   ├── ui/              # Базовые компоненты
│   │   ├── editor/          # Компоненты редактора
│   │   ├── layout/           # Компоненты макета
│   │   └── media/            # Работа с медиа
│   ├── ✅ pages/
│   │   ├── Editor.tsx
│   │   └── Home.tsx
│   ├── ✅ App.tsx
│   ├── ✅ index.tsx
│   │
│   └── 📁 lib/
│       └── 📁 bot-generator/  ← ПОЛНОСТЬЮ МОДУЛЬНЫЙ
│           ├── analyzers/
│           ├── core/
│           ├── handlers/
│           ├── utils/
│           └── index.ts       ← Единая точка входа
│
├── 📁 server/
│   ├── 📁 routes/            ← РАЗДЕЛЕНО ПО ДОМЕНАМ
│   │   ├── index.ts          # Регистрация всех роутов
│   │   ├── projects.ts
│   │   ├── templates.ts
│   │   ├── bots.ts
│   │   ├── media.ts
│   │   └── users.ts
│   ├── 📁 services/          ← БИЗНЕС-ЛОГИКА
│   │   ├── project-service.ts
│   │   ├── bot-service.ts
│   │   └── template-service.ts
│   ├── storage.ts
│   ├── db.ts
│   └── telegram-client.ts
│
├── 📁 shared/
│   └── 📁 schema/            ← РАЗДЕЛЕНО ПО ТИПАМ
│       ├── index.ts
│       ├── database.ts       # Drizzle схемы
│       ├── validation.ts     # Zod схемы
│       ├── bot-structure.ts  # Схемы бота
│       └── api.ts            # API схемы
│
├── 📁 scripts/               ← ОЧИЩЕНО
│   ├── refactor.cjs          # Единый скрипт рефакторинга
│   ├── test.cjs              # Единый скрипт тестирования
│   └── README.md             # Документация скриптов
│
├── 📁 docs/
│   ├── reports/              ← АРХИВ ОТЧЕТОВ
│   │   ├── refactoring/
│   │   └── tasks/
│   └── guides/
│
├── 📁 tests/                 ← ДОБАВЛЕНО
│   ├── unit/
│   ├── integration/
│   └── e2e/
│
└── ✅ .eslintrc.js           ← ДОБАВЛЕНО
    ✅ .prettierrc
    ✅ vitest.config.ts
```

---

## Сравнение: До и После

### Проблемы → Решения

| Проблема | Текущее состояние | Рекомендуемое решение |
|----------|-------------------|----------------------|
| **Монолитный bot-generator.ts** | 11,942 строки | ✅ Модульная структура (20-30 файлов по 200-500 строк) |
| **Отсутствие компонентов** | 0 файлов | ✅ Восстановить из Git или пересоздать |
| **Избыток скриптов** | 79 файлов | ✅ 3-5 основных скриптов |
| **Backup файлы** | 10+ файлов | ✅ Удалить, использовать Git |
| **Монолитный routes.ts** | 1,000+ строк | ✅ Разделить на 5-6 файлов по доменам |
| **Монолитный schema.ts** | 917 строк | ✅ Разделить на 4-5 модулей |
| **Отчеты в корне** | 15+ файлов | ✅ Переместить в docs/reports/ |
| **Отсутствие тестов** | 0 тестов | ✅ Добавить unit/integration/e2e тесты |
| **Нет инструментов** | Нет ESLint/Prettier | ✅ Настроить ESLint + Prettier + Husky |

---

## Приоритеты рефакторинга

```
КРИТИЧНО (Неделя 1)
├── 🔴 Восстановить React компоненты
├── 🔴 Удалить backup файлы
└── 🔴 Очистить корневую директорию

ВАЖНО (Неделя 2)
├── 🟡 Завершить рефакторинг bot-generator.ts
├── 🟡 Реорганизовать server/routes.ts
└── 🟡 Разделить shared/schema.ts

УЛУЧШЕНИЯ (Неделя 3)
├── 🟢 Добавить тесты
├── 🟢 Настроить ESLint + Prettier
└── 🟢 Улучшить логирование
```

---

## Метрики улучшения

### До рефакторинга:
- ❌ Самый большой файл: 11,942 строки
- ❌ Скриптов: 79 файлов
- ❌ Backup файлов: 10+
- ❌ React компонентов: 0
- ❌ Тестов: 0

### После рефакторинга (цель):
- ✅ Самый большой файл: < 500 строк
- ✅ Скриптов: 3-5 файлов
- ✅ Backup файлов: 0
- ✅ React компонентов: 50+
- ✅ Тестов: 100+ (покрытие > 60%)

---

**Статус:** 📋 План готов к выполнению
