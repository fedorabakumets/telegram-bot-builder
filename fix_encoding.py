#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –≤ —Ñ–∞–π–ª–µ bot-generator.ts
–ó–∞–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ CP1251 –Ω–∞ UTF-8
"""

import os
import sys

# –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É UTF-8 –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å Windows
sys.stdout.reconfigure(encoding='utf-8')

FILE_PATH = r'c:\Users\1\Desktop\telegram-bot-builder\client\lib\bot-generator.ts'

# –°–ª–æ–≤–∞—Ä—å –∑–∞–º–µ–Ω: CP1251 –±–∞–π—Ç—ã -> UTF-8 —Å—Ç—Ä–æ–∫–∏
REPLACEMENTS = {
    # print("?? –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    b'print("?? \xc1\xee\xf2 \xe7\xe0\xef\xf3\xf9\xe5\xed \xe8 \xe3\xee\xf2\xee\xe2 \xea \xf0\xe0\xe1\xee\xf2\xe5!")': 
        b'print("\xf0\x9f\x9a\x80 \xd0\x91\xd0\xbe\xd1\x82 \xd0\xb7\xd0\xb0\xd0\xbf\xd1\x83\xd1\x89\xd0\xb5\xd0\xbd \xd0\xb8 \xd0\xb3\xd0\xbe\xd1\x82\xd0\xbe\xd0\xb2 \xd0\xba \xd1\x80\xd0\xb0\xd0\xb1\xd0\xbe\xd1\x82\xd0\xb5!")',
    
    # print("?? –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É...")
    b'print("?? \xcf\xee\xeb\xf3\xf7\xe5\xed \xf1\xe8\xe3\xed\xe0\xeb \xee\xf1\xf2\xe0\xed\xee\xe2\xea\xe8, \xe7\xe0\xe2\xe5\xf0\xf8\xe0\xe5\xec \xf0\xe0\xe1\xee\xf2\xf3...")': 
        b'print("\xe2\x9a\xa0\xd0\xb8 \xd0\x9f\xd0\xbe\xd0\xbb\xd1\x83\xd1\x87\xd0\xb5\xd0\xbd \xd1\x81\xd0\xb8\xd0\xb3\xd0\xbd\xd0\xb0\xd0\xbb \xd0\xbe\xd1\x81\xd1\x82\xd0\xb0\xd0\xbd\xd0\xbe\xd0\xb2\xd0\xba\xd0\xb8, \xd0\xb7\xd0\xb0\xd0\xb2\xd0\xb5\xd1\x80\xd1\x88\xd0\xb0\xd0\xb5\xd0\xbc \xd1\x80\xd0\xb0\xd0\xb1\xd0\xbe\xd1\x82\xd1\x83...")',
    
    # print("?? –°–∏—Å—Ç–µ–º–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É...")
    b'print("?? \xd1\xe8\xf1\xf2\xe5\xec\xed\xee\xe5 \xe7\xe0\xe2\xe5\xf0\xf8\xe5\xed\xe8\xe5, \xe7\xe0\xe2\xe5\xf0\xf8\xe0\xe5\xec \xf0\xe0\xe1\xee\xf2\xf3...")': 
        b'print("\xe2\x9a\xa0\xd0\xb8 \xd0\xa1\xd0\xb8\xd1\x81\xd1\x82\xd0\xb5\xd0\xbc\xd0\xbd\xd0\xbe\xd0\xb5 \xd0\xb7\xd0\xb0\xd0\xb2\xd0\xb5\xd1\x80\xd1\x88\xd0\xb5\xd0\xbd\xd0\xb8\xd0\xb5, \xd0\xb7\xd0\xb0\xd0\xb2\xd0\xb5\xd1\x80\xd1\x88\xd0\xb0\xd0\xb5\xd0\xbc \xd1\x80\xd0\xb0\xd0\xb1\xd0\xbe\xd1\x82\xd1\x83...")',
    
    # logging.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
    b'logging.error(f"\xca\xf0\xe8\xf2\xe8\xf7\xe5\xf1\xea\xe0\xff \xee\xf8\xe8\xe1\xea\xe0: {e}")': 
        b'logging.error(f"\xd0\x9e\xd1\x88\xd0\xb8\xd0\xb1\xd0\xba\xd0\xb0: {e}")',
    
    # # –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    b'# \xcf\xf0\xe0\xe2\xe8\xeb\xfc\xed\xee \xe7\xe0\xea\xf0\xfb\xe2\xe0\xe5\xec \xe2\xf1\xe5 \xf1\xee\xe5\xe4\xe8\xed\xe5\xed\xe8\xff': 
        b'# \xd0\x97\xd0\xb0\xd0\xba\xd1\x80\xd1\x8b\xd1\x82\xd0\xb8\xd0\xb5 \xd1\x81\xd0\xbe\xd0\xb5\xd0\xb4\xd0\xb8\xd0\xbd\xd0\xb5\xd0\xbd\xd0\xb8\xd0\xb9 \xd0\xbf\xd1\x80\xd0\xb8 \xd0\xb2\xd1\x8b\xd1\x85\xd0\xbe\xd0\xb4\xd0\xb5',
}

def fix_encoding():
    if not os.path.exists(FILE_PATH):
        print(f"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {FILE_PATH}")
        return False
    
    with open(FILE_PATH, 'rb') as f:
        content = f.read()
    
    original_content = content
    replaced_count = 0
    
    for cp1251_bytes, utf8_bytes in REPLACEMENTS.items():
        if cp1251_bytes in content:
            content = content.replace(cp1251_bytes, utf8_bytes)
            replaced_count += 1
            print(f"‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ: {cp1251_bytes[:30]}... -> UTF-8")
        else:
            print(f"‚ö†Ô∏è  –ù–µ –Ω–∞–π–¥–µ–Ω–æ: {cp1251_bytes[:30]}...")
    
    if content != original_content:
        with open(FILE_PATH, 'wb') as f:
            f.write(content)
        print(f"\nüéâ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ {replaced_count} —Å—Ç—Ä–æ–∫(–∏)!")
        print(f"–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {FILE_PATH}")
        return True
    else:
        print("\n‚ùå –ù–∏–∫–∞–∫–∏—Ö –∑–∞–º–µ–Ω –Ω–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ, —Ñ–∞–π–ª —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.")
        return False

if __name__ == '__main__':
    fix_encoding()
