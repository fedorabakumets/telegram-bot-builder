 В существующем проекте есть кнопки с пустыми target, что создает пустые callback_data="". Это вызывает проблемы с обработкой. Давайте исправим генератор кода, чтобы он правильно обрабатывал такие случаи:


Opened client/src/lib/bot-generator.ts
Проблема в том, что генератор создает кнопки с пустым target. Нужно добавить проверку и пропускать такие кнопки или генерировать заглушку. Исправлю генератор:


Edited client/src/lib/bot-generator.ts
Теперь протестируем исправленный генератор:


Executed curl -X POST http://localhost:5000/api/projects/1/export \ -H "Content-Type: application/json" | python -c " import json import sys data = json.load(sys.stdin) code = data['code'] print('=== ТЕСТ ИСПРАВЛЕННОГО ГЕНЕРАТОРА ===') # Проверяем на пустые callback_data if 'callback_data=\"\"' in code: print('❌ Всё ещё есть пустые callback_data') else: print('✅ Нет пустых callback_data') # Проверяем на пропущенные кнопки if '# Кнопка' in code and 'пропущена' in code: print('✅ Пропущенные кнопки отмечены в коде') else: print('⚠️ Не найдены комментарии о пропущенных кнопках') # Сохраняем для проверки with open('fixed_generator_test.py', 'w', encoding='utf-8') as f: f.write(code) # Проверяем синтаксис import subprocess try: result = subprocess.run(['python', '-m', 'py_compile', 'fixed_generator_test.py'], capture_output=True, text=True) if result.returncode == 0: print('✅ Синтаксис кода правильный') else: print(f'❌ Синтаксические ошибки: {result.stderr}') except Exception as e: print(f'❌ Ошибка проверки: {e}') "
Изменения не применились к серверу. Проблема в том, что серверная часть использует старый генератор. Нужно проверить, где серверная часть берет код генератора:


Opened server/routes.ts
Я вижу проблему. Нужно найти где серверная часть генерирует код и исправить его. Давайте найдем функцию экспорта:


Searched for "Find server export route that generates Python bot code"
Проблема в том, что серверная часть использует другую логику генерации кода. Давайте найдем где серверный код генерирует Python:


Opened server/routes.ts
Теперь я нашел серверную логику генерации inline кнопок. Давайте найдем место, где генерируются inline кнопки:


Opened server/routes.ts
Вот проблема! В серверной части строка 321 использует button.target || button.text для callback_data, а в клиентской части мой исправленный код проверяет пустые target. Нужно исправить серверную часть: